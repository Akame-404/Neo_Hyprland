"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[31658],{646564:(e,t,n)=>{n.d(t,{xj:()=>$,lA:()=>ee,YV:()=>E,NZ:()=>q,Hh:()=>X,F0:()=>O,vi:()=>Y,xI:()=>V,LK:()=>D,sH:()=>J,cK:()=>R,cx:()=>z,yY:()=>B,sY:()=>N});n(757658),n(667294);var o=n(800480),i=n(886628),s=n(724405),r=n(241154),a=n(541432),l=n(356666),c=n(775e3),d=n(725651),u=n(11751),p=n(745238),m=n(785893);const f=(0,p.IU)("upLeftArrow",{viewBox:"0 0 16 16",svg:(0,m.jsx)("path",{d:"M2.8457 10.5869C2.8457 11.0312 3.19434 11.373 3.59766 11.373C4.00098 11.373 4.3291 11.0176 4.3291 10.6074V8.05762L4.21973 5.22754L5.32031 6.47168L11.8418 12.9932C11.999 13.1504 12.1904 13.2256 12.3818 13.2256C12.7852 13.2256 13.1543 12.8564 13.1543 12.46C13.1543 12.2686 13.0654 12.0771 12.9082 11.9199L6.40039 5.39844L5.15625 4.30469L8.10254 4.40039H10.5361C10.9463 4.40039 11.2881 4.07227 11.2881 3.67578C11.2881 3.27246 10.9736 2.93066 10.5156 2.93066H3.64551C3.16016 2.93066 2.85254 3.25195 2.85254 3.72363L2.8457 10.5869Z"})});var g=n(709291),v=n(531701),h=n(401898),y=n(742858),x=n(210228),C=n(484654),S=n(492022),k=n(313679),b=n(672495),I=n(119037),w=n(778663),M=n(599417),A=n(319124),P=n(840959),j=n(316772),F=n(27724),T=n(547801),L=n(62967);const N=(0,g.defineMessages)({notionAI:{defaultMessage:"Notion AI",id:"completions.completionActions.AIAssist"},more:{defaultMessage:"See more",id:"completions.completionActions.more"},alternativeUiString:{defaultMessage:"{text}",id:"completions.completionActions.alternativeUiString"},aiFreePromptBlockDisplayName:{defaultMessage:"Custom AI block",id:"completions.completionActions.aiFreePromptBlockDisplayName"},aiSectionBlockDisplayName:{defaultMessage:"Custom AI section",id:"completions.completionActions.aiSectionBlockDisplayName"}});function B(e){return function(t){return(0,m.jsx)(b.Z,{...t,title:(0,m.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,u.t)({width:16,height:16,marginRight:4}),(0,m.jsx)("div",{children:t.title})]}),right:e})}}function E(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=[];if(i.push(...e.slice(0,t)),e.length>t&&!o){const n=(0,L.$J)({key:"more actions",render:e=>(0,m.jsx)(b.Z,{...e}),actions:e.slice(t)});i.push((0,L.MV)({key:"more",displayName:N.more,analyticsName:"Completions - more",validators:T.Pz,svg:()=>(0,m.jsx)(Q,{}),subActions:()=>[n],collapseSubActionsIntoParent:!0,width:350}))}return o&&i.push((0,L.cs)({key:"more",displayName:N.more,analyticsName:"Completions - assistant skill more",validators:T.vW,svg:()=>(0,m.jsx)(Q,{}),action:async e=>{let{environment:t}=e;const{aiDependency:o}=await Promise.resolve().then(n.bind(n,772899));(await o.load()).completionInitialPromptActions.toggleInitialPrompt({from:"slash_menu",environment:t})},shortcuts:["commandJ"],closeParentMenu:!0,sortScoreMultiplier:0})),i}function Z(){return(0,m.jsx)(ee,{svg:d.R,svgFill:v.FN.light.purple[500]})}const _=1e3;function R(e){const{key:t,name:n,analyticsName:o,textToInsert:i,onUpdatePromptState:s,right:r,renderTooltip:a,showEllipsis:l,userProvidedSearchName:c,executeImmediately:d,gtmFavoriteId:u}=e,p=n.length>_?`${n.slice(0,_)}…`:n;return(0,L.cN)({key:t,analyticsName:`Completions - insert text into prompt - ${o}`,...(m=l?`${p}…`:p,{displayName:N.alternativeUiString,displayNameInterpolatedValues:{text:m}}),validators:[],closeParentMenu:!1,svg:Z,action(){s({insertText:i??n,analyticsName:o,gtmFavoriteId:u,executeImmediately:d})},right:r??z("updatePrompt"),renderTooltip:a,userProvidedSearchName:c});var m}function D(e){const{from:t,type:n,onUpdatePromptState:o}=e;function i(e){return R({key:`completions.${e.key}`,name:(0,M.t8)(e),analyticsName:e.key,textToInsert:(0,w.$W)(e),onUpdatePromptState:o,showEllipsis:!0})}const s="cursor"===n?{selectionType:n,isPageEmpty:!I.IC9()}:{selectionType:n},r=(0,M.up)(s),a=(0,M.pv)(r,s),l=[];for(const[c,d]of a){const e=[],o=T.Pz;for(const r of d)"helpMeDraft"!==r.key&&"helpMeEdit"!==r.key&&"helpMeWrite"!==r.key&&("translate"===r.key?e.push(W(r,o,n,t)):"changeTone"===r.key?e.push(K(r,o,n,t)):r.steps?e.push(i(r)):e.push(q({prompt:r,validators:o,type:n,from:t})));const s=(0,L.$J)({key:`completions.${c}`,title:(0,M.Mh)(c,"cursor"===n?"page":"selection"),render:e=>(0,m.jsx)(b.Z,{...e}),actions:E(e.filter(h.$K),7)});l.push(s)}return"cursor"===n&&l.push((0,L.$J)({key:"completions.aiBlocks",title:M.Dr.aiBlocks,render:e=>(0,m.jsx)(b.Z,{...e}),actions:P.O5.map((e=>function(e){const t=P.Hc[e.aiBlockType],{displayName:n,svg:o}=U[e.aiBlockType],i=e=>!t.shouldShow||t.shouldShow(e);return(0,L.cN)({key:`completions.aiBlocks.${t.key}`,analyticsName:`Completions - ${t.key}`,closeParentMenu:!0,svg:o,displayName:n,validators:[...T.vE,i],action:e=>{let{environment:n}=e;x.createAndCommit({userAction:"completionActions.createAiBlockAction",environment:n,perform:e=>{y.at({environment:n,selection:F.default.state.stores,createBlockItem:t,analyticsFrom:"ai_prompt",transaction:e})}})}})}({aiBlockType:e})))})),l}const U={[a.MF.aiFreePromptBlock]:{displayName:N.aiFreePromptBlockDisplayName,svg:()=>(0,m.jsx)(te,{svg:u.t})}};function V(e){return(0,L.$J)({key:"completions",title:N.notionAI,render:B(),actions:H(e)})}function H(e){const{store:t,from:n}=e,o=[];for(const i of(0,A.G9)()){if("helpMeWrite"===i.key)continue;const e=q({prompt:i,validators:T.vE,type:"aiBlock",from:n,store:t});e&&o.push(e)}return o}function O(e){const{environment:t,inputValue:n,store:o}=e,i=(0,A.qB)({customPrompt:n,isPageEmpty:!1});C.triggerCompletionForAiBlock({environment:t,store:o,prompt:i,additionalContext:{prompt:n}})}function W(e,t,n,o){const{key:i,name:s,svg:r,svgFill:a,steps:l}=e;if("translate"!==i||!l||1!==l.length||"language"!==l[0].key||"dropdown"!==l[0].type)return;const c=l[0].dropdownOptions.map((i=>{let{key:s,name:r}=i;return(0,L.cN)({key:`completions.translate.${s}`,analyticsName:`Completions - translate - ${s}`,displayName:r,validators:t,closeParentMenu:!0,right:z("submitPrompt"),action:t=>{let{environment:i}=t;G({environment:i,prompt:e,from:o,type:n,additionalContext:{language:s}})}})})),d=(0,L.$J)({key:"translate language actions",render:e=>(0,m.jsx)(b.Z,{...e}),actions:c}),u=r?()=>(0,m.jsx)(ee,{svg:r,svgFill:a}):void 0;return(0,L.MV)({key:"translate",displayName:s,analyticsName:`Completions - ${i}`,validators:t,svg:u,subActions:()=>[d]})}function K(e,t,n,o){const{key:i,name:s,svg:r,svgFill:a,steps:l}=e;if("changeTone"!==i||!l||1!==l.length||"tone"!==l[0].key||"dropdown"!==l[0].type)return;const c=l[0].dropdownOptions.map((i=>{let{key:s,name:r}=i;return(0,L.cN)({key:`completions.changeTone.${s}`,analyticsName:`Completions - changeTone - ${s}`,displayName:r,validators:t,closeParentMenu:!0,right:z("submitPrompt"),action:t=>{let{environment:i}=t;G({environment:i,prompt:e,from:o,type:n,additionalContext:{tone:s}})}})})),d=(0,L.$J)({key:"changeTone tone actions",render:e=>(0,m.jsx)(b.Z,{...e}),actions:c}),u=r?()=>(0,m.jsx)(ee,{svg:r,svgFill:a}):void 0;return(0,L.MV)({key:"changeTone",displayName:s,analyticsName:`Completions - ${i}`,validators:t,svg:u,subActions:()=>[d]})}function $(e){const{focused:t,type:n}=e,r=(0,o.O7)(),a=(0,i.VK)((()=>r.device.isPhone),[r]),l=(0,s.yK)((e=>({iconStyle:{width:14,height:14,fill:e.mediumIconColor,opacity:!a&&t?1:0},containerStyle:{width:18,height:18,display:"flex",alignItems:"center",justifyContent:"center"}})),[t,a]);switch(n){case"submitPrompt":return(0,m.jsx)("div",{style:l.containerStyle,children:(0,c.U)(l.iconStyle)});case"updatePrompt":return(0,m.jsx)("div",{style:l.containerStyle,children:f(l.iconStyle)});default:(0,h.t1)(n)}}function z(e){return function(t){return(0,m.jsx)($,{type:e,focused:t.focused})}}function J(e){const{customPrompt:t,execute:n}=e;return(0,L.cN)({analyticsName:"Completions - execute current prompt input",key:"explicitFreeFormAction",displayName:M.Dr.genericHelpMeWrite,displayNameInterpolatedValues:{filter:t},svg:Z,right:z("submitPrompt"),validators:[],closeParentMenu:!1,renderTooltip:L.zz,action(){n()}})}function q(e){const{prompt:t,validators:n,type:o,from:i,store:s,sortScoreMultiplier:r}=e,{key:a,name:l}=t;if("translate"===a&&("textSelection"===o||"blockSelection"===o||"cursor"===o))return W(t,n,o,i);if("changeTone"===a&&("textSelection"===o||"blockSelection"===o||"cursor"===o))return K(t,n,o,i);const c=function(e){const{svg:t,svgFill:n}=e;return t?()=>(0,m.jsx)(ee,{svg:t,svgFill:n}):void 0}(t),d=[...n];return t.requiresContent?d.push(I.IC9):t.requiresNoContent&&d.push(I.ffD(I.IC9)),(0,L.cN)({key:`completions.${a}`,analyticsName:`Completions - ${a}`,displayName:l,fuzzySearchKeywords:t.fuzzySearchKeywords,validators:d,closeParentMenu:!0,svg:c,right:z("submitPrompt"),sortScoreMultiplier:r,action:e=>{let{environment:n}=e;G({environment:n,prompt:t,type:o,from:i,store:s})}})}function G(e){const{environment:t,prompt:n,type:o,from:i,store:s,additionalContext:r}=e;if("textSelection"===o)C.openCompletionPopupForSavedContext({environment:t,prompt:n,from:i,additionalContext:r});else if("blockSelection"===o)C.openCompletionPopupForBlockSelectionContext({environment:t,prompt:n,from:i,additionalContext:r});else if("cursor"===o){if(n.preferToNeverInsertTextAtCursor)return void C.selectPageAndOpenCompletionPopupForBlockSelectionContext({environment:t,prompt:n,from:i,additionalContext:r});C.openCompletionPopupForCursorContext({environment:t,prompt:n,from:i,additionalContext:r})}else"aiBlock"===o?s&&C.triggerCompletionForAiBlock({environment:t,store:s,prompt:n,additionalContext:r}):(0,h.t1)(o)}async function Y(e){const{environment:t,clientSkillWithParameterValues:n,from:o}=e;await(0,S.toggleInitialPrompt)({from:"rich_text_menu",environment:t});const i=j.default.state;i&&"assistantCompletionPopup"===i.type&&"initialPrompt"===i.stage&&await(0,k.triggerAssistantSkillCompletion)({environment:t,context:i.context,clientSkillWithParameterValues:n,updater:j.default.createUpdater(),sessionId:(0,r.Oy)(),from:o})}function X(e){const{inputValue:t,from:n,mode:o,environment:i}=e;switch(o){case"edit":return void function(e){const{customPrompt:t,from:n,environment:o}=e,i=(0,M.sB)(t);"closedWithContext"===j.default.state.type&&j.default.state.context&&C.openCompletionPopupForPrefilledContext({environment:o,context:j.default.state.context,prompt:i,additionalContext:{prompt:t},from:n,skipInitialForm:!0})}({environment:i,customPrompt:t,from:n});case"write":const e=(0,M.wq)(t);if(e){const{prompt:t,additionalContext:o}=e,s=(0,w.FD)();if(!s)return;return void C.openCompletionPopupForPrefilledContext({environment:i,context:s,prompt:t,additionalContext:o,from:n,skipInitialForm:!0})}return void function(e){const{environment:t,customPrompt:n,from:o}=e,i=(0,A.qB)({customPrompt:n,isPageEmpty:!I.IC9()}),s=(0,w.FD)();s&&C.openCompletionPopupForPrefilledContext({environment:t,context:s,prompt:i,additionalContext:{prompt:n},from:o,skipInitialForm:!0})}({environment:i,customPrompt:t,from:n})}(0,h.t1)(o)}function Q(){const e=(0,s.Fg)();return(0,l.o)({width:12,marginLeft:2,marginRight:2,fill:e.mediumIconColor})}function ee(e){const t=(0,s.yK)((t=>({box:{height:e.fixedWidth?22:void 0,width:e.fixedWidth?22:void 0,display:"flex",alignItems:"center",justifyContent:"center",...e.boxStyles},icon:{height:16,width:16,fill:e.svgFill??(0,v.gh)({theme:"light"}).regularIconColor}})),[e]);return(0,m.jsx)("div",{style:t.box,children:e.svg(t.icon)})}function te(e){const t=(0,s.yK)((e=>({box:{background:e.fill.purple,width:24,height:24,borderRadius:4},icon:{fill:e.icon.purple}})),[]);return(0,m.jsx)(ee,{svg:e.svg,svgFill:t.icon.fill,boxStyles:t.box})}},618574:(e,t,n)=>{n.d(t,{Si:()=>b,TS:()=>y,aX:()=>C,nA:()=>I,z5:()=>x});n(21703);var o=n(667294),i=n(886628),s=n(724405),r=n(151454),a=n(653965),l=n(401898),c=n(301743),d=n(724098),u=n(599417),p=n(645010),m=n(521273),f=n(206258),g=n(677794),v=n(457819),h=n(785893);function y(e){const{scrollerStore:t,openState:n,children:a}=e,[p,y]=(0,o.useState)(Date.now()),I=(0,o.useCallback)((()=>y(Date.now())),[]),w=(0,o.useRef)(null),[M,A]=(0,o.useState)(void 0),[P,j]=(0,o.useState)(void 0),F=(0,i.VK)((()=>{const e=(0,v.$b)(n);if(!e)return;const o=(0,u.wA)(e);if(!o)return;const{origin:i}=e;i instanceof f.G&&i.isEmptyEditableBlock()&&(o.height=0);const s=t.state,r=s.clientRect??new DOMRect,a=s.scrollTop,l=function(e){const{openState:t,originRect:n,scrollerRect:o,scrollerScrollTop:i,popupRect:s}=e,r=(null==s?void 0:s.height)??0,a=(null==s?void 0:s.width)??0,l=Math.min(Math.max(n.width,S),k);let c;const d=n.bottom-o.top+i+C.top;n.bottom+r+C.top+C.bottom>o.bottom&&(c=d-(o.height-r-C.bottom+i));let u;a+C.left+C.right>o.width?u=C.left:n.left+a>o.right?u=o.width-a-C.right:(u=n.left-o.left,"initialPromptForAIBlock"===t.stage&&(u-=a-n.width));return{top:d,left:u,width:l,scrollTopIntoView:c}}({openState:n,originRect:o,scrollerRect:r,scrollerScrollTop:a,popupRect:M});return l}),[t,M,n]);(0,o.useEffect)((()=>{F&&j(F)}),[F]);const T=F??P;(0,o.useEffect)((()=>{if(Date.now()-p>500)return;const e=null==T?void 0:T.scrollTopIntoView;if(!e)return;const n=b(t);n&&x(e,n)}),[null==T?void 0:T.scrollTopIntoView,t,p]);const L=(0,i.VK)((()=>m.Z.isAssistantInWriterEnabled()),[]),N=(0,s.yK)((e=>({wrap:{position:"absolute",width:null==T?void 0:T.width,zIndex:r.lB,...L?{top:0,left:0,transform:`translate(${(null==T?void 0:T.left)??0}px, ${(null==T?void 0:T.top)??0}px)`,transition:"transform 0.1s"}:{top:null==T?void 0:T.top,left:null==T?void 0:T.left}}})),[T,L]);(0,o.useEffect)((()=>{const e=new g.E;if(!w.current)throw new Error("ref.current is null");let t;return e.observe(w.current),e.rect.addListener((e=>{(0,l.$K)(t)&&cancelAnimationFrame(t),t=requestAnimationFrame((()=>A(e.state)))})),()=>{(0,l.$K)(t)&&cancelAnimationFrame(t),e.destroy()}}),[]);const B="results"===n.stage&&!n.loading;(0,o.useEffect)((()=>{B&&I()}),[B,I]);const E="results"===n.stage&&n.loading,Z=(0,v.jq)({resetWhenScrolledToBottom:!1,areWeLoading:E,scrollerStore:t}),_="results"===n.stage&&"cursor"===n.context.type,[R,D]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{!E||!_&&R||(Z?x.cancel():null!=T&&T.scrollTopIntoView&&(I(),D(!0)))}),[Z,R,_,E,T,I]),(0,h.jsx)(d.Z,{capture:!0,render:e=>(0,h.jsx)(c.Z,{debugName:"PopupPositioner",capture:!0,allowMenuList:!0,allowEsc:!0,children:(0,h.jsx)("div",{style:N.wrap,ref:w,...e,children:T&&a})})})}const x=a.Ds(((e,t)=>{t.scrollByOffset(e,0,{animate:!0}),p.Z.MenuScroller&&p.Z.MenuScroller.scrollToTop()}),60),C={top:4,bottom:6,left:6,right:16},S=500,k=730;function b(e){var t,n;return e===(null===(t=p.Z.PageScroller)||void 0===t?void 0:t.stores.store)?p.Z.PageScroller:e===(null===(n=p.Z.PeekViewScroller)||void 0===n?void 0:n.stores.store)?p.Z.PeekViewScroller:void 0}function I(e){var t,n;return e===(null===(t=p.Z.PageScroller)||void 0===t?void 0:t.stores.store)?"Page":e===(null===(n=p.Z.PeekViewScroller)||void 0===n?void 0:n.stores.store)?"PeekView":void 0}},831658:(e,t,n)=>{n.r(t),n.d(t,{AiEligibilityUpdater:()=>Ct,CompletionPopup:()=>gt,aiQnaActions:()=>a,completionActions:()=>i,completionInitialPromptActions:()=>s,favoriteImportActions:()=>r,propertyCompletionsActions:()=>o});var o=n(644866),i=n(484654),s=n(492022),r=n(762878),a=n(244458),l=n(667294),c=n(118466),d=n(126263),u=n(701302),p=n(800480),m=n(886628),f=n(724405),g=n(842875),v=n(966673),h=n(882883),y=n(709291),x=n(926249),C=n(401898),S=n(646564),k=n(10910),b=n(800893),I=n(210228),w=n(852286),M=n(203386),A=n(296994),P=n(843250),j=n(599417),F=n(743455),T=n(895083),L=n(277907),N=n(316772),B=n(229798),E=n(489626),Z=n(416091),_=n(11751),R=n(632163),D=n(550506),U=n(863296),V=n(672495),H=n(155856),O=n(434859),W=n(785893);function K(e){const{open:t,onCancelExit:n,onConfirmExit:o}=e,i=(0,l.useCallback)((()=>(0,W.jsx)($,{onConfirmExit:o,onCancelExit:n})),[o,n]);return(0,W.jsx)(D.Z,{open:t,render:i,disableAnimation:!0,onDismiss:n})}function $(e){const t=(0,f.yK)((e=>({wrapper:{padding:24,display:"flex",flexDirection:"column",minWidth:280},question:{fontWeight:500,maxWidth:240,textAlign:"center",marginTop:8,marginBottom:8,lineHeight:"1.2em"},icon:{width:32,height:32,alignSelf:"center",paddingTop:8,fill:e.accentColors.purple[400]}})),[]),n={width:"100%",marginTop:8},o=[{key:"confirm",render:e=>(0,W.jsx)(U.Z,{style:n,...e,children:(0,W.jsx)(y.FormattedMessage,{id:"completions.ExitConfirmationDialog.confirmExit",defaultMessage:"Discard"})}),action:e.onConfirmExit},{key:"cancel",render:e=>(0,W.jsx)(U.Z,{style:n,...e,children:(0,W.jsx)(y.FormattedMessage,{id:"completions.ExitConfirmationDialog.cancelExit",defaultMessage:"Cancel"})}),action:e.onCancelExit}];return(0,W.jsx)(H.Z,{capture:!0,preventType:O.Z.All,children:(0,W.jsxs)("div",{style:t.wrapper,children:[(0,_.t)(t.icon),(0,W.jsx)("p",{style:t.question,children:(0,W.jsx)(y.FormattedMessage,{id:"completions.ExitConfirmationDialog.question",defaultMessage:"Do you want to discard the AI response?"})}),(0,W.jsx)(R.Z,{type:R.i.Vertical,initialFocus:0,sections:[{key:"dialog",render:e=>(0,W.jsx)(V.Z,{topBorder:!1,disableMobileBorders:!0,...e}),items:o}]})]})})}var z=n(76095),J=n(301548),q=n(38715),G=n(937612),Y=n(62967),X=n(748019),Q=n(573063),ee=n(268894),te=n(478140),ne=n(886825),oe=n(164369),ie=n(433929),se=n(460709),re=n(80444),ae=n(271184);const le=(0,y.defineMessages)({save:{id:"ai.favorites.save",defaultMessage:"Save changes"},delete:{id:"ai.favorites.delete",defaultMessage:"Delete"},runImmediately:{id:"ai.favorites.runImmediately",defaultMessage:"Run immediately"},actionNameLabel:{id:"ai.favorites.actionNameLabel",defaultMessage:"Action name"},cancelAndGoBack:{id:"ai.favorites.cancelAndGoBack",defaultMessage:"Cancel and go back"}});function ce(e){const{state:t,context:n,sessionId:o}=e,i=(0,y.useIntl)(),s=(0,p.O7)(),r=(0,l.useMemo)((()=>new B.Z),[]),a=(0,Y.cN)({key:"input",analyticsName:"TODO",displayName:le.save,validators:[],closeParentMenu:!1,render:()=>(0,W.jsx)(V.Z,{isInput:!0,style:{marginTop:0},children:(0,W.jsx)(ee.ZP,{value:t.current.name,onChange:e=>{t.set({...t.current,name:e.target.value}),r.setState({focus:{section:0,indexLocal:1,indexGlobal:1}})},placeholder:ie.default.formatMessage(le.actionNameLabel),focusInitial:!0})}),action(e,t){}}),c=[(0,Y.$J)({key:"favorite options section",render:e=>(0,W.jsx)(V.Z,{...e}),actions:[a,(0,Y.cN)({key:"runImmediately",analyticsName:"TODO",displayName:le.runImmediately,validators:[],render:(e,n,o)=>{let{blocks:i,environment:s}=n;const r=Boolean(t.current.executeImmediately);return(0,W.jsx)(ne.Z,{...e,title:ie.default.formatMessage(le.runImmediately),on:r})},closeParentMenu:!1,action(e,n){t.set({...t.current,executeImmediately:!t.current.executeImmediately})}})]}),(0,Y.$J)({actions:[(0,Y.cN)({key:"save",analyticsName:"TODO",displayName:le.save,validators:[],svg:q.N,closeParentMenu:!1,action(e,n){(0,z.m5)({state:t,environment:s,sessionId:o})}})],key:"actions",render:e=>(0,W.jsx)(V.Z,{...e})}),(0,Y.$J)({key:"delete action section",render:e=>(0,W.jsx)(V.Z,{...e}),actions:[(0,Y.cN)({key:"delete",analyticsName:"TODO",displayName:le.delete,validators:[],svg:G.y,closeParentMenu:!1,action(e,n){const{currentUserSettingsStore:i}=re.default.state;i&&(I.createAndCommit({userAction:"ai.favoriteEditorPopup.delete",environment:s,perform(e){(0,ae.QC)(t.current,i,e)}}),t.clear(),k.Vo(s,{type:"delete",session_id:o,gtm_favorite_id:t.current.gtmFavoriteId}))}})]})],d=(0,l.useCallback)((()=>{}),[]);return(0,W.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,W.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"8px 8px 0 8px"},children:[(0,W.jsx)(Q.Z,{icon:J.G,onClick:()=>{(0,z.ny)({environment:s,state:t})},ariaLabel:i.formatMessage(le.cancelAndGoBack)}),(0,W.jsx)(oe.Z,{isSecondaryColor:!0,isSmall:!0,style:{fontWeight:700},children:(0,W.jsx)(y.FormattedMessage,{id:"ai.favorites.saveHeader",defaultMessage:"Save AI action"})})]}),(0,W.jsx)(te.Z,{menuType:se.og.Popup,width:"100%",maxHeight:"min(40vh, 320px)",minHeight:"100%",children:(0,W.jsx)(X.Z,{menuListStore:r,sections:c,onAccept:d,initialFocus:0,context:n})})]})}var de=n(457819),ue=n(2585),pe=n(605257),me=n(319385);const fe=(0,y.defineMessages)({undoAriaLabel:{defaultMessage:"Go to previous AI response",id:"id.completions.undoAriaLabel"},redoAriaLabel:{defaultMessage:"Go to next AI response",id:"id.completions.redoAriaLabel"},historyLabel:{defaultMessage:"{currentRevision} of {totalRevisions}",id:"id.completions.historyLabel"}}),ge={display:"flex",alignItems:"center",marginLeft:-2,marginRight:-2},ve={width:20,height:20,marginLeft:2,marginRight:2};function he(e){const{onUndo:t,onRedo:n,historyLabel:o}=e,i=(0,y.useIntl)();return t||n?(0,W.jsxs)("div",{style:ge,children:[(0,W.jsx)(Q.Z,{icon:ue.f,ariaLabel:i.formatMessage(fe.undoAriaLabel),disabled:!t,onClick:t,style:ve}),(0,W.jsx)(oe.Z,{isSmall:!0,isSecondaryColor:!0,style:{fontVariantNumeric:"tabular-nums"},children:o}),(0,W.jsx)(Q.Z,{icon:pe.o,ariaLabel:i.formatMessage(fe.redoAriaLabel),disabled:!n,onClick:n,style:ve})]}):null}const ye={onUndo:void 0,onRedo:void 0,historyLabel:void 0};function xe(e,t){const n=N.default.state;if("completionPopup"!==n.type||"results"!==n.stage)return;const{aiSessionId:o}=n,i=(0,j.xM)(n);k.Bp(e,{session_id:o,inference_id:i.inferenceId,type:t})}var Ce=n(756863),Se=n(411066),ke=n(301743),be=n(374194);const Ie=(0,y.defineMessages)({promptLabel:{defaultMessage:"Prompt for action",id:"ai.favoritePromptEditor.promptLabel"}});function we(e,t){e.set({...e.current,action:{...e.current.action,prompt:t}})}function Me(e){const{state:t,inputRef:n,sessionId:o}=e,i=(0,p.O7)(),s=(0,de.bJ)(),r=(0,y.useIntl)().formatMessage(Ie.promptLabel);return(0,W.jsxs)(ke.Z,{debugName:"FavoritePromptEditorContent",capture:!0,allowMenuList:!1,allowEsc:!0,children:[(0,W.jsx)(be.Z,{ref:n,format:be.B.Transparent,placeholder:r,selectAll:!0,value:t.current.action.prompt,textarea:!0,textareaSubmitOnEnter:!1,autosize:!0,style:{minHeight:28,paddingTop:4,paddingBottom:4},onChange:e=>we(t,e.target.value),onKeyDown:e=>{"Enter"===e.key&&we(t,`${t.current.action.prompt}\n`)},focusInitial:!1}),(0,W.jsx)("div",{style:s.inputActions,children:(0,W.jsx)(Se.Z,{style:s.purpleButton,onClick:()=>(0,z.m5)({state:t,environment:i,sessionId:o}),children:(0,W.jsx)(y.FormattedMessage,{defaultMessage:"Done",id:"ai.favoritePromptEditor.done"})})})]})}var Ae=n(661519),Pe=n(521273),je=n(438305),Fe=n(626174);const Te=(0,y.defineMessages)({followUpInputPlaceholder:{id:"AlternativeCommandPalette.followUp.inputPlaceholder",defaultMessage:"Tell AI what to do next…"}}),Le={padding:"8px 10px 8px 14px"};function Ne(e){const t=(0,de.bJ)(),n=(0,y.useIntl)(),o=0===e.query.trim().length,i=(0,m.VK)((()=>Pe.Z.isAssistantInWriterEnabled()),[]);return(0,W.jsx)(je.g,{...e,inputPlaceholder:n.formatMessage(Te.followUpInputPlaceholder),children:(0,W.jsxs)("div",{style:t.inputActions,children:[(0,W.jsx)(Fe.O,{onSubmit:e.onSubmit,canSend:!o}),(e.onUndo||e.onRedo)&&!i&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(Ae.Z,{vertical:!0,size:1,style:Le}),(0,W.jsx)(he,{...e})]})]})})}var Be=n(164921),Ee=n(291839);function Ze(e){const{onStop:t,onRetry:n}=e,o=(0,de.bJ)(),i=(0,p.O7)().device,s=i.isMobileNative&&i.isIOS;return(0,W.jsxs)(M.Z,{debugName:"CompletionInProgressContent",capture:!0,onEnter:()=>{t()},onEsc:()=>{t()},onKeypress:e=>{e.metaKey||"r"!==e.key||n()},children:[(0,W.jsxs)("div",{style:o.writingLabel,children:[(0,W.jsx)(y.FormattedMessage,{id:"AlternativeCompletionsPopupContent.writing",defaultMessage:"AI is writing"}),(0,W.jsx)(Ee.Z,{style:o.loadingDots})]}),!s&&(0,W.jsxs)(Be.Z,{style:o.lightweightButton,onClick:n,children:[(0,W.jsx)(y.FormattedMessage,{id:"AlternativeCompletionsPopupContent.tryAgain.label",defaultMessage:"Try again"}),(0,W.jsx)("span",{style:o.keyboardShortcut,children:(0,W.jsx)(y.FormattedMessage,{id:"AlternativeCompletionsPopupContent.startOver.shortcut",defaultMessage:"r"})})]}),(0,W.jsxs)(Be.Z,{style:o.lightweightButton,onClick:t,children:[s?(0,W.jsx)(y.FormattedMessage,{id:"AlternativeCompletionsPopupContent.cancel.label",defaultMessage:"Cancel"}):(0,W.jsx)(y.FormattedMessage,{id:"AlternativeCompletionsPopupContent.stop.label",defaultMessage:"Stop"}),(0,W.jsx)("span",{style:o.keyboardShortcut,children:(0,W.jsx)(y.FormattedMessage,{id:"AlternativeCompletionsPopupContent.stop.shortcut",defaultMessage:"esc"})})]})]})}var _e=n(653965),Re=n(215201),De=n(953336),Ue=n(955217);function Ve(e){const{temporaryListStore:t,isLoading:n}=e,o=(0,p.O7)(),i=(0,l.useRef)(null),s=null==i?void 0:i.current,r=null==s?void 0:s.getStore(),a=(0,m.VK)((()=>o.device.isPhone),[o]),c=(0,de.jq)({resetWhenScrolledToBottom:!0,areWeLoading:n,scrollerStore:r});(0,l.useEffect)((()=>{s&&(c?He.cancel():He(s))}),[s,t,c]);const d={scroller:{maxHeight:a?"min(15vh, 200px)":"min(40vh, 320px)",width:"100%"}};return(0,W.jsx)(l.Fragment,{children:(0,W.jsx)(De.Z,{type:O.Z.Y,style:d.scroller,ref:i,children:(0,W.jsx)(Re.O,{displayName:"CompletionPopupContent",disabled:!0,children:(0,W.jsx)(Ue.Z,{store:t,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0})})})})}const He=_e.Ds((e=>{e.scrollToBottom({animate:!0})}),60);var Oe=n(763594),We=n(654497),Ke=n(942402);const $e="/help/guides/using-notion-ai#what-are-the-current-limitations-of-notion-ai";function ze(){const e=(0,l.useCallback)((()=>{window.open($e)}),[]),t=(0,f.yK)((e=>({icon:{width:12,height:12,fill:e.lightIconColor,marginLeft:2},link:{color:e.lightTextColor,fontWeight:500}})),[]);return(0,W.jsxs)(W.Fragment,{children:[(0,We.t)(t.icon),(0,W.jsx)(oe.Z,{isSecondaryColor:!0,isSmall:!0,children:(0,W.jsx)(y.FormattedMessage,{id:"completions.AiWarning.warning",defaultMessage:"AI responses can be inaccurate or misleading."})}),(0,W.jsx)(oe.Z,{isSmall:!0,children:(0,W.jsx)(Ke.Z,{onClick:e,style:t.link,disableHover:!0,disableUnderline:!0,children:(0,W.jsx)(y.FormattedMessage,{id:"completions.AiWarning.learnMore",defaultMessage:"Learn more"})})})]})}var Je=n(200935),qe=n(781570),Ge=n(480671),Ye=n(44041),Xe=n(88893),Qe=n(535057),et=n(288280);function tt(){const e=(0,p.O7)(),t=(0,m.VK)((()=>e.device.isMobile),[e]),n=(0,m.VK)((()=>{const e=et.subscriptionDataStoreInstance.state;return Xe.GJ(e)}),[]),o=(0,l.useCallback)((()=>{t?Ge.k2("ai"):Ye.y(e,{from:"ai_upsell_notice",for:(0,Qe.zt)(),addOnFeature:"ai"})}),[e,t]),i=(0,f.yK)((e=>({upsellIcon:{width:14,height:14,fill:e.lightIconColor},upsellLink:{color:e.blueColor,fontWeight:500}})),[]);return(0,W.jsxs)(W.Fragment,{children:[(0,qe.T)(i.upsellIcon),(0,W.jsxs)(oe.Z,{isSecondaryColor:!0,isSmall:!0,children:[(0,W.jsx)(y.FormattedMessage,{id:"UpsellNotice.label",defaultMessage:"All free AI responses have been used for this workspace."}),!n&&(0,W.jsxs)(W.Fragment,{children:[" ",(0,W.jsx)(y.FormattedMessage,{id:"UpsellNotice.contactWorkspaceOwner.label",defaultMessage:"Contact your workspace owner to add Notion AI."})]})]}),n&&(0,W.jsx)(W.Fragment,{children:(0,W.jsx)(oe.Z,{isSmall:!0,children:(0,W.jsx)(Ke.Z,{onClick:o,style:i.upsellLink,disableHover:!0,disableUnderline:!0,children:(0,W.jsx)(y.FormattedMessage,{id:"UpsellNotice.link.label",defaultMessage:"Go unlimited"})})})})]})}const nt=!1;function ot(e){const{state:t}=e,n=(0,p.O7)(),o=(0,m.VK)((()=>n.device.isPhone),[n]),i=(0,f.yK)((e=>({wrapper:{background:"dark"===e.mode?e.accentColors.gray[100]:e.accentColors.gray[30],display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0 12px",borderTop:`1px solid ${e.lightDividerColor}`,gap:8,color:e.lightTextColor,fontSize:12,minHeight:36},noticeContent:{display:"flex",alignItems:"center",gap:8},actionContent:{display:"flex",alignItems:"center"}})),[]),s=(0,m.VK)((()=>!Oe.Z.state),[]);if(o)return null;let r,a;return(s||nt)&&(r=(0,W.jsx)(tt,{})),"results"!==t.stage||t.loading||(r=r??(0,W.jsx)(ze,{}),a=(0,W.jsx)(Je.u,{revision:(0,j.xM)(t)})),r?(0,W.jsxs)("div",{style:i.wrapper,children:[(0,W.jsx)("div",{style:i.noticeContent,children:r}),a&&(0,W.jsx)("div",{style:i.actionContent,children:a})]}):null}const it=(0,y.defineMessages)({writeInputPlaceholder:{defaultMessage:"Ask AI to write anything…",id:"completions.PromptMenu.alternativeUiWriteInputPlaceholder"},editInputPlaceholder:{defaultMessage:"Ask AI to edit or generate…",id:"completions.PromptMenu.alternativeUiEditInputPlaceholder"}});function st(e){const{state:t,onDismiss:n,onCompletionRetry:o,onCompletionStop:i,temporaryListStore:s,favoriteEditingState:r}=e,a=(0,l.useRef)(null);(0,l.useEffect)((()=>{Ce.w()}),[]);const c=(0,p.O7)(),d=(0,m.VK)((()=>c.device.isPhone),[c]),u=(0,f.yK)((e=>({icon:{height:18,width:18,paddingLeft:d?0:4,marginLeft:d?-4:void 0,fill:"dark"===e.mode?e.accentColors.purple[600]:e.accentColors.purple[400]},outer:{width:"100%",minHeight:d?44:36,padding:d?"2px 16px 2px 16px":"2px 12px 2px 8px",display:"flex",flexDirection:"column",justifyContent:"center",gap:2,fontSize:d?16:14}})),[d]),g=(0,W.jsx)("div",{style:{height:36,alignItems:"center",display:"flex"},children:(0,_.t)(u.icon)});return"active"===r.type?(0,W.jsx)("div",{style:u.outer,ref:a,children:(0,W.jsxs)("div",{style:{display:"flex",gap:8,width:"100%"},children:[g,(0,W.jsx)(Me,{state:r,inputRef:e.inputRef,sessionId:t.aiSessionId})]})}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)("div",{style:u.outer,ref:a,children:[s&&(0,W.jsx)(Ve,{temporaryListStore:s,isLoading:"results"===t.stage&&t.loading}),(0,W.jsxs)("div",{style:{display:"flex",gap:8,width:"100%"},children:[g,"initialPrompt"===t.stage||"initialPromptForAIBlock"===t.stage?(0,W.jsx)(rt,{...e,paletteMode:(0,de.rR)(t)}):t.loading?(0,W.jsx)(Ze,{onDismiss:n,state:t,onRetry:o,onStop:i}):(0,W.jsx)(Ne,{...e})]})]}),(0,W.jsx)(ot,{state:t})]})}function rt(e){const{query:t,onSubmit:n,paletteMode:o}=e,i=(0,de.bJ)(),s=(0,y.useIntl)(),r="edit"===o?s.formatMessage(it.editInputPlaceholder):s.formatMessage(it.writeInputPlaceholder),a=t.trim().length>0;return(0,W.jsx)(je.g,{...e,inputPlaceholder:r,children:(0,W.jsx)("div",{style:i.inputActions,children:(0,W.jsx)(Fe.O,{onSubmit:n,canSend:a})})})}var at=n(888202);function lt(e){const{sections:t,onCloseParentMenu:n,context:o,menuListStore:i}=e,s=(0,l.useCallback)((e=>{e.closeParentMenu&&n()}),[n]),r=(0,p.O7)(),a=(0,m.VK)((()=>r.device.isPhone),[r]);return(0,W.jsx)(te.Z,{menuType:a?se.og.ActionSheet:se.og.Popup,width:"100%",maxHeight:a?"min(17vh, 160px)":"min(40vh, 320px)",maxWidth:"100%",children:(0,W.jsx)(X.Z,{menuListStore:i,sections:t,onAccept:s,initialFocus:0,context:o})})}n(21703);var ct=n(151454),dt=n(869454),ut=n(677794),pt=n(618574);function mt(e){const{children:t,scrollerStore:n,openState:o,flushWithBottom:i}=e,[s,r]=(0,l.useState)(Date.now()),a=(0,l.useRef)(null),[c,d]=(0,l.useState)(void 0),u=(0,l.useCallback)((()=>r(Date.now())),[]),{WindowSizeStore:f}=(0,p.O7)();(0,l.useEffect)((()=>{const e=new ut.E,t=a.current;if(!t)throw new Error("ref.current is null");e.observe(t);let n=t.getBoundingClientRect().top;e.rect.addListener((e=>{n=e.state.top,d(e.state)}));const o=setInterval((()=>{const o=t.getBoundingClientRect().top;o!==n&&(n=o,e.recompute())}),50);return()=>{e.destroy(),clearInterval(o)}}),[]);const g="results"===o.stage&&!o.loading,h=("results"===o.stage||"initialPrompt"===o.stage)&&"cursor"===o.context.type,y=(0,m.VK)((()=>{const e=(0,de.$b)(o);if(!e)return;const t=(0,j.wA)(e);if(!t)return;if(!c)return;const n=t.bottom-c.top;return n>0?n:void 0}),[o,c]);(0,l.useEffect)((()=>{if(Date.now()-s>500)return;if(!y)return;const e=(0,pt.Si)(n);e&&(0,pt.z5)(y,e)}),[y,n,s]),(0,l.useEffect)((()=>{g&&h&&u()}),[g,h,u]);const x="results"===o.stage&&o.loading,C=(0,v.D9)(x),[S,k]=(0,l.useState)();(0,l.useEffect)((()=>{C&&!x&&k(Date.now())}),[x,C]),(0,l.useEffect)((()=>{const e=!!S&&Date.now()-S<1e3;(x||e)&&h&&y&&u()}),[h,x,u,y,S]);const b=(0,m.VK)((()=>{const e=dt.Z.state.phase===dt.i.hidden||dt.Z.state.phase===dt.i.willHide,t=dt.Z.estimatedNativeWebBottomOverlap()+(i?0:pt.aX.bottom);return e?f.getSafePaddingBottomPx(t):t}),[f,i]);return(0,W.jsx)("div",{ref:a,style:{position:"absolute",bottom:b,left:i?0:pt.aX.left,right:i?0:pt.aX.left,zIndex:ct.Mo},children:t})}const ft="notion-alternate-ai-ui";function gt(e){const{scrollerStore:t}=e,n=(0,p.O7)(),o=(0,m.VK)((()=>N.default.state),[]);(0,E.w9)(o);const i=(0,l.useMemo)((()=>(0,de.RR)(o)),[o]),s=(0,m.VK)((()=>i&&(0,de.$b)(i)),[i]),r=(0,m.VK)((()=>n.device.isPhone),[n]);return i?t!==(null==s?void 0:s.scrollerStore)?null:"assistantCompletionPopup"===i.type?r?(0,W.jsx)(mt,{scrollerStore:t,openState:i,flushWithBottom:!0,children:(0,W.jsx)(w.LazyAssistantWriterPopup,{completionState:i})}):(0,W.jsx)(pt.TS,{scrollerStore:t,openState:i,children:(0,W.jsx)(w.LazyAssistantWriterPopup,{completionState:i})}):r?(0,W.jsx)(mt,{scrollerStore:t,openState:i,children:(0,W.jsx)(vt,{openState:i})}):(0,W.jsx)(pt.TS,{scrollerStore:t,openState:i,children:(0,W.jsx)(vt,{openState:i})}):null}function vt(e){const{openState:t}=e,n=(0,p.O7)(),o=(0,y.useIntl)(),r=(0,l.useState)(function(e){switch(e.stage){case"results":return"";case"initialPromptForAIBlock":return e.prompt??e.prefilledValue;case"initialPrompt":return e.prefilledValue;default:return(0,C.t1)(e)}}(t))[0],[a,w]=function(e){const t=(0,y.useIntl)(),[n,o]=(0,l.useState)(""),i=(0,m.VK)((()=>{if("initialPromptForAIBlock"!==e.stage||!(0,j.dU)())return n;const o=e.store.getTitleValue();return(0,h.X)({intl:t,textValue:o,getRecordModel:e.store.getRecordModel,userTimeZone:(0,g.r)()})}),[n,t,e]);return[i,o]}(t),[_,R]=(0,l.useState)(!1),[D,U]=(0,l.useState)(!1),[V,H]=(0,l.useState)(""),O=(0,z.mY)(),$=(0,l.useRef)(null),J=(0,de.rR)(t),q=(0,l.useMemo)((()=>({environment:n,blocks:[],publicEditMode:void 0})),[n]);(0,E.lZ)(t);const G=(0,l.useCallback)((e=>{k.ov(n,{session_id:t.aiSessionId,type:e.analyticsName,gtm_favorite_id:e.gtmFavoriteId}),w(e.insertText),i.maybeSetPromptForCurrentAiBlock(n,e.insertText),e.executeImmediately&&R(!0),$.current&&$.current.focusInput()}),[t.aiSessionId,n,w]),Y="results"===t.stage?(0,j.xM)(t).completion:void 0,X=(0,v.Z_)(Y,i.COMPLETION_THROTTLE,x.Z),Q="results"===t.stage?t:void 0,ee=(0,L.XJ)(A.FF.markdownLinkifyIt),te=(0,L.XJ)(A.FF.tinyMceMicrosoftWordPasteFilter),ne=(0,l.useMemo)((()=>{if(!Q||"textSelection"!==Q.context.type&&"blockSelection"!==Q.context.type)return;if(["idle","pending"].includes(ee.status)||["idle","pending"].includes(te.status))return;const{userSearchCache:e}=(0,j.xM)(Q);return X?c.Z.withListenerIgnored((()=>{const t=new d.Z({name:"CompletionPopup.PopupContent",isTemporaryData:!0}),o=I.createAndCommit({userAction:"CompletionPopup.temporarymarkdownToBlocks",environment:n,canUndo:!1,perform:o=>{const s=b.Mt({environment:n,text:X,inMemoryRecordCache:t,transaction:o,markdownOptions:(0,F.N9)(e),markdownLinkifyIt:ee.value,tinyMceMicrosoftWordPasteFilter:te.value,useCrdt:!1});if(s)return i.postProcessAICreatedStores(n,s),i.wrapTemporaryBlocksInList({environment:n,stores:s,inMemoryRecordCache:t,transaction:o})}}).performResult;return t.addCacheFallback(n.defaultRecordCache.inMemoryRecordCache),o})):void 0}),[Q,X,n,ee,te]),oe=(0,m.VK)((()=>{if(!ne||!Q||"completionPopup"!==Q.type||"results"!==Q.stage||"textSelection"!==Q.context.type&&"blockSelection"!==Q.context.type)return;return Q.context.stores.every((e=>{const t=e.getType();return!!t&&("blockSelection"===Q.context.type?Boolean(T.d[t]):"textSelection"===Q.context.type&&Boolean(T.D[t]))}))}),[Q,ne]);let ie=!0,se=!1;switch(t.stage){case"initialPrompt":if(t.futureRevisions.length>0)break;case"initialPromptForAIBlock":ie=!1;break;case"results":t.loading||"cursor"!==t.context.type||""!==a||(se=!0);break;default:(0,C.t1)(t)}const re=function(e){const{environment:t,sessionId:n}=e,{value:o}=(0,L.XJ)(A.FF.markdownLinkifyIt),{value:s}=(0,L.XJ)(A.FF.tinyMceMicrosoftWordPasteFilter),r=(0,l.useCallback)((e=>{let{exitType:r,selectInsertion:a}=e;const l=N.default.state;"completionPopup"!==l.type||"results"!==l.stage||l.loading||(k.HC(t,{session_id:n,inference_id:(0,j.xM)(l).inferenceId,exit_type:r}),I.createAndCommit({userAction:"CompletionPopup.handleAccept",environment:t,perform:e=>{i.acceptCursorCompletion({environment:t,transaction:e,selectInsertion:a,exitType:r,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:s})}}))}),[t,n,o,s]),a=(0,l.useCallback)((()=>{const e=N.default.state;"completionPopup"!==e.type||"results"!==e.stage||e.loading||((0,de.Tq)(t),k.HC(t,{session_id:n,inference_id:(0,j.xM)(e).inferenceId,exit_type:"insert"}),"textSelection"===e.context.type?I.createAndCommit({userAction:"CompletionPopup.handleInsert",environment:t,perform:e=>{i.insertTextSelectionCompletion({environment:t,transaction:e,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:s})}}):"blockSelection"===e.context.type&&I.createAndCommit({userAction:"CompletionPopup.handleInsert",environment:t,perform:e=>{i.insertBlockSelectionCompletion({environment:t,transaction:e,replace:!1,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:s})}}))}),[t,n,o,s]),c=(0,l.useCallback)((()=>{const e=N.default.state;"completionPopup"!==e.type||"results"!==e.stage||e.loading||"textSelection"!==e.context.type&&"blockSelection"!==e.context.type||((0,de.Tq)(t),k.HC(t,{session_id:n,inference_id:(0,j.xM)(e).inferenceId,exit_type:"replace"}),"textSelection"===e.context.type?I.createAndCommit({userAction:"CompletionPopup.handleReplace.textSelection",environment:t,perform:e=>{i.replaceTextSelectionCompletion({environment:t,transaction:e,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:s})}}):"blockSelection"===e.context.type&&I.createAndCommit({userAction:"CompletionPopup.handleReplace.blockSelection",environment:t,perform:e=>{i.insertBlockSelectionCompletion({environment:t,transaction:e,replace:!0,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:s})}}))}),[t,n,o,s]);return(0,l.useMemo)((()=>({onAccept:r,onInsert:a,onReplace:c})),[r,a,c])}({environment:n,sessionId:t.aiSessionId});(0,l.useEffect)((()=>{w(r),$.current&&$.current.focusInput()}),[r,w]);const ae="results"===t.stage&&t.hasErrored,le=(0,v.D9)(ae),ue=ae&&!le,pe=(0,l.useCallback)((e=>{const{purgeFromHistory:t}=e,s=i.revertCurrentCompletionRevision({environment:n,purgeFromHistory:t});s&&"followup"===s.type&&(w((0,at.Dp)(o,s.improvement)),$.current&&$.current.focusInput())}),[n,o,w]),ge=(0,l.useCallback)((()=>{"results"===t.stage&&(i.revertCurrentCompletionRevision({environment:n,purgeFromHistory:!1}),$.current&&$.current.focusInput())}),[t,n]),ve=(0,l.useCallback)((()=>{"results"===t.stage&&(i.redoCompletionRevision(n),$.current&&$.current.focusInput())}),[n,t]);(0,l.useEffect)((()=>{if(!ue||"results"!==t.stage)return;const{aiSessionId:e}=t;if((0,j.sr)(t))return void pe({purgeFromHistory:!0});const o=(0,j.Iz)(t);i.doesPromptNeedAdditionalUserInput(o)?(w(V),(0,s.retryInitialPrompt)({environment:n})):i.cancelCompletion({environment:n,sessionId:e,inferenceId:o.inferenceId,exitType:"error_modal"})}),[n,ue,t,V,pe,w]);const he=(0,l.useCallback)((()=>{if("results"!==t.stage)return;const{aiSessionId:e}=t,o=(0,j.xM)(t);if((0,j.sr)(t))return k.Xw(n,{session_id:e,inference_id:o.inferenceId,is_reverting_follow_up_improvement:!0}),void pe({purgeFromHistory:!1});k.Xw(n,{session_id:e,inference_id:o.inferenceId,is_reverting_follow_up_improvement:!1});const r=(0,j.Iz)(t);i.doesPromptNeedAdditionalUserInput(r)?(w((0,j.gY)(r)),(0,s.retryInitialPrompt)({environment:n})):i.handleCompletionPopupRetry({environment:n})}),[n,t,pe,w]),Ce=(0,l.useCallback)((()=>{if("results"!==t.stage)return;if(!(0,j.xM)(t).completion)return(0,j.sr)(t)?void pe({purgeFromHistory:!0}):(w(V),void(0,s.retryInitialPrompt)({environment:n}));i.stopCompletion(n)}),[t,n,pe,V,w]),Se=(0,l.useCallback)((()=>{U(!1),u.default.afterNextFlush((()=>{$.current&&$.current.focusInput()}))}),[]),ke=(0,l.useCallback)((()=>{switch(t.stage){case"initialPromptForAIBlock":k.HC(n,{session_id:t.aiSessionId,inference_id:void 0,exit_type:"accept"}),(0,s.closeInitialPromptAndEndSession)(n);break;case"initialPrompt":w(""),(0,s.closeInitialPromptButContinueSession)(n);break;case"results":break;default:(0,C.t1)(t)}}),[t,n,w]),be=(0,l.useCallback)((e=>{switch((0,de.Tq)(n),U(!1),t.stage){case"initialPrompt":case"initialPromptForAIBlock":k.HC(n,{session_id:t.aiSessionId,inference_id:void 0,exit_type:e}),(0,s.closeInitialPromptAndEndSession)(n);break;case"results":i.cancelCompletion({environment:n,sessionId:t.aiSessionId,inferenceId:(0,j.xM)(t).inferenceId,exitType:e});break;default:(0,C.t1)(t)}}),[t,n]),Ie=(0,l.useCallback)((()=>be("cancel")),[be]),we=(0,l.useCallback)((()=>{"active"!==O.type?se?re.onAccept({exitType:"click_outside_window_accept",selectInsertion:!0}):ie?U(!0):be("click_outside_window_cancel"):(0,z.bi)({state:O})}),[O,se,re,be,ie]),Me=(0,m.VK)((()=>(0,j.dU)()),[]);(0,l.useEffect)((()=>{function e(e){return!!(e instanceof Element&&(e.closest(`.${ft}`)||e.closest(`.${P.YPt}`)||e.closest(`.${P.p4m}`)||e.closest(`.${P.zov}`)))}function t(t){Me||!e(t.target)&&e(t.relatedTarget)&&t.relatedTarget instanceof HTMLElement&&t.relatedTarget.focus()}function n(t){e(t.target)||("click"!==t.type&&"contextmenu"!==t.type||we(),Me||(t.preventDefault(),t.stopPropagation()))}if(!D)return window.addEventListener("focus",t,!0),window.addEventListener("click",n,!0),window.addEventListener("contextmenu",n,!0),window.addEventListener("mousedown",n,!0),window.addEventListener("mouseup",n,!0),window.addEventListener("mouseover",n,!0),window.addEventListener("mouseout",n,!0),window.addEventListener("mouseenter",n,!0),window.addEventListener("mouseleave",n,!0),window.addEventListener("mousemove",n,!0),()=>{window.removeEventListener("focus",t,!0),window.removeEventListener("click",n,!0),window.removeEventListener("contextmenu",n,!0),window.removeEventListener("mousedown",n,!0),window.removeEventListener("mouseup",n,!0),window.removeEventListener("mouseover",n,!0),window.removeEventListener("mouseout",n,!0),window.removeEventListener("mouseenter",n,!0),window.removeEventListener("mouseleave",n,!0),window.removeEventListener("mousemove",n,!0)}}),[we,D,Me]);const Ae=(0,l.useCallback)((e=>{H(a),w(""),i.improveCompletion(n,e)}),[n,a,w]),Pe=(0,l.useCallback)((()=>{switch(t.stage){case"initialPrompt":(0,s.closeInitialPromptButContinueSession)(n),H(a),w(""),(0,S.Hh)({environment:n,inputValue:a,from:t.from,mode:J});break;case"initialPromptForAIBlock":k.HC(n,{session_id:t.aiSessionId,inference_id:void 0,exit_type:"accept"}),(0,s.closeInitialPromptAndEndSession)(n),H(a),w(""),(0,S.F0)({environment:n,inputValue:a,store:t.store});break;case"results":Ae({type:"helpMeEdit",prompt:a});break;default:(0,C.t1)(t)}}),[a,J,t,n,Ae,w]);(0,l.useEffect)((()=>{_&&(R(!1),Pe())}),[_,Pe]);let je="insert";"results"===t.stage&&"cursor"===t.context.type?je="accept":oe&&(je="replace");const Fe=(0,m.VK)((()=>t?(0,at.o_)({environment:n,intl:o,filter:a,state:t,from:t.from,favoriteEditingState:O,onUpdatePromptState:G,onImprove:Ae,context:q,completionResultInfo:{...re,onRetry:he,onSubmit:Pe,onCancel:Ie,defaultAction:je}}):[]),[O,q,n,G,Pe,Ae,a,o,t,re,he,Ie,je]),Te=Fe.length>0,Le=(0,l.useMemo)((()=>new B.Z),[]);(0,l.useEffect)((()=>{Le.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})}),[a,Le]);const Ne=(0,m.VK)((()=>n.device.isPhone),[n]),Be=(0,f.yK)((e=>({mainPopup:{borderRadius:6,background:e.popoverBackground,boxShadow:e.mediumBoxShadow,overflow:"hidden",isolation:"isolate"},menuPopup:{marginTop:4,marginBottom:4,borderRadius:6,background:e.popoverBackground,boxShadow:e.mediumBoxShadow,width:Ne?"100%":320,overflow:"hidden",isolation:"isolate"}})),[Ne]),Ee=(0,l.useRef)(null);let Ze;"active"===O.type?Ze=(0,W.jsx)("div",{style:Be.menuPopup,ref:Ee,className:ft,children:(0,W.jsx)(ce,{sessionId:t.aiSessionId,state:O,context:q})}):Te&&(Ze=(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("div",{style:Be.menuPopup,ref:Ee,className:ft,children:(0,W.jsx)(lt,{sections:Fe,onCloseParentMenu:ke,context:q,menuListStore:Le})}),(0,W.jsx)(Z.gl,{originRef:Ee,openState:t,isInputEmpty:!a})]}));const _e=(0,l.useRef)(null),Re=function(e){const{openState:t,undoRevision:n,redoRevision:o}=e,i=(0,p.O7)(),s=(0,y.useIntl)(),r=(0,m.VK)((()=>me.default.checkGate({gateName:"ai_multi_level_undo"})),[]),a=(0,l.useCallback)((()=>{n(),xe(i,"undo")}),[i,n]),c=(0,l.useCallback)((()=>{o(),xe(i,"redo")}),[i,o]);if("results"!==t.stage||!r)return ye;const d=t.revisions.length,u=t.futureRevisions.length,f=d+u,g=d;return 1===f?ye:{onUndo:d>1?a:void 0,onRedo:u>0?c:void 0,historyLabel:s.formatMessage(fe.historyLabel,{currentRevision:g.toString(),totalRevisions:f.toString()})}}({openState:t,undoRevision:ge,redoRevision:ve});return Me?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(M.Z,{debugName:"CompletionPopup",capture:!0,onEsc:we}),Ze]}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(M.Z,{debugName:"CompletionPopup",capture:!0,onEsc:we}),Ne&&Ze,(0,W.jsx)(Z.RD,{originRef:_e,openState:t}),(0,W.jsx)("div",{ref:_e,className:ft,style:Be.mainPopup,children:(0,W.jsx)(st,{state:t,onDismiss:we,onCompletionRetry:he,onCompletionStop:Ce,query:a,setQuery:w,onSubmit:Pe,submitOnEnter:!Te&&!D,inputRef:$,temporaryListStore:ne,favoriteEditingState:O,...Re})}),!Ne&&Ze,(0,W.jsx)(K,{open:D,onConfirmExit:Ie,onCancelExit:Se})]})}var ht=n(619584),yt=n(402551),xt=n(728495);function Ct(e){const t=(0,p.O7)(),n=(0,m.VK)((()=>"completionPopup"===N.default.state.type||xt.d.state.open),[]),o=(0,m.VK)((()=>{var e;return null===(e=re.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),s=(0,l.useCallback)((async()=>{o&&await i.updateAiEligibility(t,o)}),[t,o]),r=n?30*ht.C0:30*ht.hM;return(0,yt.W)(s,r,!1),null}},76095:(e,t,n)=>{n.d(t,{Mi:()=>F,YX:()=>I,bi:()=>N,m5:()=>T,mY:()=>A,ny:()=>L});n(757658);var o=n(667294),i=n(886628),s=n(966673),r=n(950780),a=n(709291),l=n(653965),c=n(401898),d=n(646564),u=n(62967),p=n(10910),m=n(547307),f=n(164964),g=n(210228),v=n(573063),h=n(672495),y=n(645010),x=n(80444),C=n(319385),S=n(630793),k=n(271184),b=n(785893);const I="favorite-actions",w=100,M=(0,a.defineMessages)({favoriteActions:{defaultMessage:"Favorites",id:"ai.favoriteActions.title"},editOrShareFavorite:{defaultMessage:"Edit or share favorite",id:"ai.favoriteActions.editOrShare"}});function A(){const[e,t]=(0,o.useState)(void 0),n=(0,i.VK)((()=>C.default.checkGate({gateName:"ai_favorites"})),[]);return function(e){const t=(0,s.D9)(e);(0,o.useEffect)((()=>{e!==t&&y.Z.MenuScroller&&y.Z.MenuScroller.scrollToTop()}),[e,t])}(Boolean(e)),(0,o.useMemo)((()=>n?e?{type:"active",current:e,set:t,clear:()=>t(void 0)}:{type:"inactive",set:t}:{type:"disabled"}),[e,n])}const P={maxWidth:400,whiteSpace:"pre-wrap"};function j(e){const{value:t}=e;return(0,b.jsx)("div",{style:P,children:(0,b.jsx)("div",{children:t.action.prompt})})}function F(e,t,n,o,i){const s=i.filterOut.toLocaleLowerCase().trim(),a=(0,k.JS)(o),l=[];for(const u of a){if(u.action.prompt.toLocaleLowerCase().trim()===s)continue;const o=o=>(0,b.jsxs)("div",{style:{display:"flex"},children:[(0,b.jsx)(v.Z,{style:{visibility:o.focused?"visible":"hidden",width:18,height:18},onClick:()=>{i.favoriteEditingState.set(u),p.Vo(e,{type:"edit",session_id:t.aiSessionId,gtm_favorite_id:u.gtmFavoriteId})},icon:r.E,ariaLabel:n.formatMessage(M.editOrShareFavorite)}),!u.executeImmediately&&(0,b.jsx)(d.xj,{type:"updatePrompt",focused:o.focused})]});let a=!1;switch(u.action.type){case"helpMeEdit":"initialPrompt"!==t.stage||"blockSelection"!==t.context.type&&"textSelection"!==t.context.type||(a=!0);break;case"helpMeWrite":"initialPromptForAIBlock"!==t.stage&&"cursor"!==t.context.type||(a=!0);break;default:(0,c.t1)(u.action)}if(a){const e=(0,d.cK)({key:u.id,name:u.name,textToInsert:u.action.prompt,analyticsName:"favoriteAction",gtmFavoriteId:u.gtmFavoriteId,onUpdatePromptState:i.onUpdatePromptState,right:o,renderTooltip:()=>(0,b.jsx)(j,{value:u}),userProvidedSearchName:`${u.name} ${u.action.prompt}`.slice(0,w),executeImmediately:u.executeImmediately});l.push(e)}}return[(0,u.$J)({key:I,title:M.favoriteActions,render:e=>(0,b.jsx)(h.Z,{...e}),actions:l})]}function T(e){const{state:t,environment:n,sessionId:o}=e,{currentUserSettingsStore:i}=x.default.state;i&&(t.current.name?(g.createAndCommit({userAction:"favoriteActions.saveFavoriteEditsAndClearState",environment:n,perform(e){(0,k.gC)(t.current,i,e)}}),t.clear(),p.Vo(n,{type:"save",session_id:o,gtm_favorite_id:t.current.gtmFavoriteId})):f.oV({label:(0,b.jsx)(a.FormattedMessage,{defaultMessage:"Please enter a name for the action.",id:"ai.favoriteActions.nameRequiredMessage"})}))}function L(e){const{state:t,environment:n}=e,{currentUserSettingsStore:o}=x.default.state;o&&(t.current.name||g.createAndCommit({userAction:"favoriteActions.cancelFavoriteEditsAndClearState",environment:n,perform(e){(0,k.QC)(t.current,o,e),(0,S.Nv)(t.current.action,o,e)}}),t.clear())}async function N(e){const{state:t}=e,{currentUserSettingsStore:n}=x.default.state;if(n){const e=(0,k.JS)(n).filter((e=>e.id===t.current.id));if(e.length>0&&l.Xy(t.current,e[0]))return void t.clear()}await m.confirmUserAction({message:(0,b.jsx)(a.FormattedMessage,{defaultMessage:"Are you sure you want to stop editing your favorite? Unsaved changes will be lost.",id:"ai.favoriteActions.cancelConfirmation"}),acceptLabel:(0,b.jsx)(a.FormattedMessage,{defaultMessage:"Discard changes",id:"ai.favoriteActions.cancelConfirmation.discardChanges"}),cancelLabel:(0,b.jsx)(a.FormattedMessage,{defaultMessage:"Go back",id:"ai.favoriteActions.cancelConfirmation.goBack"})})&&t.clear()}},616859:(e,t,n)=>{n.d(t,{d:()=>T});var o=n(667294),i=n(800480),s=n(709291),r=n(573063),a=n(953437),l=n(526388),c=n(825464),d=n(200935),u=n(724405),p=n(964275),m=n(781570),f=n(83065),g=n(137810),v=n(164921),h=n(260458),y=n(301743),x=n(374194),C=n(316354),S=n(158297),k=n(164369),b=n(942402),I=n(843250),w=n(918514),M=n(785893);function A(e){const{checked:t,onChange:n}=e;return(0,M.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[(0,M.jsx)(h.Z,{checked:t,onClick:n,size:14}),(0,M.jsx)("div",{onClick:n,children:(0,M.jsx)(k.Z,{style:{cursor:"pointer"},isSmall:!0,children:(0,M.jsx)(s.FormattedMessage,{defaultMessage:"Share this AI session with Notion",id:"completions.FeedbackPopup.shareWithNotion"})})})]})}function P(){const e=(0,u.yK)((e=>({container:{display:"flex",flexDirection:"row"},giftIcon:{width:16,height:16,fill:e.lightIconColor},message:{marginLeft:9,color:e.mediumTextColor,fontSize:12}})),[]);return(0,M.jsxs)("div",{style:e.container,children:[(0,m.T)(e.giftIcon),(0,M.jsx)("div",{style:e.message,children:(0,M.jsx)(s.FormattedMessage,{defaultMessage:"You’re sharing data with Notion for AI quality improvement. <aiTerms>Learn more</aiTerms>",id:"completions.OptInLearnMore.description",values:{aiTerms:e=>(0,M.jsx)(b.Z,{external:!0,href:(0,w.UY)("ai.dataSharingTerms"),children:e})}})})]})}function j(e){const{onSubmit:t}=e,n=(0,u.yK)((e=>({container:{width:300,display:"flex",flexDirection:"column",alignItems:"center",padding:19,position:"relative"},closeButtonContainer:{position:"absolute",top:10,right:10},closeButton:{zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",background:e.buttonHoveredBackground,width:20,height:20,padding:4},closeButtonHover:{background:e.buttonPressedBackground},closeButtonIcon:{width:16,fill:e.mediumTextColor},giftIcon:{width:24,height:24,fill:e.lightIconColor},terms:{color:e.mediumTextColor,textAlign:"center",fontSize:13},shareButton:{width:"100%",marginTop:17,paddingTop:7,paddingBottom:7},notNowButton:{color:e.mediumTextColor,fontSize:14,marginTop:15},title:{textAlign:"center",marginTop:9,marginBottom:8,fontWeight:g.Z.fontWeight.semibold}})),[]);return(0,M.jsxs)("div",{style:n.container,children:[(0,M.jsx)("div",{style:n.closeButtonContainer,children:(0,M.jsx)(v.Z,{onClick:()=>{t({optIn:!1})},style:n.closeButton,hoveredStyle:n.closeButtonHover,children:(0,p.D)(n.closeButtonIcon)})}),(0,m.T)(n.giftIcon),(0,M.jsx)("div",{style:n.title,children:(0,M.jsx)(s.FormattedMessage,{defaultMessage:"Always share data to improve Notion AI?",id:"completions.ShareDataPopup.title"})}),(0,M.jsx)("div",{style:n.terms,children:(0,M.jsx)(s.FormattedMessage,{defaultMessage:"Help Notion improve AI quality by automatically sharing data from your usage of AI powered features.{br}By continuing, you agree to <aiTerms>AI Data Sharing Terms</aiTerms>",id:"completions.ShareDataPopup.description",values:{br:(0,M.jsx)("br",{}),aiTerms:e=>(0,M.jsx)(b.Z,{external:!0,href:(0,w.UY)("ai.dataSharingTerms"),children:e})}})}),(0,M.jsx)(S.Z,{style:n.shareButton,onClick:()=>{t({optIn:!0})},children:(0,M.jsx)(s.FormattedMessage,{defaultMessage:"Always share",id:"completions.ShareDataPopup.alwaysShareButton"})}),(0,M.jsx)(C.Z,{style:n.notNowButton,onClick:()=>{t({optIn:!1})},children:(0,M.jsx)(s.FormattedMessage,{defaultMessage:"Not now",id:"completions.ShareDataPopup.notNowButton"})})]})}function F(e){const{state:t,onUpdate:n,onSubmit:a,onCancel:l,userOptIn:c}=e,d=(0,o.useCallback)((()=>{n({...t,shareWithNotion:!t.shareWithNotion})}),[t,n]),u=(0,o.useCallback)((()=>{a(t)}),[a,t]),p=(0,o.useCallback)((e=>{n({...t,userContent:e.target.value})}),[n,t]),m=(0,s.useIntl)(),g=(0,i.O7)(),v=!c;return(0,M.jsx)("div",{style:{padding:14,...g.device.isMobile?{width:"100%"}:{minWidth:400}},className:I.YOJ,children:(0,M.jsxs)(y.Z,{debugName:"FeedbackPopup",capture:!0,children:[(0,M.jsx)(x.Z,{value:t.userContent,onChange:p,onSubmit:e=>{e.stopPropagation(),u()},onCancel:l,focusInitial:!0,placeholder:m.formatMessage({id:"completions.FeedbackPopup.userCommentPlaceholder",defaultMessage:"How could the output be improved? (optional)"})}),(0,M.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingTop:10},children:[v?(0,M.jsx)(A,{checked:t.shareWithNotion,onChange:d}):(0,M.jsx)(P,{}),(0,M.jsx)(r.Z,{icon:f._,onClick:u,ariaLabel:m.formatMessage({id:"completions.FeedbackPopup.submitButtonLabel",defaultMessage:"Submit feedback"}),isBlue:!0,iconStyle:{height:24,width:24},style:{height:20,width:20}})]})]})})}function T(e){const{type:t,ariaLabel:n,onClick:u,feedbackState:p,onDismiss:m,onSubmit:f,onUpdate:g,showShareDataPopup:v,onDataShareSubmit:h,userOptIn:y,iconButtonStyles:x}=e,C=(0,i.O7)(),S=t===(null==p?void 0:p.type),k=(0,d.L)(t,S),b=(0,o.useCallback)((()=>u(t)),[u,t]),I=(0,M.jsx)(l.Z,{renderTooltip:()=>(0,M.jsx)("div",{children:(0,M.jsx)(s.FormattedMessage,{defaultMessage:"Share feedback with Notion",id:"completions.CompletionMenuActionBar.feedbackTooltip"})}),placement:c.u.Bottom,render:e=>(0,M.jsx)(r.Z,{onClick:b,icon:k,ariaLabel:n,style:{...x},...e})});return(0,M.jsx)(a.ZP,{origin:I,open:(null==p?void 0:p.type)===t,popupType:C.device.isMobile?a.kQ.SlideUp:a.kQ.Popup,onDismiss:m,render:()=>p?v?(0,M.jsx)(j,{onCancel:m,onSubmit:h}):(0,M.jsx)(F,{state:p,onSubmit:f,onUpdate:g,onCancel:m,userOptIn:y}):null})}},200935:(e,t,n)=>{n.d(t,{L:()=>b,u:()=>I});var o=n(667294),i=n(800480),s=n(886628),r=n(633676),a=n(297022),l=n(439986),c=n(310498),d=n(709291),u=n(10910),p=n(164964),m=n(210228),f=n(237181),g=n(80444),v=n(319385),h=n(535057),y=n(484654),x=n(616859),C=n(785893);const S=!0,k=!1;function b(e,t){switch(e){case"thumbsup":return t?c.w:l.P;case"thumbsdown":return t?a.E:r.A}}function I(e){const{revision:t}=e,n=(0,d.useIntl)(),r=(0,i.O7)(),[a,l]=(0,o.useState)(void 0),[c,b]=(0,o.useState)(!1),I=(0,o.useRef)(null),w=(0,s.VK)((()=>v.default.checkGate({gateName:"ai_data_sharing"})),[]),M=(0,s.VK)((()=>g.default.state.currentUserSettingsStore),[]),A=(0,s.VK)((()=>{var e;const t=null==M||null===(e=M.getSettings())||void 0===e?void 0:e.seen_ai_data_share_prompt_at,n=!(0,h.mq)();return!Boolean(t)&&n}),[M]),P=(0,s.VK)((()=>{var e;return(null==M||null===(e=M.getSettings())||void 0===e?void 0:e.ai_data_share_opt_in)??k}),[M]),j=(0,o.useCallback)((()=>{p.oV({label:n.formatMessage({id:"completions.CompletionMenuFooter.showFeedbackThanksMessage",defaultMessage:"Thanks for submitting feedback!"})})}),[n]),F=(0,o.useCallback)((e=>{I.current=document.activeElement,l((t=>({userContent:"",shareWithNotion:S,...t,type:e})))}),[]),T=(0,o.useCallback)((e=>{e.shareWithNotion&&A&&w?b(!0):(j(),l(void 0)),y.submitFeedbackForRevision({...e,environment:r,revision:t,userOptIn:P})}),[t,r,P,A,w,j]),L=(0,o.useCallback)((e=>{e&&e.stopPropagation&&e.stopPropagation(),l(void 0),I.current&&I.current instanceof HTMLElement&&I.current.focus()}),[]),N=(0,o.useCallback)((e=>{const{optIn:t}=e;M&&(m.createAndCommit({userAction:"FeedbackButtons.aiDataShareOptIn",environment:r,userId:M.id,perform:e=>{f.d2({userSettingsStore:M,data:{ai_data_share_opt_in:t,seen_ai_data_share_prompt_at:Date.now()},transaction:e})}}),u.bd(r,{user_opt_in:t}),t?p.oV({label:n.formatMessage({id:"completions.CompletionMenuFooter.dataShareThanks",defaultMessage:"Thank you for your help making Notion better!"})}):j(),b(!1),l(void 0))}),[n,M,r,j]);return t.hasFeedback&&!c?null:(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(x.d,{type:"thumbsup",ariaLabel:n.formatMessage({id:"completions.CompletionMenuFooter.thumbsUp",defaultMessage:"Submit positive feedback"}),onClick:F,feedbackState:a,onDismiss:L,onSubmit:T,onUpdate:l,showShareDataPopup:c,onDataShareSubmit:N,userOptIn:P}),(0,C.jsx)(x.d,{type:"thumbsdown",ariaLabel:n.formatMessage({id:"completions.CompletionMenuFooter.thumbsDown",defaultMessage:"Submit negative feedback"}),onClick:F,feedbackState:a,onDismiss:L,onSubmit:T,onUpdate:l,showShareDataPopup:c,onDataShareSubmit:N,userOptIn:P})]})}},438305:(e,t,n)=>{n.d(t,{g:()=>a});var o=n(667294),i=n(301743),s=n(374194),r=n(785893);function a(e){const{query:t,setQuery:n,onDismiss:a,onBlur:l,onFocus:c,onSubmit:d,inputRef:u,submitOnEnter:p,inputPlaceholder:m,style:f,selectAll:g=!0,children:v}=e,[h,y]=(0,o.useState)(void 0);return(0,r.jsxs)(i.Z,{debugName:"PromptOrActionInput",capture:!0,allowMenuList:!1,allowEsc:!0,children:[(0,r.jsx)(s.Z,{ref:u,format:s.B.Transparent,placeholder:m,selectAll:g,value:t,textarea:!0,textareaSubmitOnEnter:!0,autosize:!0,style:{minHeight:28,paddingTop:4,paddingBottom:4,...f},onBlur:l,onFocus:c,onSubmit:e=>{t&&p&&(e.stopPropagation(),null==d||d())},onChange:e=>{n(e.target.value)},onKeyUp:e=>{"Backspace"===e.key&&(""===h&&a(),y(void 0))},onKeyDown:e=>{"Backspace"===e.key&&void 0===h&&y(t)},focusInitial:!0}),v]})}},626174:(e,t,n)=>{n.d(t,{O:()=>m});n(667294);var o=n(800480),i=n(886628),s=n(83065),r=n(709291),a=n(573063),l=n(58261),c=n(526388),d=n(825464),u=n(457819),p=n(785893);function m(e){const{onSubmit:t,canSend:n}=e,m=(0,u.bJ)(),f=(0,o.O7)(),g=(0,i.VK)((()=>f.device.isPhone),[f]);return(0,p.jsx)(c.Z,{renderTooltip:()=>(0,p.jsxs)("div",{children:[(0,p.jsx)(r.FormattedMessage,{defaultMessage:"Send to AI",id:"completions.CompletionMenuActionBar.sendTooltip"}),(0,p.jsx)(l.Z,{style:m.keyboardShortcutInverted,name:"enter"})]}),placement:d.u.Bottom,render:e=>(0,p.jsx)(a.Z,{icon:s._,onClick:t,isPurple:n,disabled:!n,iconStyle:{height:g?24:20,width:g?24:20},ariaLabel:"Send to AI",style:{pointerEvents:"auto",height:g?24:20,width:g?24:20},...e})})}},888202:(e,t,n)=>{n.d(t,{o_:()=>H,Dp:()=>O,ow:()=>V});n(430541),n(757658),n(667294);var o=n(724405),i=n(707500),s=n(213148),r=n(701230),a=n(725651),l=n(291427),c=n(698519),d=n(937612),u=n(355863),p=n(709291),m=n(531701),f=n(401898),g=n(646564),v=n(62967),h=n(10910),y=n(672495),x=n(68204),C=n(599417),S=n(80444),k=n(484654),b=n(76095),I=n(271184),w=n(457819),M=(n(21703),n(336769)),A=n(800480),P=n(964275),j=n(356666),F=n(210228),T=n(237181),L=n(573063),N=n(630793),B=n(785893);const E=3,Z="recent-actions",_=(0,p.defineMessages)({recentActions:{defaultMessage:"Recents",id:"commandPalette.recentActions.title"},more:{defaultMessage:"See more",id:"commandPalette.recentActions.more"},removeFromMenu:{defaultMessage:"Remove this action from the menu",id:"commandPalette.recentActions.removeFromMenu"},addToFavorites:{defaultMessage:"Add to favorites",id:"commandPalette.recentActions.addToFavorites"}});function R(e){const{focused:t,recentAction:n,state:o,intl:i,sessionId:s}=e,r=(0,A.O7)();return(0,B.jsx)(L.Z,{style:{visibility:t?"visible":"hidden",width:18,height:18},onClick:()=>{h.Vo(r,{type:"create_from_recent",session_id:s,gtm_favorite_id:void 0}),o.set((0,I.kg)(n))},icon:l.e,ariaLabel:i.formatMessage(_.addToFavorites)})}function D(){const e=(0,o.Fg)();return(0,j.o)({width:12,fill:e.mediumIconColor,marginLeft:2,marginRight:2})}(0,M.exposeDebugEnvironmentValue)("resetRecentAndFavoriteAIActions",(e=>()=>{const{currentUserSettingsStore:t}=S.default.state;if(!t)throw new Error("currentUserSettingsStore not found");F.createAndCommit({userAction:"recentActions.debugging.resetRecentAndFavoriteAIActions",environment:e,perform(e){T.d2({userSettingsStore:t,transaction:e,data:{recent_ai_actions:[],favorite_ai_actions:[]}})}})}));const U="This string should never show up in analytics",V=(0,p.defineMessages)({clickToEditAndRetry:{id:"completions.CompletionMenuActionBar.tryAgain.clickToEditAndRetry",defaultMessage:"Click to edit prompt and retry"},clickToRetry:{id:"completions.CompletionMenuActionBar.tryAgain.clickToRetry",defaultMessage:"Click to retry"},tryAgain:{id:"completions.CompletionMenuActionBar.tryAgain",defaultMessage:"Try again"},delete:{id:"completions.CompletionMenuActionBar.delete",defaultMessage:"Discard"},close:{id:"completions.CompletionMenuActionBar.close",defaultMessage:"Close"},keep:{id:"completions.CompletionMenuActionBar.done",defaultMessage:"Done"},accept:{id:"completions.CompletionMenuActionBar.accept",defaultMessage:"Accept"},replace:{id:"completions.CompletionMenuActionBar.replace",defaultMessage:"Replace selection"},insert:{id:"completions.CompletionMenuActionBar.insert",defaultMessage:"Insert below"},addToFavorites:{id:"completions.CompletionMenuActionBar.addToFavorites",defaultMessage:"Add to favorites"},upsell:{id:"completions.CompletionMenuActionBar.upsell",defaultMessage:"Get unlimited AI"},requestAccess:{id:"completions.CompletionMenuActionBar.requestAccess",defaultMessage:"Request Access"}});function H(e){const{filter:t,state:n,from:o,favoriteEditingState:p,onUpdatePromptState:m,onImprove:k,context:M,intl:A,environment:j,completionResultInfo:T}=e;let H;switch(n.stage){case"initialPrompt":case"initialPromptForAIBlock":H=function(e){const{state:t,environment:n,intl:o,filter:i,from:s,onUpdatePromptState:r,favoriteEditingState:a,type:l}=e,{currentUserSettingsStore:c}=S.default.state,d=c?function(e,t,n,o,i){const s=i.filterOut.toLocaleLowerCase().trim(),r=(0,N.pz)(n),a=[];let l=0;for(const u of r){const r="recentAction."+l++,c=s=>(0,B.jsxs)("div",{style:{display:"flex"},children:[(0,B.jsx)(L.Z,{style:{visibility:s.focused?"visible":"hidden",width:18,height:18},onClick:()=>F.createAndCommit({userAction:"ai.recentActions.renderRemoveButton",environment:o,perform(e){(0,N.lG)(u,n,e)}}),icon:P.D,ariaLabel:t.formatMessage(_.removeFromMenu)}),"inactive"===i.favoriteEditingState.type?(0,B.jsx)(R,{sessionId:e.aiSessionId,state:i.favoriteEditingState,focused:s.focused,recentAction:u,intl:t}):(0,B.jsx)(g.xj,{type:"updatePrompt",focused:s.focused})]});let d;if(u.prompt.toLocaleLowerCase().trim()!==s){switch(u.type){case"helpMeEdit":"initialPrompt"!==e.stage||"blockSelection"!==e.context.type&&"textSelection"!==e.context.type||(d=(0,g.cK)({key:r,name:u.prompt,analyticsName:"recentAction",right:c,onUpdatePromptState:i.onUpdatePromptState,renderTooltip:v.zz}));break;case"helpMeWrite":"initialPromptForAIBlock"!==e.stage&&"cursor"!==e.context.type||(d=(0,g.cK)({key:r,name:u.prompt,analyticsName:"recentAction",right:c,onUpdatePromptState:i.onUpdatePromptState,renderTooltip:v.zz}));break;default:(0,f.t1)(u)}d&&a.push(d)}}const c=a.slice(0,E),d=a.slice(E);if(d.length){const e=(0,v.$J)({key:"more recent actions",render:e=>(0,B.jsx)(y.Z,{...e}),actions:d}),t=(0,v.MV)({key:"more recent actions extension",displayName:_.more,analyticsName:"Completions - more",validators:[],svg:()=>(0,B.jsx)(D,{}),subActions:()=>[e],collapseSubActionsIntoParent:!0,width:400});c.push(t)}return[(0,v.$J)({key:Z,title:_.recentActions,render:e=>(0,B.jsx)(y.Z,{...e}),actions:c})]}(t,o,c,n,{onUpdatePromptState:r,favoriteEditingState:a,filterOut:i}):[],u=c&&"disabled"!==a.type?(0,b.Mi)(n,t,o,c,{onUpdatePromptState:r,favoriteEditingState:a,filterOut:i}):[],p=[...u];"initialPromptForAIBlock"===t.stage?p.push((0,g.xI)({store:t.store,from:s})):"aiBlock"!==l&&p.push(...(0,g.LK)({from:s,type:l,onUpdatePromptState:r}));return p.push(...d),p}({state:n,environment:j,intl:A,filter:t,from:o,context:M,favoriteEditingState:p,onUpdatePromptState:m,type:(0,w.VZ)(n)});break;case"results":H=n.loading?[]:function(e){const{environment:t,state:n,defaultAction:o,closeOrDiscard:p,favoriteEditingState:m}=e,g={key:"insert",analyticsName:U,displayName:V.insert,validators:[],closeParentMenu:!0,svg:r.H,action(){e.onInsert()}},x={key:"delete",analyticsName:U,displayName:V.delete,validators:[],closeParentMenu:!0,svg:d.y,action(){e.onCancel()}},S=function(e){const{state:t,onRetry:n}=e;if("results"!==t.stage)return;const o={key:"tryAgain",analyticsName:U,displayName:V.tryAgain,validators:[],closeParentMenu:!0,svg:u.s,renderTooltip:()=>(0,B.jsx)(W,{state:t}),action(){n()}};return o}({...e}),k=[],b=c.k;"accept"===o?k.push((0,v.cN)({key:"keep",analyticsName:U,displayName:V.keep,validators:[],closeParentMenu:!0,svg:b,action(){e.onAccept({exitType:"accept"})}})):"replace"===o?k.push((0,v.cN)({key:"replace",analyticsName:U,displayName:V.replace,validators:[],closeParentMenu:!0,svg:b,action(){e.onReplace()}}),(0,v.cN)(g)):"insert"===o?k.push((0,v.cN)({...g,svg:b})):(0,f.t1)(o);k.push((0,v.cN)({key:"continueWriting",analyticsName:U,displayName:C.Dr.continueWriting,validators:[],closeParentMenu:!0,svg:K(a.R),action(){e.onImprove({type:"continueWriting"})}}),(0,v.cN)({key:"makeLonger",analyticsName:U,displayName:C.Dr.makeLonger,validators:[],closeParentMenu:!0,svg:K(i.H),action(){e.onImprove({type:"makeLonger"})}}));const w=[(0,v.cN)({key:"addToFavorites",analyticsName:U,displayName:V.addToFavorites,validators:[()=>Boolean($(n,m))],closeParentMenu:!0,svg:l.e,action(){const e=$(n,m);if(!e)return;const o=(0,I.kg)(e.recentAction);e.favoriteEditingState.set(o),h.Vo(t,{type:"create_from_completion",session_id:n.aiSessionId,gtm_favorite_id:void 0})}}),S?(0,v.cN)(S):void 0,"discard"===p?(0,v.cN)(x):(0,v.cs)({key:"close",analyticsName:U,displayName:V.close,validators:[],closeParentMenu:!0,svg:s.U,shortcuts:["esc"],action(){e.onAccept({exitType:"click_outside_window_accept",selectInsertion:!0})}})],M=(0,v.$J)({key:"main",render:e=>(0,B.jsx)(y.Z,{...e}),actions:k}),A=(0,v.$J)({key:"final",render:e=>(0,B.jsx)(y.Z,{...e}),actions:w.filter(f.$K)});return[M,A]}({environment:j,state:n,onImprove:k,closeOrDiscard:"cursor"===n.context.type?"close":"discard",favoriteEditingState:p,...T});break;default:(0,f.t1)(n)}let O=(0,x.sG)({sections:H,context:M,query:t});if(1===O.length&&O[0].key===Z){const e=O[0].actions.slice();(0,C.LN)(t,A)||e.unshift((0,g.sH)({customPrompt:t,execute:T.onSubmit})),O=[(0,v.$J)({key:"actions",render:e=>(0,B.jsx)(y.Z,{...e}),actions:e})]}else(function(e){let t=!1;for(const n of e)if(n.key===b.YX)t=!0;else if(n.key!==Z)return!1;return t})(O)&&O.push((0,v.$J)({key:"literal-actions",render:e=>(0,B.jsx)(y.Z,{...e}),actions:[(0,g.sH)({customPrompt:t,execute:T.onSubmit})]}));return O}function O(e,t){switch(t.type){case"continueWriting":return e.formatMessage(C.Dr.continueWriting);case"makeLonger":return e.formatMessage(C.Dr.makeLonger);case"helpMeEdit":return t.prompt}}function W(e){const{state:t}=e,n=(0,o.yK)((e=>({hint:{color:e.mediumInvertedTextColor}})),[]),i=(0,C.xM)(t),s=(0,p.useIntl)();let r,a=V.clickToEditAndRetry;if("initial"===i.type)if(k.doesPromptNeedAdditionalUserInput(i))r=(0,C.gY)(i);else{a=V.clickToRetry;const e=i.clientPrompt.name;r="string"==typeof e?e:s.formatMessage(e)}else"followup"===i.type?r=O(s,i.improvement):(0,f.t1)(i);return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)("div",{children:r}),(0,B.jsx)("div",{style:n.hint,children:s.formatMessage(a)})]})}function K(e){return function(){return(0,B.jsx)(g.lA,{svg:e,svgFill:m.FN.light.purple[400]})}}function $(e,t){if("disabled"===t.type)return;const n=function(e){if("completionPopup"!==e.type||"results"!==e.stage)return;const t=(0,C.xM)(e);return"initial"===t.type?t:void 0}(e);if(!n)return;const{currentUserSettingsStore:o}=S.default.state;if(!o)return;const i=(0,N.BG)({clientPrompt:n.clientPrompt,additionalContext:n.additionalContext,promptTitle:n.promptTitle});return i&&!(0,I.Gl)(o,i)?{currentInitialRevision:n,recentAction:i,favoriteEditingState:t,currentUserSettingsStore:o}:void 0}},313679:(e,t,n)=>{n.r(t),n.d(t,{acceptCursorCompletionAssistant:()=>A,cancelAssistantCompletion:()=>M,cancelCursorCompletionAssistant:()=>P,insertCursorCompletionAssistantSuggestionsBelowForSingleBlockEdits:()=>j,moveAssistantWriterToCorner:()=>T,refreshAssistantCompletion:()=>w,triggerAssistantCompletion:()=>F,triggerAssistantSkillCompletion:()=>I});var o=n(701302),i=n(417586),s=n(471924),r=n(653965),a=n(401898),l=n(119785),c=n(709953),d=n(524677),u=n(137231),p=n(898104),m=n(244458),f=n(610358),g=n(828344),v=n(484681),h=n(423577),y=n(80444),x=n(521273),C=n(798180),S=n(316772),k=n(206258),b=n(27724);async function I(e){const{environment:t,context:n,clientSkillWithParameterValues:i,updater:s,sessionId:r,from:a}=e;"textSelection"===n.type&&s((()=>{p.ZH({debug:{userAction:"assistantWriterActions.triggerAssistantSkillCompletion"},environment:t}),d.ZH({debug:{userAction:"assistantWriterActions.triggerAssistantSkillCompletion"},environment:t})}));const l={type:"assistantCompletionPopup",stage:"results",loading:!0,sessionId:r,context:n,from:a,hasErrored:!1,clientSkillWithParameterValues:i};s((()=>{S.default.setState(l)})),await o.default.afterNextFlush(),await w({...e,updater:s})}async function w(e){const{environment:t,updater:n,humanText:o}=e,l=S.default.state;if("assistantCompletionPopup"!==l.type||"results"!==l.stage)return;const{clientSkillWithParameterValues:c}=l,d=l.sessionId;if(C.default.getSessionContext(d)||await f.resetAndInitializeAssistantSession({environment:t,completionContext:l.context,clientSkillWithParameterValues:c,sessionId:d,makeActiveSession:!1}),x.Z.showAssistantNotionAiCopy()){const e=y.default.state.currentUserSettingsStore;e&&(0,m.setLastExposedToQnaAtToCurrentTimestamp)(t,{userSettingsStore:e})}const u=(0,i.Fq)(null==c?void 0:c.clientSkill.skillType);if((0,a.$K)(o))await f.commitHumanStep({environment:t,text:o,sessionId:d,assistantSurfaceType:"writer",clientSkillWithParameterValues:c});else if(null==u||!u.requiresInput){const e=s.Il(),n=Date.now(),o=C.default.getSessionContext(d);g.trackInferenceStart({environment:t,configurationState:null==o?void 0:o.assistantConfigurationState,inferenceId:e,isRetry:!1,source:Boolean(c)?"skill":"chat",skillType:null==c?void 0:c.clientSkill.skillType,from:"writer",mentionsUsed:void 0}),await f.sampleNextAssistantStepsAsHumanSubmission({environment:t,sessionId:d,inferenceId:e});const i=y.default.state.currentSpaceStore;i&&o&&(0,f.trackInferenceEndFromState)({environment:t,assistantSessionContext:o,inferenceId:e,timeTook:Date.now()-n,parentStore:i,transcript:o.evaluator.getTranscript()})}await n((()=>{const e=S.default.state;if("assistantCompletionPopup"!==e.type||"results"!==e.stage)return;const t=r.Z$(b.default.state.stores);S.default.setState({...e,context:{...e.context,origin:t||e.context.origin},loading:!1})}))}function M(e){const{environment:t,completionState:n}=e;f.clearActiveAssistantSession({environment:t,sessionId:n.sessionId})}async function A(e){const{environment:t,selectInsertion:n,exitType:o}=e,i=S.default.state;if("assistantCompletionPopup"!==i.type)return;const s=i.sessionId;S.default.invalidateLastUpdater(),S.default.resetStore(e);const r=C.default.getSessionContextOrThrow(s);await f.commitPreviewAssistantStep({environment:t,sessionId:s,updater:r.createUpdater()}),await f.applyUncommittedOperations({environment:t,sessionId:s,operationContext:(0,h.iD)()}),f.clearActiveAssistantSession({environment:t,sessionId:s})}function P(e){const{environment:t}=e,n=S.default.state;if("assistantCompletionPopup"!==n.type)return;const o=n.sessionId;S.default.invalidateLastUpdater(),S.default.resetStore(e),f.clearActiveAssistantSession({environment:t,sessionId:o})}async function j(e){const{environment:t,targetBlockStore:n,parentStore:o,isCrdt:i,operationsToApply:s,transaction:r}=e,a=c.j4({environment:t,type:"text",inMemoryRecordCache:n.inMemoryRecordCache,useCrdt:i,transaction:r});l.SH({parentStore:o.getContentStore(),childStore:k.G.createChildStore(n.getContentStore(),a.pointer),transaction:r,before:n.id});const d=n.getTitleStore(),p=d?d.getValue():void 0;return u.sO({environment:t,store:a.getBlockTitleStore(),value:p,transaction:r}),await(0,h.m2)({environment:t,transaction:r,operations:s,operationContext:(0,h.iD)()})}function F(e){const{environment:t,context:n,prompt:o,additionalContext:i,updater:s,sessionId:r,from:a}=e;"textSelection"===n.type&&s((()=>{p.ZH({debug:{userAction:"assistantWriterActions.triggerAssistantCompletion"},environment:t}),d.ZH({debug:{userAction:"assistantWriterActions.triggerAssistantCompletion"},environment:t})}));const l={type:"assistantCompletionPopup",stage:"initialPrompt",sessionId:r,context:n,from:a,loading:!1,hasErrored:!1};s((()=>{S.default.setState(l)}))}function T(e){const{environment:t}=e,n=S.default.state;"assistantCompletionPopup"===n.type&&(S.default.invalidateLastUpdater(),S.default.resetStore(e),v.openAssistantRightHandSideMenu({environment:t,makeActiveSessionId:n.sessionId,from:"assistant_writer"}))}},480671:(e,t,n)=>{n.d(t,{Cl:()=>h,jw:()=>y,k2:()=>g,v5:()=>v});n(21703);var o=n(471924),i=n(772141),s=n(519889),r=n(590965),a=n(500896),l=n(712139),c=n(653965),d=n(286572),u=n(206258),p=n(88893),m=n(163423),f=n(288280);function g(e){m.Z.setState({open:!0,addOnFeature:e,stage:"limit_reached",addOnUpgradeId:o.Il(),tax:0})}function v(){m.Z.setState({open:!1})}function h(e){const t=m.Z.state;t.open&&m.Z.setState({...t,stage:"confirm_purchase",coupon:e&&!(0,a.$v)(e)?e:void 0})}async function y(e){const{environment:t,spaceStore:n,from:o}=e,a=function(){const e=f.subscriptionDataStoreInstance.state,t=(e?p.CM(e):[]).filter((e=>(0,r.nB)(e)&&(0,i.zz)(e.role))).map((e=>e.userId));if(!t||0===t.length)throw new Error("No admins found in the current space");return(0,c.UP)(t)}(),m=n.getName(),g=u.U6.createChildStore(n,{table:s.KJ,id:a});await g.load();const v=g.getEmail();v?d.bf(t,{admin_id:a,admin_email:v,space_name:m,from:o}):l.IE(new Error("Could not get email for admin in sendMemberRequestForAddOn"))}},301548:(e,t,n)=>{n.d(t,{G:()=>s});n(667294);var o=n(745238),i=n(785893);const s=(0,o.IU)("backward",{viewBox:"0 0 24 24",svg:(0,i.jsx)("polygon",{points:"23,11 4.801,11 11.4,4.4 10,3 1,12 10,21 11.4,19.6 4.801,13 23,13 "})})},2585:(e,t,n)=>{n.d(t,{f:()=>s});n(667294);var o=n(745238),i=n(785893);const s=(0,o.IU)("chevronLeft",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M3.61816 8.06445C3.61816 8.29688 3.70703 8.49512 3.8916 8.67285L9.22363 13.8887C9.36719 14.0391 9.55859 14.1143 9.77734 14.1143C10.2217 14.1143 10.5703 13.7725 10.5703 13.3213C10.5703 13.1025 10.4814 12.9043 10.3311 12.7539L5.52539 8.06445L10.3311 3.375C10.4814 3.21777 10.5703 3.01953 10.5703 2.80078C10.5703 2.35645 10.2217 2.01465 9.77734 2.01465C9.55859 2.01465 9.36719 2.08984 9.22363 2.24023L3.8916 7.45605C3.70703 7.63379 3.625 7.83203 3.61816 8.06445Z"})})},950780:(e,t,n)=>{n.d(t,{E:()=>s});n(667294);var o=n(745238),i=n(785893);const s=(0,o.IU)("editPropertyType",{viewBox:"0 0 16 16 ",svg:(0,i.jsx)("path",{d:"M11.5615 4.84473L12.2998 4.11328C12.6689 3.74414 12.6826 3.34082 12.3545 3.00586L12.0879 2.73926C11.7529 2.4043 11.3428 2.43848 10.9736 2.79395L10.2354 3.52539L11.5615 4.84473ZM3.22168 13.1641L10.9053 5.4873L9.59277 4.16797L1.90918 11.8516L1.23926 13.4512C1.16406 13.6562 1.37598 13.875 1.57422 13.7998L3.22168 13.1641ZM3.92578 13.8066H14.1045C14.4736 13.8066 14.7744 13.499 14.7744 13.1367C14.7744 12.7676 14.4736 12.4668 14.1045 12.4668H5.27246L3.92578 13.8066Z"})})},781570:(e,t,n)=>{n.d(t,{T:()=>s});n(667294);var o=n(745238),i=n(785893);const s=(0,o.IU)("giftOutline",{viewBox:"0 0 32 34",svg:(0,i.jsx)("path",{d:"M7.781 33.219h16.422c2.938 0 4.563-1.547 4.563-4.5v-9.594h.109c1.375-.297 2.14-1.406 2.14-3v-4.11c0-1.906-1.062-3.109-2.968-3.109H24.89c.828-.828 1.312-1.953 1.312-3.25 0-3.031-2.39-5.187-5.422-5.187-2.187 0-4 1.203-4.797 3.297C15.187 1.672 13.39.469 11.187.469c-3.016 0-5.422 2.156-5.422 5.187 0 1.297.484 2.422 1.328 3.25H3.937C2.11 8.906.97 10.11.97 12.016v4.109c0 1.594.75 2.703 2.125 3h.11v9.594c0 2.953 1.624 4.5 4.577 4.5zm6.922-24.313h-2.437c-2.454 0-3.891-1.39-3.891-3.11 0-1.718 1.25-2.718 2.969-2.718 1.86 0 3.36 1.406 3.36 3.719v2.11zm2.563 0v-2.11c0-2.312 1.5-3.718 3.359-3.718 1.719 0 2.969 1 2.969 2.719 0 1.719-1.422 3.11-3.89 3.11h-2.438zm-2.672 7.969H4.578c-.781 0-1.094-.328-1.094-1.11V12.36c0-.78.313-1.093 1.094-1.093h10.016v5.609zm2.781 0v-5.61h10.047c.781 0 1.078.313 1.078 1.094v3.407c0 .78-.297 1.109-1.078 1.109H17.375zm-2.781 14H7.75c-1.297 0-2.031-.734-2.031-2.031v-9.61h8.875v11.641zm2.781 0v-11.64h8.875v9.609c0 1.297-.734 2.031-2.031 2.031h-6.844z"})})},701230:(e,t,n)=>{n.d(t,{H:()=>s});n(667294);var o=n(745238),i=n(785893);const s=(0,o.IU)("insertDown",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M9.55548 13.0343H14.2085C14.5315 13.0343 14.7951 13.2913 14.7951 13.6142C14.7951 13.9372 14.5315 14.1942 14.2085 14.1942H9.55548C9.23254 14.1942 8.9755 13.9372 8.9755 13.6142C8.9755 13.2913 9.23254 13.0343 9.55548 13.0343ZM1.21167 9.67959C1.21167 9.09961 1.52802 8.74371 2.0421 8.74371C2.55617 8.74371 2.87911 9.11279 2.87911 9.65982V10.7868C2.87911 10.945 2.96479 11.0373 3.12956 11.0373H4.70473V10.365C4.70473 9.818 5.26494 9.60709 5.68675 9.94322L7.56509 11.4525C7.84849 11.6766 7.84849 12.0786 7.56509 12.2961L5.68675 13.812C5.25176 14.1679 4.70473 13.9569 4.70473 13.3836V12.7047H2.93184C1.89051 12.7047 1.21167 12.0984 1.21167 11.057V9.67959ZM9.55548 9.58073H14.2085C14.5315 9.58073 14.7951 9.83777 14.7951 10.1607C14.7951 10.4837 14.5315 10.7407 14.2085 10.7407H9.55548C9.23254 10.7407 8.9755 10.4837 8.9755 10.1607C8.9755 9.83777 9.23254 9.58073 9.55548 9.58073ZM1.78506 6.12721H14.2085C14.5315 6.12721 14.7951 6.38425 14.7951 6.70719C14.7951 7.03014 14.5315 7.28717 14.2085 7.28717H1.78506C1.46211 7.28717 1.20508 7.03014 1.20508 6.70719C1.20508 6.38425 1.46211 6.12721 1.78506 6.12721ZM1.78506 2.68028H14.2085C14.5315 2.68028 14.7951 2.93073 14.7951 3.25367C14.7951 3.5832 14.5315 3.83365 14.2085 3.83365H1.78506C1.46211 3.83365 1.20508 3.5832 1.20508 3.25367C1.20508 2.93073 1.46211 2.68028 1.78506 2.68028Z"})})},83065:(e,t,n)=>{n.d(t,{_:()=>s});n(667294);var o=n(745238),i=n(785893);const s=(0,o.IU)("sendArrow",{viewBox:"0 0 20 20",svg:(0,i.jsx)("path",{d:"M9.79883 18.5894C14.6216 18.5894 18.5894 14.6216 18.5894 9.79883C18.5894 4.96777 14.6216 1 9.79053 1C4.95947 1 1 4.96777 1 9.79883C1 14.6216 4.96777 18.5894 9.79883 18.5894ZM9.79883 14.3062C9.20947 14.3062 8.76953 13.9077 8.76953 13.3433V9.69922L8.86914 8.00586L8.25488 8.84424L7.3916 9.81543C7.23389 10.0063 6.98486 10.1143 6.72754 10.1143C6.21289 10.1143 5.84766 9.75732 5.84766 9.25928C5.84766 8.99365 5.92236 8.79443 6.12158 8.58691L8.96045 5.61523C9.19287 5.35791 9.4585 5.2417 9.79883 5.2417C10.1309 5.2417 10.4048 5.36621 10.6372 5.61523L13.4761 8.58691C13.667 8.79443 13.75 8.99365 13.75 9.25928C13.75 9.75732 13.3848 10.1143 12.8618 10.1143C12.6128 10.1143 12.3638 10.0063 12.2061 9.81543L11.3428 8.86914L10.7202 7.99756L10.8281 9.69922V13.3433C10.8281 13.9077 10.3799 14.3062 9.79883 14.3062Z"})})},633676:(e,t,n)=>{n.d(t,{A:()=>r});n(667294);var o=n(745238),i=n(439986),s=n(785893);const r=(0,o.IU)("thumbDown",{viewBox:"0 0 18 19",svg:(0,s.jsx)("g",{transform:"rotate(180 9 9.5)",children:i.f})})},297022:(e,t,n)=>{n.d(t,{E:()=>r});n(667294);var o=n(745238),i=n(310498),s=n(785893);const r=(0,o.IU)("thumbDownFilled",{viewBox:"0 0 16 18",svg:(0,s.jsx)("g",{transform:"rotate(180 8 9)",children:i.O})})},439986:(e,t,n)=>{n.d(t,{P:()=>s,f:()=>i});n(667294);var o=n(745238);const i=(0,n(785893).jsx)("path",{d:"M0.539062 12.3125C0.539062 15.0547 2.29688 17.3125 4.54688 17.3125H7.11719C8.17188 17.8516 9.42188 18.1641 10.8047 18.1641H11.8906C12.9062 18.1641 13.7734 18.1016 14.3359 17.9609C15.4766 17.6797 16.1953 16.8672 16.1953 15.8516C16.1953 15.6641 16.1719 15.5 16.1172 15.3281C16.6562 14.9141 16.9609 14.2969 16.9609 13.6328C16.9609 13.3203 16.8984 13.0078 16.7891 12.7578C17.1484 12.375 17.3594 11.8203 17.3594 11.25C17.3594 10.875 17.2656 10.4922 17.1094 10.2031C17.3281 9.86719 17.4531 9.42188 17.4531 8.9375C17.4531 7.69531 16.5078 6.73438 15.2734 6.73438H12.3672C12.1953 6.73438 12.0859 6.65625 12.0938 6.50781C12.1328 5.69531 13.4062 3.75781 13.4062 2.17188C13.4062 1.01562 12.5859 0.171875 11.4688 0.171875C10.6484 0.171875 10.0859 0.59375 9.55469 1.61719C8.58594 3.48438 7.40625 5.125 5.65625 7.28125H4.25C2.14844 7.28125 0.539062 9.52344 0.539062 12.3125ZM5.375 12.25C5.375 10.5938 5.75 9.53125 6.80469 8.11719C7.99219 6.53125 9.625 4.63281 10.8125 2.27344C11.0625 1.77344 11.2344 1.64844 11.4844 1.64844C11.7891 1.64844 11.9844 1.86719 11.9844 2.25C11.9844 3.42188 10.6641 5.35156 10.6641 6.61719C10.6641 7.55469 11.4219 8.15625 12.4375 8.15625H15.2422C15.7031 8.15625 16.0391 8.5 16.0391 8.95312C16.0391 9.28125 15.9297 9.5 15.6562 9.76562C15.4609 9.96875 15.4375 10.25 15.6094 10.4453C15.8359 10.7734 15.9375 10.9844 15.9375 11.25C15.9375 11.5781 15.7812 11.8516 15.4609 12.0938C15.2031 12.2812 15.1094 12.5859 15.2656 12.8828C15.4297 13.2109 15.5156 13.3672 15.5156 13.6172C15.5156 14 15.2734 14.2891 14.7812 14.5469C14.5312 14.6875 14.4609 14.9531 14.5703 15.1875C14.7344 15.5938 14.7578 15.6641 14.7578 15.8438C14.7578 16.1797 14.5078 16.4531 13.9766 16.5859C13.5156 16.7031 12.7812 16.75 11.8203 16.7422L10.8125 16.7344C7.57031 16.7031 5.375 14.8828 5.375 12.25ZM1.9375 12.3125C1.9375 10.3281 2.96094 8.73438 4.14062 8.6875C4.34375 8.6875 4.55469 8.6875 4.75781 8.6875C4.20312 9.76562 3.95312 10.8984 3.95312 12.25C3.95312 13.6875 4.46094 14.9531 5.375 15.9453C5.07812 15.9453 4.76562 15.9375 4.46875 15.9375C3.10156 15.8906 1.9375 14.2812 1.9375 12.3125Z"}),s=(0,o.IU)("thumbUp",{viewBox:"0 0 18 19",svg:i})},310498:(e,t,n)=>{n.d(t,{O:()=>i,w:()=>s});n(667294);var o=n(745238);const i=(0,n(785893).jsx)("path",{d:"M4 12.1875C3.99219 15.1641 6.34375 17.4297 10.0859 17.4375H11.1719C12.1953 17.4375 12.9766 17.3594 13.4297 17.2422C14.1016 17.0781 14.7031 16.6562 14.7031 15.8828C14.7031 15.5859 14.625 15.3594 14.5312 15.1875C14.4766 15.1016 14.4922 15.0234 14.5703 14.9922C15.0859 14.7578 15.4766 14.2812 15.4766 13.6562C15.4766 13.2969 15.375 12.9766 15.2031 12.75C15.125 12.6406 15.1406 12.5469 15.2656 12.4766C15.625 12.25 15.875 11.7891 15.875 11.2656C15.875 10.8828 15.7578 10.4844 15.5547 10.2812C15.4453 10.1797 15.4609 10.1094 15.5781 10.0156C15.8281 9.78906 15.9844 9.41406 15.9844 8.96094C15.9844 8.15625 15.3516 7.5 14.5234 7.5H11.7031C11.0234 7.5 10.5781 7.15625 10.5781 6.60156C10.5781 5.54688 11.9141 3.57812 11.9141 2.14844C11.9141 1.375 11.4219 0.90625 10.75 0.90625C10.1641 0.90625 9.85938 1.28906 9.53125 1.9375C8.33594 4.24219 6.75781 6.11719 5.54688 7.72656C4.49219 9.11719 4.00781 10.3125 4 12.1875ZM0.015625 12.25C0.015625 14.6719 1.52344 16.6719 3.53125 16.6719H4.89062C3.47656 15.5938 2.85156 13.9922 2.86719 12.1719C2.875 10.2031 3.57812 8.77344 4.32031 7.79688H3.23438C1.41406 7.79688 0.015625 9.75 0.015625 12.25Z"}),s=(0,o.IU)("thumbUpFilled",{viewBox:"0 0 16 18",svg:i})}}]);