"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[43627],{781575:(t,o,e)=>{e.d(o,{AK:()=>_,Mc:()=>r,OS:()=>u,Td:()=>f,Uu:()=>c,XC:()=>s,ZK:()=>S,e8:()=>m,gV:()=>l,hc:()=>g,n0:()=>v,u0:()=>p,xi:()=>d});var n=e(730459),i=e(215010),a=e(535057);function r(t){n.K4(t,"add_slack_integration")}function c(t){n.K4(t,"remove_slack_integration")}function s(t,o){n.K4(t,"slack_notification_create",o)}function d(t,o){n.K4(t,"slack_notification_delete",o)}function u(t,o){n.K4(t,"slack_notification_update",o)}function l(t,o){const e=a.zt(),r=i.JF();n.K4(t,"slack_imports_invite_render_button",{subscription_tier:e,domain_type:r,origin:o.origin,invite_flow_id:o.invite_flow_id})}function m(t,o){const e=a.zt(),r=i.JF();n.K4(t,"slack_imports_invite_render_invite_popup",{subscription_tier:e,domain_type:r,origin:o.origin,invite_flow_id:o.invite_flow_id})}function _(t,o){const e=a.zt(),r=i.JF();n.K4(t,"slack_imports_invite_click_invite_button",{subscription_tier:e,domain_type:r,invited_user_count:o.invited_user_count,origin:o.origin,invite_token_query:o.inviteTokenQuery,invite_targets:o.inviteTargets,invite_flow_id:o.invite_flow_id})}function p(t,o){const e=a.zt(),r=i.JF();n.K4(t,"slack_imports_invite_completed",{subscription_tier:e,domain_type:r,invited_user_count:o.invited_user_count,is_success:o.is_success,origin:o.origin,invite_flow_id:o.invite_flow_id,error:o.error,invite_stage:o.invite_stage})}function f(t,o){const e=a.zt(),r=i.JF();n.K4(t,"slack_imports_invite_dismiss_popup",{subscription_tier:e,domain_type:r,origin:o.origin,invite_flow_id:o.invite_flow_id})}function g(t,o){const e=a.zt(),r=i.JF();n.K4(t,"slack_imports_invite_click_select_all",{subscription_tier:e,domain_type:r,origin:o.origin,invite_flow_id:o.invite_flow_id,invited_user_count:o.invited_user_count,is_unselect:o.is_unselect,invite_token_query:o.invite_token_query})}function v(t,o){const e=a.zt(),r=i.JF();n.K4(t,"slack_imports_invite_start_slack_integration",{subscription_tier:e,domain_type:r,origin:o.origin,invite_flow_id:o.invite_flow_id,from:o.from})}function S(t,o){const e=a.zt(),r=i.JF();n.K4(t,"slack_imports_invite_complete_slack_integration",{subscription_tier:e,domain_type:r,origin:o.origin,invite_flow_id:o.invite_flow_id,from:o.from,is_success:o.is_success})}},143627:(t,o,e)=>{e.r(o),e.d(o,{addAutomationAction:()=>B,deleteAutomation:()=>O,disableAutomation:()=>z,duplicateAutomation:()=>P,duplicateAutomationAction:()=>j,enableAutomation:()=>J,insertEmptyTextInDuplicateBlockAction:()=>U,messages:()=>$,removeAutomationAction:()=>F,reorderAutomationActions:()=>W});e(21703);var n=e(940694),i=e(102647),a=e(537955),r=e(173110),c=e(576218),s=e(600606),d=e(798963),u=e(718844),l=e(23867),m=e(76233),_=e(709291),p=e(653965),f=e(937850),g=e(940470),v=e(401898),S=e(781575),y=e(276725),M=e(594419),b=e(119785),A=e(709953),k=e(524677),C=e(898104),w=e(210228),h=e(95477),R=e(27105),T=e(730459),K=e(849117),I=e(741195),x=e(273959);const $=(0,_.defineMessages)({genericErrorMessage:{id:"automations.buttonTrigger.genericErrorMessage",defaultMessage:"Button failed to execute"},open:{defaultMessage:"Open",id:"automations.buttonTrigger.open"},undo:{defaultMessage:"Undo",id:"automations.buttonTrigger.undo"},defaultConfirmationWorkflowText:{defaultMessage:"Are you sure you want to continue?",id:"automations.buttonTrigger.defaultConfirmationWorkflowText"},defaultContinueWorkflowMessage:{defaultMessage:"Continue",id:"automations.buttonTrigger.defaultContinueWorkflowMessage"},defaultStopWorkflowMessage:{defaultMessage:"Cancel",id:"automations.buttonTrigger.defaultStopWorkflowMessage"},errorQueryCollectionTooManyPages:{defaultMessage:"Button impacts too many pages",id:"automations.buttonTrigger.errorQueryCollectionTooManyPages"},errorUserCancelled:{defaultMessage:"Button was cancelled",id:"automations.buttonTrigger.errorUserCancelled"},errorRecordInTrash:{id:"automations.buttonTrigger.errorRecordInTrash",defaultMessage:"Button is editing a page in trash"}});function B(t){const{actionId:o,environment:e,intl:n,automationStore:a,actionType:r,transaction:c,insertionPoint:s,config:l,createDuplicateBlocksContainer:_=!0}=t,p=a.getSpaceId();if(!p)return;let f;"duplicate_blocks"===r&&_&&(f=A.j4({environment:e,inMemoryRecordCache:a.inMemoryRecordCache,transaction:c,type:"text",useCrdt:R.dy({source:"automation_action"})}));const g=l??function(t){const{actionType:o,intl:e}=t;if("modal_confirmation"===o)return{continue_button:{text:e.formatMessage($.defaultContinueWorkflowMessage)},cancel_button:{text:e.formatMessage($.defaultStopWorkflowMessage)},text:{type:"simple",value:(0,m.TPx)(e.formatMessage($.defaultConfirmationWorkflowText))}};if("assistant"===o)return{type:"prompt"}}({actionType:r,intl:n})??{},S=A.ae({environment:e,inMemoryRecordCache:a.inMemoryRecordCache,table:u.Xj,transaction:c,value:{id:o,type:r,parent_id:a.id,parent_table:d.cv,alive:!0,space_id:p,config:g,blocks:f?[f.id]:[]}});f&&M.R3({transaction:c,parentStore:S.getKeyStore("blocks"),appendStore:f}),!s||"afterActionId"in s?M.R3({transaction:c,parentStore:a.getActionIdsStore(),appendStore:S,after:null==s?void 0:s.afterActionId}):"beforeActionId"in s?M.Ce({transaction:c,parentStore:a.getActionIdsStore(),prependStore:S,before:s.beforeActionId}):(0,v.t1)(s);const y=S.getModel();if((0,v.$K)(y)){const t=(0,T.mc)(e),o=(0,i.Bj)({automationActionModel:y,getRecordModel:S.getRecordModel});(0,i.A2)(t,{automation_action:o,automation_action_id:y.id,automation_id:y.parent_id}),(0,i.eI)(t,{automation_action_id:y.id,automation_action_type:y.type,automation_id:a.id})}return S}function P(t){const{actorPointer:o,environment:e,includeParenting:n,sourceAutomationStore:i,targetAutomationId:r,transaction:c}=t,s=i.getParentStore();if(!s||!s.isReady())throw new Error("Automation parent store not ready");const m=i.getValue(),_=i.getSpaceId();if(!(0,v.$K)(m)||!(0,v.$K)(_))throw new Error("Undefined automation value or space id");const g={},S={...(0,p.Xh)(m),id:r??(0,I.TS)({environment:e,table:d.cv,spaceId:(0,l.C)(_)})};g[i.id]=S.id,(0,v.$K)(S.action_ids)&&(0,v.Of)(S.action_ids)&&S.action_ids.forEach((t=>g[t]=(0,I.TS)({environment:e,table:u.Xj,spaceId:(0,l.C)(_)})));const y=t=>{let{requested:o}=t;const e=g[o.id];return(0,v.$K)(e)?{...o,id:e}:o};(0,a.J_)({actor:o,duplicateRecord:S,options:{},mapper:y,originalRecord:m});const M=A.ae({environment:e,inMemoryRecordCache:i.inMemoryRecordCache,table:d.cv,transaction:c,value:S});n&&b.jG({childStore:M,parentStore:s,transaction:c});const k=i.getActionStores(),C=f.Lc(k,10,(t=>{const o=g[t.id],{automationActionStore:n,onComplete:i}=j({environment:e,includeParenting:!1,mapper:y,sourceActionStore:t,targetAutomationActionId:o,transaction:c});return b.jG({childStore:n,parentStore:M,transaction:c}),i})),w=C.then((t=>t.flat()));return{automationStore:M,onComplete:w}}function j(t){const{environment:o,includeParenting:e,insertionPoint:n,mapper:r,sourceActionStore:c,targetAutomationActionId:s,transaction:d}=t,m=c.getParentStore();if(!m||!m.isReady())throw new Error("Automation store is not ready");const _=c.getValue(),g=c.getSpaceId();if(!(0,v.$K)(_)||!(0,v.$K)(g))throw new Error("Undefined action value or space id");const S={...(0,p.Xh)(_),id:s??(0,I.TS)({environment:o,table:u.Xj,spaceId:(0,l.C)(g)})},M=o.currentUser.id,k=c.inMemoryRecordCache.makeGetRecordRoleFn(M);(0,a.XJ)({duplicateRecord:S,getRecordRole:k,originalRecord:_,mapper:t=>(null==r?void 0:r(t))??t.requested,options:{},originOptions:{baseUrl:h.default.domainBaseUrl,publicDomainName:h.default.publicDomainName}});const C=A.ae({environment:o,inMemoryRecordCache:c.inMemoryRecordCache,table:u.Xj,transaction:d,value:S});e&&(!n||"afterActionId"in n?b.jG({after:null==n?void 0:n.afterActionId,childStore:C,parentStore:m,transaction:d}):"beforeActionId"in n?b.SH({before:null==n?void 0:n.beforeActionId,childStore:C,parentStore:m,transaction:d}):(0,v.t1)(n));const w=f.Lc(c.getBlockStores(),10,(t=>{const[e,n]=y.Qi({addCopyName:!1,baseUrl:h.default.domainBaseUrl,deepCopyTransclusionContainers:!1,environment:o,preferDuplicateLocation:"local",publicDomainName:h.default.publicDomainName,resolveTemplateVariables:!1,stores:[t],targetSpaceId:(0,l.C)(t.pointer.spaceId),transaction:d,useCrdt:R.dy({source:"automation_action"})}),i=e[0];return b.jG({childStore:i,parentStore:C,transaction:d}),n})),K=C.getModel();if((0,v.$K)(K)){const t=(0,T.mc)(o),e=(0,i.Bj)({automationActionModel:K,getRecordModel:C.getRecordModel});(0,i.A2)(t,{automation_action:e,automation_action_id:K.id,automation_id:K.parent_id,from:"duplicate"}),(0,i.eI)(t,{automation_action_id:K.id,automation_action_type:K.type,automation_id:m.id,from:"duplicate"})}return{automationActionStore:C,onComplete:w}}function W(t){const{clientContext:o,transaction:e,newActionIds:n}=t,{automationStore:i}=o;A.sW({store:i,transaction:e,data:{action_ids:n}}),E({clientContext:o,transaction:e})}function F(t){const{clientContext:o,actionStore:e,environment:n,transaction:i}=t;X({automationActionStore:e,environment:n,transaction:i}),E({clientContext:o,transaction:i})}function E(t){const{clientContext:o,transaction:e}=t,i=o.automationStore.getSpaceId(),a=o.automationStore.getModel();if(!i||!a)return;const s=(0,K.pt)({context:o});if(!g.x.isFail(s))for(const d of a.getActionIds()){const t=o.automationStore.getRecordStore(o.automationStore,{table:u.Xj,id:d,spaceId:i});if(!t.isDefined())continue;const a=t.getModel(),l=new Set(s.value.actionInputValueTypes[d].map((t=>{if(t.kind===r.yp.Binding||t.kind===r.yp.ContextValue)return t.id;t.kind!==r.yp.ThisRow&&(0,v.t1)(t)})).filter(v.$K)),m=(0,n.z)(a.getType()).acceptFormulaVisitor({action:a,visitor:{visitVariableOutsideOfFormula:t=>l.has(t)?{type:"keep"}:{type:"replace",value:void 0},visitFormula:t=>t.value&&(0,c.UB)(t).some((t=>!l.has(t)))?{type:"replace",value:void 0}:{type:"keep"}}});for(const o of m)w.applyOperation({store:t,operation:o,transaction:e})}}function U(t){var o;const{environment:e,parentStore:n,transaction:i}=t,a=A.j4({environment:e,type:"text",inMemoryRecordCache:n.inMemoryRecordCache,transaction:i,spaceId:n.pointer.spaceId,useCrdt:(null===(o=(0,x.sQ)(n))||void 0===o?void 0:o.useCrdt())??!1}),r=M.R3({parentStore:n,appendStore:a,transaction:i}).childStore;k.eP({environment:e,store:r});const c=r.getBlockTitleStore();C.N_({store:c})}function J(t){const{automationStore:o,environment:e,transaction:n}=t;A.sW({store:o,data:{status:"active"},transaction:n});const a=o.getModel();if((0,v.$K)(a)){const t=(0,T.mc)(e),n=(0,i.TY)({automationModel:a,getRecordModel:o.getRecordModel});(0,i.Rt)(t,n)}}function z(t){const{automationStore:o,environment:e,status:n,transaction:a}=t,r=n??"disabled";A.sW({store:o,data:{status:r},transaction:a}),o.isTriggerType("recurrence")&&A.sW({store:o,data:{run_at:void 0},transaction:a});const c=o.getModel();if((0,v.$K)(c)){const t=(0,T.mc)(e),n=(0,i.TY)({automationModel:c,getRecordModel:o.getRecordModel});(0,i.ai)(t,n)}}function O(t){const{automationStore:o,environment:e,transaction:n}=t;A.sW({store:o,data:{alive:!1},transaction:n});const a=o.getActionStores();for(const i of a)X({automationActionStore:i,automationStore:o,environment:e,transaction:n});const r=o.getModel();if((0,v.$K)(r)){const t=(0,T.mc)(e),n=(0,i.TY)({automationModel:r,getRecordModel:o.getRecordModel});(0,i.uO)(t,n),r.isNotificationType()&&S.xi(e,{type:"granular",source:"collection_view_settings",collection_id:r.parent_id})}}function X(t){const{automationActionStore:o,automationStore:e,environment:n,transaction:a}=t;let r=o.getParentStore();if((0,v.$K)(e)){const t=o.getParentPointer();if(!(0,v.$K)(t))throw new Error("Automation action does not have a parent pointer");if(!s.dr.isEqual(t,e.pointer))throw new Error(`Automation action parent pointer does not match argument: ${s.dr.toKey(t)}, ${s.dr.toKey(e.pointer)}`);r=e}else if(!(0,v.$K)(r))throw new Error("Automation store is undefined");b.hr({childStore:o,parentStore:r,transaction:a});const c=o.getBlockStores();for(const i of c)b.hr({childStore:i,parentStore:o,transaction:a});const d=o.getModel();if((0,v.$K)(d)){const t=(0,T.mc)(n),e=(0,i.Bj)({automationActionModel:d,getRecordModel:o.getRecordModel});(0,i.OK)(t,{automation_action:e,automation_action_id:d.id,automation_id:d.parent_id}),(0,i.co)(t,{automation_action_id:d.id,automation_action_type:d.type,automation_id:r.id})}}}}]);