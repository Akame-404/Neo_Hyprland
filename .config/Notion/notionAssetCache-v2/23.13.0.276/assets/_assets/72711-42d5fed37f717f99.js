"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[72711],{672711:(e,t,n)=>{n.r(t),n.d(t,{DictationAvatar:()=>w,DictationBubble:()=>Z,StopDictationButton:()=>xe,StopDictationButtonMobile:()=>Te,StopDictationListener:()=>Ke,dictationActions:()=>o,hooks:()=>i});var i={};n.r(i),n.d(i,{useIsDictatingToPage:()=>s});var o=n(920939),r=n(886628),a=n(922705);function s(e){return(0,r.VK)((()=>a.TI.state&&(null==e?void 0:e.id)===a.mn.state),[e])}var l=n(733993),c=n(365820),d=n(667294),u=n(800480),h=n(724405),f=n(521273),p=n(526789),g=n(709291),m=n(761045),y=n(152183),x=n(164921),v=n(526388),b=n(486467),S=n(785893);function w(e){let{enableClickToScroll:t=!1,rootStore:n,noMarginRight:i=!1,noOutline:o=!1,noTooltip:l=!1}=e;const c=(0,r.VK)((()=>f.Z.shouldShowAssistantFace()),[]),u=s(n),w=(0,d.useCallback)((e=>c?e.UIUserAvatarSelfBorder:e.accentColors.gray[800]),[c]),C=(0,b.dY)(w,!0),j=(0,h.yK)((e=>({tooltip:{color:e.mediumInvertedTextColor,minWidth:150,paddingTop:2,paddingBottom:2,lineHeight:1.3},microphoneIcon:{width:.55*b.IX,height:.55*b.IX,pointerEvents:"none",color:e.white},avatarContainer:{width:b.IX,height:b.IX,borderRadius:b.IX,backgroundColor:c?e.assistantCornerButtonBackground:e.accentColors.gray[800],display:"grid",placeItems:"center"}})),[c]),k=(0,d.useMemo)((()=>(0,p.q)(j.microphoneIcon)),[j.microphoneIcon]),I=(0,r.VK)((()=>a.CX.state),[]);return!u&&n?null:(0,S.jsx)(v.Z,{textWrap:!0,disableTooltip:l,renderTooltip:()=>(0,S.jsxs)("div",{children:[(0,S.jsx)("div",{children:(0,S.jsx)(g.FormattedMessage,{defaultMessage:"Transcribing your words",id:"topbar.presenceIndicator.dictation.tooltip.description"})}),(0,S.jsx)("div",{style:j.tooltip,children:(0,S.jsx)(g.FormattedMessage,{defaultMessage:"Click to see where",id:"topbar.presenceIndicator.dictation.tooltip.action"})})]}),render:e=>{const n=(0,S.jsx)("div",{style:{...C.avatarOuterOutline,...o?{outline:"none"}:{},...i?{marginRight:0}:{}},children:(0,S.jsx)("div",{style:{...C.avatarBorder,...j.avatarContainer},children:c?(0,S.jsx)(y.P,{variant:"avatar",wrapWithPadding:!1,shadowVariant:"none"}):k})});return t&&I?(0,S.jsx)(x.Z,{...e,onClick:()=>m.hl([I],!0),style:C.button,hoveredStyle:C.buttonHovered,pressedStyle:C.buttonPressed,children:n}):(0,S.jsx)("div",{...e,style:{cursor:"default"},children:n})}})}n(757658);var C=n(151454),j=n(401898),k=n(618574);function I(e){let t=[];return e.nodeType===Node.TEXT_NODE?t.push(e):e.childNodes.forEach((e=>{t=t.concat(I(e))})),t}const T=25;function P(e){let{scrollerStore:t,children:n}=e;const i=(0,r.VK)((()=>a.CX.state),[]),o=(0,r.VK)((()=>t.state.scrollTop),[t]),[s,c]=(0,d.useState)(),[u,h]=(0,d.useState)(),f=(0,k.Si)(t),p=(0,k.nA)(t),g=null==f?void 0:f.scrollerEl(),m=null==g?void 0:g.querySelector(".notion-page-content"),y=null==m?void 0:m.querySelector(`[data-block-id="${i}"]`);(0,d.useEffect)((()=>{a.ZP.setState({...a.ZP.state,dictationBubbleScrollPosition:null==u?void 0:u.top})}),[u]),(0,d.useEffect)((()=>{if(m){let e;const t=new MutationObserver((t=>{(0,j.$K)(e)&&cancelAnimationFrame(e),e=requestAnimationFrame((()=>c(Date.now())))}));return t.observe(m,{subtree:!0,characterData:!0,childList:!0}),()=>{t.disconnect(),(0,j.$K)(e)&&cancelAnimationFrame(e)}}}),[m]),(0,d.useEffect)((()=>{if(g){let e;const t=new ResizeObserver((()=>{(0,j.$K)(e)&&cancelAnimationFrame(e),e=requestAnimationFrame((()=>c(Date.now())))}));return t.observe(g),()=>{t.disconnect(),(0,j.$K)(e)&&cancelAnimationFrame(e)}}}),[g]),(0,d.useLayoutEffect)((()=>{if(!y||!g){const e=setTimeout((()=>{h(void 0)}),200);return()=>{clearTimeout(e)}}{const e=document.createRange(),t=y.querySelector('[data-content-editable-leaf="true"]')??y,n=I(t),i=g.getBoundingClientRect();if(n.length>0){const t=n[n.length-1];e.selectNodeContents(t),e.collapse(!1);const r=e.getBoundingClientRect(),a=r.top+o-i.top+(r.height-T)/2,s=r.right-i.left+5;h({top:a,left:s})}else{const e=t.getBoundingClientRect(),n=window.getComputedStyle(t),r=parseInt(n.lineHeight,10),a=parseInt(n.paddingTop,10),s=isNaN(r)?e.height:r,l=isNaN(a)?0:a,c=e.top+l+o-i.top+(s-T)/2,d=e.left-i.left;h({top:c,left:d})}}}),[y,g,s,o]);const x=(0,j.$K)(u);(0,d.useEffect)((()=>{if(p&&x)switch(p){case"Page":return a.ZP.setState({...a.ZP.state,blockRenderedInPage:!0}),()=>{a.ZP.setState({...a.ZP.state,blockRenderedInPage:!1})};case"PeekView":return a.ZP.setState({...a.ZP.state,blockRenderedInPeekView:!0}),()=>{a.ZP.setState({...a.ZP.state,blockRenderedInPeekView:!1})}}}),[p,x]);const v=(0,d.useRef)(null);return(0,d.useEffect)((()=>{if(!u||!v.current)return;const e=new IntersectionObserver((e=>{const[t]=e;let n;n=t.isIntersecting?"inScreen":t.boundingClientRect.top<0?"above":"below",a.ZP.setState({...a.ZP.state,dictationBubbleRelativeToScreen:n})}),{root:g,rootMargin:"0px",threshold:[0,1]});v.current&&e.observe(v.current);const t=v.current;return()=>{t&&e.unobserve(t)}}),[g,u]),u?(0,S.jsx)(l.E.div,{ref:v,initial:{transform:`translate(${u.left}px, ${u.top}px)`},animate:{transform:`translate(${u.left}px, ${u.top}px)`},transition:{duration:.2},style:{display:"block",position:"absolute",top:0,left:3,width:0,height:0,zIndex:C.lB-1},children:n}):null}var B=n(625675);const K=function(){const e=(0,B._)();(0,d.useEffect)((()=>{(async()=>{await e.start((e=>({y:[0,-7,0],transition:{duration:.6,delay:.15*e,repeat:1/0,repeatDelay:1,ease:"easeInOut"}})))})()}),[e]);const t=(0,h.yK)((e=>({dotStyle:{width:6,height:6,flexShrink:0,backgroundColor:e.icon.quaternary,borderRadius:"50%"}})),[]);return(0,S.jsx)(l.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},style:{display:"flex",justifyContent:"center",alignItems:"center",gap:3},children:[...Array(3)].map(((n,i)=>(0,S.jsx)(l.E.div,{custom:i,animate:e,style:t.dotStyle},i)))})};function Z(e){let{scrollerStore:t}=e;const{isMobile:n}=(0,u.Fy)(),i=(0,r.VK)((()=>a.TI.state),[]),o=(0,r.VK)((()=>a.dg.state),[]);return i?(0,S.jsx)(P,{scrollerStore:t,children:(0,S.jsxs)(l.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[!n&&(0,S.jsx)("div",{style:{position:"absolute",top:0,transform:"translateX(-50%)"},children:(0,S.jsx)(_,{size:23})}),(0,S.jsx)("div",{style:{position:"absolute",top:0,transform:n?"translate(-50%, -85%)":"translate(-50%, -40%)",zIndex:5},children:(0,S.jsx)(w,{noMarginRight:!0,noOutline:!0,noTooltip:!0})}),(0,S.jsx)(c.M,{children:o&&(0,S.jsx)("div",{style:{transform:"translate(25px, 8px)"},children:(0,S.jsx)(K,{})})})]})}):null}function _(e){let{size:t}=e;const n=(0,r.VK)((()=>f.Z.shouldShowAssistantFace()),[]),i=(0,h.yK)((e=>({verticalLine:{height:t,zIndex:1,width:2,borderRadius:15,backgroundColor:n?e.UIUserAvatarSelfBorder:e.accentColors.gray[800]}})),[t,n]);return(0,S.jsx)("div",{style:i.verticalLine})}var E=n(973935),V=n(882855),R=n(411066),M=n(231945),z=n(934700),A=n(639500),F=n(61766),D=n(424042),q=n(319385),O=n(188923),L=(n(348675),n(863408),n(614590),n(103462),n(823767),n(808585),n(68696),n(987325)),N=n(749085),U=n(749650);class $ extends N.default{constructor(){super()}getInitialState(){}setState(e){this.instanceState&&this.instanceState.close(),super.setState(e)}addListener(e){super.addListener(e),this.instanceState||this.setState((0,U.k)(24e3))}removeListener(e){super.removeListener(e),0===this.listenerCount()&&this.setState(void 0)}}const W=new $,X=50,H=7e3,G=(X+H)/2,Y=(X+G)/2,J=(G+H)/2,Q=8;function ee(){const e=(0,r.VK)((()=>a.ZP.state.audioRecorder),[]),t=(0,r.VK)((()=>W.state),[]),[n,i]=(0,d.useState)(new Array(Q).fill(1));(0,d.useEffect)((()=>{if(e&&t){const n=new AbortController,o=n.signal,r=()=>{const{mediaStream:n}=e;if(n){const e=t.createAnalyser();e.fftSize=2048;const r=(()=>{const i=t.createMediaStreamSource(n),o=t.createBiquadFilter();o.type="highpass",o.frequency.setValueAtTime(Y,t.currentTime);const r=t.createBiquadFilter();return r.type="lowpass",r.frequency.setValueAtTime(J,t.currentTime),[i,o,r,e]})();for(let t=0;t<r.length-1;t++)r[t].connect(r[t+1]);const a=()=>{for(const e of r)e.disconnect()};t.resume();const s=new Uint8Array(e.frequencyBinCount),l=()=>{if(o.aborted)return void a();e.getByteFrequencyData(s);const n=t.sampleRate/2/e.frequencyBinCount,r=Math.round(X/n),c=Math.round(H/n),d=s.slice(r,c+1),u=Math.floor(d.length/Q),h=[];for(let e=0;e<Q;e++){const t=d.slice(e*u,e<Q-1?(e+1)*u:d.length+1),n=t.reduce(((e,t)=>e+t),0)/t.length,i=Math.max(1,Math.min(12,n/3));h.push(i)}i(h),requestAnimationFrame(l)},c=requestAnimationFrame(l);return()=>{cancelAnimationFrame(c),a()}}};let a=r();const s=()=>{"function"==typeof a&&a(),a=r()};return e.emitter.on(L.oF,s),()=>{e.emitter.off(L.oF,s),"function"==typeof a&&a(),n.abort()}}}),[e,n.length,t]);const o=(0,h.yK)((e=>({barStyle:{flexShrink:0,bottom:"0",width:"1.5px",backgroundColor:e.icon.primary,borderRadius:"1px"}})),[]);return e?(0,S.jsx)("div",{style:{height:"20px",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",gap:1.3},children:n.map(((e,t)=>(0,S.jsx)("div",{style:{...o.barStyle,height:`${e}px`}},t)))}):(0,S.jsx)("div",{style:{fontSize:"8px"},children:"No audio"})}var te=n(605257),ne=n(584169),ie=n(698519),oe=n(137810),re=n(552275),ae=n(632163),se=n(489728),le=n(672495),ce=n(979546),de=n(439449),ue=n(760031),he=n(742741),fe=n(843250);function pe(e){const t=(0,u.O7)(),{parent:n}=e,i=(0,r.VK)((()=>Object.keys(he.jH).indexOf((0,ue._A)(t.currentUser.id))),[t.currentUser.id]),o=[{key:"languages",render:e=>(0,S.jsx)(le.Z,{...e,topBorder:0!==e.index}),items:(0,ue.TG)().map((e=>{let[i,[o]]=e;const r={key:i,render:e=>(0,S.jsx)(re.Z,{...e,title:o}),action:()=>{(0,ue.Yg)(t,i),n.close()}};return r}))}];return(0,S.jsx)("div",{className:fe.tXr,style:{display:"flex",flexDirection:"column",width:150},children:(0,S.jsx)(ae.Z,{type:ae.i.Vertical,initialFocus:i,sections:o})})}function ge(e){const{languagePopupStore:t}=e,n=(0,u.O7)(),i=(0,r.VK)((()=>(0,ue._A)(n.currentUser.id)),[n.currentUser.id]);(0,d.useEffect)((()=>{ce.ZP.updateMediaDevices()}),[]);const o=(0,h.yK)((e=>({container:{padding:"8px 0px",display:"flex",flexDirection:"column",alignItems:"flex-start",width:300,gap:8},microphoneText:{marginLeft:12,fontSize:12,fontWeight:oe.Z.fontWeight.medium,color:e.text.secondary},microphoneSection:{display:"flex",flexDirection:"column",width:"100%"},languageText:{fontSize:14,color:e.text.primary},languageSection:{padding:"0px 14px",display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},rightChevronStyle:{width:13,height:13,opacity:.5,color:e.icon.secondary},line:{width:"100%",height:1,backgroundColor:e.icon.tertiary,opacity:.3},languageButtonStyle:{fontSize:14,display:"flex",alignItems:"center",gap:10,color:e.text.secondary},helpSection:{padding:"5px 14px",display:"flex",alignItems:"center",justifyContent:"flex-start",gap:4,cursor:"pointer"},helpText:{fontSize:12,color:e.text.tertiary},helpIcon:{width:16,height:16,color:e.icon.tertiary}})),[]),a=(0,d.useMemo)((()=>(0,te.o)(o.rightChevronStyle)),[o.rightChevronStyle]),s=(0,d.useMemo)((()=>(0,ne.m)(o.helpIcon)),[o.helpIcon]);return(0,S.jsxs)("div",{style:o.container,children:[(0,S.jsxs)("div",{style:o.microphoneSection,children:[(0,S.jsx)("div",{style:o.microphoneText,children:"Microphone"}),(0,S.jsx)(me,{})]}),(0,S.jsx)("div",{style:o.line}),(0,S.jsxs)("div",{style:o.languageSection,children:[(0,S.jsx)("div",{style:o.languageText,children:"Language"}),(0,S.jsx)(M.ZP,{buttonPopupStore:t,renderOrigin:e=>(0,S.jsxs)(se.Z,{style:o.languageButtonStyle,...e,children:[i," ",a]}),stopClickPropagation:!0,popupType:M.Z4.Popup,render:e=>(0,S.jsx)(pe,{parent:e})})]}),(0,S.jsx)("div",{style:o.line}),(0,S.jsxs)(l.E.div,{style:o.helpSection,onClick:()=>window.open("https://www.notion.so/help/audio-dictation","_blank"),variants:{hover:{opacity:.6},tap:{opacity:1}},whileHover:"hover",whileTap:"tap",transition:{duration:.2},children:[s,(0,S.jsx)("div",{style:o.helpText,children:"Learn about Dictation"})]})]})}function me(){const e=(0,r.VK)((()=>ce.UR.state),[]),t=(0,r.VK)((()=>ce.TZ.state),[]),n=(0,r.VK)((()=>e.findIndex((e=>e.deviceId===(null==t?void 0:t.deviceId)))),[e,t]),i=[{key:"devices",render:e=>(0,S.jsx)(le.Z,{...e,topBorder:0!==e.index}),items:e.map((e=>({key:e.deviceId,render:n=>(0,S.jsx)(re.Z,{...n,title:e.label,right:e.deviceId===(null==t?void 0:t.deviceId)?(0,ie.k)({width:14,height:14}):void 0}),action:()=>{de.Z.setState(e)}})))}];return(0,S.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:(0,S.jsx)(ae.Z,{type:ae.i.Vertical,initialFocus:n,sections:i})})}const ye=document.body;function xe(e){let{rootStore:t}=e;const n=(0,u.MO)(),i=s(t),c=(0,u.O7)(),f=(0,r.VK)((()=>a.ZP.state.audioRecorder),[]),p=(0,r.qz)(void 0,F.Z),g=(0,r.qz)(void 0,F.Z),{isShowingTabBar:m,isUnifiedTitleBarEnabled:y}=(0,r.VK)((()=>{var e;return{isShowingTabBar:Boolean(D.Z.state.isShowingTabBar),isUnifiedTitleBarEnabled:Boolean(null===(e=D.Z.state.preferences)||void 0===e?void 0:e.isUnifiedTitleBarEnabled)}}),[]),x=(0,r.VK)((()=>q.default.checkGate({gateName:"colorful_presence_avatars"})),[]),v=(0,d.useCallback)((()=>{(0,o.stopDictation)({environment:c,from:"button"})}),[c]),w=(0,d.useCallback)((e=>{null==e||e.stopPropagation(),e&&(0,A.uG)(e)||(g.state.open?g.reset():p.state.open?p.reset():p.setState({...p.state,open:!0}))}),[p,g]),j=(0,r.VK)((()=>"dark"===c.ThemeStore.state.mode),[c]),[k,I]=(0,d.useState)(!1),T=(0,d.useCallback)((()=>{I(!0)}),[]),P=(0,d.useCallback)((()=>{I(!1)}),[]),[B,K]=(0,d.useState)(!1),Z=(0,d.useCallback)((()=>{K(!0)}),[]),_=(0,d.useCallback)((()=>{K(!1)}),[]),L=(0,h.yK)((e=>({dictationButtonStyle:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:25,gap:2,height:24,cursor:"pointer",padding:"6px 2px 6px 2px",backgroundColor:j?"#2D2D2D":"#F1F0EF",...(0,z.X)({noDrag:y?c.device.isElectron&&!m:c.device.isElectronMac&&!m})},downChevronContainer:{display:"flex",alignItems:"center",justifyContent:"center",height:20,width:20,borderRadius:20},downIcon:{fill:B?e.icon.secondary:e.icon.tertiary,width:10,height:10},redSquare:{width:10,height:10,borderRadius:2,backgroundColor:k?j?e.accentColors.red[500]:"rgba(191, 67, 64, 1)":j?e.accentColors.red[700]:e.accentColors.red[500]},redSquareContainer:{width:20,height:20,borderRadius:20,display:"flex",alignItems:"center",justifyContent:"center"}})),[j,y,c.device.isElectron,c.device.isElectronMac,m,B,k]),N=(0,d.useMemo)((()=>(0,V.E)(L.downIcon)),[L.downIcon]),U=(0,r.VK)((()=>{var e;return O.default.isCenterPeekOpen()&&(null===(e=O.default.peekTargetStore.state)||void 0===e?void 0:e.id)!==(null==t?void 0:t.id)}),[null==t?void 0:t.id]),$=(0,d.useRef)(null),[W,X]=(0,d.useState)(null);(0,d.useEffect)((()=>{if(!$.current)return void X(null);const e=$.current.getBoundingClientRect();X({top:e.top+window.scrollY,left:e.left+window.scrollX})}),[U]);const H=(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(R.Z,{style:L.redSquareContainer,onClick:v,onMouseEnter:T,onMouseLeave:P,children:(0,S.jsx)("div",{style:L.redSquare})}),(0,S.jsx)(ee,{}),(0,S.jsx)(R.Z,{className:"notion-dictation-button-up-chevron",style:L.downChevronContainer,onClick:w,onMouseEnter:Z,onMouseLeave:_,children:N})]}),G=(0,b.qh)(c,m,y,x);return i&&f&&!n?(0,S.jsx)("div",{style:{marginLeft:G.marginLeft,marginTop:G.marginTop,marginRight:.5*Number(G.marginLeft)*-1},children:(0,S.jsx)(M.ZP,{buttonPopupStore:p,renderOrigin:()=>(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(l.E.div,{ref:$,className:"notion-dictation-button",style:L.dictationButtonStyle,onClick:v,initial:{opacity:0,x:15},animate:{opacity:1,x:0},transition:{duration:.4},children:H}),U&&(0,E.createPortal)((0,S.jsx)("div",{className:"notion-dictation-button-duplicate",style:{...L.dictationButtonStyle,position:"fixed",top:(null==W?void 0:W.top)||0,left:(null==W?void 0:W.left)||0,zIndex:C.Wd+1},onClick:v,children:H}),ye)]}),stopClickPropagation:!0,popupType:c.device.isMobile?M.Z4.SlideUp:M.Z4.Popup,popupWrapStyle:{top:6},render:()=>(0,S.jsx)(ge,{languagePopupStore:g})})}):null}const ve=(0,n(745238).IU)("stopDictation",{viewBox:"0 0 36 36",svg:(0,S.jsxs)("svg",{width:"36",height:"36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,S.jsx)("rect",{width:"36",height:"36",rx:"18",fill:"#D34F43",fillOpacity:".1"}),(0,S.jsx)("path",{d:"M12.2 21.7v-8.3c0-.5.2-.9.5-1.2.3-.3.7-.4 1.2-.4h8.2c.5 0 .9.1 1.2.4.3.3.5.7.5 1.2v8.3c0 .5-.2.9-.5 1.2-.3.3-.7.4-1.2.4h-8.2c-.5 0-1-.1-1.2-.4-.3-.3-.5-.7-.5-1.2Z",fill:"#D44C47"})]})});var be=n(635622),Se=n(775538),we=n(803418),Ce=n(231104),je=n(869454),ke=n(427328),Ie=n(444388);function Te(){const e=(0,u.O7)(),{isMobileNative:t,isPhone:n}=(0,u.Fy)(),i=(0,r.VK)((()=>{const e=Se.default.state.isOnboarding,t=Ce.Z.state.open,n=we.Z.hasOpenPopups();return e||t||n}),[]),s=(0,r.VK)((()=>!i&&a.ZP.getState().enabled&&!a.ZP.getState().loading),[i]),l=(0,d.useCallback)((()=>{(0,o.stopDictation)({environment:e,from:"mobile_bar_button"})}),[e]);return(0,d.useEffect)((()=>{i&&l()}),[i,l]),function(e){const t=(0,r.VK)((()=>Ie.Z.state),[]);(0,d.useEffect)((()=>{t&&(e(),Ie.Z.reset())}),[t,e])}(l),function(e){const t=(0,u.O7)(),n=(0,r.VK)((()=>{const e=a.P7.state;if(e)return!e.isDictatableBlock()||e.pathIsDead()}),[]),i=(0,r.VK)((()=>!a.w7.state),[]),o=(0,d.useRef)(!0),s=(0,r.VK)((()=>(0,ke.w_)(t.TabbedRouterStore.state)),[t]);(0,d.useEffect)((()=>{(0,j.$K)(n)&&n&&e()}),[n,e]),(0,d.useEffect)((()=>{if(i){const t=setTimeout((()=>{e()}),250);return()=>{clearTimeout(t)}}}),[i,e]),(0,d.useEffect)((()=>{t.device.isMobileNative&&s&&(o.current?o.current=!1:e())}),[t,s,o,e])}(l),s&&t&&n?(0,S.jsx)(Pe,{handleClick:l}):null}function Pe(e){const{handleClick:t}=e,n=(0,u.O7)(),i=(0,be.Z)(!0),o=(0,r.VK)((()=>je.Z.mobileNativeBottomPadding(n)),[n]),[a,s]=(0,r.VK)((()=>[n.WindowSizeStore.getSafePaddingLeftPx(16),n.WindowSizeStore.getSafePaddingRightPx(16)]),[n.WindowSizeStore]),l=(0,h.yK)((e=>({container:{position:"absolute",width:"100%",bottom:o,minHeight:50,paddingTop:"6px",paddingBottom:"6px",paddingRight:s,paddingLeft:a,border:`1px solid ${e.stroke.deemphasized}`,background:e.contentBackground},dictationButtonStyle:{display:"flex",justifyContent:"space-between",verticalAlign:"center",cursor:"pointer",gridAutoFlow:"column",placeItems:"center",gap:10,alignItems:"center"},icon:{color:e.redBadgeBackground},settingsContainer:{display:"flex",alignItems:"center",justifyContent:"center",height:25,width:25,borderRadius:25},settingsContainerHoveredStyle:{background:e.whiteButtonPressedBackground}})),[o,a,s]),c=(0,d.useMemo)((()=>ve({width:36,height:36,...l.icon})),[l.icon]);return(0,S.jsx)("div",{style:{...l.container,zIndex:C.Wd+1},...i,children:(0,S.jsxs)("div",{className:"notion-dictation-button",style:{...l.dictationButtonStyle},children:[(0,S.jsx)("div",{style:{flexGrow:1,maxWidth:36}}),(0,S.jsx)("div",{style:{maxWidth:480,width:"100%",justifyContent:"center",display:"flex",verticalAlign:"middle"},children:(0,S.jsx)(Be,{})}),(0,S.jsx)("div",{onClick:t,children:c})]})})}function Be(){const e=(0,r.VK)((()=>a.ZP.state.audioRecorder),[]),t=(0,r.VK)((()=>W.state),[]),n=(0,r.VK)((()=>({lowshelf_filter_frequency:q.default.getConfigKey("mobile_dictation_visualizer","lowshelf_filter_frequency"),lowshelf_filter_gain:q.default.getConfigKey("mobile_dictation_visualizer","lowshelf_filter_gain"),fft_size:q.default.getConfigKey("mobile_dictation_visualizer","fft_size"),trim_threshold:q.default.getConfigKey("mobile_dictation_visualizer","trim_threshold"),min_hz:q.default.getConfigKey("mobile_dictation_visualizer","min_hz"),max_hz:q.default.getConfigKey("mobile_dictation_visualizer","max_hz")})),[]),i=(0,d.useRef)(null);return(0,d.useEffect)((()=>{if(e&&t){const o=new AbortController,r=o.signal,a=()=>{const{mediaStream:o}=e;if(o){const e=t.createMediaStreamSource(o),a=t.createBiquadFilter();a.type="lowshelf",a.frequency.setValueAtTime(n.lowshelf_filter_frequency,t.currentTime),a.gain.setValueAtTime(n.lowshelf_filter_gain,t.currentTime);const s=t.createAnalyser();s.fftSize=n.fft_size,e.connect(a),a.connect(s),t.resume();const l=new Uint8Array(s.frequencyBinCount),c=()=>{if(r.aborted)return e.disconnect(),void a.disconnect();s.getByteFrequencyData(l);const o=t.sampleRate/2/s.frequencyBinCount,u=n.min_hz??0,h=n.max_hz?Math.round(n.max_hz/o):l.length,f=l.slice(u,h),p=i.current,g=null==p?void 0:p.getContext("2d");if(p&&g){const e=window.devicePixelRatio||1,t=p.getBoundingClientRect();p.width=t.width*e,p.height=t.height*e,g.scale(e,e);const i=4;p.height=30*i;const o=p.width,r=p.height,a=1*i;g.clearRect(0,0,o,r);const s=o/(a+i),l=Math.min(1,f.length/s);let c=0;for(let d=0;d<f.length;d++){const e=f[d*l],t=.05*Math.random(),s=(null==n?void 0:n.trim_threshold)??40,u=(Math.max(e,s)-s)/(255-s),h=Math.max(.05,u>0?u+t:0)*r;if(g.fillStyle="rgb(128,128,128)",c+a<=o&&g.fillRect(c,r/2-h/2,a,h),c+=a+i,c>=o)break}}d=requestAnimationFrame(c)};let d=requestAnimationFrame(c);return()=>{cancelAnimationFrame(d),e.disconnect(),a.disconnect()}}};let s=a();const l=()=>{"function"==typeof s&&s(),s=a()};return e.emitter.on(L.oF,l),()=>{e.emitter.off(L.oF,l),"function"==typeof s&&s(),o.abort()}}}),[e,t,n]),e?(0,S.jsx)("canvas",{ref:i,style:{width:"100%",height:30}}):(0,S.jsx)("div",{style:{fontSize:8},children:"No audio recorder available"})}function Ke(){const e=(0,u.O7)(),t=(0,r.VK)((()=>{const e=a.P7.state;if(e)return!e.isDictatableBlock()||e.pathIsDead()}),[]),n=(0,r.VK)((()=>!a.w7.state),[]);return(0,d.useEffect)((()=>{(0,j.$K)(t)&&t&&(0,o.stopDictation)({environment:e})}),[t,e]),(0,d.useEffect)((()=>{if(n){const t=setTimeout((()=>{(0,o.stopDictation)({environment:e})}),350);return()=>{clearTimeout(t)}}}),[n,e]),null}},625675:(e,t,n)=>{n.d(t,{_:()=>c});var i=n(45487),o=n(914330),r=n(896912);function a(){let e=!1;const t=new Set,n={subscribe:e=>(t.add(e),()=>{t.delete(e)}),start(n,o){(0,i.k)(e,"controls.start() should only be called after a component has mounted. Consider calling within a useEffect hook.");const a=[];return t.forEach((e=>{a.push((0,r.d)(e,n,{transitionOverride:o}))})),Promise.all(a)},set:n=>((0,i.k)(e,"controls.set() should only be called after a component has mounted. Consider calling within a useEffect hook."),t.forEach((e=>{(0,o.gg)(e,n)}))),stop(){t.forEach((e=>{!function(e){e.values.forEach((e=>e.stop()))}(e)}))},mount:()=>(e=!0,()=>{e=!1,n.stop()})};return n}var s=n(996681),l=n(158868);const c=function(){const e=(0,s.h)(a);return(0,l.L)(e.mount,[]),e}}}]);