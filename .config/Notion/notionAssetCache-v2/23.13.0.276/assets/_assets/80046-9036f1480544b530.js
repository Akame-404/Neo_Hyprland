"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[80046],{68500:(e,t,o)=>{o.d(t,{Q:()=>N});var r=o(667294),n=o(800480),l=o(886628),s=o(724405),a=o(266897),u=o(114714),i=o(399036),c=o(775e3),d=o(396367),p=o(421202),g=o(606287),m=o(709291),h=o(653965),y=o(401898),S=o(137810),f=o(547307),v=o(566890),x=o(296994),C=o(823586),b=o(492658),j=o(741195),R=o(460709),V=o(675822),Z=o(229798),F=o(206258),M=o(436488),G=o(374194),I=o(268894),P=o(478140),w=o(632163),k=o(743765),B=o(158297),L=o(511470),E=o(672495),_=o(493131),K=o(197680),W=o(785893);function N(e){const{onChange:t,currentGroups:o,groupBy:s,groupFormat:a,onClose:i,schema:c,parentStore:d}=e,p=(0,l.qz)(void 0,b.Z),g=(0,l.qz)(void 0,Z.Z),h=(0,n.Fy)(),y=(0,r.useCallback)((()=>{z({onChange:t,currentGroups:o,groupBy:s,groupFormat:a,inputStore:p,onClose:i})}),[o,s,a,p,t,i]);let S;return(0,r.useEffect)((()=>{var e;a&&("select"===a.value.type||"multi_select"===a.value.type)&&a.value.value?p.setState({...p.state,inputValue:a.value.value}):a&&(0,u.R7)(a.value)&&"exact"===(null===(e=a.value.value)||void 0===e?void 0:e.type)&&p.setState({...p.state,inputValue:a.value.value.value})}),[a,p]),S=h.isMobile?{menuType:R.og.Modal,title:a?(0,W.jsx)(m.FormattedMessage,{defaultMessage:"Rename group",id:"codeBlock.databaseEditGroupMenu.renameGroupTitle"}):(0,W.jsx)(m.FormattedMessage,{defaultMessage:"Add a group",id:"codeBlock.databaseEditGroupMenu.addGroupTitle"}),left:(0,W.jsx)(m.FormattedMessage,{defaultMessage:"Cancel",id:"codeBlock.databaseEditGroupMenu.cancelButton.label"}),right:(0,W.jsx)(m.FormattedMessage,{defaultMessage:"Done",id:"codeBlock.databaseEditGroupMenu.doneButton.label"}),onClickRight:y,onClickLeft:i}:{menuType:R.og.Popup,width:A(s)?300:240,maxHeight:"50vh"},(0,W.jsx)(M.Z,{capture:!0,render:e=>(0,W.jsx)(P.Z,{...S,...e,children:(0,W.jsx)(Y,{groupBy:s,schema:c,onChange:t,currentGroups:o,groupFormat:a,onClose:i,parentStore:d,inputStore:p,menuListStore:g})})})}function T(){return(0,W.jsx)(m.FormattedMessage,{defaultMessage:"Group already exists.",id:"database.groupExistsAlreadyError.message"})}function A(e){return"select"===e.type||"multi_select"===e.type||(0,u.HB)(e.type)}function D(e){let{currentGroups:t,onChange:o,groupFormat:r,onClose:s,inputStore:i,menuListStore:c}=e;const d=(0,n.O7)(),p=(0,m.useIntl)(),g=(0,l.qz)(c,Z.Z),y=(0,l.qz)(i,b.Z),S=(0,l.VK)((()=>y.state.inputValue),[y]);return(0,W.jsx)(C.Z,{request:S,performRequest:e=>async function(e,t){const o=await x.FF.searchActions.load();return(await o.searchVisibleSpaceUsers({environment:t,query:e,membersOnly:!1})).slice(0,20)}(e,d),debounce:V.vp,render:(e,n,l)=>{n||(n=[]);const i=h.oA(n.map((e=>({key:e.id,render:t=>(0,W.jsx)(K.Z,{actor:(0,a.dp)(e),...t}),action:()=>{const n={type:"person",value:{table:"notion_user",id:e.id}};return r&&h.Xy(n,r.value)?(null==s||s(),null):t.some((e=>(0,u.we)(n,e.value)))?(f.showErrorMessage((0,W.jsx)(T,{})),null):void o({newGroupValue:n})}}))));let c;return c=l&&n&&0===i.length?(0,W.jsx)(E.Z,{children:(0,W.jsx)(k.Z,{title:(0,W.jsx)(m.FormattedMessage,{defaultMessage:"No results",id:"database.noPersonSearchResults.message"})})}):(0,W.jsx)(w.Z,{type:w.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>(0,W.jsx)(E.Z,{...e}),items:i}],store:g}),(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(E.Z,{children:(0,W.jsx)(I.ZP,{value:S,focus:!0,placeholder:p.formatMessage({defaultMessage:"Search for a personâ€¦",id:"database.searchPerson.placeholder"}),onChange:e=>{y.setState({...y.state,inputValue:e.target.value}),g.setState({...g.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}})}),c]})}})}function U(e,t,o,r,n,l){const s=o[r.property];if(!s||"relation"!==s.type)return null;const a=i.j0(s);if(!a)return null;const u=F.NW.createChildStore(t,a);return u.isDefined()&&l.length>0?{key:"new-page",render:e=>(0,W.jsx)(_.Z,{targetCollectionStore:u,pageName:l,...e}),action:()=>{const t=(0,j.TS)({environment:e,table:p.iU,spaceId:u.getSpaceId()}),o={table:p.iU,id:t,spaceId:u.getSpaceId()};n({newGroupValue:{type:"relation",value:o},newPage:{id:o.id,spaceId:o.spaceId,name:l}})}}:null}function z(e){let{onChange:t,currentGroups:o,groupBy:r,groupFormat:n,inputStore:l,onClose:s}=e;const a=l.state.inputValue.trim().replace(/,/g,"");let i;"select"===r.type||"multi_select"===r.type?i={type:r.type,value:a}:(0,u.aB)(r)&&(i={type:r.type,value:{type:"exact",value:a}}),i&&a?n&&h.Xy(i,n.value)?null==s||s():o.some((e=>i&&(0,u.we)(i,e.value)))?f.showErrorMessage((0,W.jsx)(T,{})):t({newGroupValue:i}):null==s||s()}function q(e,t,o,r,n,l,s,a,i){const c=null==i?void 0:i.relativeVariableStore.state,p=c&&c[t.id],g=(e,o)=>{const n=F.NW.createChildStore(r,t);if(!n.isDefined())return;const l=n.getFormat().app_config_uri;return l&&o?e.formatMessage(d.qB[l][o].messageDescriptor):void 0};return e.map((e=>{const t=F.G.createChildStore(r,e);if(t.isTemplate())return;const i=p?(0,d.P8)(t.id,p):void 0;return{key:t.id,render:e=>(0,W.jsx)(L.Z,{store:t,titlePrefix:g(n,i),...e}),action:()=>{let t={type:"relation",value:e};i&&(t={type:"relation",value:{type:"relative",value:{type:"builtin",variable:i}}}),s&&h.Xy(t,s.value)?null==a||a():o.some((e=>(0,u.we)(t,e.value)))?f.showErrorMessage((0,W.jsx)(T,{})):l({newGroupValue:t})}}}))}function H(e){let{onChange:t,currentGroups:o,groupBy:a,groupFormat:u,onClose:i,inputStore:d,menuListStore:p}=e;const g=(0,m.useIntl)(),h=(0,s.Fg)(),y=(0,r.useCallback)((()=>z({onChange:t,currentGroups:o,groupBy:a,groupFormat:u,inputStore:d,onClose:i})),[t,o,a,u,d,i]),f=(0,r.useCallback)((e=>function(e,t,o,r,n,l,s){13===e.keyCode?z({onChange:t,currentGroups:o,groupBy:r,groupFormat:n,inputStore:l,onClose:s}):27===e.keyCode&&(null==s||s())}(e,t,o,a,u,d,i)),[t,o,a,u,d,i]),v=(0,r.useCallback)((e=>function(e,t,o){t.setState({...t.state,inputValue:e.target.value}),o.setState({...o.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}(e,d,p)),[d,p]),x=(0,l.VK)((()=>d.state.inputValue),[d]),C=(0,n.MO)(),b=u?g.formatMessage({id:"database.collectionEditGroupMenu.renameGroupLabel.placeholder",defaultMessage:"Rename group"}):g.formatMessage({id:"database.collectionEditGroupMenu.newGroupLabel.placeholder",defaultMessage:"New group"});return C?(0,W.jsx)(E.Z,{children:(0,W.jsx)(I.ZP,{value:x,focus:!0,selectAll:!0,showClearButton:!1,focusInitial:!0,placeholder:b,onChange:v,onKeyDown:f})}):(0,W.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:6,width:"100%",background:h.inputBackground},children:[(0,W.jsx)(G.Z,{value:x,focus:!0,selectAll:!0,focusInitial:!0,placeholder:b,onChange:v,onKeyDown:f,format:G.B.Transparent,style:{fontSize:S.Z.fontSize.UIRegular.desktop}}),(0,W.jsxs)(B.Z,{onClick:y,children:[(0,W.jsx)(m.FormattedMessage,{defaultMessage:"Done",id:"database.collectionEditGroupMenu.submitButton.label"}),(0,c.U)({height:14,width:14,fill:"currentColor",marginLeft:6,marginTop:2})]})]})}function O(e){let{parentStore:t,schema:o,groupBy:s,currentGroups:a,onChange:u,groupFormat:c,onClose:d,inputStore:m,menuListStore:h}=e;const y=(0,n.O7)(),S=(0,l.VK)((()=>m.state.inputValue),[m]),f=(0,r.useMemo)((()=>{const e=o[s.property];return!(!e||"relation"!==e.type)&&i.j0(e)}),[s.property,o]);return(0,l.VK)((()=>{if(!f)return!1;return F.NW.createChildStore(t,f).isDefined()}),[f,t])&&f?(0,W.jsx)(C.Z,{request:S,performRequest:e=>async function(e,t,o,r,n){const l=o[t.property];if(!l||!(0,i.p_)(l))return;const s=l.collection_pointer;if(!s)return;const a=F.NW.createChildStore(r,{table:g.vF,id:s.id});if(await a.load(),!a.isDefined())return;const u=a.getSpaceId(),c=await x.FF.searchActions.load();return(await c.searchPagesInCollection({environment:n,query:e,collectionId:s.id,spaceId:u,excludeTemplates:!0,source:"collection_group_value",limit:20,includePublicPagesWithoutExplicitAccess:!0,boostRecentlyViewedPages:!1})).results.map((e=>({table:p.iU,id:e,spaceId:u})))}(e,s,o,t,y),debounce:V.vp,render:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;return(0,W.jsx)(Q,{ready:n,results:r,parentStore:t,schema:o,groupBy:s,currentGroups:a,onChange:u,groupFormat:c,onClose:d,inputStore:m,menuListStore:h,collectionPointer:f,environment:y})}}):null}function Q(e){let{parentStore:t,schema:o,groupBy:n,currentGroups:s,onChange:a,groupFormat:u,onClose:i,inputStore:c,menuListStore:d,results:p,ready:g,collectionPointer:y,environment:S}=e;const f=(0,m.useIntl)(),x=(0,r.useContext)(v.cu),C=(0,l.VK)((()=>c.state.inputValue),[c]),b=(0,l.VK)((()=>h.oA([...q(p,y,s,t,f,a,u,i,x),U(S,t,o,n,a,C)])),[S,x,y,s,n,u,C,f,a,i,t,p,o]);let j;return j=g&&p&&0===b.length?(0,W.jsx)(E.Z,{children:(0,W.jsx)(k.Z,{title:(0,W.jsx)(m.FormattedMessage,{defaultMessage:"No results",id:"database.noRelationSearchResults.message"})})}):(0,W.jsx)(w.Z,{type:w.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>(0,W.jsx)(E.Z,{...e}),items:b}],store:d}),(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(E.Z,{children:(0,W.jsx)(I.ZP,{value:C,focus:!0,placeholder:f.formatMessage({defaultMessage:"Type to search...",id:"database.searchRelation.placeholder"}),onChange:e=>{c.setState({...c.state,inputValue:e.target.value}),d.setState({...d.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}})}),j]})}function Y(e){let{groupBy:t,schema:o,onChange:r,currentGroups:n,groupFormat:l,onClose:s,parentStore:a,inputStore:i,menuListStore:c}=e;return o[t.property]?"select"===t.type||"multi_select"===t.type?(0,W.jsx)(H,{onChange:r,currentGroups:n,groupBy:t,groupFormat:l,onClose:s,inputStore:i,menuListStore:c}):"person"===t.type?(0,W.jsx)(D,{currentGroups:n,onChange:r,groupFormat:l,onClose:s,inputStore:i,menuListStore:c}):"relation"===t.type?(0,W.jsx)(O,{parentStore:a,schema:o,groupBy:t,currentGroups:n,onChange:r,groupFormat:l,onClose:s,inputStore:i,menuListStore:c}):(0,u.HB)(t.type)?(0,W.jsx)(H,{onChange:r,currentGroups:n,groupBy:t,groupFormat:l,onClose:s,inputStore:i,menuListStore:c}):"number"===t.type||"status"===t.type||"date"===t.type||"formula"===t.type||"checkbox"===t.type||"created_time"===t.type||"last_edited_time"===t.type||"created_by"===t.type||"last_edited_by"===t.type||"last_visited_time"===t.type||"location"===t.type?null:void(0,y.t1)(t.type):null}},538769:(e,t,o)=>{o.d(t,{Z:()=>U});var r=o(667294),n=o(800480),l=o(886628),s=o(724405),a=o(266897),u=o(815145),i=o(114714),c=o(399036),d=o(180951),p=o(984619),g=o(89767),m=o(423512),h=o(396367),y=o(709291),S=o(401898),f=o(137810),v=o(805149),x=o(416732),C=o(110906),b=o(628020),j=o(892918),R=o(426991),V=o(425044),Z=o(484210),F=o(729376),M=o(80444),G=o(61766),I=o(206258),P=o(68500),w=o(374617),k=o(164921),B=o(231945),L=o(260458),E=o(584076),_=o(731278),K=o(776798),W=o(526388),N=o(992864),T=o(125845),A=o(122084),D=o(785893);const U=function(e){let{schema:t,groupFormat:o,collectionContextStore:r,isHiddenGroup:n,style:s,uncategorizedIconStyle:a,currentGroups:u,groupBy:i,onChange:d,onClose:p,disabled:g}=e;const m=(0,l.qz)(void 0,G.Z),h=(0,l.VK)((()=>{const e=r.groupsStore.getGroupState(o);return null==e?void 0:e.groupUiParentStore}),[r,o]),y=(0,l.VK)((()=>{const e=t[o.property];if(e&&(0,c.p_)(e)&&h)return(0,F.ke)(e,h)}),[t,o,h]),S=o.value,f=void 0===S.value,v=t[o.property];if(!v)return null;if(f)return(0,D.jsx)(oe,{groupFormat:o,schema:t,isHiddenGroup:n,collectionContextStore:r,style:s,uncategorizedIconStyle:a,parentStore:h});if("formula"===S.type){if("formula"!==S.type)return null;const e=S.value;return e?(0,D.jsx)(de,{schema:t,currentGroups:u,groupBy:i,groupFormat:o,onChange:d,onClose:p,disabled:g,style:s,isHiddenGroup:n,collectionContextStore:r,buttonPopupStore:m,parentStore:h,relatedCollectionAppConfigUri:y,groupValue:e,propertySchema:v}):null}return(0,D.jsx)(de,{schema:t,currentGroups:u,groupBy:i,groupFormat:o,onChange:d,onClose:p,disabled:g,style:s,isHiddenGroup:n,collectionContextStore:r,buttonPopupStore:m,parentStore:h,relatedCollectionAppConfigUri:y,groupValue:S,propertySchema:v})},z={overflow:"hidden",padding:3,borderRadius:4,fontWeight:f.Z.fontWeight.medium};function q(e){const{isHiddenGroup:t}=e;return t?(0,D.jsx)(H,{...e,tooltipEvents:void 0}):(0,D.jsx)(W.Z,{renderTooltip:()=>(0,D.jsx)(y.FormattedMessage,{defaultMessage:"Any items with an empty <b>{name}</b> property will go here. This group cannot be removed.",values:{name:null,b:e=>(0,D.jsx)("span",{style:{fontWeight:f.Z.fontWeight.semibold},children:e})},id:"database.boardView.uncategorizedColumnTooltip"}),style:{width:240},textWrap:!0,render:t=>(0,D.jsx)(H,{...e,tooltipEvents:t})})}function H(e){const t={display:"flex",alignItems:"center",fontSize:14,lineHeight:1.2,paddingLeft:2,paddingRight:4,whiteSpace:"nowrap",overflow:"hidden",fontWeight:f.Z.fontWeight.medium},{style:o,uncategorizedIconStyle:r,tooltipEvents:n,formattedLabelMessage:l}=e;return(0,D.jsxs)("div",{style:{...t,paddingLeft:0,...o},...n,children:[(0,g.R)({width:14,marginLeft:6,marginRight:6,...r}),(0,D.jsx)("span",{style:{...f.Z.textOverflowStyle},children:l})]})}function O(e){let{value:t}=e;return"other"===t.type?(0,D.jsx)(y.FormattedMessage,{defaultMessage:"Other",id:"database.collectionGroupValue.textGroup.other"}):"alphabet_prefix"===t.type||"exact"===t.type?(0,D.jsx)(D.Fragment,{children:t.value}):void(0,S.t1)(t)}function Q(e){let{groupFormat:t,schema:o}=e;const r=o[t.property];if(!r||"status"!==r.type)return null;const n=t.value;if(n.type!==r.type)return null;const{value:l}=n;if(!l)return null;const s=r.options??[],a=r.groups??[];if("by_group"===l.type){const e=a.find((e=>e.name===l.group));return e?(0,D.jsx)(w.r_,{group:e,style:{fontWeight:500},showIcon:!0,showColor:!0}):null}if("by_option"===l.type){const e=(0,d.i7)(s,l.option),t=e&&a.find((t=>{var o;return null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id)}));return e?(0,D.jsx)("span",{style:{fontWeight:500,lineHeight:"normal",overflow:"hidden",paddingRight:6},children:(0,D.jsx)(A.F,{format:p.lo.Medium,isSingle:!0,value:e.value,color:e.color,showRemoveButton:!1,groupColor:null==t?void 0:t.color})}):null}(0,S.t1)(l)}function Y(e){let{value:t}=e;const o=(0,y.useIntl)();return(0,D.jsx)(D.Fragment,{children:(0,j.fZ)({intl:o,value:t})})}function X(e){let{value:t,format:o}=e;const r=(0,y.useIntl)();return(0,D.jsx)(D.Fragment,{children:(0,j.xg)({intl:r,value:t,format:o})})}function $(e){let{groupValue:t,propertySchema:o,style:r}=e;const n=(0,s.yK)((()=>({checkboxStyle:{display:"inline-flex",marginRight:6},wrapperStyle:{fontWeight:f.Z.fontWeight.medium,marginRight:3,display:"flex",alignItems:"center"}})),[]);return"checkbox"!==t.type?null:(0,D.jsxs)("div",{style:{...f.Z.textOverflowStyle,...n.wrapperStyle,...r},children:[(0,D.jsx)(L.Z,{checked:t.value,checkSize:10,size:14,disabled:!0,style:n.checkboxStyle}),(0,D.jsx)("span",{children:null==o?void 0:o.name})]})}function J(e){let{groupValue:t,style:o}=e;return(0,i.Mc)(t)&&t.value?(0,D.jsx)("div",{style:{...te,...f.Z.textOverflowStyle,...o},children:(0,D.jsx)(Y,{value:t.value})}):null}function ee(e){let{groupValue:t,propertySchema:o,style:r}=e;if("number"!==t.type||!t.value)return null;const n=(null==o?void 0:o.number_format)||m.dk;return(0,D.jsx)("div",{style:{...te,...r},children:(0,D.jsx)(X,{value:t.value,format:n})})}const te={overflow:"hidden",padding:3,paddingRight:6,borderRadius:4,fontWeight:f.Z.fontWeight.medium};function oe(e){let{groupFormat:t,schema:o,isHiddenGroup:r,collectionContextStore:n,style:s,uncategorizedIconStyle:a,parentStore:u}=e;const i=o[t.property],d=(0,l.VK)((()=>n.collectionStore()),[n]),p=(0,l.VK)((()=>{let e=!1;return null!=d&&d.isDefined()&&i&&(0,c.p_)(i)&&u&&(e=(0,V.O)({collectionStore:d,property:t.property,propertySchema:i,parentStore:u})),e}),[d,t,i,u]);if(!i)return null;const{name:g}=i;return p?(0,D.jsx)(q,{style:s,uncategorizedIconStyle:a,isHiddenGroup:r,formattedLabelMessage:(0,D.jsx)(y.FormattedMessage,{...V.u.sprintUncategorizedGroup,values:{name:g}})}):(0,D.jsx)(q,{style:s,uncategorizedIconStyle:a,isHiddenGroup:r,formattedLabelMessage:(0,D.jsx)(y.FormattedMessage,{...j.nX.emptyGroupLabel,values:{name:g}})})}function re(e){let{style:t,collectionContextStore:o,groupValue:r,parentStore:n}=e;const s=(0,l.VK)((()=>{var e;return null===(e=o.collectionViewBlockStore())||void 0===e?void 0:e.id}),[o]),a=n&&"location"===r.type&&r.value?I.NW.createChildStore(n,r.value):void 0,i=(0,l.VK)((()=>null==a?void 0:a.getParentBlockStore()),[a]),c=(0,l.VK)((()=>{let e=u.tY.LocationProperty;return s?((0,b.qG)(s)&&(e=o.isInHomeWidgetStore.state?u.tY.PersonalHomeTileTasks:u.tY.PersonalHomePageTasks),e):e}),[s,o]),d=(0,l.VK)((()=>i?(0,Z.ZP)({store:i,fullyQualified:!1,pageVisitSource:c}):void 0),[i,c]),p=(0,l.VK)((()=>null==a?void 0:a.getIcon()),[a]);return"location"===r.type&&r.value&&n&&a?(0,D.jsxs)(E.Z,{href:d,style:{...t,display:"flex"},ignoreLocalHoverState:!0,children:[(0,D.jsx)(_.Z,{disabled:!0,icon:p,size:20,isEmptyPage:!1,style:{marginTop:2,marginRight:6}}),(0,D.jsx)(K.Z,{store:a,underline:!0,style:{fontWeight:f.Z.fontWeight.medium}})]}):null}function ne(e){let{groupValue:t,schema:o,groupFormat:r,collectionContextStore:n,style:s,parentStore:a,relatedCollectionAppConfigUri:u}=e;const d=o[r.property],p=d&&"relation"===d.type?c.j0(d):void 0,g=a&&p?I.NW.createChildStore(a,p):void 0,m=(0,l.VK)((()=>null==g?void 0:g.isDefined()),[g]);return a&&"relation"===t.type&&d&&"relation"===d.type&&p&&g&&m&&t.value?(0,i.t2)(t.value)?u?(0,D.jsx)(le,{relatedCollectionAppUri:u,groupValueInner:t.value,collectionContextStore:n,collectionPointer:p,targetCollectionStore:g,parentStore:a,style:s}):null:(0,i.RA)(t.value)?(0,D.jsx)(se,{parentStore:a,groupValueInner:t.value,collectionContextStore:n}):null:null}function le(e){var t;let{relatedCollectionAppUri:o,groupValueInner:r,collectionContextStore:n,collectionPointer:s,targetCollectionStore:a,parentStore:i,style:c}=e;const d=(0,y.useIntl)(),p=r.value.variable,g=(0,l.VK)((()=>a.isDefined()),[a]),m=(0,l.VK)((()=>(0,R.As)(n,p,s,a)),[n,p,s,a]),b=(0,l.VK)((()=>M.default.state.mainEditorCurrentBlockStore),[]),j=(0,l.VK)((()=>m?C.mb({store:m,mainEditorCurrentBlockStore:b,collectionContextStore:n})??(0,Z.ZP)({store:m,pageVisitSource:u.tY.LinkInPage}):void 0),[m,b,n]);let V;"current"===p?V=d.formatMessage(x.sY.tasksCurrentSprintV2ViewNamePrefix):"next"===p?V=d.formatMessage(x.sY.tasksNextSprintV2ViewNamePrefix):"last"===p?V=d.formatMessage(x.sY.tasksLastSprintV2ViewNamePrefix):(0,S.t1)(p);const F=null===(t=h.qB[o])||void 0===t?void 0:t[p];if(g){if(!m)return(0,D.jsx)("div",{style:{fontWeight:f.Z.fontWeight.medium},children:(0,D.jsx)(y.FormattedMessage,{...null==F?void 0:F.messageDescriptor})});if(m)return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)("div",{style:{fontWeight:f.Z.fontWeight.medium,marginBottom:.25},children:[V,":"]}),(0,D.jsx)(E.Z,{style:{...c,marginLeft:1},innerStyle:{...te},href:j,onClick:()=>{v.E3({collectionSettingsStore:n.settingsStore})},children:(0,D.jsx)(T.Z,{format:N.ZP.Format.Medium,blockId:m.id,isSingle:!0,shouldShrink:!0,parentStore:i})})]})}return(0,D.jsx)("div",{style:{fontWeight:f.Z.fontWeight.medium,marginBottom:.25},children:(0,D.jsx)(y.FormattedMessage,{...null==F?void 0:F.messageDescriptor})})}function se(e){let{parentStore:t,groupValueInner:o,collectionContextStore:r,style:n}=e;const s=I.G.createChildStore(t,o),a=(0,l.VK)((()=>M.default.state.mainEditorCurrentBlockStore),[]),i=(0,l.VK)((()=>C.mb({store:s,mainEditorCurrentBlockStore:a,collectionContextStore:r})??(0,Z.ZP)({store:s,pageVisitSource:u.tY.LinkInPage})),[s,a,r]);return(0,D.jsx)(E.Z,{style:n,innerStyle:{...te},href:i,onClick:()=>{v.E3({collectionSettingsStore:r.settingsStore})},children:(0,D.jsx)(T.Z,{format:N.ZP.Format.Medium,blockId:o.id,isSingle:!0,shouldShrink:!0,parentStore:t})})}function ae(e){let{schema:t,currentGroups:o,groupBy:r,groupFormat:n,onChange:l,onClose:s,buttonPopupStore:a,parentStore:u}=e;return u?(0,D.jsx)(P.Q,{groupFormat:n,groupBy:r,currentGroups:o,schema:t,onChange:e=>{a.reset(),null==l||l(e)},onClose:()=>{a.reset(),null==s||s()},parentStore:u}):null}function ue(e){var t;let{schema:o,currentGroups:l,groupBy:s,groupFormat:a,onChange:u,onClose:i,disabled:g,style:m,buttonPopupStore:h,parentStore:y}=e;const S=(0,n.O7)(),f=(0,r.useCallback)((()=>(0,D.jsx)(ae,{schema:o,currentGroups:l,groupBy:s,groupFormat:a,onChange:u,onClose:i,buttonPopupStore:h,parentStore:y})),[o,l,s,a,u,i,h,y]),v=o[a.property];if(!v||!c.cu(v))return null;const x=a.value;if(null===(t=v.options)||void 0===t||!t.length||void 0===x.value||x.type!==v.type)return null;const C=(0,d.i7)(v.options,x.value);return C?(0,D.jsx)(B.ZP,{render:f,disabled:g,buttonPopupStore:h,popupType:S.device.isMobile?B.Z4.SlideUp:B.Z4.Popup,originGap:4,renderOrigin:e=>(0,D.jsx)(k.Z,{style:{...te,...m},disabled:g,...e,children:(0,D.jsx)(A.a,{format:p.lo.Medium,isSingle:!0,value:C.value,color:C.color,showRemoveButton:!1})})}):null}function ie(e){let{groupValue:t,schema:o,currentGroups:s,groupBy:u,groupFormat:c,onChange:d,onClose:p,disabled:g,style:m,isHiddenGroup:h,buttonPopupStore:y,parentStore:S}=e;const f=(0,n.O7)(),v=(0,r.useCallback)((()=>(0,D.jsx)(ae,{schema:o,currentGroups:s,groupBy:u,groupFormat:c,onChange:d,onClose:p,buttonPopupStore:y,parentStore:S})),[o,s,u,c,d,p,y,S]),{value:x}=t,C=(0,l.VK)((()=>t.value&&(0,i.q6)(t)&&S?(0,a.Hl)({pointer:t.value,getRecordValue:S.getRecordValue}):void 0),[t,S]);return(0,i.q6)(t)&&x&&S&&null!=C&&C.asActor?(0,D.jsx)(B.ZP,{render:v,disabled:g,buttonPopupStore:y,popupType:f.device.isMobile?B.Z4.SlideUp:B.Z4.Popup,originGap:4,renderOrigin:e=>(0,D.jsx)(k.Z,{style:{...te,...m},disabled:g,...e,children:(0,D.jsx)(N.ZP,{format:N.ZP.Format.Medium,actor:C,showRemoveButton:!1,isSingle:!0,disableAvatarTooltip:h,shouldShrink:!0})})}):null}function ce(e){let{groupValue:t,schema:o,currentGroups:l,groupBy:s,groupFormat:a,onChange:u,onClose:c,disabled:d,style:p,buttonPopupStore:g,parentStore:m}=e;const h=(0,n.O7)(),y=(0,r.useCallback)((()=>(0,D.jsx)(ae,{schema:o,currentGroups:l,groupBy:s,groupFormat:a,onChange:u,onClose:c,buttonPopupStore:g,parentStore:m})),[o,l,s,a,u,c,g,m]);if(!(0,i.R7)(t))return null;if(void 0!==t.value){const e=(0,D.jsx)(O,{value:t.value});return"exact"===t.value.type?(0,D.jsx)(B.ZP,{render:y,disabled:d,buttonPopupStore:g,popupType:h.device.isMobile?B.Z4.SlideUp:B.Z4.Popup,originGap:4,renderOrigin:t=>(0,D.jsx)(k.Z,{style:{...z,...f.Z.textOverflowStyle,...p},disabled:d,...t,children:e})}):(0,D.jsx)("div",{style:z,children:e})}return null}function de(e){let{groupValue:t,propertySchema:o,schema:r,currentGroups:n,groupBy:l,groupFormat:s,onChange:a,onClose:u,disabled:c,style:d,isHiddenGroup:p,collectionContextStore:g,buttonPopupStore:m,parentStore:h,relatedCollectionAppConfigUri:y}=e;return"select"===t.type||"multi_select"===t.type?(0,D.jsx)(ue,{schema:r,currentGroups:n,groupBy:l,groupFormat:s,onChange:a,onClose:u,disabled:c,style:d,buttonPopupStore:m,parentStore:h}):"status"===t.type?(0,D.jsx)(Q,{groupFormat:s,schema:r}):(0,i.pd)(t.type)?(0,D.jsx)(ie,{schema:r,currentGroups:n,groupBy:l,groupFormat:s,onChange:a,onClose:u,disabled:c,style:d,isHiddenGroup:p,buttonPopupStore:m,parentStore:h,groupValue:t}):"relation"===t.type?(0,D.jsx)(ne,{schema:r,groupFormat:s,collectionContextStore:g,style:d,parentStore:h,relatedCollectionAppConfigUri:y,groupValue:t}):"location"===t.type?(0,D.jsx)(re,{style:d,collectionContextStore:g,parentStore:h,groupValue:t}):(0,i.A1)(t.type)?(0,D.jsx)(J,{style:d,groupValue:t}):(0,i.HB)(t.type)?(0,D.jsx)(ce,{schema:r,currentGroups:n,groupBy:l,groupFormat:s,onChange:a,onClose:u,disabled:c,style:d,buttonPopupStore:m,parentStore:h,groupValue:t}):"number"===t.type?(0,D.jsx)(ee,{style:d,groupValue:t,propertySchema:"number"===o.type?o:void 0}):"checkbox"===t.type?(0,D.jsx)($,{style:d,propertySchema:o,groupValue:t}):void(0,S.t1)(t.type)}},475498:(e,t,o)=>{o.d(t,{Z:()=>S});var r=o(667294),n=o(883355),l=o(701302),s=o(886628),a=o(749085),u=o(653965),i=o(215828),c=o(710274),d=o(319385),p=o(348190),g=o(785893);class m extends n.Z{constructor(){super(...arguments),this.reducerId=this.props.id,this.instanceId=(0,i.ZP)(),this.localResultStoreChangeIsQueued=!1,this.storeTypes={resultStore:a.default.createClass(void 0,{name:"resultStore"})},this.handleLocalResultStoreChange=()=>{this.localResultStoreChangeIsQueued||(this.localResultStoreChangeIsQueued=!0,l.default.afterNextFlush(this.dequeueLocalResultStoreChange))},this.handleLocalResultStoreChangeDebounced=this.props.debounceWait?(0,u.Ds)(this.handleLocalResultStoreChange,this.props.debounceWait,{leading:!0}):this.handleLocalResultStoreChange,this.dequeueLocalResultStoreChange=()=>{const{resultStore:e}=this.stores;if(this.localResultStoreChangeIsQueued=!1,!this.componentIsMounted)return;const t=this.getCurrentResult();u.Xy(t,e.state)||e.setState(t)}}UNSAFE_willMount(e){const{collectionContextStore:t}=e;t.remoteResultStore.addListener(this.handleLocalResultStoreChange),t.localResultStore.addListener(this.handleLocalResultStoreChangeDebounced),this.updateReducer(e),this.handleLocalResultStoreChange()}UNSAFE_willUpdate(e){this.updateReducer(e)}willUnmount(){super.willUnmount();const{collectionContextStore:e,groupsPointer:t}=this.props;c.$D({reducerId:this.reducerId,instanceId:this.instanceId,reducer:void 0,collectionContextStore:e,groupsPointer:t}),e.remoteResultStore.removeListener(this.handleLocalResultStoreChange),e.localResultStore.removeListener(this.handleLocalResultStoreChangeDebounced)}renderComponent(){const{render:e}=this.props;if(e)return e(this.stores.resultStore)}updateReducer(e){const{reducer:t,collectionContextStore:o,groupsPointer:r}=e;c.$D({reducerId:this.reducerId,instanceId:this.instanceId,reducer:t,collectionContextStore:o,groupsPointer:r})}getCurrentResult(){const{reducer:e,collectionContextStore:t}=this.props,o=t.localResultStore.state,r=t.remoteResultStore.state,n=o&&"reducer"===o.type?o.reducerResults[this.reducerId]:void 0,l=r&&"reducer"===r.type?r.reducerResults[this.reducerId]:void 0;return(0,p.P)({reducerId:this.reducerId,localReducerResult:n,remoteReducerResult:l,reducer:e,collectionContextStore:t})}}function h(e){const{resultStore:t,render:o,...n}=e,l=(0,p.Z)(n),u=(0,s.qz)(t,a.default.createClass(void 0));(0,r.useEffect)((()=>{u.setState(l)}),[l,u]);const i=(0,s.VK)((()=>o?o(u):null),[o,u]);return(0,g.jsx)(g.Fragment,{children:i})}m.displayName="CollectionReducerRequest";const y=r.memo(h);const S=function(e){const t=(0,s.VK)((()=>d.default.checkGate({gateName:"use_collection_reducer_request_hook"})),[]),[o]=(0,r.useState)(t);return o?(0,g.jsx)(y,{...e}):(0,g.jsx)(m,{...e})}},493131:(e,t,o)=>{o.d(t,{Z:()=>h});var r=o(667294),n=o(800480),l=o(886628),s=o(724405),a=o(747453),u=o(709291),i=o(401018),c=o(552275),d=o(731278),p=o(776798),g=o(785893);function m(e){const{pageName:t,targetCollectionStore:o,...r}=e,m=(0,n.Fy)(),h=(0,l.VK)((()=>o.getIcon()),[o]),y=(0,s.yK)((e=>({medium:{color:e.mediumTextColor},dbName:{display:"flex",alignItems:"center",marginLeft:4},title:{marginLeft:i.Qi*(m.isRetina?.5:1)},icon:{width:16,fill:e.mediumIconColor}})),[m.isRetina]),S=(0,g.jsxs)("div",{style:y.dbName,children:[(0,g.jsx)(d.Z,{disabled:!0,icon:h,isEmptyPage:!1,size:m.isMobile?24:20}),(0,g.jsx)(p.Z,{store:o,style:y.title})]});return(0,g.jsx)(c.Z,{title:(0,g.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,g.jsx)(u.FormattedMessage,{id:"database.searchRelation.createNewPageFooter",defaultMessage:"<medium>New</medium> {pageName} <medium> in</medium> {databaseNameWithIcon}",values:{medium:e=>(0,g.jsx)("span",{style:y.medium,children:e}),pageName:(0,g.jsx)("span",{style:{marginLeft:4,marginRight:4},children:t}),databaseNameWithIcon:S}})}),icon:(0,a.R)(y.icon),...r})}const h=r.memo(m)},197680:(e,t,o)=>{o.d(t,{Z:()=>S});var r=o(667294),n=o(800480),l=o(886628),s=o(266897),a=o(709291),u=o(401898),i=o(98742),c=o(825464),d=o(552275),p=o(526388),g=o(670301),m=o(45653),h=o(785893);const y=r.forwardRef(((e,t)=>{const{actor:o,userTitle:r,useEmailAsTooltip:y,tooltip:S,tooltipPlacement:f}=e,v=(0,n.O7)(),x=(0,a.useIntl)(),C=(0,l.VK)((()=>o.asActor&&o.isUser()?o.email:void 0),[o]),b=y&&C?C:S,j=v.device.isMobile?24:20;let R;return(0,s.YU)(o)?R=(0,h.jsx)(g.Z,{botValue:null==o?void 0:o.asActor,size:j}):(0,s.$S)(o)?R=(0,h.jsx)(m.Z,{userValue:null==o?void 0:o.asActor,size:j}):(0,s.Iq)(o)?R=(0,h.jsx)(m.Z,{userValue:void 0,size:j}):(0,u.t1)(o),(0,h.jsx)(p.Z,{ref:t,placement:f??c.u.Bottom,alignment:c.v.Start,textWrap:!0,render:t=>(0,h.jsx)(d.Z,{...(0,i.Z)(t,e),icon:R,title:r??(0,s.$4)(x,o),className:"notranslate",right:e.right}),disableTooltip:!b,renderTooltip:()=>b})}));y.displayName="UserMenuItem";const S=y},348190:(e,t,o)=>{o.d(t,{P:()=>p,Z:()=>d});var r=o(667294),n=o(701302),l=o(886628),s=o(528155),a=o(540107),u=o(653965),i=o(215828),c=o(710274);function d(e){const{id:t,reducer:o,collectionContextStore:s,groupsPointer:d,debounceWait:g}=e,m=(0,l.VK)((()=>d),[d],{useDeepEqual:!0}),h=(0,l.VK)((()=>o),[o],{useDeepEqual:!0}),y=(0,l.VK)((()=>s.collectionViewStore()),[s]),S=(0,l.VK)((()=>{var e;return null==y||null===(e=y.getFormatStore())||void 0===e?void 0:e.getKeyStore("collection_view_source").getValue()}),[y]),f=(0,r.useRef)(!1),v=(0,a.S)(),[x,C]=(0,r.useReducer)(((e,t)=>u.Xy(e,t)?e:t),void 0),b=(0,r.useCallback)((()=>{const e=s.localResultStore.state,o=s.remoteResultStore.state,r=e&&"reducer"===e.type?e.reducerResults[t]:void 0,n=o&&"reducer"===o.type?o.reducerResults[t]:void 0;return p({reducerId:t,collectionContextStore:s,reducer:h,localReducerResult:r,remoteReducerResult:n})}),[s,h,t]),j=(0,r.useCallback)((()=>{f.current=!1,v()||C(b())}),[b,v]),R=(0,r.useCallback)((()=>{f.current||(f.current=!0,n.default.afterNextFlush(j))}),[j]),[V]=(0,r.useState)((()=>(0,i.ZP)()));return(0,r.useEffect)((()=>{const e=g?(0,u.Ds)(R,g,{leading:!0}):R;return s.remoteResultStore.addListener(R),s.localResultStore.addListener(e),()=>{s.remoteResultStore.removeListener(R),s.localResultStore.removeListener(e)}}),[s,R,g]),(0,r.useEffect)((()=>(c.$D({reducerId:t,instanceId:V,reducer:h,collectionContextStore:s,groupsPointer:m}),()=>{c.$D({reducerId:t,instanceId:V,reducer:void 0,collectionContextStore:s,groupsPointer:m})})),[s,y,S,m,h,t,V]),(0,r.useEffect)((()=>{R()}),[]),x}function p(e){const{reducerId:t,localReducerResult:o,remoteReducerResult:r,collectionContextStore:n,reducer:l}=e,a=n.reducersStore.state,i=n.remoteResultStore.state;if(n.isClientModeEnabledStore.state)return o;if("aggregation"===l.type||"groups"===l.type){if(null!=i&&i.reducerResults[t])return i.reducerResults[t];const e=Boolean(i&&"reducer"===i.type&&u.sE(i.reducerResults,((e,t)=>{const o=a[t];return Boolean(o&&"results"===o.reducer.type&&!o.reducer.searchQuery&&"results"===e.type&&e.hasMore&&u.Xy(l.filter,o.reducer.filter))})));return e?o:r}if("results"===l.type){var c;const e=n.wasCreatedThisSessionStore.state,l=Boolean(i&&"reducer"===i.type&&i.reducerResults[t]),a=(0,s.nx)(null===(c=n.collectionViewStore())||void 0===c?void 0:c.getCollectionSource());if((l||e)&&!a&&o&&"results"===o.type){return{...o,hasMore:r&&"results"===r.type?r.hasMore:o.hasMore}}return r}}},425044:(e,t,o)=>{o.d(t,{O:()=>a,u:()=>s});var r=o(371663),n=o(709291),l=o(729376);const s=(0,n.defineMessages)({sprintUncategorizedGroup:{defaultMessage:"Backlog (No {name})",id:"database.sprintDatabaseView.uncategorizedGroupLabel"}});function a(e){const{collectionStore:t,property:o,propertySchema:n,parentStore:s}=e;let a=!1;if(null!=t&&t.isDefined()){const e=t.getPropertyMapping();a=(null==e?void 0:e[r.Es.TaskToSprintRelation])===o}return(0,l.ke)(n,s)===r.p$||a}}}]);