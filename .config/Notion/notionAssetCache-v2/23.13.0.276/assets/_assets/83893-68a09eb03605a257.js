"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[83893],{522974:(e,t,n)=>{n.d(t,{VZ:()=>f,vn:()=>u,Y7:()=>m,LH:()=>v});var a=n(531701);const o="theme";var r=n(401898),i=n(30021),s=n(304926),c=n(247839);const d=12;function l(e,t){const{device:n,ThemeStore:r}=e,{mode:i,usingSystemTheme:l}=t;if(window.notionTheme)return;const u={mode:i};r.setState(u),e.mobileNative&&e.mobileNative.setTheme(i,l),c.setTheme(function(e,t){const n=(0,a.gh)({theme:e});return{mode:e,usingSystemTheme:t,colors:{white:a.ZP.white,blue:a.ZP.blue},borderRadius:4,textColor:n.regularTextColor,popoverBackgroundColor:n.popoverBackground,popoverBoxShadow:n.mediumBoxShadow,inputBoxShadow:n.inputBoxShadow,inputBackgroundColor:n.inputBackground,dividerColor:n.darkDividerColor,shadowOpacity:n.shadowOpacity}}(i,l)),localStorage.setItem(o,JSON.stringify(u)),function(e,t){if(0===e.nativeScrollbarWidth)return;const n=document.getElementById("scroll-properties");n&&(n.innerHTML=`\n\t\t* {\n\t\t\tscrollbar-width: ${d}px;\n\t\t\tscrollbar-color: ${p.scrollbarThumb[t]}  ${p.scrollbarTrack[t]};\n\t\t}\n\t\t::-webkit-scrollbar {\n\t\t\twidth: ${d}px;\n\t\t\theight: ${d}px;\n\t\t}\n\t\t::-webkit-scrollbar {\n\t\t\tbackground: transparent;\n\t\t}\n\t\t::-webkit-scrollbar-track:hover {\n\t\t\tbackground: ${p.scrollbarTrack[t]};\n\t\t}\n\t\t::-webkit-scrollbar-thumb {\n\t\t\tbackground: ${p.scrollbarThumb[t]};\n\t\t\tcursor: pointer;\n\t\t}\n\t\t::-webkit-scrollbar-thumb:hover {\n\t\t\tbackground: ${p.scrollbarThumbHover[t]};\n\t\t}\n\t\t::-webkit-scrollbar-button {\n\t\t\tdisplay: none;\n\t\t}\n\t`,s.Z.setState(d))}(n,i),"dark"===i?document.body.classList.add("dark"):document.body.classList.remove("dark")}function u(e){return e.device.prefersDarkInterface?"dark":"light"}const p={scrollbarTrack:{light:"rgba(0, 0, 0, 0)",dark:"rgba(0, 0, 0, 0)"},scrollbarThumb:{light:"#D3D1CB",dark:"rgba(255, 255, 255, 0.2)"},scrollbarThumbHover:{light:"#AEACA6",dark:"rgba(255, 255, 255, 0.3)"}};function m(e){i.Z.setState(e)}function v(e){const t=f(e);switch(t){case"dark":case"light":l(e,{mode:t,usingSystemTheme:!1});break;case"system":!async function(e){const{mobileNative:t}=e;let n="light";n=t&&t.api.getTheme?await t.api.getTheme():u(e),l(e,{mode:n,usingSystemTheme:!0})}(e);break;default:(0,r.t1)(t)}}function f(e){const t=i.Z.state||"system";return"dark"===(n=t)||"light"===n||"system"===n?n:"system";var n}},24201:(e,t,n)=>{n.d(t,{Z:()=>ln});var a=n(667294),o=n(800480),r=n(296994),i=n(471924),s=n(730459),c=n(80444);const d=6e4;async function l(e){var t,n;void 0!==c.default.state.currentUserStore&&void 0!==c.default.state.currentSpaceStore||await c.default.waitUntil((()=>void 0!==c.default.state.currentUserStore&&void 0!==c.default.state.currentSpaceStore));const a=null===(t=c.default.state.currentUserStore)||void 0===t?void 0:t.id,o=null===(n=c.default.state.currentSpaceStore)||void 0===n?void 0:n.id;if(!document.hasFocus())return;if(!a||!o)return;const r=s.Cd({userId:a,spaceId:o}),d=Date.now();r?s.ci({userId:a,spaceId:o,session:{...r,lastFocusedTime:d}}):s.ci({userId:a,spaceId:o,session:{id:i.Il(),sessionStartTime:d,lastFocusedTime:d}})}var u=n(354064),p=n(454642),m=n(788632),v=n(429755),f=n(417963);const S=new u.Z;var b=n(522974),g=n(30021);var h=n(886628),_=n(712321),w=n(548779),C=n(281236);function O(){const e=(0,o.O7)(),t=(0,h.VK)((()=>c.default.state.currentUserRootStore),[]);(0,a.useEffect)((()=>{t&&async function(e,t){await _.w();const n=t.getSpaceViewStores();for(const a of n){const t=a.getBookmarkedPageStores();for(const e of t)T(e);const n=a.getSharedPageStores();for(const e of n)T(e);const o=a.getTeamsStores();for(const e of o){const t=e.getTeamPagesStores();for(const e of t)T(e)}const r=a.getSpaceStore();if(r){C.Z.getData(e,{spaceId:r.id});const t=(0,w.XD)(e,r);for(const e of t)T(e)}}}(e,t)}),[t,e])}function T(e){e.load();const t=e.getCollectionViewSourceOrLinkCollectionStores();for(const n of t)n.load()}var y=n(568626),N=n(554153),E=n(211342),U=n(709291),I=n(102449),k=n(135253),A=n(547307),L=n(247839),M=n(95477),V=n(110854),P=n(772770),Z=n(367669),R=n(421051),D=n(85844),x=n(785893);const B=6e4;function F(){const e=(0,o.O7)(),t=(0,a.useCallback)((()=>function(e){const{AppUpdateStore:t}=e;t.setState({appUpdate:t.state.appUpdate,electronUpdate:{state:"checking"}})}(e)),[e]),n=(0,a.useCallback)(((t,n)=>function(e,t,n){const{AppUpdateStore:a}=n;a.setState({appUpdate:a.state.appUpdate,electronUpdate:{state:"error",error:t}})}(0,n,e)),[e]),r=(0,a.useCallback)((()=>function(e){const{AppUpdateStore:t}=e;t.setState({appUpdate:t.state.appUpdate,electronUpdate:{state:"no-update",timestamp:Date.now()}})}(e)),[e]),i=(0,a.useCallback)(((t,n)=>function(e,t,n){const{AppUpdateStore:a}=n,o=(0,E.parseVersion)(t.version),r=L.getDesktopVersion(),i=(0,E.getUpdateType)({currentVersion:r,nextVersion:o,app:"desktop"});a.setState({appUpdate:a.state.appUpdate,electronUpdate:{state:"downloading",type:i,version:o,timestamp:Date.now(),progress:0}})}(0,n,e)),[e]),s=(0,a.useCallback)(((t,n)=>function(e,t,n){const{AppUpdateStore:a}=n,o=a.state;o.electronUpdate&&"downloading"===o.electronUpdate.state&&a.setState({appUpdate:o.appUpdate,electronUpdate:{...o.electronUpdate,progress:t.transferred/t.total}})}(0,n,e)),[e]),c=(0,a.useCallback)(((t,n)=>function(e,t,n){const{device:a}=n,{AppUpdateStore:o}=n,r=N.Z.get(V.Tm),i=t.version;if(r===i){if(a.isMac)return o.setState({appUpdate:o.state.appUpdate,electronUpdate:{state:"ready",type:E.UpdateType.Major,version:void 0}}),void A.showDialog({message:(0,x.jsx)(U.FormattedMessage,{id:"desktopAppUpdater.moveNotionToApplicationsFolderDialog.prompt",defaultMessage:"Please move the Notion app into the Applications folder for the auto-updater to work."}),showCancel:!1,keepFocus:!1,handleCancel:()=>(0,V.mK)(n),items:[{label:(0,x.jsx)(U.FormattedMessage,{id:"desktopAppUpdater.moveNotionToApplicationsFolderDialog.dismissButton.label",defaultMessage:"Okay"}),onAccept:()=>(0,V.mK)(n)}]});y.log({level:"error",from:"AppUpdateListener",type:"electronUpdateFailed",data:{miscDataToConvertToString:{previousUpdateReady:r,nextUpdateReady:i}}})}const s=L.getDesktopVersion(),c=(0,E.parseVersion)(t.version),d=(0,E.getUpdateType)({currentVersion:s,nextVersion:c,app:"desktop"});o.setState({appUpdate:o.state.appUpdate,electronUpdate:{state:"ready",type:d,version:c}})}(0,n,e)),[e]),d=(0,a.useCallback)((()=>function(e){const{AppUpdateStore:t}=e;if(t.state.appUpdate&&"ready"===t.state.appUpdate.state)return;t.setState({electronUpdate:t.state.electronUpdate,appUpdate:{state:"checking"}})}(e)),[e]),l=(0,a.useCallback)(((t,n)=>function(e,t,n){$(t,n)}(0,n,e)),[e]),u=(0,a.useCallback)((()=>function(e){const{AppUpdateStore:t}=e;if(t.state.appUpdate&&"ready"===t.state.appUpdate.state)return;t.setState({electronUpdate:t.state.electronUpdate,appUpdate:{state:"no-update",timestamp:Date.now()}})}(e)),[e]),v=(0,a.useCallback)(((t,n)=>function(e,t,n){K(t,n)}(0,n,e)),[e]),f=(0,a.useCallback)(((t,n)=>function(e,t,n){W(t,n)}(0,n,e)),[e]),S=(0,a.useCallback)(((t,n)=>function(e,t,n){j(t,n)}(0,n,e)),[e]),b=(0,a.useCallback)((t=>function(e,t){k.Js({bannerStore:R.Z}),I.hC({environment:t,url:window.location.href,version:e})}(t,e)),[e]),g=(0,a.useCallback)((()=>function(e){const t=e.AppUpdateStore;if(m.Z.getState().online&&t.isSilentUpdate()){const n=t.state.appUpdate;I.hC({environment:e,url:window.location.href,version:n.version})}}(e)),[e]);(0,a.useEffect)((()=>{const{device:a}=e;if(a.isElectron)return L.electronUpdateReady.addListener(c),L.electronUpdateError.addListener(n),L.electronUpdateChecking.addListener(t),L.electronUpdateAvailable.addListener(i),L.electronUpdateProgress.addListener(s),L.electronUpdateNotAvailable.addListener(r),L.appUpdateReady.addListener(S),L.appUpdateError.addListener(l),L.appUpdateChecking.addListener(d),L.appUpdateAvailable.addListener(v),L.appUpdateInstall.addListener(g),L.appUpdateProgress.addListener(f),L.appUpdateNotAvailable.addListener(u),L.appUpdateReload.addListener(b),()=>{L.electronUpdateReady.removeListener(c),L.electronUpdateError.removeListener(n),L.electronUpdateChecking.removeListener(t),L.electronUpdateAvailable.removeListener(i),L.electronUpdateProgress.removeListener(s),L.electronUpdateNotAvailable.removeListener(r),L.appUpdateReady.removeListener(S),L.appUpdateError.removeListener(l),L.appUpdateChecking.removeListener(d),L.appUpdateAvailable.removeListener(v),L.appUpdateProgress.removeListener(f),L.appUpdateNotAvailable.removeListener(u),L.appUpdateReload.removeListener(b)}}),[e,d,u,b,v,l,g,f,S,i,t,n,r,s,c]),(0,a.useEffect)((()=>{const{device:t,mobileNative:n}=e;if(n&&n.updateReceiveApiHandlers({appUpdateReady:t=>j(t,e),appUpdateError:t=>$(t,e),appUpdateChecking:d,appUpdateAvailable:t=>K(t,e),appUpdateProgress:t=>W(t,e),appUpdateNotAvailable:u}),function(e){const t=I.ac(),n=I.uG();if(!(0,E.isEqualVersion)(t,n)){0,H((0,E.getUpdateType)({currentVersion:t,nextVersion:n,app:"client"}),n,e)}}(e),t.isMobileNative&&n&&n.api.openUpdateSettings){const n=t.osVersion,a=t.isAndroid&&(0,E.isLessThanVersion)(n,[7,0]),o=t.isIOS&&(0,E.isLessThanVersion)(n,[15,0]);(a||o)&&function(e){const{mobileNative:t}=e;if(!t)return;k.Bw({bannerStore:R.Z,id:"PlatformUpdateWarning",contentKey:"mobile_platform_unsupported",styleKey:P.v.Red})}(e)}}),[e,d,u]);const h=(0,a.useRef)("");(0,a.useEffect)((()=>{const{device:t,mobileNative:n}=e;if(!n&&!t.isElectron&&!M.default.isAdminMode&&(!M.default.isLocalhost||M.default.offline)){async function a(){if(void 0===D.Z.state.isVisible||!0===D.Z.state.isVisible)try{const t=I.ac(),n=await p.getAssetsJsonV2(e,{hash:h.current});if("success"===n.type){const a=n.data;if("version"in a){const n=(0,E.parseVersion)(a.version);n&&((0,E.isEqualVersion)(n,t)||j(a,e))}"hash"in a&&(h.current=a.hash||"")}}catch(t){}}const o=setInterval(a,B);return()=>clearInterval(o)}}),[e])}async function q(e){const t=await async function(e){await c.default.waitUntilRendered();const{mainEditorCurrentBlockStore:t,currentUserStore:n}=c.default.state;return!(!n||!t||(0,Z.IJ)(e,t))}(e);t&&k.Bw({bannerStore:R.Z,id:"AppUpdate",contentKey:"minor_app_update",styleKey:P.v.Blue})}function H(e,t,n){e===E.UpdateType.Major?t&&I.M0(t)?(I.D$(t),q(n),I.gA(n,"major","banner")):(!function(e){A.showDialog({message:(0,x.jsx)(U.FormattedMessage,{defaultMessage:"We just launched new features!",id:"breakingUpdateDialog.title"}),showCancel:!1,keepFocus:!1,handleCancel:()=>(0,V.mK)(e),items:[{label:(0,x.jsx)(U.FormattedMessage,{defaultMessage:"Update and see what's new",id:"breakingUpdateDialog.updateButtonTitle"}),color:"blue",onAccept:()=>(0,V.mK)(e)}],innerStyle:{width:380}})}(n),I.gA(n,"major","modal")):e===E.UpdateType.Minor?(t&&I.M0(t)&&I.D$(t),q(n),I.gA(n,"minor","banner")):(t&&I.M0(t)&&I.D$(t),I.gA(n,"patch"))}function $(e,t){const{AppUpdateStore:n}=t;n.state.appUpdate&&"ready"===n.state.appUpdate.state||n.setState({electronUpdate:n.state.electronUpdate,appUpdate:{state:"error",error:e}})}function K(e,t){const{AppUpdateStore:n}=t;if(n.state.appUpdate&&"ready"===n.state.appUpdate.state)return;const a=(0,E.parseVersion)(e.version),o=I.ac(),r=(0,E.getUpdateType)({currentVersion:o,nextVersion:a,app:"client"});n.setState({electronUpdate:n.state.electronUpdate,appUpdate:{state:"downloading",type:r,version:a,timestamp:Date.now(),progress:0}})}function W(e,t){const{AppUpdateStore:n}=t,a=n.state;a.appUpdate&&"downloading"===a.appUpdate.state&&n.setState({electronUpdate:a.electronUpdate,appUpdate:{...a.appUpdate,progress:e.downloaded/e.total}})}function j(e,t){const{AppUpdateStore:n}=t,a=(0,E.parseVersion)(e.version),o=I.ac(),r=(0,E.getUpdateType)({currentVersion:o,nextVersion:a,app:"client"});if(!I.M0(a)){const e={state:"ready",type:r,version:a};n.setState({electronUpdate:n.state.electronUpdate,appUpdate:e})}H(r,a,t)}n(757658);var G=n(79571),J=n(730120),z=n(401898),Q=n(619584);function Y(e){const{frequencyCapConstraint:t,exposures:n,currentDateTime:a}=e,o=a.toMillis(),{maxCountInWindow:r,window:i}=t,s=function(e){const{exposures:t,windowEndMillis:n,windowDuration:a}=e;let o;switch(a){case"day":o=1;break;case"week":o=7;break;case"month":o=30;break;default:(0,z.t1)(a)}const r=n-o*Q.A0;return t.filter((e=>e>=r))}({exposures:n,windowEndMillis:o,windowDuration:i});return s.length<r}function X(e){const{context:t,calloutKey:n,constraints:a}=e,{global:o,placements:r}=a,i=G.xg[n];if(t.currentDateTime.toMillis()>i.end)return!1;const s=i.placement;return!!function(e){const{constraint:t,context:n}=e;if(t.frequencyCap){const e=Object.values(n.placementExposures).flat();if(!Y({frequencyCapConstraint:t.frequencyCap,exposures:e,currentDateTime:n.currentDateTime}))return!1}return!0}({context:t,constraint:o})&&!!function(e){const{constraint:t,placementKey:n,context:a}=e;if(t.frequencyCap&&!Y({frequencyCapConstraint:t.frequencyCap,exposures:a.placementExposures[n],currentDateTime:a.currentDateTime}))return!1;if(t.conflictsWith)for(const o of t.conflictsWith)if(a.currentEligibleCallouts[o].size>0)return!1;if(t.maxConcurrent&&a.currentEligibleCallouts[n].size>=t.maxConcurrent)return!1;return!0}({context:t,constraint:r[s],placementKey:s})}var ee=n(521273),te=n(279827),ne=n(319385),ae=n(288280),oe=n(954690),re=n(706210);async function ie(e){te.default.reset();const t=await async function(){await c.default.waitUntil((()=>void 0!==c.default.state.currentUserSettingsStore&&void 0!==c.default.state.mainEditorCurrentBlockStore&&void 0!==c.default.state.currentSpaceStore&&void 0!==c.default.state.currentSpaceViewStore&&c.default.state.currentUserSettingsStore.isReady()&&c.default.state.mainEditorCurrentBlockStore.isReady()&&c.default.state.currentSpaceStore.isReady()&&c.default.state.currentSpaceViewStore.isReady()));const e=c.default.state.currentUserSettingsStore,t=c.default.state.mainEditorCurrentBlockStore,n=c.default.state.currentSpaceStore,a=c.default.state.currentSpaceViewStore;return await ne.default.waitUntilStatsigReady(),await ee.Z.waitUntil((()=>ee.Z.getIsInitialized())),await ae.subscriptionDataStoreInstance.waitUntilLoaded(),{currentUserSettingsStore:e,currentSpaceStore:n,mainEditorCurrentBlockStore:t,experimentStore:ne.default,assistantFeatureGateStore:ee.Z,subscriptionDataStore:ae.subscriptionDataStoreInstance,currentSpaceViewStore:a}}(),n=await async function(e,t){const n=[];for(const a of G.$Z)await oe.$[a](e,t)&&n.push(a);return n}(e,t),a=function(e){const{candidateCallouts:t,globalConstraint:n,placementConstraints:a,placementExposures:o}=e,r=(0,G.$e)(),i=J.ou.now(),s=G.$Z.filter((e=>t.includes(e))),c={placementExposures:o,currentDateTime:i,currentEligibleCallouts:r},d={global:n,placements:a};for(const l of s)X({context:c,calloutKey:l,constraints:d})&&r[(0,G.QN)(l)].add(l);return r}({candidateCallouts:n,globalConstraint:G.$Q.globalConstraint,placementConstraints:G.$Q.placementConstraints,placementExposures:(0,G.Y6)()});(0,re.YF)(e,{eligible_callouts:a});for(const o of G.nK)te.default.state.placementStores[o].setState(new Set(a[o]))}var se=n(32223);async function ce(e){if(e.device.isBrowser&&document.hidden)return;if(e.device.isElectron&&!(await L.isWindowVisible()))return;if(se.isConnected())return void de(!0);if(!1===navigator.onLine&&!M.default.isLocalhost)return void de(!1);"success"===(await p.ping(e,{})).type?de(!0):de(!1)}function de(e){m.Z.setState({...m.Z.state,online:e,lastOfflineTimestamp:e?m.Z.state.lastOfflineTimestamp:Date.now()})}const le=5e3;var ue=n(922705),pe=n(966324),me=n(938676),ve=n(424042),fe=n(833110);var Se=n(184747),be=n(957400);const ge=6e5;function he(e){be.Th({environment:e})}var _e=n(979947);function we(e){(0,_e.default)({url:`${M.default.secureFileConfig.rootPath}/refresh`,environment:e,method:"GET",format:"text"})}var Ce=n(653965),Oe=n(436610);const Te=Ce.P2(Oe.XW,5e3);var ye=n(225972),Ne=n(258455);var Ee=n(662134),Ue=n(245023);var Ie=n(324502);var ke=n(701302),Ae=n(14577),Le=n(761045),Me=n(869454),Ve=n(924666);const Pe=new Ae.Z((()=>{const e=Me.Z.state;return e.phase===Me.i.willShow?0:e.estimatedKeyboardWebViewOverlap}),{debugName:"estimatedKeyboardWebViewOverlapStore"});var Ze=n(404993),Re=n(730583),De=n(318245);var xe=n(898104),Be=n(389224),Fe=n(259238);const qe=window.matchMedia("(prefers-color-scheme: dark)");var He=n(598794),$e=n(427534);const Ke="loadCachedPageChunk";var We=n(210228);var je=n(164964);var Ge=n(883355),Je=n(427328),ze=n(815145),Qe=n(597213),Ye=n(89101),Xe=n(421202),et=n(492338);const tt=["compact","regular","unknown"];var nt=n(307032),at=n(63811),ot=n(212847),rt=n(483249),it=n(73990),st=n(497977),ct=n(98958),dt=n(211302),lt=n(452423),ut=n(132953),pt=n(321862),mt=n(608055),vt=n(901357),ft=n(587531),St=n(524677),bt=n(29974),gt=n(970782),ht=n(139634),_t=n(433929),wt=n(551783),Ct=n(344499),Ot=n(745162),Tt=n(918514),yt=n(645010),Nt=n(897638);function Et(e){const t=(0,Je.w_)(e);switch(t.type){case"native":return;case"web":const e=t.route;switch(e.name){case"page":return e.collectionViewId?"collection":"page";case"nativeTab":switch(e.tab){case"search":return"search";case"updates":return"updates";case"assistant":return"assistant"}break;default:return}}}var Ut=n(555081),It=n(775538),kt=n(525286),At=n(224646),Lt=n(397799),Mt=n(591190),Vt=n(136896),Pt=n(44604),Zt=n(905162),Rt=n(434859),Dt=n(112252),xt=n(830581),Bt=n(964233),Ft=n(803418),qt=n(269327),Ht=n(100475),$t=n(465686),Kt=n(231104),Wt=n(853610),jt=n(866881),Gt=n(449682),Jt=n(206258),zt=n(562820),Qt=n(897630);const Yt=(0,U.defineMessages)({failedToMovePageGeneric:{id:"MobileNativeListener.failedToMovePage",defaultMessage:"Failed to move page"}});let Xt;class en extends Ge.Z{constructor(){super(...arguments),this.bottomBarVisibilityStore=this.createComputedStore((()=>{const{currentUserStore:e}=c.default.state,t=Boolean(null==e?void 0:e.id),n=It.default.state.isOnboarding,a=(0,Zt.Y)("supportsNativeBottomBarOverlappingWebView")?Ft.Z.hasOpenMobileSlideUps():Ft.Z.hasOpenPopups(),o=Kt.Z.state.open,r="web"!==(0,Je.w_)(this.environment.TabbedRouterStore.state).type,i=t&&!o&&!n&&!a;return(0,Zt.Y)("supportsWebManagedTabNavigation")&&!!r||i})),this.customAddCommentMenuItemEnabledStore=this.createComputedStore((()=>{var e;if(!(0,Zt.Y)("supportsCustomAddCommentMenuItem"))return!1;const{currentUserStore:t}=c.default.state;if(!Boolean(null==t?void 0:t.id))return!1;if((0,Zt.Y)("supportsNativeBottomBarOverlappingWebView")?Ft.Z.hasOpenMobileSlideUps():Ft.Z.hasOpenPopups())return!1;const{TabbedRouterStore:n}=this.environment,a=(0,Je.w_)(n.state),o="web"===a.type&&((null===(e=a.redirectedTo)||void 0===e?void 0:e.route)||a.route);if(!o||"page"!==o.name)return!1;const r=Ve.default.state;if("empty"===r.mode)return!1;const i=(0,Ot.tp)({multiSelection:r.multiSelection,filterCommonAncestors:!0,focus:void 0});if(!i||0===i.stores.length)return!1;let s=!0;return i.stores.forEach((e=>{s&&(s=s&&e.canComment())})),s})),this.aiAssistantEnabledStore=this.createComputedStore((()=>{const{currentUserStore:e,currentSpaceStore:t}=c.default.state;if(!e||!t)return;const n=ee.Z.isShowingQNAOnMobile();return{userId:e.id,spaceId:t.id,enabled:n}})),this.aiAssistantVisibilityStore=this.createComputedStore((()=>({enabled:!1}))),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSideBarExpandedStateChange=()=>cn(this.environment),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBottomBarVisibilityStoreChange=()=>function(e,t){var n;const a=t.state;null===(n=e.mobileNative)||void 0===n||n.toggleBottomBar(a)}(this.environment,this.bottomBarVisibilityStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleAiAssistantEnabledStoreChange=()=>function(e,t){var n;const a=t.state;if(!a)return;null===(n=e.mobileNative)||void 0===n||n.updateAiAssistantEnabledState(a)}(this.environment,this.aiAssistantEnabledStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleAiAssistantVisibilityStoreChange=()=>function(e,t){var n;const a=t.state;null===(n=e.mobileNative)||void 0===n||n.updateAiAssistantVisibilityState(a)}(this.environment,this.aiAssistantVisibilityStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSwipeNavigation=()=>function(e){const{mobileNative:t,RouterStore:n}=e;if(!t)return;if(t.setWebViewAllowsNavigationGestures){const{route:e}=n.state;"onboarding"===e.name||me.sidebarOpenStore.state||$t.Z.getPreventScrollType()!==Rt.Z.None?!1!==Xt&&(Xt=!1,t.setWebViewAllowsNavigationGestures(!1)):!0!==Xt&&(Xt=!0,t.setWebViewAllowsNavigationGestures(!0))}}(this.environment),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleKeyboardAutoScroll=()=>{return e=this.environment,void(Me.Z.state.phase===Me.i.willShow&&ke.default.afterNextFlush((()=>Le.hQ(e))));var e},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMobileNativeKeyboardStore=()=>function(e){const{RouterStore:t,NativeMobileActionBarStore:n}=e;if("page"!==t.state.route.name)return;if(Me.Z.state.phase===Me.i.hidden){var a;if(Bt.Z.state.open)return;if(Boolean(null==n||null===(a=n.state)||void 0===a?void 0:a.menuType))return;xe.ZH({debug:{userAction:"MobileNativeListener.handleMobileNativeKeyboardStore"},environment:e})}}(this.environment),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTabbedRouterStoreChange=()=>function(e){var t;const{mobileNative:n,TabbedRouterStore:a}=e,o=null==n||null===(t=n.api)||void 0===t?void 0:t.handleTabbedRouterStateUpdate;if(o){const t=a.state;o({state:t,topPage:(0,Je.w_)(t),webTransitionType:Et(t),updateId:(0,nt.ZP)()});const n=a.getPreviousState();if(!n)return;const r=(0,Je.F9)(n),i=(0,Je.F9)(t);Ce.Xy(r,i)||rt.w3(e,{origin:r,destination:i,from:t.navigationSource,action:t.navigationAction,logging_source:"mobile_native"})}}(this.environment),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCustomAddMenuItemEnabledChanged=()=>dn(this.environment,this.customAddCommentMenuItemEnabledStore),this.getLocalSearchCache=Ce.HP((async(e,t)=>(await r.FF.searchActions.load()).getLocalCacheFromAppState(e)),((e,t)=>{var n;return`${e.currentUser.id}-${(null===(n=c.default.state.currentSpaceViewStore)||void 0===n?void 0:n.id)??"none"}-${t??"none"}`}))}UNSAFE_willMount(){const{mobileNative:e,RouterStore:t,TabbedRouterStore:a,device:o}=this.environment;var i;o.isMobileNative&&e&&(me.sidebarOpenStore.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSwipeNavigation),me.sidebarExpandedStore.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSideBarExpandedStateChange),xt.Z.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSwipeNavigation),t.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSwipeNavigation),Me.Z.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleKeyboardAutoScroll),this.bottomBarVisibilityStore.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBottomBarVisibilityStoreChange),this.aiAssistantEnabledStore.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleAiAssistantEnabledStoreChange),this.aiAssistantVisibilityStore.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleAiAssistantVisibilityStoreChange),this.environment.WindowSizeStore.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSideBarExpandedStateChange),a.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTabbedRouterStoreChange),this.customAddCommentMenuItemEnabledStore.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCustomAddMenuItemEnabledChanged),e.updateReceiveApiHandlers({statusBarTap:sn,backButtonPress:()=>Ee.Zm(this.environment,{type:"backbutton"}),keyboardWillShow:e=>{Me.Z.updateKeyboardPhase(this.environment,Me.i.willShow,e??0)},keyboardDidShow:e=>Me.Z.updateKeyboardPhase(this.environment,Me.i.shown,e??0),keyboardWillHide:()=>{Me.Z.updateKeyboardPhase(this.environment,Me.i.willHide,0)},keyboardDidHide:()=>{var e;(Me.Z.updateKeyboardPhase(this.environment,Me.i.hidden,0),o.isIpad)&&(St.ZH({debug:{userAction:"MobileNativeListener.UNSAFE_willMount"},environment:this.environment}),null===(e=this.environment.NativeMobileActionBarStore)||void 0===e||e.clear(!0))},keyboardShortcut:e=>Ee.Zm(this.environment,e),nativeBottomBarDidChange:e=>{void 0!==e.height&&Me.Z.update((t=>({...t,nativeBottomBarHeight:e.height})))},pushNotificationTokenRefresh:e=>ct.handleTokenRefresh(this.environment,e,"refresh"),resume:Dt.Z.resume,pause:async()=>{Dt.Z.pause();const{stopDictation:e}=await Promise.all([n.e(69053),n.e(31282),n.e(11766)]).then(n.bind(n,920939));await e({environment:this.environment})},refreshSubscriptionData:async e=>{await p.invalidateSubscriptionData(this.environment,{spaceId:e,provider:"revenue_cat"}),await Qt.bi(this.environment)},refreshSubscriptionDataV2:async()=>{await Qt.bi(this.environment)},processMobileActionBarAction:t=>{const{componentId:n,action:a}=t;e.componentEvents.dispatch("MobileActionBar",n,"onAction",{action:a})},trackExperimentExposure:async e=>{await Oe.Bb({environment:this.environment,experiment_id:e.experimentId,experiment_version:e.experimentVersion,experiment_group:e.group||"ineligible",logging_source:"mobile_native"})},logout:e=>{st.logoutSingleAccount({environment:this.environment,userId:e,logoutOrigin:Qe.F.MobileNativeListener})},logoutV2:e=>{const{userId:t,fcmToken:n}=e;st.logoutSingleAccount({environment:this.environment,userId:t,logoutOrigin:Qe.F.MobileNativeListener,fcmToken:n})},logoutAll:()=>{st.logout(this.environment)},openDestinationV2:e=>{Ft.Z.closeAll();const t=this.environment,n=(0,Je.w_)(t.TabbedRouterStore.state),{activeTab:o,tabs:r}=t.TabbedRouterStore.state,i=n===r[o].rootPage,s="native"===n.type,c=i&&s;switch((0,Tt.__)(this.environment)&&vt.S({environment:this.environment,tab:a.state.activeTab,nativeRootPageOverrideEnabled:!1}),e.type){case"moveTo":!function(e,t){const n=new Jt.G(t,{table:Xe.iU,id:e});dt.bA({environment:t,blocks:[n],moveToContext:"home_tab",onAccept:e=>{pt.r({store:n,environment:t,pageVisitSource:ze.tY.Move})}})}(e.blockId,this.environment);break;case"trash":on({query:e.query});break;case"templates":!function(e,t){rn(e),Gt.Z.setState({open:!0,source:t.source})}(this.environment,{source:e.source});break;case"AIAssistant":!function(e,t,n){jt.g.update((e=>({query:n.query,searchSessionId:n.searchSessionId,from:n.from??"search",shouldReset:Boolean(n.query&&n.query.trim().length>0)}))),mt.c4({environment:e,url:`${Ye.VP.nativeTab}/assistant`,redirect:t})}(this.environment,c,{query:e.query,searchSessionId:e.searchSessionId,from:e.from})}},openDestination:e=>{Ft.Z.closeAll();switch("closePopup"!==e&&(0,Tt.__)(this.environment)&&Boolean(a.state.tabs[a.state.activeTab].nativeRootPageOverrideEnabled)&&vt.S({environment:this.environment,tab:a.state.activeTab,nativeRootPageOverrideEnabled:!1}),e){case"search":!function(e){(0,Zt.Y)("supportsNativeHome")&&e.device.isPhone?(ut.Hu({RouterStore:e.RouterStore,currentUserId:e.currentUser.id}),ft.UT({environment:e,analyticsFrom:"mobile-bottom-bar",renderAsPage:!0})):ft.UT({environment:e,analyticsFrom:"mobile-bottom-bar"});rt.nB(e,{itemName:"search",logging_source:"mobile_native"})}(this.environment);break;case"addPage":rn(this.environment);break;case"allUpdates":t=this.environment,(0,Zt.Y)("supportsNativeHome")&&t.device.isPhone?(ut.Hu({RouterStore:t.RouterStore,currentUserId:t.currentUser.id}),mt.c4({environment:t,url:`${Ye.VP.nativeTab}/updates`,redirect:!0})):zt.Z.setState({...zt.Z.state,open:!0});break;case"addAccount":Mt.C.setState({...Mt.C.state,open:!0});break;case"createOrJoinWorkspace":return async function(e){await Ut.xN(e)}(this.environment);case"notificationAndSettings":Lt.Z.setState({open:!0,source:Lt.Y.Home});break;case"trash":on({});break;case"memberSettings":Wt.Z.setState({...Wt.Z.state,open:!0});break;case"help":Ht.Z.setState({...Ht.Z.state,open:!0});break;case"intercom_messages":!function(e){ht.j({environment:e,from:"help_button"})}(this.environment);break;case"aiWriter":!function(e){wt.QG(e)}(this.environment)}var t},setCurrentUserId:async e=>{await async function(e,t){if(t.currentUser.id===e)return;await gt.x({environment:t,newCurrentUserId:e})}(e,this.environment)},setCurrentSpace:async e=>{await async function(e,t,n){const a=await gt.x({environment:n,newCurrentUserId:e}),{currentUserRootStore:o,currentUserSettingsStore:r}=c.default.state;if(!o)return;await o.load();const i=(0,w.w3)(t);i&&await bt.y3({environment:a,spaceViewStore:i,userSettingsStore:r,userRootStore:o,pageVisitSource:ze.tY.SwitchSpace,navigationType:"switchingToOrLoadingSpace"})}(e.userId,e.spaceId,this.environment)},updateHorizontalSizeClass:t=>{const n=(0,at.Gu)(ot.literals(...tt),t)?"unknown":t;n!==e.horizontalSizeClass.state&&e.horizontalSizeClass.setState(n)},updateTabbedRouterState:e=>{var t;const{TabbedRouterStore:n}=this.environment,a=n.state;if(e.tab!==a.activeTab||null!==(t=e.pages)&&void 0!==t&&t.length||!Ce.Xy(e.modal,a.modal)||a.tabs[a.activeTab].pages.length){const t=e.navigationEffect;if(t&&"AIAssistant"===t.type)jt.g.update((e=>({query:t.query,searchSessionId:t.searchSessionId,from:t.from??"search",shouldReset:Boolean(t.query&&t.query.trim().length>0)})));vt.S({environment:this.environment,tab:e.tab,queryParams:e.queryParams,pages:e.pages,modal:e.modal,nativeRootPageOverrideEnabled:e.nativeRootPageOverrideEnabled,navigationAction:e.navigationAction,navigationSource:e.navigationSource})}else an();const o=n.state;return[{state:o,topPage:(0,Je.w_)(o),webTransitionType:Et(o),updateId:e.updateId??(0,nt.ZP)()}]},getLocalSearchResults:async e=>{const t=await this.getLocalSearchCache(this.environment,e.searchSessionId);if(!t)return[{error:"Local cache does not exist"}];const n=(0,at.Gu)(et.GA,e.sort);if(n)return[{error:`old sort type is unsupported! ${n}`}];const a=e.sort,o=(0,kt.f)({query:{query:{text:e.query??"",filters:e.filters,sort:a},limit:e.limit},localCachedPages:t,includeRecordMap:!1,userId:this.environment.currentUser.id,environment:this.environment}),r=[{value:{total:0,results:[],recordMap:{},trackEventProperties:void 0}}];if(!o||0===o.results.length)return r;const i=m.Z.state.online?Nt.g8(this.environment,o.results):o.results;return[{value:{results:i,total:i.length,recordMap:{},trackEventProperties:{}}}]},customAddCommentMenuItemTapped:()=>{(0,wt.ol)(this.environment,"custom_add_comment_menu_item")},filterValidMoveToBlocks:e=>{const t=e.targets.map((e=>new Jt.G(this.environment,{table:Xe.iU,id:e}))),n=e.blocks.filter((e=>{const n=new Jt.G(this.environment,{table:Xe.iU,id:e});return n.canEdit()&&(0,Ct.Xk)(n,t)}));return[{value:{targets:e.targets,blocks:n}}]},completeMoveToTransaction:async e=>{const{targets:t,destination:n,moveToContext:a,timeToSelectMs:o,isSearchResult:r,flowId:i}=e,s=this.environment,c=t.map((e=>new Jt.G(this.environment,{table:Xe.iU,id:e}))),d=dt.QF(s,t,n);if(c&&c.length>0&&!d)try{return await We.createAndCommitAsync({userAction:"MobileNativeListener.completeMoveTo",environment:s,waitForServerCommit:!1,perform:async e=>{await dt.RL({targets:c,value:n,transaction:e,environment:s,moveToContext:a,renderType:"native",timeToSelectMs:o,disableSuccessToast:!0,isSearchResult:r,flowId:i})}}),[{value:e}]}catch(l){}return it.fW(s,{type:"moved_to_subpage"}),[{error:_t.default.formatMessage(Yt.failedToMovePageGeneric)}]},undoRevision:()=>{lt.Yw(this.environment,!0)},searchTeams:async e=>{const{query:t}=e,n=c.default.state.currentSpaceStore,a=c.default.state.currentSpaceViewStore;if(!n||!a)return[{error:"SpaceStore or SpaceViewStore was undefined"}];const o=await r.FF.searchActions.load();return[{value:{ids:(await o.searchTeams({spaceViewStore:a,query:t,teamStores:a.getTeamsStores()})).map((e=>e.id))}}]}}),o.isAndroid&&Me.Z.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMobileNativeKeyboardStore),null!==(i=this.environment.mobileNative)&&void 0!==i&&i.api.ready&&this.environment.mobileNative.api.ready(),cn(this.environment),dn(this.environment,this.customAddCommentMenuItemEnabledStore))}willUnmount(){const{mobileNative:e,RouterStore:t,TabbedRouterStore:n,device:a}=this.environment;a.isMobileNative&&e&&(me.sidebarOpenStore.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSwipeNavigation),me.sidebarExpandedStore.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSideBarExpandedStateChange),xt.Z.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSwipeNavigation),t.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSwipeNavigation),Me.Z.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleKeyboardAutoScroll),this.bottomBarVisibilityStore.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBottomBarVisibilityStoreChange),this.aiAssistantEnabledStore.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleAiAssistantEnabledStoreChange),this.aiAssistantVisibilityStore.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleAiAssistantVisibilityStoreChange),n.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTabbedRouterStoreChange),this.customAddCommentMenuItemEnabledStore.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCustomAddMenuItemEnabledChanged),a.isAndroid&&Me.Z.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMobileNativeKeyboardStore))}renderComponent(){return(0,x.jsx)(nn,{getLocalSearchCache:this.getLocalSearchCache})}}en.displayName="MobileNativeListener";const tn=en;function nn(e){let{getLocalSearchCache:t}=e;const n=(0,o.O7)(),{device:r}=n,i=(0,a.useRef)(),s=(0,a.useRef)(),d=(0,a.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object.keys(e.tabs).forEach((n=>{const a=n;t&&(e.tabs[a].nativeRootPageOverrideEnabled=void 0),e.tabs[a].pages="home"!==a?[]:e.tabs[a].pages.splice(0,1)}))}),[]),l=(0,a.useCallback)((e=>{var a;i.current=null==e?void 0:e.id;const{mobileNative:o,TabbedRouterStore:r,currentUser:s}=n,l=c.default.state.currentSpaceStore,u=null==l?void 0:l.id;if(null!=o&&null!==(a=o.api)&&void 0!==a&&a.setCurrentSpaceInfo&&(y.log({level:"info",from:"appActions",type:"SpaceSwitchingDebug",data:{message:"Web calling nativeAPI setCurrentSpaceInfo",spaceId:u}}),o.api.setCurrentSpaceInfo({spaceId:u,spaceViewId:null==e?void 0:e.id,userId:s.id,editable:(null==l?void 0:l.canEdit())??!0})),(0,Tt.__)(n)){const e=e=>{if("web"!==e.type)return;const t={...e.queryParams},n=u&&(0,nt.cj)(u);t.spaceId=n,e.queryParams=t,e.route.spaceId=n},t=Ce.Xh(r.state);e(t.tabs.search.rootPage),e(t.tabs.updates.rootPage),e(t.tabs.addPage.rootPage),d(t),r.setState(t)}t(n,void 0)}),[d,n,t]),u=(0,a.useCallback)((e=>{var t;s.current=null==e?void 0:e.id,null!==(t=n.mobileNative)&&void 0!==t&&null!==(t=t.api)&&void 0!==t&&t.setCurrentUserInfo&&n.mobileNative.api.setCurrentUserInfo({userId:null==e?void 0:e.id,loggedInUserIds:n.currentUser.loggedInUserIds});const a=!(0,Tt.__)(n)||void 0===n.currentUser.id,{TabbedRouterStore:o}=n,r=Ce.Xh(o.state);d(r,a),o.setState(r)}),[d,n]),p=(0,a.useCallback)((()=>{const{currentUserStore:e,currentSpaceStore:t}=c.default.state;null!=e&&e.id&&null!=t&&t.id&&qt.Z.reinitializeState(n,e.id,t.id);(void 0===(null==e?void 0:e.id)||s.current!==(null==e?void 0:e.id))&&u(e);const a=c.default.state.currentSpaceViewStore;i.current!==(null==a?void 0:a.id)&&l(a)}),[n,l,u]);return(0,a.useEffect)((()=>{if(r.isMobileNative&&n.mobileNative)return p(),c.default.addListener(p),()=>{c.default.removeListener(p)}}),[r.isMobileNative,n,t,p]),null}function an(){$t.Z.getPreventScrollType()===Rt.Z.None&&(me.sidebarOpenStore.state?yt.Z.SidebarMobileScroller&&yt.Z.SidebarMobileScroller.scrollToTop({animate:!0,animationCallback:Ce.yR}):yt.Z.MenuScroller?yt.Z.MenuScroller.scrollToTop({animate:!0,animationCallback:Ce.yR}):yt.Z.MenuPageScroller?yt.Z.MenuPageScroller.scrollToTop({animate:!0,animationCallback:Ce.yR}):yt.Z.PageScroller&&yt.Z.PageScroller.scrollToTop({animate:!0,animationCallback:Ce.yR}))}function on(e){Vt.Z.setState({open:!0});const{query:t}=e;t&&Pt.ZP.setState({...Pt.ZP.state,currentTab:"all_pages",filter:t,limit:Pt.ZP.startLimit})}function rn(e){(0,Zt.Y)("supportsNativeHome")&&e.device.isPhone?(ut.Hu({RouterStore:e.RouterStore,currentUserId:e.currentUser.id}),pe.quickAddPage({environment:e,from:"mobile_bottom_bar",redirect:!0,quickAddParentOverride:{type:"space-private-pages"}})):pe.quickAddPage({environment:e,from:"mobile_bottom_bar"}),rt.nB(e,{itemName:"add_page"})}function sn(){an()}function cn(e){var t;null===(t=e.mobileNative)||void 0===t||t.sidebarVisibility(me.sidebarExpandedStore.state&&!(0,At.YR)(e),(0,At.qG)(e))}function dn(e,t){if(!(0,Zt.Y)("supportsCustomAddCommentMenuItem"))return;const n=t.state,{mobileNative:a}=e;null==a||a.updateCustomAddCommentMenuItemEnabled(n)}function ln(){const e=(0,o.Fy)();return function(){const e=(0,o.O7)(),t=(0,o.Fy)();(0,a.useEffect)((()=>{if(t.isMobileNative)return;let e;document.hasFocus()&&(e=setInterval((()=>{l()}),d),l());const n=()=>{e&&clearInterval(e),e=setInterval((()=>{l()}),d),l()},a=()=>{e&&clearInterval(e),e=void 0};return window.addEventListener("focus",n),window.addEventListener("blur",a),()=>{e&&clearInterval(e),window.removeEventListener("focus",n),window.removeEventListener("blur",a)}}),[t.isMobileNative,e])}(),function(){const e=(0,a.useRef)(!1),t=(0,o.O7)(),n=(0,a.useCallback)((async e=>{if(e.currentUser.id&&p.pendingTaskIds.size>0){const t=await p.getTasks(e,{taskIds:Array.from(p.pendingTaskIds.values())});if("success"===t.type){const{results:n}=t.data,a=new Set(p.pendingTaskIds);for(const t of n)a.delete(t.id),t.status&&p.handleRecordMapForResponse({environment:e,eventName:t.eventName,response:t.status,userId:e.currentUser.id}),p.pendingTaskEventsById.emit(t.id,t),S.emit(t.eventName,t),"failure"!==t.state&&"success"!==t.state&&"dead"!==t.state&&"timeout_before_execution"!==t.state||p.pendingTaskIds.delete(t.id);if(a.size>0)for(const e of a.values())p.pendingTaskIds.delete(e)}}}),[]),r=(0,a.useCallback)((async e=>{if(e.currentUser.id){const t=await p.getUserTasks(e,{});if("success"===t.type){for(const e of t.data.taskIds)p.pendingTaskIds.add(e);t.data.taskIds.length>0&&n(e)}}}),[n]),i=(0,a.useCallback)((()=>{const n=m.Z.state.online;n&&!e.current&&r(t),e.current=n}),[t,r]);function s(e){"success"===e.state?v.Z.setStatus(e.request.blockId,void 0):"in_progress"===e.state||"not_started"===e.state?v.Z.setStatus(e.request.blockId,e.status):v.Z.setStatus(e.request.blockId,void 0)}function c(e){"success"===e.state?f.Z.setStatus(e.request.blockId,!1):"in_progress"===e.state||"not_started"===e.state?f.Z.setStatus(e.request.blockId,!0):f.Z.setStatus(e.request.blockId,!1)}(0,a.useEffect)((()=>{e.current=m.Z.state.online;const a=setInterval((()=>n(t)),1e3);return r(t),m.Z.addListener(i),S.addListener("importEvernote",s),S.addListener("extractWebClipperContent",c),()=>{clearInterval(a),m.Z.removeListener(i),S.removeListener("importEvernote",s),S.removeListener("extractWebClipperContent",c)}}),[t,n,i,r])}(),function(){const e=(0,o.O7)(),t=(0,a.useCallback)((()=>{b.LH(e)}),[e]);(0,a.useEffect)((()=>(t(),g.Z.addListener(t),()=>{g.Z.removeListener(t)})),[t])}(),O(),F(),function(){const e=(0,o.O7)(),t=(0,h.VK)((()=>e.currentUser.id),[e]),n=(0,h.VK)((()=>c.default.state.currentSpaceStore),[]),r=(0,h.VK)((()=>null==n?void 0:n.id),[n]);(0,a.useEffect)((()=>{t&&r&&ie(e)}),[t,r,e])}(),function(){const e=(0,o.O7)();(0,a.useEffect)((()=>{ce(e);const t=window.setInterval((()=>ce(e)),le);return()=>window.clearInterval(t)}),[e])}(),function(){const e=(0,o.O7)();(0,Se.Z)((()=>{he(e)})),(0,a.useEffect)((()=>{const t=window.setInterval((()=>he(e)),ge);return()=>{window.clearInterval(t)}}),[e])}(),function(){const e=(0,o.O7)();(0,a.useEffect)((()=>{we(e);const t=window.setInterval((()=>we(e)),Q.U6);return()=>window.clearInterval(t)}),[e])}(),function(){const e=(0,o.O7)(),t=(0,o.Fy)(),n=(0,h.VK)((()=>{const{currentUserStore:n,currentUserSettingsStore:a,currentUserRootStore:o}=c.default.state;if(!(e.currentUser.id&&n&&a&&o))return e.publicDomainUserId?{user_id:e.publicDomainUserId}:void 0;const r=o.getSpaceViewStores(),i=r.length>0&&r.every((e=>e.isReady()));if(!n.isDefined()||!a.isDefined()||!i)return;const d=Ce.oA(r.map((e=>e.getSpaceId()))).map((t=>C.Z.getData(e,{spaceId:t})));if(!d.every((e=>Boolean(e)||null===e)))return;const l=(0,s.ls)(d),u=a.getSettings();if(!u)return;if(void 0===ae.subscriptionDataStoreInstance.state)return;const p={user_id:n.id,email:n.getEmail(),user_persona:u.persona,user_team_role:u.team_role,user_use_cases:u.use_cases,user_company_size:u.company_size,user_source:u.source,user_plan_type:l,user_subscription_tier:ae.subscriptionDataStoreInstance.state.subscriptionTier,user_has_at_least_one_free_tier_space:(0,s.nZ)(d),time_zone:u.time_zone,locale:u.locale,preferred_locale:u.preferred_locale,signup_time:u.signup_time,app_version:t.version};return u.signup_time&&(p.created_at=Math.floor(u.signup_time/1e3)),t.desktopAppVersion&&(p.desktop_app_version=t.desktopAppVersion),t.mobileAppVersion&&(p.mobile_app_version=t.mobileAppVersion),u.used_desktop_web_app&&(p.used_desktop_web_app=u.used_desktop_web_app),u.used_mobile_web_app&&(p.used_mobile_web_app=u.used_mobile_web_app),u.used_mac_app&&(p.used_mac_app=u.used_mac_app),u.used_windows_app&&(p.used_windows_app=u.used_windows_app),u.used_ios_app&&(p.used_ios_app=u.used_ios_app),u.used_android_app&&(p.used_android_app=u.used_android_app),p}),[e,t],{useDeepEqual:!0});(0,a.useEffect)((()=>{n&&"none"!==n.user_plan_type&&Te(e,n)}),[e,n]);const r=void 0!==n;(0,a.useEffect)((()=>{const t=window.setTimeout((()=>{!r&&e.currentUser.id&&Te(e,{user_id:e.currentUser.id})}),5e3);return()=>{window.clearTimeout(t)}}),[e,r])}(),function(){const e=(0,o.O7)(),t=(0,h.VK)((()=>Ne.default.state.isLoaded),[]),n=(0,h.VK)((()=>Ne.default.state.isLoggingEnabled),[]);(0,a.useEffect)((()=>{t&&async function(){const t=await(0,s.cG)(e);await ye.j2({config:M.default,isEnabled:n,deviceId:t,cookieService:e.cookieService})}()}),[e,t,n])}(),function(){const e=(0,o.O7)();(0,a.useEffect)((()=>{const t=t=>{Ee.Zm(e,t)},n=t=>{const{shortcutMap:n}=e.KeyboardShortcutStackStore,a=Ce.w_(n,((n,a)=>(0,Ue.Z)(e,t,n)));a&&!{cut:!0,copy:!0,paste:!0}[a]&&Ee.dJ(e,t,a)};return window.addEventListener("keydown",n),window.addEventListener("cut",t),window.addEventListener("copy",t),window.addEventListener("paste",t),window.addEventListener("keypress",t),()=>{window.removeEventListener("keydown",n),window.removeEventListener("cut",t),window.removeEventListener("copy",t),window.removeEventListener("paste",t),window.removeEventListener("keypress",t)}}))}(),(0,Ie.Z)(),function(){const e=(0,o.O7)(),t=(0,o.Fy)();(0,a.useEffect)((()=>{t.isElectron&&L.setLogglyData(y.clientLogglyEnvironmentData),e.mobileNative&&e.mobileNative.setLogglyData(y.clientLogglyEnvironmentData)}),[t.isElectron,e.mobileNative])}(),function(){const e=(0,o.O7)();(0,a.useEffect)((()=>{if(e.device.isMobile){function t(){ke.default.afterNextFlush((()=>{Le.hQ(e)}))}return Ve.default.addListener(t),Pe.addListener(t),()=>{Ve.default.removeListener(t),Pe.removeListener(t)}}}),[e])}(),(0,Ze.Z)(),(0,Re.ZP)(),function(){const e=(0,o.O7)();(0,a.useEffect)((()=>{const{mobileNative:t}=e;t&&t.enableBridgeMetricsCollection(e,De.default,ne.default)}),[e])}(),function(){const e=(0,o.O7)();(0,a.useEffect)((()=>{function t(){D.Z.setState({...D.Z.state,isVisible:!document.hidden});const t=I.W$(),n=t&&(Date.now()-t)/Q.A0>=7;if(e.device.isBrowser&&!document.hidden&&(!t||n)&&m.Z.getState().online){const t=e.AppUpdateStore;if(t.isSilentUpdate()){const n=t.state.appUpdate;I.hC({environment:e,url:window.location.href,version:n.version})}}}return document.addEventListener("visibilitychange",t),t(),()=>{document.removeEventListener("visibilitychange",t)}}),[e])}(),function(){const{deviceType:e}=(0,o.Fy)(),t=(0,o.O7)(),n=t.currentUser.isLoggedIn();(0,a.useEffect)((()=>{if(!n)return;if("windows-desktop"!==e&&"mac-desktop"!==e)return;const a=async()=>{await L.isMainTabOrWindow()&&p.registerDesktopApp(t,{deviceType:e})};a();const o=window.setInterval((()=>{a()}),5*Q.hM);return()=>{window.clearInterval(o)}}),[n,e,t])}(),function(){const e=(0,o.O7)(),t=(0,a.useRef)(),n=(0,a.useRef)();(0,a.useEffect)((()=>{function a(){const a=Ve.default.state,o="empty"===a.mode?void 0:a.multiSelection.start.store,r="empty"===a.mode?void 0:a.multiSelection.end.store;if(t.current===o&&n.current===r)return;if(t.current=o,n.current=r,t.current!==n.current)return;const i=$e.getSimpleTableCellFromTextSelection();if(!i)return;const{rowIndex:s,columnIndex:c,simpleTableStore:d}=i.getProps();He.selectCell({environment:e,rowIndex:s,columnIndex:c,simpleTableStore:d})}return Ve.default.addListener(a),()=>{Ve.default.removeListener(a),t.current=void 0,n.current=void 0}}))}(),function(){const e=(0,o.O7)(),t=(0,a.useCallback)((t=>{const n={compressed:t.decodedBodySize!==t.encodedBodySize,local_cache_hit:0===t.transferSize,next_hop_protocol:t.nextHopProtocol,did_prefetch:e.prefetchCache.isEnabled},a={dns_lookup:{startTime:t.domainLookupStart,endTime:t.domainLookupEnd},connection_establish:{startTime:t.connectStart,endTime:t.connectEnd},request_queued:{startTime:t.connectEnd,endTime:t.requestStart},response_wait:{startTime:t.requestStart,endTime:t.responseStart},response_download:{startTime:t.responseStart,endTime:t.responseEnd}};De.default.measure({metricName:"load_cached_page_chunk.fetch",startTime:t.fetchStart,endTime:t.responseEnd},{environment:e,data:{...n,sub_metrics:{dns_lookup:a.dns_lookup.endTime-a.dns_lookup.startTime,connection_establish:a.connection_establish.endTime-a.connection_establish.startTime,request_queued:a.request_queued.endTime-a.request_queued.startTime,response_wait:a.response_wait.endTime-a.response_wait.startTime,response_download:a.response_download.endTime-a.response_download.startTime}}});for(const[o,{startTime:r,endTime:i}]of Object.entries(a))De.default.measure({metricName:`load_cached_page_chunk.fetch.${o}`,startTime:r,endTime:i},{environment:e,data:n})}),[e]);(0,a.useEffect)((()=>{const e=new PerformanceObserver((n=>{const a=n.getEntries().find((e=>e.name.includes(`${M.default.api.http}/${Ke}`)&&!e.name.endsWith("s")));a&&("resource"===a.entryType&&t(a),null==e||e.disconnect())}));return e.observe({type:"resource",buffered:!0}),()=>{e.disconnect()}}),[t])}(),function(){const e=(0,o.O7)();(0,a.useEffect)((()=>{const t=()=>We.updateConnectionState(e);return t(),m.Z.addListener(t),()=>{m.Z.removeListener(t)}}),[e])}(),function(){const e=(0,o.O7)(),t=(0,a.useRef)("none"),n=(0,a.useCallback)((e=>{const n=t.current;e!==n&&(t.current=e,"dragging"===e?Fe.Z.setState({isDragging:!0}):"dragging"===n&&Fe.Z.setState({isDragging:!1}))}),[]),r=(0,a.useCallback)((()=>{"none"===t.current&&n("touching")}),[n]),i=(0,a.useCallback)((()=>{n("none")}),[n]),s=(0,a.useCallback)((()=>{"touching"===t.current&&Be.isExpanded(Be.get())&&n("dragging")}),[n]);(0,a.useEffect)((()=>{if(e.device.isIOS)return window.addEventListener("touchstart",r),window.addEventListener("touchend",i),window.addEventListener("touchcancel",i),document.addEventListener("selectionchange",s),()=>{window.removeEventListener("touchstart",r),window.removeEventListener("touchend",i),window.removeEventListener("touchcancel",i),document.removeEventListener("selectionchange",s)}}),[e.device.isIOS,r,i,s]);const c=(0,a.useCallback)((()=>{ke.default.afterNextFlush((()=>{xe.ls()}))}),[]),d=(0,a.useCallback)((()=>{setTimeout((()=>{Be.get()||xe.ZH({debug:{userAction:"useSelectionListener.handleFocusOut"},environment:e})}),0)}),[e]);(0,a.useEffect)((()=>(window.addEventListener("mousedown",c),e.device.isMobileBrowser&&document.addEventListener("focusout",d),()=>{window.removeEventListener("mousedown",c),document.removeEventListener("focusout",d)})),[e,c,d])}(),function(){const e=(0,o.O7)(),t=(0,o.Fy)(),n=(0,a.useRef)(!1),r=(0,a.useCallback)((()=>{"system"===b.VZ(e)&&g.Z.emit()}),[e]),i=(0,h.VK)((()=>{var e;return null===(e=c.default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.isReady()}),[]);(0,a.useLayoutEffect)((()=>{!n.current&&i&&(r(),n.current=!0)}),[i,r]),(0,a.useEffect)((()=>{if(t.isAndroid&&e.mobileNative)e.mobileNative.updateReceiveApiHandlers({themeChanged:e=>r()});else{if(qe.addEventListener&&qe.removeEventListener)return qe.addEventListener("change",r),()=>{qe.removeEventListener("change",r)};if(qe.addListener&&qe.removeListener)return qe.addListener(r),()=>{qe.removeListener(r)}}}),[t.isAndroid,e,r])}(),function(){const e=M.default.isLocalhost||!1;(0,a.useEffect)((()=>{function t(t){if(!e)return;if(!t.data||"string"!=typeof t.data.type)return;const n=t.data.type;"webpackInvalid"===n?je.oV({label:(0,x.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,x.jsx)("span",{style:{paddingRight:10},children:"Webpack Compiling"}),(0,x.jsx)("img",{src:"/images/favicon-local.ico",className:"loading-spinner",style:{display:"inline-block"}})]}),position:"top",durationMs:"keep"}):"webpackOk"!==n&&"webpackWarnings"!==n||je.rN()}return window.addEventListener("message",t),()=>{window.removeEventListener("message",t)}}),[e])}(),(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(tn,{}),e.isElectron&&(0,x.jsx)(un,{}),(0,x.jsx)(r.WK,{})]})}function un(){return function(){const e=(0,o.O7)(),t=(0,h.VK)((()=>({observedWidth:me.sidebarSizeObserver.rect.state.width,targetWidth:me.sidebarWidthStore.state,isExpanded:me.sidebarExpandedStore.state,resizing:me.sidebarResizingStore.state,isMouseEntered:me.sidebarMouseEnteredStore.state})),[]),n=e.currentUser.isLoggedIn(),r=(0,E.formatVersion)(L.getDesktopVersion()),[i,d]=(0,a.useState)(!1);(0,a.useEffect)((()=>{i&&L.windowSidebarState.set({isLoggedIn:n,...t})}),[t,n,i]);const l=(0,h.VK)((()=>ue.ZP.getState().enabled),[]);(0,a.useEffect)((()=>{L.setIsMediaActive(l)}),[l]),(0,a.useEffect)((()=>{let e;e=n?t.isExpanded?"expanded":"collapsed":"disabled",L.sidebarState.set(e)}),[t.isExpanded,n]);const u=(0,h.VK)((()=>{var e,t,n;return{currentUserId:null===(e=c.default.state.currentUserStore)||void 0===e?void 0:e.id,currentSpaceId:null===(t=c.default.state.currentSpaceStore)||void 0===t?void 0:t.getSpaceId(),currentPageId:null===(n=c.default.state.mainEditorCurrentBlockStore)||void 0===n?void 0:n.id}}),[]);(0,a.useEffect)((()=>{L.setAppStoreState(u)}),[u]);const m=(0,a.useCallback)(((t,n,a)=>{s.K4(e,n,a)}),[e]);(0,a.useEffect)((()=>(L.track.addListener(m),()=>{L.track.removeListener(m)})),[m]);const v=(0,a.useCallback)(((e,t)=>{d(t)}),[]);(0,a.useEffect)((()=>(L.isActiveTab.get().then((e=>{d(e)})),L.isActiveTab.addListener(v),()=>{L.isActiveTab.removeListener(v)})),[v]);const f=(0,a.useCallback)(((e,t)=>{void 0===t.isShowingTabBar&&(t.isShowingTabBar=!0),ve.Z.setState(t)}),[]);(0,a.useEffect)((()=>{var e;return null===(e=L.electronAppFeatures.get())||void 0===e||e.then((e=>{ve.Z.setState(e)})),L.electronAppFeatures.addListener(f),()=>{L.electronAppFeatures.removeListener(f)}}),[f]);const S=(0,a.useCallback)(((e,t)=>{fe.Z.setState({tabs:t})}),[]);(0,a.useEffect)((()=>(L.electronTabs.addListener(S),()=>{L.electronTabs.removeListener(S)})),[S]);const b=(0,a.useCallback)((n=>{pe.setExpand({environment:e,isExpanded:!t.isExpanded,from:"electron_listener"})}),[e,t.isExpanded]);(0,a.useEffect)((()=>(L.sidebarState.addToggleListener(b),()=>{L.sidebarState.removeToggleListener(b)})),[b]);const g=(0,a.useCallback)(((e,t)=>{t?pe.open({fromElectron:!0}):pe.close()}),[]);(0,a.useEffect)((()=>(L.sidebarState.addSetSidebarOpenListener(g),()=>{L.sidebarState.removeSetSidebarOpenListener(g)})),[g]);const _=(0,a.useCallback)(((e,t)=>{me.sidebarExpandedStore.setState(t.isExpanded),me.sidebarWidthStore.setState(t.targetWidth)}),[]);(0,a.useEffect)((()=>(L.windowSidebarState.addListener(_),()=>{L.windowSidebarState.removeListener(_)})),[_]),(0,a.useEffect)((()=>{!async function(){if(void 0===r)return;const t=await p.isDesktopVersionCompatible(e,{desktopVersion:r});"success"!==t.type||t.data.compatible||window.location.replace(M.default.domainBaseUrl+t.data.redirect)}()}),[r,e])}(),null}},970515:(e,t,n)=>{n.d(t,{Q:()=>r});var a=n(401898),o=n(453365);function r(e){var t;const{environment:n,assistantFeatureGateStore:r,currentSpaceViewStore:i,currentSpaceStore:s}=e;if(!i||!s)return!1;const c=(null==s?void 0:s.canAdmin())??!1,d=(0,o.$_)(n,s.id),l=Boolean(null===(t=i.getSettings())||void 0===t?void 0:t.has_user_seen_leap_modal);return r.isWorkspaceLeapEligible()&&c&&!d&&!(0,a.$K)(s.getSettings().enable_ai_training)&&!l}},954690:(e,t,n)=>{n.d(t,{$:()=>m});var a=n(647425),o=n(454642),r=n(970515),i=n(215010),s=n(548779),c=n(319385),d=n(88893);const l=4;function u(e){const{requiredStores:{currentUserSettingsStore:t},minAccountAgeInDays:n,announcementDateInMs:a}=e,o=t.getSettings(),r=null==o?void 0:o.signup_time,s=function(e){const{currentUserSettingsStore:t,minAccountAgeInDays:n=l}=e,a=(0,i.e2)(t);return!(Number(a)>=n)}({currentUserSettingsStore:t,minAccountAgeInDays:n});return void 0!==o&&!s&&!(a&&r&&r>a)}function p(e){return"unsubscribed_admin"===e.state.type||"unsubscribed_member"===e.state.type}const m={dummy_modal:async(e,t)=>{var n;const{currentUserSettingsStore:a}=t;return Promise.resolve(!e.device.isMobile&&!e.device.isElectron&&c.default.checkGate({gateName:"can_see_callout_modal_test"})&&u({requiredStores:t})&&!(null!==(n=a.getSettings())&&void 0!==n&&n.seen_dummy_modal))},ai_slack_universal_qna_announcement:async(e,t)=>{const{currentSpaceStore:n,currentSpaceViewStore:r,mainEditorCurrentBlockStore:i,assistantFeatureGateStore:c}=t;if(e.device.isMobile)return!1;const d=r.getSettings();if(void 0===d||void 0!==d.slack_universal_qna_announcement_seen_at)return!1;const l=(n.getMemberCountFromPublicSpaceData()??1)>1;if(!(i.canRead()&&n.canAdmin()&&(0,s.j9)(n)&&(0,a.Mk)(n.getSubscriptionTier())&&l))return!1;if(!u({requiredStores:t,minAccountAgeInDays:8}))return!1;if(!c.canSeeSlackUniversalQnaAnnouncementModal()||!c.isAiEnabled())return!1;try{const t=await o.getConnectedAppsForUniversalQna(e,{spaceId:n.getSpaceId()});return"success"===t.type&&!t.data.connectedApps.includes("slack-admin")}catch{return!1}},ai_assistant_announcement:async(e,t)=>{const{currentUserSettingsStore:n,mainEditorCurrentBlockStore:a,assistantFeatureGateStore:o,currentSpaceStore:i,currentSpaceViewStore:s}=t,c=n.getSettings();if(!c)return!1;if(e.device.isMobile)return!1;const d=void 0!==(null==c?void 0:c.ai_assistant_onboarding_phase),l=Boolean(i.getSettings().enable_ai_training),p=(0,r.Q)({environment:e,assistantFeatureGateStore:o,currentSpaceStore:i,currentSpaceViewStore:s}),m=!d||p&&!l;return Promise.resolve(a.canRead()&&u({requiredStores:t,minAccountAgeInDays:8})&&m&&o.canSeeAssistantFeaturePromotionalModal())},charts_launch_modal:async(e,t)=>{const{currentUserSettingsStore:n,mainEditorCurrentBlockStore:a,experimentStore:o,currentSpaceStore:r}=t,i=n.getSettings();return Promise.resolve(!e.device.isMobile&&n.isReady()&&a.canRead()&&(0,s.j9)(r)&&void 0!==i&&u({requiredStores:t})&&void 0===i.charts_launch_modal_phase&&o.checkGate({gateName:"charts_mvp"})&&o.checkGate({gateName:"charts_beta_launch_modal"}))},sidebar_upgrade_nudge:async(e,t)=>{const{currentUserSettingsStore:n,subscriptionDataStore:a,currentSpaceStore:o}=t,r=n.getSettings();return Promise.resolve(!e.device.isMobile&&!(null!=r&&r.dismissed_sidebar_upgrade_nudge)&&p(a)&&1===d.su(a.state)&&!(0,s.Q9)(o))},persistent_upgrade_nudge:async(e,t)=>{const{subscriptionDataStore:n,experimentStore:a}=t,o="on"===a.getEligibleGroup({experimentId:"money_corner",defaultGroup:"control"});return Promise.resolve(p(n)&&o)},sites_launch_modal:async(e,t)=>Promise.resolve(!1),notion_calendar_launch_promo:(e,t)=>Promise.resolve(!1),ai_qna_alpha:(e,t)=>Promise.resolve(!1),startup_sidebar_footer:(e,t)=>Promise.resolve(!1)}},706210:(e,t,n)=>{n.d(t,{Ev:()=>s,YF:()=>c,bl:()=>i,gF:()=>o,lZ:()=>r});var a=n(730459);function o(e,t){a.K4(e,"callout_show",t)}function r(e,t){a.K4(e,"callout_click",t)}function i(e,t){a.K4(e,"callout_dismiss",t)}function s(e,t){a.K4(e,"callout_engagement",t)}function c(e,t){const{eligible_callouts:n}=t,o=Object.values(n).flatMap((e=>Array.from(e)));a.K4(e,"callout_coordinator_resolved",{eligible_callouts:o})}},698938:(e,t,n)=>{n.d(t,{Z:()=>H});var a=n(667294),o=n(800480),r=n(886628),i=n(724405),s=n(841892),c=n(415095),d=n(643593),l=n(517755),u=n(842875),p=n(379362),m=n(522808),v=n(882883),f=n(709291),S=n(653965),b=n(218265),g=n(247839),h=n(608055),_=n(95477),w=n(360682),C=n(924990),O=n(119037),T=n(304708),y=n(542129),N=n(296994);const E=32;const U=32;async function I(e){const t=document.createElement("canvas");t.width=U,t.height=U;const n=t.getContext("2d"),a=document.createElement("img");return a.src=e,new Promise((e=>{a.onload=()=>{n.drawImage(a,0,0,U,U),e(t.toDataURL("image/png"))},a.onerror=()=>{e("")}}))}var k=n(484210),A=n(583055),L=n(433929),M=n(367669),V=n(394841),P=n(819034),Z=n(70853),R=n(356437),D=n(80444),x=n(780641),B=n(453730),F=n(141737);const q=(0,f.defineMessages)({notionAiDocTitle:{id:"documentTitleListener.notionAi.title",defaultMessage:"Notion AI"}});const H=function(){const e=(0,o.O7)(),t=(0,f.useIntl)(),n=(0,i.Fg)(),U=(0,a.useRef)(),H=(0,r.SI)((()=>{const{RouterStore:n,device:a}=e,o=n.state.route;if("chat"===o.name)return{assetPath:s.Z.images.assistantStaticFaceFaviconPng,title:t.formatMessage(q.notionAiDocTitle)};if("marketplace"===o.name)return{assetPath:s.Z.images.templates.faviconIco};if("settingsConsoleOrganization"===o.name)return{title:"Organization settings"};const r=D.default.state.mainEditorCurrentBlockStore;if(!r||!r.isReady())return;const i="page"===o.name&&o.blockId===r.id,d=r.getSpaceStore()??D.default.state.currentSpaceStore;let l=!1;if("space"===o.name&&o.requestedOnPublicDomain)if(T.Pr()){const e=Z.rl(d,r.id);l=(null==e?void 0:e.getDomainName())===o.spaceDomain}else l=(null==d?void 0:d.getPublicHomePage())===r.id;if(!i&&!l)return;const p=P.Z.getTotalUnreadMentionsCount(),m=r.getTitleStore();let f;const S=r.getModel(),b=r.getCollectionViewIds(),g=null==m?void 0:m.getRecordModel(m.pointer);if(m&&g){if(f=(0,v.X)({intl:L.default.getIntl(),textValue:m.getValue(),userTimeZone:(0,u.r)(),getRecordModel:r.getRecordModel})||g.getEmptyTitlePlaceholder({getRecordModel:m.getRecordModel,userTimeZone:(0,u.r)(),intl:t}),"block"===m.table&&(0,V.WE)(r)&&d){f=`${d.getName()} - ${t.formatMessage({id:"DocumentTitleListener.personalHomeLabel",defaultMessage:"Home"})}`}if("collection"===m.table&&S&&S.isCollectionView()&&b.length>1){const e=D.default.state.currentCollectionViewStore;e&&e.getName()&&(f=`${f} | ${e.getName()}`)}a.isElectron||(f=(0,c.db)(f.slice(0,100),C.Z.state)),M.IJ(e,r)||e.device.isElectron||e.device.isMobileNative||(p>9?f=`(9+) ${f}`:p>0&&(f=`(${p}) ${f}`))}let h;null!=d&&d.getPublicSpaceData()&&(h="page"===o.name?(0,k.ZP)({store:r,fullyQualified:!1,scrollToBlockId:null==o?void 0:o.scrollToBlockId,peekViewBlockId:o.peekViewBlockId,peekMode:o.peekMode,collectionViewId:o.collectionViewId,discussionId:o.discussionId,showMoveTo:o.showMoveTo,saveParent:o.saveParent,templateGalleryItem:o.templateGalleryItem,projectManagementLaunch:o.projectManagementLaunch,pageVisitSource:void 0}):(0,k.ZP)({store:r,fullyQualified:!1,pageVisitSource:void 0}));const _=null==S?void 0:S.isNonverifiedContentClassification(),w=_&&S&&x.Z.bypassedPage(r.id),y=(0,O.Iay)(),N=function(e,t,n){if(!T.Pr()||"space"!==e.name&&"page"!==e.name||!e.requestedOnPublicDomain||!t)return n.getIcon();{const e=R.gR(n);if(null==e||!e.getSiteId())return n.getIcon();const t=null==e?void 0:e.getSiteStore();if(e&&t&&t.isDefined()){const a=t.getFaviconUrl();return a?{pointer:e.pointer,icon:a}:n.getIcon()}}}(o,d,r);return{title:f,url:h,icon:N,isNonverified:_,hasBypassedContentClassification:w,isMemberOfSpace:y}}),[e,t]);return(0,r.Kw)(H),(0,a.useEffect)((()=>{const a=S.Ds((function(){const{device:a}=e,o=H.state;if(!o)return;const{url:r,title:i,icon:u}=o;let v,f,S,C;u&&(0,p.V2)(u.icon)?S=u.icon:u&&(0,m.Z)(u.icon)?v=u.icon:u&&d.F8(u.icon)?f=u:o.assetPath&&d.LF(o.assetPath)&&(C=o.assetPath);const O=o.isNonverified&&!o.hasBypassedContentClassification&&!o.isMemberOfSpace;i&&document.title!==i&&(O?document.title=t.formatMessage({id:"pageTitle.flaggedContent",defaultMessage:"Flagged Content"}):a.isSafari&&v?document.title=`${v} ${i}`:document.title=i),r&&b.T1(r)!==b.T1(window.location.href)&&(window.history.replaceState(window.history.state,void 0,r),h.j7({environment:e,url:window.location.href}));const T=document.querySelector("link[rel='shortcut icon']");if(T){const t=s.Z.images.faviconIco;if(O)T.href=t,U.current=t;else if(v)v!==U.current&&(U.current=v,async function(e,t){const n=document.createElement("canvas");n.width=E,n.height=E;const a=n.getContext("2d");if(a.font="normal normal normal 32px/32px sans",a.textAlign="center",a.textBaseline="middle","raw"===t)return a.fillText(e,n.width/2,n.height/2+4),n;const o=await N.FF.emojiData.load(),r=(0,y.y)(e,o);if(!r)return;const i=document.createElement("img");i.src=(0,c.bk)(t);const s=(0,c.G0)(r);return new Promise((e=>{i.onload=()=>{a.drawImage(i,s.x,s.y,s.size,s.size,0,0,E,E),e(n)},i.onerror=()=>{e(void 0)}}))}(v,(0,w.e_)(e)).then((async e=>{await A.waitForInitialPageRenderToComplete(),await F.Z.waitUntil((()=>!F.Z.state.isMeasuring)),T.href=(null==e?void 0:e.toDataURL("image/png"))||""})));else if(S){if(S!==U.current){U.current=S;const e=`${S}?mode=${n.mode}`;a.isFirefox?T.href=e:I(e).then((e=>{T.href=e}))}}else if(f){const{icon:t,...n}=f,a=l.EK({url:t,width:100,permissionRecord:n.pointer,baseUrl:_.default.domainBaseUrl,fullyQualified:!1,userId:e.currentUser.id});a!==U.current&&(U.current=a,B.transactionQueue.awaitRecordTransaction(n.pointer).then((()=>I(a))).then((e=>{T.href=e})))}else if(C){const t=l.Q4({url:C,width:100,baseUrl:_.default.domainBaseUrl,fullyQualified:!1,userId:e.currentUser.id});t!==U.current&&(U.current=t,I(t).then((e=>{T.href=e})))}else t!==U.current&&(T.href=t,U.current=t)}g.electronApi&&g.electronApi.setWindowTitle&&i&&g.electronApi.setWindowTitle(i)}),500,{leading:!0}),o=document.title;return H.state&&a(),H.addListener(a),()=>{H.removeListener(a),document.title=o}}),[e,t,H,n.mode]),null}},110854:(e,t,n)=>{n.d(t,{Tm:()=>S,mK:()=>b,p9:()=>f});var a=n(89101),o=n(554153),r=n(211342),i=n(436610),s=n(102449),c=n(135253),d=n(547307),l=n(247839),u=n(412714),p=n(95477),m=n(44819),v=n(421051);const f=!1,S="electronUpdateReady2";function b(e){const{AppUpdateStore:t,device:n}=e;if(i.By(e),f){const t=(0,m.Us)(a._j.releases);u.D({environment:e,url:t})}if(n.isElectron&&t.state.electronUpdate&&"ready"===t.state.electronUpdate.state){const e=l.getDesktopVersion();o.Z.set(S,(0,r.formatVersion)(e)),l.installElectronUpdate()}else t.state.appUpdate&&"ready"===t.state.appUpdate.state?(s.hC({environment:e,url:window.location.href,version:t.state.appUpdate.version}),d.dismissDialog(),c.Js({bannerStore:v.Z})):(s.D$((0,r.parseVersion)(p.default.version)),d.dismissDialog(),c.Js({bannerStore:v.Z}))}},44819:(e,t,n)=>{n.d(t,{Us:()=>r,XR:()=>i});var a=n(313991),o=n(813559);n(653965),n(95477);Boolean("en-US"===a.SP);function r(e){const t="https://www.notion.so";return"en-US"!==a.SP?`${t}/${a.SP.toLocaleLowerCase()}${e}`:`${t}${e}`}function i(e,t){if(e.device.isElectron||e.device.isMobileNative)return!1;const n=(0,o.XU)(t,e.currentUser.isLoggedIn());return!!n&&"devOnly"!==n}},279827:(e,t,n)=>{n.r(t),n.d(t,{CalloutGroupStore:()=>r,default:()=>s});var a=n(749085),o=n(79571);class r extends a.default{getInitialState(){return new Set}add(e){this.setState(new Set(this.state).add(e))}delete(e){const t=new Set(this.state);t.delete(e),this.setState(t)}has(e){return this.state.has(e)}clear(){this.setState(new Set)}}class i extends a.default{getInitialState(){return{placementStores:{Modal:new r,SidebarFooter:new r},forcedCalloutsStore:new r}}getCalloutVisibility(e){const t=(0,o.QN)(e);return{isEligible:this.state.placementStores[t].has(e),isForced:this.state.forcedCalloutsStore.has(e)}}isForced(e){return this.state.forcedCalloutsStore.has(e)}getCalloutsForPlacement(e){return Array.from(this.state.placementStores[e].state)}}const s=new i},853610:(e,t,n)=>{n.d(t,{Z:()=>a});const a=new(n(61766).Z)},866881:(e,t,n)=>{n.d(t,{g:()=>a});const a=n(749085).default.createValue({shouldReset:!1},{name:"MobileAssistantMenuStore"})},449682:(e,t,n)=>{n.d(t,{Z:()=>a});const a=new(n(61766).Z)},79571:(e,t,n)=>{n.d(t,{xg:()=>d,$Q:()=>l,$Z:()=>s,rx:()=>c,Y6:()=>p,QN:()=>m,$e:()=>u,nK:()=>r});var a=n(730120);const o=[{name:"ai_qna_alpha",placement:"Modal",start:a.ou.fromISO("June 1 2024").toMillis(),end:a.ou.fromISO("June 15 2025").toMillis()},{name:"ai_slack_universal_qna_announcement",placement:"Modal",migrated:!0,start:a.ou.fromISO("June 1 2024").toMillis(),end:a.ou.fromISO("June 15 2025").toMillis()},{name:"ai_assistant_announcement",placement:"Modal",migrated:!0,start:a.ou.fromISO("June 1 2024").toMillis(),end:a.ou.fromISO("June 15 2025").toMillis()},{name:"dummy_modal",placement:"Modal",migrated:!0,start:a.ou.fromISO("June 1 2024").toMillis(),end:a.ou.fromISO("June 15 2025").toMillis()},{name:"notion_calendar_launch_promo",placement:"Modal",start:a.ou.fromISO("June 1 2024").toMillis(),end:a.ou.fromISO("June 15 2025").toMillis()},{name:"charts_launch_modal",placement:"Modal",start:a.ou.fromISO("June 1 2024").toMillis(),end:a.ou.fromISO("June 15 2025").toMillis()},{name:"sites_launch_modal",placement:"Modal",start:a.ou.fromISO("June 25 2024").toMillis(),end:a.ou.fromISO("June 25 2025").toMillis()},{name:"persistent_upgrade_nudge",placement:"SidebarFooter",migrated:!0,start:a.ou.fromISO("June 1 2024").toMillis(),end:a.ou.fromISO("June 15 2025").toMillis()},{name:"sidebar_upgrade_nudge",placement:"SidebarFooter",migrated:!0,start:a.ou.fromISO("June 1 2024").toMillis(),end:a.ou.fromISO("June 15 2025").toMillis()},{name:"startup_sidebar_footer",placement:"SidebarFooter",start:a.ou.fromISO("June 1 2024").toMillis(),end:a.ou.fromISO("June 15 2025").toMillis()}],r=["Modal","SidebarFooter"],i=o,s=i.map((e=>e.name)),c=i.filter((e=>!!e.migrated)).map((e=>e.name)),d=i.reduce(((e,t)=>({...e,[t.name]:t})),{}),l={globalConstraint:{frequencyCap:{maxCountInWindow:Number.POSITIVE_INFINITY,window:"week"}},placementConstraints:{Modal:{conflictsWith:[],maxConcurrent:1,frequencyCap:{maxCountInWindow:Number.POSITIVE_INFINITY,window:"week"}},SidebarFooter:{conflictsWith:[],maxConcurrent:1,frequencyCap:{maxCountInWindow:Number.POSITIVE_INFINITY,window:"week"}}}};function u(){return{Modal:new Set,SidebarFooter:new Set}}function p(){return{Modal:[],SidebarFooter:[]}}function m(e){return d[e].placement}}}]);