"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[86467],{486467:(e,t,r)=>{r.d(t,{IX:()=>A,ZP:()=>Z,qh:()=>W,dY:()=>Q});r(757658);var i=r(667294),s=r(313991),n=r(800480),o=r(886628),a=r(724405),l=r(407057),d=r(519889),u=r(307928),c=r(709291),g=r(531701),p=r(653965),h=r(761045),m=r(107401),f=r(934700),v=r(220095),S=r(424042),x=r(319385),b=r(206258),y=r(164921),I=r(526388),w=r(164369),M=r(729302),U=r(45653),j=r(540107),k=r(144615),C=r(325320),T=r(702688),V=r(453730);function B(e){const t=(0,n.O7)(),r=(0,i.useRef)(),s=(0,j.t)(),o=(0,i.useCallback)((async()=>{if(await V.transactionQueue.awaitRecordTransaction(e.blockStore.pointer),!s())return;const i=(0,k.pb)(e.blockStore.id);r.current=T.ZP.addListener(i,p.P2((()=>C.Ri(t,{blockStore:e.blockStore,pageVisitStore:e.pageVisitStore,incremental:!0,limit:e.limit})),1e3),void 0,t)}),[t,s,e.blockStore,e.limit,e.pageVisitStore]),a=(0,i.useCallback)((()=>{r.current&&(T.ZP.removeListener(r.current,t),r.current=void 0)}),[t]);return(0,i.useEffect)((()=>(o(),a)),[o,a]),null}var D=r(785893);const O=5,F=25,R=5,N=23,E=6,A=22;const Z=function(e){let{pageVisitStore:t,presenceStore:r,rootStore:i,maxUsers:s}=e;return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(m.at,{rootStore:i}),(0,D.jsx)(Y,{rootStore:i,pageVisitStore:t,presenceStore:r,maxUsers:s}),(0,D.jsx)(B,{blockStore:i,pageVisitStore:t,limit:1+P(s)+F})]})};function K(e){return p.MR(e,(e=>e.activityTimestampNearestMinuteMs))}function P(e){return e??O}function L(e,t){return b.U6.createChildStore(t,{table:d.KJ,id:e})}function W(e,t,r,i){const s=i?E:R;return{...(0,f.X)({noDrag:r?e.device.isElectron&&!t:e.device.isElectronMac&&!t}),display:"flex",alignItems:"center",position:"relative",flexDirection:"row-reverse",marginLeft:4+s,marginTop:-2,transform:"translateZ(0)"}}function z(e){return{color:e.mediumInvertedTextColor,fontSize:10,textTransform:"uppercase",letterSpacing:"0.015em"}}function _(e){let{userData:t,isPresent:r,rootStore:i}=e;const d=(0,a.Fg)(),g=(0,n.O7)(),p=(0,c.useIntl)(),h=g.currentUser.id,m=(0,o.VK)((()=>L(t.userId,i)),[t,i]),f=(0,o.VK)((()=>m.isDefined()),[m]),v=(0,o.VK)((()=>(0,u.Nz)(p,m.getModel())),[p,m]),S=(0,o.VK)((()=>m.getEmail()),[m]);if(!f)return null;let x;return r?h!==m.id&&(x=t.blockId?(0,D.jsx)(c.FormattedMessage,{defaultMessage:"Viewing now. Click to see where they are.",id:"topbar.presenceIndicator.viewingNowWithLocation.tooltip"}):(0,D.jsx)(c.FormattedMessage,{defaultMessage:"Viewing now",id:"topbar.presenceIndicator.viewingNow.tooltip"})):h!==m.id&&t.activityTimestampNearestMinuteMs&&(x=(0,D.jsx)(c.FormattedMessage,{defaultMessage:"Last viewed {timeFromNow}",id:"topbar.presenceIndicator.lastViewedTime.tooltip",values:{timeFromNow:(0,l.tv)(Math.min(t.activityTimestampNearestMinuteMs,Date.now()),s.SP)}})),(0,D.jsxs)("div",{children:[(0,D.jsx)("div",{className:"notranslate",children:v}),(0,D.jsx)("div",{style:{fontWeight:400},children:S}),x&&(0,D.jsx)("div",{style:{color:d.mediumInvertedTextColor,minWidth:150,paddingTop:2,paddingBottom:2,lineHeight:1.3},children:x})]})}function G(e){let{userData:t,index:r,rootStore:i}=e;const d=(0,a.Fg)(),u=(0,n.O7)(),c=(0,v.MR)(u,t),g=(0,o.VK)((()=>L(t.userId,i)),[t,i]);if(!(0,o.VK)((()=>g.isDefined()),[g]))return null;let p;!c&&t.activityTimestampNearestMinuteMs&&(p=(0,l.tv)(t.activityTimestampNearestMinuteMs,s.SP));const m=(0,D.jsxs)("div",{style:{display:"flex",alignContent:"flex-end",minWidth:140,width:"100%",marginTop:4},children:[(0,D.jsx)(M.Z,{userStore:g,avatarSize:18,style:{flexGrow:1}}),(0,D.jsx)("div",{style:{marginLeft:"auto",paddingLeft:12,textAlign:"right",flexShrink:1,color:d.mediumInvertedTextColor},children:p})]});if(c&&t.blockId){const e=t.blockId;return(0,D.jsx)(y.Z,{onClick:()=>h.hl([e],!0),style:{display:"flex",alignItems:"center"},children:m})}return(0,D.jsx)("div",{style:{display:"flex",alignItems:"center"},children:m})}function H(e){let{hiddenUsers:t,rootStore:r,areColorfulBordersEnabled:i}=e;const s=(0,a.Fg)(),o=(0,n.O7)(),l=i?E:R;return(0,D.jsx)(I.Z,{allowHover:!0,originGap:7,renderTooltip:e=>{const i=[],n=[];for(const r of t)(0,v.MR)(o,r)?i.push(r):n.push(r);const a=n.slice(0,F-i.length);return(0,D.jsxs)("div",{...e,children:[i.length>0&&(0,D.jsxs)("div",{style:{marginBottom:4},children:[(0,D.jsx)(w.Z,{style:z(s),children:(0,D.jsx)(c.FormattedMessage,{defaultMessage:"Viewing now",id:"topbar.presenceIndicator.hiddenUsers.viewingNow.tooltip"})}),i.map(((e,t)=>(0,D.jsx)(G,{userData:e,index:t,rootStore:r},t)))]}),a.length>0&&(0,D.jsxs)("div",{style:{marginBottom:4},children:[(0,D.jsx)(w.Z,{style:{...z(s)},children:(0,D.jsx)(c.FormattedMessage,{defaultMessage:"Last viewed by",id:"topbar.presenceIndicator.hiddenUsers.lastViewedBy.tooltip"})}),a.map(((e,t)=>(0,D.jsx)(G,{userData:e,index:t,rootStore:r},t)))]}),n.length>a.length&&(0,D.jsx)("div",{style:{marginLeft:2,marginTop:2,color:s.mediumInvertedTextColor},children:(0,D.jsx)(c.FormattedMessage,{defaultMessage:"{notViewingMoreUsersCount} moreâ€¦",id:"topbarPresence.presenceIndicator.hiddenUsers.moreUsersNotViewing.tooltip",values:{notViewingMoreUsersCount:n.length-a.length}})})]})},render:e=>(0,D.jsx)("div",{style:{color:s.mediumTextColor,fontSize:14,marginLeft:2*l,marginRight:-l,whiteSpace:"nowrap"},...e,children:(0,D.jsx)(c.FormattedMessage,{defaultMessage:"{hiddenUsersCount, plural, one {+{hiddenUsersCount}} other {+{hiddenUsersCount}}}",id:"topbar.presenceIndicator.hiddenUsers.otherCount.message",values:{hiddenUsersCount:t.length}})})})}function Q(e,t){return(0,a.yK)((r=>{const i={width:A,height:A,borderRadius:A},s=e(r);return{button:{transition:"all 0.2s ease",transform:"scale(1)"},buttonHovered:{transform:"scale(1.15)",background:"none"},buttonPressed:{transform:"scale(0.9)",background:"none"},uiUserAvatarStyles:{...i},avatarInnerOutline:{...i,outlineStyle:"solid",outlineColor:r.UIUserAvatarInnerOutline,outlineWidth:.5,outlineOffset:-.5},avatarBorder:t?{...i,outlineStyle:"solid",outlineColor:s,outlineWidth:1.5,outlineOffset:-.5}:{},avatarOuterOutline:{...i,outlineStyle:"solid",outlineColor:t?r.UIUserAvatarOuterOutline:r.UIUserAvatarIdleOutline,outlineWidth:.5,outlineOffset:t?1:0,marginRight:-6,position:"relative"},initialColor:{color:t?s:r.icon.secondary},legacyAvatarStyle:{width:N,height:N,borderRadius:N,marginRight:-R,position:"relative"}}}),[e,t])}function X(e){let{userData:t,rootStore:r,areColorfulBordersEnabled:s}=e;const a=(0,n.O7)(),{userId:l}=t,d=(0,v.MR)(a,t),u=L(l,r),c=(0,o.VK)((()=>u.isDefined()&&!u.getIsSuspended()),[u]),p=Q((0,i.useCallback)((e=>l===a.currentUser.id?e.UIUserAvatarSelfBorder:(0,g.iY)(l,e)),[a.currentUser.id,l]),d);return c?(0,D.jsx)(I.Z,{textWrap:!0,renderTooltip:()=>(0,D.jsx)(_,{rootStore:r,userData:t,isPresent:d}),render:e=>{const r=s?(0,D.jsx)("div",{style:p.avatarOuterOutline,children:(0,D.jsx)("div",{style:p.avatarBorder,children:(0,D.jsx)(U.Z,{iconStyle:p.avatarInnerOutline,userStore:u,style:p.uiUserAvatarStyles,isOffline:!d,size:A,avatarShouldShowShadow:!0,initialOverrideStyle:p.initialColor})})}):(0,D.jsx)(U.Z,{userStore:u,style:p.legacyAvatarStyle,isOffline:!d,size:N,avatarShouldShowShadow:!0});if(d&&t.blockId){const i=t.blockId;return(0,D.jsx)(y.Z,{...e,onClick:()=>h.hl([i],!0),style:p.button,hoveredStyle:p.buttonHovered,pressedStyle:p.buttonPressed,children:r})}return(0,D.jsx)("div",{...e,children:r})}}):null}function Y(e){let{rootStore:t,pageVisitStore:r,presenceStore:i,maxUsers:s}=e;const a=(0,n.O7)(),l=a.currentUser.id,d=(0,o.VK)((()=>{const e=a.currentUser.id;if(!e)return;const t=(0,v.AQ)(r,i),n=[],o=[];for(const r of t)r.userId!==e&&((0,v.MR)(a,r)?n.push(r):o.push(r));const l=[...K(n).reverse(),...K(o).reverse()],d=P(s)-1;return{visibleUsers:l.slice(0,d),hiddenUsers:l.slice(d)}}),[r,i,a,s]),{visibleUsers:u,hiddenUsers:c,isEveryUserStoreReady:g}=(0,o.VK)((()=>{if(!l)return{};const{visibleUsers:e=[],hiddenUsers:r=[]}=d??{},i=[l,...e.map((e=>e.userId)),...r.map((e=>e.userId))];return{visibleUsers:e,hiddenUsers:r,isEveryUserStoreReady:i.map((e=>L(e,t))).every((e=>e.isReady()))}}),[l,d,t]),{isShowingTabBar:p,isUnifiedTitleBarEnabled:h}=(0,o.VK)((()=>{var e;return{isShowingTabBar:Boolean(S.Z.state.isShowingTabBar),isUnifiedTitleBarEnabled:Boolean(null===(e=S.Z.state.preferences)||void 0===e?void 0:e.isUnifiedTitleBarEnabled)}}),[]),f=(0,o.VK)((()=>x.default.checkGate({gateName:"colorful_presence_avatars"})),[]);if(!l||!d||!g)return null;if(0===u.length&&0===c.length)return(0,D.jsx)("div",{style:W(a,p,h,f),children:(0,D.jsx)(m.ew,{enableClickToScroll:!0,rootStore:t})});{const e=[...u];return e.reverse(),(0,D.jsxs)("div",{style:W(a,p,h,f),children:[c.length>0&&(0,D.jsx)(H,{rootStore:t,hiddenUsers:c,areColorfulBordersEnabled:f}),e.map((e=>(0,D.jsx)(X,{userData:e,rootStore:t,areColorfulBordersEnabled:f},e.userId))),(0,D.jsx)(X,{rootStore:t,userData:{userId:l,present:!0},areColorfulBordersEnabled:f}),(0,D.jsx)(m.ew,{enableClickToScroll:!0,rootStore:t})]})}}},107401:(e,t,r)=>{r.d(t,{AZ:()=>a,at:()=>o,ew:()=>u,vo:()=>d,wI:()=>l});var i=r(296994),s=r(277907);const n=i.FF.dictation,o=(0,s.kF)(n,(e=>e.StopDictationButton)),a=(0,s.kF)(n,(e=>e.StopDictationListener)),l=(0,s.kF)(n,(e=>e.StopDictationButtonMobile)),d=(0,s.kF)(n,(e=>e.DictationBubble)),u=(0,s.kF)(n,(e=>e.DictationAvatar))},934700:(e,t,r)=>{function i(e){return"drag"in e&&e.drag?{WebkitAppRegion:"drag"}:"noDrag"in e&&e.noDrag?{WebkitAppRegion:"no-drag"}:{}}r.d(t,{X:()=>i})},220095:(e,t,r)=>{r.d(t,{AQ:()=>g,EB:()=>u,MR:()=>c});r(757658);var i=r(772141),s=r(653965),n=r(619584),o=r(88893),a=r(288280),l=r(367669);const d=18e4;function u(e){if(e&&e.blockId)return e.blockId}function c(e,t){const r=e.currentUser.id;if(t.userId===r)return!0;{const e=Date.now();return Boolean(t.present&&t.activityTimestampNearestMinuteMs&&e-t.activityTimestampNearestMinuteMs<=d)}}function g(e,t){const r=a.subscriptionDataStoreInstance.state,{remotePresenceData:d,rootStore:u}=t.state;if(!u||!u.canEdit()||!r)return[];let c=[];d&&s.M6(d,(e=>{e&&e.userId&&c.push(e)}));const{pageId:g,lastViewTime:p,lastExitTime:h,...m}=e.state;s.M6(m,(e=>{e.isDefined()&&c.push({userId:e.getUserId(),activityTimestampNearestMinuteMs:(0,n.ud)(e.getVisitedAt()),present:!1})})),c=s.mN(c,(e=>e.userId));const f=(0,l.YO)(u).map((e=>{let{permissionItem:t}=e;return t})).filter(i.jg).map((e=>e.user_id)),v=(0,o.CM)(r).map((e=>e.userId)),S=s.G0(f,v);return c=c.filter((e=>!!S.includes(e.userId)&&!(!e.present&&!m[e.userId]))),c=s.MR(c,(e=>{let{activityTimestampNearestMinuteMs:t}=e;return t?-t:0})),c}}}]);