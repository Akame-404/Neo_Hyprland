"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[86993],{422711:(e,t,n)=>{n.d(t,{C:()=>r,DP:()=>d,LN:()=>a,Lm:()=>c,M:()=>u,Ow:()=>l});var i=n(757549),s=n(121039),o=n(454642);async function a(e,t){const n=await o.getConnectedAppsStatus(e,{spaceId:t});if("failed"===n.type){const e=n.error;return console.error(e),{drive:[],evernote:void 0,trello:void 0,asana:void 0,confluence:void 0}}return n.data}async function r(e,t){await o.disconnectTrello(e,{}),await t.refresh(),i.qJ(e,{integration_name:"trello"})}async function l(e,t){await o.disconnectAsana(e,{}),await t.refresh(),i.qJ(e,{integration_name:"asana"})}async function c(e,t){await o.disconnectEvernote(e,{}),await t.refresh(),i.qJ(e,{integration_name:"evernote"})}async function d(e,t,n){await o.disconnectConfluence(e,{spaceId:n}),await t.refresh(),i.qJ(e,{integration_name:"confluence"})}async function u(e,t,n,a){await o.disconnectJiraAccount(e,{spaceId:n,accountId:a}),await t.refresh();const r=s.Z.getInitialState();s.Z.setState(r),i.qJ(e,{integration_name:"jira"})}},383805:(e,t,n)=>{n.d(t,{B:()=>S,e:()=>y});var i=n(599405),s=n(709291),o=n(218265),a=n(757549),r=n(547307),l=n(95477),c=n(691924),d=n(753833),u=n(490365),g=n(167940),p=n(992083),m=n(454642),f=n(247839),h=n(792625),v=n(215356);const x=(0,s.defineMessages)({authenticatingWithEvernote:{id:"evernoteActions.authenticatingWithEvernote.loadingMessage",defaultMessage:"Authenticating with Evernote…"},titleMessage:{defaultMessage:"Evernote login",id:"evernoteActions.loginPopupModal.title"}});async function y(e){const{environment:t,requestStore:n}=e,s=(0,c.eC)(t);let y=(0,i.createEvernotePopupRedirect)(l.default.domainBaseUrl,{authType:s,userId:t.currentUser.id,isElectronDevice:t.device.isElectron});if(y=s.redirectToAuth?y:await(0,c.HU)(t,y),t.device.isElectron)return h.j({message:x.authenticatingWithEvernote}),d.Z.setState({...d.Z.state,linkingAccount:!0,showLoader:!0}),void f.openExternalUrl(y);const b=await v.M(t,{width:580,height:700,url:y,titleMessage:x.titleMessage});if(!b)return;const j=o.Qc(b),M=j.query.oauth_token,I=j.query.oauth_verifier;if(!M||!I)return;h.j({message:x.authenticatingWithEvernote});const Z=await m.authWithEvernote(t,{requestToken:M,verifier:I}),w=g.Z.getOrCreateFlowId();if("failed"===Z.type)return a.a1(t,{import_source:"evernote",data:{import_type:"api",status:"failure",error:Z.error,userId:t.currentUser.id},flowId:w}),console.error(Z.error),r.showError(Z),void h.x();a.a1(t,{import_source:"evernote",data:{import_type:"api",status:"success",userId:t.currentUser.id},flowId:w}),a.L3(t,{integration_name:"evernote"}),await n.refresh(),u.Z.setState({open:!0}),p.Z.setState({...p.Z.state,open:!0,currentTab:"imports",highlightedSetting:void 0,defaultSubtab:void 0}),await S({environment:t,requestStore:n}),h.x()}async function S(e){const{environment:t,requestStore:n}=e;try{d.Z.setState({...d.Z.state,isFetchingNotebooks:!0,showLoader:!0});const e=await m.getEvernoteNotebooks(t,{});if(await n.refresh(),"success"===e.type){d.Z.setState({...d.Z.state,notebooksResponse:e.data,isFetchingNotebooks:!1,showLoader:!1});const{userInfo:t,notebooks:n}=e.data;return{userInfo:t,notebooks:n}}return console.error(e.error),{notebooks:[],userInfo:void 0}}catch(i){return console.error(i),{notebooks:[],userInfo:void 0}}}},752192:(e,t,n)=>{n.d(t,{M:()=>x,u:()=>y});var i=n(599405),s=n(709291),o=n(218265),a=n(757549),r=n(547307),l=n(95477),c=n(691924),d=n(682066),u=n(992083),g=n(981676),p=n(454642),m=n(247839),f=n(792625),h=n(215356);const v=(0,s.defineMessages)({authenticatingWithTrello:{id:"trelloActions.authenticatingWithTrello.loadingMessage",defaultMessage:"Authenticating with Trello…"},titleMessage:{defaultMessage:"Trello login",id:"trelloActions.loginPopupModal.title"}});async function x(e){const{environment:t,requestStore:n}=e,s=(0,c.eC)(t);let g=(0,i.createTrelloPopupRedirect)(l.default.domainBaseUrl,{authType:s,userId:t.currentUser.id,isElectronDevice:t.device.isElectron});if(g=s.redirectToAuth?g:await(0,c.HU)(t,g),t.device.isElectron)return void m.openExternalUrl(g);const x=await h.M(t,{width:580,height:700,url:g,titleMessage:v.titleMessage});if(!x)return;const S=o.Qc(x),b=S.query.oauth_token,j=S.query.oauth_verifier;if(!b||!j)return;f.j({message:v.authenticatingWithTrello});const M=await p.authWithTrello(t,{requestToken:b,verifier:j});"failed"===M.type?(console.error(M.error),r.showError(M),f.x()):(a.L3(t,{integration_name:"trello"}),await n.refresh(),d.Z.setState({open:!0}),u.Z.setState({...u.Z.state,open:!0,currentTab:"imports",highlightedSetting:void 0,defaultSubtab:void 0}),await y(t,n),f.x())}async function y(e,t){g.Z.setState({...g.Z.state,isFetchingBoards:!0,showLoader:!0});const n=await p.getTrelloBoards(e,{});return await t.refresh(),"success"===n.type?(g.Z.setState({...g.Z.state,boardsResponse:n.data,isFetchingBoards:!1,showLoader:!1}),n.data):(console.error(n.error),{boards:[]})}},287446:(e,t,n)=>{n.d(t,{cP:()=>Ke,ZP:()=>Le,a_:()=>Be});n(757658);var i=n(667294),s=n(313991),o=n(800480),a=n(886628),r=n(724405),l=n(407057),c=n(977657),d=n(180920),u=n(654497),g=n(474181),p=n(177420),m=n(509844),f=n(35794),h=n(401898);const v=(0,h.AO)((e=>(0,h.$K)(e)&&"active"!==e.status?{false:e}:{true:e}));var x=n(590965),y=n(994826),S=n(307928),b=n(709291),j=n(531701),M=n(137810),I=(n(95477),n(548779)),Z=n(825464),w=n(80444),C=n(319385),k=n(206258),P=n(820454),A=n(715070),T=n(158573),F=n(519889),N=n(757549),D=n(76463),B=n(412714),L=n(164964),K=n(210228),V=n(460709),_=n(918514),U=n(61766),W=n(474021),R=n(224736),E=n(186517),O=n(605851),q=n(828992),z=n(785893);function $(e){const{capabilities:t}=e,n=(0,b.useIntl)(),{device:i}=(0,o.O7)(),s=(0,E.uH)(t),a=(0,E.Rh)(t),r=(0,E.WM)(e.capabilities),l=[...(0,O.zq)(s),...(0,O.ac)(a),...(0,O.VR)(r)];return(0,z.jsx)(q.Z,{...e,title:n.formatMessage((0,E.Gx)(s,void 0).label),shouldWrapCaption:!0,style:i.isMobile?{padding:"12px 4px"}:{padding:4,marginTop:2,marginBottom:2},captionStyle:{marginTop:4},caption:(0,z.jsx)("div",{children:l})})}var G=n(552275),H=n(231945),J=n(268894),Y=n(568785),Q=n(478140),X=n(632163),ee=n(550506),te=n(863296),ne=n(953437),ie=n(672495),se=n(164369),oe=n(729302);function ae(e){const{integrationId:t,integrationTable:n,isLegacy:s,disableDisconnectUser:r,disableDisconnectAll:l,disableDisallow:d,botIds:u}=e,f=(0,a.VK)((()=>w.default.state.currentSpaceStore),[]),v=(0,o.Fy)(),y=(0,o.O7)(),S=(0,b.useIntl)(),j=je(),[M,I]=(0,i.useState)(void 0),[Z,C]=(0,i.useState)(!1),[A,N]=(0,i.useState)(!1),[D,B]=(0,i.useState)(!1),[L,U]=(0,i.useState)(void 0),W=(0,a.VK)((()=>f&&n?(0,k.Kv)(f,{table:n,id:t}):void 0),[f,t,n]),E=(0,a.VK)((()=>{if(s){const e=g.ns.find((e=>e.id===t));return{name:null==e?void 0:e.name,url:(0,_.UY)("guides.connectedApps")}}if(f&&n){const s=f.getRecordModel({table:n,id:t});if(n===m.K2&&!(0,c.BP)({integrationId:t,env:"production"})){var e,i;const t=s;return{name:null==s?void 0:s.name,url:null==t||null===(e=t.getInfo())||void 0===e?void 0:e.website_url,email:null==t||null===(i=t.getInfo())||void 0===i?void 0:i.email}}return{name:null==s?void 0:s.name}}}),[f,t,n,s]),O=(0,a.VK)((()=>u&&!r?u.map((e=>f&&W?k.t1.createChildStore(W,{table:p.cZ,id:e,spaceId:f.id}):void 0)):[]),[f,u,W,r]).filter(h.$K),q=(0,a.VK)((()=>O.filter((e=>e.getAlive()))),[O]),$=(0,a.VK)((()=>{if(f&&q&&!r){return q.map((e=>e.getCreatedById())).filter(h.$K).map((e=>P.U.createChildStore(f,{table:F.KJ,id:e}))).filter((e=>e.isDefined()))}return[]}),[q,f,r]),G=(0,a.VK)((()=>null==f?void 0:f.getBotSettingsStore().getValue()),[f]),Y=(0,a.VK)((()=>null==q?void 0:q.reduce(((e,t)=>{const n=$.find((e=>e.id===t.getCreatedById()));return e[t.id]={userStore:n,botCapabilities:t.getCapabilities()},e}),{})),[q,$]),te=(0,a.VK)((()=>M?(0,T.ZP)(M,Object.entries(Y),(e=>{let[,{userStore:t}]=e;return t.getSearchName(S)})):Object.entries(Y)),[Y,M,S]),ne=!r&&(null==u?void 0:u.length)&&(0,z.jsx)(ie.Z,{isInput:!0,style:{padding:8},children:(0,z.jsx)(J.ZP,{textWrapperStyle:{margin:0},focus:!v.isMobile||void 0,focusAfterAnimation:!0,value:M||"",onChange:e=>I(e.target.value),placeholder:S.formatMessage({id:"integrationInstallerFilter.userSearch.placeholder",defaultMessage:"Filter by user"})})}),se=te.length?[{key:"disconnect user section",render:e=>(0,z.jsx)(ie.Z,{...e}),items:le({users:te,disableDisconnectUser:r,showDisplayModal:()=>N(!0),setSelectedUser:U,intl:S})}]:[],oe=(null==E?void 0:E.url)||(null==E?void 0:E.email),ae=Boolean(null==u?void 0:u.length)||(0,x.CJ)(G)&&!d,ce=(0,z.jsxs)(z.Fragment,{children:[oe&&(0,z.jsxs)(ie.Z,{topBorder:Boolean(te.length),children:[(null==E?void 0:E.url)&&(0,z.jsx)(de,{environment:y,developerWebsite:E.url}),(null==E?void 0:E.email)&&(0,z.jsx)(ue,{environment:y,developerEmail:E.email})]},"app-links"),ae&&(0,z.jsxs)(ie.Z,{topBorder:Boolean(te.length||oe),children:[Boolean(null==u?void 0:u.length)&&(0,z.jsx)(ge,{showDisplayModal:()=>B(!0)}),(0,x.CJ)(G)&&!d&&(0,z.jsx)(pe,{showDisplayModal:()=>C(!0)})]})]});return(oe||ae)&&E?(0,z.jsx)(H.ZP,{popupType:v.isMobile?H.Z4.SlideUp:H.Z4.Popup,renderOrigin:e=>(0,z.jsx)(R.Z,{...e,isMobile:v.isMobile,style:{marginLeft:8,marginRight:8}}),render:()=>(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Q.Z,{menuType:v.isMobile?V.og.ActionSheet:V.og.Popup,header:!r&&ne,footer:ce,width:230,children:(0,z.jsx)(X.Z,{type:X.i.Vertical,sections:se,initialFocus:void 0})}),(0,z.jsx)(ee.Z,{open:!r&&A,onDismiss:()=>{N(!1)},disableAnimation:!0,showCloseIcon:!0,innerStyle:j.innerModal,render:()=>(0,z.jsx)(me,{title:(0,z.jsx)(ye,{integrationName:E.name}),caption:(0,z.jsx)(Se,{integrationName:E.name,userName:null==L?void 0:L.userName}),type:"disconnect",handleCancel:()=>{N(!1),U(void 0)},handleConfirmation:async()=>{L&&(await re({botIds:[L.botId],environment:y}),U(void 0)),N(!1)}})}),(0,z.jsx)(ee.Z,{open:!l&&D,onDismiss:()=>{B(!1)},disableAnimation:!0,showCloseIcon:!0,innerStyle:j.innerModal,render:()=>(0,z.jsx)(me,{title:(0,z.jsx)(ve,{integrationName:E.name}),caption:(0,z.jsx)(xe,{integrationName:E.name}),type:"disconnect",handleCancel:()=>B(!1),handleConfirmation:async()=>{await re({botIds:u,environment:y}),B(!1)}})}),(0,z.jsx)(ee.Z,{open:!d&&Z,onDismiss:()=>{C(!1)},disableAnimation:!0,showCloseIcon:!0,innerStyle:j.innerModal,render:()=>(0,z.jsx)(me,{title:(0,z.jsx)(fe,{integrationName:E.name}),caption:(0,z.jsx)(he,{integrationName:E.name,disableDisconnectAll:l}),type:"disapprove",handleCancel:()=>C(!1),handleConfirmation:async()=>{!function(e){const{currentSpaceStore:t,environment:n,integrationId:i}=e;t&&K.createAndCommit({userAction:"AdminIntegrationSettingsActionMenu.handleDisapproveIntegration",environment:n,perform:e=>{K.applyOperation({store:t,operation:{pointer:t.pointer,path:["bot_settings","integration_approval_statuses"],command:"update",args:{[i]:null}},transaction:e})}})}({currentSpaceStore:f,environment:y,integrationId:t}),l||await re({botIds:u,environment:y}),C(!1)}})})]})}):null}async function re(e){let{botIds:t,environment:n}=e;t&&await Promise.all(t.map((e=>D.P0({environment:n,botId:e,onSuccess:()=>{N.IN(n,{type:"public"})}}))))}function le(e){const{intl:t,disableDisconnectUser:n,users:i,showDisplayModal:s,setSelectedUser:o}=e;return n?[]:i.map((e=>{let[n,{userStore:i,botCapabilities:a}]=e;return{key:i.id,render:e=>(0,z.jsx)(ce,{buttonMenuProps:e,userStore:i,botCapabilities:a,selectAction:()=>{s(),o({botId:n,userName:i.getDisplayName(t)})}}),action:()=>{s(),o({botId:n,userName:i.getDisplayName(t)})}}}))}function ce(e){const{buttonMenuProps:t,userStore:n,botCapabilities:s,selectAction:a}=e,r=(0,o.Fy)(),[l,c]=(0,i.useState)(!1);return(0,z.jsx)(ne.ZP,{popupType:r.isMobile?H.Z4.SlideUp:H.Z4.Popup,placementToOrigin:H.pO.Right,open:l,onDismiss:()=>c(!1),origin:(0,z.jsx)(G.Z,{...t,title:(0,z.jsx)("div",{style:{display:"flex",alignContent:"center",justifyContent:"space-between"},children:(0,z.jsx)(oe.Z,{userStore:n,avatarSize:18,inline:!0,avatarShouldShowShadow:!0,style:{flexShrink:1}})}),textWrapperStyle:{marginLeft:12,marginRight:12},focused:!1,onClick:()=>c(!0)}),render:()=>(0,z.jsx)(Q.Z,{width:240,menuType:r.isMobile?V.og.ActionSheet:V.og.Popup,header:(0,z.jsx)("div",{style:{padding:2,marginTop:4,marginBottom:4},children:(0,z.jsx)($,{capabilities:s})}),children:(0,z.jsx)(X.Z,{type:X.i.Vertical,sections:[{key:"integration capabilities",render:e=>(0,z.jsx)(ie.Z,{...e,topBorder:!0}),items:[{key:"remove",render:e=>(0,z.jsx)(G.Z,{...e,focused:!1,title:(0,z.jsx)("div",{style:{color:j.ZP.red},children:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.revokeUserAccess.label",defaultMessage:"Disconnect user"})})}),action:a}]}],initialFocus:void 0})})})}function de(e){let{environment:t,developerWebsite:n}=e;return(0,z.jsx)(G.Z,{onClick:()=>{B.D({environment:t,url:n}),N.fc(t,{href:n,from:"integration-settings"})},title:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.visitDeveloperWebsite.label",defaultMessage:"Visit developer website"}),shouldWrapCaption:!0,focused:!1,textWrapperStyle:{marginLeft:12,marginRight:12}})}function ue(e){let{environment:t,developerEmail:n}=e;return(0,z.jsx)(G.Z,{onClick:()=>{B.D({environment:t,url:`mailto:${n}`}),N.Z9(t,{from:"integration-settings"})},title:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.contactDeveloperSupport.label",defaultMessage:"Contact support"}),shouldWrapCaption:!0,focused:!1,textWrapperStyle:{marginLeft:12,marginRight:12}})}function ge(e){let{showDisplayModal:t}=e;return(0,z.jsx)(G.Z,{onClick:t,title:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectAll.label",defaultMessage:"Disconnect all users"}),shouldWrapCaption:!0,focused:!1,textWrapperStyle:{marginLeft:12,marginRight:12,color:j.ZP.red}})}function pe(e){let{showDisplayModal:t}=e;return(0,z.jsx)(G.Z,{onClick:t,title:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.label",defaultMessage:"Remove from approved list"}),focused:!1,textWrapperStyle:{marginLeft:12,marginRight:12,color:j.ZP.red}})}function me(e){let{title:t,caption:n,handleConfirmation:s,handleCancel:o,type:a}=e;const[r,l]=(0,i.useState)(!1);return(0,z.jsxs)("div",{style:{padding:20,width:333},children:[(0,z.jsx)(se.Z,{isMultiline:!0,style:{marginBottom:8,fontWeight:M.Z.fontWeight.semibold,paddingRight:30},children:t}),(0,z.jsx)(se.Z,{isMultiline:!0,isSecondaryColor:!0,style:{marginBottom:8},children:n}),(0,z.jsxs)("div",{style:{display:"flex",marginTop:12},children:[(0,z.jsx)(te.Z,{style:{width:140,marginRight:9},isLarge:!0,onClick:o,disabled:r,children:(0,z.jsx)(se.Z,{children:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.cancel",defaultMessage:"Cancel"})})}),(0,z.jsx)(te.Z,{style:{width:140},isLarge:!0,onClick:async()=>await s(l),backgroundColor:j.ZP.red,disabled:r,children:(0,z.jsxs)(se.Z,{style:{color:j.ZP.white},children:["disconnect"===a&&!0===r&&(0,z.jsx)(Y.Z,{isWhite:!0}),"disconnect"===a&&!1===r&&(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.disconnect",defaultMessage:"Disconnect"}),"disapprove"===a&&(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.remove",defaultMessage:"Remove"})]})})]})]})}function fe(e){let{integrationName:t}=e;return(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.title",defaultMessage:"Remove {integrationName} from approved integrations",values:{integrationName:t}})}function he(e){let{integrationName:t,disableDisconnectAll:n}=e;return n?(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.caption",defaultMessage:"Prevent members from installing {integrationName}.",values:{integrationName:t}}):(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApprovalAndDisconnectAll.caption",defaultMessage:"Revoke access for {integrationName} for all users in this workspace and prevent members from installing {integrationName}.",values:{integrationName:t}})}function ve(e){let{integrationName:t}=e;return(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectAll.modal.label",defaultMessage:"Disconnect {integrationName} for all users in workspace",values:{integrationName:t}})}function xe(e){let{integrationName:t}=e;return(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectAll.modal.caption",defaultMessage:"Revoke access for {integrationName} for all users in this workspace.",values:{integrationName:t}})}function ye(e){let{integrationName:t}=e;return(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectUser.modal.label",defaultMessage:"Disconnect {integrationName}?",values:{integrationName:t}})}function Se(e){let{integrationName:t,userName:n}=e;return(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectUser.modal.caption",defaultMessage:"Revoke access for {integrationName} for {userName}",values:{integrationName:t,userName:n}})}function be(e){const{adminIntegrationConfig:t,botId:n,maybeWebhookSubscriptionId:s}=e,r=(0,o.Fy)(),l=(0,o.O7)(),[c,d]=(0,i.useState)(!1),u=je(),g=(0,a.VK)((()=>w.default.state.currentSpaceStore),[]),m=(0,a.VK)((()=>{const e=null==g?void 0:g.getRecordModel({table:p.cZ,id:n});return null==e?void 0:e.getCapabilities()}),[g,n]),f=t.developer_name;if(!f)return null;const h=new U.Z,v={key:"manage",action:()=>{W.Z.setState({open:!0,integrationId:t.id,webhookSubscriptionId:s}),h.setState({open:!1})},render:e=>(0,z.jsx)(G.Z,{...e,title:(0,z.jsx)(b.FormattedMessage,{id:"complianceIntegrationSettings.actionMenu.manage",defaultMessage:"Manage"})})},x={key:"learn more",action:()=>{B.D({environment:l,url:t.integrationGalleryUrl})},render:e=>(0,z.jsx)(G.Z,{...e,title:(0,z.jsx)(b.FormattedMessage,{id:"complianceIntegrationSettings.actionMenu.learnMore",defaultMessage:"Learn more"})})},S={key:"disconnect",action:()=>{h.setState({open:!1}),d(!0)},render:e=>(0,z.jsx)(G.Z,{...e,title:(0,z.jsx)("span",{style:u.disconnect,children:(0,z.jsx)(b.FormattedMessage,{id:"complianceIntegrationSettings.actionMenu.disconnect",defaultMessage:"Disconnect"})})})},j=[...t.oauth||(0,A.ms)(m)||(0,y.Uw)(t.id)?[]:[v],...t.oauth||(0,A.ms)(m)?[x]:[],S];return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(H.ZP,{popupType:r.isMobile?H.Z4.SlideUp:H.Z4.Popup,renderOrigin:e=>(0,z.jsx)(R.Z,{...e,isMobile:r.isMobile,style:{marginLeft:8,marginRight:8}}),buttonPopupStore:h,render:()=>(0,z.jsx)(Q.Z,{menuType:r.isMobile?V.og.ActionSheet:V.og.Popup,width:230,children:(0,z.jsx)(X.Z,{type:X.i.Vertical,sections:[{key:"options",render:e=>(0,z.jsx)(ie.Z,{...e}),items:j}],initialFocus:void 0})})}),(0,z.jsx)(ee.Z,{open:c,onDismiss:()=>d(!1),disableAnimation:!0,showCloseIcon:!0,innerStyle:u.innerModal,render:()=>(0,z.jsx)(me,{title:(0,z.jsx)(b.FormattedMessage,{id:"complianceIntegrationSettings.disconnectModal.title",defaultMessage:"Disconnect {integrationName}?",values:{integrationName:f}}),caption:(0,z.jsx)(b.FormattedMessage,{id:"complianceIntegrationSettings.disconnectModal.subtitle",defaultMessage:"Revoke {integrationName}'s access to this workspace. Workspace events will no longer be sent to {integrationName}.",values:{integrationName:f}}),type:"disconnect",handleCancel:()=>d(!1),handleConfirmation:async()=>{await D.P0({environment:l,botId:n,onSuccess:()=>{}}),N.wi(l,{integration_id:t.id}),L.oV({label:(0,z.jsx)(b.FormattedMessage,{id:"complianceIntegrationSettings.snackbar.title",defaultMessage:"Disconnected {integrationName} from your workspace",values:{integrationName:f}})})}})})]})}function je(){return(0,r.yK)((()=>({disconnect:{color:j.ZP.red},innerModal:{borderRadius:10}})),[])}var Me=n(174136),Ie=n(731278),Ze=n(969219),we=n(526388),Ce=n(45653),ke=n(559054),Pe=n(307032),Ae=n(800893),Te=n(608055);function Fe(e){const{botId:t}=e,[,,n]=(0,a.AF)(void 0,U.Z),s=(0,o.Fy)(),r=(0,o.O7)(),l=(0,a.VK)((()=>w.default.state.currentSpaceStore),[]),[c,d]=(0,i.useState)(!1),u=(0,a.VK)((()=>l?k.t1.createChildStore(l,{table:p.cZ,id:t,spaceId:l.id}):void 0),[t,l]),g=(0,a.VK)((()=>(0,A.Mh)(null==u?void 0:u.getModel())),[u]),[{value:m}]=(0,ke.r5)((async()=>{if(u){return await D.VG({environment:r,botId:null==u?void 0:u.id})}}),[r,u]);if(!u)return null;let f;return f=s.isMobile?{menuType:V.og.ActionSheet}:{menuType:V.og.Popup},(0,z.jsx)(H.ZP,{popupType:s.isMobile?H.Z4.SlideUp:H.Z4.Popup,buttonPopupStore:n,renderOrigin:e=>(0,z.jsx)(R.Z,{isMobile:s.isMobile,...e,style:{marginLeft:8,marginRight:8}}),render:()=>(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Q.Z,{...f,children:(0,z.jsx)(X.Z,{type:X.i.Vertical,sections:[{key:"integration options",render:e=>(0,z.jsx)(ie.Z,{...e}),items:[...m?[Ne({environment:r,botToken:m})]:[],{key:"manage",action:()=>Te.c4({environment:r,url:`/my-integrations/internal/${Pe.cj(t)}`,openInNew:"tab"}),render:e=>(0,z.jsx)(G.Z,{title:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.manageIntegration.label",defaultMessage:"Manage in developer portal"}),...e})},{key:"delete",action:()=>d(!0),render:e=>(0,z.jsx)(G.Z,{title:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectIntegrationButton.label",defaultMessage:"Disconnect {integrationName}",values:{integrationName:g}}),style:{color:j.ZP.red},...e})}]}],initialFocus:void 0})}),(0,z.jsx)(ee.Z,{open:c,onDismiss:()=>{d(!1)},disableAnimation:!0,render:()=>(0,z.jsxs)("div",{style:{padding:20,width:333},children:[(0,z.jsx)(se.Z,{isMultiline:!0,style:{marginBottom:8,fontWeight:M.Z.fontWeight.semibold},children:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegration.modal.label.title",defaultMessage:"Disconnect {integrationName} in workspace",values:{integrationName:g}})}),(0,z.jsx)(se.Z,{isMultiline:!0,isSecondaryColor:!0,style:{marginBottom:8},children:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegration.modal.label.caption",defaultMessage:"Revoke access for {integrationName} in workspace",values:{integrationName:g}})}),(0,z.jsxs)("div",{style:{display:"flex",marginTop:12},children:[(0,z.jsx)(te.Z,{style:{width:140,marginRight:9},isLarge:!0,onClick:()=>d(!1),children:(0,z.jsx)(se.Z,{children:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.cancel",defaultMessage:"Cancel"})})}),(0,z.jsx)(te.Z,{style:{width:140},isLarge:!0,onClick:async()=>{d(!1),await D.P0({environment:r,botId:u.id,onSuccess:()=>{N.IN(r,{type:"internal"})}})},backgroundColor:j.ZP.red,children:(0,z.jsx)(se.Z,{style:{color:j.ZP.white},children:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectIntegration..modal.button.disconnect",defaultMessage:"Disconnect"})})})]})]})})]})})}function Ne(e){const{botToken:t,environment:n}=e;return{key:"copy bot token",action:()=>{Ae.RD({environment:n,stringValue:t,copiedMessage:Ae.tq.copiedLinkToClipboard}),N.IV(n,{from:"integration-settings",table:p.cZ})},render:e=>(0,z.jsx)(G.Z,{title:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.copyInternalIntegrationTokenButton.label",defaultMessage:"Copy internal integration token"}),...e})}}var De=n(940235);const Be={internal:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.internal",defaultMessage:"Internal"}),databaseSync:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.sync",defaultMessage:"Sync"}),linkPreview:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.preview",defaultMessage:"Link Preview"}),importer:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.importer",defaultMessage:"Importer"}),dlp:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.dlp",defaultMessage:"DLP"}),siem:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.siem",defaultMessage:"SIEM"}),ediscovery:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.ediscovery",defaultMessage:"eDiscovery"})};function Le(e){const{integrationIdToBotIds:t,internalIntegrationIds:n,integrationIdToUsers:i}=e,s=(0,a.VK)((()=>w.default.state.currentSpaceStore),[]),o=(0,r.Fg)(),l=(0,a.VK)((()=>null==s?void 0:s.getBotSettingsStore().getValue()),[s]),d=(0,a.VK)((()=>"approved_or_built_by_notion"===(null==l?void 0:l.integration_restrictions)),[l]),u=(0,a.VK)((()=>Boolean(null==l?void 0:l.integration_restrictions)),[l]),f=(0,a.VK)((()=>null!=l&&l.integration_approval_statuses?Object.keys(l.integration_approval_statuses):[]),[l]),h=f.filter((e=>!Object.keys(t).includes(e)&&!g.T2.includes(e))),v=h.some((e=>e===c.f3)),y=(0,a.VK)((()=>null==s?void 0:s.id),[s]),S=t?Object.entries(t).map((e=>{let[t,n]=e;return Ve({integrationPointer:{table:m.K2,id:t},userStores:i[t],botIds:n,autoApproveBuiltByNotion:d})})):[],j=y?n.map((e=>Ve({integrationPointer:{table:p.cZ,id:e,spaceId:y},userStores:i[e],botIds:[e]}))):[],M=u?h.map((e=>Ve({integrationPointer:{table:m.K2,id:e},userStores:[],botIds:[],autoApproveBuiltByNotion:d}))):[],I=g.ns.filter((e=>!(0,x.CJ)(l)||f.includes(e.id)&&(e.id!==g._o||!v))).map((e=>function(e){const{legacyIntegration:t}=e,{id:n,name:i,info:s}=t;return{key:n,columns:[(0,z.jsxs)("div",{style:{display:"flex",alignItems:"center",maxWidth:300},children:[(0,z.jsx)("img",{src:s.icon,style:{height:28}}),(0,z.jsxs)("div",{style:{minWidth:0,marginLeft:15},children:[(0,z.jsx)("div",{style:{display:"flex"},children:(0,z.jsx)(se.Z,{children:i})}),(0,z.jsx)(se.Z,{isSmall:!0,style:{display:"flex"},children:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.legacy",defaultMessage:"Notion Connected App"})})]})]},0),(0,z.jsx)(qe,{renderedUsers:void 0,displayUsers:!1},1),(0,z.jsx)("div",{children:(0,z.jsx)(ae,{integrationId:n,isLegacy:!0,disableDisconnectAll:!0,disableDisconnectUser:!0})},2)]}}({botSettings:l,legacyIntegration:e}))),Z=S.length+j.length+M.length+I.length;return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(De.Z,{columns:[{key:"integration",header:(0,z.jsx)(b.FormattedMessage,{id:"spaceConnectionsSettings.connectionsTable.connectionsColumn.title",defaultMessage:"Connection"}),style:{width:"40%"}},{key:"added_by",header:(0,z.jsx)(b.FormattedMessage,{id:"spaceConnectionsSettings.connectionsTable.creationInfoColumn.title",defaultMessage:"Users and access"})},{key:"more",header:void 0,style:{width:"5%"}}],rows:[...S,...j,...M,...I]}),0===Z?(0,z.jsx)("div",{style:{height:120,width:"100%",fontSize:12,color:o.lightTextColor,display:"flex",alignItems:"center",justifyContent:"center",borderBottom:`1px solid ${o.lightDividerColor}`},children:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.emptyTable.message",defaultMessage:"No integration installed"})}):void 0]})}function Ke(e){const{botIdToWebhookSubscriptionId:t,complianceIntegrationsIdToBotIds:n}=e,i=(0,r.yK)((e=>({emptyTable:{height:120,width:"100%",fontSize:12,color:e.lightTextColor,display:"flex",alignItems:"center",justifyContent:"center",borderBottom:`1px solid ${e.lightDividerColor}`}})),[]),s=(0,a.VK)((()=>w.default.state.currentSpaceStore),[]),o=(0,a.VK)((()=>{if(!s)return[];return Object.entries(n).flatMap((e=>{let[n,i]=e;return i.map((e=>{const i=k.Qx.createChildStore(s,{table:p.cZ,id:e,spaceId:s.id});return{integrationPointer:{table:m.K2,id:n},botId:e,lastEditedAt:Number(i.getLastEditedAt()),lastEditedByPointer:i.getLastEditedByPointer(),webhookSubscriptionId:t[e]}}))})).filter(h.$K)}),[t,s,n]).map((e=>function(e){const{integrationPointer:t,lastEditedAt:n,lastEditedByPointer:i,botId:s,webhookSubscriptionId:o}=e,a=t.id,r=(0,y.EY)(a);if(!r)return;const l=y.ZB[r];if(!l)return;return{key:`${a}:${s}`,columns:[(0,z.jsx)(_e,{integrationTable:m.K2,integrationId:a,maybeWebhookSubscriptionId:o},"integration-title"),(0,z.jsx)(Ee,{editedByPointer:i},"integration-edited-by"),(0,z.jsx)(Oe,{lastEditedOn:n},"integration-last-edited-on"),(0,z.jsx)(be,{adminIntegrationConfig:l,maybeWebhookSubscriptionId:o,botId:s},"integration-menu")]}}(e))).filter(h.$K);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(De.Z,{columns:[{key:"integration",header:(0,z.jsx)(b.FormattedMessage,{id:"spaceConnectionsSettings.complianceConnectionsTable.connectionsColumn.title",defaultMessage:"Connection"}),style:{width:"30%"}},{key:"integration-edited-by",header:(0,z.jsx)(b.FormattedMessage,{id:"spaceConnectionsSettings.complianceConnectionsTable.integrationEditorColumn.title",defaultMessage:"Edited by"}),style:{width:"30%"}},{key:"integration-edited-on",header:(0,z.jsx)(b.FormattedMessage,{id:"spaceConnectionsSettings.complianceConnectionsTable.integrationDateLastEdited.title",defaultMessage:"Edited on"})},{key:"more",header:void 0,style:{width:"5%"}}],rows:o,tableStyle:{borderTop:"none"}}),0===o.length?(0,z.jsx)("div",{style:i.emptyTable,children:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.emptyTable.message",defaultMessage:"No integration installed"})}):void 0]})}function Ve(e){const{integrationPointer:t,userStores:n,botIds:i,autoApproveBuiltByNotion:s}=e;if(t.table===m.K2){const e=t.id,o=(0,c.BP)({integrationId:e,env:"production"});return{key:e,columns:[(0,z.jsx)(_e,{integrationTable:m.K2,integrationId:e},"integration-title"),(0,z.jsx)(qe,{renderedUsers:n,displayUsers:!o},"integration-installer-info"),(0,z.jsx)(ae,{integrationId:e,integrationTable:m.K2,botIds:i,disableDisconnectUser:o||void 0,disableDisallow:o&&s},"admin-integration-settings-menu")]}}if(t.table===p.cZ)return{key:t.id,columns:[(0,z.jsx)(_e,{integrationTable:p.cZ,integrationId:t.id},"integration-title"),(0,z.jsx)(qe,{renderedUsers:n,displayUsers:!1},"integration-installer-info"),(0,z.jsx)(Fe,{botId:t.id},"integration-settings-menu")]};(0,h.t1)(t)}function _e(e){const{integrationId:t,integrationTable:n,maybeWebhookSubscriptionId:i}=e,s=(0,a.VK)((()=>w.default.state.currentSpaceStore),[]),o=(0,a.VK)((()=>{if(s)return s.getRecordModel({table:n,id:t})}),[s,t,n]),r=(0,a.VK)((()=>{var e;if(s&&i)return null===(e=s.getRecordModel({table:f.bf,id:i,spaceId:s.id}))||void 0===e?void 0:e.getHealth()}),[s,i]),l=(0,a.VK)((()=>C.default.checkGate({gateName:"inactive_webhook_subscription_ui"})),[]),[c,d,x,S]=(0,a.VK)((()=>{if(!o)return[];let e;const i=[];let s;if(n===p.cZ){const a=o;a.icon&&(e={pointer:{table:n,id:t},icon:a.icon}),i.push("internal"),s=(0,z.jsx)(Ue,{botId:a.id})}else if(n===m.K2){const a=o,r=a.getInfo();r.icon&&(e={pointer:{table:n,id:t},icon:r.icon}),(0,g.mo)(a)&&(i.push("linkPreview"),(0,g.zc)(a)&&i.push("databaseSync")),s=(0,y.z6)(a.id)?null:(0,z.jsx)(We,{integrationId:a.id})}else(0,h.t1)(n);return[null==o?void 0:o.name,e,i,s]}),[n,t,o]);if(!o||!x)return(0,z.jsx)(Y.Z,{});let M=null;return l&&!v(r)&&(M=(0,z.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:3},children:[(0,u.t)({width:12,color:j.FN.light.red[500]}),(0,z.jsx)(se.Z,{isSmall:!0,style:{color:j.FN.light.red[500]},children:(0,z.jsx)(b.FormattedMessage,{id:"workspaceIntegrationSettings.integrationTable.titleColumn.webhookError",defaultMessage:"Webhook error"})})]})),(0,z.jsxs)("div",{style:{display:"flex",alignItems:"center",maxWidth:300},children:[(0,z.jsx)(Ie.Z,{disabled:!0,icon:d,title:c,isEmptyPage:!1,size:28,isLarge:!0,useInvertedColors:!0}),(0,z.jsxs)("div",{style:{minWidth:0,marginLeft:15},children:[(0,z.jsxs)("div",{style:{display:"flex",marginRight:16},children:[(0,z.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,z.jsx)(se.Z,{children:c}),M]}),x.map((e=>e&&(0,z.jsx)(Me.Z,{desktopStyle:{marginLeft:4},children:Be[e]},e)))]}),S]})]})}function Ue(e){let{botId:t}=e;const n=(0,a.VK)((()=>w.default.state.currentSpaceStore),[]),i=(0,b.useIntl)(),s=(0,a.VK)((()=>null==n?void 0:n.getRecordModel({table:p.cZ,id:t})),[n,t]),o=(0,a.VK)((()=>{if(n&&s){const e=n.getRecordModel({table:s.created_by_table,id:s.created_by_id});return(0,S.Nz)(i,e)}}),[n,s,i]);return o?(0,z.jsx)(se.Z,{className:"notranslate",isSmall:!0,children:o}):(0,z.jsx)(Re,{})}function We(e){let{integrationId:t}=e;const n=(0,a.VK)((()=>w.default.state.currentSpaceStore),[]),i=(0,r.Fg)(),s=(0,a.VK)((()=>{const e=null==n?void 0:n.getRecordModel({table:m.K2,id:t});return null==e?void 0:e.getInfo().developer_name}),[n,t]);return(0,c.BP)({integrationId:t,env:"production"})?(0,z.jsx)(se.Z,{isSmall:!0,style:{display:"flex",alignItems:"center"},children:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.notion",defaultMessage:"Notion {icon}",values:{icon:(0,z.jsx)(we.Z,{renderTooltip:()=>(0,z.jsx)("div",{children:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfo.notion.tooltip",defaultMessage:"Developed by Notion"})}),placement:Z.u.Right,render:e=>(0,z.jsx)("div",{...e,children:(0,d.X)({width:12,height:12,fill:i.invoiceGreen})})})}})}):s?(0,z.jsx)(se.Z,{className:"notranslate",isSmall:!0,children:s}):(0,z.jsx)(Re,{})}function Re(){return(0,z.jsx)(se.Z,{isSmall:!0,children:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.label.unverifiedDeveloper",defaultMessage:"Unverified developer"})})}function Ee(e){const{editedByPointer:t}=e,n=(0,b.useIntl)(),i=(0,a.VK)((()=>{const e=w.default.state.currentSpaceStore;if(e)return e&&t?P.U.createChildStore(e,t):void 0}),[t]),s=(0,a.VK)((()=>null==i?void 0:i.getDisplayName(n)),[i,n]);return i&&s?(0,z.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"flex-start",gap:8,alignItems:"center",width:"100%"},children:[(0,z.jsx)(Ce.Z,{userStore:i,size:18}),(0,z.jsx)(se.Z,{children:s})]}):null}function Oe(e){const{lastEditedOn:t}=e;return void 0===t?null:(0,z.jsx)(Ze.iP,{useThinTitle:!0,title:(0,l.Yx)(t,"long",s.SP)})}function qe(e){const{renderedUsers:t,displayUsers:n}=e,s=(0,a.VK)((()=>w.default.state.currentSpaceStore),[]),r=(0,b.useIntl)(),l=(0,o.O7)(),c=(0,a.VK)((()=>{if(s)return(0,I.rn)(l,s)}),[l,s]),d=(0,i.useMemo)((()=>t&&t.length),[t]),u=(0,a.VK)((()=>t&&t.length>0?t[0]:void 0),[t]),g=(0,a.VK)((()=>u?u.getDisplayName(r):void 0),[u,r]);return n&&void 0!==d?u?(0,z.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,z.jsx)(Ce.Z,{userStore:u,avatarShouldShowShadow:!0,style:{marginRight:8},size:28}),(0,z.jsx)(se.Z,{children:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.listOfUsers",defaultMessage:"{remainingCount, plural, =0 {{firstUser}} one {{firstUser} +{remainingCount}} other {{firstUser} +{remainingCount}}}",values:{firstUser:g,remainingCount:d-1}})})]}):(0,z.jsx)(se.Z,{isSecondaryColor:!0,style:{display:"flex",alignItems:"center"},children:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.noUsers",defaultMessage:"No users"})}):(0,z.jsx)(se.Z,{style:{display:"flex",alignItems:"center"},children:(0,z.jsx)(b.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.anyone",defaultMessage:"Anyone in {spaceName}",values:{spaceName:(0,z.jsx)(se.Z,{style:{fontWeight:M.Z.fontWeight.medium},children:c})}})})}},873084:(e,t,n)=>{n.d(t,{Z:()=>Y});n(757658);var i=n(667294),s=n(800480),o=n(886628),a=n(724405),r=n(749085),l=n(435840),c=n(772141),d=n(421202),u=n(429369),g=n(709291),p=n(531701),m=n(165452),f=n(628020),h=n(798165),v=n(548779),x=n(223196),y=n(80444),S=n(206258),b=n(228517),j=n(552275),M=n(260458),I=n(731278),Z=n(776798),w=n(314694),C=n(785893);const k={display:"flex",alignItems:"center"};const P=function(e){const{nestingLevel:t,isChecked:n,onClick:i,store:s,isMobile:o}=e;return(0,C.jsx)(j.Z,{...e,title:(0,C.jsx)(w.Z,{childrenStyle:k,left:(0,C.jsx)(A,{isChecked:n,onClick:i}),icon:(0,C.jsx)(T,{store:s,isMobile:o}),style:{marginLeft:8*t},children:(0,C.jsx)(Z.Z,{store:s})})})};function A(e){let{isChecked:t,onClick:n}=e;return(0,C.jsx)(M.Z,{size:16,checked:t,onClick:n})}function T(e){let{store:t,isMobile:n}=e;const i=(0,a.Fg)(),s=(0,o.VK)((()=>t.getIcon()),[t]),r=(0,o.VK)((()=>t.isEmptyPage()),[t]);return(0,C.jsx)(I.Z,{disabled:!0,icon:s,title:void 0,isEmptyPage:r,size:n?24:20,pageIconStyle:{fill:i.mediumIconColor}})}var F=n(268894),N=n(568785),D=n(632163),B=n(953437),L=n(672495),K=n(559054),V=n(401898),_=n(296994),U=n(460709),W=n(277907),R=n(675822),E=n(478140),O=n(743765),q=n(511470),z=n(278948);function $(e){const{spaceId:t,onSelectPage:n,query:i,source:o,findSelectedBlockAncestorId:a}=e,r=(0,s.O7)();let l=null;const u=(0,W.XJ)(_.FF.searchActions),[{status:p,value:m}]=(0,K.r5)((async()=>{if("resolved"!==u.status)return;const e=u.value;return await e.searchPagesInSpace({environment:r,query:i,limit:10,requireEditPermissions:!0,spaceId:t,excludeTemplates:!0,source:o,boostRecentlyViewedPages:!1})}),[r,i,t,o,u.status,u.value],{debounce:R.vp});if("idle"===p||"pending"===p)l=(0,C.jsx)(L.Z,{children:(0,C.jsx)(z.Z,{})});else{const e=((null==m?void 0:m.results)||[]).map((e=>{let{id:t}=e;const i=new S.G(r,{table:d.iU,id:t});return function(e){const{store:t,environment:n,alreadySelectedAncestorId:i,onSelectPage:s}=e;if(i&&i===t.id)return{key:t.id,action:()=>{},render:e=>(0,C.jsx)(q.Z,{...e,store:t,hidePath:!0,disabled:!0,style:{opacity:.5},caption:(0,C.jsx)(g.FormattedMessage,{id:"oauthPageSearchResults.disabledResult.bySelf.message",defaultMessage:"Already added"})})};if(i){const e=new S.G(n,{table:d.iU,id:i});return{key:t.id,action:()=>{},render:n=>(0,C.jsx)(q.Z,{...n,store:t,hidePath:!0,disabled:!0,style:{opacity:.5},caption:(0,C.jsx)(g.FormattedMessage,{id:"oauthPageSearchResults.disabledResult.byAncestor.message",defaultMessage:"Already added via {ancestorPageName}",values:{ancestorPageName:(0,C.jsx)(Z.Z,{store:e,style:{display:"inline"}})}})})}}const o=t.getRole();return o&&c.zz(o)?{key:t.id,action:()=>s(t.id),render:e=>(0,C.jsx)(q.Z,{store:t,hidePath:!1,...e})}:void 0}({store:i,alreadySelectedAncestorId:a(i),environment:r,onSelectPage:n})})).filter(V.$K);l=0===e.length?(0,C.jsx)(L.Z,{children:(0,C.jsx)(O.Z,{title:(0,C.jsx)(g.FormattedMessage,{id:"oauthPageSearchResults.noResults.placeholder",defaultMessage:"No results"})})}):function(e){return(0,C.jsx)(D.Z,{type:D.i.Vertical,initialFocus:void 0,sections:[{key:"results",items:e,render:e=>(0,C.jsx)(L.Z,{...e})}]})}(e)}const f={menuType:U.og.Popup};return(0,C.jsx)(E.Z,{...f,children:l})}const G=r.default.createClass({},{name:"SelectedBlockIdsStore"}),H=r.default.createClass({open:!1,query:void 0},{name:"SearchStore"});function J(e){return e.isDefined()&&"copy_indicator"!==e.getType()}const Y=function(e){let{selectedBlockIdsStore:t}=e;const n=(0,g.useIntl)(),r=(0,a.Fg)(),c=(0,s.O7)(),j=(0,o.VK)((()=>{var e;return null===(e=y.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),M=c.currentUser.id;(0,i.useEffect)((()=>{j&&M&&(m.h({environment:c,spaceId:j,userId:M}),b.I({environment:c,spaceId:j,userId:M}))}),[c,j,M]);const I=(0,o.qz)(void 0,H),Z=(0,o.qz)(t,G),k=(0,i.useCallback)((()=>function(e){const t=e.state;e.setState({...t,open:!1,query:void 0})}(I)),[I]),P=(0,i.useCallback)((e=>function(e,t){const n=t.state[e.id];if(n)return e.id;const i=h.fJ(e),s=i.find((e=>e.table===d.iU&&Boolean(t.state[e.id])));if(s)return s.id}(e,Z)),[Z]),A=(0,o.VK)((()=>(0,f.k_)(c).state),[c]),{allSharedPagesStores:T=[],showWorkspaceSection:K=!1,showTeamSection:V=!1,showSharedSection:_=!1,showPrivateSection:U=!1,showOnlyPrivateSection:W=!1}=A??{},{currentSpaceViewStore:R,currentSpaceStore:E}=(0,o.VK)((()=>{const{currentSpaceViewStore:e,currentSpaceStore:t}=y.default.state;return{currentSpaceViewStore:e,currentSpaceStore:t}}),[]),O=(0,o.VK)((()=>Z.state),[Z]),q=(0,o.VK)((()=>{const e=(null==R?void 0:R.getTeamsStores())??[];return V?e.map((e=>[e,e.getTeamPagesStores().filter(J)])):[]}),[V,R]),z=(0,o.VK)((()=>(null==R?void 0:R.getWorkspacePages().filter(J))??[]),[R]),Y=(0,o.VK)((()=>(null==R?void 0:R.getPrivatePages(c).filter(J))??[]),[R,c]),X=Object.keys(O).filter((e=>O[e])).map((e=>new S.G(c,{table:d.iU,id:e}))),ne=(0,o.VK)((()=>X.filter((e=>e.getSpaceId()===(null==E?void 0:E.id)&&e.isNavigableBlock()&&!e.isTopLevelPrivatePage({spaceStore:E,environment:c})&&!e.isTopLevelWorkspacePage(E.id)&&!(e.getParentTable()===u.e0)&&!(null!=T&&T.some((t=>t.id===e.id)))))),[X,E,c,T]),se=(0,o.VK)((()=>E?(0,v.rn)(c,E):void 0),[E,c]),{open:oe,query:ae}=(0,o.VK)((()=>{const{open:e,query:t}=I.state;return{open:e,query:t}}),[I]),re=(0,o.VK)((()=>function(e){let{environment:t,theme:n,intl:i,subpages:s,selectedBlockIdsStore:o,showWorkspaceSection:a,workspacePages:r,showTeamSection:l,teamPagesByTeam:c,showSharedSection:d,allSharedPagesStores:u,showPrivateSection:p,showOnlyPrivateSection:m,spaceName:f,privatePages:h}=e;const v=[];s.length>0&&v.push({key:"manual",render:e=>(0,C.jsx)(L.Z,{...e,title:(0,C.jsx)(w.Z,{style:Q(),children:(0,C.jsx)(g.FormattedMessage,{id:"oauthAuthorizationPage.selectPagesStep.pagePicker.manuallyAddedPagesSection.title",defaultMessage:"Manually added"})}),isTitleUppercase:!0}),items:s.map((e=>te(e,0,t,o)))});a&&v.push(ie("workspace",i.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.workspaceSection.title",defaultMessage:"Workspace"}),r,t,n,o));if(l)for(const[g,x]of c){const e=g.id,i=g.getName();e&&void 0!==i&&v.push(ie(`team-${e}`,i,x,t,n,o))}d&&v.push(ie("shared",i.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.sharedSection.title",defaultMessage:"Shared"}),u,t,n,o));if(p){const e=m?f||"":i.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.privateSection.title",defaultMessage:"Private"});v.push(ie("private",e,h,t,n,o))}return v}({environment:c,theme:r,intl:n,subpages:ne,selectedBlockIdsStore:Z,showWorkspaceSection:K,workspacePages:z,showTeamSection:V,teamPagesByTeam:q,showSharedSection:_,allSharedPagesStores:T,showPrivateSection:U,showOnlyPrivateSection:W,spaceName:se,privatePages:Y})),[c,r,n,ne,Z,K,z,V,q,_,T,U,W,se,Y]);if(!A)return(0,C.jsx)(N.Z,{style:{alignSelf:"center"}});if(!R||!E)return null;const le={width:14,height:14,marginLeft:8,marginRight:8,flexGrow:0,flexShrink:0,fill:p.ZP.mediumIconColor};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(B.GI,{origin:(0,C.jsx)(F.ZP,{style:{marginBottom:8},itemMarginLeft:0,itemMarginRight:0,focus:!0,focusAfterAnimation:!0,value:ae||"",onChange:e=>{!function(e,t){const n=t.state,i=e.length>0;t.setState({...n,query:e,open:i})}(e.target.value,I)},placeholder:n.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.search.placeholder",defaultMessage:"Search for pages in {workspaceName}"},{workspaceName:se}),inputLeft:(0,l.R)(le)}),sameWidthAsOrigin:!0,popupType:x.k.Popup,open:oe,render:()=>(0,C.jsx)($,{spaceId:E.id,onSelectPage:e=>ee(e,!1,Z),query:ae||"",source:"oauth",findSelectedBlockAncestorId:P}),onDismiss:k}),(0,C.jsx)("div",{style:{alignItems:"left",width:"100%",height:380,borderWidth:1,borderStyle:"solid",borderColor:p.ZP.contentBorder,borderRadius:4,overflowY:"auto"},children:(0,C.jsx)(D.Z,{type:D.i.Vertical,sections:re,initialFocus:void 0})})]})};function Q(){return{textTransform:"uppercase",fontSize:12,fontWeight:600,color:p.ZP.mediumTextColor,padding:"2px 0"}}function X(e){return{key:"empty",action:()=>{},render:t=>(0,C.jsx)(j.Z,{...t,title:(0,C.jsx)(w.Z,{style:{fontSize:14,color:e.mediumTextColor,padding:"2px 32px"},children:(0,C.jsx)(g.FormattedMessage,{id:"oauthAuthorizationPage.selectPageStep.empty",defaultMessage:"No pages inside"})})})}}function ee(e,t,n){n.setState({...n.state,[e]:!t})}function te(e,t,n,i){const{device:s}=n,o=Boolean(i.state[e.id]);return{key:e.id,action:()=>ee(e.id,o,i),render:n=>(0,C.jsx)(P,{...n,isMobile:s.isMobile,store:e,isChecked:o,disabled:!1,nestingLevel:t})}}function ne(e,t,n){const i=t.length>0&&t.every((e=>n.state[e.id]));return{key:e,action:()=>function(e,t){const n=e.every((e=>t.state[e.id]));t.setState({...t.state,...e.reduce(((e,t)=>(e[t.id]=!n,e)),{})})}(t,n),render:t=>(0,C.jsx)(j.Z,{...t,title:(0,C.jsx)(w.Z,{left:(0,C.jsx)(M.Z,{onClick:t.onClick,checked:i,size:16}),style:Q(),children:e})})}}function ie(e,t,n,i,s,o){const a=n.filter((e=>c.zz(e.getRole()||"none")));return{key:e,render:e=>(0,C.jsx)(L.Z,{...e}),items:[ne(t,a,o),...0===a.length?[X(s)]:a.map((e=>te(e,1,i,o)))]}}},994512:(e,t,n)=>{n.d(t,{Z:()=>j});var i=n(667294),s=n(800480),o=n(724405),a=n(16184),r=n(709291),l=n(401898),c=n(137810),d=n(757549),u=n(287446),g=n(164921),p=n(174136),m=n(489728),f=n(731278),h=n(723189),v=n(785893);const x=2,y=1,S=3,b=36;function j(e){const{apps:t,numberOfConnectedApps:n,title:o,subtitle:a,numberOfDisplayRows:c}=e,u=(0,s.O7)(),[g,p]=(0,i.useState)(!1),f=(c||y)*S,b=t.filter((e=>!e.shouldHideInDiscover)),j=b.length>f&&!g,I=g?b:b.slice(0,f);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(h.Z,{large:!0,divider:"none",children:[o,a]}),(0,v.jsx)("div",{style:{display:"grid",gridTemplateColumns:`repeat(${S}, 1fr)`,gap:16},children:I.map((e=>{var t;return e.onConnect&&(0,v.jsx)(M,{appName:e.appName,caption:e.caption,shouldShowNewBadge:e.shouldShowNewBadge,shouldShowUpsell:e.shouldShowUpsell,logo:e.logo,integrationTypes:null===(t=e.integrationTypes)||void 0===t?void 0:t.slice(0,x),onConnect:e.onConnect},e.id)})).filter((e=>(0,l.$K)(e)))}),j&&(0,v.jsx)(m.Z,{style:{marginTop:10,gap:10,marginLeft:-8},isGray:!0,onClick:()=>{g||(p(!0),d.EU(u,{numberOfConnectedApps:n}))},children:(0,v.jsx)(r.FormattedMessage,{id:"connectedAppsSettings.discoverNewAppSection.seeAll.label",defaultMessage:"See all"})})]})}function M(e){const{appName:t,caption:n,logo:i,shouldShowUpsell:s,integrationTypes:l,onConnect:d}=e,h=(0,o.yK)((e=>({card:{display:"flex",flexDirection:"column",justifyContent:"space-between",borderRadius:8,border:`1px solid ${e.tableDividerColor}`,padding:12,height:"100%",overflow:"hidden",minWidth:120,gap:12},upsellCard:{backgroundColor:e.whiteButtonBackground},connectedAppIcon:{width:b,height:b,padding:4,borderRadius:6},titleAndPillContainer:{display:"flex",flexDirection:"row",justifyContent:"center",gap:4},titleAndNewBadgeContainer:{alignItems:"center",display:"flex",marginLeft:2},title:{fontWeight:c.Z.fontWeight.medium,fontSize:14,lineHeight:1.3,marginBottom:4},caption:{marginLeft:2,marginRight:2,fontWeight:c.Z.fontWeight.regular,color:e.mediumTextColor,fontSize:12,maxHeight:72,overflow:"hidden",lineHeight:1.3},pillContainer:{marginTop:8,marginBottom:6,fontSize:12,color:e.text.tertiary,display:"flex",gap:4,fontWeight:500},connectButton:{fontWeight:500,background:e.outlineBlueButtonHoveredBackground,textAlign:"center",justifyContent:"center"},connectButtonHoveredOrPressed:{background:e.outlineBlueButtonPressedBackground},lockedIcon:{color:e.mediumIconColor,width:16,height:16,marginLeft:6},logoTitleContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:8}})),[]),x=(0,v.jsxs)("div",{children:[(0,v.jsxs)("div",{style:h.logoTitleContainer,children:["string"==typeof i?(0,v.jsx)("img",{src:i,style:h.connectedAppIcon}):(0,v.jsx)(f.Z,{disabled:!0,icon:i,title:t,isEmptyPage:!1,size:b,isLarge:!0,useInvertedColors:!0,style:h.connectedAppIcon}),(0,v.jsxs)("div",{style:h.titleAndNewBadgeContainer,children:[(0,v.jsx)("div",{style:h.title,children:t}),s&&(0,a.Q)(h.lockedIcon)]})]}),(0,v.jsx)("div",{style:h.caption,children:n}),(0,v.jsx)("div",{style:h.pillContainer,children:null==l?void 0:l.map((e=>e&&(0,v.jsx)(p.Z,{children:u.a_[e]},e)))})]});return s?(0,v.jsx)("div",{style:{...h.card,...h.upsellCard},children:x}):(0,v.jsxs)(g.Z,{onClick:d,style:h.card,children:[x,(0,v.jsx)(m.Z,{isBlue:!0,style:h.connectButton,hoveredStyle:h.connectButtonHoveredOrPressed,pressedStyle:h.connectButtonHoveredOrPressed,onClick:d,children:(0,v.jsx)(r.FormattedMessage,{id:"connectedAppSettingsDiscoverItem.connectButton.label",defaultMessage:"Connect"})})]})}},770578:(e,t,n)=>{n.d(t,{Z:()=>p});n(667294);var i=n(800480),s=n(509999),o=n(584169),a=n(89101),r=n(709291),l=n(757549),c=n(918514),d=n(316354),u=n(489728),g=n(785893);function p(){const e=(0,i.O7)();return(0,g.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[(0,g.jsx)(d.Z,{style:{display:"flex",marginLeft:-6},className:"notion-print-ignore",href:`${a._j.integrations}/all`,external:!0,onClick:()=>{l.uy(e,{from:"integration-settings",href:`${a._j.integrations}/all`})},children:(0,g.jsx)(u.Z,{icon:s.J,isSmall:!0,isLightGray:!0,children:(0,g.jsx)(r.FormattedMessage,{id:"connectionsSettingsLinks.connectionsGallery",defaultMessage:"Browse connections in Gallery"})})}),(0,g.jsx)(d.Z,{style:{display:"flex",marginLeft:-6},className:"notion-print-ignore",href:a._j.myIntegrations,external:!0,onClick:()=>{l.YY(e,{from:"integration-settings",href:a._j.myIntegrations})},children:(0,g.jsx)(u.Z,{icon:s.J,isSmall:!0,isLightGray:!0,children:(0,g.jsx)(r.FormattedMessage,{id:"connectionsSettingsLinks.manageConnections",defaultMessage:"Develop or manage integrations"})})}),(0,g.jsx)(d.Z,{style:{display:"flex",marginLeft:-6},className:"notion-print-ignore",href:(0,c.UY)("guides.publicAPI"),external:!0,children:(0,g.jsx)(u.Z,{icon:o.m,isSmall:!0,isLightGray:!0,children:(0,g.jsx)(r.FormattedMessage,{id:"connectionsSettingsLinks.helpCenter",defaultMessage:"Learn more about connections"})})})]})}},586993:(e,t,n)=>{n.d(t,{Z:()=>Me,O:()=>je});n(757658);var i=n(667294),s=n(800480),o=n(886628),a=n(841892),r=n(715070),l=n(977657),c=n(474181),d=n(177420),u=n(815047),g=n(590965),p=n(994826),m=n(709291),f=n(653965),h=n(401898),v=n(757549),x=n(454642),y=n(599405),S=n(218265),b=n(547307),j=n(95477),M=n(691924);const I=new(n(61766).Z);var Z=n(792625),w=n(215356);const C=(0,m.defineMessages)({authenticatingWithAsana:{id:"asanaActions.authenticatingWithAsana.loadingMessage",defaultMessage:"Authenticating with Asana…"},titleMessage:{defaultMessage:"Asana login",id:"asanaActions.loginWithAsanaPopupModal.title"}});var k=n(76463),P=n(422711),A=n(191584),T=n(383805),F=n(389475),N=n(752192),D=n(61202),B=n(823586);var L=n(548779),K=n(434859),V=n(80444),_=n(788632),U=n(530874),W=n(206258),R=n(672087),E=n(288280),O=n(994512),q=n(770578),z=n(568785),$=n(953336),G=n(164369),H=n(427386),J=n(723189),Y=n(731278),Q=n(940235),X=n(749085),ee=n(531701),te=n(460709),ne=n(88893),ie=n(224736),se=n(873084),oe=n(552275),ae=n(231945),re=n(478140),le=n(632163),ce=n(863296),de=n(158297),ue=n(672495),ge=n(842782),pe=n(785893);function me(e){const{botId:t,canSelectPageAccess:n,onConnect:a,onDisconnect:r}=e,[l,c]=(0,i.useState)(!1),[u]=(0,i.useState)(X.default.createValue({})),g=(0,o.VK)((()=>V.default.state.currentSpaceStore),[]),p=(0,s.O7)(),f=(0,s.Fy)(),h=(0,o.VK)((()=>E.subscriptionDataStoreInstance.state),[]),v=(h?(0,ne.NM)(h):[]).find((e=>e.botId===t)),x=(0,i.useMemo)((()=>(null==v?void 0:v.pageIds.reduce(((e,t)=>(e[t]=!0,e)),{}))??{}),[null==v?void 0:v.pageIds]);(0,i.useEffect)((()=>{n&&g&&!l&&(u.setState(x),c(!0))}),[n,g,l,x,u]);const y=[];n&&g&&y.push({key:"actions for user guest connections",render:e=>(0,pe.jsx)(ue.Z,{...e}),items:[{key:"update selected pages",render:(e,n)=>(0,pe.jsx)(ge.Z,{...e,onFocus:n.onFocus,disableDefaultClick:!0,renderOrigin:e=>(0,pe.jsx)(oe.Z,{...e,title:(0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.actionMenu.selectPages.label",defaultMessage:"Access selected pages"})}),renderExtension:(e,n)=>{return(0,pe.jsxs)("div",{style:{width:400,padding:20},children:[(0,pe.jsx)(se.Z,{selectedBlockIdsStore:u}),(i={leftText:(0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.actionMenu.pagePicker.cancel",defaultMessage:"Cancel"}),leftAction:()=>{u.setState(x),n.close()},rightText:(0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.actionMenu.pagePicker.update",defaultMessage:"Update access"}),rightAction:()=>{!function(e){const{botId:t,currentSpaceStore:n,environment:i,selectedBlockIdsStore:s,currentAccessedPages:o}=e,a=[],r=[],l=s.state;Object.keys(l).forEach((e=>{o.hasOwnProperty(e)&&!l[e]?a.push(e):!o.hasOwnProperty(e)&&l[e]&&r.push(e)}));const c=W.t1.createChildStore(n,{table:d.cZ,id:t});k.jX({environment:i,currentSpaceStore:n,botStore:c,pages:a}),k.jX({environment:i,currentSpaceStore:n,botStore:c,pages:r,addPermission:!0})}({selectedBlockIdsStore:u,environment:p,currentSpaceStore:g,botId:t,currentAccessedPages:x}),n.close()}},(0,pe.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:24},children:[(0,pe.jsx)(ce.Z,{isLarge:!0,onClick:i.leftAction,style:{height:32},children:i.leftText}),(0,pe.jsx)(de.Z,{isLarge:!0,onClick:i.rightAction,children:i.rightText})]}))]});var i}}),action:()=>{}}]});const S=[];return a&&S.push({key:"connect account",render:e=>(0,pe.jsx)(oe.Z,{...e,title:(0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.actionMenu.connectAccount.label",defaultMessage:"Connect another account"}),onClick:a}),action:a}),S.push({key:"disconnect account",render:e=>(0,pe.jsx)(oe.Z,{...e,title:(0,pe.jsx)("div",{style:{color:ee.ZP.red},children:(0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.actionMenu.disconnectAccount.label",defaultMessage:"Disconnect account"})}),onClick:()=>{r()}}),action:()=>r()}),y.push({key:"actions for all user connections",render:e=>(0,pe.jsx)(ue.Z,{...e}),items:S}),(0,pe.jsx)(ae.ZP,{popupType:f.isMobile?ae.Z4.SlideUp:ae.Z4.Popup,renderOrigin:e=>(0,pe.jsx)(ie.Z,{...e,isMobile:f.isMobile}),render:()=>(0,pe.jsx)(re.Z,{menuType:f.isMobile?te.og.ActionSheet:te.og.Popup,children:(0,pe.jsx)(le.Z,{type:le.i.Vertical,sections:y,initialFocus:void 0})})})}const fe=28;function he(e){const{userConnections:t}=e;return(0,pe.jsx)(Q.Z,{columns:[{key:"connection",header:(0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.connectionsColumn.title",defaultMessage:"Connection"}),style:{width:"40%"}},{key:"access",header:(0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.title",defaultMessage:"Access"}),style:{width:"40%"}},{key:"more",header:void 0,style:{width:"5%"}}],rows:ve(t)})}function ve(e){const t=[];return e.forEach((e=>{const{account:n,onDisconnect:i}=e;if(Array.isArray(n)){const s=n.map((t=>xe({connection:{...e,onDisconnect:()=>{i(t)}},account:t})));t.push(...s)}else t.push(xe({connection:e,account:n}))})),t}function xe(e){const{account:t,connection:{id:n,appName:i,canSelectPageAccess:s,capabilities:o,logo:a,onConnect:r,onDisconnect:l}}=e,c=void 0!==t&&"string"!=typeof t,d=c?t.accountName:t,u=c?t.accountId:n;return{key:`${u}-${d}`,columns:[(0,pe.jsx)(ye,{accountName:d,connectionLogo:a,connectionName:i},"connection-title"),o,(0,pe.jsx)(me,{botId:u,canSelectPageAccess:s,connectionName:i,onConnect:r,onDisconnect:l},"connection-action-menu")]}}function ye(e){const{accountName:t,connectionLogo:n,connectionName:i}=e;return(0,pe.jsxs)("div",{style:{display:"flex",alignItems:"center",marginRight:12},children:["string"==typeof n?(0,pe.jsx)("img",{src:n,style:{height:fe}}):(0,pe.jsx)(Y.Z,{disabled:!0,icon:n,title:i,isEmptyPage:!1,size:fe,isLarge:!0,useInvertedColors:!0}),(0,pe.jsxs)("div",{style:{marginLeft:15},children:[(0,pe.jsx)(G.Z,{children:i}),t&&(0,pe.jsx)(G.Z,{isSmall:!0,children:t})]})]})}const Se={height:"100%",padding:"36px 60px"},be={alignItems:"center",display:"flex",flexDirection:"column",flex:1,height:"100%",justifyContent:"center"};function je(e){const t=[];return null!=e&&e.read_content&&t.push((0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.readContent",defaultMessage:"view"})),null!=e&&e.insert_content&&t.push((0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.insertContent",defaultMessage:"insert"})),null!=e&&e.update_content&&t.push((0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.updateContent",defaultMessage:"update"})),t}const Me=function(e){let{location:t}=e;const n=(0,s.O7)(),i=(0,o.qz)(void 0,R.Z);return(0,o.VK)((()=>_.Z.state.online),[])?(0,pe.jsx)(B.Z,{request:n,performRequest:()=>async function(e){const{currentSpaceStore:t}=V.default.state;return{guestBotIds:await Pe(e),connectionStatus:await P.LN(e,null==t?void 0:t.id)}}(n),requestStore:i,render:(e,n)=>null!=n&&n.connectionStatus?(0,pe.jsx)(Te,{location:t,requestStore:i,guestBotIds:n.guestBotIds}):(0,pe.jsx)("div",{style:be,children:(0,pe.jsx)(z.Z,{})})}):(0,pe.jsx)(Ze,{})};function Ie(e){const t=[(0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.previewLinks",defaultMessage:"preview links"},"previewLinks")];return function(e){return!!e.info.original_url_patterns&&e.info.original_url_patterns.some((e=>{var t;return null===(t=e.additional_types)||void 0===t?void 0:t.collection}))}(e)&&t.push((0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.syncDatabases",defaultMessage:"sync databases"},"syncedDatabase")),t}function Ze(){return(0,pe.jsx)(H.ZP,{children:(0,pe.jsx)(G.Z,{isSmall:!0,style:{textAlign:"center"},children:(0,pe.jsx)(m.FormattedMessage,{id:"connectedAppsSettings.offline.message",defaultMessage:"Please go online to manage connecting to apps."})})})}function we(e){return{display:"flex",flexDirection:"column",height:"100%",width:"sidebar-modal"===e?"100%":"auto"}}function Ce(e,t){const{currentSpaceStore:n}=V.default.state;if(!n||(0,L.Cx)(n))return[];return e.map((e=>{const i=W.t1.createChildStore(n,{table:d.cZ,id:e}),s=i.getName(),o=i.getIntegrationId();if(!i.getAlive()||!s||!o)return;const a=i.getIntegrationPointer(),r=i.getIcon(),l=r&&a?{pointer:a,icon:r}:void 0;return{id:i.id,appName:s,caption:void 0,account:void 0,logo:l,capabilities:(0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.userGuest",defaultMessage:"Can {capabilities} content",values:{capabilities:(0,pe.jsx)(m.FormattedList,{value:je(i.getCapabilities()),type:"conjunction"})}}),canSelectPageAccess:!0,onDisconnect:async()=>{await b.confirmUserAction({message:(0,pe.jsx)("span",{children:(0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.deleteExternalAuthorization.withoutAccountName.confirmationMessage",defaultMessage:"Are you sure you want to revoke access for this account?"})}),acceptLabel:(0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.deleteExternalAuthorization.confirmDelete.label",defaultMessage:"Yes"})})&&await k.P0({environment:t,botId:i.id,onSuccess:()=>{}})}}})).filter(h.$K)}function ke(e){const{currentSpaceStore:t}=V.default.state;if(!t||!t.canEdit())return[];const n=t.getBotSettingsStore().getValue(),i=t.id,{integrations:{state:s},bots:{state:o},externalAuthentications:{state:a}}=U.Z,u=t.canAdmin(),x=l.Gw,y={[l.nO]:1,[l.f3]:2,[l.mQ]:3,[l.U9]:4,[x]:5};s.sort(((e,t)=>(y[e.id]??1/0)-(y[t.id]??1/0)));const S=[l.U9];return s.map((s=>{if(!s.info.icon)return;if(!u&&S.includes(s.id))return;if((0,p.I$)(s.id))return;const h=o.filter((e=>e.integration_id===s.id)),x=f.oA(h.map((e=>{const t=a.find((t=>t.parent_id===e.id));if(t)return{accountId:e.id,accountName:t.account_name}}))),y=(0,g.hU)({spaceBotSettings:n,integrationId:s.id,env:"production"}),j=x.length>0;if(!y&&!j)return;if(!j&&s.id===l.Dv)return;const M=!y,I=(0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.external",defaultMessage:"Can {capabilities}",values:{capabilities:(0,pe.jsx)(m.FormattedList,{value:Ie(s),type:"conjunction"})}}),Z=(0,r.ms)(s.capabilities),w=s.capabilities.inherit_creator_permissions,C=Z&&!w,P=[];return(0,c.mo)(s)&&P.push("linkPreview"),(0,c.zc)(s)&&P.push("databaseSync"),{id:s.id,appName:s.name,caption:s.info.tagline,logo:s.info.icon,account:x,shouldHideConnectAccount:M,shouldShowNewBadge:!s.info.hide_new_badge,integrationTypes:P,capabilities:(0,pe.jsxs)(pe.Fragment,{children:[(0,pe.jsx)("div",{children:I}),Z?(0,pe.jsx)("div",{children:(0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.externalWithCapabilities",defaultMessage:"Can {capabilities} content",values:{capabilities:(0,pe.jsx)(m.FormattedList,{value:je(s.capabilities),type:"conjunction"})}})}):null]}),canSelectPageAccess:C,onConnect:async()=>{await F.hM({environment:e,integration:s,spaceId:i,from:"connected_apps_settings"}),D.pJ({environment:e})},onDisconnect:async n=>{const i=o.find((e=>e.id===(null==n?void 0:n.accountId)));if(i){const o=W.t1.createChildStore(t,{table:d.cZ,id:i.id,spaceId:i.space_id}),a=null!=n&&n.accountName?(0,pe.jsx)(m.FormattedMessage,{id:"connectedAppSettings.deleteExternalAuthorization.withAccountName.confirmationMessage",defaultMessage:"Are you sure you want to revoke access for {accountName}?",values:{accountName:n.accountName}}):(0,pe.jsx)(m.FormattedMessage,{id:"connectedAppSettings.deleteExternalAuthorization.withoutAccountName.confirmationMessage",defaultMessage:"Are you sure you want to revoke access for this account?"});await b.confirmUserAction({message:(0,pe.jsx)("span",{children:a}),acceptLabel:(0,pe.jsx)(m.FormattedMessage,{id:"connectedAppSettings.deleteExternalAuthorization.confirmDelete.label",defaultMessage:"Yes"})})&&(await k.P0({environment:e,botId:o.id,onSuccess:()=>{}}),v.lL(e,{integrationId:s.id}))}}}})).filter(h.$K)}async function Pe(e){const{currentSpaceStore:t,currentUserStore:n}=V.default.state;if(!t||!n||!E.subscriptionDataStoreInstance.state)return[];return(await k.Yw({environment:e,table:u.bx,id:t.id,type:"guest"})).botIds.filter((e=>W.t1.createChildStore(t,{table:d.cZ,id:e}).getCreatedById()===n.id))}function Ae(e,t,n){var i;const s=n;let o=!1;const{currentSpaceStore:r}=V.default.state,d=null===(i=s.state.result)||void 0===i?void 0:i.connectionStatus,u=(null==d?void 0:d.drive)&&(null==d?void 0:d.drive.length)>0,p=function(){const{integrations:{state:e}}=U.Z;return!e.some((e=>e.id===l.f3))}();if(p){const e=null==r?void 0:r.getBotSettingsStore().getValue();o=!(0,g.CJ)(e)||Boolean((null==e?void 0:e.integration_approval_statuses)&&e.integration_approval_statuses[c._o])}const f=(0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.legacyImporter",defaultMessage:"Can only add pages"});return[...p&&(o||u)?[{id:"drive",appName:"Google Drive",caption:t.formatMessage({id:"connectedAppsSettings.googleDrive.caption",defaultMessage:"Find and embed your files."}),shouldHideConnectAccount:!o,shouldHideInDiscover:!p,logo:a.Z.images.import.googleDrivePng,account:null==d?void 0:d.drive,capabilities:(0,pe.jsx)(m.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.googleDrive",defaultMessage:"Can embed content"}),canSelectPageAccess:!1,onConnect:()=>async function(e,t){v.SO(e,{integration_name:"google",from:"connected_apps"}),await A.qN(e),await P.LN(e),await t.refresh()}(e,n),onDisconnect:i=>{i&&function(e,t,n,i){b.showDialog({message:n.formatMessage({id:"connectedAppsSettings.disconnectGoogleDriveModal.message",defaultMessage:"Disconnecting disables file preview on Google Drive files embedded in all of your workspaces. It would not delete your embeds from Notion, so you can re-connect at anytime."}),showCancel:!0,keepFocus:!0,items:[{label:n.formatMessage({id:"connectedAppsSettings.disconnectGoogleDriveModal.disconnectButton.label",defaultMessage:"Disconnect"}),color:"red",onAccept:async()=>{await x.disconnectDrive(t,{googleUserId:e.accountId}),await P.LN(t),await i.refresh()}}]})}(i,e,t,n)}}]:[],{id:"evernote",appName:"Evernote",caption:t.formatMessage({id:"connectedAppsSettings.evernote.caption",defaultMessage:"Import notebooks."}),logo:a.Z.images.import.evernotePng,account:null==d?void 0:d.evernote,capabilities:f,canSelectPageAccess:!1,integrationTypes:["importer"],onConnect:()=>T.e({environment:e,requestStore:s}),onDisconnect:()=>P.Lm(e,s)},{id:"trello",appName:"Trello",caption:t.formatMessage({id:"connectedAppsSettings.trello.caption",defaultMessage:"Import your boards."}),logo:a.Z.images.import.trelloPng,shouldHideInDiscover:!0,account:null==d?void 0:d.trello,capabilities:f,integrationTypes:["importer"],canSelectPageAccess:!1,onConnect:()=>N.M({environment:e,requestStore:s}),onDisconnect:()=>P.C(e,s)},{id:"asana",appName:"Asana",caption:t.formatMessage({id:"connectedAppsSettings.asana.caption",defaultMessage:"Import tasks from boards and lists."}),logo:a.Z.images.import.asanaPng,shouldHideInDiscover:!0,integrationTypes:["importer"],account:null==d?void 0:d.asana,capabilities:f,canSelectPageAccess:!1,onConnect:()=>async function(e){const{environment:t,requestStore:n}=e,i=(0,M.eC)(t);let s=(0,y.createAsanaPopupRedirect)(j.default.domainBaseUrl,{authType:i,userId:t.currentUser.id});s=i.redirectToAuth?s:await(0,M.HU)(t,s);const o=await w.M(t,{width:580,height:800,url:s,titleMessage:C.titleMessage});if(!o)return;const a=S.Qc(o);if(!a.query.code||!a.query.state)return;Z.j({message:C.authenticatingWithAsana});const r=await x.authWithAsana(t,{code:a.query.code,encryptedState:a.query.state});"failed"===r.type?(console.error(r.error),b.showError(r),Z.x()):(v.L3(t,{integration_name:"asana"}),await n.refresh(),I.setState({open:!0}),Z.x())}({environment:e,requestStore:s}),onDisconnect:()=>P.Ow(e,s)},...null!=r&&r.id?[{id:"confluence",appName:"Confluence",caption:t.formatMessage({id:"connectedAppsSettings.confluence.caption",defaultMessage:"Import Spaces from Confluence."}),logo:a.Z.images.import.confluencePng,shouldHideInDiscover:!0,account:null==d?void 0:d.confluence,capabilities:f,integrationTypes:["importer"],canSelectPageAccess:!1,onDisconnect:()=>P.DP(e,s,r.id)}]:[]]}function Te(e){let{guestBotIds:t,location:n,requestStore:i}=e;const a=(0,s.O7)(),r=(0,m.useIntl)(),{connected:l,discover:c}=(0,o.VK)((()=>function(e,t,n,i){const s=f.vM([...ke(t),...Ae(t,n,i)],(e=>e.account&&e.account.length>0?"connected":"discover"));return{connected:[...Ce(e,t),...s.connected||[]],discover:s.discover||[]}}(t,a,r,i)),[t,a,r,i]),d=l.length>0;return(0,pe.jsx)("div",{style:we(n),children:(0,pe.jsxs)($.Z,{style:Se,type:K.Z.Y,children:[d&&(0,pe.jsxs)(pe.Fragment,{children:[(0,pe.jsx)(J.Z,{large:!0,divider:"full",style:{borderBottom:"none",marginBottom:0},children:(0,pe.jsx)(m.FormattedMessage,{id:"connectionsSettings.connectionsSection.title",defaultMessage:"My connections"})}),(0,pe.jsx)(he,{userConnections:l})]}),(0,pe.jsx)("div",{style:{marginTop:d?32:void 0},children:(0,pe.jsx)(O.Z,{apps:c,numberOfConnectedApps:l.length,title:(0,pe.jsx)("div",{style:{display:"flex",justifyContent:"space-between",height:28,fontSize:16,fontWeight:510},children:(0,pe.jsx)(m.FormattedMessage,{id:"connectionsSettings.discoverNewConnectionsSection.title",defaultMessage:"Discover new connections"})})})}),(0,pe.jsx)("div",{style:{marginTop:20},children:(0,pe.jsx)(q.Z,{})})]})})}},474021:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(749085);class s extends i.default{getInitialState(){return{open:!1}}}const o=new s},753833:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(749085);class s extends i.default{getInitialState(){return{notebooksResponse:{notebooks:[]},isFetchingNotebooks:!0,showLoader:!1,linkingAccount:!1}}}const o=new s},490365:(e,t,n)=>{n.d(t,{Z:()=>i});const i=new(n(61766).Z)},682066:(e,t,n)=>{n.d(t,{Z:()=>i});const i=new(n(61766).Z)},981676:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(749085);class s extends i.default{getInitialState(){return{boardsResponse:{boards:[]},isFetchingBoards:!0,showLoader:!1}}}const o=new s}}]);