"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[3928],{145443:(e,t,r)=>{r.d(t,{Zo:()=>z,Dl:()=>ee,IW:()=>J,bi:()=>X});r(21703),r(757658);var n=r(667294),o=r(800480),a=r(886628),i=r(158573),s=r(559054),l=r(775e3),c=r(421202),u=r(606287),d=r(492338),h=r(76233),f=r(709291),p=r(653965),g=r(940470),m=r(401898),v=r(137231),S=r(210228),C=r(693405),y=r(568785),T=r(672495),_=r(628020),I=r(394841),E=r(675822),b=r(525286),x=r(596820),M=r(278159),P=r(80444),k=r(788632),R=r(269327),w=r(206258),O=r(724405),A=r(815047),L=r(429369),B=r(137810),U=r(552275),V=r(731278),N=r(186176),q=r(776798),j=r(548779),F=r(785893);const H=n.forwardRef((function(e,t){const{store:r,caption:n,hoverIcon:o}=e,i=(0,O.yK)((e=>({rightIcon:{width:16,height:14,fill:e.lightIconColor}})),[]),s=(0,a.VK)((()=>n?(0,F.jsx)(Z,{caption:n}):!(r instanceof w.zX)&&(0,N.Lk)(r)&&(0,F.jsx)(N.ZP,{store:r,showFullPathInTooltip:!0})),[n,r]);return(0,F.jsx)(U.Z,{...e,right:e.focused&&o?o(i.rightIcon):null,ref:t,title:(0,F.jsx)(q.Z,{store:r,maxLength:21}),icon:(0,F.jsx)(K,{store:r}),caption:s,className:"notranslate"})}));function K(e){let{store:t}=e;const r=(0,o.O7)(),n=(0,a.VK)((()=>t instanceof w.H2?(0,j.Wd)(r,t):t.getIcon()),[r,t]),i=(0,a.VK)((()=>t instanceof w.G&&t.isEmptyPage()),[t]),s=(0,a.VK)((()=>function(e,t){switch(e.table){case A.bx:return(0,j.rn)(t,e);case L.e0:return e.getName();default:return}}(t,r)),[r,t]);return(0,F.jsx)(V.Z,{disabled:!0,icon:n,isEmptyPage:i,title:s,size:r.device.isMobile?24:20})}function Z(e){const{caption:t}=e,r=(0,O.Fg)();return(0,F.jsx)("div",{style:{display:"flex",fontSize:B.Z.fontSize.UISmall.desktop,color:r.lightTextColor,overflow:"hidden"},children:t})}const G=(0,f.defineMessages)({openedPageLabel:{id:"action.openedPage.label",defaultMessage:"Opened page"},noItemsAvailable:{id:"assistantTypeAheadHelpers.noItemsAvailable",defaultMessage:"No items available"}});function D(e,t,r){const n=(0,s.r5)((async()=>{if(0===e.length)return{type:"empty",query:e};const r=await t(e);return{type:"results",query:e,value:r}}),[e,t],{debounce:r}),[o]=n;if("idle"===o.status)return{type:"empty",query:e,loading:!1};if("rejected"===o.status)return{type:"error",query:e,loading:!1};const a=o.value??{type:"empty",query:e};return"pending"===o.status?{...a,loading:!0}:{...a,loading:!1}}function W(e,t){if("error"===e.type&&"error"===t.type)return{serverResults:[],localResults:[]};const r="empty"===t.type||"error"===t.type?[]:t.value;if("empty"===e.type)return{serverResults:[],localResults:[]};if("error"===e.type)return{serverResults:r,localResults:[]};if("results"===e.type){const n=e.query!==t.query,o=0===e.value.length;return{serverResults:n&&!o?[]:r,localResults:e.value}}(0,m.t1)(e)}async function Y(e){const{environment:t,searchQuery:r,blockTypes:n,currentSpaceStore:o,currentSpaceViewStore:a,limit:i}=e,s=await(0,x.S)({environment:t,currentSpaceStore:o,currentSpaceViewStore:a,excludeCurrentPage:!1}),l={query:{text:r,filters:(0,d.u4)({requireEditPermissions:!1,isDeletedOnly:!1,excludeTemplates:!0,navigableBlockContentOnly:!0,blockTypes:n}),sort:{field:"relevance"}},limit:i},c=(0,b.Y)({query:l,localCachedPages:s,parentStore:o,isOnline:k.Z.state.online,environment:t,shouldLimitLocalResultsWhenOnline:!1,applyScoreThresholdWhenOnline:!0,canUseLtr:!1});return c&&g.x.isSuccess(c)?c.value.results.filter((e=>e.store.pathIsAccessibleAndAlive())):[]}function $(e){const{record:t,action:r,caption:n}=e;return{key:t.id,action:()=>r(t),render:(e,r)=>(0,F.jsx)(H,{inline:!0,store:t,hoverIcon:l.U,...e,caption:n})}}function z(e){const{environment:t,store:r}=e;S.createAndCommit({userAction:"assistant.clearInput",environment:t,perform:e=>v.f8({transaction:e,store:r})})}function Q(e){const{query:t,currentPageStore:r,onSelectPage:i}=e,{currentSpaceStore:s,currentSpaceViewStore:l}=(0,a.VK)((()=>({currentSpaceStore:P.default.state.currentSpaceStore,currentSpaceViewStore:P.default.state.currentSpaceViewStore})),[]);if(!s||!l)throw new Error("Expected spaceStore and spaceViewStore to be defined");const u=(0,n.useMemo)((()=>h.QaF(t)),[t]),d=(0,o.O7)(),g=(0,n.useCallback)((e=>{i(e.pointer)}),[i]),m=(0,a.VK)((()=>{if(!s)return[];const e=R.Z.get(s.id)??[];return p.mN(p.oA([r,...e.map((e=>e.store)).filter((e=>e.isType("page")))]),"id")}),[r,s]),v=(0,n.useCallback)((async e=>(await Y({environment:d,searchQuery:e,currentSpaceStore:s,currentSpaceViewStore:l,blockTypes:["page"],limit:5})).map((e=>e.store))),[s,l,d]),S=(0,n.useCallback)((async e=>{const t=await async function(e){const{environment:t,searchQuery:r,currentSpaceStore:n}=e;return(await(0,M.searchMentionablePages)({nearBlock:void 0,environment:t,query:r,source:"question_answer_context_search",limit:20})).map(((e,t)=>({...e,serverEventProperties:void 0,originalPosition:t,store:w.G.createChildStore(n,{table:c.iU,id:e.id})})))}({environment:d,searchQuery:e,currentSpaceStore:s});return t.map((e=>e.store)).filter((e=>e.isType("page")))}),[s,d]),C=D(u,v,E.E5),y=D(u,S,E.rE);return{items:(0,n.useMemo)((()=>{if(0===u.length||"empty"===C.type||"results"===C.type&&0===C.value.length&&"empty"===y.type)return m.map((e=>$({record:e,action:g,caption:e.id===(null==r?void 0:r.id)?(0,F.jsx)(f.FormattedMessage,{...G.openedPageLabel}):void 0})));const{localResults:e,serverResults:t}=W(C,y);return p.mN([...e,...t],"id").map((e=>$({record:e,action:g})))}),[u.length,C,y,m,g,null==r?void 0:r.id]),isLoading:C.loading||y.loading}}function X(e){const{clientSkill:t,shouldAcceptText:r,onSelect:o,textValue:i}=e,s=(0,f.useIntl)(),l=(0,a.VK)((()=>{const e=(0,_.np)();return(0,I.Kj)(null==e?void 0:e.id)?void 0:e}),[]),{items:c,isLoading:u}=Q({query:i,currentPageStore:l,onSelectPage:o}),d=(0,n.useMemo)((()=>{const e=[...c];return e.length>0&&i&&h.QaF(i).length>0&&r&&e.push({key:"freeform_activate",action:()=>o(i),render:e=>(0,F.jsx)(C.Z,{...e,svg:t.icon,title:`${s.formatMessage(t.displayName)} “${h.QaF(i)}”`})}),e.length>0?[{key:"local",items:e,render:e=>(0,F.jsx)(T.Z,{title:"Select a page",right:u?(0,F.jsx)(y.Z,{}):void 0,...e})}]:[]}),[c,i,r,o,t.icon,t.displayName,s,u]);return{sections:d,itemsAvailable:c.length>0}}function J(e){const{clientSkill:t,onSelect:r,shouldAcceptText:i,textValue:s}=e,l=(0,f.useIntl)(),c=(0,a.VK)((()=>{var e;return null===(e=(0,_.np)())||void 0===e?void 0:e.getCollectionStore()}),[]),{items:d,isLoading:g}=function(e){const{query:t,onSelectCollection:r,currentCollectionStore:i}=e,{currentSpaceStore:s,currentSpaceViewStore:l}=(0,a.VK)((()=>({currentSpaceStore:P.default.state.currentSpaceStore,currentSpaceViewStore:P.default.state.currentSpaceViewStore})),[]);if(!s||!l)throw new Error("Expected spaceStore and spaceViewStore to be defined");const c=(0,o.O7)(),d=(0,n.useMemo)((()=>h.QaF(t)),[t]),g=(0,n.useCallback)((e=>{var t;(null===(t=e.getParentBlockStore())||void 0===t?void 0:t.pointer)&&r(e.pointer)}),[r]),m=(0,a.VK)((()=>{if(!s)return[];const e=R.Z.get(s.id);if(!e)return[];const t=e.map((e=>e.store.isType("collection_view_page")||e.store.isType("collection_view")?e.store.getCollectionStore():void 0));return p.mN(p.oA([i,...t]),"id")}),[i,s]),v=(0,n.useCallback)((async e=>{const t=await Y({environment:c,searchQuery:e,currentSpaceStore:s,currentSpaceViewStore:l,blockTypes:["collection_view_page","collection_view"],limit:5});return p.mN(p.oA(t.map((e=>e.store.getCollectionStore()))),"id")}),[s,l,c]),S=(0,n.useCallback)((async e=>{const{results:t}=await(0,M.searchCollections)(c,{query:e,limit:20,source:"assistant_search_databases",spaceStore:s,searchSessionId:void 0});return t.map((e=>w.NW.createChildStore(s,{table:u.vF,id:e})))}),[s,c]),C=D(d,v,E.E5),y=D(d,S,E.rE);return{items:(0,n.useMemo)((()=>{if(0===d.length||"empty"===C.type||"results"===C.type&&0===C.value.length&&"empty"===y.type)return m.map((e=>$({record:e,action:g,caption:e.id===(null==i?void 0:i.id)?(0,F.jsx)(f.FormattedMessage,{...G.openedPageLabel}):void 0})));const{localResults:e,serverResults:t}=W(C,y);return p.mN(p.oA([...e,...t]),"id").map((e=>$({record:e,action:g})))}),[d.length,C,y,m,g,null==i?void 0:i.id]),isLoading:C.loading||y.loading}}({query:s,onSelectCollection:r,currentCollectionStore:c}),m=d.length>0,v=(0,n.useMemo)((()=>{const e=[...d],n=h.QaF(s);if(e.length>0&&s&&n.length>0&&i){const o=`${l.formatMessage(t.displayName)} “${n}”`;e.push({key:"freeform_activate",action:()=>r(s),render:e=>(0,F.jsx)(C.Z,{...e,svg:t.icon,title:o})})}return e.length>0?[{key:"local",items:e,render:e=>(0,F.jsx)(T.Z,{title:"Select a database",right:g?(0,F.jsx)(y.Z,{}):void 0,...e})}]:[]}),[d,s,i,l,t.displayName,t.icon,r,g]);return{sections:v,itemsAvailable:m}}function ee(e){const{items:t,onSelect:r,textValue:o}=e,a=(0,f.useIntl)(),s=(0,n.useMemo)((()=>t.map((e=>({...e,name:a.formatMessage(e.name)}))).sort(((e,t)=>e.name.localeCompare(t.name)))),[a,t]),l=(0,n.useMemo)((()=>{const e=h.QaF(o),t=(0,i.ZP)(e,s,(e=>e.name)).map((e=>({key:e.key,action:()=>r(e.key),render:t=>(0,F.jsx)(C.Z,{...t,title:e.name})}))),n=t.length>0;return[{key:"items",items:t,render:e=>(0,F.jsx)(T.Z,{title:n?void 0:a.formatMessage(G.noItemsAvailable),...e})}]}),[a,s,r,o]);return l}},140190:(e,t,r)=>{r.d(t,{S:()=>m});var n=r(667294),o=r(800480),a=r(724405),i=r(542853),s=r(654497),l=r(137810),c=r(524677),u=r(898104),d=r(489728),h=r(526388),f=r(825464),p=r(785893);const g={height:"auto",marginBlock:-6,marginInline:-5,maxWidth:"auto",paddingBlock:6,paddingInline:5},m=(0,n.forwardRef)((function(e,t){const{children:r,disabled:m,icon:S,isCompact:C,isError:y,hasActionRequired:T,isSecondary:_,onClick:I,style:E,tooltipMessage:b}=e,x=(0,o.O7)(),M=(0,a.yK)((e=>({button:{...v(e,{isError:y,hasActionRequired:T,isSecondary:_}),gap:4,padding:"0 8px 0 5px",...C?g:void 0,...E},children:{...l.Z.textOverflowStyle,flex:"1 1 auto"},icon:{...y?{fill:e.lightErrorText}:void 0},warningIcon:{color:e.errorText,fill:e.errorText,height:12,flex:"0 0 auto",width:12},chevronIcon:{fill:e.lightIconColor,flex:"0 0 auto",height:10,width:10}})),[y,T,_,C,E]),P=(0,n.useMemo)((()=>S?()=>S(M.icon):void 0),[S,M.icon]),k=(0,n.useCallback)((()=>b??null),[b]),R=(0,n.useCallback)((e=>{u.ZH({debug:{userAction:"AutomationDropdownButton.handleClick"},environment:x}),c.ZH({debug:{userAction:"AutomationDropdownButton.handleClick"},environment:x}),null==I||I(e)}),[I,x]);return(0,p.jsx)(h.Z,{delayThreshold:0,disableTooltip:!Boolean(b),placement:f.u.Bottom,render:e=>(0,p.jsxs)(d.Z,{...e,icon:P,disabled:m,disabledFeedback:m,onClick:R,ref:t,shouldShrink:!0,style:M.button,children:[(0,p.jsx)("div",{style:M.children,children:r}),y&&(0,s.t)(M.warningIcon),(0,i.i)(M.chevronIcon)]}),renderTooltip:k})}));function v(e,t){const{isError:r,hasActionRequired:n,isSecondary:o}=t;return r?{color:e.errorText}:n?{color:e.blueColor,fontWeight:l.Z.fontWeight.medium}:o?{color:e.regularTextColor}:{color:e.mediumTextColor}}},402064:(e,t,r)=>{r.r(t),r.d(t,{AssistantBasicStandalone:()=>pe});var n=r(667294),o=r(718844),a=r(689024),i=r(709291),s=r(707124),l=r(824006),c=r(800480),u=r(724405),d=r(898104),h=r(668709),f=r(903553),p=r(965187),g=r(843250),m=r(768657),v=r(249394),S=r(785893);function C(e){const{disableMentions:t,defaultValue:r,onChange:n,disabled:o,placeholder:a,style:i}=e,s=(0,c.O7)(),l=(0,u.yK)((e=>({inputContainer:{backgroundColor:"dark"===e.mode?e.inputBackground:void 0,borderRadius:4,boxShadow:e.inputBoxShadow,color:e.text.primary,cursor:"text",fontSize:14,fontStyle:"normal",fontWeight:400,lineHeight:"18px",overflow:"auto",padding:8}})),[]),{store:C}=(0,m.Cl)({initialValue:r,onChange:n});return(0,S.jsx)("div",{style:l.inputContainer,className:g.Wh_,children:(0,S.jsx)(f.Z,{store:C,isDefaultContainer:!0,droppable:!1,render:()=>(0,S.jsx)(h.p,{allowSelectionWithin:!0,children:(0,S.jsx)(p.Z,{style:i,placeholderStyle:i,store:C,disabled:o,disableSlashCommands:!0,disableEnter:!0,disableEmbedMenu:!0,disableStyleAnnotations:!0,disableSuggestionAnnotations:!0,disableMentions:t,inPageFind:v.B3.none,pasteBehavior:"plaintext",placeholder:a,onBlur:()=>{d.ZH({environment:s,debug:{userAction:"AssistantBasicTextValueInput.Text.onBlur"}})}})})})})}const y=(0,i.defineMessages)({instructionsPlaceholder:{id:"assistantBasicCustomOptions.instructionsPlaceholder",defaultMessage:"Prompt AI what to do in plain language. AI can search your workspace, edit content, and chat back to you."},initialUserPromptPlaceholder:{id:"assistantBasicCustomOptions.initialUserPromptPlaceholder",defaultMessage:"What to ask the user for?"},textParameterName:{id:"assistantBasicCustomOptions.textParameterName",defaultMessage:"Text"}});function T(e){var t;const{config:r,disabled:o,onChangeConfig:s}=e,l=(0,i.useIntl)(),c=null==r||null===(t=r.parameterValues)||void 0===t?void 0:t.instructions,u=(0,n.useCallback)((e=>{if(!e)return;const t=(null==r?void 0:r.parameterValues)??{};s({...r,parameterValues:{...t,instructions:e}})}),[r,s]);return(0,S.jsxs)(a.jX,{direction:"column",gap:12,children:[(0,S.jsx)(C,{defaultValue:c,disabled:o,onChange:u,placeholder:l.formatMessage(y.instructionsPlaceholder),style:{minHeight:128}}),(0,S.jsx)(_,{disabled:o,config:r,onChangeConfig:s})]})}function _(e){var t,r;const{disabled:o,config:c,onChangeConfig:u}=e,d=(0,i.useIntl)(),[h,f]=(0,n.useState)(Boolean(null==c||null===(t=c.parameterValues)||void 0===t||null===(t=t.initialUserPrompt)||void 0===t?void 0:t.length)),p=(0,n.useCallback)((()=>{o||f((e=>!e))}),[o]),g=(0,n.useCallback)((e=>{if(!e||!h||o)return;const t=(null==c?void 0:c.parameterValues)??{};u({...c,parameterValues:{...t,initialUserPrompt:e}})}),[c,o,u,h]);return(0,n.useEffect)((()=>{var e;const t=(null==c?void 0:c.parameterValues)??{};Boolean(null===(e=t.initialUserPrompt)||void 0===e?void 0:e.length)&&!h&&u({...c,parameterValues:{...t,initialUserPrompt:[]}})}),[c,u,h]),(0,S.jsxs)(a.jX,{direction:"column",gap:8,children:[(0,S.jsx)("div",{style:{cursor:"pointer",userSelect:"none"},onClick:p,children:(0,S.jsxs)(a.jX,{direction:"row",gap:8,padding:"0 4px",children:[(0,S.jsx)(l.Z,{disabled:o,onClick:e=>{e.stopPropagation(),p()},on:h}),(0,S.jsx)(s.q,{styleName:"UIRegular-14px/Regular",children:(0,S.jsx)(i.FormattedMessage,{id:"assistantBasicCustomOptions.requireUserInput",defaultMessage:"Require user input"})})]})}),h?(0,S.jsx)(C,{defaultValue:null===(r=c.parameterValues)||void 0===r?void 0:r.initialUserPrompt,disabled:o,disableMentions:!0,onChange:g,placeholder:d.formatMessage(y.initialUserPromptPlaceholder),style:{minHeight:16}}):null]})}var I=r(681532),E=r(940694),b=r(847957),x=(r(21703),r(886628)),M=r(421202),P=r(606287),k=r(76233),R=r(401898),w=r(145443),O=r(144500),A=r(231945),L=r(478140),B=r(632163),U=r(776798),V=r(460709),N=r(80444),q=r(61766),j=r(229798),F=r(206258),H=r(140190),K=r(268894),Z=r(672495);const G=(0,i.defineMessages)({searchPlaceholder:{id:"assistantBasic.searchPlaceholder",defaultMessage:"Search"}});function D(e){const{value:t,onChange:r}=e,o=(0,i.useIntl)(),{isMobile:a}=(0,c.Fy)(),s=(0,n.useCallback)((e=>{const t=k.TPx(e.target.value);r(t)}),[r]);return(0,S.jsx)(K.ZP,{focusInitial:!a||void 0,onChange:s,placeholder:o.formatMessage(G.searchPlaceholder),showClearButton:!0,value:k.QaF(t)})}function W(e){const{value:t,onChange:r}=e,o=(0,u.yK)((e=>({searchArea:{position:"sticky",background:e.popoverBackground,top:0,marginTop:0,padding:"14px 0 6px 0"}})),[]);return(0,n.useMemo)((()=>({key:"search",render:e=>(0,S.jsx)(Z.Z,{style:o.searchArea,isInput:!0,...e}),items:[{key:"search",action:()=>{},render:()=>(0,S.jsx)(D,{value:t,onChange:r})}]})),[o.searchArea,t,r])}function Y(e){const{config:t,disabled:r,onChangeConfig:o}=e,{skillType:a}=t,{clientSkill:i,fillableParameterWithoutValue:s}=(0,n.useMemo)((()=>({clientSkill:re(a),fillableParameterWithoutValue:ne(a)})),[a]),l=(0,n.useCallback)((e=>{if(!s)return;const r=s.fillableParameter,n=t.parameterValues??{};o({...t,parameterValues:{...n,[r]:e}})}),[t,o,s]);if(!i||!s)return null;const{type:c}=s.parameterDefinition;switch(c){case"block":case"blockOrText":return(0,S.jsx)(X,{clientSkill:i,config:t,disabled:r,fillableParameterWithoutValue:s,onSelect:l,shouldAcceptText:"blockOrText"===c});case"collection":return(0,S.jsx)(z,{clientSkill:i,config:t,disabled:r,fillableParameterWithoutValue:s,onSelect:l,shouldAcceptText:!1});case"tone":return(0,S.jsx)(Q,{config:t,disabled:r,fillableParameterWithoutValue:s,items:I.hw,onSelect:l});case"language":return(0,S.jsx)(Q,{config:t,disabled:r,fillableParameterWithoutValue:s,items:I.vu,onSelect:l});default:(0,R.t1)(c)}}function $(e){const{displayValue:t}=e,{type:r}=t;switch(r){case"recordTitle":return(0,S.jsx)(U.Z,{store:t.store});case"string":return(0,S.jsx)(S.Fragment,{children:t.text});case"localized":return(0,S.jsx)(i.FormattedMessage,{...t.text});default:throw new Error("Not implemented yet or unreachable type")}}function z(e){const{clientSkill:t,config:r,fillableParameterWithoutValue:o,disabled:a,shouldAcceptText:i,onSelect:s}=e,[l,c]=(0,n.useState)([]),{sections:u}=(0,w.IW)({clientSkill:t,shouldAcceptText:i,onSelect:s,textValue:l});return(0,S.jsx)(J,{onChangeTextValue:c,fillableParameterWithoutValue:o,disabled:a,sections:u,textValue:l,config:r})}function Q(e){const{items:t,onSelect:r,disabled:o,config:a,fillableParameterWithoutValue:i}=e,[s,l]=(0,n.useState)([]),c=(0,w.Dl)({items:t,onSelect:r,textValue:s});return(0,S.jsx)(J,{onChangeTextValue:l,config:a,disabled:o,fillableParameterWithoutValue:i,sections:c,textValue:s})}function X(e){const{clientSkill:t,config:r,disabled:o,fillableParameterWithoutValue:a,onSelect:i,shouldAcceptText:s}=e,[l,c]=(0,n.useState)([]),{sections:u}=(0,w.bi)({clientSkill:t,onSelect:i,shouldAcceptText:s,textValue:l});return(0,S.jsx)(J,{onChangeTextValue:c,sections:u,fillableParameterWithoutValue:a,disabled:o,textValue:l,config:r})}function J(e){const{config:t,disabled:r,fillableParameterWithoutValue:o,onChangeTextValue:a,sections:s,textValue:l}=e,c=(0,x.qz)(void 0,q.Z),u=(0,n.useMemo)((()=>function(e){const{skillType:t,parameterValues:r}=e;if(!t||!r)return;if(!(0,I._Y)(t))return;return(0,I.OD)({skillType:t,parameterValues:r})}(t)),[t]),d=(0,n.useMemo)((()=>function(e){if(!e)return;const{type:t}=e;switch(t){case"block":return te(e.value);case"blockOrText":return Array.isArray(e.value)?(r=e.value,{type:"string",text:(0,k.QaF)(r)}):te(e.value);case"collection":return function(e){const t=N.default.state.mainEditorCurrentBlockStore??N.default.state.currentSpaceStore;if(!t)return;return{type:"recordTitle",store:F.NW.createChildStore(t,{table:P.vF,id:e.id,spaceId:e.spaceId})}}(e.value);case"tone":return function(e){if(!e)return;const t=(0,I.qC)(e);return{type:"localized",text:t.name}}(e.value);case"language":return function(e){if(!e)return;const t=(0,I.S8)(e);return{type:"localized",text:t.name}}(e.value);default:throw new Error("Not implemented yet or unreachable type")}var r}(u)),[u]);return(0,S.jsx)(A.ZP,{buttonPopupStore:c,popupType:A.Z4.Popup,alignmentToOrigin:A.vR.End,placementToOrigin:A.pO.Bottom,originGap:0,onClosed:()=>a([]),disabled:!1,renderOrigin:e=>(0,S.jsx)(H.S,{...e,disabled:r,isCompact:!0,hasActionRequired:!d,children:d?(0,S.jsx)($,{displayValue:d}):(0,S.jsx)(i.FormattedMessage,{...o.parameterDefinition.placeholder})}),render:e=>(0,S.jsx)(ee,{menuListSections:s,onChangeTextValue:a,onDismiss:e.close,textValue:l})})}function ee(e){const{onChangeTextValue:t,onDismiss:r,menuListSections:o,textValue:a}=e,i=(0,x.qz)(void 0,j.Z),s=W({value:a,onChange:t}),l=(0,n.useMemo)((()=>[s,...o]),[s,o]);return(0,S.jsx)(L.Z,{maxHeight:"40vh",menuType:V.og.Popup,minHeight:56,width:280,children:(0,S.jsx)(B.Z,{disableKeyboard:!1,initialFocus:0,onAccept:r,sections:l,store:i,type:B.i.Vertical})})}function te(e){const t=N.default.state.mainEditorCurrentBlockStore??N.default.state.currentSpaceStore;if(t)return{type:"recordTitle",store:F.G.createChildStore(t,{table:M.iU,id:e.id,spaceId:e.spaceId})}}function re(e){if(e&&(0,I._Y)(e))return(0,O.createClientGlobalSkill)(e)}function ne(e){if(e&&(0,I._Y)(e))return(0,I.sI)(e)}var oe=r(183583),ae=r(718942),ie=r(552275),se=r(595193),le=r(435294);const ce=(0,i.defineMessages)({search:{id:"assistantBasicSkillTypeMenuMenu.categories.search",defaultMessage:"Search..."}});function ue(e){const{selectedSkillType:t,onChangeSelectedSkillType:r,errorMessage:n,disabled:o}=e,a=(0,i.useIntl)(),s=(0,x.qz)(void 0,q.Z),l=(0,le.d)();return(0,S.jsx)(A.ZP,{buttonPopupStore:s,popupType:l,alignmentToOrigin:A.vR.End,placementToOrigin:A.pO.Bottom,originGap:0,disabled:o,renderOrigin:e=>(0,S.jsx)(H.S,{...e,disabled:o,isCompact:!0,hasActionRequired:!t,isError:Boolean(n),tooltipMessage:n,children:t?a.formatMessage(ae.dS[t].displayName):(0,S.jsx)(i.FormattedMessage,{id:"assistantBasicSkillTypeMenu.skillType",defaultMessage:"Select action"})}),render:e=>(0,S.jsx)(de,{onChangeSelectedSkillType:t=>{r(t),e.close()},selectedSkillType:t})})}function de(e){const{onChangeSelectedSkillType:t,selectedSkillType:r}=e,{isMobile:o}=(0,c.Fy)(),a=(0,i.useIntl)(),s=(0,u.Fg)(),[l,d]=(0,n.useState)(""),h=(0,se.F)({maxWidth:360,width:280,maxHeight:400}),f=(0,x.qz)(void 0,j.Z),p=(0,n.useMemo)((()=>({type:"entrypoint",entrypoint:"automationButtonEditor",isMobile:o})),[o]),g=(0,x.VK)((()=>function(e){const{intl:t,onChangeSelectedSkillType:r,query:n,theme:o,selectedSkillType:a,assistantSuggestionContext:i}=e,s=(0,oe.filterAndRankAssistantSurfaceActionsForContext)((0,oe.clientSkillToAssistantSurfaceAction)((0,O.getAllClientSkills)({currentPageRecordPointer:void 0})),i);return s.map((e=>{const{skillType:n}=e;return function(e){const{intl:t,skillType:r,theme:n,onChangeSelectedSkillType:o,isSelected:a}=e,i=ae.dS[r],s=ae.K2[i.category],l=t.formatMessage(i.displayName),c=i.icon,u=s.color(n).color;if(!c)return;const d=e=>{const t=e.toLowerCase().trim();return 0===t.length||l.toLowerCase().includes(t)};return{key:r,action:()=>{a||o(r)},matchesQuery:d,skillType:r,render:e=>(0,S.jsx)(ie.Z,{...e,icon:c({width:14,height:14,fill:u}),checkState:a,title:(0,S.jsx)("div",{style:{display:"flex"},children:l})})}}({intl:t,skillType:n,theme:o,onChangeSelectedSkillType:r,isSelected:n===a})})).filter(R.$K).filter((e=>e.matchesQuery(n)))}({intl:a,onChangeSelectedSkillType:t,query:l,selectedSkillType:r,theme:s,assistantSuggestionContext:p})),[p,a,t,l,r,s]),m={key:"search",render:e=>(0,S.jsx)(Z.Z,{isInput:!0,...e}),items:[{action:()=>{},key:"search",render:()=>(0,S.jsx)(K.ZP,{focusInitial:!o||void 0,onChange:e=>d(e.target.value),placeholder:a.formatMessage(ce.search),showClearButton:!0,value:l})}]},v=(0,x.VK)((()=>(0,ae.K$)(ae.dr,p)),[p]).map((e=>function(e){const{intl:t,skillCategory:r,skillTypeMenuListItems:n}=e,o=n.filter((e=>{const{skillType:t}=e;return ae.dS[t].category===r}));if(!o.length)return;const a="custom"===r?void 0:ae.K2[r].label;return{key:r,items:o,render:e=>(0,S.jsx)(Z.Z,{...e,title:a?t.formatMessage(a):void 0})}}({intl:a,skillCategory:e,skillTypeMenuListItems:g}))).filter(R.$K),C=[m,...v];return(0,S.jsx)(L.Z,{...h,children:(0,S.jsx)(B.Z,{initialFocus:0,sections:C,store:f,type:B.i.Vertical})})}function he(e){const{config:t,disabled:r,onChangeConfig:o}=e,{skillType:a}=t??{},s=(0,i.useIntl)(),l=(0,u.yK)((()=>({headerWrap:{paddingInlineEnd:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:6}})),[]),c=(0,E.z)("assistant_basic"),d=(0,n.useCallback)((e=>{o({...t,skillType:e,parameterValues:{}})}),[t,o]);return(0,S.jsxs)(b.vu,{disabled:r,actionRegistryItem:c,styles:l,children:[s.formatMessage(c.display.name),(0,S.jsx)(ue,{disabled:r,selectedSkillType:a,onChangeSelectedSkillType:d}),fe(t)?(0,S.jsx)(S.Fragment,{children:(0,S.jsx)(Y,{disabled:r,config:t,onChangeConfig:o})}):null]})}function fe(e){return void 0!==(null==e?void 0:e.skillType)&&(0,I._Y)(e.skillType)}function pe(e){const{config:t,disabled:r,onChangeConfig:n}=e;return(0,S.jsxs)(a.jX,{direction:"column",gap:14,children:[(0,S.jsx)(he,{disabled:r,config:t,onChangeConfig:n}),(0,o.tu)(t)?(0,S.jsx)(T,{disabled:r,config:t,onChangeConfig:n}):null]})}},409015:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(667294),o=r(74404);const a=(0,n.createContext)({automationContextStore:void 0,automationStore:void 0,collectionStore:void 0,currentDraggingActionId:void 0,disabled:!0,maybePersistedTransactionActions:{createAndCommit:o.U},editorPlacement:{type:"inline"},editorWidth:300,suppressActionErrors:[]});a.displayName="AutomationEditorContext";const i=a},312455:(e,t,r)=>{r.d(t,{P:()=>s,i:()=>i});r(21703);var n=r(667294),o=r(886628),a=r(409015);function i(){const e=(0,n.useContext)(a.Z),t=(0,o.VK)((()=>{var t;return null===(t=e.automationContextStore)||void 0===t?void 0:t.context.automationStore}),[e.automationContextStore]);if(!t)throw new Error("automationStore is undefined. Is this rendered inside an AutomationEditorContext.Provider?");return{...e,automationStore:t}}function s(){const{collectionStore:e,automationStore:t,...r}=i(),n=(0,o.VK)((()=>{if(!(null!=t&&t.isTriggerType("event")||null!=t&&t.isTriggerType("notification_event")))throw new Error("automationStore is wrong type. Is this called in the wrong type of automation?");return t}),[t]);if(!e)throw new Error("collectionStore is undefined. Is this rendered inside an AutomationEditorContext.Provider?");return{...r,collectionStore:e,automationStore:n}}},595193:(e,t,r)=>{r.d(t,{F:()=>s,U:()=>i});var n=r(800480),o=r(886628),a=r(460709);function i(e){return e.device.isPhone||"actionSheet"===e.tabletBehavior&&e.device.isTablet?{menuType:a.og.ActionSheet}:{menuType:a.og.Popup,maxHeight:e.maxHeight,maxWidth:e.maxWidth,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,width:e.width,minWidth:e.minWidth}}function s(e){const t=(0,n.Fy)();return(0,o.VK)((()=>i({device:t,maxHeight:null==e?void 0:e.maxHeight,maxWidth:null==e?void 0:e.maxWidth,paddingTop:null==e?void 0:e.paddingTop,paddingBottom:null==e?void 0:e.paddingBottom,width:null==e?void 0:e.width,minWidth:null==e?void 0:e.minWidth,tabletBehavior:null==e?void 0:e.tabletBehavior})),[t,null==e?void 0:e.maxHeight,null==e?void 0:e.maxWidth,null==e?void 0:e.paddingTop,null==e?void 0:e.paddingBottom,null==e?void 0:e.width,null==e?void 0:e.minWidth,null==e?void 0:e.tabletBehavior])}},435294:(e,t,r)=>{r.d(t,{d:()=>i});var n=r(800480),o=r(886628),a=r(953437);function i(e){const t=(0,n.Fy)();return(0,o.VK)((()=>t.isPhone||"slideUp"===(null==e?void 0:e.tabletBehavior)&&t.isTablet?a.kQ.SlideUp:a.kQ.Popup),[t,null==e?void 0:e.tabletBehavior])}},74404:(e,t,r)=>{r.d(t,{U:()=>S,$:()=>C});r(21703);var n=r(667294),o=r(800480),a=r(886628),i=r(798963),s=r(401898),l=r(210228),c=r(718844),u=r(653965),d=r(206258);function h(e,t){var r,n;const o=null==e?void 0:e.getModel(),a=null==t?void 0:t.getModel();if(!t||!a)return!0;return!(!o||(null===(r=o.getProperties())||void 0===r?void 0:r.name)===(null===(n=a.getProperties())||void 0===n?void 0:n.name))||(!!function(e,t){const r=null==e?void 0:e.getModel(),n=t.getModel();if(!n)return!0;if((0,s.$K)(r)){if(r.isEventType()&&n.isEventType()||r.isNotificationType()&&n.isNotificationType()){const e=r.getEventConfiguration(),t=n.getEventConfiguration();return!(0,u.Xy)(e,t)}if(r.isRecurrenceType()&&n.isRecurrenceType()){const e=r.getRecurrence(),t=n.getRecurrence();return!(0,u.Xy)(e,t)}return!r.isButtonType()||!n.isButtonType()}if(n.isEventType()||n.isNotificationType()){const e=n.getEventConfiguration();return!1!==e.pagesAdded||"none"!==e.pagePropertiesEdited.type}if(n.isRecurrenceType())return!0;if(n.isButtonType())return!1;if(n.isAssistantType())return!1;(0,s.t1)(n)}(e,t)||!!function(e,t){const r=t.getSpaceId();if(!r)return!1;if((0,s.$K)(e)){const n=e.getActionIds(),o=t.getActionIds();return n.length!==o.length||!(0,u.Xy)(n,o)||n.some((n=>{const o={id:n,spaceId:r,table:c.Xj},a=d.zq.createChildStore(e,o).getModel(),i=d.zq.createChildStore(t,o).getModel();return!(0,s.$K)(a)||!(0,s.$K)(i)||!(0,u.Xy)(a.getConfig(),i.getConfig())}))}return t.getActionIds().length>0}(e,t))}var f=r(628020),p=r(503932),g=r(484398),m=r(582787),v=r(80444);function S(e){const t=new p.Y({deadlockTimeoutMs:l.DEADLOCK_WARNING_TIMEOUT_MS});return{performResult:e.perform(t),serverCommitResult:Promise.resolve()}}function C(e){const{automationId:t,spaceId:r,defaultValue:c,persist:u}=e,p=(0,o.O7)(),S=(0,a.VK)((()=>{var e;return null===(e=v.default.state.currentUserStore)||void 0===e?void 0:e.userId}),[]),C=(0,n.useMemo)((()=>{if(t&&r&&S)return{id:t,table:i.cv,spaceId:r}}),[t,r,S]),y=(0,g.$)("useUnpersistedAutomationStore",{cacheFallback:p.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0}),T=(0,n.useMemo)((()=>{if(!C)return;const e=y.getEntry({pointer:C,userId:S});if(!(0,s.$K)(e)&&S){if(!c)throw new Error("create is true but no defaultValue provided");y.setRecord({pointer:C,userId:S},{role:"editor",value:c})}return new d.Mz(p,C,{inMemoryRecordCache:y})}),[c,p,C,y,S]),_=(0,a.VK)((()=>{const e=f.np();if(C&&e)return d.Mz.createChildStore(e,C)}),[C]),I=u?_:T,E=(0,a.VK)((()=>!u&&h(_,T)),[u,_,T]),{createAndCommit:b}=(0,m.Z)({unpersistedInMemoryRecordCache:y}),x=(0,n.useCallback)((e=>u?l.createAndCommit({...e,environment:p}):b(e)),[b,p,u]);return{maybePersistedTransactionActions:{createAndCommit:x},maybePersistedAutomationStore:I,hasUnpersistedChanges:E}}},768657:(e,t,r)=>{r.d(t,{Cl:()=>f,NY:()=>p});var n=r(667294),o=r(800480),a=r(886628),i=r(471924),s=r(421202),l=(r(76233),r(653965)),c=r(307032),u=r(484398),d=r(319385),h=r(206258);function f(e){const{initialValue:t,onChange:r,source:d="title",parentCollectionStore:f}=e,p=(0,o.O7)(),g=(0,u.$)("formulaPrototypeHelpers.useMockTextStore",{isMockTextStore:!0,overrideDefaultRecordCache:!0}),m=function(e){const{initialValue:t,inMemoryRecordCache:r,source:a,parentCollectionStore:l}=e,u=(0,o.O7)(),d=(0,n.useMemo)((()=>t),[]);return(0,n.useMemo)((()=>{const e={id:i.Il(),table:s.iU};r.setRecord({pointer:e,userId:u.currentUser.id},{value:{alive:!0,id:e.id,parent_id:(null==l?void 0:l.id)??c._6,parent_table:"block",properties:{[a]:d},space_id:(null==l?void 0:l.getSpaceId())??c._6,type:"page",version:0},role:"editor"});const t=new h.ST({environment:u,path:["properties",a],pointer:e,recordStoreOptions:{inMemoryRecordCache:r,userId:u.currentUser.id}});return r.emitRecord(e,[]),t}),[u,r,d,l,a])}({initialValue:t,inMemoryRecordCache:g,source:d,parentCollectionStore:f}),v=(0,n.useRef)(t),S=(0,n.useCallback)((e=>{const t=p.currentUser.id,r=m.getRecordStoreAtRootPath();if(r instanceof h.G){const n=r.getValue();n&&(g.setRecord({pointer:m.pointer,userId:t},{role:"editor",value:{...n,properties:{...null==n?void 0:n.properties,[d]:e}}}),g.emitRecord(m.pointer,[]))}}),[p.currentUser.id,m,g,d]);return(0,a.VK)((()=>{const e=m.getValue();l.Xy(v.current,e)||(v.current=e,null==r||r(e))}),[m,r]),{store:m,setValue:S}}function p(){return d.default.checkGate({gateName:"formula_buttons"})}},484398:(e,t,r)=>{r.d(t,{$:()=>i});var n=r(667294),o=r(126263),a=r(800480);function i(e,t){const{cacheFallback:r,isMockTextStore:i,isTemporaryData:s,onOperationCallback:l,overrideDefaultRecordCache:c}=t??{},u=(0,a.O7)(),{inMemoryRecordCache:d}=u.defaultRecordCache,h=(0,n.useMemo)((()=>{const t=new o.Z({isTemporaryData:Boolean(s),name:e,onOperationCallback:l});return t.isMockTextStore=Boolean(i),r&&t.addCacheFallback(r),c&&d.addCacheOverride(t),t}),[r,d,i,s,e,l,c]);return(0,n.useEffect)((()=>function(){r&&h.removeCacheFallback(r),c&&d.removeCacheOverride(h)}),[r,d,h,c]),h}},582787:(e,t,r)=>{r.d(t,{Z:()=>u});var n=r(667294),o=r(886628),a=r(433422),i=r(145953),s=r(210228),l=r(503932),c=r(80444);function u(e){let{unpersistedInMemoryRecordCache:t}=e;const r=(0,o.VK)((()=>{var e;return null===(e=c.default.state.currentUserStore)||void 0===e?void 0:e.userId}),[]);return{createAndCommit:(0,n.useCallback)((e=>{let{perform:n}=e;const o=new l.Y({deadlockTimeoutMs:s.DEADLOCK_WARNING_TIMEOUT_MS}),c=n(o),u=i.Ak.create();o.stores.forEach((e=>{const t=e.getRecordModel(e.pointer);t&&u.addModel(t)})),(0,a.FS)({operations:o.operations,recordMap:u,updateOnly:!1});for(const a of u){const{model:e,pointer:n}=a;t.setModelAndRole({pointer:n,userId:r},e,"editor")}return t.emitAll(),{performResult:c,serverCommitResult:Promise.resolve()}}),[t,r])}}},525286:(e,t,r)=>{r.d(t,{Y:()=>W,f:()=>D});var n=r(421202),o=r(145366),a=r(492338),i=r(653965),s=r(307032),l=r(401898),c=r(619584),u=r(730459),d=r(897638),h=(r(757658),r(971384)),f=r(80444);class p{constructor(e,t,r){var n;this.featuresets=void 0,this.queryLower=void 0,this.userId=void 0,this.spaceId=void 0,this.currentTimeMs=void 0,this.pageSignals=void 0,this.resultsFeatureMetadata={},this.featuresets=e,this.queryLower=r.toLowerCase(),this.userId=t.currentUser.id,this.spaceId=null===(n=f.default.state.currentSpaceStore)||void 0===n?void 0:n.id,this.currentTimeMs=Date.now(),this.pageSignals=h.Z.getPageSignals({spaceId:this.spaceId,userId:this.userId})}extractFeatureGroup(e){const t=[];for(const r of this.featuresets){const n={groupName:r.name,features:[]};for(const t of r.features)n.features.push(t({result:e,featureExtractor:this}));t.push(n)}return t}}var g=r(319385),m=r(826842),v=r(155320),S=r(629026),C=r(88893),y=r(343759);function T(e){return Number.isFinite(e)?e:0}const _={name:"CLIENT_FEATURESET_RELEVANCY_MODEL",features:[function(e){let{result:t,featureExtractor:r}=e;return{name:"TIME_SINCE_LAST_EDIT",value:r.currentTimeMs-t.block.blockModel.last_edited_time}},function(e){let{result:t,featureExtractor:r}=e;return{name:"IS_LAST_EDITED_BY_ME",value:r.userId&&t.block.blockModel.last_edited_by_id===r.userId?1:0}},function(e){let{result:t,featureExtractor:r}=e;return{name:"IS_CREATED_BY_ME",value:r.userId&&t.block.blockModel.created_by_id===r.userId?1:0}},...a.ik.map((e=>t=>{let{result:r}=t;return{name:`BLOCK_SOURCE_${e}`,value:r.block.source.has(e)?1:0}})),function(e){var t;let{result:r,featureExtractor:n}=e;return{name:"PAGE_AUTHORITY_V1",value:n.pageSignals?null===(t=n.pageSignals[r.block.blockModel.id])||void 0===t?void 0:t.pageAuthorityV1:void 0}},function(e){let{result:t}=e;return{name:"TITLE_LENGTH",value:t.block.text.length}},function(e){let{result:{terms:t},featureExtractor:{queryLower:r}}=e;return{name:"TERMS_COUNT_NORMALIZED",value:T(t.length/(0,y.pv)(r).length)}},function(e){let{result:{terms:t},featureExtractor:{queryLower:r}}=e;const n=(0,y.pv)(r),o=new Set(t);return{name:"FULL_MATCH_TERM_COUNT_NORMALIZED",value:T(n.filter((e=>o.has(e))).length/n.length)}},function(e){let{result:{terms:t,block:{text:r}}}=e;const n=(0,y.pv)(r.toLowerCase());return{name:"MATCHING_PERCENTAGE_OF_TITLE",value:T(t.length/n.length)}}]};r(21703);function I(e,t){return E(e,t,0)}function E(e,t,r){const n=t[r];if("value"in n)return n.value;const{feature:o,threshold:a,left:i,right:s}=n;return e[o]<=a?E(e,t,s):E(e,t,i)}const b=[{feature:"NUMBER_OF_BLOCK_SOURCES",threshold:.9803883731365204,left:1,right:64},{feature:"NUMBER_OF_BLOCK_SOURCES",threshold:-.02051524817943573,left:2,right:33},{feature:"TITLE_LENGTH",threshold:-.9804741442203522,left:3,right:18},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:4,right:11},{feature:"PAGE_AUTHORITY_V1",threshold:.9929431676864624,left:5,right:8},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:6,right:7},{value:.055661729574773056},{value:.11489805030510493},{feature:"IS_LAST_EDITED_BY_ME",threshold:.5,left:9,right:10},{value:.1303473491773309},{value:.2761679479597871},{feature:"PAGE_AUTHORITY_V1",threshold:.7070983946323395,left:12,right:15},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:13,right:14},{value:.15403218305273927},{value:.2901420576840293},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:16,right:17},{value:.3969548667754214},{value:.5434689507494647},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:19,right:26},{feature:"PAGE_AUTHORITY_V1",threshold:-9373319335297929e-20,left:20,right:23},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:21,right:22},{value:.019246861924686193},{value:.0422577337207315},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.38750000298023224,left:24,right:25},{value:.04463445567238064},{value:.08163417730973187},{feature:"PAGE_AUTHORITY_V1",threshold:.9430259466171265,left:27,right:30},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:28,right:29},{value:.04921499627799959},{value:.11522081288769559},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:31,right:32},{value:.15812057498390902},{value:.26642904878592116},{feature:"TITLE_LENGTH",threshold:-.8644499182701111,left:34,right:49},{feature:"PAGE_AUTHORITY_V1",threshold:.7071063816547394,left:35,right:42},{feature:"TIME_SINCE_LAST_EDIT",threshold:-.9999998509883881,left:36,right:39},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.7386363744735718,left:37,right:38},{value:.5046524356869184},{value:.6139737991266375},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.9545454680919647,left:40,right:41},{value:.35265916931762176},{value:.4631217838765009},{feature:"IS_LAST_EDITED_BY_ME",threshold:.5,left:43,right:46},{feature:"BLOCK_SOURCE_teamPage",threshold:.5,left:44,right:45},{value:.5826717293752157},{value:.3459669582118562},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.9285714328289032,left:47,right:48},{value:.6696084874659657},{value:.7931906286870049},{feature:"PAGE_AUTHORITY_V1",threshold:.7071079015731812,left:50,right:57},{feature:"TIME_SINCE_LAST_EDIT",threshold:-.7071194350719452,left:51,right:54},{feature:"TITLE_LENGTH",threshold:.0027717105112969875,left:52,right:53},{value:.3084340622029064},{value:.20221830985915493},{feature:"TITLE_LENGTH",threshold:.0014528378378599882,left:55,right:56},{value:.19599360481519798},{value:.12874983418294833},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:58,right:61},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.3484848588705063,left:59,right:60},{value:.1674727932285369},{value:.2761101463656661},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.3229166716337204,left:62,right:63},{value:.31311018131101814},{value:.4333284274045184},{feature:"TITLE_LENGTH",threshold:-.8199742436408997,left:65,right:96},{feature:"PAGE_AUTHORITY_V1",threshold:.9987315237522125,left:66,right:81},{feature:"TIME_SINCE_LAST_EDIT",threshold:-.7075438499450684,left:67,right:74},{feature:"TERMS_COUNT_NORMALIZED",threshold:.7859025001525879,left:68,right:71},{feature:"NUMBER_OF_BLOCK_SOURCES",threshold:1.0080004930496216,left:69,right:70},{value:.6666666666666666},{value:.5572065378900446},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.8090909123420715,left:72,right:73},{value:.730962836028703},{value:.82483781278962},{feature:"TERMS_COUNT_NORMALIZED",threshold:.7750000059604645,left:75,right:78},{feature:"BLOCK_SOURCE_defaultRecordCache",threshold:.5,left:76,right:77},{value:.5598243688254665},{value:.3112244897959184},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:79,right:80},{value:.48986486486486486},{value:.6522655426765016},{feature:"TIME_SINCE_LAST_EDIT",threshold:-.9759486615657806,left:82,right:89},{feature:"IS_CREATED_BY_ME",threshold:.5,left:83,right:86},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:84,right:85},{value:.7596830985915493},{value:.8754666411409974},{feature:"TERMS_COUNT_NORMALIZED",threshold:.7750000059604645,left:87,right:88},{value:.8577648766328012},{value:.9412431085265464},{feature:"TERMS_COUNT_NORMALIZED",threshold:.9000000059604645,left:90,right:93},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.7083333432674408,left:91,right:92},{value:.7364085667215815},{value:.4639175257731959},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:94,right:95},{value:.7003610108303249},{value:.8495272810115048},{feature:"PAGE_AUTHORITY_V1",threshold:.9999995827674866,left:97,right:112},{feature:"TITLE_LENGTH",threshold:1.0038834810256958,left:98,right:105},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:99,right:102},{feature:"BLOCK_SOURCE_recentVisit",threshold:.5,left:100,right:101},{value:.18298261665141813},{value:.34929850024189646},{feature:"TIME_SINCE_LAST_EDIT",threshold:-.7071070969104767,left:103,right:104},{value:.5148422178641469},{value:.42366514623021195},{feature:"NUMBER_OF_BLOCK_SOURCES",threshold:1.3351261019706726,left:106,right:109},{feature:"TITLE_LENGTH",threshold:1.4187065362930298,left:107,right:108},{value:.2810958904109589},{value:.14157014157014158},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:110,right:111},{value:.19499105545617174},{value:.40776554596846176},{feature:"BLOCK_SOURCE_frecencyStore",threshold:.5,left:113,right:120},{feature:"PAGE_AUTHORITY_V1",threshold:1.4150558710098267,left:114,right:117},{feature:"TITLE_LENGTH",threshold:.09616653248667717,left:115,right:116},{value:.5727355901189387},{value:.4002079002079002},{feature:"TITLE_LENGTH",threshold:.36996421217918396,left:118,right:119},{value:.3089700996677741},{value:.10194174757281553},{feature:"PAGE_AUTHORITY_V1",threshold:1.000001072883606,left:121,right:124},{feature:"MATCHING_PERCENTAGE_OF_TITLE",threshold:.22649572789669037,left:122,right:123},{value:.6954795357361027},{value:.7911777488048675},{feature:"TITLE_LENGTH",threshold:-.2670345604419708,left:125,right:126},{value:.7278492480521833},{value:.5908471377647305}],x=["PAGE_AUTHORITY_V1"],M=["TIME_SINCE_LAST_EDIT"],P=["TIME_SINCE_LAST_EDIT","PAGE_AUTHORITY_V1","TITLE_LENGTH","NUMBER_OF_BLOCK_SOURCES"];class k extends Error{constructor(e,t){super(e),this.name="MathError",this.cause=void 0,this.cause=t}}function R(e){if(0===e.length)throw new Error("Can't compute std of an empty array.");const t=(0,i.J6)(e),r=(0,i.Sm)(e.map((e=>Math.pow(e-t,2))))/e.length;return Math.sqrt(r)}const w=[function(e){return{name:"NUMBER_OF_BLOCK_SOURCES",value:e.reduce(((e,t)=>{let{name:r,value:n}=t;return void 0!==n&&r.startsWith("BLOCK_SOURCE")?e+n:e}),0)}}];function O(e){return[...e,...w.map((t=>t(e)))]}const A={TIME_SINCE_LAST_EDIT:-.17725330223424154,IS_LAST_EDITED_BY_ME:.16176141450635628,IS_CREATED_BY_ME:.0593282388860205,BLOCK_SOURCE_spacePage:-.1800298837847493,BLOCK_SOURCE_recentVisit:.38019907955270416,BLOCK_SOURCE_bookmarkedPage:.2273554336295929,BLOCK_SOURCE_sharedPage:-.11405912441003871,BLOCK_SOURCE_frecencyStore:.7303811564943883,BLOCK_SOURCE_teamPage:-.3886937481702676,BLOCK_SOURCE_defaultRecordCache:-.08630181620439217,BLOCK_SOURCE_similarUser1dRecentPages:.1516065982402135,BLOCK_SOURCE_topPages7dPageView:.04024980669809112,BLOCK_SOURCE_editedPages1d:-.12760596916369363,BLOCK_SOURCE_similarUsersEditedPages1d:-.209104241796053,BLOCK_SOURCE_unknown:0,PAGE_AUTHORITY_V1:.4303514640388112,TITLE_LENGTH:-.4316382562266375,TERMS_COUNT_NORMALIZED:-.1032745452783248,FULL_MATCH_TERM_COUNT_NORMALIZED:.18313025417928205,MATCHING_PERCENTAGE_OF_TITLE:1.0003388486917193,NUMBER_OF_BLOCK_SOURCES:.7940652678793755},L=-2.48072057;function B(e){const t=e.map((e=>{let{name:t,value:r}=e;return A[t]*(r??0)}));return r=(0,i.Sm)([L,...t]),1/(1+Math.exp(-r/2));var r}function U(e){if(e.some((e=>{let{value:t}=e;return void 0===t})))return 0;const t=(0,c.m8)(e.map((e=>{let{name:t,value:r}=e;return[t,r]}))),r=[b].map((e=>I(t,e)));return(0,i.J6)([...r,B(e)])}const V=1.25,N=[_],q=0;function j(e){const{results:t,featureGroups:r}=e,n=t.map(((e,t)=>{const{block:n,score:o,personalizationBoost:i,rendered:s,terms:l}=e;return{sources:[a.vp.Local],id:n.blockModel.id,spaceId:n.blockModel.space_id,score:o,localSource:n.source,personalizationBoost:i,terms:l,highlight:{text:s},featureGroups:r[t]}})),o=function(e){const t=N.map(((t,r)=>{const n=e.map((e=>{var t;let{featureGroups:n}=e;return null===(t=n[r])||void 0===t?void 0:t.features}));if(n.some((e=>void 0===e)))return;return function(e){const t=(0,i.Xh)(e);for(const a of t)for(const e of a)(0,l.DE)(x,e.name)?e.value??=0:(0,l.DE)(M,e.name)&&(e.value=Math.log(e.value??1));const r=new Map,n=new Map,o=new Map;for(const a of t)for(const e of a)if(void 0!==e.value&&(0,l.DE)(P,e.name)){r.has(e.name)||r.set(e.name,[]);const t=r.get(e.name);t&&t.push(e.value)}for(const[a,s]of r.entries())n.set(a,(0,i.J6)(s)),o.set(a,R(s));for(const a of t)for(const e of a)if((0,l.DE)(P,e.name)){const t=n.get(e.name),r=o.get(e.name);if(void 0===e.value||void 0===t||void 0===r)throw new k(`Couldn't scale feature ${e.name}`);e.value=0===r?0:(e.value-t)/r}return t}(n.map(O)).map(U)}));if(!t.some((e=>void 0===e)))return(0,i.Ri)(t.filter(l.$K))}(n);return n.map(((e,t)=>({...e,localRelevancies:void 0!==o?o[t]:void 0})))}function F(e,t,r){const n=e=>r.matches(e.block),a=(0,o.wS)(t);if(1===a.length)return e.search(t,{filter:n,prefix:!0,fields:["text","inits"]});const i=e.search(t,{filter:n,combineWith:"AND",fields:["text"]});if(i.length>0)return i;const s=a.filter((e=>e.length>=y.Qu)),l=(c=s.length,Math.round(.6*c+.5));var c;return e.search(t,{filter:e=>e.queryTerms.length>=l&&n(e)})}function H(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function K(e){const{block:t,score:r,terms:n}=e,{source:o,text:i}=t,s=n.map(H).join("|"),l=new RegExp(s,"ig");var c;return{block:t,rendered:n.length>0?i.replaceAll(l,`${a.Um}$&${a.dK}`):i,score:r,personalizationBoost:(c=o).has("recentVisit")||c.has("frecencyStore")||c.has("bookmarkedPage")||c.has("defaultRecordCache")?V:1,terms:n}}function Z(e,t,r){const{blocks:n,getAllBlocks:o}=e,a=r.text.trim(),i=(0,s.nv)(a),l=i.length>0?i.join(" "):a,c=new d.uL(t);return l.length>0?function(e){const{blocksIndex:t,queryString:r,filterMatcher:n}=e;return F(t,r,n).map((e=>{const t=(0,y.RA)(r,e.block.text);return{...e,score:e.score*t}})).map(K)}({blocksIndex:n,queryString:l,filterMatcher:c}):o().filter((e=>c.matches(e.block))).map(K)}const G=(0,i.Ds)(((e,t)=>{t[0].featureGroups.forEach(((r,n)=>{let{groupName:o}=r;const a=t.map((e=>({features:e.featureGroups[n].features,id:e.id})));(0,u.K4)(e,"search_local_result_features",{search_session_id:v.default.state.sessionId,group_name:o,results_features:a})}))}),1e3,{leading:!1,trailing:!0});function D(e){let{query:t,localCachedPages:r,userId:n,includeRecordMap:o,environment:a,shouldUseNewRerankerDebugOverrideEnabled:s}=e;const{query:l,limit:c}=t,{filters:u,sort:h}=l,f=Z(r,u,l);if(0===f.length)return;const m=function(e,t){const{field:r}=e,n="relevance"===r||"desc"===e.direction?-1:1;switch(r){case"lastEdited":case"scroll":return(0,i.MR)(t,(e=>{let{block:{blockModel:t}}=e;return n*(t.last_edited_time||0)}));case"created":return(0,i.MR)(t,(e=>{let{block:{blockModel:t}}=e;return n*(t.created_time||0)}));default:return(0,i.MR)(t,(e=>{let{score:t}=e;return n*t}))}}(h,f),v=function(e,t,r,n){const o=new p(t,e,r);return n.map((e=>o.extractFeatureGroup(e)))}(a,N,t.query.text,m),C="relevance"===h.field,y=j({results:m,featureGroups:v}),T=y.every((e=>{let{localRelevancies:t}=e;return void 0!==t&&t.length>0&&void 0!==t[q]}))&&(s||"on"===g.default.getEligibleGroup({experimentId:"search-use-local-reranker-layered",parameter:"shouldUseLocalReranker",defaultGroup:"control"}));var _;const I=(C?T?(_=q,y.sort(((e,t)=>{let{localRelevancies:r}=e,{localRelevancies:n}=t;return(n??[])[_]-(r??[])[_]}))):(0,d.YB)({sort:h,currentUserId:n,unsorted:y,batchSize:S.Xv}):y).slice(0,c);return{total:f.length,results:I,recordMap:o??1?r.recordMap.toJson({allowVersionDowngrade:!1}):{},trackEventProperties:void 0}}function W(e){let{query:t,localCachedPages:r,parentStore:o,isOnline:s,environment:h,shouldLimitLocalResultsWhenOnline:f,canUseLtr:p,shouldUseNewRerankerDebugOverrideEnabled:S,maxLocalResultsDebugOverride:y}=e;const T=D({query:t,localCachedPages:r,userId:h.currentUser.id,environment:h,shouldUseNewRerankerDebugOverrideEnabled:S});if(!T)return;if(0===T.results.length)return{error:a.Ix.NoResults};const _=T.results.map(((e,t)=>({...e,originalPosition:t,store:m.G.createChildStore(o,{table:n.iU,id:e.id}),serverEventProperties:void 0}))),I=s&&f,E=(I?e=>(0,d.g8)(h,e,y):e=>e)(_);if(0===E.length)return{error:a.Ix.NoResults};const b=_.map((e=>{let{localRelevancies:t}=e;return t})),x=(0,i.Ri)(b.filter(l.$K)),M=x.map(i.J6),P=(0,i.Ri)(E.map((e=>{let{localRelevancies:t}=e;return t})).filter(l.$K)).map(i.J6),k=b.some(l.$K)?{...(0,c.m8)(x.map(((e,t)=>[`result_relevancies_${t}`,e]))),result_relevancies_means:M,visible_result_relevancy_means:P}:{},R=t.query.text.length>1&&p;return(0,u.K4)(h,"search_local_recall_results",{num_visible_members:(0,C.qX)(),results:_.map(Y),search_session_id:v.default.state.sessionId,num_local_results:E.length,are_results_limited:I,...k}),R&&(G(h,E),g.default.logEvent("visible_local_search_results",E.length,{resultRelevancyV1:M[0],visibleResultRelevancyV1:P[0]})),{value:{total:_.length,results:E,debugInfo:void 0}}}function Y(e){const{id:t,localSource:r}=e;return{id:t,localSource:[...r??[]]}}},278159:(e,t,r)=>{r.r(t),r.d(t,{ENGLISH_PERSONAL_PRONOUNS:()=>me,TEST_ONLY__getVisibleSpaceUserIds:()=>ve,getLocalCacheFromAppState:()=>z,isPersonalPronoun:()=>ge,searchActorsById:()=>Te,searchCollections:()=>ae,searchCollectionsWithRecents:()=>ie,searchEmailUser:()=>ye,searchInstallableIntegrations:()=>de,searchMentionablePages:()=>_e,searchPageIds:()=>X,searchPageIdsInAncestor:()=>ne,searchPagesInAncestor:()=>re,searchPagesInCollection:()=>J,searchPagesInSpace:()=>Q,searchPagesWithParent:()=>ee,searchPublicPages:()=>Ee,searchSpaceActorIds:()=>Ce,searchSpaceActors:()=>Se,searchSpaceBots:()=>le,searchSpaceGroups:()=>se,searchTeams:()=>be,searchTrashPages:()=>oe,searchUsers:()=>he,searchVisibleSpaceUsers:()=>fe});r(757658);var n=r(443261),o=r.n(n),a=r(715070),i=r(133728),s=r(977657),l=r(158573),c=r(463306),u=r(772141),d=r(145953),h=r(599405),f=r(421202),p=r(177420),g=r(606287),m=r(815047),v=r(519889),S=r(492338),C=r(364684),y=r(76233),T=r(307928),_=r(653965),I=r(307032),E=r(401898),b=r(619584),x=r(454642),M=r(398730),P=r(710274),k=r(95477),R=r(628020),w=r(304708),O=r(798165),A=r(367669),L=r(615447),B=r(897638),U=r(516639),V=r(394841),N=r(80444),q=r(319385),j=r(269327),F=r(184166),H=r(140061),K=r(206258),Z=r(176117),G=r(897630),D=r(88893),W=r(288280),Y=r(525286),$=r(596820);async function z(e){const{currentSpaceStore:t,currentSpaceViewStore:r}=N.default.state;if(!t)return;return"on"===q.default.getEligibleGroup({experimentId:"use_global_local_search_cache"})?(await M.S(e),F.Z.state.localSearchableBlocksCache):await(0,$.S)({environment:e,currentSpaceStore:t,currentSpaceViewStore:r,excludeCurrentPage:!1})}async function Q(e){const{environment:t,query:r,limit:n,currentPageId:o,searchSessionId:a,searchSessionFlowNumber:i,recentlyMentionedPageIds:s,spaceId:l,requireEditPermissions:c,excludeTemplates:u,source:h,boostRecentlyViewedPages:f,ignoresHighlight:p}=e,{currentSpaceStore:g}=N.default.state,m={results:[],recordMap:d.PF.create().toJson({allowVersionDowngrade:!1}),total:0,trackEventProperties:void 0};if(!g)return m;const v=await z(t),C=S.u4({isDeletedOnly:!1,navigableBlockContentOnly:!0,excludeTemplates:u,requireEditPermissions:c||void 0}),y={field:"relevance"};if(!r&&v){const e=(0,Y.f)({query:{query:{text:r,filters:C,sort:y},limit:n},localCachedPages:v,userId:t.currentUser.id,environment:t});return e||m}const T=await x.search(t,{type:S.n8.BlocksInSpace,query:r,spaceId:l,currentPageId:o,searchSessionId:a,searchSessionFlowNumber:i,recentlyMentionedPageIds:s,limit:n,filters:C,sort:y,source:h,recentPagesForBoosting:f?(0,L.Wk)(j.Z.getWithoutSubscribing(l)):void 0,ignoresHighlight:p});if("failed"===T.type)throw T.error;return T.data}async function X(e){const t=await Q(e);return{results:t.results.map((e=>e.id)),recordMap:t.recordMap}}async function J(e){const{environment:t,query:r,collectionId:n,limit:o,spaceId:a,excludeTemplates:i,source:s,includePublicPagesWithoutExplicitAccess:l,boostRecentlyViewedPages:c,ignoresHighlight:u}=e,d=new Array,h=await z(t),f=S.u4({isDeletedOnly:!1,navigableBlockContentOnly:!0,includePublicPagesWithoutExplicitAccess:l,excludeTemplates:i}),p={field:"relevance"},m=x.search(t,{type:S.n8.BlocksInCollection,query:r,spaceId:a,collectionId:n,limit:o,filters:f,sort:p,source:s,recentPagesForBoosting:c?(0,L.Wk)(j.Z.getWithoutSubscribing(a)):void 0,ignoresHighlight:u});if(h){const e={table:g.vF,id:n,spaceId:a},i=new K.NW(t,e);await i.load();const s=(0,Y.f)({query:{query:{text:r,filters:i.isPageTreeCollection()?{...f,ancestors:[n]}:{...f,parentId:n},sort:p},limit:o},localCachedPages:h,userId:t.currentUser.id,environment:t});s&&d.push(...s.results)}const v=await m;if("failed"===v.type){if(0===d.length)throw v.error}else{let e=v.data.results;r||(e=B.YB({sort:p,batchSize:o,currentUserId:t.currentUser.id,unsorted:e})),d.push(...e)}return{results:_.oA(_.jj(d.map((e=>e.id))))}}async function ee(e){const{environment:t,query:r,parentId:n,limit:o,spaceId:a,excludeTemplates:i,source:s,includePublicPagesWithoutExplicitAccess:l,boostRecentlyViewedPages:c,ignoresHighlight:u}=e,[d,h]=await Promise.all([x.search(t,{type:S.n8.BlocksInParent,query:r,spaceId:a,parentId:n,limit:o,filters:S.u4({isDeletedOnly:!1,navigableBlockContentOnly:!0,includePublicPagesWithoutExplicitAccess:l,excludeTemplates:i}),sort:{field:"relevance"},source:s,recentPagesForBoosting:c?(0,L.Wk)(j.Z.getWithoutSubscribing(a)):void 0,ignoresHighlight:u}),te(e)]);if("failed"===d.type)throw d.error;return{results:_.oA(_.jj([h,...d.data.results.map((e=>e.id))]))}}async function te(e){const{environment:t,query:r,parentId:n,spaceId:o}=e,a=(0,h.parseRoute)({url:r,baseUrl:k.default.domainBaseUrl,publicDomainName:k.default.publicDomainName,isMobile:t.device.isMobile,protocol:k.default.protocol,currentUrl:window.location.href}),i="page"===a.name?a.peekViewBlockId||a.blockId:void 0,s=((0,I.qn)(r)?(0,I.wr)(r):void 0)||i;if(s){const e={table:f.iU,id:s},r=new K.G(t,e);await r.load();const a=r.id,i=r.getParentId(),l=r.getSpaceId();if(i===n&&l===o)return a}}async function re(e){const{environment:t,query:r,ancestorId:n,limit:o,excludeTemplates:a,source:i,currentPageId:s,searchSessionId:l,searchSessionFlowNumber:c,recentlyMentionedPageIds:u,ignoresHighlight:d}=e,h=await x.search(t,{type:S.n8.BlocksInAncestor,query:r,ancestorId:n,filters:S.u4({navigableBlockContentOnly:!0,excludeTemplates:a}),sort:{field:"relevance"},limit:o,source:i,currentPageId:s,searchSessionId:l,searchSessionFlowNumber:c,recentlyMentionedPageIds:u,ignoresHighlight:d});if("failed"===h.type)throw h.error;return h.data}async function ne(e){return{results:(await re(e)).results.map((e=>e.id))}}async function oe(e){const{environment:t,query:r,limit:n,ancestorIds:o,spaceId:a}=e,i=0===r.trim().length?{field:"lastEdited",direction:"desc"}:{field:"relevance"},s=q.default.checkGate({gateName:"improved_trash_ui"}),l={query:r,filters:S.u4({isDeletedOnly:!0,navigableBlockContentOnly:!0,excludeTemplates:!1,editedBy:e.editedByIds||[],ancestors:e.ancestorIds||[],inTeams:e.teamspaceIds||[]}),sort:i,limit:n,spaceId:a,source:"trash"},c=o&&o.length>0&&!s?x.search(t,{type:S.n8.BlocksInAncestor,...l,ancestorId:o[0]}):x.search(t,{type:S.n8.BlocksInSpace,...l}),u=await c;if("failed"===u.type)throw u.error;{const{results:e,recordMap:t,total:r}=u.data;return{results:e.map((e=>e.id)),recordMap:d.PF.create(t),endOfResultsReached:r===e.length}}}async function ae(e,t){const{query:r,limit:n,source:o,requireEditPermissions:a,databaseType:i,spaceStore:s,searchSessionId:l}=t;if(!s)return{results:[],total:0};const c=s.id,[u,d]=await Promise.all([xe(e,{...t,spaceId:c,requireEditPermissions:a,databaseType:i,parentStore:s}),x.search(e,{type:S.n8.CollectionsInSpace,query:r,spaceId:c,limit:n,filters:{...S.u4({excludeTemplates:!0,requireEditPermissions:a,databaseType:i})},sort:{field:"relevance"},source:o,recentPagesForBoosting:(0,L.Wk)(j.Z.get(c)),searchSessionId:l})]),h=_.G0("success"===d.type?_.oA(d.data.results.map((e=>e.collectionId))):[],u).slice(0,n);return{results:h,total:"success"===d.type?d.data.total:h.length}}async function ie(e){const{environment:t,collectionViewBlockStore:r,spaceStore:n,parentStore:o,query:a,limit:i,requireEditPermissions:s,databaseType:l,searchSessionId:c}=e;if(!o.isDefaultRecordCache())return{results:[],total:0};let u=[],d=0;if(!a){const e=t.currentUser.id;n&&(u=[...P.lG({currentUserId:e,spaceId:n.id}).map((e=>K.NW.createChildStore(o,{table:g.vF,id:e})))]),u=[..._.oA(null==r?void 0:r.getCollectionViewStores().map((e=>e.getCollectionStore()))),...u],l&&(u=u.filter((e=>{const t=e.getDatabaseType();return!!t&&l.includes(t)}))),u=_.mN(u,(e=>e.id)).filter((e=>!s||e.canEdit()))}const h=await ae(t,{query:a,limit:i,source:"collection_settings_source",requireEditPermissions:s,databaseType:l,spaceStore:n,searchSessionId:c});return u=[...u,...h.results.map((e=>K.NW.createChildStore(o,{table:g.vF,id:e})))],d=h.total,u=u.filter((e=>!(0,O.wf)(e)&&e.canRead())),await Promise.all(u.map((async e=>{await e.load()}))),{results:_.mN(u,(e=>e.id)).slice(0,i).map((e=>e.id)),total:d}}function se(e){const{query:t,intl:r}=e,{currentSpaceStore:n}=N.default.state,o=null==n?void 0:n.getPermissionGroups();if(!o)return[];return t?(0,l.ZP)(t,o,(e=>(0,U.kF)({intl:r,group:e})),{normalizeFuzzyScore:!0}):o}async function le(e){const{query:t}=e,{currentSpaceStore:r}=N.default.state;if(!r)return[];return ue({parentStore:r,query:t,botIds:await ce(e)})}async function ce(e){const{environment:t}=e,{currentSpaceStore:r}=N.default.state;if(!r)return[];const n=r.id;await G.OR({environment:t,spaceId:n});const o=W.subscriptionDataStoreInstance.state;if(!o)return[];const a=(0,D.NM)(o);return _.jj(a.map((e=>e.botId)))}async function ue(e){const{parentStore:t,query:r,botIds:n}=e,o=_.oA(await Promise.all(n.map((async e=>{const r=t.table===m.bx?t.id:void 0,n=(0,K.Kv)(t,{table:p.cZ,id:e,spaceId:r});return await n.load(),n.getValue()}))));return r?(0,l.ZP)(r,o,a.y2):o}async function de(e){const{query:t,environment:r,spaceId:n,botSettings:o}=e;if(!n)return[];const a=await x.searchIntegrations(r,{query:t});if("success"===a.type){const e=a.data.integrationIds,t=o&&o.integration_approval_statuses?Object.keys(o.integration_approval_statuses):[],r=Boolean(null==o?void 0:o.integration_restrictions),n=Boolean("approved_or_built_by_notion"===(null==o?void 0:o.integration_restrictions));return r?e.filter((e=>n?t.includes(e)||(0,s.BP)({integrationId:e,env:"production"}):t.includes(e))):e}if("failed"===a.type)throw a.error;(0,E.t1)(a)}async function he(e){var t;let{parentStore:r,query:n,userIds:o,minFuzzyScore:a,placeSelfFirst:s}=e;const c=_.oA(await Promise.all(o.map((async e=>{const t=K.U6.createChildStore(r,{table:v.KJ,id:e});return await t.load(),t.getValue()}))));let u;const d=null===(t=N.default.state.currentUserStore)||void 0===t?void 0:t.userId;if(s&&d){const e=c.findIndex((e=>d===e.id));e>-1&&(u=c[e],c.splice(e,1))}const h=Z.O.state??{},f=Math.max(...Object.values(h));function p(e){var t;return e===(null===(t=N.default.state.currentUserRootStore)||void 0===t?void 0:t.userId)?f+1e-5:h[e]??0}const g=_.xb(h)?c:c.sort(((e,t)=>{const r=p(e.id);return p(t.id)-r}));if(r.table!==m.bx)return u?[u,...c]:c;const S=new Set(r.getEmailDomains()),C=n?(0,l.ZP)(n,g,T.of,{minThreshold:a,getSortScore:e=>{const{original:t,score:r}=e,n=t.email&&(0,i.Gd)(t.email);return r*(n&&S.has(n)?-2:-1)}}):c;return u?[u,...C]:C}async function fe(e){const{currentSpaceStore:t}=N.default.state;if(!t)return[];const r=e.query.startsWith("@")?e.query.slice(1):e.query,n=await pe(e);return await he({parentStore:t,query:r,userIds:n,minFuzzyScore:e.minFuzzyScore,placeSelfFirst:e.placeSelfFirst})}async function pe(e){const{environment:t,membersOnly:r}=e,{currentSpaceStore:n}=N.default.state;if(!n)return[];await G.OR({environment:t,spaceId:n.id});const o=W.subscriptionDataStoreInstance.state;if(!o)return[];const a=(0,D.CM)(o).filter((e=>!(r&&!(0,u.Jy)(e.role)))),{mainEditorCurrentBlockStore:i,currentUserStore:s}=N.default.state,l=i&&!r?(0,A.YO)(i).flatMap((e=>{let{permissionItem:t}=e;return(0,u.jg)(t)?[t.user_id]:[]})):[],c=(0,w.F$)()&&i?function(e,t){const r=O.VP(e);if(r){const e=new Set((0,C.Hf)({membership:r.getRawMembership()}));return t.filter((t=>"none"!==t.role||t.isPageGuest||t.isTeamGuest&&e.has(t.userId)))}return t.filter((e=>"none"!==e.role||e.isPageGuest))}(i,a):a,d=c.map((e=>e.userId));return _.jj([..._.oA([null==s?void 0:s.userId]),...l,...d])}function ge(e,t){return!(!t.startsWith("en-")||!me.has(e.toLowerCase()))}const me=new Set(["me","you","i"]),ve=pe;async function Se(e){const[t,r]=await Promise.all([fe(e),le(e)]);return{users:t,bots:r}}async function Ce(e){const[t,r]=await Promise.all([pe(e),ce(e)]);return{userIds:t,botIds:r}}async function ye(e,t){const r=(0,i.H3)(t);if((0,i.oH)(r)&&r){const t=await x.findUser(e,{email:r});if("failed"===t.type)throw t.error;const n=t.data;return n.value?{user:n.value.value}:{email:r}}return{}}async function Te(e){const{query:t,userIds:r,botIds:n,store:o}=e;let a=o;if(!a){const{currentSpaceStore:e}=N.default.state;if(!e)return{users:[],bots:[]};a=e}const[i,s]=await Promise.all([he({parentStore:a,query:t,userIds:r}),ue({parentStore:a,query:t,botIds:n})]);return{users:i,bots:s}}async function _e(e){const{nearBlock:t,environment:r,query:n,source:o,searchSessionId:a,searchSessionFlowNumber:i}=e,{currentSpaceStore:s}=N.default.state,l=(0,R.zj)(),c=t&&(0,A.YO)(t).find((e=>{let{permissionItem:t}=e;return(0,u.$D)(t)})),d=H.Z.getMentionedIds(r.currentUser.id);if(s){return Ie(await Q({environment:r,query:n,limit:20,spaceId:s.id,currentPageId:l,searchSessionId:a,searchSessionFlowNumber:i,recentlyMentionedPageIds:d,requireEditPermissions:!1,excludeTemplates:!0,source:o,boostRecentlyViewedPages:!0,ignoresHighlight:!0}))}if(c&&c.from.table===f.iU){return Ie(await re({environment:r,query:n,limit:20,ancestorId:c.from.blockId,excludeTemplates:!0,source:o,currentPageId:l,searchSessionId:a,searchSessionFlowNumber:i,recentlyMentionedPageIds:d,ignoresHighlight:!0}))}return[]}function Ie(e){const{trackEventProperties:t,results:r}=e,n=(0,b.m8)((0,E.qP)(t).map((e=>{let[t,r]=e;return[`server-${t}`,r]})));return r.map((e=>({...e,serverEventProperties:n})))}async function Ee(e){const{environment:t,query:r,source:n,limit:o}=e,{currentSpaceStore:a}=N.default.state;if(!a)return[];return(await Q({environment:t,query:r,limit:o||20,spaceId:a.id,requireEditPermissions:!0,excludeTemplates:!0,source:n,boostRecentlyViewedPages:!1})).results.filter((e=>{const t=K.G.createChildStore(a,{table:f.iU,id:e.id}),r=(0,O.fJ)(t);return(0,c.$t)(r)}))}async function be(e){let{spaceViewStore:t,query:r,teamStores:n}=e;const o=_.oA(await Promise.all(n.map((async e=>(await e.load(),e.getValue()))))),a=t.getTeamsStores(),i=new Set(a.map((e=>e.id)));return r?(0,l.ZP)(r,o,(e=>e.name),{getSortScore:e=>{const{original:t,score:r}=e;return r*(i.has(t.id)?-2:-1)}}):o}function xe(e,t){const{query:r,limit:n,spaceId:a,requireEditPermissions:i,databaseType:s}=t,l=[];if(n>0){const c=new AbortController;e.defaultRecordCache.inMemoryRecordCache.forEachRecord(e.currentUser.id,(e=>{let{model:d,role:h}=e;if(d.table===g.vF){const e=d.space_id===a,f=!i||(0,u.J5)(h);if(!e||!f||(0,V.Kj)(d.getParentId()))return;const p=d.getDatabaseType();if(!(!s||p&&s.includes(p)))return;const g=(0,y.QaF)(d.getName());if(!o().test(r,g))return;const m=K.NW.createChildStore(t.parentStore,d.pointer),v=O.qA(m);if(!O.fl(v))return;l.push(d.pointer.id),l.length>=n&&c.abort()}}),c.signal)}return l}},930579:(e,t,r)=>{r.d(t,{p:()=>a});r(667294);var n=r(745238),o=r(785893);const a=(0,n.IU)("aiChangeTone",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M10.0645 1.7207C11.2676 0.510742 12.8467 0.449219 14.043 1.63867C15.2461 2.82812 15.1709 4.4209 13.9541 5.61719L10.0645 1.7207ZM8.17773 14.8594C7.78809 14.8594 7.4873 14.5654 7.4873 14.1758V10.4707L4.07617 13.6357C3.78223 13.9023 3.39258 13.9365 3.04395 13.6016L1.89551 14.5107C1.73828 14.627 1.54688 14.6201 1.41016 14.4766L1.21191 14.2783C1.06836 14.1348 1.06152 13.9365 1.1709 13.7998L2.07324 12.6445C1.74512 12.2891 1.77246 11.8994 2.0459 11.6055L8.38965 4.7832C8.30078 3.9834 8.61523 3.16992 9.32617 2.45898L13.2158 6.35547C12.5117 7.06641 11.6846 7.40137 10.8916 7.3125L8.875 9.17871L8.86816 14.1758C8.86816 14.5654 8.56055 14.8594 8.17773 14.8594ZM2.87988 12.1934L3.49512 12.8086L9.72949 6.875C9.55859 6.76562 9.38086 6.62207 9.22363 6.45801C9.05957 6.28711 8.92969 6.11621 8.81348 5.9248L2.87988 12.1934Z"})})},941886:(e,t,r)=>{r.d(t,{y:()=>a});r(667294);var n=r(745238),o=r(785893);const a=(0,n.IU)("aiExplainThis",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M8 15.126C4.1377 15.126 0.938477 11.9336 0.938477 8.06445C0.938477 4.20215 4.13086 1.00293 7.99316 1.00293C11.8623 1.00293 15.0615 4.20215 15.0615 8.06445C15.0615 11.9336 11.8623 15.126 8 15.126ZM8 13.7383C11.1445 13.7383 13.6738 11.209 13.6738 8.06445C13.6738 4.91992 11.1377 2.39746 7.99316 2.39746C4.84863 2.39746 2.33301 4.91992 2.33301 8.06445C2.33301 11.209 4.85547 13.7383 8 13.7383ZM7.84277 9.4248C7.43262 9.4248 7.2002 9.22656 7.2002 8.84375V8.76855C7.2002 8.14648 7.55566 7.79102 8.04102 7.45605C8.62207 7.05273 8.90918 6.84082 8.90918 6.41016C8.90918 5.94531 8.5332 5.61719 7.97949 5.61719C7.56934 5.61719 7.24121 5.81543 7.01562 6.19141L6.90625 6.32812C6.76953 6.5127 6.60547 6.61523 6.35254 6.61523C6.0791 6.61523 5.81934 6.41016 5.81934 6.08203C5.81934 5.95898 5.83984 5.84277 5.88086 5.72656C6.09277 5.08398 6.89258 4.55078 8.06152 4.55078C9.27148 4.55078 10.2969 5.2002 10.2969 6.3418C10.2969 7.13477 9.85938 7.52441 9.18945 7.96875C8.74512 8.25586 8.49902 8.49512 8.47852 8.85059C8.47852 8.87109 8.47852 8.90527 8.47852 8.93262C8.45801 9.21289 8.21875 9.4248 7.84277 9.4248ZM7.83594 11.5234C7.39844 11.5234 7.03613 11.2021 7.03613 10.7715C7.03613 10.3477 7.3916 10.0264 7.83594 10.0264C8.27344 10.0264 8.63574 10.3408 8.63574 10.7715C8.63574 11.2021 8.27344 11.5234 7.83594 11.5234Z"})})},427245:(e,t,r)=>{r.d(t,{U:()=>a});r(667294);var n=r(745238),o=r(785893);const a=(0,n.IU)("aiFixSpellingGrammar",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M6.57812 14.1621C6.23633 14.1621 5.9834 14.0186 5.74414 13.7246L2.20312 9.29492C2.03223 9.08301 1.95703 8.88477 1.95703 8.67969C1.95703 8.20801 2.30566 7.86621 2.78418 7.86621C3.08496 7.86621 3.29004 7.97559 3.48828 8.24219L6.55078 12.1729L12.4912 2.73926C12.6963 2.41797 12.8945 2.30176 13.2295 2.30176C13.708 2.30176 14.0361 2.62988 14.0361 3.10156C14.0361 3.28613 13.9814 3.47754 13.8379 3.69629L7.41211 13.7178C7.21387 14.0117 6.94043 14.1621 6.57812 14.1621Z"})})},707500:(e,t,r)=>{r.d(t,{H:()=>a});r(667294);var n=r(745238),o=r(785893);const a=(0,n.IU)("aiMakeLonger",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M1.56738 3.25879C1.22559 3.25879 0.952148 2.97852 0.952148 2.63672C0.952148 2.29492 1.21875 2.02148 1.56738 2.02148H14.4258C14.7744 2.02148 15.0479 2.29492 15.0479 2.63672C15.0479 2.97852 14.7676 3.25879 14.4258 3.25879H1.56738ZM1.56738 6.84082C1.22559 6.84082 0.952148 6.56055 0.952148 6.21875C0.952148 5.87695 1.21875 5.60352 1.56738 5.60352H14.4258C14.7744 5.60352 15.0479 5.87695 15.0479 6.21875C15.0479 6.56055 14.7676 6.84082 14.4258 6.84082H1.56738ZM1.56738 10.4229C1.22559 10.4229 0.952148 10.1426 0.952148 9.80078C0.952148 9.45898 1.21875 9.18555 1.56738 9.18555H14.4258C14.7744 9.18555 15.0479 9.45898 15.0479 9.80078C15.0479 10.1426 14.7676 10.4229 14.4258 10.4229H1.56738ZM1.56738 14.0049C1.22559 14.0049 0.952148 13.7246 0.952148 13.3828C0.952148 13.041 1.21875 12.7676 1.56738 12.7676H8.75879C9.10742 12.7676 9.38086 13.041 9.38086 13.3828C9.38086 13.7246 9.10059 14.0049 8.75879 14.0049H1.56738Z"})})},831157:(e,t,r)=>{r.d(t,{f:()=>a});r(667294);var n=r(745238),o=r(785893);const a=(0,n.IU)("aiMakeShorter",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M1.55371 6.81055C1.21875 6.81055 0.952148 6.54395 0.952148 6.20898C0.952148 5.87402 1.21875 5.60742 1.55371 5.60742H14.4395C14.7744 5.60742 15.0479 5.87402 15.0479 6.20898C15.0479 6.54395 14.7744 6.81055 14.4395 6.81055H1.55371ZM1.55371 10.3926C1.21875 10.3926 0.952148 10.126 0.952148 9.79102C0.952148 9.45605 1.21875 9.18945 1.55371 9.18945H9.2168C9.55176 9.18945 9.81836 9.45605 9.81836 9.79102C9.81836 10.126 9.55176 10.3926 9.2168 10.3926H1.55371Z"})})},825879:(e,t,r)=>{r.d(t,{b:()=>a});r(667294);var n=r(745238),o=r(785893);const a=(0,n.IU)("assistBrainstormIdeas",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M3.37915 4.3186C3.37915 6.77734 4.81616 7.63428 5.17212 11.7607C5.20508 12.2024 5.48853 12.4661 5.93018 12.4661H10.0632C10.5049 12.4661 10.7883 12.2024 10.8213 11.7607C11.1772 7.63428 12.6208 6.78394 12.6208 4.3186C12.6208 1.88623 10.5444 0.0471191 7.99341 0.0471191C5.44897 0.0471191 3.37915 1.87964 3.37915 4.3186ZM4.80957 4.3186C4.80957 2.64429 6.27295 1.47754 7.99341 1.47754C9.72046 1.47754 11.1904 2.64429 11.1904 4.3186C11.1904 5.95337 10.0369 6.46753 9.50952 11.0356H6.48389C5.95654 6.46753 4.80957 5.95337 4.80957 4.3186ZM5.8313 14.1799H10.1621C10.439 14.1799 10.6565 13.9492 10.6565 13.6921C10.6565 13.4285 10.439 13.2043 10.1621 13.2043H5.8313C5.55444 13.2043 5.33691 13.4285 5.33691 13.6921C5.33691 13.9492 5.55444 14.1799 5.8313 14.1799ZM7.99341 16.2168C9.08105 16.2168 9.90503 15.7026 9.97754 14.9182H5.99609C6.06201 15.7026 6.91235 16.2168 7.99341 16.2168Z"})})},145366:(e,t,r)=>{r.d(t,{wS:()=>a});var n=r(653965);const o=/[-./\\()"'’‘”“，。、·～；,;<>~!@#$%^&*|+=[\]{}`~?:\s]/u;function a(e){return(0,n.oA)(e.split(o))}}}]);