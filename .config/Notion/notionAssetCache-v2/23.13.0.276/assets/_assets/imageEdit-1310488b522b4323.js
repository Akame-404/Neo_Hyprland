"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[78138],{718250:(e,t,i)=>{i.d(t,{K:()=>a,O:()=>o});var n=i(745483);function o(e){n.Z.state.openModals.has(e)||(n.Z.state.openModals.add(e),n.Z.emit())}function a(e){n.Z.state.openModals.has(e)&&(n.Z.state.openModals.delete(e),n.Z.emit())}},894517:(e,t,i)=>{i.r(t),i.d(t,{ImageEditModal:()=>ue,imageEditActions:()=>n,makeAspectCrop:()=>b});var n={};i.r(n),i.d(n,{MIN_CROP_SIZE:()=>m,cropAndUploadImage:()=>C,uploadCroppedImage:()=>x});i(21703);var o=i(895538),a=i(471924),r=i(76233),s=i(496802),d=i(709953),h=i(210228),c=i(353471),l=i(110906),p=i(273024),g=i(27411),u=i(185529);const w=2e3,m=100;async function C(e){const{store:t,environment:i,proxiedOriginalUrl:n}=e;u.Z.setStatusDrawing(t.id);const a=await async function(e){const{store:t,proxiedOriginalUrl:i}=e,n=document.createElement("canvas"),o=n.getContext("2d");if(!o)throw Error("drawEditsToCanvas: missing 2d context");const a=u.Z.getMetadataByBlockId(t.id);if(!a)throw Error("attempted to crop without setting ImageEditStore first");const r=await new Promise(((e,t)=>{const n=new Image;n.onload=()=>e(n),n.onerror=()=>{t()},n.src=i}));let s=function(e){const t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("drawInitialCanvas: missing 2d context");const n=Math.min(w,e.naturalWidth),o=n/e.naturalWidth,a=e.naturalHeight*o;return t.width=n,t.height=a,i.drawImage(e,0,0,n,a),t}(r);const{crop:d,mask:h}=a;s=function(e,t){const i=document.createElement("canvas"),n=i.getContext("2d");if(!n)throw new Error("applyCropToCanvas: missing 2d context");const o=e.width*t.x/100,a=e.height*t.y/100,r=e.width*t.width/100,s=e.height*t.height/100;return i.width=r,i.height=s,n.drawImage(e,-o,-a),i}(s,d),"Circle"===h&&(s=function(e){const t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("applyCircleMaskToCanvas: missing 2d context");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i.globalCompositeOperation="destination-in",i.fillStyle="#000",i.beginPath(),i.arc(.5*e.width,.5*e.height,.5*e.width,0,2*Math.PI),i.fill(),t}(s));return n.style.width=`${s.width}px`,n.style.height=`${s.height}px`,n.width=s.width,n.height=s.height,o.drawImage(s,0,0,s.width,s.height),n}({store:t,proxiedOriginalUrl:n});u.Z.setStatusUploading(t.id,a.toDataURL());const r=a.width/a.height;let s=p.Z.getWidth((0,l.en)(t))??o.TT,d=s/r;if(d>o.QA){const e=d/o.QA;s/=e,d/=e}return x({canvas:a,store:t,environment:i,newBlockWidth:s,newBlockHeight:d,onUploadComplete:e=>u.Z.setStatusCompleted(t.id,e),onUploadError:()=>u.Z.setStatusError(t.id)})}async function x(e){const{environment:t,canvas:i,store:n,newBlockWidth:o,newBlockHeight:l}=e,p="image/png",w=await new Promise(((e,t)=>{i.toBlob((i=>{i?e(i):t()}),p,1)})),m=new File([w],`${a.Il()}.png`,{type:p}),C=g.default.getBlockKey(n.id);c.cT({environment:t,file:m,bucket:"secure",record:n.pointer,onStart:e=>{g.default.setKeyState(C,{progressPercent:0,file:m,name:e.name,size:e.size})},onProgress:e=>{const t=g.default.getKeyState(C);t&&g.default.setKeyState(C,{...t,progressPercent:e.progressPercent})},onComplete:i=>{var a;const c=n.getOriginalImageSource(),p=u.Z.getMetadataByBlockId(n.id);if(!p)throw Error("Missing edit metadata on format update!");if(!c)throw Error("Missing original image source on format update!");h.createAndCommit({userAction:"embedBlockActions.uploadEditedImage",environment:t,perform:e=>{s.FH({stores:[n],update:{display_source:i,original_source:c,image_edit_metadata:p,block_width:o,block_height:l,block_aspect_ratio:l/o},transaction:e}),d.sW({store:n.getPropertiesStore(),data:{source:r.TPx(i)},transaction:e})}}),g.default.setKeyState(C,void 0),null===(a=e.onUploadComplete)||void 0===a||a.call(e,i)},onError:t=>{var i;g.default.setKeyState(C,void 0),null===(i=e.onUploadError)||void 0===i||i.call(e)}})}var y=i(667294);const v={x:0,y:0,width:0,height:0,unit:"px"},f=(e,t,i)=>Math.min(Math.max(e,t),i),k=(e,t)=>e===t||e.width===t.width&&e.height===t.height&&e.x===t.x&&e.y===t.y&&e.unit===t.unit;function b(e,t,i,n){const o=D(e,i,n);return e.width&&(o.height=o.width/t),e.height&&(o.width=o.height*t),o.y+o.height>n&&(o.height=n-o.y,o.width=o.height*t),o.x+o.width>i&&(o.width=i-o.x,o.height=o.width/t),"%"===e.unit?M(o,i,n):o}function M(e,t,i){return"%"===e.unit?{...v,...e,unit:"%"}:{unit:"%",x:e.x?e.x/t*100:0,y:e.y?e.y/i*100:0,width:e.width?e.width/t*100:0,height:e.height?e.height/i*100:0}}function D(e,t,i){return e.unit?"px"===e.unit?{...v,...e,unit:"px"}:{unit:"px",x:e.x?e.x*t/100:0,y:e.y?e.y*i/100:0,width:e.width?e.width*t/100:0,height:e.height?e.height*i/100:0}:{...v,...e,unit:"px"}}function S(e,t,i,n,o,a=0,r=0,s=n,d=o){const h={...e};let c=Math.min(a,n),l=Math.min(r,o),p=Math.min(s,n),g=Math.min(d,o);t&&(t>1?(c=r?r*t:c,l=c/t,p=s*t):(l=a?a/t:l,c=l*t,g=d/t)),h.y<0&&(h.height=Math.max(h.height+h.y,l),h.y=0),h.x<0&&(h.width=Math.max(h.width+h.x,c),h.x=0);const u=n-(h.x+h.width);u<0&&(h.x=Math.min(h.x,n-c),h.width+=u);const w=o-(h.y+h.height);if(w<0&&(h.y=Math.min(h.y,o-l),h.height+=w),h.width<c&&(("sw"===i||"nw"==i)&&(h.x-=c-h.width),h.width=c),h.height<l&&(("nw"===i||"ne"==i)&&(h.y-=l-h.height),h.height=l),h.width>p&&(("sw"===i||"nw"==i)&&(h.x-=p-h.width),h.width=p),h.height>g&&(("nw"===i||"ne"==i)&&(h.y-=g-h.height),h.height=g),t){const e=h.width/h.height;if(e<t){const e=Math.max(h.width/t,l);("nw"===i||"ne"==i)&&(h.y-=e-h.height),h.height=e}else if(e>t){const e=Math.max(h.height*t,c);("sw"===i||"nw"==i)&&(h.x-=e-h.width),h.width=e}}return h}const E={capture:!0,passive:!1};let I=0;const R=class e extends y.PureComponent{constructor(){super(...arguments),this.docMoveBound=!1,this.mouseDownOnCrop=!1,this.dragStarted=!1,this.evData={startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0},this.componentRef=(0,y.createRef)(),this.mediaRef=(0,y.createRef)(),this.initChangeCalled=!1,this.instanceId="rc-"+I++,this.state={cropIsActive:!1,newCropIsBeingDrawn:!1},this.onCropPointerDown=e=>{const{crop:t,disabled:i}=this.props,n=this.getBox();if(!t)return;const o=D(t,n.width,n.height);if(i)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const a=e.target.dataset.ord,r=!!a;let s=e.clientX,d=e.clientY,h=o.x,c=o.y;if(a){const t=e.clientX-n.x,i=e.clientY-n.y;let r=0,l=0;"ne"===a||"e"==a?(r=t-(o.x+o.width),l=i-o.y,h=o.x,c=o.y+o.height):"se"===a||"s"===a?(r=t-(o.x+o.width),l=i-(o.y+o.height),h=o.x,c=o.y):"sw"===a||"w"==a?(r=t-o.x,l=i-(o.y+o.height),h=o.x+o.width,c=o.y):("nw"===a||"n"==a)&&(r=t-o.x,l=i-o.y,h=o.x+o.width,c=o.y+o.height),s=h+n.x+r,d=c+n.y+l}this.evData={startClientX:s,startClientY:d,startCropX:h,startCropY:c,clientX:e.clientX,clientY:e.clientY,isResize:r,ord:a},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})},this.onComponentPointerDown=e=>{const{crop:t,disabled:i,locked:n,keepSelection:o,onChange:a}=this.props,r=this.getBox();if(i||n||o&&t)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const s=e.clientX-r.x,d=e.clientY-r.y,h={unit:"px",x:s,y:d,width:0,height:0};this.evData={startClientX:e.clientX,startClientY:e.clientY,startCropX:s,startCropY:d,clientX:e.clientX,clientY:e.clientY,isResize:!0},this.mouseDownOnCrop=!0,a(D(h,r.width,r.height),M(h,r.width,r.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})},this.onDocPointerMove=e=>{const{crop:t,disabled:i,onChange:n,onDragStart:o}=this.props,a=this.getBox();if(i||!t||!this.mouseDownOnCrop)return;e.cancelable&&e.preventDefault(),this.dragStarted||(this.dragStarted=!0,o&&o(e));const{evData:r}=this;let s;r.clientX=e.clientX,r.clientY=e.clientY,s=r.isResize?this.resizeCrop():this.dragCrop(),k(t,s)||n(D(s,a.width,a.height),M(s,a.width,a.height))},this.onComponentKeyDown=t=>{const{crop:i,disabled:n,onChange:o,onComplete:a}=this.props;if(n)return;const r=t.key;let s=!1;if(!i)return;const d=this.getBox(),h=this.makePixelCrop(d),c=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?e.nudgeStepLarge:t.shiftKey?e.nudgeStepMedium:e.nudgeStep;if("ArrowLeft"===r?(h.x-=c,s=!0):"ArrowRight"===r?(h.x+=c,s=!0):"ArrowUp"===r?(h.y-=c,s=!0):"ArrowDown"===r&&(h.y+=c,s=!0),s){t.cancelable&&t.preventDefault(),h.x=f(h.x,0,d.width-h.width),h.y=f(h.y,0,d.height-h.height);const e=D(h,d.width,d.height),i=M(h,d.width,d.height);o(e,i),a&&a(e,i)}},this.onHandlerKeyDown=(t,i)=>{const{aspect:n=0,crop:o,disabled:a,minWidth:r=0,minHeight:s=0,maxWidth:d,maxHeight:h,onChange:c,onComplete:l}=this.props,p=this.getBox();if(a||!o)return;if("ArrowUp"!==t.key&&"ArrowDown"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key)return;t.stopPropagation(),t.preventDefault();const g=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?e.nudgeStepLarge:t.shiftKey?e.nudgeStepMedium:e.nudgeStep,u=function(e,t,i,n){const o={...e};return"ArrowLeft"===t?"nw"===n?(o.x-=i,o.y-=i,o.width+=i,o.height+=i):"w"===n?(o.x-=i,o.width+=i):"sw"===n?(o.x-=i,o.width+=i,o.height+=i):"ne"===n?(o.y+=i,o.width-=i,o.height-=i):"e"===n?o.width-=i:"se"===n&&(o.width-=i,o.height-=i):"ArrowRight"===t&&("nw"===n?(o.x+=i,o.y+=i,o.width-=i,o.height-=i):"w"===n?(o.x+=i,o.width-=i):"sw"===n?(o.x+=i,o.width-=i,o.height-=i):"ne"===n?(o.y-=i,o.width+=i,o.height+=i):"e"===n?o.width+=i:"se"===n&&(o.width+=i,o.height+=i)),"ArrowUp"===t?"nw"===n?(o.x-=i,o.y-=i,o.width+=i,o.height+=i):"n"===n?(o.y-=i,o.height+=i):"ne"===n?(o.y-=i,o.width+=i,o.height+=i):"sw"===n?(o.x+=i,o.width-=i,o.height-=i):"s"===n?o.height-=i:"se"===n&&(o.width-=i,o.height-=i):"ArrowDown"===t&&("nw"===n?(o.x+=i,o.y+=i,o.width-=i,o.height-=i):"n"===n?(o.y+=i,o.height-=i):"ne"===n?(o.y+=i,o.width-=i,o.height-=i):"sw"===n?(o.x-=i,o.width+=i,o.height+=i):"s"===n?o.height+=i:"se"===n&&(o.width+=i,o.height+=i)),o}(D(o,p.width,p.height),t.key,g,i),w=S(u,n,i,p.width,p.height,r,s,d,h);if(!k(o,w)){const e=M(w,p.width,p.height);c(w,e),l&&l(w,e)}},this.onDocPointerDone=e=>{const{crop:t,disabled:i,onComplete:n,onDragEnd:o}=this.props,a=this.getBox();this.unbindDocMove(),!i&&t&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,o&&o(e),n&&n(D(t,a.width,a.height),M(t,a.width,a.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))},this.onDragFocus=()=>{var e;null==(e=this.componentRef.current)||e.scrollTo(0,0)}}get document(){return document}getBox(){const e=this.mediaRef.current;if(!e)return{x:0,y:0,width:0,height:0};const{x:t,y:i,width:n,height:o}=e.getBoundingClientRect();return{x:t,y:i,width:n,height:o}}componentDidUpdate(e){const{crop:t,onComplete:i}=this.props;if(i&&!e.crop&&t){const{width:e,height:n}=this.getBox();e&&n&&i(D(t,e,n),M(t,e,n))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,E),this.document.addEventListener("pointerup",this.onDocPointerDone,E),this.document.addEventListener("pointercancel",this.onDocPointerDone,E),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,E),this.document.removeEventListener("pointerup",this.onDocPointerDone,E),this.document.removeEventListener("pointercancel",this.onDocPointerDone,E),this.docMoveBound=!1)}getCropStyle(){const{crop:e}=this.props;if(e)return{top:`${e.y}${e.unit}`,left:`${e.x}${e.unit}`,width:`${e.width}${e.unit}`,height:`${e.height}${e.unit}`}}dragCrop(){const{evData:e}=this,t=this.getBox(),i=this.makePixelCrop(t),n=e.clientX-e.startClientX,o=e.clientY-e.startClientY;return i.x=f(e.startCropX+n,0,t.width-i.width),i.y=f(e.startCropY+o,0,t.height-i.height),i}getPointRegion(e,t,i,n){const{evData:o}=this,a=o.clientX-e.x,r=o.clientY-e.y;let s,d;return s=n&&t?"nw"===t||"n"===t||"ne"===t:r<o.startCropY,d=i&&t?"nw"===t||"w"===t||"sw"===t:a<o.startCropX,d?s?"nw":"sw":s?"ne":"se"}resolveMinDimensions(e,t,i=0,n=0){const o=Math.min(i,e.width),a=Math.min(n,e.height);return t&&(o||a)?t>1?o?[o,o/t]:[a*t,a]:a?[a*t,a]:[o,o/t]:[o,a]}resizeCrop(){const{evData:t}=this,{aspect:i=0,maxWidth:n,maxHeight:o}=this.props,a=this.getBox(),[r,s]=this.resolveMinDimensions(a,i,this.props.minWidth,this.props.minHeight);let d=this.makePixelCrop(a);const h=this.getPointRegion(a,t.ord,r,s),c=t.ord||h;let l=t.clientX-t.startClientX,p=t.clientY-t.startClientY;(r&&"nw"===c||"w"===c||"sw"===c)&&(l=Math.min(l,-r)),(s&&"nw"===c||"n"===c||"ne"===c)&&(p=Math.min(p,-s));const g={unit:"px",x:0,y:0,width:0,height:0};"ne"===h?(g.x=t.startCropX,g.width=l,i?(g.height=g.width/i,g.y=t.startCropY-g.height):(g.height=Math.abs(p),g.y=t.startCropY-g.height)):"se"===h?(g.x=t.startCropX,g.y=t.startCropY,g.width=l,g.height=i?g.width/i:p):"sw"===h?(g.x=t.startCropX+l,g.y=t.startCropY,g.width=Math.abs(l),g.height=i?g.width/i:p):"nw"===h&&(g.x=t.startCropX+l,g.width=Math.abs(l),i?(g.height=g.width/i,g.y=t.startCropY-g.height):(g.height=Math.abs(p),g.y=t.startCropY+p));const u=S(g,i,h,a.width,a.height,r,s,n,o);return i||e.xyOrds.indexOf(c)>-1?d=u:e.xOrds.indexOf(c)>-1?(d.x=u.x,d.width=u.width):e.yOrds.indexOf(c)>-1&&(d.y=u.y,d.height=u.height),d.x=f(d.x,0,a.width-d.width),d.y=f(d.y,0,a.height-d.height),d}renderCropSelection(){const{ariaLabels:t=e.defaultProps.ariaLabels,disabled:i,locked:n,renderSelectionAddon:o,ruleOfThirds:a,crop:r}=this.props,s=this.getCropStyle();if(r)return y.createElement("div",{style:s,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":t.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!i&&!n&&y.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},y.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),y.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),y.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),y.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":t.nwDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"nw"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":t.nDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"n"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":t.neDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"ne"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":t.eDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"e"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":t.seDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"se"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":t.sDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"s"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":t.swDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"sw"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":t.wDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"w"),role:"button"})),o&&y.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:e=>e.stopPropagation()},o(this.state)),a&&y.createElement(y.Fragment,null,y.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),y.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(e){return D({...v,...this.props.crop||{}},e.width,e.height)}render(){const{aspect:e,children:t,circularCrop:i,className:n,crop:o,disabled:a,locked:r,style:s,ruleOfThirds:d}=this.props,{cropIsActive:h,newCropIsBeingDrawn:c}=this.state,l=o?this.renderCropSelection():null,p=((...e)=>e.filter((e=>e&&"string"==typeof e)).join(" "))("ReactCrop",n,h&&"ReactCrop--active",a&&"ReactCrop--disabled",r&&"ReactCrop--locked",c&&"ReactCrop--new-crop",o&&e&&"ReactCrop--fixed-aspect",o&&i&&"ReactCrop--circular-crop",o&&d&&"ReactCrop--rule-of-thirds",!this.dragStarted&&o&&!o.width&&!o.height&&"ReactCrop--invisible-crop",i&&"ReactCrop--no-animate");return y.createElement("div",{ref:this.componentRef,className:p,style:s},y.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},t),o?y.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},y.createElement("defs",null,y.createElement("mask",{id:`hole-${this.instanceId}`},y.createElement("rect",{width:"100%",height:"100%",fill:"white"}),i?y.createElement("ellipse",{cx:`${o.x+o.width/2}${o.unit}`,cy:`${o.y+o.height/2}${o.unit}`,rx:`${o.width/2}${o.unit}`,ry:`${o.height/2}${o.unit}`,fill:"black"}):y.createElement("rect",{x:`${o.x}${o.unit}`,y:`${o.y}${o.unit}`,width:`${o.width}${o.unit}`,height:`${o.height}${o.unit}`,fill:"black"}))),y.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,l)}};R.xOrds=["e","w"],R.yOrds=["n","s"],R.xyOrds=["nw","ne","se","sw"],R.nudgeStep=1,R.nudgeStepMedium=10,R.nudgeStepLarge=100,R.defaultProps={ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}};let Z=R;var j=i(800480),_=i(886628),P=i(724405),B=i(151454),H=i(709291),K=i(568785),A=i(550506),L=i(804827),O=i(489728),$=i(158297),W=i(81865),V=i(433929),z=i(319385),U=i(364424),Y=i(553824),X=i(542853),N=i(57851),F=i(745238),T=i(785893);const G=(0,F.IU)("squareOnCircleFilled",{viewBox:"0 0 20 20",svg:(0,T.jsx)("path",{d:"M4.53809 13.4795V6.56836C4.53809 5.83464 4.72721 5.28092 5.10547 4.90723C5.48372 4.53353 6.04427 4.34668 6.78711 4.34668H13.6504C14.3887 4.34668 14.9469 4.53353 15.3252 4.90723C15.7035 5.28092 15.8926 5.83464 15.8926 6.56836V13.4795C15.8926 14.2132 15.7035 14.7669 15.3252 15.1406C14.9469 15.5143 14.3887 15.7012 13.6504 15.7012H6.78711C6.04427 15.7012 5.48372 15.5143 5.10547 15.1406C4.72721 14.7669 4.53809 14.2132 4.53809 13.4795ZM6.78711 3.34863C6.10807 3.34863 5.52474 3.47852 5.03711 3.73828C4.55404 3.99349 4.1849 4.36263 3.92969 4.8457C3.67448 5.32422 3.54688 5.89844 3.54688 6.56836V11.4629C2.85872 11.1621 2.25033 10.7451 1.72168 10.2119C1.19303 9.67871 0.780599 9.06348 0.484375 8.36621C0.188151 7.66439 0.0400391 6.91471 0.0400391 6.11719C0.0400391 5.3151 0.19043 4.56315 0.491211 3.86133C0.791992 3.15951 1.20898 2.54199 1.74219 2.00879C2.27539 1.47559 2.8929 1.05859 3.59473 0.757812C4.30111 0.452474 5.05534 0.299805 5.85742 0.299805C6.59115 0.299805 7.28385 0.429688 7.93555 0.689453C8.58724 0.944661 9.17057 1.30241 9.68555 1.7627C10.2051 2.21842 10.6289 2.74707 10.957 3.34863H6.78711Z"})});var q=i(698519),Q=i(552275),J=i(231945),ee=i(478140),te=i(685740),ie=i(672495),ne=i(460709),oe=i(825464);const ae=(0,F.IU)("rectLandscape",{viewBox:"0 0 16 16",svg:(0,T.jsx)("path",{d:"M3.076 2.97h9.842c.629 0 1.105.16 1.43.48.328.321.492.796.492 1.425v6.24c0 .629-.164 1.103-.492 1.424-.325.32-.801.48-1.43.48H3.076c-.633 0-1.111-.16-1.435-.48-.325-.32-.487-.795-.487-1.424v-6.24c0-.63.162-1.104.487-1.424.324-.32.802-.48 1.435-.48zm.07 1.155c-.269 0-.476.07-.62.21-.145.141-.217.354-.217.64v6.046c0 .285.072.498.216.639.145.14.352.21.621.21h9.696c.273 0 .482-.07.627-.21.148-.141.222-.354.222-.639V4.974c0-.285-.074-.498-.222-.639-.145-.14-.354-.21-.627-.21H3.146z"})}),re=(0,F.IU)("rectLandscapeChecked",{viewBox:"0 0 16 16",svg:(0,T.jsx)("path",{fillRule:"evenodd",d:"M12.918 2.97H3.076c-.633 0-1.111.16-1.435.48-.325.321-.487.796-.487 1.425v6.24c0 .629.162 1.103.487 1.424.324.32.802.48 1.435.48h9.842c.629 0 1.105-.16 1.43-.48.328-.32.492-.795.492-1.424v-6.24c0-.63-.164-1.104-.492-1.424-.325-.32-.801-.48-1.43-.48zm-5.967 7.377a.569.569 0 00.454.217c.201 0 .356-.08.463-.237l2.728-4.175a.745.745 0 00.082-.17.516.516 0 00.026-.158.456.456 0 00-.138-.34.478.478 0 00-.348-.135.472.472 0 00-.243.059.593.593 0 00-.188.193L7.394 9.383l-1.22-1.508a.483.483 0 00-.389-.19.482.482 0 00-.351.137.46.46 0 00-.138.343c0 .06.01.119.032.175a.595.595 0 00.111.176l1.512 1.831z",clipRule:"evenodd"})}),se=(0,F.IU)("rectPortait",{viewBox:"0 0 16 16",svg:(0,T.jsx)("path",{d:"M2.973 12.918v-9.84c0-.63.16-1.106.48-1.43.32-.328.795-.492 1.424-.492h6.24c.63 0 1.104.164 1.424.492.32.324.48.8.48 1.43v9.841c0 .633-.16 1.112-.48 1.436-.32.324-.795.486-1.424.486h-6.24c-.629 0-1.104-.162-1.424-.486-.32-.324-.48-.803-.48-1.435zm1.154-.07c0 .27.07.477.21.621.142.145.354.217.64.217h6.046c.286 0 .498-.072.64-.217.14-.144.21-.351.21-.62V3.152c0-.274-.07-.483-.21-.627-.142-.149-.354-.223-.64-.223H4.977c-.286 0-.498.074-.64.223-.14.144-.21.353-.21.627v9.695z"})}),de=(0,F.IU)("rectPortaitChecked",{viewBox:"0 0 16 16",svg:(0,T.jsx)("path",{fillRule:"evenodd",d:"M2.973 3.072v9.842c0 .632.16 1.11.48 1.435.32.324.795.486 1.424.486h6.24c.63 0 1.104-.162 1.424-.486.32-.324.48-.803.48-1.435V3.072c0-.63-.16-1.106-.48-1.43-.32-.328-.795-.492-1.424-.492h-6.24c-.629 0-1.104.164-1.424.492-.32.324-.48.8-.48 1.43zm3.978 7.273a.568.568 0 00.454.216.526.526 0 00.463-.237l2.728-4.175a.745.745 0 00.082-.17.516.516 0 00.026-.158.456.456 0 00-.138-.34.478.478 0 00-.348-.134.472.472 0 00-.243.058.593.593 0 00-.188.194L7.394 9.38l-1.22-1.509a.483.483 0 00-.389-.19.482.482 0 00-.351.137.46.46 0 00-.138.343c0 .06.01.12.032.176a.595.595 0 00.111.176l1.512 1.83z",clipRule:"evenodd"})});var he=i(318970),ce=i(573063);function le(e){const{aspectRatio:t,flipped:i,rowIsSelected:n}=e,o=(0,y.useMemo)((()=>n&&i?de:se),[i,n]),a=(0,y.useMemo)((()=>n?i?ae:re:ae),[i,n]);return(0,T.jsxs)("div",{style:{transform:"translate(5px, 0px)"},children:[(0,T.jsx)(ce.Z,{icon:o,iconStyle:{width:16,height:16},ariaLabel:`${t} aspect ratio flipped`,onClick:()=>U.Z.setFixedAspectRatio(t,!0)}),(0,T.jsx)(ce.Z,{icon:a,iconStyle:{width:16,height:16},ariaLabel:`${t} aspect ratio`,onClick:()=>U.Z.setFixedAspectRatio(t,!1)})]})}const pe=function(e){const t=(0,_.VK)((()=>{if(U.Z.state.open)return U.Z.state.fixedAspectSelection}),[]),i=(0,_.VK)((()=>!!U.Z.state.open&&U.Z.state.aspectSelectionFlipped),[]),n=(0,_.VK)((()=>z.default.checkGate({gateName:"image_cropping_aspect_ratios"})),[]),[o,a]=(0,y.useState)();return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(Q.Z,{focused:!1,onClick:()=>U.Z.setFixedAspectRatio("1:1",!1),title:"Square",right:"1:1"===t?e.checkIcon:void 0},"1:1 aspect ratio"),n&&Object.keys(he.V3).filter((e=>"1:1"!==e)).map((n=>{const{width:r,height:s}=he.V3[n],d=function(e,t,i){return i?`${t}:${e}`:`${e}:${t}`}(r,s,i),h=t===n,c=o===n?(0,T.jsx)(le,{aspectRatio:n,flipped:i,rowIsSelected:h}):h?e.checkIcon:void 0;return(0,T.jsx)(Q.Z,{focused:!1,onMouseEnter:()=>a(n),onMouseLeave:()=>a(void 0),onClick:()=>U.Z.setFixedAspectRatio(n,i),title:d,right:c},d)}))]})};const ge=function(e){const t=(0,_.VK)((()=>{var e;return null===(e=U.Z.getEditMetadata())||void 0===e?void 0:e.mask}),[]),i=(0,_.VK)((()=>U.Z.state.open&&U.Z.state.fixedAspectSelection),[]),n=(0,_.VK)((()=>z.default.checkGate({gateName:"image_cropping_reset"})),[]),o="None"===t&&void 0===i,a=(0,P.yK)((e=>({shapeText:{fontSize:13,color:e.icon.secondary,marginRight:5},button:{display:"flex",color:e.icon.secondary},divider:{color:e.stroke.deemphasized,opacity:.2},filledIcon:{width:20,transform:"translate(2px, 2px)",fill:e.blueButtonBackground},checkIcon:{width:14,height:14,color:e.icon.secondary}})),[]),r=(0,y.useMemo)((()=>o?(0,N.Z)({width:20}):G(a.filledIcon)),[o,a.filledIcon]),s=(0,y.useMemo)((()=>(0,q.k)(a.checkIcon)),[a.checkIcon]);return(0,T.jsx)(J.ZP,{alignmentToOrigin:oe.v.Start,renderOrigin:e=>{let{onClick:t}=e;return(0,T.jsxs)(te.Z,{onClick:t,style:a.button,children:[n&&(0,T.jsx)("div",{style:a.shapeText,children:(0,T.jsx)(H.FormattedMessage,{id:"imageEditModal.shape",defaultMessage:"Shape"})}),r,(0,X.i)({width:10,marginLeft:2})]})},popupType:J.Z4.Popup,render:()=>(0,T.jsx)(ee.Z,{menuType:ne.og.Popup,children:(0,T.jsxs)(ie.Z,{children:[(0,T.jsx)(Q.Z,{focused:!1,onClick:()=>U.Z.setMask("None"),title:"Freeform",right:o?s:void 0},"free-mask"),(0,T.jsx)("hr",{style:a.divider}),(0,T.jsx)(Q.Z,{focused:!1,onClick:()=>U.Z.setMask("Circle"),title:"Circle",right:"Circle"===t?s:void 0},"circle-mask"),(0,T.jsx)(pe,{checkIcon:s})]})})})};function ue(e){const t=(0,j.O7)(),i=(0,H.defineMessages)({image:{id:"imageEditModal.image.altText",defaultMessage:"Original image to edit"}}),n=(0,_.VK)((()=>U.Z.state),[]),o=(0,_.VK)((()=>U.Z.getIsImageLoaded()),[]),a=(0,_.VK)((()=>U.Z.getEditMetadata()),[]),[r,s]=(0,y.useState)(),[d,h]=(0,y.useState)(),c=(0,_.VK)((()=>{if(r)return r.width<300}),[r]),l=(0,y.useRef)(null),p=function(e){const{isImageLoaded:t,outerContainerSize:i,innerContainerSize:n}=e;return(0,P.yK)((e=>({modal:{display:t?"flex":"none"},modalInnerStyle:{borderRadius:"12px"},cropMask:{color:e.white,opacity:e.cropMaskOpacity},container:{flexDirection:"column",justifyContent:"center",alignItems:"center"},outerImageContainer:{...i,display:"flex",justifyContent:"center",alignItems:"center",transition:"all 0.2s ease-out",position:"relative",overflow:"hidden"},innerImageContainer:{maxWidth:"70vw",maxHeight:"75vh",position:n?"absolute":void 0,...n},cropWindow:{padding:"30px",background:e.surface.wash,overflow:"hidden",display:"flex",justifyContent:"center"},image:{width:"100%",height:"100%",objectFit:"contain"},loadingSpinner:{display:t?"none":"block",width:"32px",height:"32px"},loadingSpinnerOverlay:{zIndex:B.mJ,width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:e.overlaySmokescreen}})),[t,i,n])}({isImageLoaded:o,outerContainerSize:r,innerContainerSize:d});(0,y.useEffect)((()=>{if(document.documentElement.style.setProperty("--crop-mask-color",p.cropMask.color),document.documentElement.style.setProperty("--crop-mask-opacity",p.cropMask.opacity),d){const e=d.width<m||d.height<m;document.documentElement.style.setProperty("--cardinal-handle-visibility",e?"hidden":"visible")}}),[p.cropMask,d]);const g=(0,y.useCallback)((e=>{s(e),h(e)}),[]);(0,y.useLayoutEffect)((()=>{if(o&&!r&&l.current){const e=Ce(l.current);g(e)}}),[o,r,g]);const w=(0,y.useCallback)((()=>{if(l.current){const e=Ce(l.current);g(e)}}),[g]);(0,y.useEffect)((()=>(window.addEventListener("resize",w),()=>window.removeEventListener("resize",w))),[w]);const C=(0,y.useCallback)((()=>{s(void 0),h(void 0)}),[]);function x(e){var t;U.Z.setIsImageLoaded(e),null===(t=document.querySelector(".ReactCrop__crop-mask"))||void 0===t||t.setAttribute("height","100%")}return(0,y.useEffect)((()=>{n.open||C()}),[C,n.open]),n.open?(0,T.jsxs)("div",{children:[(0,T.jsx)(L.Z,{open:n.open&&!o,children:(0,T.jsx)("div",{style:p.loadingSpinnerOverlay,children:(0,T.jsx)(K.Z,{isWhite:!0,style:p.loadingSpinner})})}),(0,T.jsx)(A.Z,{style:p.modal,innerStyle:p.modalInnerStyle,open:n.open,onDismiss:me,render:()=>(0,T.jsx)("div",{style:p.container,children:(0,T.jsx)(W.Z,{width:window.innerWidth,url:n.originalSource,render:(e,o)=>(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(we,{hideTitle:c,onSave:()=>{var e;n.open&&(e={editMetadata:a,store:n.blockStore,environment:t},u.Z.setStatusPending(e.store.id,e.editMetadata),(0,Y.tc)(e.store,e.environment),U.Z.setSaveButtonLoading(!0),setTimeout((()=>{U.Z.closeModal()}),750))},onClose:()=>{me()}}),(0,T.jsx)("div",{style:p.cropWindow,children:(0,T.jsx)(Z,{onChange:(e,t)=>{U.Z.setCrop(t)},crop:a.crop,minHeight:m,minWidth:m,keepSelection:!0,aspect:n.open&&n.cropAspect,circularCrop:"Circle"===(null==a?void 0:a.mask),children:(0,T.jsx)("div",{style:p.outerImageContainer,children:(0,T.jsx)("div",{style:p.innerImageContainer,children:(0,T.jsx)("img",{ref:l,src:o,alt:V.default.formatMessage(i.image),onLoad:()=>x(l),style:p.image})})})})})]}),isAuthenticated:!0,permissionRecord:n.blockStore.pointer})})})]}):null}function we(e){const{onSave:t,onClose:i,hideTitle:n}=e,o=(0,P.yK)((e=>({toolbar:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:"100%",background:e.modalBackground,borderBottom:`1px solid ${e.stroke.deemphasized}`,padding:"12px"},buttonGroup:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignItems:"center",gap:"5px"},title:{position:"absolute",marginLeft:"auto",marginRight:"auto",left:0,right:0,textAlign:"center",width:"fit-content",fontWeight:"400"},resetButton:{fontSize:13,color:e.icon.secondary}})),[]),a=(0,_.VK)((()=>U.Z.state.open&&U.Z.state.saveButtonLoading),[]),r=(0,_.VK)((()=>z.default.checkGate({gateName:"image_cropping_reset"})),[]);return(0,T.jsxs)("div",{style:o.toolbar,children:[(0,T.jsxs)("div",{style:o.buttonGroup,children:[(0,T.jsx)(ge,{}),r&&(0,T.jsx)(O.Z,{onClick:()=>U.Z.resetCrop(),isGray:!0,style:o.resetButton,children:(0,T.jsx)(H.FormattedMessage,{id:"imageEditModal.reset",defaultMessage:"Reset"})})]}),!n&&(0,T.jsx)("div",{style:o.title,children:(0,T.jsx)(H.FormattedMessage,{id:"imageEditModal.title",defaultMessage:"Crop image"})}),(0,T.jsxs)("div",{style:o.buttonGroup,children:[(0,T.jsx)(O.Z,{onClick:i,isGray:!0,children:(0,T.jsx)(H.FormattedMessage,{id:"imageEditModal.cancelButton.label",defaultMessage:"Cancel"})}),(0,T.jsx)($.Z,{onClick:t,isLoading:a,children:(0,T.jsx)(H.FormattedMessage,{id:"imageEditModal.saveButton.label",defaultMessage:"Save"})})]})]})}function me(){U.Z.closeModal()}function Ce(e){const t=e.naturalWidth/e.naturalHeight;let i=e.height*t,n=e.height;return i>e.width&&(i=e.width,n=e.width/t),{width:i,height:n}}},273024:(e,t,i)=>{i.d(t,{Z:()=>a});var n=i(749085);class o extends n.default{getInitialState(){return{editorWidth:void 0,peekViewEditorWidth:void 0}}setWidth(e,t){t?this.setPeekViewEditorWidth(e):this.setEditorWidth(e)}setEditorWidth(e){this.setState({...this.state,editorWidth:e})}setPeekViewEditorWidth(e){this.setState({...this.state,peekViewEditorWidth:e})}getWidth(e){return e?this.getPeekViewEditorWidth():this.getEditorWidth()}getEditorWidth(){return this.state.editorWidth}getPeekViewEditorWidth(){return this.state.peekViewEditorWidth}}const a=new o},745483:(e,t,i)=>{i.d(t,{Z:()=>s});var n=i(749085),o=i(292595);class a extends n.default{getInitialState(){return{openModals:new Set}}}const r=new a,s=r;(0,o.exposeDebugValue)("GlobalModalStore",r)},361254:(e,t,i)=>{i.d(t,{Z:()=>a});var n=i(749085);class o extends n.default{getInitialState(){return{open:!1,openAnimationCompleted:!0,closeAnimationCompleted:!0}}}const a=o},964275:(e,t,i)=>{i.d(t,{D:()=>a});i(667294);var n=i(745238),o=i(785893);const a=(0,n.IU)("closeSmall",{viewBox:"0 0 16 16",svg:(0,o.jsx)("path",{d:"M3.732 11.052c-.303.308-.32.877.011 1.202.33.33.894.32 1.203.011L8 9.21l3.05 3.05c.32.325.872.32 1.197-.011a.857.857 0 00.01-1.197L9.21 8.002l3.05-3.056a.857.857 0 00-.01-1.197.857.857 0 00-1.198-.01L8 6.788 4.946 3.732c-.31-.303-.878-.32-1.203.01-.325.331-.314.895-.01 1.203l3.055 3.056-3.056 3.05z"})})},57851:(e,t,i)=>{i.d(t,{Z:()=>a});i(667294);var n=i(745238),o=i(785893);const a=(0,n.IU)("squareOnCircle",{viewBox:"0 0 20 20",svg:(0,o.jsx)("path",{d:"M2.07031 7.85645C2.07031 7.05436 2.2207 6.30469 2.52148 5.60742C2.82227 4.91016 3.23926 4.2972 3.77246 3.76855C4.30566 3.23991 4.92318 2.8252 5.625 2.52441C6.33138 2.21908 7.08561 2.06641 7.8877 2.06641C8.57585 2.06641 9.22982 2.18034 9.84961 2.4082C10.4694 2.63151 11.0322 2.94596 11.5381 3.35156C12.0439 3.75716 12.4701 4.2334 12.8164 4.78027C13.1673 5.32715 13.4157 5.92188 13.5615 6.56445H12.2354C12.0531 5.94466 11.7477 5.39323 11.3193 4.91016C10.8955 4.42708 10.3874 4.04655 9.79492 3.76855C9.20703 3.49056 8.57129 3.35156 7.8877 3.35156C7.26335 3.35156 6.67546 3.46777 6.12402 3.7002C5.57259 3.93262 5.08952 4.25618 4.6748 4.6709C4.26009 5.08561 3.93424 5.56641 3.69727 6.11328C3.46484 6.6556 3.34863 7.23665 3.34863 7.85645C3.34863 8.58561 3.50814 9.26237 3.82715 9.88672C4.15072 10.5065 4.58822 11.0283 5.13965 11.4521C5.69108 11.8714 6.31771 12.1471 7.01953 12.2793V13.5781C6.31771 13.4779 5.66602 13.2591 5.06445 12.9219C4.46289 12.5846 3.9388 12.1608 3.49219 11.6504C3.04557 11.1354 2.69694 10.5566 2.44629 9.91406C2.19564 9.26693 2.07031 8.58105 2.07031 7.85645ZM8.75586 17.4678C8.01758 17.4678 7.45931 17.2809 7.08105 16.9072C6.7028 16.5335 6.51367 15.9798 6.51367 15.2461V8.27344C6.51367 7.54427 6.7028 6.99284 7.08105 6.61914C7.45931 6.24089 8.01758 6.05176 8.75586 6.05176H15.6807C16.4189 6.05176 16.9772 6.24089 17.3555 6.61914C17.7337 6.99284 17.9229 7.54427 17.9229 8.27344V15.2461C17.9229 15.9798 17.7337 16.5335 17.3555 16.9072C16.9772 17.2809 16.4189 17.4678 15.6807 17.4678H8.75586ZM8.83789 16.1279H15.5986C15.9176 16.1279 16.1615 16.0436 16.3301 15.875C16.4987 15.7064 16.583 15.458 16.583 15.1299V8.39648C16.583 8.0638 16.4987 7.81543 16.3301 7.65137C16.1615 7.48275 15.9176 7.39844 15.5986 7.39844H8.83789C8.52344 7.39844 8.2819 7.48275 8.11328 7.65137C7.94466 7.81543 7.86035 8.0638 7.86035 8.39648V15.1299C7.86035 15.458 7.94466 15.7064 8.11328 15.875C8.2819 16.0436 8.52344 16.1279 8.83789 16.1279Z"})})}}]);