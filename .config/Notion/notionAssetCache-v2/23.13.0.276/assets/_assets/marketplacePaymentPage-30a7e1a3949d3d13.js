"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[32196],{677734:(e,t,a)=>{a.r(t),a.d(t,{MarketplacePaymentPage:()=>ne});var n=a(886664),r="https://js.stripe.com/v3",i=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,o="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",s=null,l=function(e){return null!==s||(s=new Promise((function(t,a){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe&&e&&console.warn(o),window.Stripe)t(window.Stripe);else try{var n=function(){for(var e=document.querySelectorAll('script[src^="'.concat(r,'"]')),t=0;t<e.length;t++){var a=e[t];if(i.test(a.src))return a}return null}();n&&e?console.warn(o):n||(n=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",a=document.createElement("script");a.src="".concat(r).concat(t);var n=document.head||document.body;if(!n)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return n.appendChild(a),a}(e)),n.addEventListener("load",(function(){window.Stripe?t(window.Stripe):a(new Error("Stripe.js not available"))})),n.addEventListener("error",(function(){a(new Error("Failed to load Stripe.js"))}))}catch(s){return void a(s)}else t(null)}))),s},d=Promise.resolve().then((function(){return l(null)})),c=!1;d.catch((function(e){c||console.warn(e)}));var u=a(667294),p=a(886628),m=a(724405),g=a(924211),y=a(95477),f=a(80444),h=a(195014),x=a(336360),j=a(567219),M=a(800480),w=a(319234),v=a(709291),S=a(454642),b=a(547307),k=a(833954),I=a(689024),C=a(568785),P=a(707124),N=a(785893);const E=(0,v.defineMessages)({paymentTitle:{id:"marketplace.payment.title",defaultMessage:"Purchase Notion Template"},paymentDetails:{id:"marketplace.payment.secondaryText",defaultMessage:"Payment Details"}});function T(e){const{onAddressChange:t,contacts:a,setIsPaymentElementComplete:r}=e,i=(0,m.yK)((e=>({titleStyle:{color:e.primaryBlack,width:"100%",textAlign:"start",fontSize:"32px",fontStyle:"normal",fontWeight:"700",lineHeight:"44px",letterSpacing:"0.208px"},filler:{width:"100%"}})),[]),o=(0,n.useStripe)(),s=(0,n.useElements)(),l=(0,v.useIntl)(),d={mode:"billing",contacts:a.length>0?a.map((e=>({name:e.name,address:e.address}))):void 0};return(0,N.jsxs)(I.jX,{gap:32,align:"top-center",width:520,children:[(0,N.jsx)("div",{style:i.titleStyle,children:l.formatMessage(E.paymentTitle)}),(0,N.jsx)("div",{style:i.filler,children:(0,N.jsx)(n.AddressElement,{options:d,onChange:t})}),(0,N.jsxs)("div",{style:i.filler,children:[(0,N.jsx)(P.q,{styleName:"UIRegular-14px/Medium",colorName:"secondary",children:l.formatMessage(E.paymentDetails)}),(0,N.jsx)(n.PaymentElement,{options:{business:{name:"Notion Marketplace"}},onChange:e=>{o&&s&&e.complete&&r(!0)}})]})]})}var A=a(661519),O=a(634406),Z=a(158297),B=a(365820),D=a(733993),W=a(882855),X=a(829305),F=a(398724);(0,v.defineMessages)({billingOptions:{id:"checkout.orderOptions.billingOptions",defaultMessage:"Billing options"},payMonthly:{id:"checkout.orderOptions.payMonthly",defaultMessage:"Pay monthly"},payAnnually:{id:"checkout.orderOptions.payAnnually",defaultMessage:"Pay annually"},savePercent:{id:"checkout.orderOptions.savePercent",defaultMessage:"Save {percent}%"},pricePerMonth:{id:"checkout.orderOptions.pricePerMonth",defaultMessage:"{price} / month / member"}});const L=(0,v.defineMessages)({pricePerInterval:{id:"checkout.orderSummary.pricePerInterval",defaultMessage:"{price} / {interval, select, month {month} year {year} other {period}}"},totalForToday:{id:"checkout.orderSummary.totalForToday",defaultMessage:"Total for today"},couponAmount:{id:"checkout.orderSummary.couponAmount",defaultMessage:"{money} coupon"},balanceAmount:{id:"checkout.orderSummary.balanceAmount",defaultMessage:"{money} balance"},amountOff:{id:"checkout.orderSummary.amountOff",defaultMessage:"{money} off"},details:{id:"checkout.orderSummary.details",defaultMessage:"Details"},subtotal:{id:"checkout.orderSummary.subtotal",defaultMessage:"Subtotal"},taxIfApplicable:{id:"checkout.orderSummary.taxIfApplicable",defaultMessage:"Tax if applicable"},membersInWorkspace:{id:"checkout.orderSummary.membersInWorkspace",defaultMessage:"Members in your workspace"},perPricePerMonth:{id:"checkout.orderSummary.perPricePerMonth",defaultMessage:"x {price} / month / member"},balance:{id:"checkout.orderSummary.balance",defaultMessage:"Balance"},coupon:{id:"checkout.orderSummary.coupon",defaultMessage:"Coupon"}});var q=a(727533),R=a(690403),_=a(489728);function V(e){const{name:t,tax:a,price:n,discount:r,isCalculatingTax:i}=e,o=X.X.USD,s=(0,v.useIntl)(),l=new F.n(o,a),d=new F.n(o,n),c=new F.n(o,n*r/100),p=d.plus(l).minus(c),[m,g]=u.useState(!1),y=(0,N.jsx)(q.W,{cost:d.toMoneyValue(),trailingZeroDisplay:"stripIfInteger"});return(0,N.jsxs)(I.jX,{gap:8,children:[(0,N.jsx)(z,{total:p,discount:c,isExpanded:m,handleToggleExpanded:()=>g(!m)}),(0,N.jsx)(B.M,{initial:!1,children:m&&(0,N.jsx)(D.E.div,{style:{overflow:"hidden"},initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{height:"auto"},collapsed:{height:0}},transition:{duration:.2},children:(0,N.jsxs)(I.jX,{gap:12,children:[(0,N.jsx)(Y,{itemName:s.formatMessage(H.productMessage,{productName:t}),value:y}),(0,N.jsx)(A.Z,{size:1}),(0,N.jsx)(U,{subtotal:d,tax:l,discount:c,isCalculatingTax:i})]})},"details")})]})}function z(e){const{total:t,discount:a,isExpanded:n,handleToggleExpanded:r}=e,i=(0,v.useIntl)(),o=0!==a.amount,s=K(),l=(0,N.jsx)(q.W,{cost:t.toMoneyValue(),trailingZeroDisplay:"auto"});return(0,N.jsx)(N.Fragment,{children:(0,N.jsxs)(I.jX,{direction:"row",gap:"auto",align:"center",children:[(0,N.jsxs)(I.jX,{direction:"row",align:"center-left",children:[(0,N.jsx)("div",{style:s.primaryText,children:l}),o&&(0,N.jsx)(R.Z,{content:i.formatMessage(H.discountMessage,{money:(0,N.jsx)(q.W,{cost:a.toMoneyValue(),trailingZeroDisplay:"stripIfInteger"})}),style:s.discountBadge})]}),(0,N.jsx)(_.Z,{onClick:r,children:(0,N.jsxs)(I.jX,{direction:"row",gap:4,align:"center",children:[(0,N.jsx)(P.q,{styleName:"UIRegular-14px/Medium",colorName:"primary",children:i.formatMessage(L.details)}),(0,N.jsx)(D.E.div,{animate:{rotate:n?180:0},transition:{duration:.2,ease:"linear"},children:(0,W.E)(s.detailsIcon)})]})})]})})}function U(e){const{subtotal:t,tax:a,discount:n,isCalculatingTax:r}=e,i=(0,v.useIntl)(),o=K(),s=0===a.amount?"â€”":(0,N.jsx)(q.W,{cost:a.toMoneyValue(),trailingZeroDisplay:"stripIfInteger"}),l=0!==n.amount;return(0,N.jsxs)(I.jX,{gap:4,children:[(0,N.jsx)(Y,{itemName:i.formatMessage(L.subtotal),value:(0,N.jsx)(N.Fragment,{children:(0,N.jsx)(q.W,{cost:t.toMoneyValue(),trailingZeroDisplay:"auto"})})}),(0,N.jsx)(Y,{itemName:i.formatMessage(L.taxIfApplicable),value:r?(0,N.jsx)(C.Z,{}):s}),l&&(0,N.jsx)(Y,{itemName:i.formatMessage(L.coupon),value:(0,N.jsxs)("span",{style:o.discountText,children:["-",(0,N.jsx)(q.W,{cost:n.toMoneyValue(),trailingZeroDisplay:"auto"})]})})]})}const H=(0,v.defineMessages)({discountMessage:{id:"MarketplacePaymentOrderSummary.discountMessage",defaultMessage:"{money} off"},productMessage:{id:"MarketplacePaymentOrderSummary.productMessage",defaultMessage:"{productName}"}});function K(){return(0,m.yK)((e=>({detailsIcon:{width:12,color:e.icon.secondary},discountText:{color:e.accentColors.green[500]},discountBadge:{background:"light"===e.mode?e.accentColors.green[50]:e.accentColors.green[200],color:"light"===e.mode?e.accentColors.green[500]:e.accentColors.green[600]},strikethrough:{textDecorationLine:"line-through",marginRight:4},primaryText:{color:e.primaryBlack,fontSize:"24px",fontWeight:"590",lineHeight:"28px",overflow:"hidden",letterSpacing:"0.208px"}})),[])}function Y(e){const{itemName:t,value:a}=e;return(0,N.jsxs)(I.jX,{direction:"row",gap:"auto",children:[(0,N.jsx)(P.q,{styleName:"Body-14px/Regular",colorName:"secondary",children:t}),(0,N.jsx)(P.q,{styleName:"Body-14px/Regular",colorName:"secondary",children:a})]})}function G(e){const{displayInformation:t,price:a,fulfillmentLink:n,isPaymentEnabled:r,isPaying:i,isCalculatingTax:o,onSubmit:s,taxAmount:l,alreadyOwned:d}=e,c=J(),u=(0,v.useIntl)();return(0,N.jsxs)(I.jX,{width:520,gap:39,padding:"74px 0px",children:[(0,N.jsx)($,{displayInformation:t}),d?(0,N.jsxs)("div",{style:c.alreadyOwnedWrapper,children:[(0,N.jsx)("div",{style:c.productName,children:u.formatMessage(Q.alreadyOwned)}),(0,N.jsxs)(I.jX,{gap:20,direction:"row",width:"fill",children:[(0,N.jsx)(Z.Z,{onClick:()=>{window.open(n)},disabled:!1,style:c.doubleButton,children:(0,N.jsx)("div",{children:u.formatMessage(Q.buyerProfileMessage)})}),(0,N.jsx)(Z.Z,{onClick:e=>{void 0!==n&&window.open(n)},disabled:!1,style:c.doubleButton,children:(0,N.jsx)("div",{children:u.formatMessage(Q.templateFulfillmentMessage)})})]})]}):(0,N.jsxs)(I.jX,{gap:24,align:"top-center",children:[(0,N.jsx)(A.Z,{size:1,style:c.divider}),(0,N.jsx)(V,{price:a,tax:l,isCalculatingTax:o,name:t.name,discount:0}),(0,N.jsx)(Z.Z,{onClick:s,disabled:!r,style:c.singleButton,children:i?(0,N.jsx)(C.Z,{}):(0,N.jsx)("div",{children:u.formatMessage(Q.purchaseTemplate)})})]})]})}function $(e){const{name:t,imageSource:a,creatorIconImage:n,creatorName:r}=e.displayInformation,i=(0,v.useIntl)(),o=J();return(0,N.jsxs)(I.jX,{gap:20,align:"center",direction:"row",children:[(0,N.jsx)("div",{style:{width:"fit-content"},children:(0,N.jsx)(O.Z,{src:a,alt:t,style:o.productImage,height:161})}),(0,N.jsxs)(I.jX,{gap:8,align:"top-center",width:"hug",children:[(0,N.jsx)("div",{style:o.productName,children:i.formatMessage(Q.productName,{name:t})}),(0,N.jsxs)(I.jX,{gap:6,align:"center-left",direction:"row",width:"fill",children:[(0,N.jsx)("div",{style:o.profileImageContainer,children:(0,N.jsx)(O.Z,{src:n,alt:r,height:28,style:o.profileImage})}),(0,N.jsx)(P.q,{styleName:"UIRegular-14px/Medium",colorName:"secondary",children:i.formatMessage(Q.byAuthor,{author:r})})]})]})]})}function J(){return(0,m.yK)((e=>({productImage:{height:"161px",width:"fit-content",borderRadius:"4px",border:"1px solid rgba(227, 226, 224, 0.50)",boxShadow:"0px 2px 12px -2px rgba(29, 27, 22, 0.06)"},productName:{color:e.primaryBlack,fontSize:"24px",fontWeight:"590",lineHeight:"28px",overflow:"hidden",maxHeight:"84px",textOverflow:"ellipsis",letterSpacing:"-0.442px"},creatorName:{color:"#787774",fontSize:"14px",fontFamily:"sans-serif",fontWeight:"400",lineHeight:"18px",letterSpacing:"-0.154px"},profileImage:{borderRadius:"50%",border:"1px solid rgba(0, 0, 0, 0.1)",width:"fit-content"},profileImageContainer:{width:"fit-content"},doubleButton:{width:"250px"},singleButton:{width:"100%"},divider:{gap:"0px"},alreadyOwnedWrapper:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"20px"}})),[])}const Q=(0,v.defineMessages)({productName:{id:"marketplace.payment.productName",defaultMessage:"{name}"},byAuthor:{id:"marketplace.payment.byAuthor",defaultMessage:"By {author}"},purchaseTemplate:{id:"marketplace.payment.purchaseTemplate",defaultMessage:"Purchase Template"},alreadyOwned:{id:"marketplace.payment.alreadyOwned",defaultMessage:"You have successfully purchased this product"},alreadyRefunded:{id:"marketplace.payment.alreadyRefunded",defaultMessage:"You have already refunded this product"},templateFulfillmentMessage:{id:"marketplace.payment.templateFulfillmentMessage",defaultMessage:"Duplicate Template"},buyerProfileMessage:{id:"marketplace.payment.buyerProfileMessage",defaultMessage:"Buyer Profile"}}),ee=(0,v.defineMessages)({paymentError:{id:"marketplace.payment.error",defaultMessage:"An error occurred while processing your payment. {error}"}});function te(e){const t=(0,M.O7)(),{productId:a}=e,r=(0,n.useStripe)(),i=(0,n.useElements)(),o=(0,v.useIntl)(),[s,l]=(0,u.useState)(),[d,c]=(0,u.useState)(!1),[p,m]=(0,u.useState)(!1),[g,y]=(0,u.useState)(),[f,x]=(0,u.useState)(0),[j,P]=(0,u.useState)(!1),[E,A]=(0,u.useState)(!1),[O,Z]=(0,u.useState)(!1);(0,u.useEffect)((()=>{d||async function(){c(!0);const e=await S.initiateProductPurchase(t,{productId:a});"success"===e.type?l(e.data):b.showErrorMessage((0,k.wf)(o,e))}()}),[t,a,s,o,d]);const B=(0,u.useMemo)((()=>!p&&E&&O&&!j),[p,E,O,j]),D=(0,u.useCallback)((async e=>{let n;if(e.preventDefault(),!r||!i||null!=s&&s.alreadyOwned||!g)return;if(!B)return;await i.submit(),m(!0);const l=await S.confirmProductPurchase(t,{productId:a,address:g});if("failed"===l.type)return void m(!1);const d=await r.confirmPayment({elements:i,clientSecret:l.data.intentClientSecret,confirmParams:{return_url:window.location.href},redirect:"if_required"});if(void 0!==d.error)n=d.error;else if("requires_action"===d.paymentIntent.status){const e=await r.handleNextAction({clientSecret:d.paymentIntent.client_secret??""});void 0!==e.error&&(n=e.error)}m(!1),void 0!==n?b.showErrorMessage(o.formatMessage(ee.paymentError,{error:(0,h.translateStripeError)(t,o,n)})):window.location.reload()}),[r,i,B,a,t,g,s,o]);return(0,N.jsx)("div",{children:void 0!==s?(0,N.jsxs)(I.jX,{gap:52,direction:"row",align:"top-center",padding:"80px 0 0 0",children:[s.alreadyOwned?null:(0,N.jsx)(T,{onAddressChange:async e=>{if(!i||!s||s.alreadyOwned)return;P(!0),A(!1);const a=function(e){return{zipCode:e.postal_code??"",country:e.country??"",addressLine1:e.line1??"",city:e.city??"",state:e.state??""}}(e.value.address);if(y(a),(0,w.A)(a)){const e=await S.calculateMarketplaceTax(t,{price:s.price,address:a,acquisitionId:s.acquisitionId});if("success"===e.type&&e.data.valid)return x(e.data.taxAmount),i.update({amount:e.data.taxAmount+s.price}),P(!1),void A(!0)}P(!1),x(0),A(!1)},contacts:s.contacts??[],setIsPaymentElementComplete:Z}),(0,N.jsx)(G,{displayInformation:s.displayInformation,price:s.alreadyOwned?0:s.price,taxAmount:f,alreadyOwned:s.alreadyOwned??!1,fulfillmentLink:s.alreadyOwned?s.fulfillmentLink:void 0,isPaying:p,isPaymentEnabled:B,isCalculatingTax:j,onSubmit:D})]}):(0,N.jsx)(C.Z,{})})}const ae=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];c=!0;var n=Date.now();return d.then((function(e){return function(e,t,a){if(null===e)return null;var n=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"1.52.1",startTime:t})}(n,a),n}(e,t,n)}))}(y.default.stripeMarketplace.key);function ne(e){const t=function(e,t){return{appearance:(0,h.getStripeAppearanceV2)(e),mode:"payment",currency:"usd",amount:1e3,paymentMethodTypes:["card"],setupFutureUsage:"on_session",locale:(0,h.stripeElementLocaleGivenNotionLocale)(t)}}((0,m.Fg)(),(0,p.VK)((()=>{var e;return(null===(e=f.default.state)||void 0===e||null===(e=e.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.preferred_locale)||g.al}),[]));return(0,N.jsx)(x.Z,{title:"Marketplace Checkout",children:(0,N.jsx)(j.Z,{hideNotificationBanner:!0,hideFooter:!0,hideNavItems:!0,analyticsName:"login",children:(0,N.jsx)(n.Elements,{stripe:ae,options:t,children:(0,N.jsx)(te,{...e})})})})}},882855:(e,t,a)=>{a.d(t,{E:()=>i});a(667294);var n=a(745238),r=a(785893);const i=(0,n.IU)("chevronDownRounded",{viewBox:"0 0 15 9",svg:(0,r.jsx)("path",{d:"M7.92188 8.65625C8.19531 8.64844 8.44531 8.54688 8.64844 8.32812L14.5859 2.25C14.7578 2.07812 14.8516 1.85938 14.8516 1.60156C14.8516 1.08594 14.4453 0.671875 13.9297 0.671875C13.6797 0.671875 13.4375 0.773438 13.2578 0.953125L7.92969 6.42969L2.58594 0.953125C2.40625 0.78125 2.17188 0.671875 1.91406 0.671875C1.39844 0.671875 0.992188 1.08594 0.992188 1.60156C0.992188 1.85938 1.08594 2.07812 1.25781 2.25L7.20312 8.32812C7.41406 8.54688 7.64844 8.65625 7.92188 8.65625Z"})})}}]);