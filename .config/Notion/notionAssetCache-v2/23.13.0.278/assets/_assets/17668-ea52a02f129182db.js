"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[17668],{911969:(e,t,o)=>{o.d(t,{K:()=>i,y:()=>r});var n=o(730459);function i(e,t){const{from:o}=t;n.K4(e,"show_tooltip",{from:o,time:Date.now()})}function r(e,t){const{from:o}=t;n.K4(e,"dismiss_tooltip",{from:o,time:Date.now()})}},620073:(e,t,o)=>{o.d(t,{I:()=>r,O:()=>i});var n=o(723883);function i(e){const{cursors:t,rootStore:o}=e,i={};for(const n of t)for(const e of n.stack)for(const t of e)i[t.id]=t.index;n.Z.setLimitParents(o,i)}function r(e){n.Z.removeLimitParents(e.rootStore)}},416091:(e,t,o)=>{o.d(t,{ND:()=>Z,RD:()=>V,gc:()=>L,gl:()=>O,u7:()=>T});var n=o(667294),i=o(336769),r=o(800480),s=o(886628),a=o(541432),l=o(44317),c=o(709291),d=o(401898),u=o(911969),p=o(210228),h=o(237181),g=o(481415),f=(o(95477),o(319124)),m=o(268056),b=o(489086),v=o(828685),S=o(80444),y=o(521273),C=o(896026),w=o(206258),k=o(924666),x=o(244458),_=o(453365),A=o(489626),P=o(785893);const M=1,R=1,I=(0,c.defineMessages)({spaceForAiHeader:{id:"AiOnboardingTooltips.spaceForAi.header",defaultMessage:"Press ‘space’ for AI"},spaceForAiContent:{id:"AiOnboardingTooltips.spaceForAi.content",defaultMessage:"On a new line or page, press ‘space’ on your keyboard for AI to generate or edit the page. Try it now!"},askAiAnythingHeader:{id:"AiOnboardingTooltips.askAiAnything.header",defaultMessage:"Ask AI anything"},askAiAnythingContent:{id:"AiOnboardingTooltips.askAiAnything.content",defaultMessage:"Just tell AI what to do — the more details, the better. You can also start from an example in the menu."},refineAiResponseHeader:{id:"AiOnboardingTooltips.refineAiResponse.header",defaultMessage:"Tell AI what to do next"},refineAiResponseContent:{id:"AiOnboardingTooltips.refineAiResponse.content",defaultMessage:"How was it? Give AI further instructions to improve what it wrote, or hit ‘Done’ when finished."},showAssistantLocationHeader:{id:"AiOnboardingTooltips.showAssistantLocation.answersToYourQuestionHeader",defaultMessage:"Ask AI when searching"},showAssistantLocationContent:{id:"AiOnboardingTooltips.showAssistantLocation.askQuestionBody",defaultMessage:"AI can find pages and synthesize a quick, concise answer for you. Try it now."},showAssistantOriginElementLocationHeader:{id:"AiOnboardingTooltips.ShowAssistantOriginElementLocationTooltip.header",defaultMessage:"Start by asking a question"},showAssistantOriginElementLocationContent:{id:"AiOnboardingTooltips.ShowAssistantOriginElementLocationTooltip.content",defaultMessage:"Notion AI will find pages and compose a concise answer for you. Try it now."}});function T(){const e=(0,r.O7)(),t=function(){const e=(0,r.O7)(),t=(0,s.VK)((()=>{var e;return null===(e=S.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),o=(0,s.VK)((()=>{const t=S.default.state.mainEditorCurrentBlockStore;return t&&C.Z.getMode(e,t)}),[e]);return(0,s.VK)((()=>{if(e.device.isMobile)return;const{currentUserSettingsStore:n,inAppCalloutStore:i}=S.default.state;if(!i.getCalloutVisibility("ai_onboarding_tooltip").canShow)return;if(y.Z.showAssistantOnboardingAssets()){const o=null==n?void 0:n.getSettings();if(!o)return;if((0,d.$K)(o.last_used_ai_writer_at))return;if("tooltip"!==o.ai_assistant_onboarding_phase)return;if((0,_.$_)(e,t)){if(!(0,d.$K)(o.ai_sales_assisted_extra_notification_seen_at)||(0,l.O5)(o.ai_sales_assisted_extra_notification_seen_at)<R)return}else if((0,d.$K)(o.ai_assistant_onboarding_phase_last_set_at)&&(0,l.O5)(o.ai_assistant_onboarding_phase_last_set_at)<M)return}else{const e=null==n?void 0:n.getSettings();if(!e)return;const t=16770636e5;if(e.signup_time&&e.signup_time>t)return}if("space_for_ai"!==(0,A.sy)())return;if(!(0,f.GD)(o))return;const r=k.default.state;if("editing"===r.mode){const e=(0,m.QY)(r.multiSelection);if(e&&(0,b.wd)(e.selection)){const t=e.store,o=v.E.findEditableWithStore(t);if(o){const e="block"===t.pointer.table?w.G.createChildStore(t,t.pointer):void 0,n=e&&e.getType(),i=Boolean(n&&(0,a.hD)(n)),r=t.getValue();if(i&&!r)return o}}}}),[e,o,t])}();return t?(0,P.jsx)(g.U,{origin:()=>t.getNode(),placementToOrigin:"bottom",header:(0,P.jsx)(c.FormattedMessage,{...I.spaceForAiHeader}),content:(0,P.jsx)(c.FormattedMessage,{...I.spaceForAiContent}),onCloseClick:()=>(0,A.fz)(e)}):null}function V(e){const{originRef:t,openState:o}=e,n=(0,r.O7)(),i=(0,s.VK)((()=>(0,A.sy)()),[]);if(n.device.isMobile)return null;return"ask_ai_anything"===i&&"initialPrompt"===o.stage?(0,P.jsx)(g.U,{origin:t,placementToOrigin:"top",header:(0,P.jsx)(c.FormattedMessage,{...I.askAiAnythingHeader}),content:(0,P.jsx)(c.FormattedMessage,{...I.askAiAnythingContent}),onCloseClick:()=>(0,A.fz)(n)}):null}function O(e){const{originRef:t,openState:o,isInputEmpty:n}=e,i=(0,r.O7)(),a=(0,s.VK)((()=>(0,A.sy)()),[]);if(i.device.isMobile)return null;const l="refine_ai_response"===a&&"results"===o.stage&&!o.loading&&"cursor"===o.context.type&&n;return(0,P.jsx)(g.U,{origin:l?t:void 0,placementToOrigin:"right",pointerOffset:-4,pointerLength:25,header:(0,P.jsx)(c.FormattedMessage,{...I.refineAiResponseHeader}),content:(0,P.jsx)(c.FormattedMessage,{...I.refineAiResponseContent}),onCloseClick:()=>(0,A.fz)(i)})}function Z(e){const{origin:t}=e,o=(0,r.O7)();(0,n.useEffect)((()=>{u.K(o,{from:"qna_button"})}),[o]);const i=(0,n.useCallback)((()=>{const{currentUserSettingsStore:e}=S.default.state;e&&(u.y(o,{from:"qna_button"}),(0,x.setQnaOnboardingPhase)(o,{phase:"complete",transactionUserAction:"AiQnaIntroModal.debug.clickTooltipComplete",userSettingsStore:e}))}),[o]);return(0,P.jsx)(g.U,{style:{width:250},pointerLength:25,pointerPosition:"94%",origin:t,placementToOrigin:"top",header:(0,P.jsx)(c.FormattedMessage,{...I.showAssistantOriginElementLocationHeader}),content:(0,P.jsx)(c.FormattedMessage,{...I.showAssistantOriginElementLocationContent}),onCloseClick:i})}function L(e){const{origin:t}=e,o=(0,r.O7)();(0,n.useEffect)((()=>{u.K(o,{from:"qna_search"})}),[o]);const i=(0,n.useCallback)((()=>{const{currentUserSettingsStore:e}=S.default.state;e&&(u.y(o,{from:"qna_search"}),(0,x.setQnaOnboardingPhase)(o,{phase:"complete",transactionUserAction:"AiQnaIntroModal.debug.clickTooltipComplete",userSettingsStore:e}))}),[o]);return(0,P.jsx)(g.U,{style:{width:250},pointerLength:25,pointerPosition:"5%",origin:t,placementToOrigin:"bottom",header:(0,P.jsx)(c.FormattedMessage,{...I.showAssistantLocationHeader}),content:(0,P.jsx)(c.FormattedMessage,{...I.showAssistantLocationContent}),onCloseClick:i})}(0,i.exposeDebugEnvironmentValue)("resetAIOnboarding",(e=>()=>{const{currentUserSettingsStore:t}=S.default.state;t&&p.createAndCommit({userAction:"AiIntroModal.debugging.resetAIOnboarding",environment:e,perform:e=>{h.d2({userSettingsStore:t,transaction:e,data:{ai_onboarding_phase:"space_for_ai"}})},userId:t.id})}))},356638:(e,t,o)=>{o.d(t,{T:()=>ve,Z:()=>ye});var n=o(667294),i=o(782540),r=o(800480),s=o(797511),a=o(886628),l=o(724405),c=o(276915),d=o(380503),u=o(151454),p=o(653965),h=o(401898),g=o(751787),f=o(147678),m=o(620073),b=o(761045),v=o(303898),S=o(772899),y=o(110906),C=o(296994),w=o(107401),k=o(628020),x=o(843250),_=o(368585),A=o(319124),P=o(551783),M=o(352533),R=o(450627),I=o(367669),T=o(66430),V=o(645010),O=o(318245),Z=o(534987),L=o(394841),j=o(861931),E=o(48276),B=o(116746),K=o(224646),U=o(938676),D=o(434859),F=o(80444),N=o(788632),q=o(424042),z=o(421051),W=o(417903),$=o(319111),H=o(156638),G=o(282136),J=o(188923),Y=o(896026),Q=o(787956),X=o(623063),ee=o(568785),te=o(953336),oe=o(802159),ne=o(126957),ie=o(709291),re=o(531701),se=o(436610),ae=o(158297),le=o(785893);const ce=function(){const e=(0,r.O7)(),t=(0,a.VK)((()=>N.Z.state.online),[]);let o;return(0,n.useEffect)((()=>{t||se.DC(e,{type:"page_error_indicator"})}),[t,e]),o=t?(0,le.jsx)(ie.FormattedMessage,{defaultMessage:"Oops, there was an error loading this page. Refresh to load it again.",id:"pageErrorIndicator.loadingError.message"}):e.defaultRecordCache.persistedRecordCache?(0,le.jsx)(ie.FormattedMessage,{defaultMessage:"Please go online to load this page, then you'll be able to access it while offline.",id:"pageOfflineIndicator.hasLocalData.message"}):(0,le.jsx)(ie.FormattedMessage,{defaultMessage:"Oops, you seem to be offline. Please go online to view this page.",id:"pageOfflineIndicator.noLocalData.message"}),(0,le.jsxs)("div",{style:pe(e),children:[(0,le.jsx)("div",{style:ue(e),children:o}),(0,le.jsx)(ae.Z,{isLarge:!0,onClick:()=>window.location.reload(),children:(0,le.jsx)(ie.FormattedMessage,{defaultMessage:"Refresh",id:"pageErrorIndicator.reloadButton.label"})})]})};function de(e){return e.currentUser.isLoggedIn()}function ue(e){const{device:t}=e;return{fontSize:t.isMobile?18:32,marginBottom:8,textAlign:"center",color:re.ZP.uiBlack,maxWidth:640,lineHeight:1.3}}function pe(e){const{device:t}=e;return{height:"100%",minHeight:de(e)?`calc(100vh - ${2*d.R6(e.device.isElectronMac)}px)`:"100vh",paddingLeft:t.isMobile?16:32,paddingRight:t.isMobile?16:32,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}}var he=o(369206),ge=o(531192),fe=o(178901),me=o(903553),be=o(500007);const ve="1.375em",Se=n.memo((function(e){let{store:t,routerState:o,collectionViewStore:s}=e;const p=(0,r.O7)(),{RouterStore:f}=p,b=(0,r.Fy)(),v=(0,n.useCallback)((e=>{Q.Z.state&&("scroll"===e?Q.Z.state.hadScroll||(Q.Z.setState({...Q.Z.state,hadScroll:!0}),g.Kk(p,{interactionType:e})):"click"===e?Q.Z.state.hadClick||(Q.Z.setState({...Q.Z.state,hadClick:!0}),g.Kk(p,{interactionType:e})):"copy"===e?Q.Z.state.hadCopy||(Q.Z.setState({...Q.Z.state,hadCopy:!0}),g.Kk(p,{interactionType:e})):(0,h.t1)(e))}),[p]);(0,n.useEffect)((()=>{if(v){const e=()=>{v("copy")};return addEventListener("copy",e),()=>removeEventListener("copy",e)}}),[v]),(0,n.useEffect)((()=>()=>m.I({rootStore:t})),[t]);const S=(0,a.SI)((()=>Y.Z.getMode(p,t)),[p,t]),y=(0,a.VK)((()=>{const{presenceStore:e,pageVisitStore:o,currentSpaceStore:n,currentSpaceViewStore:i}=F.default.state;return{pageStore:t,spaceStore:n,spaceViewStore:i,presenceStore:e,pageVisitStore:o,publicEditModeStore:S}}),[S,t]),{pageVisitStore:w,presenceStore:_,spaceStore:A,spaceViewStore:P}=y,M=(0,a.VK)((()=>!t.isDefined()||!t.canRead()),[t]),R=(0,a.VK)((()=>p.currentUser.isLoggedIn()),[p]),I=(0,a.VK)((()=>F.default.state.mainEditorCurrentBlockStore),[]),T=(0,a.VK)((()=>k.h1(p)),[p]),V=(0,l.Fg)(),O=(0,a.VK)((()=>(0,L.WE)(I)),[I]),Z=(0,a.VK)((()=>{var e;return Boolean(null===(e=q.Z.state.preferences)||void 0===e?void 0:e.isVibrancyEnabled)}),[]),D=(0,a.VK)((()=>{const e={flexGrow:0,flexShrink:1,display:"flex",flexDirection:"column",background:O?Z?"rgba(251,251,251,0.4)":(0,j.$1)({theme:V,isPhone:b.isPhone}):V.contentBackground,zIndex:u.Wi,height:b.isMobile?"100vh":`calc(100vh - ${d.R6(b.isElectronMac)}px)`,maxHeight:"100%",...b.isTablet&&{position:"relative"},position:"relative",...O?{height:"100%",position:"absolute"}:{}};if(!(0,K.Jr)(p)){const t=U.sidebarOpenStore.state;(0,K.YR)(p)||(e.boxShadow=V.mediumBoxShadow),e.pointerEvents=t?"none":"auto",e.transform="translateX(0)"}return!T&&b.isMobileNative&&(e.pointerEvents="auto",e.transform="translateX(0px)"),e}),[b.isElectronMac,b.isMobile,b.isPhone,b.isTablet,b.isMobileNative,p,T,V,O,Z]),W=(0,a.VK)((()=>"nativeTab"===f.state.route.name),[f]),$=(0,a.VK)((()=>!N.Z.state.online),[]),[H,G]=(0,a.VK)((()=>{const e=(0,K.$3)(p);return[e,e+(0,K.vJ)(p)]}),[p]),J=(0,a.VK)((()=>E.VV()),[]),ee=(0,a.VK)((()=>B.Z.isTogglingToPanelModeState()),[]),te=(0,a.VK)((()=>Boolean(t.getAppContainerBlockStore())),[t]),ne=(0,a.VK)((()=>U.sidebarResizingStore.state),[]),ie=(0,a.VK)((()=>t.getAppContainerBlockStore()),[t]),{isShowingTabBar:re,isUnifiedTitleBarEnabled:se}=(0,a.VK)((()=>{var e;return{isShowingTabBar:q.Z.state.isShowingTabBar,isUnifiedTitleBarEnabled:Boolean(null===(e=q.Z.state.preferences)||void 0===e?void 0:e.isUnifiedTitleBarEnabled)}}),[]),ae=(0,a.VK)((()=>z.Z.state.banners),[]),ce=(0,a.VK)((()=>!re&&!(0,K.in)(p)&&!B.Z.isPanelPinnedState()),[p,re]),de=(0,a.VK)((()=>"personal_home_page"===t.getType()),[t]),ue=(0,l.yK)((()=>({frameContainer:{order:c.Z.appCursorListener.editor,display:"flex",flexDirection:"column",width:b.isTablet?"unset":"100%",overflow:b.isTablet?"unset":"hidden"}})),[b.isTablet]);return(0,le.jsx)(i.Mi,{value:y,children:(0,le.jsxs)("div",{className:W?"hidden":"",style:ue.frameContainer,children:[!b.isMobile&&!te&&(0,le.jsxs)(le.Fragment,{children:[(0,le.jsx)(be.ZP,{store:t,spaceStore:A,spaceViewStore:P,pageVisitStore:w,presenceStore:_,showSidebarButton:ce,isElectron:b.isElectron,isInvalidPage:M,banners:ae}),se&&b.isElectronWindows&&!re&&(0,le.jsx)(oe.m,{})]}),(0,le.jsx)(X.Z,{isVisible:!0,animationStyle:{width:O?G:H,translateX:J},skipAnimation:re&&ne.isResizing||ee,render:()=>(0,le.jsxs)("main",{style:D,className:x.Wiy,children:[b.isMobile&&(0,le.jsx)(C.WW,{store:t,collectionViewStore:s,spaceStore:A,spaceViewStore:P,pageVisitStore:w,presenceStore:_,isInvalidPage:M,shouldShowAddTo:Boolean(o.route.showMoveTo&&t.canEdit()&&R),banners:ae,isOffline:$}),ie?(0,le.jsx)(Ce,{appContainerStore:ie}):de?(0,le.jsx)(ke,{store:t}):(0,le.jsx)(xe,{store:t,routerState:o,maybeLogSearchInteractionEvent:v}),R&&b.isMobile&&(0,le.jsx)(we,{store:t}),b.isMobileNative&&R&&I&&(0,le.jsx)(C.qV,{})]})})]})})})),ye=Se;function Ce(e){let{appContainerStore:t}=e;return(0,le.jsx)("div",{style:{position:"absolute",height:"100vh",width:"100%"},children:(0,le.jsx)(C.D8,{collectionViewBlockStore:t})})}function we(e){var t;let{store:o}=e;const i=(0,r.O7)(),s=(0,a.VK)((()=>{var e;return null===(e=i.mobileNative)||void 0===e?void 0:e.api.renderMobileActionBar}),[null===(t=i.mobileNative)||void 0===t?void 0:t.api.renderMobileActionBar]),l=(0,n.useCallback)((e=>{const{isMobileNative:t}=i.device;return(0,le.jsx)(C.Js,{stores:e,position:t?M.nd.Bottom:M.nd.Floating,currentBlockStore:o})}),[i.device,o]);return(0,P.LQ)({environment:i})?(0,le.jsx)(C.Gr,{currentBlockStore:o,isNativeMobileActionBar:!0,makeActionBarComponent:e=>(0,le.jsx)(C.eU,{renderApi:s,stores:e,currentBlockStore:o,fallbackRenderer:l})}):(0,le.jsx)(C.Gr,{currentBlockStore:o,isNativeMobileActionBar:!1,makeActionBarComponent:l})}const ke=n.memo((function(e){let{store:t}=e;return(0,le.jsx)(me.Z,{disable:!0,store:t,isDefaultContainer:!0,render:()=>(0,le.jsx)(Z.Vd,{})})}));function xe(e){let{store:t,routerState:o,maybeLogSearchInteractionEvent:i}=e;const s=(0,r.O7)(),{RouterStore:l}=s,{historyState:c}=o,{currentLoadingContainerStore:d,pageVisitStore:u}=(0,a.VK)((()=>{const{currentLoadingContainerStore:e,pageVisitStore:t}=F.default.state;return{currentLoadingContainerStore:e,pageVisitStore:t}}),[]),h=(0,a.VK)((()=>c&&p.hj(c.scrollTop)?c.scrollTop:void 0),[c]),g=(0,a.VK)((()=>Boolean((0,I.IJ)(s,t))),[s,t]),m=(0,a.VK)((()=>Boolean(J.default.isCenterPeekOpen()||H.Z.state.open)),[]);return(0,le.jsx)(me.Z,{store:t,isDefaultContainer:!0,droppable:!0,isRootContainer:!0,disableRectangularSelection:g,disable:m,render:e=>{let{selectableEvents:o,selectableHoverMenuOverlay:r}=e;return(0,le.jsx)(n.Suspense,{fallback:(0,le.jsx)(ne.Z,{isVisible:!0,store:t}),children:(0,le.jsx)(he.Z,{pageStore:t,pageVisitStore:u,scrollToBlockIds:v.uE(l),scrollToPosition:h,store:d,onReady:()=>{f.Y(s,{animateScrollToBlocks:!1})},onDone:()=>{t.isCollectionView()||"rendered"===F.default.state.renderPhase||F.default.setState({...F.default.state,renderPhase:"rendered"})},initialChunkSize:T.loadPageChunkInitialChunkSize,incrementChunkSize:30,render:e=>{let{error:n,ready:s,initialRequestCompleted:a,endOfResultsReached:l,isCollectionInPage:c}=e;return(0,le.jsx)(_e,{store:t,error:n,ready:s,initialRequestCompleted:a,endOfResultsReached:l,isCollectionInPage:c,selectableEvents:o,selectableHoverMenuOverlay:r,maybeLogSearchInteractionEvent:i})}})})}},t.id)}const _e=n.memo((function(e){let{store:t,error:o,ready:i,initialRequestCompleted:l,endOfResultsReached:c,isCollectionInPage:d,selectableEvents:u,selectableHoverMenuOverlay:p,maybeLogSearchInteractionEvent:h}=e;const g=(0,r.O7)(),f=(0,r.Fy)(),{publicEditModeStore:m}=(0,s.l)()??{},v=(0,a.VK)((()=>(0,A.GD)(null==m?void 0:m.state)),[m]),x=(0,n.useCallback)((e=>{let{startTime:o,endTime:n}=e;const i=y.fm(t);O.default.measure({metricName:"collections.max_scroll_lag_in_session",startTime:o,endTime:n},{environment:g,data:_.vS(i)})}),[g,t]),P=(0,n.useCallback)((e=>{V.Z.PageScroller=e}),[]),M=(0,n.useCallback)((()=>{h("scroll")}),[h]),R=(0,n.useCallback)((e=>{u.onClick(e),h("click")}),[h,u]),I=(0,a.VK)((()=>t.isCollectionView()),[t]),T=(0,a.VK)((()=>({spinner:{zIndex:1,opacity:.5,width:ve,height:ve,marginTop:`calc(-${ve} / 2 - ${Me(g)} / 2)`,marginBottom:24,marginLeft:"auto",marginRight:"auto"},scroller:{display:"flex",flexDirection:"column",zIndex:1,flexGrow:1,position:"relative",...i?{}:{opacity:0,pointerEvents:"none",height:0},...I?{}:{alignItems:"center"}}})),[g,I,i]),Z=(0,a.VK)((()=>J.default.isSidePeekOpen()?void 0:i?b.Q7(g):D.Z.All),[g,i]),L=(0,a.VK)((()=>k.Zy({environment:g,store:t})),[g,t]);return(0,le.jsxs)(n.Fragment,{children:[(0,le.jsxs)(te.Z,{ref:P,onScrollLagMeasure:d?x:void 0,onScroll:M,preventType:Z,type:L,style:T.scroller,store:W.Z,...u,onClick:R,children:[p,!f.isPhone&&v&&(0,le.jsx)(S.LazyCompletionPopup,{scrollerStore:W.Z}),(0,le.jsx)(w.vo,{scrollerStore:W.Z}),(0,le.jsx)(C.gW,{blockStore:t}),l&&(0,le.jsx)(Ae,{store:t,error:o}),i&&!c&&!(l&&o)&&(0,le.jsx)(ee.Z,{style:T.spinner})]}),f.isPhone&&v&&(0,le.jsx)(S.LazyCompletionPopup,{scrollerStore:W.Z}),(0,le.jsx)(ne.Z,{isVisible:!i,store:t})]})})),Ae=n.memo((function(e){let{store:t,error:o}=e;const{pageVisitStore:i,presenceStore:s,currentLoadingContainerStore:c}=(0,a.VK)((()=>{const{pageVisitStore:e,presenceStore:t,currentLoadingContainerStore:o}=F.default.state;return{pageVisitStore:e,presenceStore:t,currentLoadingContainerStore:o}}),[]),d=(0,r.O7)(),{WindowSizeStore:u,device:p}=(0,r.O7)(),h=(0,a.VK)((()=>u.state.height),[u]),[g,f]=(0,a.VK)((()=>{const e=(0,K.$3)(d),o=Math.max(R.zL,e),n=e+(0,K.vJ)(d),i=(0,y.Ks)(t)&&!t.isFullWidth()?o:n,r=p.isMobile&&$.Z.state.open?h:0;return[i,ge.ZP.paddingBottom(d,b._4()+r)]}),[p.isMobile,h,d,t]),m=(0,a.VK)((()=>J.default.isSidePeekOpen()||J.default.isSidePeekClosingStore.state),[]),v=(0,l.yK)((()=>({pageViewBlockStyle:m?{width:g,position:"absolute",overflowX:"hidden",left:0}:Pe})),[m,g]);return(0,a.VK)((()=>{const e=c&&!c.state.endOfResultsReached,n=t.isDefined()&&t.canRead();return e&&o||!n}),[t,c,o])?(0,le.jsx)(ce,{}):(0,le.jsxs)(n.Fragment,{children:[(0,le.jsx)(ge.ZP,{context:G.S.Frame,style:v.pageViewBlockStyle,store:t,paddingBottom:f,disabled:!1}),(0,le.jsx)(fe.Z,{pageVisitStore:i,presenceStore:s,isPeekView:!1})]})})),Pe={};function Me(e){return"number"==typeof ge.ZP.paddingBottom(e)?`${ge.ZP.paddingBottom(e)}px`:ge.ZP.paddingBottom(e)}},126957:(e,t,o)=>{o.d(t,{Z:()=>m});o(667294);var n=o(800480),i=o(886628),r=o(724405),s=o(570096),a=o(380503),l=o(709291),c=o(134232),d=o(636596),u=o(568785),p=o(531192),h=o(785893);const g="1.375em";function f(e){let{store:t,peekMode:o}=e;const a=(0,n.O7)(),l=(0,i.VK)((()=>t.hasCover()),[t]),c=(0,i.VK)((()=>t.hasIcon()),[t]),u=(0,i.VK)((()=>t.isCollectionView()),[t]),g=(0,i.VK)((()=>t.isFullWidth()),[t]),f=(0,i.VK)((()=>a.device.isMobile&&!a.device.isTablet),[a]),m=(0,i.VK)((()=>o===s.l?"20vh":p.ZP.defaultPageCoverHeight(a)),[a,o]),b=(0,r.yK)((()=>{const e=f?24:o===s.R?48:96,t=(()=>{switch(!0){case f:return 32;case c:return 96;case o===s.l&&!c:return 54;case!c:return 102}})(),n=(()=>{switch(!0){case f&&l&&c:return 22;case f&&l&&!c:return 54;case f&&!l&&c:return 56;case f&&!l&&!c:return 4;case!f&&l&&c:return 50;case!f&&l&&!c:return 58;case!f&&!l&&c:return 92;case!f&&!l&&!c:return 20}})();return{collectionCoverPhoto:{width:"100%",height:"20vh"},collectionTitleContainer:{display:"flex",alignItems:"center",paddingLeft:e,paddingRight:e,width:"100%",paddingTop:(()=>{switch(!0){case f&&l:return 50;case f&&!l:return 78;case!f&&l:return 48;case!f&&!l:return 36}})()},collectionIcon:{flexGrow:0,flexShrink:0,width:36,height:36,borderRadius:6,marginRight:10,marginLeft:3},collectionTitle:{height:f?24:30,width:600,marginTop:f?6:3,borderRadius:15},pageCoverPhoto:{width:"100%",height:m},pageCoverPadding:{width:"100%",height:t},pageIconContainer:{maxWidth:"100%",boxSizing:"border-box",paddingLeft:e,paddingRight:e,width:g?"100%":900,height:36},pageIcon:{position:"relative",top:l?-42:0,width:78,height:78,marginLeft:2,borderRadius:16},pageTitleContainer:{display:"flex",boxSizing:"border-box",paddingLeft:e,paddingRight:e,width:g?"100%":900,maxWidth:"100%",paddingTop:n},pageTitle:{marginTop:f?3:0,height:f?24:30,width:600,borderRadius:15}}}),[g,l,c,m,f,o]);return u||o===s.R?(0,h.jsxs)(h.Fragment,{children:[l&&(0,h.jsx)(d.Z,{style:b.collectionCoverPhoto}),(0,h.jsxs)("div",{style:b.collectionTitleContainer,children:[c&&(0,h.jsx)(d.Z,{emphasized:!0,style:b.collectionIcon}),(0,h.jsx)(d.Z,{style:b.collectionTitle})]})]}):(0,h.jsxs)(h.Fragment,{children:[l?(0,h.jsx)(d.Z,{style:b.pageCoverPhoto}):(0,h.jsx)("div",{style:b.pageCoverPadding}),c&&(0,h.jsx)("div",{style:b.pageIconContainer,children:(0,h.jsx)(d.Z,{emphasized:!0,style:b.pageIcon})}),(0,h.jsx)("div",{style:b.pageTitleContainer,children:(0,h.jsx)(d.Z,{style:b.pageTitle})})]})}function m(e){let{isVisible:t,peekMode:o,store:d}=e;const m=(0,n.O7)(),b=(0,n.Fy)(),v=(0,l.useIntl)(),S=b.isMobile&&!b.isTablet,y=b.isMobileNative,C=a.R6(b.isElectronMac),w=(0,r.yK)((()=>({root:{position:"absolute",top:o===s.l||o===s.R||S?`calc(${C}px + env(safe-area-inset-top))`:"env(safe-area-inset-top)",bottom:"env(safe-area-inset-bottom)",left:"env(safe-area-inset-left)",right:"env(safe-area-inset-right)",display:"flex",flexDirection:"column",alignItems:"center",pointerEvents:"none"}})),[o,S,C]),k=(0,i.VK)((()=>p.ZP.paddingBottom(m)),[m]),x=!y;return(0,c.Z)(t,x?y?0:10:100,0)?(0,h.jsx)("div",{role:"progressbar","aria-valuetext":v.formatMessage({id:"frameLoadingState.loading",defaultMessage:"Loading..."}),style:{...w.root,...x?{}:{justifyContent:"center"}},children:x?(0,h.jsx)(f,{store:d,peekMode:o}):(0,h.jsx)(u.Z,{style:{zIndex:1,opacity:.5,width:g,height:g,...void 0===o&&{marginTop:`calc(-${g} / 2 - ${k}px / 2)`,marginBottom:24,marginLeft:"auto",marginRight:"auto"}}})},"shimmer"):null}},369206:(e,t,o)=>{o.d(t,{Z:()=>oe});o(21703);var n=o(973935),i=o(883355),r=o(701302),s=o(371663),a=o(541432),l=o(292595),c=o(662193),d=o(145953),u=o(23867),p=o(657347),h=o(653965),g=o(937850),f=o(532603),m=o(620073),b=o(325320),v=o(504408),S=o(303898),y=o(454642);var C=o(61202),w=o(111599),k=o(292283),x=(o(757658),o(516691)),_=o(264572),A=o(292516),P=o(673360),M=o(600606),R=o(798963),I=o(718844),T=o(421202),V=o(606287),O=o(213493),Z=o(870279),L=o(933709),j=o(519889),E=o(76233);var B=o(95477),K=o(145950),U=o(205659),D=o(32223),F=o(169151),N=o(583055);async function q(e){const{environment:t,request:o,abortSignal:n,prefetchCacheKey:i}=e;return(0,N.updateLoadCachedPageChunkCalledAt)(),D.isConnected()||D.isConnecting()?y.loadCachedPageChunk(t,o,void 0,void 0,n,i):y.loadPageChunk(t,function(e){return{...e,page:{id:e.page.id,spaceId:(0,u.C)(void 0)}}}(o),void 0,void 0,n,i)}async function z(e){const{environment:t,request:o,prefetchPromise:n,abortSignal:i,useInMemoryCacheOnly:r,isRacingWithAnotherRequest:s}=e,l=d.PF.create(),c=await async function(e,t,o){let n;n=e.cursor?h.Xh(e.cursor.stack):[];const i=e.page.id,r=e.limit,s=d.Ak.create();0===n.length&&n.push([{table:T.iU,id:i,index:0}]);let l=0,c=0;const u=A.s.fromMonomorphicFunctionUnsafe((async e=>{const o=s.getModel(e);if(c+=1,o)return o;const n=await t(e);return s.setModel(e,n),n&&await g(n),n})),p=new Set,g=async function(t){const n=[];if((0,P.tz)(t)){const e=t.getParentPointer();n.push([e,"Block parent_id"])}if(t.table===T.iU){const o=t.getCollectionViewPointers();for(const e of o)n.push([e,"CollectionViewBlock view_id"]);const i=t.getCollectionPointer();i&&n.push([i,"CollectionViewBlock collection_id"]);const r=t.getDiscussionPointers();for(const e of r)n.push([e,"Discussion"]);const s=t.getProperties().title;if((0,a.XD)(t.getType())&&s){const o=E.lzi(s),i=h.G0(...o.map(E.hDy));for(const r of i){if(E.STW(r)&&n.push([{table:T.iU,id:E.TOT(r)},"page annotation"]),E.IWo(r)&&n.push([{table:j.KJ,id:E.zEN(r)},"user annotation"]),E.j0F(r)){const t=E.zW$(r),o=(0,_.A5)({url:t,baseUrl:e.baseUrl,publicDomainName:e.publicDomainName});o&&n.push([{table:T.iU,id:o},"link annotation"])}if(E.nSN(r)){const e=E.frW(r);e&&n.push([{table:T.iU,id:e,spaceId:t.space_id},"eoi annotation"])}}}if(t.getType()===a.Ti.alias){const e=t.getAliasTargetPointer();e&&n.push([e,"alias"])}else if(t.isExternalObjectInstanceType()){const e=t.getExternalObjectSubInstancePointers();for(const t of e)n.push([t,"eoi"])}else if(t.getType()===a.Ti.button){const e=t.getAutomationPointer();e&&n.push([e,"button_automation"])}}else if(t.table===L.qF){for(const e of t.getCommentPointers())n.push([e,"discussion table comment"]);for(const e of t.getReactionPointers())n.push([e,"discussion table reaction"])}else if(t.table===Z.x_){for(const e of t.getContentPointers())n.push([e,"comment table attachment"]);for(const e of t.getReactionPointers())n.push([e,"comment table reaction"])}else if(t.table===O.np){const e=t.getFormatStore().getKeyStore("collection_pointer").getValue();e&&n.push([e,"CollectionView collection_id"])}else if(t.table===R.cv){const e=t.getActionPointers();for(const t of e)n.push([t,"Automation action_ids"])}else if(t.table===I.Xj)for(const e of t.getBlocks())n.push([{table:T.iU,id:e},"Automation action blocks"]);else if(t.table===V.vF)for(const e of t.getAutomationPointers())n.push([e,"Collection automation_ids"]);await Promise.all(n.filter((e=>{let[t,o]=e;const n=(0,x.dn)(t);return!p.has(n)&&(p.add(n),!0)})).map((e=>{let[n,i]=e;return o&&o({table:t.table,id:t.id},n,i),n})).map(u))},f=async function(){const t=[],s=n[n.length-1];if(l>=r&&c>10*r||!s)return!1;const d=await Promise.all(s.map((async e=>{const{table:t,id:o}=e,n=M.dr.fromPointerLike({table:t,id:o});return await u(n)}))),p=[];for(let o=0;o<s.length;o++){const r=s[o],l=d[o];if(!l||l.table!==T.iU)continue;const c=null==l?void 0:l.getContentIds(),u=null==l?void 0:l.getFormat();if(!e.verticalColumns&&l&&c&&"column_list"===l.type&&0===r.index){for(let e=0;e<c.length;e++){const o=c[e];p.push([{table:T.iU,id:o,spaceId:l.spaceId},r,"column"]),t.push({table:T.iU,id:o,index:0})}r.index=c.length}else if(l&&"transclusion_reference"===l.type&&u&&u.transclusion_reference_pointer&&0===r.index)p.push([u.transclusion_reference_pointer,r,"transclusion reference"]),t.push({...u.transclusion_reference_pointer,index:0}),r.index=1;else if(l&&c&&(0,a.Um)(l.type,u)&&(l.id===i&&1===n.length||!(0,a.Pm)(l.type)&&!(0,a.BX)(l.type,u))&&c[r.index]){const e=c[r.index];p.push([{table:T.iU,id:e,spaceId:l.spaceId},r,"block content child"]),t.push({table:T.iU,id:e,index:0}),r.index++}}await Promise.all(p.map((e=>{let[t,n,i]=e;return o&&o(n,t,i),t})).map(u));const h=t.filter((e=>{for(let t=0;t<n.length;t++){const o=n[t];for(let t=0;t<o.length;t++){const n=o[t];if(n.table===e.table&&n.id===e.id)return!1}}return!0}));return h.length>0?(n.push(h),l++):n.pop(),!0};for(;await f(););return{recordMap:s,cursorValue:{stack:n}}}({...o,baseUrl:B.default.domainBaseUrl,publicDomainName:B.default.publicDomainName},A.s.fromMonomorphicFunctionUnsafe((async e=>{const o=await K.Ye({environment:t,pointer:e,prefetchPromise:n,abortSignal:i,useInMemoryCacheOnly:r,isRacingWithAnotherRequest:s});if(null!=i&&i.aborted)throw new Error("Abort signal received");if(o)return l.setModelAndRole(e,o.model,o.role),o.model;throw new Error(`Record not found: ${e.table},${e.id}`)})),U.A.enableLogging?(e,t,o)=>{console.log(`Spidering from ${e.table}:${e.id} to ${t.table}:${t.id} (${o})`)}:void 0);if(null!=i&&i.aborted)throw new Error("Abort signal received");return{recordMap:l.toJson({allowVersionDowngrade:!1}),cursor:c.cursorValue}}var W=o(177546),$=o(377282),H=o(95802),G=o(788632),J=o(319385),Y=o(879167),Q=o(577144),X=o(193220);let ee=!1;(0,l.exposeDebugValue)("toggleLogLocalPageLoadFailures",(()=>{ee=!ee,console.info(ee?"Local page load error logging enabled":"Local page load error logging disabled")}));class te extends i.Z{constructor(){super(...arguments),this.lastTimeout=void 0,this.node=void 0,this.scrollableAncestor=void 0,this.isCollectionInPage=!1,this.trackPage=new c.EJ("trackPage"),this.storeTypes={store:X.Z},this.handleConnectionStateChange=()=>{const{store:e}=this.stores,t=G.Z.state.online;t&&!this.lastOnlineState&&e.state.error&&(e.reset(),this.requestNextChunk()),this.lastOnlineState=t},this.onReady=h.IH(this.props.onReady?this.props.onReady:()=>{}),this.onDone=h.IH(this.props.onDone?this.props.onDone:()=>{}),this.requestNextChunk=async()=>{const{loading:e,endOfResultsReached:t,initialRequestCompleted:o,currentCursor:n,currentChunkNumber:i,ready:s,error:a}=this.stores.store.state,{incrementChunkSize:l,initialChunkSize:c}=this.props;if(e||t||o&&a)return;this.stores.store.setState({...this.stores.store.state,loading:!0});const d=o?l:c;let u;o||Q.Z.state.initialRenderCompleted||this.environment.device.isAndroid||(u=new g._W(async function(e,t){const o=e.currentUser.id;if(!o||!e.defaultRecordCache.persistedRecordCache)return Promise.resolve(void 0);(await e.defaultRecordCache.persistedRecordCache.getPageBlocksByParent({page:t,userId:o})).forEach((t=>{e.defaultRecordCache.inMemoryRecordCache.setRecord({pointer:t.pointer,userId:t.userId},t.value),e.defaultRecordCache.inMemoryRecordCache.emitRecord(t.pointer,[]),F.unsubscribeAfterDelay({environment:e,pointer:t.pointer,userId:t.userId})}))}(this.environment,{id:this.props.pageStore.id,table:this.props.pageStore.table})));try{const e=await this.requestPageChunk(d,n,i||0,u);o&&await r.default.afterNextFlush();const t=this.isScrolledToPosition()&&(!(h=this.props.scrollToBlockIds)||H.C.findSelectablesFromIds(h).length===h.length),a=s||!e||t;!s&&a&&r.default.afterNextFlush((()=>{r.default.afterNextFlush((()=>{this.onReady()}))}));const l=!e;this.stores.store.setState({...this.stores.store.state,ready:a,initialRequestCompleted:!0,loading:!1,currentCursor:e?e.cursor:void 0,currentChunkNumber:e?e.chunkNumber:void 0,endOfResultsReached:l,error:void 0}),l&&this.onDone()}catch(f){this.stores.store.setState({...this.stores.store.state,ready:!0,initialRequestCompleted:!0,loading:!1,error:(0,p.t)(f)})}var h},this.requestPageChunk=async(e,t,o,n)=>{const{device:i}=this.environment,{pageStore:r}=this.props,l=(0,u.C)(r.pointer.spaceId),c={page:{id:r.id,spaceId:l},limit:e,cursor:t||{stack:[]},chunkNumber:o,verticalColumns:i.isMobile},d=t?Promise.resolve(void 0):async function(e,t){e&&await S.Nz(t,e)}(this.props.scrollToBlockIds,this.props.pageStore),p=this.environment.prefetchCache.isEnabled&&!Q.Z.state.initialRenderCompleted||Q.Z.state.initialRenderCompleted&&J.default.checkGate({gateName:"navigation_render_parallel_requests"})?this.performLocalOrRemoteLoadPageChunkInParallel({request:c,initialPreloadPromise:n}):this.performLocalOrRemoteLoadPageChunkSerially({request:c,initialPreloadPromise:n});f.setSubMetric({name:"render_end_to_await_page_chunk_start",startTime:e=>{var t;return null===(t=e.render_start_to_render_end)||void 0===t?void 0:t.endTime},endTime:performance.now()});const h=await p;if(!h)throw new Error("No successful load result found.");if(!Q.Z.state.initialRenderCompleted&&0===o){f.setSubMetric({name:"await_page_chunk_start_to_await_page_chunk_end",startTime:e=>{var t;return null===(t=e.render_end_to_await_page_chunk_start)||void 0===t?void 0:t.endTime},endTime:performance.now()});const e=this.environment.prefetchCache;f.updateMetricData({page_chunk_source:h.source,page_chunk_prefetch:e.isEnabled?e.getPrefetchAnalytic("initialLoadPageChunk"):{type:"disabled"}})}if(this.environment.currentUser.isLoggedIn()){Y.Z.addFromRecordMapWithRole(h.recordMap),Y.Z.isEmpty()||C.dY({environment:this.environment});const e=r.getFormat(),t=r.getType();(0,k.K6)()&&t&&(0,a.dM)(t)&&((null==e?void 0:e.app_config_uri)===s.NB||(null==e?void 0:e.app_config_uri)===s.Aw)&&async function(e,t){await y.resyncJiraCollection(e,{pagePointer:t})}(this.environment,r.pointer)}const b=performance.now();await(0,g.aM)(d,5e3),Q.Z.state.initialRenderCompleted||0!==o||f.updateMetricData({scroll_to_blocks_wait_time:performance.now()-b}),m.O({rootStore:r,cursors:[h.cursor]});const v=h.cursor.stack.length>0?h.cursor:void 0;if(v)return{cursor:v,chunkNumber:o+1}}}shouldComponentUpdate(){return!0}didMount(){super.didMount(),this.lastOnlineState=G.Z.state.online,this.node=n.findDOMNode(this),this.scrollableAncestor=(0,W.VW)(this.node),G.Z.addListener(this.handleConnectionStateChange)}didMountOrUpdate(){super.didMountOrUpdate();const{pageStore:e}=this.props,{initialRequestCompleted:t,error:o}=this.stores.store.state;this.trackPage.effect((()=>{if(e.useCrdt()&&t&&!o)return $.Z.trackPage(e),()=>$.Z.untrackPage(e)}),[e.id,e.useCrdt(),t,o]),this.requestNextChunk()}willUnmount(){super.willUnmount(),this.lastTimeout&&window.clearTimeout(this.lastTimeout),G.Z.removeListener(this.handleConnectionStateChange),this.trackPage.unmount()}renderComponent(){const{ready:e,error:t,initialRequestCompleted:o,endOfResultsReached:n}=this.stores.store.state;return this.props.render({error:t,ready:e,initialRequestCompleted:o,endOfResultsReached:n,isCollectionInPage:this.isCollectionInPage})}async performRemoteLoadPageChunk(e){const{request:t,abortSignal:o}=e,{pageStore:n,pageVisitStore:i}=this.props,r=q({environment:this.environment,request:t,abortSignal:o,prefetchCacheKey:re(t)});let s;if(ie(t)){b.Ri(this.environment,{blockStore:n,pageVisitStore:i,incremental:!1}).catch((()=>{}));const e=ne({environment:this.environment,blockPointer:n.pointer});w.A$("backlinks","section_show")&&(s=async function(){await(0,g.OI)(1e3,e)})}const a=await r;if(s&&await s(),"success"===a.type){const e=d.PF.create(a.data.recordMap);return this.isCollectionInPage=this.didLoadANonParentCollection(t.page,e,n.inMemoryRecordCache),{recordMap:e,cursor:a.data.cursor,source:"remote"}}}async performLocalLoadPageChunk(e){const{request:t,initialPreloadPromise:o,abortSignal:n,useInMemoryCacheOnly:i,isRacingWithAnotherRequest:r}=e,{pageStore:s}=this.props;try{const e=U.A.measure("localLoadPageChunk",`${t.page.id} ${t.cursor.stack.length}`,(()=>z({environment:this.environment,request:t,prefetchPromise:o,abortSignal:n,useInMemoryCacheOnly:i,isRacingWithAnotherRequest:r})));let a;if(0===t.chunkNumber){const e=ne({environment:this.environment,blockPointer:s.pointer});w.A$("backlinks","section_show")&&(a=async function(){await(0,g.OI)(1e3,e)})}const l=await e;if(null!=n&&n.aborted)throw new Error("Abort signal received");if(a&&(await a(),null!=n&&n.aborted))throw new Error("Abort signal received");const c=d.PF.create(l.recordMap);return v.fL({environment:this.environment,inMemoryRecordCache:s.inMemoryRecordCache,recordMap:c,debugSource:"PageLoadingContainer.performLocalLoadPageChunk"}),this.isCollectionInPage=this.didLoadANonParentCollection(t.page,c,s.inMemoryRecordCache),{cursor:l.cursor,recordMap:c,source:"local"}}catch(a){ee&&console.error(a)}}didLoadANonParentCollection(e,t,o){var n;if(this.isCollectionInPage)return!0;const i=null===(n=o.getRecord({pointer:{table:"block",id:e.id,spaceId:e.spaceId},userId:this.environment.currentUser.id}))||void 0===n?void 0:n.value;if(i)for(const l of t.getByTable("block")){var r,s,a;if(("collection_view"===(null===(r=l.value)||void 0===r||null===(r=r.value)||void 0===r?void 0:r.type)||"collection_view_page"===(null===(s=l.value)||void 0===s||null===(s=s.value)||void 0===s?void 0:s.type))&&i.parent_id!==(null===(a=l.value)||void 0===a||null===(a=a.value)||void 0===a?void 0:a.collection_id))return!0}return!1}async performLocalOrRemoteLoadPageChunkInParallel(e){const t=await this.performLocalLoadPageChunk({...e,useInMemoryCacheOnly:!0,isRacingWithAnotherRequest:!1});if(t)return t;const o=re(e.request),n=o?this.environment.prefetchCache.getPrefetchStatus(o):void 0,i=new AbortController,r=this.performRemoteLoadPageChunk({...e,abortSignal:i.signal});if(!this.environment.defaultRecordCache.persistedRecordCache)return await r;if(o&&"success"===n)return await r;const s=new AbortController,a=[{promise:this.performLocalLoadPageChunk({...e,abortSignal:s.signal,isRacingWithAnotherRequest:!0}),abortController:s},{promise:r,abortController:i}],{winner:l}=await(0,g.S3)(a.map((e=>e.promise))),c=0===l?1:0,d=a[l],u=a[c],p=await d.promise;return p?(u.abortController.abort(),p):await u.promise}async performLocalOrRemoteLoadPageChunkSerially(e){const t=await this.performLocalLoadPageChunk({...e,isRacingWithAnotherRequest:!1});return t||await this.performRemoteLoadPageChunk(e)}isScrolledToPosition(){const{scrollToPosition:e}=this.props;return!this.scrollableAncestor||!h.hj(e)||e<=this.scrollableAncestor.scrollHeight-this.scrollableAncestor.clientHeight}}te.displayName="PageLoadingContainer";const oe=te;async function ne(e){const{blockPointer:t,environment:o}=e;o.LocalBacklinkStore.initializeBacklinks({block:{id:t.id,spaceId:(0,u.C)(t.spaceId)},currentUserId:o.currentUser.id,environment:o});try{await o.LocalBacklinkStore.awaitLoaded(t.id)}catch(n){}}function ie(e){return 0===e.chunkNumber}function re(e){return ie(e)?"initialLoadPageChunk":void 0}},178901:(e,t,o)=>{o.d(t,{Z:()=>N});o(757658);var n=o(667294),i=o(800480),r=o(886628),s=o(724405),a=o(519889),l=o(151454),c=o(709291),d=o(531701),u=o(653965),p=o(401898),h=o(948514),g=o(983420),f=o(220095),m=o(917504),b=o(165598),v=o(300439),S=o(305971),y=o(95802),C=o(80444),w=o(524229),k=o(319385),x=o(417903),_=o(222294),A=o(542057),P=o(206258),M=o(186486),R=o(27724),I=o(924666),T=o(623063),V=o(309612),O=o(368930),Z=o(45653),L=o(265200),j=o(785893);const E={position:"absolute",top:0,left:0,zIndex:l.eu},B=18,K=20,U=22,D=38,F=15;const N=function(e){const{pageVisitStore:t,presenceStore:o}=e,s=(0,i.O7)(),{isMobile:a}=s.device,l=(0,n.useRef)(null),c=(0,S.E)("block_attribution"),d=(0,r.SI)((()=>{var t;if(!c)return[];const n=e.isPeekView?A.Z:x.Z,i=n.state.scrollTop-5e3,r=i+((null===(t=n.state.clientRect)||void 0===t?void 0:t.height)||0)+5e3,s=function(e){var t;const{blockAttributionEnabled:o,containerEl:n,presenceStore:i}=e,{currentUserSettingsStore:r}=C.default.state,s=(null==r||null===(t=r.getSettings())||void 0===t?void 0:t.show_block_attribution)??!0;if(!o||!s)return[];const{rootStore:a}=i.state;if(!n||!a||"editing"!==I.default.state.mode||h.Z.state.open||w.Z.state.open||_.Z.state.isKeyboardMode)return[];let l;for(const u of R.default.state.stores){const e=u.findRecordStoreUIAncestor((e=>e instanceof P.G&&e.isTransclusionType())).ancestor;e&&e instanceof P.G&&"transclusion_container"===e.getType()&&(l=e)}const c=y.C.getMembersByDOMOrder({filter:()=>!0}),d=n.getBoundingClientRect(),p=b.MI({blockStore:a,traverseTransclusionReferences:!1}).flatMap((e=>{const t=[];if(e.isInsideTransclusion()||e.isTransclusionType()){let o=e;if("transclusion_reference"===e.getType()){const t=e.getTransclusionReferenceTargetStore();t&&(o=t)}"transclusion_reference"!==e.getType()&&"transclusion_container"!==e.getType()||(o!==l?t.push(z(e,c,d)):b.MI({blockStore:o,traverseTransclusionReferences:!1}).map((e=>t.push(z(e,c,d)))))}else t.push(z(e,c,d));return t})).filter((e=>!u.o8(e)));p.sort(((e,t)=>e.top-t.top));const g=p.filter(((e,t,o)=>0===t||e.actor.id!==o[t-1].actor.id));if(1===g.length)return[];return g}({blockAttributionEnabled:c,containerEl:l.current,presenceStore:o});s.sort(((e,t)=>e.top-t.top));const a=[];return s.every((e=>e.top>=i&&e.top<=r&&(a.push(e),!0))),a}),[c,o,e.isPeekView],{debugName:"attributionAvatarStore",useDeepEqual:!0});(0,n.useEffect)((()=>{let e;const t=u.Ds(d.recompute,100);return c&&(window.addEventListener("resize",t),e=setInterval(t,1e3)),()=>{window.removeEventListener("resize",t),clearInterval(e)}}),[d,c]);const p=(0,r.Kw)(d),g=[...(0,r.VK)((()=>function(e){const{attributionAvatars:t,pageVisitStore:o,presenceStore:n,environment:i,containerEl:r}=e,s=new Set(t.map((e=>{let{blockStore:t}=e;return t.id}))),{rootStore:a}=n.state;if(!a)return[];if(!r)return[];const l=i.currentUser.id,c=(0,f.AQ)(o,n).filter((e=>e.userId!==l&&(0,f.MR)(i,e)));if(c.length>0){const e={},t=y.C.getMembersByDOMOrder({filter:()=>!0}),o=r.getBoundingClientRect(),n=M.default.state;return u.oA(c.map((i=>{const r=(0,f.EB)(i),l=null==i?void 0:i.blockPath;let c;if(l&&l.length>0?c=function(e,t,o){const n=new Map(t.map(((e,t)=>[e,t])));let i,r;for(const s of e){const e=s.props.store,t=n.get(e.id);if(void 0!==t&&((void 0===r||t<r)&&o.uiContains(e)&&s.props.shouldShowHalo&&(i=s,r=t),0===r))return i}return i}(t,l,a):r&&(c=q(t,r,a)),!c)return;const d=c.props.store.id;e.hasOwnProperty(d)||(e[d]=0),e[d]++;const u=c.getNode();if(!(u&&u instanceof Element))return;const p=u.getBoundingClientRect(),h=n.isOpen&&n.currentStore.id===d?D:0,g=s.has(d)?1:0;if(p){let t=p.left-o.left-h;const n=c.getContextHorizontalScroller();if(n){const e=n.stores.store.state.clientRect,i=null==e?void 0:e.left,r=null==e?void 0:e.right;if(r&&p.left>r)return;i&&(t=Math.max(i-o.left-h,t))}return{type:"presence",userId:i.userId,left:t,top:p.top-o.top+(e[d]+g-1)*F,blockType:c.props.store.getType()}}})))}return[]}({attributionAvatars:p,pageVisitStore:t,presenceStore:o,environment:s,containerEl:l.current})),[s,t,o,p],{debugName:"presenceAvatars",useDeepEqual:!0}),...p];return(0,j.jsx)("div",{className:"notion-presence-container",style:E,ref:l,children:(0,j.jsx)(V.Z,{render:()=>g.map((t=>{const{left:o,top:n}=t,i={avatarWrapperAnimation:{translateX:a?o-21:o-28,translateY:a?n+5:n+3,scale:1,opacity:1},avatarEnterExitAnimation:{scale:.7,opacity:0}},r={...i.avatarWrapperAnimation,...i.avatarEnterExitAnimation};return(0,j.jsx)(T.Z,{isVisible:!0,enterAnimationStyle:r,exitAnimationStyle:r,animationStyle:i.avatarWrapperAnimation,render:()=>(0,j.jsx)("div",{children:(0,j.jsx)(W,{avatar:t,presenceStore:e.presenceStore})})},"attribution"===t.type?t.uniqueId:t.userId)}))})})};function q(e,t,o){return e.find((e=>{const n=e.props.store;return Boolean(n&&n.id===t&&o.uiContains(n)&&e.props.shouldShowHalo)}))}function z(e,t,o){const n=e.getLastEditedByPointer(),i=M.default.state;if(!n||n.table!==a.KJ)return;const r=q(t,e.id,e);if(!r)return;const s=e.getType();if("collection_view"===s||"collection_view_page"===s||"divider"===s||"table"===s||"table_row"===s||"tab"===s)return;if(e.isEmptyEditableBlock())return;const l=r.getNode();if(!(l&&l instanceof Element))return;const c=l.getBoundingClientRect();if(!c)return;const d=i.isOpen&&i.currentStore===e?D:0,u=(0,v.zt)((0,v.oJ)(e),e),p=(L.Z.height-B)/2,h=c.top-o.top+u-p,g=c.left-o.left;return d>0?{type:"attribution",actor:n,left:g-d,top:h,uniqueId:`${String(e.key)}+left`,blockStore:e}:{type:"attribution",actor:n,left:g,top:h,uniqueId:String(e.key),blockStore:e}}function W(e){const{device:t}=(0,i.O7)(),{isMobile:o}=t,{avatar:n}=e,l=(0,c.useIntl)(),u=(0,S.E)("presence_avatar_tooltips"),h="presence"===n.type&&n.blockType?n.blockType:void 0,f=(0,r.VK)((()=>k.default.checkGate({gateName:"colorful_presence_avatars"})),[]),b=o?K:U,v=(0,s.yK)((e=>{const t=h&&["breadcrumb","bulleted_list","numbered_list","toggle"].includes(h),i={width:b,height:b,borderRadius:b};return{uiUserAvatarStyles:{...i},avatarInnerOutline:{...i,outlineStyle:"solid",outlineColor:e.UIUserAvatarInnerOutline,outlineWidth:.5,outlineOffset:-.5},avatarBorder:"presence"===n.type?{...i,outlineStyle:"solid",outlineColor:(0,d.iY)(n.userId,e),outlineWidth:1.5,outlineOffset:-.5}:{},avatarWrapper:{...i,position:"absolute",top:0,left:o&&t?3:0,outlineStyle:"solid",outlineWidth:.5,outlineOffset:1,outlineColor:e.UIUserAvatarOuterOutline},initialColor:"presence"===n.type?{color:(0,d.iY)(n.userId,e)}:{}}}),[o,h,b,n]),y=(0,r.VK)((()=>{const{rootStore:t}=e.presenceStore.state;if(t){if("presence"===n.type){const e=P.U6.createChildStore(t,{table:a.KJ,id:n.userId});return e.isDefined()?{type:"presence",userStore:e}:null}if("attribution"===n.type){const e=(0,g.nc)({parentStore:t,pointer:n.actor});return e.isDefined()?{type:"attribution",userId:e.id,name:e.getDisplayName(l),blockStore:n.blockStore}:null}(0,p.t1)(n)}return null}),[n,l,e.presenceStore]);return y?(0,m.Z)((e=>"presence"===y.type&&f?(0,j.jsx)("div",{style:v.avatarWrapper,...e,children:(0,j.jsx)("div",{style:v.avatarBorder,children:(0,j.jsx)(Z.Z,{iconStyle:v.avatarInnerOutline,hasTooltip:u,userStore:y.userStore,style:v.uiUserAvatarStyles,size:b,avatarShouldShowShadow:!0,initialOverrideStyle:v.initialColor})})}):"presence"===y.type?(0,j.jsx)("div",{style:v.avatarWrapper,...e,children:(0,j.jsx)(Z.Z,{hasTooltip:u,userStore:y.userStore,style:v.uiUserAvatarStyles,size:b,avatarShouldShowShadow:!0})}):"attribution"===y.type?(0,j.jsx)("div",{style:v.avatarWrapper,...e,children:(0,j.jsx)(O.Z,{userId:y.userId,name:y.name,style:v.uiUserAvatarStyles,size:U,tooltipStore:y.blockStore})}):void(0,p.t1)(y))):null}},457345:(e,t,o)=>{o.d(t,{a6:()=>p,lG:()=>u,zd:()=>h});o(667294),o(133728),o(568626),o(471924),o(772141);var n=o(709291),i=(o(552629),o(436610)),r=o(547307),s=(o(476464),o(164964),o(419306),o(626907),o(367669),o(318245),o(188923)),a=o(799332),l=(o(429677),o(766708)),c=o(28578),d=o(785893);function u(e){c.ZP.reset(),s.default.state.open?a.Z.setState({...a.Z.state,open:!0}):l.Z.setState({...l.Z.state,open:!0}),i.DB(e,{share_menu_session_id:c.ZP.state.sessionId})}function p(e){s.default.state.open?a.Z.setState({...a.Z.state,open:!1}):l.Z.setState({...l.Z.state,open:!1}),i.Rb(e,{share_menu_session_id:c.ZP.state.sessionId})}async function h(e){const{inviteTargetsStore:t}=e,o=(0,d.jsx)(n.FormattedMessage,{id:"shareMenu.closeInviteDialog.confirmationMessage",defaultMessage:"Your changes have not been saved. Discard changes?"}),i=(0,d.jsx)(n.FormattedMessage,{id:"shareMenu.closeInviteDialog.confirmationButton.label",defaultMessage:"Yes"}),s=(0,d.jsx)(n.FormattedMessage,{id:"shareMenu.closeInviteDialog.cancelButton.label",defaultMessage:"Cancel"});if(t.state.inviteTargets.length>0){return(await r.confirmUserActionV2({message:o,acceptLabel:i,cancelLabel:s})).accept}return!1}},943604:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o(749085).default.createValue({open:!1},{name:"ConfirmOverwriteModalStore"})},572458:(e,t,o)=>{o.d(t,{A:()=>s,Z:()=>r});var n=o(531701),i=o(415095);function r(e){const t=e.name,o=e.email;let n;if(t||o){if(t){const e=t.split(" ").filter((e=>e.length>0));n=e.length>1?String(i.p4(e[0])[0])+String(i.p4(e[e.length-1])[0]):String(i.p4(t)[0])+String(i.p4(t)[1])}else n=null==o?void 0:o.substring(0,2);return n=n?n.toUpperCase():void 0,n}}function s(e,t){return e&&(0,n.iY)(e,t)}},276915:(e,t,o)=>{o.d(t,{Z:()=>n});const n={appCursorListener:{sidebar:1,secondarySidebar:2,editor:3,aiChat:3,marketplace:3}}}}]);