"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[24207],{140190:(e,t,o)=>{o.d(t,{S:()=>y});var r=o(667294),n=o(800480),i=o(724405),a=o(542853),s=o(654497),l=o(137810),c=o(524677),u=o(898104),d=o(489728),p=o(526388),m=o(825464),h=o(785893);const g={height:"auto",marginBlock:-6,marginInline:-5,maxWidth:"auto",paddingBlock:6,paddingInline:5},y=(0,r.forwardRef)((function(e,t){const{children:o,disabled:y,icon:f,isCompact:C,isError:x,hasActionRequired:S,isSecondary:T,onClick:k,style:b,tooltipMessage:M}=e,R=(0,n.O7)(),A=(0,i.yK)((e=>({button:{...v(e,{isError:x,hasActionRequired:S,isSecondary:T}),gap:4,padding:"0 8px 0 5px",...C?g:void 0,...b},children:{...l.Z.textOverflowStyle,flex:"1 1 auto"},icon:{...x?{fill:e.lightErrorText}:void 0},warningIcon:{color:e.errorText,fill:e.errorText,height:12,flex:"0 0 auto",width:12},chevronIcon:{fill:e.lightIconColor,flex:"0 0 auto",height:10,width:10}})),[x,S,T,C,b]),_=(0,r.useMemo)((()=>f?()=>f(A.icon):void 0),[f,A.icon]),w=(0,r.useCallback)((()=>M??null),[M]),I=(0,r.useCallback)((e=>{u.ZH({debug:{userAction:"AutomationDropdownButton.handleClick"},environment:R}),c.ZH({debug:{userAction:"AutomationDropdownButton.handleClick"},environment:R}),null==k||k(e)}),[k,R]);return(0,h.jsx)(p.Z,{delayThreshold:0,disableTooltip:!Boolean(M),placement:m.u.Bottom,render:e=>(0,h.jsxs)(d.Z,{...e,icon:_,disabled:y,disabledFeedback:y,onClick:I,ref:t,shouldShrink:!0,style:A.button,children:[(0,h.jsx)("div",{style:A.children,children:o}),x&&(0,s.t)(A.warningIcon),(0,a.i)(A.chevronIcon)]}),renderTooltip:w})}));function v(e,t){const{isError:o,hasActionRequired:r,isSecondary:n}=t;return o?{color:e.errorText}:r?{color:e.blueColor,fontWeight:l.Z.fontWeight.medium}:n?{color:e.regularTextColor}:{color:e.mediumTextColor}}},819471:(e,t,o)=>{o.d(t,{Y:()=>h,b:()=>m});var r=o(667294),n=o(800480),i=o(886628),a=o(709953),s=o(898104),l=o(301743),c=o(374194),u=o(426344),d=o(312455),p=o(785893);function m(e){const{value:t,onChange:o,wrapStyle:i,...a}=e,[d,m]=(0,r.useState)(!1),h=(0,n.O7)(),g=(0,u.Z)(!0);return(0,p.jsx)(l.Z,{debugName:"AutomationPlainTextInput",capture:d,children:(0,p.jsx)("div",{...g,style:i,children:(0,p.jsx)(c.Z,{value:t,onChange:e=>o(e.currentTarget.value),onBlur:()=>{m(!1)},onFocus:()=>{s.ZH({debug:{userAction:"AutomationPlainTextInput.AutomationPlainTextInput"},environment:h}),m(!0)},...a})})})}function h(e){const{store:t,...o}=e,{maybePersistedTransactionActions:n}=(0,d.i)(),s=(0,i.VK)((()=>t.getValue()??""),[t]),l=(0,r.useCallback)((e=>{n.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:o=>{a.sO({store:t,transaction:o,value:e})}})}),[n,t]);return(0,p.jsx)(m,{value:s,onChange:l,...o})}},808808:(e,t,o)=>{o.d(t,{L:()=>X});o(757658),o(21703);var r=o(667294),n=o(800480),i=o(886628),a=o(724405),s=o(984619),l=o(399319),c=o(173110),u=o(335102),d=o(158573),p=o(559054),m=o(356666),h=o(471924),g=o(421202),y=o(606287),v=o(709291),f=o(653965),C=o(401898),x=o(108406),S=o(332628),T=o(73657),k=o(552275),b=o(268894),M=o(478140),R=o(632163),A=o(511470),_=o(672495),w=o(526388),I=o(721396),E=o(278948),V=o(296994),P=o(460709),L=o(98742),j=o(277907),F=o(675822),q=o(825464),B=o(80444),Z=o(229798),N=o(206258),D=o(25742),U=o(595193),O=o(785893);const W=(0,v.defineMessages)({searchInputPlaceholder:{defaultMessage:"Type to searchâ€¦",id:"automations.AutomationTargetPickerMenu.search.placeholder"}}),K=5,Q=20,H=20;function X(e){const t=(0,n.O7)(),o=(0,U.F)({maxWidth:360,paddingTop:12,width:280}),i=(0,r.useMemo)((()=>h.Il()),[]),a=(0,r.useCallback)((()=>{x.tW({environment:t,eventName:"abandoned_search",sessionId:i,source:S.S7.Automation})}),[t,i]);return o.menuType===P.og.Popup&&(o.onClickOutside=a),(0,O.jsx)(M.Z,{...o,children:(0,O.jsx)(Y,{...e,searchSessionId:i})})}function Y(e){const{actionId:t,automationContextStore:o,onChange:a,onClose:m,selectedTarget:h,skipCollections:b,skipPages:M,skipVariables:P,searchSessionId:U}=e,W=(0,n.O7)(),Q=(0,i.qz)(void 0,Z.Z),X=(0,i.VK)((()=>{const{context:e}=o;if("button_property"===e.type)return e.collectionContextStore.collectionViewBlockStore()}),[o]),Y=(0,D.z)({actionId:t}),ee=(0,i.VK)((()=>{if(P)return[];if(Y){return Object.values(Y).filter((e=>{if(!(0,l.uy)(e.type,{type:"block"}))return!1;if("event"===o.context.type&&e.kind===c.yp.ContextValue){const t=(0,u.MY)(e.id);return!("global"===t.source&&"button_page"===t.global)}return!0}))}return[]}),[P,o,Y],{useDeepEqual:!0}),te=(0,r.useMemo)((()=>o.context.parentRecordStore),[o.context]),oe=(0,i.VK)((()=>te.getSpaceId()),[te]),[re,ne]=(0,r.useReducer)(G,{automationVariables:[],collectionQueryLimit:K,pageQueryLimit:K,searchTerm:""});(0,r.useEffect)((()=>{if(re.searchTerm){const e=(0,d.ZP)(re.searchTerm,ee,(e=>e.kind===c.yp.ContextValue?e.name:""));ne({type:"set_variables",variables:e})}else ne({type:"set_variables",variables:ee})}),[re.searchTerm,ee]);const ie=function(e){const{collectionViewBlockStore:t,limit:o,parentStore:a,searchTerm:s,skip:l}=e,c=(0,n.O7)(),u=(0,i.VK)((()=>B.default.state.currentSpaceStore),[]),[d,m]=(0,r.useReducer)(J,{error:void 0,isLoading:Boolean(l),results:void 0,total:void 0}),h=(0,j.XJ)(V.FF.searchActions),[g]=(0,p.r5)((async()=>{if(l||"resolved"!==h.status)return;const e=h.value,r=await e.searchCollectionsWithRecents({collectionViewBlockStore:t,environment:c,spaceStore:u,limit:o,parentStore:a,query:s,requireEditPermissions:!0,searchSessionId:void 0});return{results:r.results,total:r.total}}),[t,c,o,a,s,l,h.status,h.value,u],{debounce:F.vp});return(0,r.useEffect)((()=>{if("pending"===g.status||"idle"===g.status)m({type:"query_loadstart"});else if("resolved"===g.status){var e,t;m({results:null===(e=g.value)||void 0===e?void 0:e.results,total:null===(t=g.value)||void 0===t?void 0:t.total,type:"query_finish"})}else"rejected"===g.status?m({error:g.error,type:"query_error"}):(0,C.t1)(g)}),[g]),d}({collectionViewBlockStore:X,limit:re.collectionQueryLimit,parentStore:te,searchTerm:re.searchTerm,skip:b}),ae=function(e){const{limit:t,searchTerm:o,skip:i,spaceId:a}=e,s=(0,n.O7)(),[l,c]=(0,r.useReducer)(J,{error:void 0,isLoading:Boolean(i),results:void 0,total:void 0}),[u]=(0,p.r5)((async()=>{if(i||!a)return;const e=await V.FF.searchActions.load(),r=await e.searchPagesInSpace({boostRecentlyViewedPages:!0,environment:s,excludeTemplates:!0,limit:t,query:o,requireEditPermissions:!1,source:"automation_page_picker",spaceId:a});return{results:r.results.map((e=>e.id)),total:r.total}}),[s,t,o,i,a],{debounce:F.vp});return(0,r.useEffect)((()=>{if("pending"===u.status||"idle"===u.status)c({type:"query_loadstart"});else if("resolved"===u.status){var e,t;c({results:null===(e=u.value)||void 0===e?void 0:e.results,total:null===(t=u.value)||void 0===t?void 0:t.total,type:"query_finish"})}else"rejected"===u.status?c({error:u.error,type:"query_error"}):(0,C.t1)(u)}),[u]),l}({limit:re.pageQueryLimit,searchTerm:re.searchTerm,skip:M,spaceId:oe}),se=(0,r.useCallback)((e=>{"collection"===e.type&&x.tW({environment:W,eventName:"select_search_item",queryLength:re.searchTerm.length,sessionId:U,source:S.S7.Automation,totalResults:ie.total}),h&&!f.Xy(h,e)?a(e):h?m():a(e)}),[W,U,re.searchTerm,ie.total,h,a,m]),le=(0,r.useCallback)((e=>{const t=e.target.value;ne({searchTerm:t,type:"set_search_term"}),Q.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})}),[Q]),ce=(0,r.useCallback)((()=>{ne({queryLimit:re.collectionQueryLimit+H,type:"set_collection_query_limit"})}),[re.collectionQueryLimit]),ue=(0,r.useCallback)((()=>{ne({queryLimit:re.pageQueryLimit+H,type:"set_page_query_limit"})}),[re.pageQueryLimit]),de="variable"===(null==h?void 0:h.type)?h.id:void 0,pe="collection"===(null==h?void 0:h.type)?h.collection.id:void 0,me="page"===(null==h?void 0:h.type)?h.page.id:void 0,he=[],ge=function(e){const{automationVariables:t,onClick:o,selectedVariableId:r}=e,n=t.map((e=>{if(e.kind!==c.yp.ContextValue)throw new Error("Not implemented yet.");return{action:()=>o({id:e.id,type:"variable"}),key:e.id,render:t=>(0,O.jsx)(w.Z,{placement:q.u.Right,render:o=>(0,O.jsx)(k.Z,{...(0,L.Z)(o,t),checkState:e.id===r,title:(0,O.jsx)("div",{style:{display:"flex"},children:(0,O.jsx)(I.Fg,{value:e,format:s.lo.Medium,isSingle:!0,shouldShrink:!0})})}),renderTooltip:()=>e.name,textWrap:!0})}}));if(0===n.length)return;return{key:"variable_results",items:n,render:e=>(0,O.jsx)(_.Z,{...e,title:(0,O.jsx)(v.FormattedMessage,{defaultMessage:"From this automation",id:"automations.AutomationTargetPickerMenu.variablesSection.title"})})}}({automationVariables:re.automationVariables,onClick:se,selectedVariableId:de});ge&&he.push(ge);const ye=function(e){const{collectionQueryResult:t,onCollectionMenuItemClick:o,onShowMoreItemClick:r,parentRecordStore:n,selectedCollectionId:i}=e;if(t.isLoading)return;let a=[];if(t.error)a.push({action:r,key:"show_more_collection_results",render:e=>(0,O.jsx)(T.Z,{...e,caption:(0,O.jsx)(v.FormattedMessage,{defaultMessage:"Sorry, something went wrong while searching for databases.",id:"automations.AutomationTargetPickerMenu.errorCollections.label"}),shouldWrapCaption:!0})});else{const e=t.results??[],s=e.length;a=e.map((e=>{const t=N.NW.createChildStore(n,{table:y.vF,id:e});return{action:()=>o({collection:t.getSpaceShardedPointer(),type:"collection"}),key:e,render:o=>(0,O.jsx)(A.Z,{...o,checkState:e===i,store:t})}}));const l=t.total??0,c=Math.max(0,l-s);c>0&&a.push({action:r,key:"show_more_collection_results",render:e=>(0,O.jsx)($,{...e,showMoreCount:c})})}if(0===a.length)return;return{key:"collection_results",items:a,render:e=>(0,O.jsx)(_.Z,{...e,title:(0,O.jsx)(v.FormattedMessage,{defaultMessage:"Databases",id:"automations.AutomationTargetPickerMenu.collectionsSection.title"})})}}({collectionQueryResult:ie,onCollectionMenuItemClick:se,onShowMoreItemClick:ce,parentRecordStore:te,selectedCollectionId:pe});ye&&he.push(ye);const ve=function(e){const{pageQueryResult:t,onPageMenuItemClick:o,onShowMoreItemClick:r,parentRecordStore:n,selectedPageId:i}=e;if(t.isLoading)return;let a=[];if(t.error)a.push({action:r,key:"show_more_collection_results",render:e=>(0,O.jsx)(T.Z,{...e,caption:(0,O.jsx)(v.FormattedMessage,{defaultMessage:"Sorry, something went wrong while searching for pages.",id:"automations.AutomationTargetPickerMenu.errorPages.label"}),shouldWrapCaption:!0})});else{const e=t.results??[],s=e.length;a=e.map((e=>{const t=N.G.createChildStore(n,{table:g.iU,id:e});return{key:e,render:o=>(0,O.jsx)(A.Z,{...o,checkState:e===i,store:t}),action:()=>o({page:t.getSpaceShardedPointer(),type:"page"})}}));const l=t.total??0,c=Math.max(0,l-s);c>0&&a.push({action:r,key:"show_more_page_results",render:e=>(0,O.jsx)($,{...e,showMoreCount:c})})}if(0===a.length)return;return{key:"page_results",items:a,render:e=>(0,O.jsx)(_.Z,{...e,title:(0,O.jsx)(v.FormattedMessage,{defaultMessage:"Pages",id:"automations.AutomationTargetPickerMenu.pagesSection.title"})})}}({onPageMenuItemClick:se,onShowMoreItemClick:ue,pageQueryResult:ae,parentRecordStore:te,selectedPageId:me});ve&&he.push(ve);const fe=ie.isLoading||ae.isLoading;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(z,{onChange:le,value:re.searchTerm}),fe?(0,O.jsx)(_.Z,{children:(0,O.jsx)(E.Z,{})}):!fe&&he.length>0?(0,O.jsx)(R.Z,{initialFocus:0,sections:he,store:Q,type:R.i.Vertical}):(0,O.jsx)(T.Z,{caption:(0,O.jsx)(v.FormattedMessage,{defaultMessage:"No results",id:"automations.AutomationTargetPickerMenu.noResults.label"})})]})}function z(e){const{onChange:t,value:o}=e,{isMobile:r}=(0,n.Fy)(),i=(0,v.useIntl)(),s=(0,a.yK)((()=>({section:{paddingBlockStart:0}})),[]);return(0,O.jsx)(_.Z,{style:s.section,children:(0,O.jsx)(b.ZP,{focusInitial:!r||void 0,onChange:t,placeholder:i.formatMessage(W.searchInputPlaceholder),showClearButton:!0,value:o??""})})}const $=(0,r.forwardRef)((function(e,t){const{showMoreCount:o}=e,r=(0,a.yK)((e=>({showMoreButton:{color:e.mediumTextColor,fill:e.mediumIconColor}})),[]);return(0,O.jsx)(k.Z,{...e,icon:(0,m.o)({width:16,height:16}),ref:t,style:r.showMoreButton,title:(0,O.jsx)(v.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"automations.AutomationTargetPickerMenu.showMore.label",values:{showMore:Math.min(o,H)}})})}));function G(e,t){if("set_variables"===t.type)return{...e,automationVariables:t.variables.slice(0)};if("set_search_term"===t.type){const o=t.searchTerm?Q:K;return{...e,collectionQueryLimit:o,pageQueryLimit:o,searchTerm:t.searchTerm}}if("set_collection_query_limit"===t.type){if(e.collectionQueryLimit!==t.queryLimit)return{...e,collectionQueryLimit:t.queryLimit}}else if("set_page_query_limit"===t.type){if(e.pageQueryLimit!==t.queryLimit)return{...e,pageQueryLimit:t.queryLimit}}else(0,C.t1)(t);return e}function J(e,t){if("query_loadstart"===t.type){if(!e.isLoading)return{...e,isLoading:!0}}else{if("query_finish"===t.type)return{...e,error:void 0,isLoading:!1,results:t.results,total:t.total};if("query_error"===t.type)return{...e,error:t.error,isLoading:!1,results:void 0,total:void 0};(0,C.t1)(t)}return e}},409015:(e,t,o)=>{o.d(t,{Z:()=>a});var r=o(667294),n=o(74404);const i=(0,r.createContext)({automationContextStore:void 0,automationStore:void 0,collectionStore:void 0,currentDraggingActionId:void 0,disabled:!0,maybePersistedTransactionActions:{createAndCommit:n.U},editorPlacement:{type:"inline"},editorWidth:300,suppressActionErrors:[]});i.displayName="AutomationEditorContext";const a=i},312455:(e,t,o)=>{o.d(t,{P:()=>s,i:()=>a});o(21703);var r=o(667294),n=o(886628),i=o(409015);function a(){const e=(0,r.useContext)(i.Z),t=(0,n.VK)((()=>{var t;return null===(t=e.automationContextStore)||void 0===t?void 0:t.context.automationStore}),[e.automationContextStore]);if(!t)throw new Error("automationStore is undefined. Is this rendered inside an AutomationEditorContext.Provider?");return{...e,automationStore:t}}function s(){const{collectionStore:e,automationStore:t,...o}=a(),r=(0,n.VK)((()=>{if(!(null!=t&&t.isTriggerType("event")||null!=t&&t.isTriggerType("notification_event")))throw new Error("automationStore is wrong type. Is this called in the wrong type of automation?");return t}),[t]);if(!e)throw new Error("collectionStore is undefined. Is this rendered inside an AutomationEditorContext.Provider?");return{...o,collectionStore:e,automationStore:r}}},25742:(e,t,o)=>{o.d(t,{z:()=>s});var r=o(886628),n=o(710450),i=o(173110),a=o(312455);function s(e){const{actionId:t,actionType:o}=e,{automationContextStore:s}=(0,a.i)(),l=(0,n.Px)();return(0,r.VK)((()=>{if(!t)return null==s?void 0:s.getAllContextValues().filter((e=>!(e.kind===i.yp.ContextValue&&e.id===l)));const e=null==s?void 0:s.getContextValuesForAction(t);return null==e?void 0:e.filter((e=>e.kind===i.yp.ContextValue&&e.id===l?"send_in_app_notification"===o:"send_in_app_notification"!==o))}),[s,t,o,l])??[]}},595193:(e,t,o)=>{o.d(t,{F:()=>s,U:()=>a});var r=o(800480),n=o(886628),i=o(460709);function a(e){return e.device.isPhone||"actionSheet"===e.tabletBehavior&&e.device.isTablet?{menuType:i.og.ActionSheet}:{menuType:i.og.Popup,maxHeight:e.maxHeight,maxWidth:e.maxWidth,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,width:e.width,minWidth:e.minWidth}}function s(e){const t=(0,r.Fy)();return(0,n.VK)((()=>a({device:t,maxHeight:null==e?void 0:e.maxHeight,maxWidth:null==e?void 0:e.maxWidth,paddingTop:null==e?void 0:e.paddingTop,paddingBottom:null==e?void 0:e.paddingBottom,width:null==e?void 0:e.width,minWidth:null==e?void 0:e.minWidth,tabletBehavior:null==e?void 0:e.tabletBehavior})),[t,null==e?void 0:e.maxHeight,null==e?void 0:e.maxWidth,null==e?void 0:e.paddingTop,null==e?void 0:e.paddingBottom,null==e?void 0:e.width,null==e?void 0:e.minWidth,null==e?void 0:e.tabletBehavior])}},435294:(e,t,o)=>{o.d(t,{d:()=>a});var r=o(800480),n=o(886628),i=o(953437);function a(e){const t=(0,r.Fy)();return(0,n.VK)((()=>t.isPhone||"slideUp"===(null==e?void 0:e.tabletBehavior)&&t.isTablet?i.kQ.SlideUp:i.kQ.Popup),[t,null==e?void 0:e.tabletBehavior])}},74404:(e,t,o)=>{o.d(t,{U:()=>f,$:()=>C});o(21703);var r=o(667294),n=o(800480),i=o(886628),a=o(798963),s=o(401898),l=o(210228),c=o(718844),u=o(653965),d=o(206258);function p(e,t){var o,r;const n=null==e?void 0:e.getModel(),i=null==t?void 0:t.getModel();if(!t||!i)return!0;return!(!n||(null===(o=n.getProperties())||void 0===o?void 0:o.name)===(null===(r=i.getProperties())||void 0===r?void 0:r.name))||(!!function(e,t){const o=null==e?void 0:e.getModel(),r=t.getModel();if(!r)return!0;if((0,s.$K)(o)){if(o.isEventType()&&r.isEventType()||o.isNotificationType()&&r.isNotificationType()){const e=o.getEventConfiguration(),t=r.getEventConfiguration();return!(0,u.Xy)(e,t)}if(o.isRecurrenceType()&&r.isRecurrenceType()){const e=o.getRecurrence(),t=r.getRecurrence();return!(0,u.Xy)(e,t)}return!o.isButtonType()||!r.isButtonType()}if(r.isEventType()||r.isNotificationType()){const e=r.getEventConfiguration();return!1!==e.pagesAdded||"none"!==e.pagePropertiesEdited.type}if(r.isRecurrenceType())return!0;if(r.isButtonType())return!1;if(r.isAssistantType())return!1;(0,s.t1)(r)}(e,t)||!!function(e,t){const o=t.getSpaceId();if(!o)return!1;if((0,s.$K)(e)){const r=e.getActionIds(),n=t.getActionIds();return r.length!==n.length||!(0,u.Xy)(r,n)||r.some((r=>{const n={id:r,spaceId:o,table:c.Xj},i=d.zq.createChildStore(e,n).getModel(),a=d.zq.createChildStore(t,n).getModel();return!(0,s.$K)(i)||!(0,s.$K)(a)||!(0,u.Xy)(i.getConfig(),a.getConfig())}))}return t.getActionIds().length>0}(e,t))}var m=o(628020),h=o(503932),g=o(484398),y=o(582787),v=o(80444);function f(e){const t=new h.Y({deadlockTimeoutMs:l.DEADLOCK_WARNING_TIMEOUT_MS});return{performResult:e.perform(t),serverCommitResult:Promise.resolve()}}function C(e){const{automationId:t,spaceId:o,defaultValue:c,persist:u}=e,h=(0,n.O7)(),f=(0,i.VK)((()=>{var e;return null===(e=v.default.state.currentUserStore)||void 0===e?void 0:e.userId}),[]),C=(0,r.useMemo)((()=>{if(t&&o&&f)return{id:t,table:a.cv,spaceId:o}}),[t,o,f]),x=(0,g.$)("useUnpersistedAutomationStore",{cacheFallback:h.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0}),S=(0,r.useMemo)((()=>{if(!C)return;const e=x.getEntry({pointer:C,userId:f});if(!(0,s.$K)(e)&&f){if(!c)throw new Error("create is true but no defaultValue provided");x.setRecord({pointer:C,userId:f},{role:"editor",value:c})}return new d.Mz(h,C,{inMemoryRecordCache:x})}),[c,h,C,x,f]),T=(0,i.VK)((()=>{const e=m.np();if(C&&e)return d.Mz.createChildStore(e,C)}),[C]),k=u?T:S,b=(0,i.VK)((()=>!u&&p(T,S)),[u,T,S]),{createAndCommit:M}=(0,y.Z)({unpersistedInMemoryRecordCache:x}),R=(0,r.useCallback)((e=>u?l.createAndCommit({...e,environment:h}):M(e)),[M,h,u]);return{maybePersistedTransactionActions:{createAndCommit:R},maybePersistedAutomationStore:k,hasUnpersistedChanges:b}}},721396:(e,t,o)=>{o.d(t,{Fg:()=>m,eP:()=>d,hj:()=>p});o(21703),o(667294);var r=o(724405),n=o(173110),i=o(849019),a=o(282447),s=o(526774),l=o(401898),c=o(93044),u=o(785893);function d(e){if(e.kind===n.yp.ContextValue)return e.name;if(e.kind===n.yp.Binding||e.kind===n.yp.ThisRow)throw new Error("Not implemented yet.");(0,l.t1)(e)}function p(e){return e.kind===n.yp.ContextValue?e.tooltipName||e.name:d(e)}function m(e){const{value:t}=e,o=(0,r.Fg)(),n=d(t);let l,p;if("date"===t.type.type?l=a.V:"person"===t.type.type?l=s.O:("block"===t.type.type||"array"===t.type.type&&"block"===t.type.of.type)&&(l=i.e),l){const e=l;p=()=>e({width:12,height:12,marginRight:4})}return(0,u.jsx)(c.ZP,{...e,title:n,renderAvatar:p,shouldShrink:!0,style:{background:o.outlineBlueButtonPressedBackground,color:o.blueColor,padding:"2px 4px"}})}},768657:(e,t,o)=>{o.d(t,{Cl:()=>m,NY:()=>h});var r=o(667294),n=o(800480),i=o(886628),a=o(471924),s=o(421202),l=(o(76233),o(653965)),c=o(307032),u=o(484398),d=o(319385),p=o(206258);function m(e){const{initialValue:t,onChange:o,source:d="title",parentCollectionStore:m}=e,h=(0,n.O7)(),g=(0,u.$)("formulaPrototypeHelpers.useMockTextStore",{isMockTextStore:!0,overrideDefaultRecordCache:!0}),y=function(e){const{initialValue:t,inMemoryRecordCache:o,source:i,parentCollectionStore:l}=e,u=(0,n.O7)(),d=(0,r.useMemo)((()=>t),[]);return(0,r.useMemo)((()=>{const e={id:a.Il(),table:s.iU};o.setRecord({pointer:e,userId:u.currentUser.id},{value:{alive:!0,id:e.id,parent_id:(null==l?void 0:l.id)??c._6,parent_table:"block",properties:{[i]:d},space_id:(null==l?void 0:l.getSpaceId())??c._6,type:"page",version:0},role:"editor"});const t=new p.ST({environment:u,path:["properties",i],pointer:e,recordStoreOptions:{inMemoryRecordCache:o,userId:u.currentUser.id}});return o.emitRecord(e,[]),t}),[u,o,d,l,i])}({initialValue:t,inMemoryRecordCache:g,source:d,parentCollectionStore:m}),v=(0,r.useRef)(t),f=(0,r.useCallback)((e=>{const t=h.currentUser.id,o=y.getRecordStoreAtRootPath();if(o instanceof p.G){const r=o.getValue();r&&(g.setRecord({pointer:y.pointer,userId:t},{role:"editor",value:{...r,properties:{...null==r?void 0:r.properties,[d]:e}}}),g.emitRecord(y.pointer,[]))}}),[h.currentUser.id,y,g,d]);return(0,i.VK)((()=>{const e=y.getValue();l.Xy(v.current,e)||(v.current=e,null==o||o(e))}),[y,o]),{store:y,setValue:f}}function h(){return d.default.checkGate({gateName:"formula_buttons"})}},425498:(e,t,o)=>{o.d(t,{m:()=>i,w:()=>a});o(757658);var r=o(954061),n=o(798165);const i=[{frequency:"day",interval:1},{frequency:"week",interval:1},{frequency:"month",interval:1},{frequency:"year",interval:1}];function a(e){const t=n.qA(e)??[],o=[];for(const r of t){if(!("block"===r.table&&!0===r.isTemplate()&&r.getFormat().automation_id&&r.id!==e.id))continue;const t=r.getAutomationStore();if(t){if(!t.isReady())return{automationStoresReady:!1};void 0!==t.getRecurrence()&&t.isDefined()&&o.push(t.getModel())}}return{automationStoresReady:!0,...(0,r.templateAncestorsViolateRecurrenceNesting)(o)}}},484398:(e,t,o)=>{o.d(t,{$:()=>a});var r=o(667294),n=o(126263),i=o(800480);function a(e,t){const{cacheFallback:o,isMockTextStore:a,isTemporaryData:s,onOperationCallback:l,overrideDefaultRecordCache:c}=t??{},u=(0,i.O7)(),{inMemoryRecordCache:d}=u.defaultRecordCache,p=(0,r.useMemo)((()=>{const t=new n.Z({isTemporaryData:Boolean(s),name:e,onOperationCallback:l});return t.isMockTextStore=Boolean(a),o&&t.addCacheFallback(o),c&&d.addCacheOverride(t),t}),[o,d,a,s,e,l,c]);return(0,r.useEffect)((()=>function(){o&&p.removeCacheFallback(o),c&&d.removeCacheOverride(p)}),[o,d,p,c]),p}},582787:(e,t,o)=>{o.d(t,{Z:()=>u});var r=o(667294),n=o(886628),i=o(433422),a=o(145953),s=o(210228),l=o(503932),c=o(80444);function u(e){let{unpersistedInMemoryRecordCache:t}=e;const o=(0,n.VK)((()=>{var e;return null===(e=c.default.state.currentUserStore)||void 0===e?void 0:e.userId}),[]);return{createAndCommit:(0,r.useCallback)((e=>{let{perform:r}=e;const n=new l.Y({deadlockTimeoutMs:s.DEADLOCK_WARNING_TIMEOUT_MS}),c=r(n),u=a.Ak.create();n.stores.forEach((e=>{const t=e.getRecordModel(e.pointer);t&&u.addModel(t)})),(0,i.FS)({operations:n.operations,recordMap:u,updateOnly:!1});for(const i of u){const{model:e,pointer:r}=i;t.setModelAndRole({pointer:r,userId:o},e,"editor")}return t.emitAll(),{performResult:c,serverCommitResult:Promise.resolve()}}),[t,o])}}},168910:(e,t,o)=>{o.d(t,{L:()=>d});var r=o(14577),n=o(335102),i=o(606287),a=o(653965),s=o(940470),l=o(401898),c=o(849117),u=o(206258);class d{constructor(e){this.context=void 0,this.compilationResultStore=new r.Z((()=>(0,c.pt)({context:this.context})),{useDeepEqual:!0,debugName:"compilationResultsStore"}),this.context=e}getAllContextValues(){const e=this.compilationResultStore.state;return s.x.isFail(e)?[]:a.d9(e.value.valueTypes)}getCollectionStore(){const e=this.context;if("button_block"===e.type)return e.pageStore.getAssociatedCollectionStore();if("button_property"===e.type)return e.collectionContextStore.collectionStore();if("event"===e.type)return u.NW.createChildStore(e.parentRecordStore,e.parentPointer);if("recurrence"!==e.type)if("assistant"===e.type){if(e.parentPointer.table===i.vF)return u.NW.createChildStore(e.parentRecordStore,e.parentPointer)}else(0,l.t1)(e)}getContextValuesForAction(e){const t=this.compilationResultStore.state;return s.x.isFail(t)?[]:t.value.actionInputValueTypes[e]??[]}getValidationErrorsForAction(e){const t=this.compilationResultStore.state;return s.x.isFail(t)?[]:t.value.actionValidationFailures[e]??[]}getContextValueForActionById(e,t){const o=this.getContextValuesForAction(e);return(0,n.vx)(o,t)}}},37652:(e,t,o)=>{o.d(t,{V:()=>i});o(667294);var r=o(745238),n=o(785893);const i=(0,r.IU)("arrowLeft",{viewBox:"0 0 30 30",svg:(0,n.jsx)("polygon",{points:"29 14 4.813 14 13.406 5.406 12 4 1 15 12 26 13.406 24.594 4.813 16 29 16"})})},954061:(e,t,o)=>{o.r(t),o.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>m,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>u,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>c,MAX_RECURRENCE_INTERVAL:()=>s,RRULE_WEEKDAYS_MAP:()=>a,getRecurrenceAfter:()=>p,rruleFromRecurrence:()=>l,templateAncestorsViolateRecurrenceNesting:()=>d});var r=o(730120),n=o(484885);const i={day:n.Ci.DAILY,week:n.Ci.WEEKLY,month:n.Ci.MONTHLY,year:n.Ci.YEARLY},a={MO:n.Ci.MO,TU:n.Ci.TU,WE:n.Ci.WE,TH:n.Ci.TH,FR:n.Ci.FR,SA:n.Ci.SA,SU:n.Ci.SU},s=100;function l(e){const{start_date:t,frequency:o,interval:r,weekdays:s,timezone:l,hour:c,minute:u}=e,d="week"===o&&s?s.map((e=>a[e])):void 0;return new n.Ci({freq:i[o],dtstart:new Date(t),interval:r,byweekday:d,tzid:l,byhour:c??0,byminute:u??0,bysecond:0})}const c=1,u=1;function d(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const o=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),r=e.length,n=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,i=r>c,a=o.length>=u;return{violatesConstraint:i||a,templateNestingExceedsMaxDepth:i,ancestorHasDailyTemplate:a,nestedDepthOfAutomationAncestors:r,immediateAncestorRecurrenceType:n}}function p(e){const{recurrence:t,afterDate:o}=e,n=l({...t}).after(new Date(o));if(!n)return;return r.ou.fromJSDate(n).toUTC().setZone("local",{keepLocalTime:!0}).toJSDate()}const m=100}}]);