"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[29657],{429657:(e,t,r)=>{r.d(t,{$o:()=>M,Fv:()=>B,IL:()=>G,J4:()=>U,KA:()=>X,Nf:()=>q,_p:()=>J,cQ:()=>W,f$:()=>E,fX:()=>H,j2:()=>A,k2:()=>Q,mg:()=>j,mz:()=>Z,oP:()=>O,tF:()=>N,td:()=>Y,x:()=>$});r(757658);var o=r(730120),n=r(701302),i=r(815145),a=r(371663),s=r(494714),l=r(253877),c=r(842875),m=r(915157),d=r(653965),u=r(401898),p=r(436610),S=r(108406),f=r(554569),v=r(575134),y=r(805149),g=r(496802),h=r(709953),_=r(879978),b=r(275754),P=r(926999),T=r(524677),x=r(137231),C=r(898104),w=r(210228),I=r(710274),D=r(110906),R=r(368585),V=r(788632),k=r(206258),F=r(27724),L=r(897630),z=r(504430);function A(e){const{collectionViewStore:t,collectionContextStore:r,timelineState:o,environment:n}=e,i=n.currentUser.id,a=(0,z.B8)(t.id),s=(0,z.pQ)(t,n),l=r.permissionScopesStore.state,c=d.Ds((()=>{if(o.destroyed)return;const e={zoomLevel:o.zoomLevel.state,centerTimestamp:(0,z.al)(o)};m.Z.set({userId:i,key:a,value:e})}),1e3),u=d.Ds((()=>{if(o.destroyed||!V.Z.state.online||!n.currentUser.isLoggedIn()||!l.canConfigureBlock)return;const e={zoomLevel:o.zoomLevel.state,centerTimestamp:(0,z.al)(o)},r=t.getFormat().timeline_preference;d.Xy(r,e)||w.createAndCommit({userAction:"collectionTimelineViewActions.setRemotePreference",environment:n,perform:r=>{g.FH({stores:[t],update:{timeline_preference:e},transaction:r})}})}),5e3);o.savePreference=()=>{c(),u()},q({timelineState:o,environment:n,...s})}function q(e){const{timelineState:t,zoomLevel:r,centerTimestamp:o,environment:i}=e,{savePreference:a}=t,s=i.WindowSizeStore.state.width+2*z.Ge,l=(0,z.x2)(r,s),c=o-l/2,m=o+l/2;t.zoomLevel.setState(r),t.currentRange.setState({startTimestamp:c,endTimestamp:m}),n.default.afterNextFlush((()=>{X({timelineState:t,centerTimestamp:o}),a&&a()}))}function X(e){const{timelineState:t,centerTimestamp:r}=e,{horizontalScroller:o,outerSizeObserver:n}=t;if(!o)return;const i=t.zoomLevel.state,{startTimestamp:a,endTimestamp:s}=t.currentRange.state,l=n.rect.state.width;if(l===(0,z.e$)(i,s-a))return;const c=(0,z.e$)(i,r-a)-l/2;o.scrollLeft=c,t.scrollLeft.setState(c)}function O(e){const{environment:t,store:r,query:o,date:n,schema:i,transaction:a}=e,{timeline_by:s}=o;if(!s)return;const l=r.getAssociatedCollectionStore(),c=(null==l?void 0:l.getMappedProperty(s))??s,m=o.timeline_by_end?(null==l?void 0:l.getMappedProperty(o.timeline_by_end))??o.timeline_by_end:void 0,d=(0,z.TW)({store:r,dateValue:n,query:o,schema:(null==l?void 0:l.getSchema())??i}),u=r.getPropertyValue(c),p=m?r.getPropertyValue(m):void 0;return h.sW({store:r.getPropertiesStore(),data:d,transaction:a}),v.H({environment:t,store:r,dateProperty:{id:c,newValue:(null==d?void 0:d[c])??[],oldValue:u},otherDateProperty:m?{id:m,newValue:(null==d?void 0:d[m])??[],oldValue:p}:void 0}),r}function B(e){var t;const{environment:r,timelineState:n,collectionStore:i,collectionContextStore:a,store:s,query:m,groupFormat:d,transaction:u}=e,p=n.zoomLevel.state,S=(0,z.al)(n),{snapUnit:v,getDateRangePlaceholderDuration:y}=z.BJ[p],{timeline_by:g}=m;if(!g)return;const h=null===(t=a.groupsStore.getGroupState(d))||void 0===t?void 0:t.resultsStore.state;if(!h)return;const _=o.ou.fromMillis(S),b=(0,z.DS)(_,v),P=(0,z.DS)(y(_),v),T=(0,z.AZ)({startValue:(0,l.Lg)((0,c.r)()),snapUnit:v,desiredStart:b,desiredEnd:P});return O({environment:r,store:s,query:m,schema:i.getSchema(),date:T,transaction:u}),f.$T({environment:r,collectionStore:i,before:!0,store:h[0],insertStores:[s],collectionContextStore:a,groupsPointer:d?[d]:[],transaction:u}),s}function E(e){const{type:t,timelineState:r,store:o,startX:n,query:i,schema:a,intl:s,environment:l}=e,{horizontalScroller:c}=r,{startTimestamp:m}=r.currentRange.state;if(!c)return;T.Ys({environment:l,store:o});const u=c.scrollLeft,{stores:p}=F.default.state,S=d.oA(p.map((e=>{const t=(0,z.bk)({store:e,query:i,schema:a,userId:l.currentUser.id,intl:s});if(t)return{startValue:t,store:e}})));r.dragState.setState({type:t,startStore:o,stores:S.map((e=>{let{store:t}=e;return t})),startValues:S.map((e=>{let{startValue:t}=e;return t})),temporaryValues:S.map((e=>{let{startValue:t}=e;return t})),startX:n,startStartTimestamp:m,startScrollLeft:u})}function U(e){const{timelineState:t,store:r,startX:o,startY:n,schema:i,collectionContextStore:a,verticalScroller:s}=e,{horizontalScroller:l}=t,{startTimestamp:c}=t.currentRange.state;if(!l||!s)return;const m=l.scrollLeft,d=s.scrollTop,u=(0,z.YE)(a,r,i);t.drawState.setState({startStore:r,startDependencyRelationPointers:u,temporaryDependencyRelationPointers:[...u],startX:o,startY:n,startScrollLeft:m,startScrollTop:d,startStartTimestamp:c,xOffsetPx:0,yOffsetPx:0,tryToCompleteDrawnArrow:!1})}function Y(e){const{timelineState:t,currentX:r}=e,{horizontalScroller:o}=t,n=t.zoomLevel.state,i=t.dragState.state,{startTimestamp:a}=t.currentRange.state;if(!i||!o)return;const{type:s,startStartTimestamp:c,startValues:m,startScrollLeft:p,startX:S,startStore:f,stores:v}=i,y=z.BJ[n],{snapUnit:g}=y,h=o.scrollLeft-p+(r-S)+(0,z.e$)(n,a-c),_=(0,z.x2)(n,h),b=m[v.indexOf(f)];let P;if(s===z.px.LeftResizer){const{start:e}=(0,z.XO)(b,g),t=e.plus(_);P=m.map((e=>{const r=(0,z.AZ)({startValue:e,snapUnit:g,desiredStart:t});return(0,l.gW)(r)}))}else if(s===z.px.RightResizer){const{end:e}=(0,z.XO)(b,g),t=e.plus(_);P=m.map((e=>{const r=(0,z.AZ)({startValue:e,snapUnit:g,desiredEnd:t});return(0,l.Qq)(r)}))}else s===z.px.ItemDrag?P=m.map((e=>{const{start:t,end:r}=(0,z.XO)(e,g),o=t.plus(_),n=o.plus(r.valueOf()-t.valueOf());return(0,z.AZ)({startValue:e,snapUnit:g,desiredStart:o,desiredEnd:n})})):(0,u.t1)(s);d.Xy(i.temporaryValues,P)||t.dragState.setState({...i,temporaryValues:P})}function Z(e){const{timelineState:t,currentX:r,currentY:o,verticalScroller:n}=e,i=t.drawState.state,a=t.zoomLevel.state,{startTimestamp:s}=t.currentRange.state,{horizontalScroller:l}=t;if(!i||!l||!n)return;const{startDependencyRelationPointers:c,startStore:m,startX:u,startY:p,startScrollLeft:S,startScrollTop:f,startStartTimestamp:v}=i,y=l.scrollLeft,g=n.scrollTop,h=y-S+(r-u)+(0,z.e$)(a,s-v),_=g-f+(o-p),b=t.hoveredItem.state;if(b&&b!==m&&!c.some((e=>e.id===b.id))){const e=[...c,{table:"block",id:b.id,spaceId:b.getSpaceId()}];d.Xy(i.temporaryDependencyRelationPointers,e)||t.drawState.setState({...i,temporaryDependencyRelationPointers:e,xOffsetPx:void 0,yOffsetPx:void 0})}else t.drawState.setState({...i,temporaryDependencyRelationPointers:[...c],xOffsetPx:h,yOffsetPx:_})}function H(e){const{environment:t,collectionContextStore:r,timelineState:o,query:n,schema:i,transaction:a}=e,s=o.dragState.state,{timeline_by:l}=n;if(!s||!l)return;const{temporaryValues:c,stores:m}=s;c.forEach(((e,o)=>{const s=m[o];O({environment:t,store:s,query:n,schema:i,transaction:a,date:e}),S.rv({environment:t,collectionContextStore:r,block_id:s.id,property:l,property_type:"date",from:"timeline"})})),o.dragState.setState(void 0)}function M(e){var t;const{timelineState:r,environment:o,transaction:n,collectionContextStore:i,isFullScreen:a,isRootChild:s}=e,l=r.drawState.state,c=r.dateRangePlaceholder.state;if(!l)return;const{startStore:m,startDependencyRelationPointers:d,temporaryDependencyRelationPointers:u}=l;if(!m)return void r.drawState.setState(void 0);let f;if(c.active){const{date:e,store:t,parentStore:a,groupFormat:s,newTimelineItemProps:l,existingTimelineItemProps:d}=c;if(t&&d){const{query:r,schema:i}=d;O({environment:o,store:t,query:r,schema:i,date:e,transaction:n}),f={table:"block",id:t.id,spaceId:m.getSpaceId()}}else if(l){const{query:r,schema:c,isFullScreen:d,canEditTimelineItems:u,subitemPath:p}=l,S=j({environment:o,date:e,store:t,parentStore:a,query:r,schema:c,isFullScreen:d,groupFormat:s,canEditTimelineItems:u,collectionContextStore:i,subitemPath:p,transaction:n,from:"timeline_complete_draw"});S&&(f={table:"block",id:S.id,spaceId:m.getSpaceId()})}r.dateRangePlaceholder.setState({active:!1})}else f=u.find((e=>!d.includes(e)));const v=(0,z._e)(i);if(v){const{property:e}=v;f&&(_.hE({environment:o,propertyWithInverse:v,sourceStore:m,destStore:k.G.createChildStore(m,f),position:{type:"after"},transaction:n}),S.rv({environment:o,collectionContextStore:i,block_id:m.id,property:e,property_type:"relation",from:"timeline",isFromBulkActionsToolbar:!1,isUnthrottled:!0})),r.drawState.setState(void 0)}else y.wl({item:{type:"dependencies",from:"view_options"},collectionSettingsStore:i.settingsStore}),r.drawState.setState({...l,tryToCompleteDrawnArrow:!0});const g=null===(t=f)||void 0===t?void 0:t.id;g&&p.LE(o,{...(0,R.Pn)(i),...(0,z.Ii)({environment:o,collectionContextStore:i,timelineState:r,isFullScreen:a,isRootChild:s}),dependenciesPropertyID:null==v?void 0:v.property,blockedByStoreID:m.id,blockingStoreID:g})}function W(e){const{timelineState:t,environment:r}=e;t.dragState.state&&(t.dragState.setState(void 0),T.ZH({debug:{userAction:"collectionTimelineViewActions.cancelDrag"},environment:r}))}function $(e){const{timelineState:t,environment:r}=e;t.drawState.state&&(t.drawState.setState(void 0),T.ZH({debug:{userAction:"collectionTimelineViewActions.cancelDraw"},environment:r}))}function Q(e){const{stores:t,collectionViewStore:r,schema:o,transaction:n}=e,i=r.getType(),a=r.getQuery(o),s=[];a&&("calendar"===i?a.calendar_by&&s.push(a.calendar_by):"timeline"===i&&(a.timeline_by&&s.push(a.timeline_by),a.timeline_by_end&&s.push(a.timeline_by_end)));for(const l of t)for(const e of s)x.sO({environment:l.environment,store:l.getNormalizedPropertyStore(e),value:void 0,transaction:n})}function G(e){const{dependency:t,collectionContextStore:r,environment:o,timelineState:n,isFullScreen:i,isRootChild:a}=e,s=(0,z._e)(r),l=r.collectionStore();if(!s||!l)return;const{property:c}=s,{store:m,relationPointer:d}=t,u=m.getSchema()[c];u&&"relation"===u.type&&(w.createAndCommit({userAction:"CollectionTimelineDependenciesOverlay.handleRemoveRelation",environment:o,perform:e=>{_.Bl({environment:o,propertyWithInverse:s,sourceStore:m,destStore:k.G.createChildStore(m,d),transaction:e}),S.rv({environment:o,block_id:d.id,property:c,property_type:u.type,from:"timeline",collectionContextStore:r,isFromBulkActionsToolbar:!1,isUnthrottled:!0})}}),p.lf(o,{...(0,R.Pn)(r),...(0,z.Ii)({environment:o,collectionContextStore:r,timelineState:n,isFullScreen:i,isRootChild:a}),dependenciesPropertyID:c,blockedByStoreID:m.id,blockingStoreID:d.id}))}function N(e){const{collectionViewStore:t,newProperty:r,transaction:o}=e;g.FH({stores:[t],update:{timeline_arrows_by:{property:r}},transaction:o})}function J(e){var t;const{collectionContextStore:r,relationPropertyId:o,transaction:n}=e,i=r.collectionStore();if(!i)return;const l=o?i.getSchema()[o]:void 0,c="relation"===(null==l?void 0:l.type)&&l.property&&"relation"===(null===(t=i.getSchema()[l.property])||void 0===t?void 0:t.type)?l.property:void 0;g.FH({stores:[i],update:{collection_default_arrows_by:o,...i.getFormat().app_config_uri===s.iS?{app_uri_map:{...i.getFormat().app_uri_map?i.getFormat().app_uri_map:{},[a.Es.BlockingRelation]:o,[a.Es.BlockedRelation]:c}}:{}},transaction:n})}function j(e){const{environment:t,transaction:r,date:o,parentStore:n,query:a,schema:s,isFullScreen:l,groupFormat:c,canEditTimelineItems:m,collectionContextStore:d,from:u}=e;if(!L.M_(t))return;const p=c?[c]:[],S=d.groupsStore.getGroupState(p);if(!S)return;if(n)return function(e){const{environment:t,transaction:r,date:o,store:n,parentStore:a,query:s,schema:l,groupFormat:c,canEditTimelineItems:m,collectionContextStore:d,subitemPath:u}=e;if(!n||!a)return;const p=c?[c]:[],S=f.yk({environment:t,collectionContextStore:d,groupsPointer:p,store:n,before:!1,collectionStore:a,transaction:r,subitemPath:u,subitemInsertDirection:"into"});if(S){if(O({environment:t,store:S,query:s,schema:l,date:o,transaction:r}),t.device.isMobile)b._c({environment:t,store:S,pageVisitSource:i.tY.Create});else if(S&&m){const e=S.getBlockTitleStore();C.N_({store:e})}return S}}(e);d.searchQueryStore.state&&I.Ug({searchQuery:"",collectionContextStore:d,isFullScreen:l});const v=f.IW({environment:t,collectionContextStore:d,groupsPointer:p,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:r,from:u});if(!v)return;const y=v.coercionSucceeded,g=v.newStore;if(O({environment:t,store:g,query:a,schema:s,date:o,transaction:r}),t.device.isMobile)b._c({environment:t,store:g,pageVisitSource:i.tY.Create});else if(y&&m){const e=g.getBlockTitleStore();C.NX({store:e})}else P.CH({environment:t,store:g,peekMode:(0,D.kr)(d),resultsStore:null==S?void 0:S.resultsStore,collectionContextStore:d,pageVisitSource:i.tY.Create});return g}}}]);