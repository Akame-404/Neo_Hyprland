"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[4617],{104617:(e,t,o)=>{o.d(t,{RL:()=>Z,xv:()=>$,rC:()=>N,Lf:()=>j,$7:()=>z,GF:()=>F});o(21703);var n=o(815145),a=o(568626),i=o(159730),r=o(915157),c=o(145953),s=o(421202),l=o(23867),d=o(709291),p=o(275754),m=(o(95477),o(296994)),u=o(433929),g=o(798165),v=o(194660),f=o(361673),I=o(981829),S=o(966324),_=o(80444),y=o(319385),C=o(156638),b=o(981193),w=o(454642),k=o(276725),T=o(842875),h=o(937850),P=o(833954);var M=o(889858),R=o(709953),B=o(504408),A=o(524677),V=o(328014),O=o(210228),U=o(239865);const x="LastViewedTemplateId",E=(0,d.defineMessages)({clientCopyError:{defaultMessage:"Client copy could not be created.",id:"spaceActions.createGettingStartedPage.copyNotCreated.error"}});function z(e){const{environment:t,item:o,createNewPage:n,isPrivate:a}=e;A.ZH({debug:{userAction:"pageTemplateModalActions.openWithItem"},environment:t}),C.Z.setState({open:!0,item:o,createNewPage:n,isPrivate:a,isLoading:!1}),r.Z.set({userId:t.currentUser.id,key:x,value:o.rootId}),b.jW(t,{template_name:o.name,template_id:(0,v.gA)(o),from:n?"sidebar":"newPage"})}function $(e){C.Z.setState({item:C.Z.state.item,open:!1}),A.ZH({debug:{userAction:"pageTemplateModalActions.close"},environment:e})}async function Z(e){const{item:t,environment:o,spaceStore:a}=e;C.Z.state.open&&C.Z.setState({...C.Z.state,isLoading:!0});const i=e.initializeStore?{...e,initializeStore:e.initializeStore,isPrivate:!1,type:"inExistingStore",useMinimalTemplates:!1}:{...e,type:"inSpace",useMinimalTemplates:!1,isOnboarding:!1};let r=!1;const c=Date.now();let s;try{s=await N(i),r=!0,p._c({environment:o,store:s,pageVisitSource:n.tY.Create}),$(o),o.device.isMobile&&S.close()}finally{var l;const n=Date.now()-c,i=e.initializeStore?g.VP(e.initializeStore):void 0,d=e.initializeStore?!Boolean(i):e.isPrivate;b.en(o,{template_name:t.name,destination:d?"private":"team",template_block_id:t.rootId,template_duplication_duration_ms:n,team_id:null==i?void 0:i.id,created_page_id:null===(l=s)||void 0===l?void 0:l.id}),b.Xy(o,{from:"inApp",success:r,context:e.from,template_name:t.name,template_block_id:t.rootId,target_space_id:a.id,template_duplication_duration_ms:n})}}async function j(e){const{environment:t,initializeStore:o,item:n,isPrivate:a,useMinimalTemplates:i,spaceStore:r,spaceViewStore:s}=e,l=i?n.rootId:n.previewRootId,d=await w.loadBlockSubtree(t,{block:{id:l,spaceId:n.spaceId},shallow:!1});let p;"success"===d.type&&(p=c.PF.create(d.data.subtreeRecordMap));const m="pageTemplateModalActions.loadAndDuplicatePageTemplate",{performResult:g}=O.createAndCommit({userAction:m,environment:t,perform:e=>{const n=o||V.KE({environment:t,spaceStore:r,spaceViewStore:s,isPrivate:a,loading:!0,transaction:e});B.fL({environment:t,inMemoryRecordCache:n.inMemoryRecordCache,recordMap:p,debugSource:m});const i=k.K8(t,{blockId:l,inMemoryRecordCache:n.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!1,allowCopyExternalObjectInstances:!0});if(!i)throw new Error(u.default.getIntl().formatMessage(E.clientCopyError));return k.E9({environment:t,sourceBlockId:l,targetBlockPointer:n.pointer,sourceBlockSubtree:i,targetInMemoryRecordCache:n.inMemoryRecordCache,transaction:e,deepCopyTransclusionContainers:!0,resolveTemplateVariables:!0,useCrdt:n.useCrdt()}),n}});return g}async function N(e){const{environment:t,item:o,useRecordCache:n,isPrivate:r,useMinimalTemplates:d,spaceStore:p,spaceViewStore:g,isOnboarding:v}=e,S=n&&!d?o.previewRootId:o.rootId,y=D(S),{serverCommitResult:C,performResult:{pageStore:k,copyBlock:B}}=O.createAndCommit({userAction:"pageTemplateModalActions.createTemplateInstance",environment:t,perform:n=>{let a;a=y?V.KE({environment:t,spaceStore:p,spaceViewStore:g,isPrivate:r,loading:!0,transaction:n}):"inExistingStore"===e.type&&e.initializeStore&&!y?e.initializeStore:"inTeam"===e.type&&e.teamStore?M.pq({environment:t,spaceStore:p,spaceViewStore:g,teamStore:e.teamStore,from:e.from,loading:!0,appendOrPrepend:e.appendOrPrepend?e.appendOrPrepend:"append",transaction:n}):V.KE({environment:t,spaceStore:p,spaceViewStore:g,isPrivate:r,loading:!0,transaction:n});const i={id:S,table:s.iU,spaceId:o.spaceId};return F({item:o,spaceViewStore:g,transaction:n}),function(e){const{item:t,transaction:o,spaceViewStore:n}=e;if(n){const e=n.getSidebarHiddenTemplateIds();if(e.indexOf(t.rootId)<0){const a=e.concat([t.rootId]);R.sW({store:n,data:{sidebar_hidden_templates:a},transaction:o})}}}({item:o,spaceViewStore:g,transaction:n}),{pageStore:a,copyBlock:i}}});return await C,await async function(e){const{environment:t,pageStore:o,copyBlock:n,item:r,useRecordCache:s,isOnboarding:d,shouldUseQueueDuplication:p}=e,m=c.Ak.create();s&&s.forEachRecord(t.currentUser.id,(e=>{let{model:t}=e;H[t.table]&&m.setModel(t.pointer,t)}));const{currentSpaceStore:g}=_.default.state;if(!g)throw new i.p8("Could not get currentSpaceStore.");const v=e=>{d&&b.Xy(t,{success:e,template_name:r.name,template_id:r.id,template_block_id:r.rootId,target_space_id:g.id,from:"onboarding"})},f=()=>{O.createAndCommit({userAction:"pageTemplateModalActions.initializePageTemplate.deletePageWhenError",environment:t,perform:e=>{U.y8({environment:t,blocks:[o],transaction:e})}}),v(!1),a.log({level:"error",from:"pageTemplateModalActions.initializePageTemplate",type:"duplicateTemplateError",data:{miscDataToConvertToString:{template_name:r.name,template_id:r.id,template_block_id:r.rootId,is_onboarding:d}}})},I=void 0!==p?p:D(n.id);if(I)await async function(e){const{environment:t,templateBlock:o,targetBlock:n,useCrdt:a}=e,i=h.UZ(),r=w.duplicateTemplateBlock(t,{sourceBlocks:[o],targetBlocks:[n],snapshotData:void 0,addCopyName:!1,deepCopyTransclusionContainers:!0,resolveTemplateVariables:{currentUserId:t.currentUser.id,currentTimeZone:(0,T.r)()},convertExternalObjectInstancesToPlaceholders:o.spaceId!==n.spaceId,useCrdt:a});let c;for await(const s of r)c=s;if(c)if(c.error){const e=(0,P.HV)(u.default.getIntl(),c.error);i.reject(e)}else i.resolve(c);else i.reject(void 0);return i.promise}({environment:t,templateBlock:n,targetBlock:{id:o.pointer.id,spaceId:(0,l.C)(o.pointer.spaceId)},useCrdt:o.useCrdt()}).catch(f).then((()=>{v(!0)}));else{"failed"===(await w.initializePageTemplate(t,{recordMap:m.toJson({allowVersionDowngrade:!1}),sourceBlock:n,targetBlock:{id:o.pointer.id,table:o.pointer.table,spaceId:(0,l.C)(o.pointer.spaceId)},isOnboarding:d})).type?f():v(!0)}return o}({environment:t,pageStore:k,copyBlock:B,useRecordCache:n,item:o,isOnboarding:Boolean(v),shouldUseQueueDuplication:y}),v&&await async function(e){const t=await m.FF.isSinglePlayerTemplateHelper.load(),{templateNameMessageId:o,blockId:n,environment:a}=e;"templateHelpers.useCase.oneOnOneNotes"===o?f.uR({checklistItem:"explore_private_template",blockId:n,environment:a}):t.isSinglePlayerTemplate(o)&&!I.MC("explore_personal_template")&&f.uR({checklistItem:"explore_personal_template",blockId:n,environment:a})}({templateNameMessageId:o.id,blockId:k.id,environment:t}),k}function D(e){const t=y.default.getConfigKey("template_ids_to_use_duplicate_block","data");return!(null==t||!t.includes(e))}const H={block:!0,collection:!0,collection_view:!0,discussion:!0,comment:!0};function F(e){const{item:t,transaction:o,spaceViewStore:n}=e;if(n){const e=n.getVisitedTemplateIds();if(e.indexOf(t.rootId)<0){const a=e.concat([t.rootId]);R.sW({store:n,data:{visited_templates:a},transaction:o})}}}},194660:(e,t,o)=>{o.d(t,{IJ:()=>m,Kj:()=>S,PL:()=>p,SG:()=>v,TI:()=>C,W4:()=>u,_V:()=>_,aD:()=>f,gA:()=>y,n8:()=>I,p8:()=>g});var n=o(89101),a=o(307032),i=o(401898),r=o(218265),c=o(416536),s=o(95477),l=o(296994),d=o(206258);async function p(e,t){const o=await l.FF.isTemplateHelper.load();return e.filter((e=>{const n=e.getCopiedFromPointer();return Boolean(n&&o.isTemplate(n)&&Boolean(t&&t(n.id)))}))}const m=5;function u(e){const t=window.location.href;return r.SK(t,{tg:e.templateGalleryItem})}function g(){const e=window.location.href;let t;return t=r.iO(e,"tg"),t=r.iO(t,"np"),t=r.iO(t,"pjm"),t}function v(e){return{tg:r.Ph(e,"tg")}}function f(e){return`${s.default.domainBaseUrl}${n._j.marketplace}/templates/${encodeURIComponent(e)}`}function I(e){return`${s.default.domainBaseUrl}${n._j.marketplace}/search?query=${encodeURIComponent(e)}`}function S(e){return`${f(e)}?preview=${encodeURIComponent("true")}`}function _(e){return`${s.default.domainBaseUrl}/${(0,a.XR)(encodeURIComponent(e))}?duplicate=true&from=notion_inapp_gallery`}function y(e){let t,o;return e instanceof d.j$?(t=e.getAppTemplateURI(),o=e.getBlockId()):"type"in e?"preset"===e.type?(t=e.uri,o=void 0):"pageTemplate"===e.type?(t=void 0,o=e.template.rootId):(0,i.t1)(e):(t=void 0,o=e.rootId),t&&c.presetUriToHumanReadableName[t]?c.presetUriToHumanReadableName[t]:o}function C(e){if(!e)return"";try{const o=JSON.parse(e);if("text"===o.content[0].content[0].nodeType){var t;return(null==o||null===(t=o.content)||void 0===t||null===(t=t[0])||void 0===t||null===(t=t.content)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.value)||""}}catch(o){return""}}}}]);