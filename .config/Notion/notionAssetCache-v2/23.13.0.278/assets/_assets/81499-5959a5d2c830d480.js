"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[81499],{903553:(e,t,o)=>{o.d(t,{Z:()=>ye});var n=o(667294),i=o(118466),l=o(701302),r=o(800480),s=o(533125),a=o(886628),c=o(724405),d=o(531701),u=o(653965),f=o(587420),p=o(52989),b=o(524677),g=o(898104),v=o(210228),m=o(710274),h=o(884064),k=o(843250),C=o(212534),S=o(639500),w=o(316339),x=o(444534),A=o(798180),y=o(569784),M=o(650628),T=o(27724),j=o(804827),R=o(606287),E=o(305971),B=o(990827),I=o(186486),Z=o(623063),O=o(309612),V=o(797511),P=o(151454),D=o(973744),N=o(917504),K=o(177546),_=o(300439),F=o(548779),L=o(394841),G=o(95802),H=o(80444),z=o(400807),W=o(319385),$=o(747453),X=o(471924),Y=o(709291),J=o(436610),q=o(742858),U=o(384084),Q=o(601600),ee=o(928314),te=o(450627),oe=o(165598),ne=o(825464),ie=o(164921),le=o(526388),re=o(265200),se=o(785893);const ae=2,ce=24,de=(0,Y.defineMessages)({ariaLabelApple:{id:"block.selectableAddMenu.ariaLabel.apple",defaultMessage:"Click to add below. Option-click to add a block above"},ariaLabelWindows:{id:"block.selectableAddMenu.ariaLabel.windows",defaultMessage:"Click to add below. Alt-click to add a block above"}});const ue=function(e){let{store:t,offsetTop:o}=e;const n=(0,Y.useIntl)(),i=(0,c.Fg)(),l=(0,r.O7)();return(0,r.MO)()?null:(0,se.jsx)(le.Z,{placement:ne.u.Bottom,delayThreshold:300,renderTooltip:()=>(0,se.jsx)(pe,{}),render:e=>(0,se.jsx)(ie.Z,{disallowTabbing:!0,onClick:()=>function(e,t){const o=ee.lF.state.option,n=z.Z.getMode(t),i=G.C.findSelectablesFromStore(t).find((e=>Boolean(e.props.onInsertRowBelow)));if((0,te.Wt)(t))return;o?i&&i.props.onInsertRowAbove?v.createAndCommit({userAction:"SelectableAddMenu.handleClick.onInsertRowBelow",environment:e,perform:e=>{i.props.onInsertRowAbove&&i.props.onInsertRowAbove({transaction:e})}}):v.createAndCommit({environment:e,userAction:"SelectableAddMenu.handleClick.addAbove",perform:o=>{const i=q.uE({environment:e,blocks:[t],transaction:o});if("suggest"===n&&i){const t=Q.oG(e,o,i);Q.n1(o,i,{id:X.Il(),type:"insert",discussionId:t.id}),Q.vh({environment:e,transaction:o,discussionStore:t,addModifiedBlockIdsAfter:[i.id]})}}}):oe.PF(t)?U.hb({environment:e,blockStore:t}):i&&i.props.onInsertRowBelow?v.createAndCommit({userAction:"SelectableAddMenu.handleClick.onInsertRowBelow",environment:e,perform:e=>{i.props.onInsertRowBelow&&i.props.onInsertRowBelow({transaction:e})}}):v.createAndCommit({environment:e,userAction:"SelectableAddMenu.handleClick.addBelow",perform:o=>{const i=q.ZJ({environment:e,blocks:[t],transaction:o});if("suggest"===n&&i){const t=Q.oG(e,o,i);Q.n1(o,i,{id:X.Il(),type:"insert",discussionId:t.id}),Q.vh({environment:e,transaction:o,discussionStore:t,addModifiedBlockIdsAfter:[i.id]})}}});J.eT(e),I.default.reset()}(l,t),style:fe(o,t,l,i),ariaLabel:n.formatMessage(l.device.isApple?de.ariaLabelApple:de.ariaLabelWindows),...e,children:(0,$.R)({width:16})})})};function fe(e,t,o,n){const i=(0,_.zt)(e,t),l=(0,_.tx)(o,ce+ae+re.Z.width,t);return{display:"flex",alignItems:"center",justifyContent:"center",fill:n.lightIconColor,position:"absolute",top:i,left:-l,width:ce,height:ce,borderRadius:4,pointerEvents:"auto",cursor:"-webkit-grab"}}function pe(){const e=(0,c.Fg)(),t=(0,r.O7)(),o={color:e.mediumInvertedTextColor};return(0,se.jsxs)("div",{style:{textAlign:"center"},children:[(0,se.jsx)(Y.FormattedMessage,{defaultMessage:"Click <mediumcolor>to add below</mediumcolor>",id:"block.selectableAddMenu.tooltip.addBlockBelow",values:{mediumcolor:e=>(0,se.jsx)("span",{style:o,children:e})}}),(0,se.jsx)("div",{children:t.device.isApple?(0,se.jsx)(Y.FormattedMessage,{defaultMessage:"Option-click <mediumcolor>to add above</mediumcolor>",id:"block.selectableAddMenu.tooltip.addAbove",values:{mediumcolor:e=>(0,se.jsx)("span",{style:o,children:e})}}):(0,se.jsx)(Y.FormattedMessage,{defaultMessage:"Alt-click <mediumcolor>to add a block above</mediumcolor>",id:"block.selectableAddMenu.tooltip.addAbove.windows",values:{mediumcolor:e=>(0,se.jsx)("span",{style:o,children:e})}})})]})}var be=o(405829),ge=o(18821),ve=o(573063);const me=function(e){const t=(0,r.O7)(),o=(0,r.Fy)(),{mediumInvertedTextColor:i}=(0,c.Fg)(),l=(0,Y.useIntl)(),{store:s,shouldOffsetLeft:d}=e,u=(0,a.VK)((()=>d?(0,_.tx)(t,26+re.Z.width,s):ce+8),[t,s,d]),f=(0,n.useCallback)((()=>{ge.yw({environment:t,blockStore:s})}),[t,s]);return o.isMobile?null:(0,se.jsx)("div",{style:he(e.offsetTop,u),onMouseDown:C.$0,children:(0,se.jsx)(le.Z,{placement:ne.u.Bottom,delayThreshold:300,renderTooltip:()=>(0,se.jsx)(Y.FormattedMessage,{defaultMessage:"Click <invertedcolor>to add a comment</invertedcolor>",id:"selectableCommentMenu.addCommentPrompt.tooltip",values:{invertedcolor:e=>(0,se.jsx)("span",{style:{color:i},children:e})}}),render:e=>(0,se.jsx)(ve.Z,{ariaLabel:l.formatMessage({id:"selectableCommentMenu.iconButton",defaultMessage:"Comment"}),disallowTabbing:!0,icon:be.s,onClick:f,isLightIconColor:!0,...e})})})};function he(e,t){return{position:"absolute",top:e,left:-t}}const ke=function(e){var t;const o=(0,r.O7)(),i=(0,V.l)(),{targetBlockStore:l,container:s}=e,c=(0,a.VK)((()=>G.C.findSelectablesFromStore(l).find((e=>Boolean(e.props.shouldShowHoverMenu||e.props.shouldShowCommentMenu)))),[l]),d=(null==c?void 0:c.props.shouldShowCommentMenu)??!1,u=(null==c?void 0:c.props.shouldShowHoverMenu)??!1,[f,p]=(0,n.useState)(null==c||null===(t=c.getNode())||void 0===t?void 0:t.getBoundingClientRect());(0,n.useEffect)((()=>{if(!c)return;const e=c.getNode();if(!e)return;const t=()=>{p(e.getBoundingClientRect())},o=(0,K.VW)(e);o&&(0,D.lj)(o,"scroll",t);const n=(0,K.xH)(e);return n&&n!==o&&(0,D.lj)(n,"scroll",t),t(),()=>{o&&(0,D.ZV)(o,"scroll",t),n&&(0,D.ZV)(n,"scroll",t)}}),[c]);const b=(0,a.VK)((()=>!!W.default.checkGate({gateName:"human_suggested_edits"})&&"suggest"===z.Z.getMode(l)),[l]),g=null==s?void 0:s.getBoundingClientRect(),v=f?f.top-((null==g?void 0:g.top)??0):void 0,m=f?f.left-((null==g?void 0:g.left)??0):void 0,h=(0,a.VK)((()=>(0,F.Fn)(o)),[o]),k=(0,a.VK)((()=>{var t;return"editor"===e.targetBlockStore.getRole()||"read_and_write"===e.targetBlockStore.getRole()||"edit"===(null==i||null===(t=i.publicEditModeStore.state)||void 0===t?void 0:t.permission)}),[null==i?void 0:i.publicEditModeStore,e.targetBlockStore]),C=(0,a.VK)((()=>{var t,o;return"comment_only"===(null===(t=e.targetBlockStore.getNavigableBlockStore({skipCurrent:!0}))||void 0===t?void 0:t.getRole())||"comment"===(null==i||null===(o=i.publicEditModeStore.state)||void 0===o?void 0:o.permission)}),[null==i?void 0:i.publicEditModeStore,e.targetBlockStore]),S=(0,a.VK)((()=>{const e=H.default.getState().mainEditorCurrentBlockStore;return Boolean(e&&(e.pathIsDead()&&W.default.checkGate({gateName:"prevent_edits_trash"})||(0,B.xR)(e.id)))}),[]),w=(0,a.VK)((()=>d&&!l.isNavigableAncestorNonEditableState()&&!S&&!b),[d,b,S,l]),x=(0,a.VK)((()=>{var e;const t="external_object_instance_page"===l.getType(),o=i&&(0,L.Kj)(i.pageStore.id);return(!l.isNavigableAncestorNonEditableState()||"collection"===(null===(e=l.getParentStore())||void 0===e?void 0:e.table))&&!w&&(k||C&&b)&&!t&&!l.isNavigableAncestorExternallyImportedPage()&&!o&&!S}),[k,w,b,C,S,i,l]),A=(0,a.VK)((()=>(0,_.oJ)(l)),[l]);return(0,N.Z)((e=>(0,se.jsxs)("div",{style:{position:"absolute",left:m,top:v,zIndex:P.Mo},...e,children:[w&&(0,se.jsx)(me,{store:l,offsetTop:A,shouldOffsetLeft:u||h}),u&&(0,se.jsx)(re.Z,{store:l,offsetTop:A,disableDrag:b,isWorkspaceAdmin:h,hasEditorPermissions:k}),x&&(0,se.jsx)(ue,{store:l,offsetTop:A})]})))},Ce={position:"absolute",top:0,left:0};const Se=function(e){const t=(0,n.useRef)(null),o=(0,a.VK)((()=>{const t=I.default.state;if(t.isOpen&&t.container===e.selectableContainer)return t.currentStore}),[e.selectableContainer]),i=(0,E.E)("prevent_edits_trash"),l=(0,a.VK)((()=>{if(!o)return!1;if(i){const e=o.getParentStore(),t=o.getParentBlockStore();if((null==e?void 0:e.table)===R.vF&&(null!=t&&t.pathIsDead()||!o.getAlive()))return!0}return!!(0,B.Eo)(o)}),[i,o]);return(0,se.jsx)("div",{style:Ce,ref:t,children:(0,se.jsx)(O.Z,{className:k.$Ot,render:()=>o&&!l?[(0,se.jsx)(Z.Z,{isVisible:!0,animationStyle:{opacity:1},enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:()=>(0,se.jsx)(ke,{container:t.current??void 0,targetBlockStore:o})},o.id)]:[]})})},we=10;function xe(e){let t=!0;if(e.length<=we){const{selectableElementRectMap:o}=i.Z.withListenerIgnored((()=>M.Z.getState()));t=e.some((e=>function(e,t){const o=t.target instanceof Element?t.target:t.target.parentElement;if(!o)return!0;if(o.closest(`.${k.$Ot}`))return!1;const n=o.closest(`.${k.euV}`);if(!n)return!0;const i=e.get(n);if(!i)return!0;const l=n.getBoundingClientRect();return!(i.x===l.x&&i.y===l.y&&i.width===l.width&&i.height===l.height)}(o,e)))}t&&b.Ch()}function Ae(e){const{isDefaultContainer:t}=e,{currentRect:o,isActive:n,showSelectionRect:i}=(0,a.VK)((()=>y.default.state.isActive?y.default.state:{currentRect:void 0,isActive:!1,showSelectionRect:!1}),[]),l=(0,c.yK)((()=>({selection:{position:"absolute",pointerEvents:"none",backgroundColor:d.ZP.blueWithAlpha(.14),border:"1px solid transparent",left:null==o?void 0:o.left,top:null==o?void 0:o.top,width:o?o.right-o.left:0,height:o?o.bottom-o.top:0}})),[o]);return n&&i&&t?(0,se.jsx)("div",{style:l.selection}):null}const ye=function(e){const t=(0,n.useRef)(null),o=(0,n.useRef)({isPeekRenderer:()=>e.isPeekRenderer??!1,getProps:()=>e,getNode:()=>t.current});(0,n.useLayoutEffect)((()=>{o.current.isPeekRenderer=()=>e.isPeekRenderer??!1,o.current.getProps=()=>e,o.current.getNode=()=>t.current}),[e]);const i=(0,r.O7)();(0,s.c)(w.Z,(()=>o.current),[]),(0,n.useLayoutEffect)((()=>{const n=o.current;if(e.isDefaultContainer){const t=e.isRootContainer?u.G0([n],T.default.state.defaultContainerStack||[]):u.G0(T.default.state.defaultContainerStack||[],[n]);T.default.setState({...T.default.state,defaultContainerStack:t,pivot:void 0,anchor:void 0,anchorContainer:void 0})}if(e.droppable){const t=e.isRootContainer?u.G0([n],T.default.state.droppableContainerStack||[]):u.G0(T.default.state.droppableContainerStack||[],[n]);T.default.setState({...T.default.state,droppableContainerStack:t})}let i;return b.Jy(),t.current&&(i=new MutationObserver(xe),i.observe(t.current,{attributes:!0,childList:!0,characterData:!0,subtree:!0})),()=>{if(e.isDefaultContainer){const e=u.zu(T.default.state.defaultContainerStack||[],n);T.default.setState({...T.default.state,defaultContainerStack:e,pivot:void 0,anchor:void 0,anchorContainer:void 0})}if(e.droppable){const e=u.zu(T.default.state.droppableContainerStack||[],n);T.default.setState({...T.default.state,droppableContainerStack:e})}i&&i.disconnect()}}),[o,e.droppable,e.isDefaultContainer,e.isRootContainer]);const{closestSelectable:c}=(0,n.useContext)(h.aT)??{},d=(0,n.useCallback)((t=>{const{device:o}=i;e.disableRectangularSelection||(o.isPhone?(0,C.ZP)({event:t,context:C.Af.EditorMouseDown,callback:()=>{b.ZH({debug:{userAction:"SelectableContainer.handleMouseDown"},environment:i}),m.wG(),x.HM.clearSelection()}}):(0,C.ZP)({event:t,context:C.Af.EditorMouseDown,callback:()=>{if(t.target instanceof Element){if(t.target.closest("button")||t.target.closest('[role="button"]'))return}1!==t.button&&(t.preventDefault(),p.AI({environment:i,target:t.target,startX:t.clientX,startY:t.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1}))}}))}),[i,e.disableRectangularSelection]),k=(0,n.useCallback)((t=>{var o;if(function(e){return M.Z.hasBeenUpdatedSince(e.timeStamp)}(t))return;const n=((null===(o=A.default.getActiveSession())||void 0===o?void 0:o.getAllPendingOperations())??[]).length>0;e.store.canEdit()&&!n&&(0,C.ZP)({event:t,context:C.Af.EditorClick,callback:()=>{var o;if(null!==(o=T.default.getDefaultContainerFromTarget(t.target))&&void 0!==o&&o.isPeekRenderer()||f.E5(i),!S.X9()&&!e.disableEditNearestBlock){const{clientX:e,clientY:o,target:n}=t;l.default.afterNextFlush((()=>{v.createAndCommit({userAction:"SelectableContainer.click",environment:i,perform:t=>g.jh(i,{x:e,y:o,target:n instanceof Element?n:void 0},t)})}))}}})}),[i,e.disableEditNearestBlock,e.store]),R=(0,a.VK)((()=>Boolean(y.default.state.isActive&&y.default.state.defaultContainer===o.current)),[]),E=(0,a.VK)((()=>(0,se.jsx)("div",{style:{display:"contents"},ref:t,children:e.render({selectableEvents:{onMouseDown:d,onClick:k},selectableHoverMenuOverlay:(0,se.jsx)(Se,{selectableContainer:o.current})})})),[k,d,e]);return(0,se.jsx)(h.ld,{value:{selectableContainer:o.current,closestSelectable:c},children:(0,se.jsx)(j.Z,{open:R,origin:E,children:(0,se.jsx)(Ae,{isDefaultContainer:e.isDefaultContainer})})})}},265200:(e,t,o)=>{o.d(t,{Z:()=>S});var n=o(667294),i=o(800480),l=o(886628),r=o(724405),s=o(436610),a=o(524677),c=o(296994),d=o(300439),u=o(869454),f=o(186486),p=o(231945),b=o(850478),g=o(953437),v=o(279954),m=o(785893);const h=b.C$,k=b.GN;function C(e){const{store:t,disableDrag:o,hasEditorPermissions:C,isWorkspaceAdmin:S,offsetTop:w}=e,x=(0,i.O7)(),A=(0,i.MO)(),y=(0,n.useRef)(null),M=h,T=k,j=(0,l.VK)((()=>(0,d.zt)(w,t)),[w,t]),R=(0,l.VK)((()=>(0,d.tx)(x,M+2,t)),[x,M,t]),E=(0,l.VK)((()=>t.isNavigableAncestorNonEditableState()&&!t.isInsideCollection()),[t]),B=!o&&C&&!E,I=(0,r.yK)((()=>({div:{position:"absolute",top:j,left:-R,width:M,height:T,pointerEvents:"auto",cursor:B?"-webkit-grab":void 0},popup:{width:265,overflow:"hidden"}})),[B,R,j,T,M]),[Z,O]=(0,n.useState)(""),V=(0,l.VK)((()=>{const e=f.default.state;return e.isOpen&&e.menuIsOpen&&e.currentStore===t}),[t]);(0,n.useEffect)((()=>()=>{V&&f.default.reset()}),[]);const P=(0,n.useCallback)((()=>{const e=f.default.state,o=u.Z.state;if(e.isOpen){O(""),A&&o.phase===u.i.shown?u.Z.onHide((()=>f.default.setState({...e,menuIsOpen:!0}))):f.default.setState({...e,menuIsOpen:!0}),a.Ys({environment:x,store:t});const n=t.getType();n&&s.YM(x,{blockType:n})}}),[x,A,t]),D=(0,n.useCallback)((()=>f.default.reset()),[]);return A?null:(0,m.jsx)("div",{style:I.div,ref:y,children:(0,m.jsx)(g.ZP,{popupType:A?p.Z4.SlideUp:p.Z4.Popup,open:V,placementToOrigin:p.pO.Left,alignmentToOrigin:p.vR.Center,onDismiss:D,originGap:5,forceInitialInbound:!0,style:I.popup,render:()=>(0,m.jsx)(c.Xl,{hasEditorPermissions:C,isWorkspaceAdmin:S,store:t,onDismiss:D,containerRef:y,query:Z,setQuery:O}),origin:(0,m.jsx)(v.Z,{store:t,isHoverMenu:!0,canDrag:B,canSelect:!1,analyticsName:"selection_menu",disableForceTouch:!0,disableHorizontalDragEdgeScroll:!0,children:(0,m.jsx)(b.ZP,{width:M,height:T,disallowTabbing:!0,onClick:P,disableDrag:!B})}),trapFocus:V})})}C.width=h,C.height=k;const S=C},198321:(e,t,o)=>{o.d(t,{Z:()=>i});var n=o(667294);const i=function(e,t){if(e.ref&&t.ref){const o=t.ref;t.ref=t=>{e.ref(t),o(t)}}return n.cloneElement(e,t)}},300439:(e,t,o)=>{o.d(t,{oJ:()=>p,tx:()=>u,zt:()=>f});var n=o(949271),i=o(541432),l=o(492650),r=o(916472),s=o(444534),a=o(206258),c=o(849117),d=o(798165);function u(e,t,o){if(o.isQuoteBlockChild())return t+r.nr+r.NE+n.ZD.paddingLeft;if(o.isTransclusionType()||o.isInsideTransclusion()||"ai_block"===o.getType()||o.isInsideAiBlock())return t+4;if(o.getType()===i.Ti.table){const n=s.g$.getNumberOfUnresolvedComments({simpleTableStore:o,environment:e,includeInline:!(0,l.fg)(e,o)}),i=o.isImmediateColumnChild();return 0!==n||i?t+8:t}const u=d.qA(o).filter((e=>e instanceof a.zq&&e.isType("duplicate_blocks"))).length;return u>0?t+c.pZ*u:t}function f(e,t){return t.isTransclusionType()?e+5:"ai_block"===t.getType()?t.hasContent()?e+9:e+15:t.getType()===i.Ti.button?e+3:e}function p(e){const t=e.getType(),o=e.getNavigableAncestorFormat(),n=Boolean(o.page_small_text);return t===i.Ti.divider?-6:t===i.Ti.header?n?7:10:t===i.Ti.subHeader?n?4:6:t===i.Ti.collectionView?8:t===i.Ti.table?14:3}}}]);