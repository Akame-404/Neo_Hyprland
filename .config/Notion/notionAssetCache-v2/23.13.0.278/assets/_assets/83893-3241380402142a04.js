"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[83893],{522974:(e,t,n)=>{n.d(t,{VZ:()=>f,vn:()=>u,Y7:()=>m,LH:()=>v});var a=n(531701);const r="theme";var o=n(401898),i=n(30021),s=n(304926),c=n(247839);const d=12;function l(e,t){const{device:n,ThemeStore:o}=e,{mode:i,usingSystemTheme:l}=t;if(window.notionTheme)return;const u={mode:i};o.setState(u),e.mobileNative&&e.mobileNative.setTheme(i,l),c.setTheme(function(e,t){const n=(0,a.gh)({theme:e});return{mode:e,usingSystemTheme:t,colors:{white:a.ZP.white,blue:a.ZP.blue},borderRadius:4,textColor:n.regularTextColor,popoverBackgroundColor:n.popoverBackground,popoverBoxShadow:n.mediumBoxShadow,inputBoxShadow:n.inputBoxShadow,inputBackgroundColor:n.inputBackground,dividerColor:n.darkDividerColor,shadowOpacity:n.shadowOpacity}}(i,l)),localStorage.setItem(r,JSON.stringify(u)),function(e,t){if(0===e.nativeScrollbarWidth)return;const n=document.getElementById("scroll-properties");n&&(n.innerHTML=`\n\t\t* {\n\t\t\tscrollbar-width: ${d}px;\n\t\t\tscrollbar-color: ${p.scrollbarThumb[t]}  ${p.scrollbarTrack[t]};\n\t\t}\n\t\t::-webkit-scrollbar {\n\t\t\twidth: ${d}px;\n\t\t\theight: ${d}px;\n\t\t}\n\t\t::-webkit-scrollbar {\n\t\t\tbackground: transparent;\n\t\t}\n\t\t::-webkit-scrollbar-track:hover {\n\t\t\tbackground: ${p.scrollbarTrack[t]};\n\t\t}\n\t\t::-webkit-scrollbar-thumb {\n\t\t\tbackground: ${p.scrollbarThumb[t]};\n\t\t\tcursor: pointer;\n\t\t}\n\t\t::-webkit-scrollbar-thumb:hover {\n\t\t\tbackground: ${p.scrollbarThumbHover[t]};\n\t\t}\n\t\t::-webkit-scrollbar-button {\n\t\t\tdisplay: none;\n\t\t}\n\t`,s.Z.setState(d))}(n,i),"dark"===i?document.body.classList.add("dark"):document.body.classList.remove("dark")}function u(e){return e.device.prefersDarkInterface?"dark":"light"}const p={scrollbarTrack:{light:"rgba(0, 0, 0, 0)",dark:"rgba(0, 0, 0, 0)"},scrollbarThumb:{light:"#D3D1CB",dark:"rgba(255, 255, 255, 0.2)"},scrollbarThumbHover:{light:"#AEACA6",dark:"rgba(255, 255, 255, 0.3)"}};function m(e){i.Z.setState(e)}function v(e){const t=f(e);switch(t){case"dark":case"light":l(e,{mode:t,usingSystemTheme:!1});break;case"system":!async function(e){const{mobileNative:t}=e;let n="light";n=t&&t.api.getTheme?await t.api.getTheme():u(e),l(e,{mode:n,usingSystemTheme:!0})}(e);break;default:(0,o.t1)(t)}}function f(e){const t=i.Z.state||"system";return"dark"===(n=t)||"light"===n||"system"===n?n:"system";var n}},24201:(e,t,n)=>{n.d(t,{Z:()=>un});var a=n(667294),r=n(800480),o=n(296994),i=n(471924),s=n(730459),c=n(80444);const d=6e4;async function l(e){var t,n;void 0!==c.default.state.currentUserStore&&void 0!==c.default.state.currentSpaceStore||await c.default.waitUntil((()=>void 0!==c.default.state.currentUserStore&&void 0!==c.default.state.currentSpaceStore));const a=null===(t=c.default.state.currentUserStore)||void 0===t?void 0:t.id,r=null===(n=c.default.state.currentSpaceStore)||void 0===n?void 0:n.id;if(!document.hasFocus())return;if(!a||!r)return;const o=s.Cd({userId:a,spaceId:r}),d=Date.now();o?s.ci({userId:a,spaceId:r,session:{...o,lastFocusedTime:d}}):s.ci({userId:a,spaceId:r,session:{id:i.Il(),sessionStartTime:d,lastFocusedTime:d}})}var u=n(354064),p=n(454642),m=n(788632),v=n(429755),f=n(417963);const S=new u.Z;var b=n(522974),g=n(30021);var h=n(886628),_=n(712321),w=n(548779),C=n(281236);function O(){const e=(0,r.O7)(),t=(0,h.VK)((()=>c.default.state.currentUserRootStore),[]);(0,a.useEffect)((()=>{t&&async function(e,t){await _.w();const n=t.getSpaceViewStores();for(const a of n){const t=a.getBookmarkedPageStores();for(const e of t)T(e);const n=a.getSharedPageStores();for(const e of n)T(e);const r=a.getTeamsStores();for(const e of r){const t=e.getTeamPagesStores();for(const e of t)T(e)}const o=a.getSpaceStore();if(o){C.Z.getData(e,{spaceId:o.id});const t=(0,w.XD)(e,o);for(const e of t)T(e)}}}(e,t)}),[t,e])}function T(e){e.load();const t=e.getCollectionViewSourceOrLinkCollectionStores();for(const n of t)n.load()}var y=n(568626),N=n(554153),E=n(211342),U=n(709291),k=n(102449),I=n(135253),A=n(547307),L=n(247839),M=n(95477),V=n(110854),P=n(772770),Z=n(367669),R=n(421051),x=n(85844),D=n(785893);const B=6e4;function F(){const e=(0,r.O7)(),t=(0,a.useCallback)((()=>function(e){const{AppUpdateStore:t}=e;t.setState({appUpdate:t.state.appUpdate,electronUpdate:{state:"checking"}})}(e)),[e]),n=(0,a.useCallback)(((t,n)=>function(e,t,n){const{AppUpdateStore:a}=n;a.setState({appUpdate:a.state.appUpdate,electronUpdate:{state:"error",error:t}})}(0,n,e)),[e]),o=(0,a.useCallback)((()=>function(e){const{AppUpdateStore:t}=e;t.setState({appUpdate:t.state.appUpdate,electronUpdate:{state:"no-update",timestamp:Date.now()}})}(e)),[e]),i=(0,a.useCallback)(((t,n)=>function(e,t,n){const{AppUpdateStore:a}=n,r=(0,E.parseVersion)(t.version),o=L.getDesktopVersion(),i=(0,E.getUpdateType)({currentVersion:o,nextVersion:r,app:"desktop"});a.setState({appUpdate:a.state.appUpdate,electronUpdate:{state:"downloading",type:i,version:r,timestamp:Date.now(),progress:0}})}(0,n,e)),[e]),s=(0,a.useCallback)(((t,n)=>function(e,t,n){const{AppUpdateStore:a}=n,r=a.state;r.electronUpdate&&"downloading"===r.electronUpdate.state&&a.setState({appUpdate:r.appUpdate,electronUpdate:{...r.electronUpdate,progress:t.transferred/t.total}})}(0,n,e)),[e]),c=(0,a.useCallback)(((t,n)=>function(e,t,n){const{device:a}=n,{AppUpdateStore:r}=n,o=N.Z.get(V.Tm),i=t.version;if(o===i){if(a.isMac)return r.setState({appUpdate:r.state.appUpdate,electronUpdate:{state:"ready",type:E.UpdateType.Major,version:void 0}}),void A.showDialog({message:(0,D.jsx)(U.FormattedMessage,{id:"desktopAppUpdater.moveNotionToApplicationsFolderDialog.prompt",defaultMessage:"Please move the Notion app into the Applications folder for the auto-updater to work."}),showCancel:!1,keepFocus:!1,handleCancel:()=>(0,V.mK)(n),items:[{label:(0,D.jsx)(U.FormattedMessage,{id:"desktopAppUpdater.moveNotionToApplicationsFolderDialog.dismissButton.label",defaultMessage:"Okay"}),onAccept:()=>(0,V.mK)(n)}]});y.log({level:"error",from:"AppUpdateListener",type:"electronUpdateFailed",data:{miscDataToConvertToString:{previousUpdateReady:o,nextUpdateReady:i}}})}const s=L.getDesktopVersion(),c=(0,E.parseVersion)(t.version),d=(0,E.getUpdateType)({currentVersion:s,nextVersion:c,app:"desktop"});r.setState({appUpdate:r.state.appUpdate,electronUpdate:{state:"ready",type:d,version:c}})}(0,n,e)),[e]),d=(0,a.useCallback)((()=>function(e){const{AppUpdateStore:t}=e;if(t.state.appUpdate&&"ready"===t.state.appUpdate.state)return;t.setState({electronUpdate:t.state.electronUpdate,appUpdate:{state:"checking"}})}(e)),[e]),l=(0,a.useCallback)(((t,n)=>function(e,t,n){K(t,n)}(0,n,e)),[e]),u=(0,a.useCallback)((()=>function(e){const{AppUpdateStore:t}=e;if(t.state.appUpdate&&"ready"===t.state.appUpdate.state)return;t.setState({electronUpdate:t.state.electronUpdate,appUpdate:{state:"no-update",timestamp:Date.now()}})}(e)),[e]),v=(0,a.useCallback)(((t,n)=>function(e,t,n){$(t,n)}(0,n,e)),[e]),f=(0,a.useCallback)(((t,n)=>function(e,t,n){W(t,n)}(0,n,e)),[e]),S=(0,a.useCallback)(((t,n)=>function(e,t,n){j(t,n)}(0,n,e)),[e]),b=(0,a.useCallback)((t=>function(e,t){I.Js({bannerStore:R.Z}),k.hC({environment:t,url:window.location.href,version:e})}(t,e)),[e]),g=(0,a.useCallback)((()=>function(e){const t=e.AppUpdateStore;if(m.Z.getState().online&&t.isSilentUpdate()){const n=t.state.appUpdate;k.hC({environment:e,url:window.location.href,version:n.version})}}(e)),[e]);(0,a.useEffect)((()=>{const{device:a}=e;if(a.isElectron)return L.electronUpdateReady.addListener(c),L.electronUpdateError.addListener(n),L.electronUpdateChecking.addListener(t),L.electronUpdateAvailable.addListener(i),L.electronUpdateProgress.addListener(s),L.electronUpdateNotAvailable.addListener(o),L.appUpdateReady.addListener(S),L.appUpdateError.addListener(l),L.appUpdateChecking.addListener(d),L.appUpdateAvailable.addListener(v),L.appUpdateInstall.addListener(g),L.appUpdateProgress.addListener(f),L.appUpdateNotAvailable.addListener(u),L.appUpdateReload.addListener(b),()=>{L.electronUpdateReady.removeListener(c),L.electronUpdateError.removeListener(n),L.electronUpdateChecking.removeListener(t),L.electronUpdateAvailable.removeListener(i),L.electronUpdateProgress.removeListener(s),L.electronUpdateNotAvailable.removeListener(o),L.appUpdateReady.removeListener(S),L.appUpdateError.removeListener(l),L.appUpdateChecking.removeListener(d),L.appUpdateAvailable.removeListener(v),L.appUpdateProgress.removeListener(f),L.appUpdateNotAvailable.removeListener(u),L.appUpdateReload.removeListener(b)}}),[e,d,u,b,v,l,g,f,S,i,t,n,o,s,c]),(0,a.useEffect)((()=>{const{device:t,mobileNative:n}=e;if(n&&n.updateReceiveApiHandlers({appUpdateReady:t=>j(t,e),appUpdateError:t=>K(t,e),appUpdateChecking:d,appUpdateAvailable:t=>$(t,e),appUpdateProgress:t=>W(t,e),appUpdateNotAvailable:u}),function(e){const t=k.ac(),n=k.uG();if(!(0,E.isEqualVersion)(t,n)){0,H((0,E.getUpdateType)({currentVersion:t,nextVersion:n,app:"client"}),n,e)}}(e),t.isMobileNative&&n&&n.api.openUpdateSettings){const n=t.osVersion,a=t.isAndroid&&(0,E.isLessThanVersion)(n,[7,0]),r=t.isIOS&&(0,E.isLessThanVersion)(n,[15,0]);(a||r)&&function(e){const{mobileNative:t}=e;if(!t)return;I.Bw({bannerStore:R.Z,id:"PlatformUpdateWarning",contentKey:"mobile_platform_unsupported",styleKey:P.v.Red})}(e)}}),[e,d,u]);const h=(0,a.useRef)("");(0,a.useEffect)((()=>{const{device:t,mobileNative:n}=e;if(!n&&!t.isElectron&&!M.default.isAdminMode&&(!M.default.isLocalhost||M.default.offline)){async function a(){if(void 0===x.Z.state.isVisible||!0===x.Z.state.isVisible)try{const t=k.ac(),n=await p.getAssetsJsonV2(e,{hash:h.current});if("success"===n.type){const a=n.data;if("version"in a){const n=(0,E.parseVersion)(a.version);n&&((0,E.isEqualVersion)(n,t)||j(a,e))}"hash"in a&&(h.current=a.hash||"")}}catch(t){}}const r=setInterval(a,B);return()=>clearInterval(r)}}),[e])}async function q(e){const t=await async function(e){await c.default.waitUntilRendered();const{mainEditorCurrentBlockStore:t,currentUserStore:n}=c.default.state;return!(!n||!t||(0,Z.IJ)(e,t))}(e);t&&I.Bw({bannerStore:R.Z,id:"AppUpdate",contentKey:"minor_app_update",styleKey:P.v.Blue})}function H(e,t,n){e===E.UpdateType.Major?t&&k.M0(t)?(k.D$(t),q(n),k.gA(n,"major","banner")):(!function(e){A.showDialog({message:(0,D.jsx)(U.FormattedMessage,{defaultMessage:"We just launched new features!",id:"breakingUpdateDialog.title"}),showCancel:!1,keepFocus:!1,handleCancel:()=>(0,V.mK)(e),items:[{label:(0,D.jsx)(U.FormattedMessage,{defaultMessage:"Update and see what's new",id:"breakingUpdateDialog.updateButtonTitle"}),color:"blue",onAccept:()=>(0,V.mK)(e)}],innerStyle:{width:380}})}(n),k.gA(n,"major","modal")):e===E.UpdateType.Minor?(t&&k.M0(t)&&k.D$(t),q(n),k.gA(n,"minor","banner")):(t&&k.M0(t)&&k.D$(t),k.gA(n,"patch"))}function K(e,t){const{AppUpdateStore:n}=t;n.state.appUpdate&&"ready"===n.state.appUpdate.state||n.setState({electronUpdate:n.state.electronUpdate,appUpdate:{state:"error",error:e}})}function $(e,t){const{AppUpdateStore:n}=t;if(n.state.appUpdate&&"ready"===n.state.appUpdate.state)return;const a=(0,E.parseVersion)(e.version),r=k.ac(),o=(0,E.getUpdateType)({currentVersion:r,nextVersion:a,app:"client"});n.setState({electronUpdate:n.state.electronUpdate,appUpdate:{state:"downloading",type:o,version:a,timestamp:Date.now(),progress:0}})}function W(e,t){const{AppUpdateStore:n}=t,a=n.state;a.appUpdate&&"downloading"===a.appUpdate.state&&n.setState({electronUpdate:a.electronUpdate,appUpdate:{...a.appUpdate,progress:e.downloaded/e.total}})}function j(e,t){const{AppUpdateStore:n}=t,a=(0,E.parseVersion)(e.version),r=k.ac(),o=(0,E.getUpdateType)({currentVersion:r,nextVersion:a,app:"client"});if(!k.M0(a)){const e={state:"ready",type:o,version:a};n.setState({electronUpdate:n.state.electronUpdate,appUpdate:e})}H(o,a,t)}n(757658);var G=n(79571),z=n(730120),Y=n(401898),Q=n(619584);function J(e){const{frequencyCapConstraint:t,exposures:n,currentDateTime:a}=e,r=a.toMillis(),{maxCountInWindow:o,window:i}=t,s=function(e){const{exposures:t,windowEndMillis:n,windowDuration:a}=e;let r;switch(a){case"day":r=1;break;case"week":r=7;break;case"month":r=30;break;default:(0,Y.t1)(a)}const o=n-r*Q.A0;return t.filter((e=>e>=o))}({exposures:n,windowEndMillis:r,windowDuration:i});return s.length<o}function X(e){const{context:t,calloutKey:n,constraints:a}=e,{global:r,placements:o}=a,i=G.xg[n];if(t.currentDateTime.toMillis()>i.end)return!1;const s=i.placement;return!!function(e){const{constraint:t,context:n}=e;if(t.frequencyCap){const e=Object.values(n.placementExposures).flat();if(!J({frequencyCapConstraint:t.frequencyCap,exposures:e,currentDateTime:n.currentDateTime}))return!1}return!0}({context:t,constraint:r})&&!!function(e){const{constraint:t,placementKey:n,context:a}=e;if(t.frequencyCap&&!J({frequencyCapConstraint:t.frequencyCap,exposures:a.placementExposures[n],currentDateTime:a.currentDateTime}))return!1;if(t.conflictsWith)for(const r of t.conflictsWith)if(a.currentEligibleCallouts[r].size>0)return!1;if(t.maxConcurrent&&a.currentEligibleCallouts[n].size>=t.maxConcurrent)return!1;return!0}({context:t,constraint:o[s],placementKey:s})}function ee(e){const{candidateCallouts:t,globalConstraint:n,placementConstraints:a,placementExposures:r}=e,o=(0,G.$e)(),i=z.ou.now(),s=function(e){const t=e.filter((e=>"Modal"===(0,G.QN)(e))),n=e.filter((e=>"Modal"!==(0,G.QN)(e)));return t.sort(((e,t)=>G.xg[t].start-G.xg[e].start)),n.sort(((e,t)=>(0,G.Yy)(e)-(0,G.Yy)(t))),[...t,...n]}(t),c={placementExposures:r,currentDateTime:i,currentEligibleCallouts:o},d={global:n,placements:a};for(const l of s)if(X({context:c,calloutKey:l,constraints:d})){o[(0,G.QN)(l)].add(l)}return o}var te=n(521273),ne=n(279827),ae=n(319385),re=n(288280),oe=n(954690),ie=n(706210);async function se(e){ne.default.reset();const t=await async function(){await c.default.waitUntil((()=>void 0!==c.default.state.currentUserSettingsStore&&void 0!==c.default.state.mainEditorCurrentBlockStore&&void 0!==c.default.state.currentSpaceStore&&void 0!==c.default.state.currentSpaceViewStore&&c.default.state.currentUserSettingsStore.isReady()&&c.default.state.mainEditorCurrentBlockStore.isReady()&&c.default.state.currentSpaceStore.isReady()&&c.default.state.currentSpaceViewStore.isReady()));const e=c.default.state.currentUserSettingsStore,t=c.default.state.mainEditorCurrentBlockStore,n=c.default.state.currentSpaceStore,a=c.default.state.currentSpaceViewStore;return await ae.default.waitUntilStatsigReady(),await te.Z.waitUntil((()=>te.Z.getIsInitialized())),await re.subscriptionDataStoreInstance.waitUntilLoaded(),{currentUserSettingsStore:e,currentSpaceStore:n,mainEditorCurrentBlockStore:t,experimentStore:ae.default,assistantFeatureGateStore:te.Z,subscriptionDataStore:re.subscriptionDataStoreInstance,currentSpaceViewStore:a}}(),n=await async function(e,t){const n=[];for(const a of G.$Z)await oe.$[a](e,t)&&n.push(a);return n}(e,t),a=ee({candidateCallouts:n,globalConstraint:G.$Q.globalConstraint,placementConstraints:G.$Q.placementConstraints,placementExposures:(0,G.Y6)()});(0,ie.YF)(e,{eligible_callouts:a});for(const r of G.nK)ne.default.state.placementStores[r].setState(new Set(a[r]))}var ce=n(32223);async function de(e){if(e.device.isBrowser&&document.hidden)return;if(e.device.isElectron&&!(await L.isWindowVisible()))return;if(ce.isConnected())return void le(!0);if(!1===navigator.onLine&&!M.default.isLocalhost)return void le(!1);"success"===(await p.ping(e,{})).type?le(!0):le(!1)}function le(e){m.Z.setState({...m.Z.state,online:e,lastOfflineTimestamp:e?m.Z.state.lastOfflineTimestamp:Date.now()})}const ue=5e3;var pe=n(922705),me=n(966324),ve=n(938676),fe=n(424042),Se=n(833110);var be=n(184747),ge=n(957400);const he=6e5;function _e(e){ge.Th({environment:e})}var we=n(979947);function Ce(e){(0,we.default)({url:`${M.default.secureFileConfig.rootPath}/refresh`,environment:e,method:"GET",format:"text"})}var Oe=n(653965),Te=n(436610);const ye=Oe.P2(Te.XW,5e3);var Ne=n(225972),Ee=n(258455);var Ue=n(662134),ke=n(245023);var Ie=n(324502);var Ae=n(701302),Le=n(14577),Me=n(761045),Ve=n(869454),Pe=n(924666);const Ze=new Le.Z((()=>{const e=Ve.Z.state;return e.phase===Ve.i.willShow?0:e.estimatedKeyboardWebViewOverlap}),{debugName:"estimatedKeyboardWebViewOverlapStore"});var Re=n(404993),xe=n(730583),De=n(318245);var Be=n(898104),Fe=n(389224),qe=n(259238);const He=window.matchMedia("(prefers-color-scheme: dark)");var Ke=n(598794),$e=n(427534);const We="loadCachedPageChunk";var je=n(210228);var Ge=n(164964);var ze=n(883355),Ye=n(427328),Qe=n(815145),Je=n(597213),Xe=n(89101),et=n(421202),tt=n(492338);const nt=["compact","regular","unknown"];var at=n(307032),rt=n(63811),ot=n(212847),it=n(483249),st=n(73990),ct=n(497977),dt=n(98958),lt=n(211302),ut=n(452423),pt=n(132953),mt=n(321862),vt=n(608055),ft=n(901357),St=n(587531),bt=n(524677),gt=n(29974),ht=n(970782),_t=n(139634),wt=n(433929),Ct=n(551783),Ot=n(344499),Tt=n(745162),yt=n(918514),Nt=n(645010),Et=n(897638);function Ut(e){const t=(0,Ye.w_)(e);switch(t.type){case"native":return;case"web":const e=t.route;switch(e.name){case"page":return e.collectionViewId?"collection":"page";case"nativeTab":switch(e.tab){case"search":return"search";case"updates":return"updates";case"assistant":return"assistant"}break;default:return}}}var kt=n(555081),It=n(775538),At=n(525286),Lt=n(224646),Mt=n(397799),Vt=n(591190),Pt=n(136896),Zt=n(44604),Rt=n(905162),xt=n(434859),Dt=n(112252),Bt=n(830581),Ft=n(964233),qt=n(803418),Ht=n(269327),Kt=n(100475),$t=n(465686),Wt=n(231104),jt=n(853610),Gt=n(866881),zt=n(449682),Yt=n(206258),Qt=n(562820),Jt=n(897630);const Xt=(0,U.defineMessages)({failedToMovePageGeneric:{id:"MobileNativeListener.failedToMovePage",defaultMessage:"Failed to move page"}});let en;class tn extends ze.Z{constructor(){super(...arguments),this.bottomBarVisibilityStore=this.createComputedStore((()=>{const{currentUserStore:e}=c.default.state,t=Boolean(null==e?void 0:e.id),n=It.default.state.isOnboarding,a=(0,Rt.Y)("supportsNativeBottomBarOverlappingWebView")?qt.Z.hasOpenMobileSlideUps():qt.Z.hasOpenPopups(),r=Wt.Z.state.open,o="web"!==(0,Ye.w_)(this.environment.TabbedRouterStore.state).type,i=t&&!r&&!n&&!a;return(0,Rt.Y)("supportsWebManagedTabNavigation")&&!!o||i})),this.customAddCommentMenuItemEnabledStore=this.createComputedStore((()=>{var e;if(!(0,Rt.Y)("supportsCustomAddCommentMenuItem"))return!1;const{currentUserStore:t}=c.default.state;if(!Boolean(null==t?void 0:t.id))return!1;if((0,Rt.Y)("supportsNativeBottomBarOverlappingWebView")?qt.Z.hasOpenMobileSlideUps():qt.Z.hasOpenPopups())return!1;const{TabbedRouterStore:n}=this.environment,a=(0,Ye.w_)(n.state),r="web"===a.type&&((null===(e=a.redirectedTo)||void 0===e?void 0:e.route)||a.route);if(!r||"page"!==r.name)return!1;const o=Pe.default.state;if("empty"===o.mode)return!1;const i=(0,Tt.tp)({multiSelection:o.multiSelection,filterCommonAncestors:!0,focus:void 0});if(!i||0===i.stores.length)return!1;let s=!0;return i.stores.forEach((e=>{s&&(s=s&&e.canComment())})),s})),this.aiAssistantEnabledStore=this.createComputedStore((()=>{const{currentUserStore:e,currentSpaceStore:t}=c.default.state;if(!e||!t)return;const n=te.Z.isShowingQNAOnMobile();return{userId:e.id,spaceId:t.id,enabled:n}})),this.aiAssistantVisibilityStore=this.createComputedStore((()=>({enabled:!1}))),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSideBarExpandedStateChange=()=>dn(this.environment),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBottomBarVisibilityStoreChange=()=>function(e,t){var n;const a=t.state;null===(n=e.mobileNative)||void 0===n||n.toggleBottomBar(a)}(this.environment,this.bottomBarVisibilityStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleAiAssistantEnabledStoreChange=()=>function(e,t){var n;const a=t.state;if(!a)return;null===(n=e.mobileNative)||void 0===n||n.updateAiAssistantEnabledState(a)}(this.environment,this.aiAssistantEnabledStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleAiAssistantVisibilityStoreChange=()=>function(e,t){var n;const a=t.state;null===(n=e.mobileNative)||void 0===n||n.updateAiAssistantVisibilityState(a)}(this.environment,this.aiAssistantVisibilityStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSwipeNavigation=()=>function(e){const{mobileNative:t,RouterStore:n}=e;if(!t)return;if(t.setWebViewAllowsNavigationGestures){const{route:e}=n.state;"onboarding"===e.name||ve.sidebarOpenStore.state||$t.Z.getPreventScrollType()!==xt.Z.None?!1!==en&&(en=!1,t.setWebViewAllowsNavigationGestures(!1)):!0!==en&&(en=!0,t.setWebViewAllowsNavigationGestures(!0))}}(this.environment),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleKeyboardAutoScroll=()=>{return e=this.environment,void(Ve.Z.state.phase===Ve.i.willShow&&Ae.default.afterNextFlush((()=>Me.hQ(e))));var e},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMobileNativeKeyboardStore=()=>function(e){const{RouterStore:t,NativeMobileActionBarStore:n}=e;if("page"!==t.state.route.name)return;if(Ve.Z.state.phase===Ve.i.hidden){var a;if(Ft.Z.state.open)return;if(Boolean(null==n||null===(a=n.state)||void 0===a?void 0:a.menuType))return;Be.ZH({debug:{userAction:"MobileNativeListener.handleMobileNativeKeyboardStore"},environment:e})}}(this.environment),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTabbedRouterStoreChange=()=>function(e){var t;const{mobileNative:n,TabbedRouterStore:a}=e,r=null==n||null===(t=n.api)||void 0===t?void 0:t.handleTabbedRouterStateUpdate;if(r){const t=a.state;r({state:t,topPage:(0,Ye.w_)(t),webTransitionType:Ut(t),updateId:(0,at.ZP)()});const n=a.getPreviousState();if(!n)return;const o=(0,Ye.F9)(n),i=(0,Ye.F9)(t);Oe.Xy(o,i)||it.w3(e,{origin:o,destination:i,from:t.navigationSource,action:t.navigationAction,logging_source:"mobile_native"})}}(this.environment),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCustomAddMenuItemEnabledChanged=()=>ln(this.environment,this.customAddCommentMenuItemEnabledStore),this.getLocalSearchCache=Oe.HP((async(e,t)=>(await o.FF.searchActions.load()).getLocalCacheFromAppState(e)),((e,t)=>{var n;return`${e.currentUser.id}-${(null===(n=c.default.state.currentSpaceViewStore)||void 0===n?void 0:n.id)??"none"}-${t??"none"}`}))}UNSAFE_willMount(){const{mobileNative:e,RouterStore:t,TabbedRouterStore:a,device:r}=this.environment;var i;r.isMobileNative&&e&&(ve.sidebarOpenStore.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSwipeNavigation),ve.sidebarExpandedStore.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSideBarExpandedStateChange),Bt.Z.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSwipeNavigation),t.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSwipeNavigation),Ve.Z.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleKeyboardAutoScroll),this.bottomBarVisibilityStore.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBottomBarVisibilityStoreChange),this.aiAssistantEnabledStore.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleAiAssistantEnabledStoreChange),this.aiAssistantVisibilityStore.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleAiAssistantVisibilityStoreChange),this.environment.WindowSizeStore.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSideBarExpandedStateChange),a.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTabbedRouterStoreChange),this.customAddCommentMenuItemEnabledStore.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCustomAddMenuItemEnabledChanged),e.updateReceiveApiHandlers({statusBarTap:cn,backButtonPress:()=>Ue.Zm(this.environment,{type:"backbutton"}),keyboardWillShow:e=>{Ve.Z.updateKeyboardPhase(this.environment,Ve.i.willShow,e??0)},keyboardDidShow:e=>Ve.Z.updateKeyboardPhase(this.environment,Ve.i.shown,e??0),keyboardWillHide:()=>{Ve.Z.updateKeyboardPhase(this.environment,Ve.i.willHide,0)},keyboardDidHide:()=>{var e;(Ve.Z.updateKeyboardPhase(this.environment,Ve.i.hidden,0),r.isIpad)&&(bt.ZH({debug:{userAction:"MobileNativeListener.UNSAFE_willMount"},environment:this.environment}),null===(e=this.environment.NativeMobileActionBarStore)||void 0===e||e.clear(!0))},keyboardShortcut:e=>Ue.Zm(this.environment,e),nativeBottomBarDidChange:e=>{void 0!==e.height&&Ve.Z.update((t=>({...t,nativeBottomBarHeight:e.height})))},pushNotificationTokenRefresh:e=>dt.handleTokenRefresh(this.environment,e,"refresh"),resume:Dt.Z.resume,pause:async()=>{Dt.Z.pause();const{stopDictation:e}=await Promise.all([n.e(69053),n.e(51475),n.e(11766)]).then(n.bind(n,920939));await e({environment:this.environment})},refreshSubscriptionData:async e=>{await p.invalidateSubscriptionData(this.environment,{spaceId:e,provider:"revenue_cat"}),await Jt.bi(this.environment)},refreshSubscriptionDataV2:async()=>{await Jt.bi(this.environment)},processMobileActionBarAction:t=>{const{componentId:n,action:a}=t;e.componentEvents.dispatch("MobileActionBar",n,"onAction",{action:a})},trackExperimentExposure:async e=>{await Te.Bb({environment:this.environment,experiment_id:e.experimentId,experiment_version:e.experimentVersion,experiment_group:e.group||"ineligible",logging_source:"mobile_native"})},logout:e=>{ct.logoutSingleAccount({environment:this.environment,userId:e,logoutOrigin:Je.F.MobileNativeListener})},logoutV2:e=>{const{userId:t,fcmToken:n}=e;ct.logoutSingleAccount({environment:this.environment,userId:t,logoutOrigin:Je.F.MobileNativeListener,fcmToken:n})},logoutAll:()=>{ct.logout(this.environment)},openDestinationV2:e=>{qt.Z.closeAll();const t=this.environment,n=(0,Ye.w_)(t.TabbedRouterStore.state),{activeTab:r,tabs:o}=t.TabbedRouterStore.state,i=n===o[r].rootPage,s="native"===n.type,c=i&&s;switch((0,yt.__)(this.environment)&&ft.S({environment:this.environment,tab:a.state.activeTab,nativeRootPageOverrideEnabled:!1}),e.type){case"moveTo":!function(e,t){const n=new Yt.G(t,{table:et.iU,id:e});lt.bA({environment:t,blocks:[n],moveToContext:"home_tab",onAccept:e=>{mt.r({store:n,environment:t,pageVisitSource:Qe.tY.Move})}})}(e.blockId,this.environment);break;case"trash":on({query:e.query});break;case"templates":!function(e,t){sn(e),zt.Z.setState({open:!0,source:t.source})}(this.environment,{source:e.source});break;case"AIAssistant":!function(e,t,n){Gt.g.update((e=>({query:n.query,searchSessionId:n.searchSessionId,from:n.from??"search",shouldReset:Boolean(n.query&&n.query.trim().length>0)}))),vt.c4({environment:e,url:`${Xe.VP.nativeTab}/assistant`,redirect:t})}(this.environment,c,{query:e.query,searchSessionId:e.searchSessionId,from:e.from})}},openDestination:e=>{qt.Z.closeAll();switch("closePopup"!==e&&(0,yt.__)(this.environment)&&Boolean(a.state.tabs[a.state.activeTab].nativeRootPageOverrideEnabled)&&ft.S({environment:this.environment,tab:a.state.activeTab,nativeRootPageOverrideEnabled:!1}),e){case"search":!function(e){(0,Rt.Y)("supportsNativeHome")&&e.device.isPhone?(pt.Hu({RouterStore:e.RouterStore,currentUserId:e.currentUser.id}),St.UT({environment:e,analyticsFrom:"mobile-bottom-bar",renderAsPage:!0})):St.UT({environment:e,analyticsFrom:"mobile-bottom-bar"});it.nB(e,{itemName:"search",logging_source:"mobile_native"})}(this.environment);break;case"addPage":sn(this.environment);break;case"allUpdates":t=this.environment,(0,Rt.Y)("supportsNativeHome")&&t.device.isPhone?(pt.Hu({RouterStore:t.RouterStore,currentUserId:t.currentUser.id}),vt.c4({environment:t,url:`${Xe.VP.nativeTab}/updates`,redirect:!0})):Qt.Z.setState({...Qt.Z.state,open:!0});break;case"addAccount":Vt.C.setState({...Vt.C.state,open:!0});break;case"createOrJoinWorkspace":return async function(e){await kt.xN(e)}(this.environment);case"notificationAndSettings":Mt.Z.setState({open:!0,source:Mt.Y.Home});break;case"trash":on({});break;case"memberSettings":jt.Z.setState({...jt.Z.state,open:!0});break;case"help":Kt.Z.setState({...Kt.Z.state,open:!0});break;case"intercom_messages":!function(e){_t.j({environment:e,from:"help_button"})}(this.environment);break;case"aiWriter":!function(e){Ct.QG(e)}(this.environment)}var t},setCurrentUserId:async e=>{await async function(e,t){if(t.currentUser.id===e)return;await ht.x({environment:t,newCurrentUserId:e})}(e,this.environment)},setCurrentSpace:async e=>{await async function(e,t,n){const a=await ht.x({environment:n,newCurrentUserId:e}),{currentUserRootStore:r,currentUserSettingsStore:o}=c.default.state;if(!r)return;await r.load();const i=(0,w.w3)(t);i&&await gt.y3({environment:a,spaceViewStore:i,userSettingsStore:o,userRootStore:r,pageVisitSource:Qe.tY.SwitchSpace,navigationType:"switchingToOrLoadingSpace"})}(e.userId,e.spaceId,this.environment)},updateHorizontalSizeClass:t=>{const n=(0,rt.Gu)(ot.literals(...nt),t)?"unknown":t;n!==e.horizontalSizeClass.state&&e.horizontalSizeClass.setState(n)},updateTabbedRouterState:e=>{var t;const{TabbedRouterStore:n}=this.environment,a=n.state;if(e.tab!==a.activeTab||null!==(t=e.pages)&&void 0!==t&&t.length||!Oe.Xy(e.modal,a.modal)||a.tabs[a.activeTab].pages.length){const t=e.navigationEffect;if(t&&"AIAssistant"===t.type)Gt.g.update((e=>({query:t.query,searchSessionId:t.searchSessionId,from:t.from??"search",shouldReset:Boolean(t.query&&t.query.trim().length>0)})));ft.S({environment:this.environment,tab:e.tab,queryParams:e.queryParams,pages:e.pages,modal:e.modal,nativeRootPageOverrideEnabled:e.nativeRootPageOverrideEnabled,navigationAction:e.navigationAction,navigationSource:e.navigationSource})}else rn();const r=n.state;return[{state:r,topPage:(0,Ye.w_)(r),webTransitionType:Ut(r),updateId:e.updateId??(0,at.ZP)()}]},getLocalSearchResults:async e=>{const t=await this.getLocalSearchCache(this.environment,e.searchSessionId);if(!t)return[{error:"Local cache does not exist"}];const n=(0,rt.Gu)(tt.GA,e.sort);if(n)return[{error:`old sort type is unsupported! ${n}`}];const a=e.sort,r=(0,At.f)({query:{query:{text:e.query??"",filters:e.filters,sort:a},limit:e.limit},localCachedPages:t,includeRecordMap:!1,userId:this.environment.currentUser.id,environment:this.environment}),o=[{value:{total:0,results:[],recordMap:{},trackEventProperties:void 0}}];if(!r||0===r.results.length)return o;const i=m.Z.state.online?Et.g8(this.environment,r.results):r.results;return[{value:{results:i,total:i.length,recordMap:{},trackEventProperties:{}}}]},customAddCommentMenuItemTapped:()=>{(0,Ct.ol)(this.environment,"custom_add_comment_menu_item")},filterValidMoveToBlocks:e=>{const t=e.targets.map((e=>new Yt.G(this.environment,{table:et.iU,id:e}))),n=e.blocks.filter((e=>{const n=new Yt.G(this.environment,{table:et.iU,id:e});return n.canEdit()&&(0,Ot.Xk)(n,t)}));return[{value:{targets:e.targets,blocks:n}}]},completeMoveToTransaction:async e=>{const{targets:t,destination:n,moveToContext:a,timeToSelectMs:r,isSearchResult:o,flowId:i}=e,s=this.environment,c=t.map((e=>new Yt.G(this.environment,{table:et.iU,id:e}))),d=lt.QF(s,t,n);if(c&&c.length>0&&!d)try{return await je.createAndCommitAsync({userAction:"MobileNativeListener.completeMoveTo",environment:s,waitForServerCommit:!1,perform:async e=>{await lt.RL({targets:c,value:n,transaction:e,environment:s,moveToContext:a,renderType:"native",timeToSelectMs:r,disableSuccessToast:!0,isSearchResult:o,flowId:i})}}),[{value:e}]}catch(l){}return st.fW(s,{type:"moved_to_subpage"}),[{error:wt.default.formatMessage(Xt.failedToMovePageGeneric)}]},undoRevision:()=>{ut.Yw(this.environment,!0)},searchTeams:async e=>{const{query:t}=e,n=c.default.state.currentSpaceStore,a=c.default.state.currentSpaceViewStore;if(!n||!a)return[{error:"SpaceStore or SpaceViewStore was undefined"}];const r=await o.FF.searchActions.load();return[{value:{ids:(await r.searchTeams({spaceViewStore:a,query:t,teamStores:a.getTeamsStores()})).map((e=>e.id))}}]}}),r.isAndroid&&Ve.Z.addListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMobileNativeKeyboardStore),null!==(i=this.environment.mobileNative)&&void 0!==i&&i.api.ready&&this.environment.mobileNative.api.ready(),dn(this.environment),ln(this.environment,this.customAddCommentMenuItemEnabledStore))}willUnmount(){const{mobileNative:e,RouterStore:t,TabbedRouterStore:n,device:a}=this.environment;a.isMobileNative&&e&&(ve.sidebarOpenStore.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSwipeNavigation),ve.sidebarExpandedStore.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSideBarExpandedStateChange),Bt.Z.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSwipeNavigation),t.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSwipeNavigation),Ve.Z.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleKeyboardAutoScroll),this.bottomBarVisibilityStore.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBottomBarVisibilityStoreChange),this.aiAssistantEnabledStore.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleAiAssistantEnabledStoreChange),this.aiAssistantVisibilityStore.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleAiAssistantVisibilityStoreChange),n.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTabbedRouterStoreChange),this.customAddCommentMenuItemEnabledStore.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCustomAddMenuItemEnabledChanged),a.isAndroid&&Ve.Z.removeListener(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMobileNativeKeyboardStore))}renderComponent(){return(0,D.jsx)(an,{getLocalSearchCache:this.getLocalSearchCache})}}tn.displayName="MobileNativeListener";const nn=tn;function an(e){let{getLocalSearchCache:t}=e;const n=(0,r.O7)(),{device:o}=n,i=(0,a.useRef)(),s=(0,a.useRef)(),d=(0,a.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object.keys(e.tabs).forEach((n=>{const a=n;t&&(e.tabs[a].nativeRootPageOverrideEnabled=void 0),e.tabs[a].pages="home"!==a?[]:e.tabs[a].pages.splice(0,1)}))}),[]),l=(0,a.useCallback)((e=>{var a;i.current=null==e?void 0:e.id;const{mobileNative:r,TabbedRouterStore:o,currentUser:s}=n,l=c.default.state.currentSpaceStore,u=null==l?void 0:l.id;if(null!=r&&null!==(a=r.api)&&void 0!==a&&a.setCurrentSpaceInfo&&(y.log({level:"info",from:"appActions",type:"SpaceSwitchingDebug",data:{message:"Web calling nativeAPI setCurrentSpaceInfo",spaceId:u}}),r.api.setCurrentSpaceInfo({spaceId:u,spaceViewId:null==e?void 0:e.id,userId:s.id,editable:(null==l?void 0:l.canEdit())??!0})),(0,yt.__)(n)){const e=e=>{if("web"!==e.type)return;const t={...e.queryParams},n=u&&(0,at.cj)(u);t.spaceId=n,e.queryParams=t,e.route.spaceId=n},t=Oe.Xh(o.state);e(t.tabs.search.rootPage),e(t.tabs.updates.rootPage),e(t.tabs.addPage.rootPage),d(t),o.setState(t)}t(n,void 0)}),[d,n,t]),u=(0,a.useCallback)((e=>{var t;s.current=null==e?void 0:e.id,null!==(t=n.mobileNative)&&void 0!==t&&null!==(t=t.api)&&void 0!==t&&t.setCurrentUserInfo&&n.mobileNative.api.setCurrentUserInfo({userId:null==e?void 0:e.id,loggedInUserIds:n.currentUser.loggedInUserIds});const a=!(0,yt.__)(n)||void 0===n.currentUser.id,{TabbedRouterStore:r}=n,o=Oe.Xh(r.state);d(o,a),r.setState(o)}),[d,n]),p=(0,a.useCallback)((()=>{const{currentUserStore:e,currentSpaceStore:t}=c.default.state;null!=e&&e.id&&null!=t&&t.id&&Ht.Z.reinitializeState(n,e.id,t.id);(void 0===(null==e?void 0:e.id)||s.current!==(null==e?void 0:e.id))&&u(e);const a=c.default.state.currentSpaceViewStore;i.current!==(null==a?void 0:a.id)&&l(a)}),[n,l,u]);return(0,a.useEffect)((()=>{if(o.isMobileNative&&n.mobileNative)return p(),c.default.addListener(p),()=>{c.default.removeListener(p)}}),[o.isMobileNative,n,t,p]),null}function rn(){$t.Z.getPreventScrollType()===xt.Z.None&&(ve.sidebarOpenStore.state?Nt.Z.SidebarMobileScroller&&Nt.Z.SidebarMobileScroller.scrollToTop({animate:!0,animationCallback:Oe.yR}):Nt.Z.MenuScroller?Nt.Z.MenuScroller.scrollToTop({animate:!0,animationCallback:Oe.yR}):Nt.Z.MenuPageScroller?Nt.Z.MenuPageScroller.scrollToTop({animate:!0,animationCallback:Oe.yR}):Nt.Z.PageScroller&&Nt.Z.PageScroller.scrollToTop({animate:!0,animationCallback:Oe.yR}))}function on(e){Pt.Z.setState({open:!0});const{query:t}=e;t&&Zt.ZP.setState({...Zt.ZP.state,currentTab:"all_pages",filter:t,limit:Zt.ZP.startLimit})}function sn(e){(0,Rt.Y)("supportsNativeHome")&&e.device.isPhone?(pt.Hu({RouterStore:e.RouterStore,currentUserId:e.currentUser.id}),me.quickAddPage({environment:e,from:"mobile_bottom_bar",redirect:!0,quickAddParentOverride:{type:"space-private-pages"}})):me.quickAddPage({environment:e,from:"mobile_bottom_bar"}),it.nB(e,{itemName:"add_page"})}function cn(){rn()}function dn(e){var t;null===(t=e.mobileNative)||void 0===t||t.sidebarVisibility(ve.sidebarExpandedStore.state&&!(0,Lt.YR)(e),(0,Lt.qG)(e))}function ln(e,t){if(!(0,Rt.Y)("supportsCustomAddCommentMenuItem"))return;const n=t.state,{mobileNative:a}=e;null==a||a.updateCustomAddCommentMenuItemEnabled(n)}function un(){const e=(0,r.Fy)();return function(){const e=(0,r.O7)(),t=(0,r.Fy)();(0,a.useEffect)((()=>{if(t.isMobileNative)return;let e;document.hasFocus()&&(e=setInterval((()=>{l()}),d),l());const n=()=>{e&&clearInterval(e),e=setInterval((()=>{l()}),d),l()},a=()=>{e&&clearInterval(e),e=void 0};return window.addEventListener("focus",n),window.addEventListener("blur",a),()=>{e&&clearInterval(e),window.removeEventListener("focus",n),window.removeEventListener("blur",a)}}),[t.isMobileNative,e])}(),function(){const e=(0,a.useRef)(!1),t=(0,r.O7)(),n=(0,a.useCallback)((async e=>{if(e.currentUser.id&&p.pendingTaskIds.size>0){const t=await p.getTasks(e,{taskIds:Array.from(p.pendingTaskIds.values())});if("success"===t.type){const{results:n}=t.data,a=new Set(p.pendingTaskIds);for(const t of n)a.delete(t.id),t.status&&p.handleRecordMapForResponse({environment:e,eventName:t.eventName,response:t.status,userId:e.currentUser.id}),p.pendingTaskEventsById.emit(t.id,t),S.emit(t.eventName,t),"failure"!==t.state&&"success"!==t.state&&"dead"!==t.state&&"timeout_before_execution"!==t.state||p.pendingTaskIds.delete(t.id);if(a.size>0)for(const e of a.values())p.pendingTaskIds.delete(e)}}}),[]),o=(0,a.useCallback)((async e=>{if(e.currentUser.id){const t=await p.getUserTasks(e,{});if("success"===t.type){for(const e of t.data.taskIds)p.pendingTaskIds.add(e);t.data.taskIds.length>0&&n(e)}}}),[n]),i=(0,a.useCallback)((()=>{const n=m.Z.state.online;n&&!e.current&&o(t),e.current=n}),[t,o]);function s(e){"success"===e.state?v.Z.setStatus(e.request.blockId,void 0):"in_progress"===e.state||"not_started"===e.state?v.Z.setStatus(e.request.blockId,e.status):v.Z.setStatus(e.request.blockId,void 0)}function c(e){"success"===e.state?f.Z.setStatus(e.request.blockId,!1):"in_progress"===e.state||"not_started"===e.state?f.Z.setStatus(e.request.blockId,!0):f.Z.setStatus(e.request.blockId,!1)}(0,a.useEffect)((()=>{e.current=m.Z.state.online;const a=setInterval((()=>n(t)),1e3);return o(t),m.Z.addListener(i),S.addListener("importEvernote",s),S.addListener("extractWebClipperContent",c),()=>{clearInterval(a),m.Z.removeListener(i),S.removeListener("importEvernote",s),S.removeListener("extractWebClipperContent",c)}}),[t,n,i,o])}(),function(){const e=(0,r.O7)(),t=(0,a.useCallback)((()=>{b.LH(e)}),[e]);(0,a.useEffect)((()=>(t(),g.Z.addListener(t),()=>{g.Z.removeListener(t)})),[t])}(),O(),F(),function(){const e=(0,r.O7)(),t=(0,h.VK)((()=>e.currentUser.id),[e]),n=(0,h.VK)((()=>c.default.state.currentSpaceStore),[]),o=(0,h.VK)((()=>null==n?void 0:n.id),[n]);(0,a.useEffect)((()=>{t&&o&&se(e)}),[t,o,e])}(),function(){const e=(0,r.O7)();(0,a.useEffect)((()=>{de(e);const t=window.setInterval((()=>de(e)),ue);return()=>window.clearInterval(t)}),[e])}(),function(){const e=(0,r.O7)();(0,be.Z)((()=>{_e(e)})),(0,a.useEffect)((()=>{const t=window.setInterval((()=>_e(e)),he);return()=>{window.clearInterval(t)}}),[e])}(),function(){const e=(0,r.O7)();(0,a.useEffect)((()=>{Ce(e);const t=window.setInterval((()=>Ce(e)),Q.U6);return()=>window.clearInterval(t)}),[e])}(),function(){const e=(0,r.O7)(),t=(0,r.Fy)(),n=(0,h.VK)((()=>{const{currentUserStore:n,currentUserSettingsStore:a,currentUserRootStore:r}=c.default.state;if(!(e.currentUser.id&&n&&a&&r))return e.publicDomainUserId?{user_id:e.publicDomainUserId}:void 0;const o=r.getSpaceViewStores(),i=o.length>0&&o.every((e=>e.isReady()));if(!n.isDefined()||!a.isDefined()||!i)return;const d=Oe.oA(o.map((e=>e.getSpaceId()))).map((t=>C.Z.getData(e,{spaceId:t})));if(!d.every((e=>Boolean(e)||null===e)))return;const l=(0,s.ls)(d),u=a.getSettings();if(!u)return;if(void 0===re.subscriptionDataStoreInstance.state)return;const p={user_id:n.id,email:n.getEmail(),user_persona:u.persona,user_team_role:u.team_role,user_use_cases:u.use_cases,user_company_size:u.company_size,user_source:u.source,user_plan_type:l,user_subscription_tier:re.subscriptionDataStoreInstance.state.subscriptionTier,user_has_at_least_one_free_tier_space:(0,s.nZ)(d),time_zone:u.time_zone,locale:u.locale,preferred_locale:u.preferred_locale,signup_time:u.signup_time,app_version:t.version};return u.signup_time&&(p.created_at=Math.floor(u.signup_time/1e3)),t.desktopAppVersion&&(p.desktop_app_version=t.desktopAppVersion),t.mobileAppVersion&&(p.mobile_app_version=t.mobileAppVersion),u.used_desktop_web_app&&(p.used_desktop_web_app=u.used_desktop_web_app),u.used_mobile_web_app&&(p.used_mobile_web_app=u.used_mobile_web_app),u.used_mac_app&&(p.used_mac_app=u.used_mac_app),u.used_windows_app&&(p.used_windows_app=u.used_windows_app),u.used_ios_app&&(p.used_ios_app=u.used_ios_app),u.used_android_app&&(p.used_android_app=u.used_android_app),p}),[e,t],{useDeepEqual:!0});(0,a.useEffect)((()=>{n&&"none"!==n.user_plan_type&&ye(e,n)}),[e,n]);const o=void 0!==n;(0,a.useEffect)((()=>{const t=window.setTimeout((()=>{!o&&e.currentUser.id&&ye(e,{user_id:e.currentUser.id})}),5e3);return()=>{window.clearTimeout(t)}}),[e,o])}(),function(){const e=(0,r.O7)(),t=(0,h.VK)((()=>Ee.default.state.isLoaded),[]),n=(0,h.VK)((()=>Ee.default.state.isLoggingEnabled),[]);(0,a.useEffect)((()=>{t&&async function(){const t=await(0,s.cG)(e);await Ne.j2({config:M.default,isEnabled:n,deviceId:t,cookieService:e.cookieService})}()}),[e,t,n])}(),function(){const e=(0,r.O7)();(0,a.useEffect)((()=>{const t=t=>{Ue.Zm(e,t)},n=t=>{const{shortcutMap:n}=e.KeyboardShortcutStackStore,a=Oe.w_(n,((n,a)=>(0,ke.Z)(e,t,n)));a&&!{cut:!0,copy:!0,paste:!0}[a]&&Ue.dJ(e,t,a)};return window.addEventListener("keydown",n),window.addEventListener("cut",t),window.addEventListener("copy",t),window.addEventListener("paste",t),window.addEventListener("keypress",t),()=>{window.removeEventListener("keydown",n),window.removeEventListener("cut",t),window.removeEventListener("copy",t),window.removeEventListener("paste",t),window.removeEventListener("keypress",t)}}))}(),(0,Ie.Z)(),function(){const e=(0,r.O7)(),t=(0,r.Fy)();(0,a.useEffect)((()=>{t.isElectron&&L.setLogglyData(y.clientLogglyEnvironmentData),e.mobileNative&&e.mobileNative.setLogglyData(y.clientLogglyEnvironmentData)}),[t.isElectron,e.mobileNative])}(),function(){const e=(0,r.O7)();(0,a.useEffect)((()=>{if(e.device.isMobile){function t(){Ae.default.afterNextFlush((()=>{Me.hQ(e)}))}return Pe.default.addListener(t),Ze.addListener(t),()=>{Pe.default.removeListener(t),Ze.removeListener(t)}}}),[e])}(),(0,Re.Z)(),(0,xe.ZP)(),function(){const e=(0,r.O7)();(0,a.useEffect)((()=>{const{mobileNative:t}=e;t&&t.enableBridgeMetricsCollection(e,De.default,ae.default)}),[e])}(),function(){const e=(0,r.O7)();(0,a.useEffect)((()=>{function t(){x.Z.setState({...x.Z.state,isVisible:!document.hidden});const t=k.W$(),n=t&&(Date.now()-t)/Q.A0>=7;if(e.device.isBrowser&&!document.hidden&&(!t||n)&&m.Z.getState().online){const t=e.AppUpdateStore;if(t.isSilentUpdate()){const n=t.state.appUpdate;k.hC({environment:e,url:window.location.href,version:n.version})}}}return document.addEventListener("visibilitychange",t),t(),()=>{document.removeEventListener("visibilitychange",t)}}),[e])}(),function(){const{deviceType:e}=(0,r.Fy)(),t=(0,r.O7)(),n=t.currentUser.isLoggedIn();(0,a.useEffect)((()=>{if(!n)return;if("windows-desktop"!==e&&"mac-desktop"!==e)return;const a=async()=>{await L.isMainTabOrWindow()&&p.registerDesktopApp(t,{deviceType:e})};a();const r=window.setInterval((()=>{a()}),5*Q.hM);return()=>{window.clearInterval(r)}}),[n,e,t])}(),function(){const e=(0,r.O7)(),t=(0,a.useRef)(),n=(0,a.useRef)();(0,a.useEffect)((()=>{function a(){const a=Pe.default.state,r="empty"===a.mode?void 0:a.multiSelection.start.store,o="empty"===a.mode?void 0:a.multiSelection.end.store;if(t.current===r&&n.current===o)return;if(t.current=r,n.current=o,t.current!==n.current)return;const i=$e.getSimpleTableCellFromTextSelection();if(!i)return;const{rowIndex:s,columnIndex:c,simpleTableStore:d}=i.getProps();Ke.selectCell({environment:e,rowIndex:s,columnIndex:c,simpleTableStore:d})}return Pe.default.addListener(a),()=>{Pe.default.removeListener(a),t.current=void 0,n.current=void 0}}))}(),function(){const e=(0,r.O7)(),t=(0,a.useCallback)((t=>{const n={compressed:t.decodedBodySize!==t.encodedBodySize,local_cache_hit:0===t.transferSize,next_hop_protocol:t.nextHopProtocol,did_prefetch:e.prefetchCache.isEnabled},a={dns_lookup:{startTime:t.domainLookupStart,endTime:t.domainLookupEnd},connection_establish:{startTime:t.connectStart,endTime:t.connectEnd},request_queued:{startTime:t.connectEnd,endTime:t.requestStart},response_wait:{startTime:t.requestStart,endTime:t.responseStart},response_download:{startTime:t.responseStart,endTime:t.responseEnd}};De.default.measure({metricName:"load_cached_page_chunk.fetch",startTime:t.fetchStart,endTime:t.responseEnd},{environment:e,data:{...n,sub_metrics:{dns_lookup:a.dns_lookup.endTime-a.dns_lookup.startTime,connection_establish:a.connection_establish.endTime-a.connection_establish.startTime,request_queued:a.request_queued.endTime-a.request_queued.startTime,response_wait:a.response_wait.endTime-a.response_wait.startTime,response_download:a.response_download.endTime-a.response_download.startTime}}});for(const[r,{startTime:o,endTime:i}]of Object.entries(a))De.default.measure({metricName:`load_cached_page_chunk.fetch.${r}`,startTime:o,endTime:i},{environment:e,data:n})}),[e]);(0,a.useEffect)((()=>{const e=new PerformanceObserver((n=>{const a=n.getEntries().find((e=>e.name.includes(`${M.default.api.http}/${We}`)&&!e.name.endsWith("s")));a&&("resource"===a.entryType&&t(a),null==e||e.disconnect())}));return e.observe({type:"resource",buffered:!0}),()=>{e.disconnect()}}),[t])}(),function(){const e=(0,r.O7)();(0,a.useEffect)((()=>{const t=()=>je.updateConnectionState(e);return t(),m.Z.addListener(t),()=>{m.Z.removeListener(t)}}),[e])}(),function(){const e=(0,r.O7)(),t=(0,a.useRef)("none"),n=(0,a.useCallback)((e=>{const n=t.current;e!==n&&(t.current=e,"dragging"===e?qe.Z.setState({isDragging:!0}):"dragging"===n&&qe.Z.setState({isDragging:!1}))}),[]),o=(0,a.useCallback)((()=>{"none"===t.current&&n("touching")}),[n]),i=(0,a.useCallback)((()=>{n("none")}),[n]),s=(0,a.useCallback)((()=>{"touching"===t.current&&Fe.isExpanded(Fe.get())&&n("dragging")}),[n]);(0,a.useEffect)((()=>{if(e.device.isIOS)return window.addEventListener("touchstart",o),window.addEventListener("touchend",i),window.addEventListener("touchcancel",i),document.addEventListener("selectionchange",s),()=>{window.removeEventListener("touchstart",o),window.removeEventListener("touchend",i),window.removeEventListener("touchcancel",i),document.removeEventListener("selectionchange",s)}}),[e.device.isIOS,o,i,s]);const c=(0,a.useCallback)((()=>{Ae.default.afterNextFlush((()=>{Be.ls()}))}),[]),d=(0,a.useCallback)((()=>{setTimeout((()=>{Fe.get()||Be.ZH({debug:{userAction:"useSelectionListener.handleFocusOut"},environment:e})}),0)}),[e]);(0,a.useEffect)((()=>(window.addEventListener("mousedown",c),e.device.isMobileBrowser&&document.addEventListener("focusout",d),()=>{window.removeEventListener("mousedown",c),document.removeEventListener("focusout",d)})),[e,c,d])}(),function(){const e=(0,r.O7)(),t=(0,r.Fy)(),n=(0,a.useRef)(!1),o=(0,a.useCallback)((()=>{"system"===b.VZ(e)&&g.Z.emit()}),[e]),i=(0,h.VK)((()=>{var e;return null===(e=c.default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.isReady()}),[]);(0,a.useLayoutEffect)((()=>{!n.current&&i&&(o(),n.current=!0)}),[i,o]),(0,a.useEffect)((()=>{if(t.isAndroid&&e.mobileNative)e.mobileNative.updateReceiveApiHandlers({themeChanged:e=>o()});else{if(He.addEventListener&&He.removeEventListener)return He.addEventListener("change",o),()=>{He.removeEventListener("change",o)};if(He.addListener&&He.removeListener)return He.addListener(o),()=>{He.removeListener(o)}}}),[t.isAndroid,e,o])}(),function(){const e=M.default.isLocalhost||!1;(0,a.useEffect)((()=>{function t(t){if(!e)return;if(!t.data||"string"!=typeof t.data.type)return;const n=t.data.type;"webpackInvalid"===n?Ge.oV({label:(0,D.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,D.jsx)("span",{style:{paddingRight:10},children:"Webpack Compiling"}),(0,D.jsx)("img",{src:"/images/favicon-local.ico",className:"loading-spinner",style:{display:"inline-block"}})]}),position:"top",durationMs:"keep"}):"webpackOk"!==n&&"webpackWarnings"!==n||Ge.rN()}return window.addEventListener("message",t),()=>{window.removeEventListener("message",t)}}),[e])}(),(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(nn,{}),e.isElectron&&(0,D.jsx)(pn,{}),(0,D.jsx)(o.WK,{})]})}function pn(){return function(){const e=(0,r.O7)(),t=(0,h.VK)((()=>({observedWidth:ve.sidebarSizeObserver.rect.state.width,targetWidth:ve.sidebarWidthStore.state,isExpanded:ve.sidebarExpandedStore.state,resizing:ve.sidebarResizingStore.state,isMouseEntered:ve.sidebarMouseEnteredStore.state})),[]),n=e.currentUser.isLoggedIn(),o=(0,E.formatVersion)(L.getDesktopVersion()),[i,d]=(0,a.useState)(!1);(0,a.useEffect)((()=>{i&&L.windowSidebarState.set({isLoggedIn:n,...t})}),[t,n,i]);const l=(0,h.VK)((()=>pe.ZP.getState().enabled),[]);(0,a.useEffect)((()=>{L.setIsMediaActive(l)}),[l]),(0,a.useEffect)((()=>{let e;e=n?t.isExpanded?"expanded":"collapsed":"disabled",L.sidebarState.set(e)}),[t.isExpanded,n]);const u=(0,h.VK)((()=>{var e,t,n;return{currentUserId:null===(e=c.default.state.currentUserStore)||void 0===e?void 0:e.id,currentSpaceId:null===(t=c.default.state.currentSpaceStore)||void 0===t?void 0:t.getSpaceId(),currentPageId:null===(n=c.default.state.mainEditorCurrentBlockStore)||void 0===n?void 0:n.id}}),[]);(0,a.useEffect)((()=>{L.setAppStoreState(u)}),[u]);const m=(0,a.useCallback)(((t,n,a)=>{s.K4(e,n,a)}),[e]);(0,a.useEffect)((()=>(L.track.addListener(m),()=>{L.track.removeListener(m)})),[m]);const v=(0,a.useCallback)(((e,t)=>{d(t)}),[]);(0,a.useEffect)((()=>(L.isActiveTab.get().then((e=>{d(e)})),L.isActiveTab.addListener(v),()=>{L.isActiveTab.removeListener(v)})),[v]);const f=(0,a.useCallback)(((e,t)=>{void 0===t.isShowingTabBar&&(t.isShowingTabBar=!0),fe.Z.setState(t)}),[]);(0,a.useEffect)((()=>{var e;return null===(e=L.electronAppFeatures.get())||void 0===e||e.then((e=>{fe.Z.setState(e)})),L.electronAppFeatures.addListener(f),()=>{L.electronAppFeatures.removeListener(f)}}),[f]);const S=(0,a.useCallback)(((e,t)=>{Se.Z.setState({tabs:t})}),[]);(0,a.useEffect)((()=>(L.electronTabs.addListener(S),()=>{L.electronTabs.removeListener(S)})),[S]);const b=(0,a.useCallback)((n=>{me.setExpand({environment:e,isExpanded:!t.isExpanded,from:"electron_listener"})}),[e,t.isExpanded]);(0,a.useEffect)((()=>(L.sidebarState.addToggleListener(b),()=>{L.sidebarState.removeToggleListener(b)})),[b]);const g=(0,a.useCallback)(((e,t)=>{t?me.open({fromElectron:!0}):me.close()}),[]);(0,a.useEffect)((()=>(L.sidebarState.addSetSidebarOpenListener(g),()=>{L.sidebarState.removeSetSidebarOpenListener(g)})),[g]);const _=(0,a.useCallback)(((e,t)=>{ve.sidebarExpandedStore.setState(t.isExpanded),ve.sidebarWidthStore.setState(t.targetWidth)}),[]);(0,a.useEffect)((()=>(L.windowSidebarState.addListener(_),()=>{L.windowSidebarState.removeListener(_)})),[_]),(0,a.useEffect)((()=>{!async function(){if(void 0===o)return;const t=await p.isDesktopVersionCompatible(e,{desktopVersion:o});"success"!==t.type||t.data.compatible||window.location.replace(M.default.domainBaseUrl+t.data.redirect)}()}),[o,e])}(),null}},970515:(e,t,n)=>{n.d(t,{Q:()=>o});var a=n(401898),r=n(453365);function o(e){var t;const{environment:n,assistantFeatureGateStore:o,currentSpaceViewStore:i,currentSpaceStore:s}=e;if(!i||!s)return!1;const c=(null==s?void 0:s.canAdmin())??!1,d=(0,r.$_)(n,s.id),l=Boolean(null===(t=i.getSettings())||void 0===t?void 0:t.has_user_seen_leap_modal);return o.isWorkspaceLeapEligible()&&c&&!d&&!(0,a.$K)(s.getSettings().enable_ai_training)&&!l}},954690:(e,t,n)=>{n.d(t,{$:()=>m});var a=n(647425),r=n(454642),o=n(970515),i=n(215010),s=n(548779),c=n(319385),d=n(88893);const l=4;function u(e){const{requiredStores:{currentUserSettingsStore:t},minAccountAgeInDays:n,announcementDateInMs:a}=e,r=t.getSettings(),o=null==r?void 0:r.signup_time,s=function(e){const{currentUserSettingsStore:t,minAccountAgeInDays:n=l}=e,a=(0,i.e2)(t);return!(Number(a)>=n)}({currentUserSettingsStore:t,minAccountAgeInDays:n});return void 0!==r&&!s&&!(a&&o&&o>a)}function p(e){return"unsubscribed_admin"===e.state.type||"unsubscribed_member"===e.state.type}const m={dummy_modal:async(e,t)=>{var n;const{currentUserSettingsStore:a}=t;return Promise.resolve(!e.device.isMobile&&!e.device.isElectron&&c.default.checkGate({gateName:"can_see_callout_modal_test"})&&u({requiredStores:t})&&!(null!==(n=a.getSettings())&&void 0!==n&&n.seen_dummy_modal))},ai_slack_universal_qna_announcement:async(e,t)=>{const{currentSpaceStore:n,currentSpaceViewStore:o,mainEditorCurrentBlockStore:i,assistantFeatureGateStore:c}=t;if(e.device.isMobile)return!1;const d=o.getSettings();if(void 0===d||void 0!==d.slack_universal_qna_announcement_seen_at)return!1;const l=(n.getMemberCountFromPublicSpaceData()??1)>1;if(!(i.canRead()&&n.canAdmin()&&(0,s.j9)(n)&&(0,a.Mk)(n.getSubscriptionTier())&&l))return!1;if(!u({requiredStores:t,minAccountAgeInDays:8}))return!1;if(!c.canSeeSlackUniversalQnaAnnouncementModal()||!c.isAiEnabled())return!1;try{const t=await r.getConnectedAppsForUniversalQna(e,{spaceId:n.getSpaceId()});return"success"===t.type&&!t.data.connectedApps.includes("slack-admin")}catch{return!1}},ai_assistant_announcement:async(e,t)=>{const{currentUserSettingsStore:n,mainEditorCurrentBlockStore:a,assistantFeatureGateStore:r,currentSpaceStore:i,currentSpaceViewStore:s}=t,c=n.getSettings();if(!c)return!1;if(e.device.isMobile)return!1;const d=void 0!==(null==c?void 0:c.ai_assistant_onboarding_phase),l=Boolean(i.getSettings().enable_ai_training),p=(0,o.Q)({environment:e,assistantFeatureGateStore:r,currentSpaceStore:i,currentSpaceViewStore:s}),m=!d||p&&!l;return Promise.resolve(a.canRead()&&u({requiredStores:t,minAccountAgeInDays:8})&&m&&r.canSeeAssistantFeaturePromotionalModal())},charts_launch_modal:async(e,t)=>{const{currentUserSettingsStore:n,mainEditorCurrentBlockStore:a,experimentStore:r,currentSpaceStore:o}=t,i=n.getSettings();return Promise.resolve(!e.device.isMobile&&n.isReady()&&a.canRead()&&(0,s.j9)(o)&&void 0!==i&&u({requiredStores:t})&&void 0===i.charts_launch_modal_phase&&r.checkGate({gateName:"charts_mvp"})&&r.checkGate({gateName:"charts_beta_launch_modal"}))},sidebar_upgrade_nudge:async(e,t)=>{const{currentUserSettingsStore:n,subscriptionDataStore:a,currentSpaceStore:r}=t,o=n.getSettings();return Promise.resolve(!e.device.isMobile&&!(null!=o&&o.dismissed_sidebar_upgrade_nudge)&&p(a)&&1===d.su(a.state)&&!(0,s.Q9)(r))},persistent_upgrade_nudge:async(e,t)=>{const{subscriptionDataStore:n,experimentStore:a}=t,r="on"===a.getEligibleGroup({experimentId:"money_corner",defaultGroup:"control"});return Promise.resolve(p(n)&&r)},sites_launch_modal:async(e,t)=>Promise.resolve(!1),notion_calendar_launch_promo:(e,t)=>Promise.resolve(!1),ai_qna_alpha:(e,t)=>Promise.resolve(!1),startup_sidebar_footer:(e,t)=>Promise.resolve(!1)}},706210:(e,t,n)=>{n.d(t,{Ev:()=>s,YF:()=>c,bl:()=>i,gF:()=>r,lZ:()=>o});var a=n(730459);function r(e,t){a.K4(e,"callout_show",t)}function o(e,t){a.K4(e,"callout_click",t)}function i(e,t){a.K4(e,"callout_dismiss",t)}function s(e,t){a.K4(e,"callout_engagement",t)}function c(e,t){const{eligible_callouts:n}=t,r=Object.values(n).flatMap((e=>Array.from(e)));a.K4(e,"callout_coordinator_resolved",{eligible_callouts:r})}},698938:(e,t,n)=>{n.d(t,{Z:()=>H});var a=n(667294),r=n(800480),o=n(886628),i=n(724405),s=n(841892),c=n(415095),d=n(643593),l=n(517755),u=n(842875),p=n(379362),m=n(522808),v=n(882883),f=n(709291),S=n(653965),b=n(218265),g=n(247839),h=n(608055),_=n(95477),w=n(360682),C=n(924990),O=n(119037),T=n(304708),y=n(542129),N=n(296994);const E=32;const U=32;async function k(e){const t=document.createElement("canvas");t.width=U,t.height=U;const n=t.getContext("2d"),a=document.createElement("img");return a.src=e,new Promise((e=>{a.onload=()=>{n.drawImage(a,0,0,U,U),e(t.toDataURL("image/png"))},a.onerror=()=>{e("")}}))}var I=n(484210),A=n(583055),L=n(433929),M=n(367669),V=n(394841),P=n(819034),Z=n(70853),R=n(356437),x=n(80444),D=n(780641),B=n(453730),F=n(141737);const q=(0,f.defineMessages)({notionAiDocTitle:{id:"documentTitleListener.notionAi.title",defaultMessage:"Notion AI"}});const H=function(){const e=(0,r.O7)(),t=(0,f.useIntl)(),n=(0,i.Fg)(),U=(0,a.useRef)(),H=(0,o.SI)((()=>{const{RouterStore:n,device:a}=e,r=n.state.route;if("chat"===r.name)return{assetPath:s.Z.images.assistantStaticFaceFaviconPng,title:t.formatMessage(q.notionAiDocTitle)};if("marketplace"===r.name)return{assetPath:s.Z.images.templates.faviconIco};if("settingsConsoleOrganization"===r.name)return{title:"Organization settings"};const o=x.default.state.mainEditorCurrentBlockStore;if(!o||!o.isReady())return;const i="page"===r.name&&r.blockId===o.id,d=o.getSpaceStore()??x.default.state.currentSpaceStore;let l=!1;if("space"===r.name&&r.requestedOnPublicDomain)if(T.Pr()){const e=Z.rl(d,o.id);l=(null==e?void 0:e.getDomainName())===r.spaceDomain}else l=(null==d?void 0:d.getPublicHomePage())===o.id;if(!i&&!l)return;const p=P.Z.getTotalUnreadMentionsCount(),m=o.getTitleStore();let f;const S=o.getModel(),b=o.getCollectionViewIds(),g=null==m?void 0:m.getRecordModel(m.pointer);if(m&&g){if(f=(0,v.X)({intl:L.default.getIntl(),textValue:m.getValue(),userTimeZone:(0,u.r)(),getRecordModel:o.getRecordModel})||g.getEmptyTitlePlaceholder({getRecordModel:m.getRecordModel,userTimeZone:(0,u.r)(),intl:t}),"block"===m.table&&(0,V.WE)(o)&&d){f=`${d.getName()} - ${t.formatMessage({id:"DocumentTitleListener.personalHomeLabel",defaultMessage:"Home"})}`}if("collection"===m.table&&S&&S.isCollectionView()&&b.length>1){const e=x.default.state.currentCollectionViewStore;e&&e.getName()&&(f=`${f} | ${e.getName()}`)}a.isElectron||(f=(0,c.db)(f.slice(0,100),C.Z.state)),M.IJ(e,o)||e.device.isElectron||e.device.isMobileNative||(p>9?f=`(9+) ${f}`:p>0&&(f=`(${p}) ${f}`))}let h;null!=d&&d.getPublicSpaceData()&&(h="page"===r.name?(0,I.ZP)({store:o,fullyQualified:!1,scrollToBlockId:null==r?void 0:r.scrollToBlockId,peekViewBlockId:r.peekViewBlockId,peekMode:r.peekMode,collectionViewId:r.collectionViewId,discussionId:r.discussionId,showMoveTo:r.showMoveTo,saveParent:r.saveParent,templateGalleryItem:r.templateGalleryItem,projectManagementLaunch:r.projectManagementLaunch,pageVisitSource:void 0}):(0,I.ZP)({store:o,fullyQualified:!1,pageVisitSource:void 0}));const _=null==S?void 0:S.isNonverifiedContentClassification(),w=_&&S&&D.Z.bypassedPage(o.id),y=(0,O.Iay)(),N=function(e,t,n){if(!T.Pr()||"space"!==e.name&&"page"!==e.name||!e.requestedOnPublicDomain||!t)return n.getIcon();{const e=R.gR(n);if(null==e||!e.getSiteId())return n.getIcon();const t=null==e?void 0:e.getSiteStore();if(e&&t&&t.isDefined()){const a=t.getFaviconUrl();return a?{pointer:e.pointer,icon:a}:n.getIcon()}}}(r,d,o);return{title:f,url:h,icon:N,isNonverified:_,hasBypassedContentClassification:w,isMemberOfSpace:y}}),[e,t]);return(0,o.Kw)(H),(0,a.useEffect)((()=>{const a=S.Ds((function(){const{device:a}=e,r=H.state;if(!r)return;const{url:o,title:i,icon:u}=r;let v,f,S,C;u&&(0,p.V2)(u.icon)?S=u.icon:u&&(0,m.Z)(u.icon)?v=u.icon:u&&d.F8(u.icon)?f=u:r.assetPath&&d.LF(r.assetPath)&&(C=r.assetPath);const O=r.isNonverified&&!r.hasBypassedContentClassification&&!r.isMemberOfSpace;i&&document.title!==i&&(O?document.title=t.formatMessage({id:"pageTitle.flaggedContent",defaultMessage:"Flagged Content"}):a.isSafari&&v?document.title=`${v} ${i}`:document.title=i),o&&b.T1(o)!==b.T1(window.location.href)&&(window.history.replaceState(window.history.state,void 0,o),h.j7({environment:e,url:window.location.href}));const T=document.querySelector("link[rel='shortcut icon']");if(T){const t=s.Z.images.faviconIco;if(O)T.href=t,U.current=t;else if(v)v!==U.current&&(U.current=v,async function(e,t){const n=document.createElement("canvas");n.width=E,n.height=E;const a=n.getContext("2d");if(a.font="normal normal normal 32px/32px sans",a.textAlign="center",a.textBaseline="middle","raw"===t)return a.fillText(e,n.width/2,n.height/2+4),n;const r=await N.FF.emojiData.load(),o=(0,y.y)(e,r);if(!o)return;const i=document.createElement("img");i.src=(0,c.bk)(t);const s=(0,c.G0)(o);return new Promise((e=>{i.onload=()=>{a.drawImage(i,s.x,s.y,s.size,s.size,0,0,E,E),e(n)},i.onerror=()=>{e(void 0)}}))}(v,(0,w.e_)(e)).then((async e=>{await A.waitForInitialPageRenderToComplete(),await F.Z.waitUntil((()=>!F.Z.state.isMeasuring)),T.href=(null==e?void 0:e.toDataURL("image/png"))||""})));else if(S){if(S!==U.current){U.current=S;const e=`${S}?mode=${n.mode}`;a.isFirefox?T.href=e:k(e).then((e=>{T.href=e}))}}else if(f){const{icon:t,...n}=f,a=l.EK({url:t,width:100,permissionRecord:n.pointer,baseUrl:_.default.domainBaseUrl,fullyQualified:!1,userId:e.currentUser.id});a!==U.current&&(U.current=a,B.transactionQueue.awaitRecordTransaction(n.pointer).then((()=>k(a))).then((e=>{T.href=e})))}else if(C){const t=l.Q4({url:C,width:100,baseUrl:_.default.domainBaseUrl,fullyQualified:!1,userId:e.currentUser.id});t!==U.current&&(U.current=t,k(t).then((e=>{T.href=e})))}else t!==U.current&&(T.href=t,U.current=t)}g.electronApi&&g.electronApi.setWindowTitle&&i&&g.electronApi.setWindowTitle(i)}),500,{leading:!0}),r=document.title;return H.state&&a(),H.addListener(a),()=>{H.removeListener(a),document.title=r}}),[e,t,H,n.mode]),null}},110854:(e,t,n)=>{n.d(t,{Tm:()=>S,mK:()=>b,p9:()=>f});var a=n(89101),r=n(554153),o=n(211342),i=n(436610),s=n(102449),c=n(135253),d=n(547307),l=n(247839),u=n(412714),p=n(95477),m=n(44819),v=n(421051);const f=!1,S="electronUpdateReady2";function b(e){const{AppUpdateStore:t,device:n}=e;if(i.By(e),f){const t=(0,m.Us)(a._j.releases);u.D({environment:e,url:t})}if(n.isElectron&&t.state.electronUpdate&&"ready"===t.state.electronUpdate.state){const e=l.getDesktopVersion();r.Z.set(S,(0,o.formatVersion)(e)),l.installElectronUpdate()}else t.state.appUpdate&&"ready"===t.state.appUpdate.state?(s.hC({environment:e,url:window.location.href,version:t.state.appUpdate.version}),d.dismissDialog(),c.Js({bannerStore:v.Z})):(s.D$((0,o.parseVersion)(p.default.version)),d.dismissDialog(),c.Js({bannerStore:v.Z}))}},44819:(e,t,n)=>{n.d(t,{Us:()=>o,XR:()=>i});var a=n(313991),r=n(813559);n(653965),n(95477);Boolean("en-US"===a.SP);function o(e){const t="https://www.notion.so";return"en-US"!==a.SP?`${t}/${a.SP.toLocaleLowerCase()}${e}`:`${t}${e}`}function i(e,t){if(e.device.isElectron||e.device.isMobileNative)return!1;const n=(0,r.XU)(t,e.currentUser.isLoggedIn());return!!n&&"devOnly"!==n}},279827:(e,t,n)=>{n.r(t),n.d(t,{CalloutGroupStore:()=>o,default:()=>s});var a=n(749085),r=n(79571);class o extends a.default{getInitialState(){return new Set}add(e){this.setState(new Set(this.state).add(e))}delete(e){const t=new Set(this.state);t.delete(e),this.setState(t)}has(e){return this.state.has(e)}clear(){this.setState(new Set)}}class i extends a.default{getInitialState(){return{placementStores:{Modal:new o,SidebarFooter:new o},forcedCalloutsStore:new o}}getCalloutVisibility(e){const t=(0,r.QN)(e);return{isEligible:this.state.placementStores[t].has(e),isForced:this.state.forcedCalloutsStore.has(e)}}isForced(e){return this.state.forcedCalloutsStore.has(e)}getCalloutsForPlacement(e){return Array.from(this.state.placementStores[e].state)}}const s=new i},853610:(e,t,n)=>{n.d(t,{Z:()=>a});const a=new(n(61766).Z)},866881:(e,t,n)=>{n.d(t,{g:()=>a});const a=n(749085).default.createValue({shouldReset:!1},{name:"MobileAssistantMenuStore"})},449682:(e,t,n)=>{n.d(t,{Z:()=>a});const a=new(n(61766).Z)},79571:(e,t,n)=>{n.d(t,{xg:()=>p,$Q:()=>m,$Z:()=>l,rx:()=>u,Y6:()=>f,QN:()=>S,Yy:()=>b,$e:()=>v,nK:()=>c});var a=n(730120);function r(e,t,n){return a.ou.utc(e,t,n).toMillis()}const o=r(1970,1,1),i=r(2038,1,17),s=[{name:"ai_qna_alpha",placement:"Modal",start:r(2024,3,31),end:r(2025,6,15)},{name:"ai_slack_universal_qna_announcement",placement:"Modal",migrated:!0,start:r(2024,6,18),end:r(2025,6,18)},{name:"ai_assistant_announcement",placement:"Modal",migrated:!0,start:r(2024,6,18),end:r(2025,6,18)},{name:"dummy_modal",placement:"Modal",migrated:!0,start:o,end:i},{name:"notion_calendar_launch_promo",placement:"Modal",start:r(2024,2,1),end:r(2025,6,15)},{name:"charts_launch_modal",placement:"Modal",start:r(2024,6,17),end:r(2025,6,17)},{name:"sites_launch_modal",placement:"Modal",start:a.ou.fromISO("June 25 2024").toMillis(),end:a.ou.fromISO("June 25 2025").toMillis()},{name:"persistent_upgrade_nudge",placement:"SidebarFooter",migrated:!0,start:o,end:i},{name:"sidebar_upgrade_nudge",placement:"SidebarFooter",migrated:!0,start:o,end:i},{name:"startup_sidebar_footer",placement:"SidebarFooter",start:o,end:i}],c=["Modal","SidebarFooter"],d=s,l=d.map((e=>e.name)),u=d.filter((e=>!!e.migrated)).map((e=>e.name)),p=d.reduce(((e,t)=>({...e,[t.name]:t})),{}),m={globalConstraint:{frequencyCap:{maxCountInWindow:Number.POSITIVE_INFINITY,window:"week"}},placementConstraints:{Modal:{conflictsWith:[],maxConcurrent:1,frequencyCap:{maxCountInWindow:Number.POSITIVE_INFINITY,window:"week"}},SidebarFooter:{conflictsWith:[],maxConcurrent:1,frequencyCap:{maxCountInWindow:Number.POSITIVE_INFINITY,window:"week"}}}};function v(){return{Modal:new Set,SidebarFooter:new Set}}function f(){return{Modal:[],SidebarFooter:[]}}function S(e){return p[e].placement}function b(e){const t=l.indexOf(e);return-1===t?Number.POSITIVE_INFINITY:t}}}]);