"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[84654],{763594:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n(749085).default.createValue(!0,{name:"IsAiEligibleStore"})},484654:(e,t,n)=>{n.r(t),n.d(t,{COMPLETION_THROTTLE:()=>ce,acceptCursorCompletion:()=>_e,cancelCompletion:()=>De,doesPromptNeedAdditionalUserInput:()=>ye,handleCompletionPopupRetry:()=>ve,improveAssistantCompletion:()=>Me,improveCompletion:()=>Pe,insertBlockSelectionCompletion:()=>Oe,insertTextSelectionCompletion:()=>Re,maybeSetPromptForCurrentAiBlock:()=>Xe,openCompletionPopupForBlockSelectionContext:()=>ue,openCompletionPopupForCursorContext:()=>pe,openCompletionPopupForPrefilledContext:()=>fe,openCompletionPopupForSavedContext:()=>me,postProcessAICreatedStores:()=>Be,redoCompletionRevision:()=>Ue,replaceTextSelectionCompletion:()=>Le,revertCurrentCompletionRevision:()=>Ne,selectPageAndOpenCompletionPopupForBlockSelectionContext:()=>de,showCompletionErrorWithCode:()=>Ce,stopCompletion:()=>We,submitFeedbackForRevision:()=>Ke,triggerCompletionForAiBlock:()=>Ae,updateAiEligibility:()=>He,wrapTemporaryBlocksInList:()=>Ge});n(21703),n(757658),n(430541);var o=n(126263),i=n(701302),r=n(541432),a=n(568626),s=n(842875),c=n(471924),l=n(300482),p=n(29299),d=n(882883),u=n(421202),m=n(803791),f=n(76233),g=n(95371),y=n(598151),v=n(653965),h=n(401898),S=n(10910),k=n(454642),C=n(800893),w=n(547307),x=n(594419),I=n(709953),P=n(524677),M=n(164964),b=n(137231),A=n(898104),T=n(429373),_=n(210228),F=n(296994),R=n(956518),L=n(778663),B=n(599417),O=n(896318),W=n(743455),E=n(741195),U=n(433929),N=n(745162),D=n(367669),Z=n(165598),V=n(177546),z=n(669645),$=n(273959),Y=n(389224),j=n(489086),H=n(95802),K=n(80444),X=n(521273),G=n(798180),q=n(316772),Q=n(319385),J=n(206258),ee=n(27724),te=n(44041),ne=n(535057),oe=n(428956),ie=n(492022),re=n(271184),ae=n(763594),se=n(630793);const ce=300,le=1001;async function pe(e){const{environment:t,prompt:n=B.NX,additionalContext:o,from:i}=e,r=(0,L.FD)();r&&await ge({environment:t,prompt:n,context:r,additionalContext:o,from:i})}async function de(e){const t=P.aw(P.KX()),n=(0,N.W9)(t);if(!n)return;A.NA({multiSelection:n});const o=(0,L.Fu)();if(!o)return;const i={type:"closedWithContext",context:o,futureRevisions:[]};q.default.setState(i),await me(e)}async function ue(e){const{environment:t,prompt:n=B.NX,additionalContext:o,from:i}=e,r=(0,L.Xc)();r&&await ge({environment:t,prompt:n,context:r,additionalContext:o,from:i})}async function me(e){"closedWithContext"===q.default.state.type&&q.default.state.context&&await ge({...e,context:q.default.state.context})}async function fe(e){await ge(e)}async function ge(e){const{environment:t,prompt:r,context:a,additionalContext:s,skipInitialForm:l,from:p}=e,d=q.default.getExistingAISessionId(),u=d??c.Il();if(ye({clientPrompt:r,additionalContext:s})&&!l)return void(0,ie.toggleInitialPrompt)({environment:t,from:p,prefilledValue:(0,L.$W)(r),promptForAnalytics:r,sessionId:u,context:a});if(!Boolean(d)){const e=G.default.getSessionContext(u);S.Tl(t,{session_id:u,prompt_key:r.key,from:p,sessionContext:e})}A.ZH({debug:{userAction:"completionActions.openCompletionPopupWithContext"},environment:t});if(X.Z.isAssistantInWriterEnabled()){const{assistantWriterDependency:e}=await Promise.resolve().then(n.bind(n,852286)),{assistantWriterActions:o}=await e.load();o.triggerAssistantCompletion({environment:t,context:a,prompt:r,intl:U.default.getIntl(),updater:q.default.createUpdater(),additionalContext:s,sessionId:u,from:p})}else await async function(e){const{environment:t,context:n,prompt:r,additionalContext:a,updater:s,sessionId:c,from:l}=e;"textSelection"===n.type&&s((()=>{A.ZH({debug:{userAction:"completionActions.triggerCompletion"},environment:t}),P.ZH({debug:{userAction:"completionActions.triggerCompletion"},environment:t})}));const p=await F.FF.markdownLinkifyIt.load(),{serverPrompt:d}=he({...e,markdownLinkifyIt:p}),u=new o.Z({name:"completionActions.triggerCompletion",isTemporaryData:!0});s((()=>{t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(u)}));const m=q.default.state,f="completionPopup"===m.type&&"initialPrompt"===m.stage||"closedWithContext"===m.type?m.futureRevisions:[],g={type:"completionPopup",stage:"results",loading:!0,aiSessionId:c,revisions:[...f,{type:"initial",clientPrompt:r,serverPrompt:d,additionalContext:a,userSearchCache:new Map,completion:void 0,hasFeedback:!1}],futureRevisions:[],context:n,inMemoryRecordCache:u,from:l,hasErrored:!1};s((()=>{q.default.setState(g)})),await i.default.afterNextFlush(),await s((()=>Te({environment:t}))),await Se({...e,updater:s})}({environment:t,context:a,prompt:r,intl:U.default.getIntl(),updater:q.default.createUpdater(),additionalContext:s,sessionId:u,from:p})}function ye(e){const{clientPrompt:t,additionalContext:n}=e,o="translate"===t.key&&n&&n.language,i="changeTone"===t.key&&n&&n.tone;return Boolean(!o&&!i&&t.steps)}async function ve(e){const{environment:t}=e,n=q.default.state;if("completionPopup"===n.type&&"results"===n.stage)if(A.ZH({debug:{userAction:"completionActions.handleCompletionPopupRetry"},environment:t}),ye((0,B.Iz)(n)));else{const e=(0,B.Iz)(n);q.default.setState({...n,revisions:[...n.revisions,{type:"initial",clientPrompt:e.clientPrompt,serverPrompt:e.serverPrompt,additionalContext:e.additionalContext,userSearchCache:new Map,completion:void 0,hasFeedback:!1}]}),await Se({environment:t,updater:q.default.createUpdater()})}}function he(e){const{environment:t,context:n,prompt:o,additionalContext:i,intl:r,markdownLinkifyIt:a}=e,c=(0,d.X)({intl:r,textValue:n.currentPage.getBlockTitleStore().getValue(),getRecordModel:n.currentPage.getRecordModel,userTimeZone:(0,s.r)()}),{previousContent:l,restContent:p,pageContent:u}=function(e){var t,n;const{environment:o,context:i,markdownLinkifyIt:r}=e,a=i.currentPage.getContentStores()[0];let s,c;if("cursor"===i.type||"textSelection"===i.type)s=i.textSelection.start,c=i.textSelection.end;else{var l;s={store:i.stores[0].getBlockTitleStore(),index:0};const e=i.stores[i.stores.length-1].getBlockTitleStore();c={store:e,index:(null===(l=(0,j.x0)(e))||void 0===l?void 0:l.endIndex)||0}}const p=Ve(i.currentPage),d=C.wc({environment:o,textSelection:{start:{store:a.getBlockTitleStore(),index:0},end:c},markdownSerializationOptions:(0,W.KF)(),markdownLinkifyIt:r}),u=[p,d].filter(h.$K).join("\n\n"),m=(0,z.Bj)({includeNonSelectableListContainer:!1}),f=null===(t=(0,g.CY)(m).value)||void 0===t?void 0:t.store,y=null==f?void 0:f.getBlockTitleStore(),v=y&&C.wc({environment:o,textSelection:{start:s,end:{store:y,index:(null===(n=(0,j.x0)(y))||void 0===n?void 0:n.endIndex)||0}},markdownSerializationOptions:(0,W.KF)(),markdownLinkifyIt:r})||"",S=ze({environment:o,page:i.currentPage,markdownLinkifyIt:r})||"";return{previousContent:u,restContent:v,pageContent:S}}({environment:t,context:n,markdownLinkifyIt:a});let m,f;if("textSelection"===n.type||"blockSelection"===n.type){if("textSelection"===n.type)f=C.wc({environment:t,textSelection:n.textSelection,markdownSerializationOptions:(0,W.KF)(),markdownLinkifyIt:a})??"";else if("blockSelection"===n.type){const e=v.oA(ee.default.state.stores.map((e=>e.getValue())));f=(0,R.X4)({rootBlock:{...n.currentPage.pointer,spaceId:n.currentPage.getSpaceId()},blockValues:e,isWindows:t.device.isWindows,getRecordValue:n.currentPage.getRecordValue,markdownSerializationOptions:(0,W.KF)(),markdownLinkifyIt:a}).markdown||""}else(0,h.t1)(n);m=$e({prompt:o,selectedText:f,pageTitle:c,pageContent:u,additionalContext:i}),m||(m=je({prompt:o,pageTitle:c,previousContent:l,restContent:p,pageContent:u,additionalContext:i}))}else"cursor"===n.type?(m=je({prompt:o,pageTitle:c,previousContent:l,restContent:p,pageContent:u,additionalContext:i}),m||(m=$e({prompt:o,selectedText:u,pageTitle:c,additionalContext:i,pageContent:u}))):(0,h.t1)(n);if(!m)throw new Error(`Unable to find server prompt for "${o.key}" client prompt`);const y={type:"initial",pageTitle:c,selectedText:f,pageContent:u};return{serverPrompt:m.serverPrompt,initialStep:y,humanStep:m.humanStep}}async function Se(e){const{environment:t,updater:n}=e,o=q.default.state;if("completionPopup"!==o.type||"results"!==o.stage)return;const{aiSessionId:i}=o,r=Date.now(),a=c.Il(),s=(0,B.Iz)(o);if(o.revisions[o.revisions.length-1]!==s)throw new Error("Assertion failure, expected current revision to be initial revision");const l={...s,inferenceId:a},p=o.revisions.slice(0,o.revisions.length-1),{serverPrompt:d}=l;S.g_(t,{session_id:i,inference_id:a,from:o.from,prompt_key:l.clientPrompt.key,type:"completion"}),n((()=>{q.default.setState({...o,loading:!0,revisions:[...p,l]})}));let u=!1;const m=v.P2((async()=>{u||await n((()=>Te({environment:t,setSelection:!1})))}),ce),f=async function(e,t,n){if(!Q.default.checkGate({gateName:"ai_favorites"}))return;const{currentSpaceStore:o}=K.default.getState();if(!o)return;if(!t.trim())return;const i=await k.getCompletion(e,{id:c.Il(),aiSessionId:n,context:{type:"promptTitle",selectedText:t},model:"default",metadata:{},spaceId:o.id,isSpacePermission:!1});if("success"!==i.type)return;const r=[];if(y.H1.is(i.data))for await(const s of i.data){if("success"!==s.type)return;r.push(s.completion)}const a=r.join("").trim();return a||void 0}(t,(0,B.gY)(s),i),g=we({environment:t,inferenceId:a,aiSessionId:i,serverPrompt:d,targetStore:o.context.currentPage,inferenceReason:"writer",attribution:{blockId:o.context.currentPage.id},metadata:{blockId:o.context.currentPage.id},onUpdate(e){let{completion:t,userSearchCache:o}=e;n((()=>{const e=q.default.state;"completionPopup"===e.type&&"results"===e.stage&&(q.default.setState({...e,revisions:[...p,{...l,completion:t,userSearchCache:o}]}),m())}))}}),[h,C]=await Promise.all([f,g]);if("error_modal_shown"===C.type||"upsell_modal_shown"===C.type)return void n((()=>Ee()));u=!0;const{completion:w,userSearchCache:x}=C;await n((()=>{S.WP(t,{session_id:i,inference_id:a,preview_time:Date.now()-r,type:"completion"});const e=q.default.state;if("completionPopup"===e.type&&"results"===e.stage)return q.default.setState({...e,revisions:[...p,{...l,completion:w,userSearchCache:x,promptTitle:h}],loading:!1}),Te({environment:t,setSelection:!0})}))}function ke(e){const{environment:t,inMemoryRecordCache:n,completion:o,userSearchCache:i,store:r,prompt:a,additionalContext:s,isComplete:c,markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:u}=e;_.createAndCommit({userAction:"completionActions.updateAiBlockForCompletion",environment:t,perform:e=>{const m=r.clone(n);m.getContentIds().forEach((t=>{_.applyOperation({store:m,operation:(0,p.$j)({blockParentId:m.id,recordId:t}),transaction:e})}));const g=C.Mt({environment:t,text:o,inMemoryRecordCache:n,transaction:e,markdownOptions:(0,W.N9)(i),markdownLinkifyIt:d,tinyMceMicrosoftWordPasteFilter:u,useCrdt:m.useCrdt()});if(!g)return;const y=m.getContentStore();g.reverse().forEach((t=>{x.Ce({parentStore:y,prependStore:t,transaction:e}),I.sW({store:t,data:{parent_id:m.id,parent_table:m.table,alive:!0},transaction:e})})),_.applyOperation({store:m,operation:l.op.update({pointer:m.pointer,path:["format"],args:{ai_last_edited:Date.now(),ai_prompt_key:a.key}}),transaction:e});const v=s?(0,f.TPx)(s.prompt):[];b.sO({environment:t,store:m.getBlockTitleStore(),value:v,transaction:e}),c&&Ye({transaction:e,completionState:{clientPrompt:a,additionalContext:s}})}})}function Ce(e){const t=U.default.getIntl();return 451===e?M.oV({label:t.formatMessage({id:"completionActions.moderationError",defaultMessage:"AI does not allow content that is harmful or illegal. Please revise your input and try again. (451)"})}):502===e||503===e||504===e?M.oV({label:t.formatMessage({id:"completionActions.providerError",defaultMessage:"We’re experiencing issues with our AI provider. Try again in a few minutes. ({errorCode})"},{errorCode:e})}):void M.oV({label:t.formatMessage({id:"completionActions.genericError",defaultMessage:"AI is temporarily unavailable. Try again in a few minutes. ({errorCode})"},{errorCode:e})})}async function we(e){var t;const{environment:n,inferenceId:o,serverPrompt:i,targetStore:r,onUpdate:s,aiSessionId:c,metadata:l,attribution:p,inferenceReason:d}=e,u=O.mw()?O.SA:k.getCompletion,f=null===(t=K.default.state.currentSpaceStore)||void 0===t?void 0:t.id,g=(0,D.UK)(r);if(!f)return Ce(le),{type:"error_modal_shown"};const v=await u(n,{id:o,context:i,model:"default",spaceId:f,isSpacePermission:g,aiSessionId:c,metadata:l,attributionForLogging:p,inferenceReason:d});if("success"!==v.type)return w.showError(v),{type:"error_modal_shown"};let h="",C="";const x=new Map,I=await F.FF.searchActions.load(),P=e=>I.searchVisibleSpaceUsers({environment:n,query:e,membersOnly:!0});if(y.H1.is(v.data))for await(const a of v.data)if("success"===a.type)h+=a.completion,(0,W.Ie)(h)||(C=xe(h),await(0,W.$A)(h,P,x)),s({completion:C,userSearchCache:new Map(x)});else if("error"===a.type)return(0,m.lX)(a.errorCode)?(te.y(n,{from:"ai_limit_in_app",for:(0,ne.zt)(),addOnFeature:"ai"}),{type:"upsell_modal_shown"}):(Ce(a.errorCode),{type:"error_modal_shown"});const M=xe(h);return M?(await(0,W.$A)(M,P,x),{type:"success",completion:M,userSearchCache:new Map(x)}):(Ce(600),a.log({level:"error",from:"completionActions.getCompletionWithPostProcessing",type:"emptyResponse",data:{inferenceId:o}}),S.UD(n,{promptKey:i.type}),{type:"error_modal_shown"})}function xe(e){return e.replace(/<br>/g,"\n")}function Ie(e){const{improvement:t}=e;return"continueWriting"===t.type?{type:"human",prompt:"Continue writing"}:"makeLonger"===t.type?{type:"human",prompt:"Make longer"}:"helpMeEdit"===t.type?{type:"human",prompt:t.prompt}:void(0,h.t1)(t.type)}async function Pe(e,t){const n=q.default.state;if("completionPopup"!==n.type||"results"!==n.stage)return;let o=!1;const i=q.default.createUpdater(),r=(0,B.xM)(n);if(!r.completion)return;const a=n.context,s=r.completion,l="continueWriting"===t.type?s:"",p=Date.now(),d=c.Il();S.g_(e,{session_id:n.aiSessionId,inference_id:d,from:n.from,prompt_key:(0,B.Iz)(n).clientPrompt.key,improvement_prompt_type:t.type,type:"follow_up_improvement"});const u=[...n.revisions,...n.futureRevisions],m={type:"followup",improvement:t,completion:l,userSearchCache:new Map,inferenceId:d,hasFeedback:!1,previousRevision:(0,B.HS)(n)},f={...n,loading:!0,revisions:[...u,m],futureRevisions:[]},g=await F.FF.markdownLinkifyIt.load(),y=function(e){const{environment:t,completionState:n,markdownLinkifyIt:o}=e,{context:i}=n,r=[];for(const a of(0,B.zU)(n))if("initial"===a.type){const{initialStep:e,humanStep:n}=he({environment:t,context:i,prompt:a.clientPrompt,additionalContext:a.additionalContext,intl:U.default.getIntl(),markdownLinkifyIt:o});if(void 0===a.completion)throw new Error("Assertion failure, followup without initial completion");r.unshift(e,n,{type:"assistant",result:a.completion})}else if("followup"===a.type){const e=[Ie({improvement:a.improvement})];a.completion&&e.push({type:"assistant",result:a.completion}),r.unshift(...e)}else(0,h.t1)(a);O.mw()&&console.log("Transcript",JSON.stringify(r,null,2));return{type:"writerFollowup",transcript:r}}({environment:e,completionState:f,markdownLinkifyIt:g});i((()=>{q.default.setState(f)}));const k=v.P2((async()=>{o||await i((()=>Te({environment:e,setSelection:!1})))}),ce),C=await we({environment:e,inferenceId:d,serverPrompt:y,targetStore:a.currentPage,aiSessionId:n.aiSessionId,inferenceReason:"writer",attribution:{blockId:n.context.currentPage.id},metadata:{blockId:a.currentPage.id},onUpdate(e){let{completion:t,userSearchCache:n}=e;i((()=>{const e=q.default.state;"completionPopup"===e.type&&"results"===e.stage&&(q.default.setState({...e,revisions:[...u,{...m,completion:l+t,userSearchCache:n}]}),k())}))}});if("error_modal_shown"===C.type||"upsell_modal_shown"===C.type)return void i((()=>Ee()));o=!0;const{completion:w,userSearchCache:x}=C;i((()=>{S.WP(e,{session_id:f.aiSessionId,inference_id:d,preview_time:Date.now()-p,type:"follow_up_improvement"}),q.default.setState({...f,loading:!1,revisions:[...u,{...m,completion:l+w,userSearchCache:x}]}),Te({environment:e,setSelection:!0})}))}async function Me(e,t){const o=q.default.state;if("assistantCompletionPopup"!==o.type||"results"!==o.stage)return;const i=q.default.createUpdater();if("helpMeEdit"!==t.type)throw new Error("Improvements other than helpMeEdit are not supported");const{assistantDependency:r}=await Promise.resolve().then(n.bind(n,81598)),{assistantActions:a}=await r.load(),s=G.default.getActiveSessionId();if(!s)throw new Error("No active assistant session");await a.commitHumanStep({environment:e,text:(0,f.TPx)(t.prompt),sessionId:s,assistantSurfaceType:"writer"}),await i((()=>{const e=q.default.state;if("assistantCompletionPopup"!==e.type||"results"!==e.stage)return;const t=v.Z$(ee.default.state.stores);q.default.setState({...e,context:{...e.context,origin:t||e.context.origin},loading:!1})}))}const be=(0,h.AO)((e=>e instanceof J.G?{true:e}:{false:e}));async function Ae(e){const{environment:t,store:n,prompt:i,additionalContext:r}=e,a=n.getRecordStoreUIRoot();if(!be(a))return;const l=await F.FF.markdownLinkifyIt.load(),p=function(e){const{environment:t,rootStore:n,store:o,prompt:i,additionalContext:r,markdownLinkifyIt:a}=e,c=U.default.getIntl(),l=(0,d.X)({intl:c,textValue:n.getBlockTitleStore().getValue(),getRecordModel:n.getRecordModel,userTimeZone:(0,s.r)()}),p=ze({environment:t,page:n,markdownLinkifyIt:a})||"";if("summarizeMeetingTranscript"===i.key)return{type:"summarizeMeetingTranscript",pageTitle:l,pageContent:p};if("helpMeWrite"===i.key){var u,m,f,y,v;const e={type:"helpMeWrite",pageTitle:l,pageContent:p,prompt:(null==r?void 0:r.prompt)??""},i=(0,z.dq)({includeNonSelectableListContainer:!1,root:o.getHighestContentBlockUIAncestor()});if(!i)return e;const s=(0,z.v5)(o,i.children);if(!s)return e;const c=n.getContentStores()[0],d=(0,g.YL)(i,s),S=d.prev?d.prev.value.store.getBlockTitleStore():null===(u=d.parent)||void 0===u?void 0:u.value.store.getBlockTitleStore(),k=c&&S&&C.wc({environment:t,textSelection:{start:{store:c.getBlockTitleStore(),index:0},end:{store:S,index:(null===(m=(0,j.x0)(S))||void 0===m?void 0:m.endIndex)??0}},markdownSerializationOptions:(0,W.KF)(),markdownLinkifyIt:a})||"",w=[Ve(n),k].filter(h.$K).join("\n\n"),x=null===(f=(0,g.Xf)(i,s).next)||void 0===f?void 0:f.value.store.getBlockTitleStore(),I=null===(y=(0,g.CY)(i).value)||void 0===y?void 0:y.store,P=null==I?void 0:I.getBlockTitleStore();return{type:"helpMeWrite",pageTitle:l,previousContent:w,restContent:x&&P&&C.wc({environment:t,textSelection:{start:{store:x,index:0},end:{store:P,index:(null===(v=(0,j.x0)(P))||void 0===v?void 0:v.endIndex)||0}},markdownSerializationOptions:(0,W.KF)(),markdownLinkifyIt:a})||"",prompt:(null==r?void 0:r.prompt)??""}}return"summarize"===i.key||"findActionItems"===i.key?{type:i.key,pageTitle:l,selectedText:p}:void 0}({environment:t,rootStore:a,store:n,prompt:i,additionalContext:r,markdownLinkifyIt:l});if(!p)return;const u=v.P2(ke,ce),m=new o.Z({name:"completionActions.triggerCompletionForAiBlock",isTemporaryData:!0});t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(m);const f=await F.FF.tinyMceMicrosoftWordPasteFilter.load(),y=await we({environment:t,inferenceId:c.Il(),serverPrompt:p,targetStore:a,aiSessionId:c.Il(),metadata:{blockId:a.id},inferenceReason:"writer",attribution:{blockId:a.id},onUpdate(e){let{completion:o,userSearchCache:a}=e;u({inMemoryRecordCache:m,environment:t,store:n,completion:o,userSearchCache:a,prompt:i,additionalContext:r,isComplete:!1,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:f})}});if(t.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(m),"error_modal_shown"===y.type||"upsell_modal_shown"===y.type)return;const{completion:S,userSearchCache:k}=y;ke({environment:t,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,store:n,completion:S,userSearchCache:k,prompt:i,additionalContext:r,isComplete:!0,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:f})}async function Te(e){const{environment:t,setSelection:n}=e,o=q.default.state;if("completionPopup"!==o.type||"results"!==o.stage)return;const r=(0,B.xM)(o),{completion:a,userSearchCache:s}=r,{context:c,inMemoryRecordCache:l}=o;if("cursor"!==c.type)return;l.clearCache();const{currentBlock:p,currentParent:d,currentPage:u}=c,m=d||u.getContentStore(),{insertTitle:g,insertCompletion:y}=Fe({completion:a||"",currentPage:u});g&&_.createAndCommit({userAction:"completionActions.temporaryInsertion.insertTitle",environment:t,canUndo:!1,perform:e=>{const n=u.clone(l).getBlockTitleStore();n&&b.sO({environment:t,store:n,value:(0,f.TPx)(g),transaction:e})}});const[h,S]=await Promise.all([F.FF.markdownLinkifyIt.load(),F.FF.tinyMceMicrosoftWordPasteFilter.load()]);if(y){const e=_.createAndCommit({userAction:"completionActions.temporaryInsertion.insertCompletion",environment:t,canUndo:!1,perform:e=>{if(!y)return;const n=C.Mt({environment:t,text:y,inMemoryRecordCache:l,transaction:e,markdownOptions:(0,W.N9)(s),markdownLinkifyIt:h,tinyMceMicrosoftWordPasteFilter:S,useCrdt:(null==p?void 0:p.useCrdt())??m.getRecordStoreAtRootPath().useCrdt()});if(!n)return;Be(t,n);Ze({parentStore:m.clone(l),insertAfter:null==p?void 0:p.clone(l),insertStores:n,transaction:e});return n.map((e=>e.clone(t.defaultRecordCache.inMemoryRecordCache))).map((e=>e.cloneWithNewUIParent(m)))}}).performResult;if(!e||!e.length)return;n&&P.Z5({environment:t,stores:e}),await i.default.afterNextFlush();const o=q.default.state;if("completionPopup"!==o.type||"results"!==o.stage)return;const r=v.oA(e.map((e=>H.C.findNodeFromStore(e))));if(!(r[0]?(0,V.VW)(r[0]):void 0))return;q.default.setState({...o,context:{...o.context,origin:v.Z$(e)}})}else if(p){const e=(0,B.Ah)(p),i=new DOMRect(null==e?void 0:e.x,null==e?void 0:e.y,null==e?void 0:e.width,0);_.createAndCommit({userAction:"completionActions.temporaryInsertion.insertCompletionStores",environment:t,canUndo:!1,perform:e=>{Ze({parentStore:m.clone(l),insertAfter:p.clone(l),insertStores:[],transaction:e})}}),n&&P.ZH({debug:{userAction:"completionActions.updatePreviewForCursorCompletion"},environment:t}),p.getAlive()?q.default.setState({...o,context:{...c,origin:p}}):q.default.setState({...o,context:{...c,origin:i}})}}function _e(e){var t;const{environment:n,transaction:o,selectInsertion:a,exitType:s,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:p}=e,d=q.default.state;if(q.default.invalidateLastUpdater(),"completionPopup"!==d.type||"results"!==d.stage||"cursor"!==d.context.type)return;const{completion:u,userSearchCache:m,inferenceId:g}=(0,B.xM)(d);if(!u)return;const{currentBlock:y,currentParent:v,currentPage:h}=d.context,k=v||h.getContentStore();q.default.resetStore(e);const{insertTitle:w,insertCompletion:M}=Fe({completion:u,currentPage:h});w&&"convert_to_ai_block"!==s&&b.sO({environment:n,store:h.getBlockTitleStore(),value:(0,f.TPx)(w),transaction:o});const T=(null===(t=(0,$.sQ)(k))||void 0===t?void 0:t.useCrdt())??!1,F=C.Mt({environment:n,text:M,inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache,transaction:o,markdownOptions:(0,W.N9)(m),markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:p,useCrdt:T});if(F){if(y&&"convert_to_ai_block"===s){var R;const e=I.j4({environment:n,type:r.Ti.aiBlock,inMemoryRecordCache:y.inMemoryRecordCache,transaction:o,spaceId:y.pointer.spaceId,useCrdt:T});x.BE({parentStore:k,afterStore:y,insertStore:e,transaction:o}),(0,Z.Nm)(y)&&x.Od({parentStore:k,childToRemoveStore:y,transaction:o});const t=(0,B.xM)(d);if("initial"!==t.type)throw new Error("Assertion failure, currentRevision.type is not initial");const i=null===(R=t.additionalContext)||void 0===R?void 0:R.prompt;i&&_.applyOperation({store:e,operation:l.op.set({pointer:e.pointer,path:["properties","title"],args:[[i]]}),transaction:o}),_.applyOperation({store:e,operation:l.op.update({pointer:e.pointer,path:["format"],args:{ai_last_edited:Date.now(),ai_prompt_key:t.clientPrompt.key}}),transaction:o}),Ze({parentStore:e.getContentStore(),insertAfter:void 0,insertStores:F,transaction:o})}else Ze({parentStore:k,insertAfter:y,insertStores:F,transaction:o}),function(e){const{environment:t,parentStore:n,insertStores:o,selectInsertion:r}=e,a=o.map((e=>e.cloneWithNewUIParent(n)));i.default.afterNextFlush((()=>{P.yu({environment:t,stores:a}),r&&function(e){const{environment:t,insertedStores:n}=e;Y.clear(t),i.default.afterNextFlush((()=>{const e=(0,N.W9)(n);e&&A.NA({multiSelection:e})}))}({environment:t,insertedStores:a})}))}({environment:n,parentStore:k,insertStores:F,selectInsertion:a});Ye({transaction:o,completionState:(0,B.Iz)(d)}),g&&S.NF(n,{type:"cursor_completion",inference_id:g,feedback_type:"accept",timestamp:(new Date).toUTCString()})}}function Fe(e){const{completion:t,currentPage:n}=e;let o,i;const r=Boolean(n.getBlockTitleStore().getValue()),a=n.getContentStores().every((e=>{var t;return!(null!==(t=e.getTitleStore())&&void 0!==t&&t.getValue())}));if(!r&&a){const{title:e,content:n}=function(e){const t=e.trim().split("\n"),n=t[0];return n.startsWith("# ")?{title:n.substring(2),content:t.slice(1).join("\n")}:{title:"",content:e}}(t||"");o=e,i=n}else i=t;return{insertTitle:o,insertCompletion:i}}function Re(e){var t,n;const{environment:o,transaction:i,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a}=e,s=q.default.state;if(q.default.invalidateLastUpdater(),"completionPopup"!==s.type||"results"!==s.stage||"textSelection"!==s.context.type)return;const{completion:c,userSearchCache:l}=(0,B.xM)(s);if(!c)return;const{endBlock:p,endBlockParent:d,currentPage:u}=s.context,m=d||u.getContentStore();q.default.resetStore(e);const g=C.Mt({environment:o,text:c,inMemoryRecordCache:o.defaultRecordCache.inMemoryRecordCache,transaction:i,markdownOptions:(0,W.N9)(l),markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a,useCrdt:p.useCrdt()});if(!g)return;Ze({parentStore:m,insertAfter:p,insertStores:g,transaction:i}),Ye({transaction:i,completionState:(0,B.Iz)(s)});const y=g.map((e=>e.cloneWithNewUIParent(m))),h=null===(t=v.Ps(y))||void 0===t?void 0:t.getBlockTitleStore(),S=null===(n=v.Z$(y))||void 0===n?void 0:n.getBlockTitleStore();h&&S&&A.NA({multiSelection:{start:{index:0,store:h},end:{index:S.getValue()?f.QaF(S.getValue()).length:0,store:S}}})}function Le(e){const{environment:t,transaction:n,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:i}=e,r=q.default.state;if(q.default.invalidateLastUpdater(),"completionPopup"!==r.type||"results"!==r.stage||"textSelection"!==r.context.type)return;const a=(0,B.xM)(r);a.completion&&(A.NA({multiSelection:r.context.textSelection}),C.R$({environment:t,text:a.completion,transaction:n,disableEmbedMenu:!0,overwrite:!0,selectAll:!0,markdownOptions:(0,W.N9)(a.userSearchCache),markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:i}),Ye({transaction:n,completionState:(0,B.Iz)(r)}),q.default.resetStore(e))}function Be(e,t){for(const n of t)T.X_(e,n)}function Oe(e){const{environment:t,transaction:n,replace:o,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:r}=e,a=q.default.state;if(q.default.invalidateLastUpdater(),"completionPopup"!==a.type||"results"!==a.stage||"blockSelection"!==a.context.type)return;const{completion:s,userSearchCache:c}=(0,B.xM)(a);if(!s)return;const{stores:l}=a.context,p=v.Z$(l);if(!p)return;const d=p.getRecordStoreUIParent();if(!d)return;q.default.resetStore(e);const u=C.Mt({environment:t,text:s,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:n,markdownOptions:(0,W.N9)(c),markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:r,useCrdt:p.useCrdt()});if(!u)return;if(Ze({parentStore:d,insertAfter:p,insertStores:u,transaction:n}),o)for(const f of l){const e=f.getRecordStoreUIParent();e&&x.Od({parentStore:e,childToRemoveStore:f,transaction:n})}Ye({transaction:n,completionState:(0,B.Iz)(a)});const m=u.map((e=>e.cloneWithNewUIParent(d)));P.Z5({environment:t,stores:m})}function We(e){const t=q.default.state;if("completionPopup"!==t.type||"results"!==t.stage||!t.loading)return;const n=(0,B.xM)(t);n.completion&&(S.zi(e,{session_id:t.aiSessionId,inference_id:n.inferenceId}),q.default.invalidateLastUpdater(),q.default.setState({...t,loading:!1}),Te({environment:e,setSelection:!0}))}function Ee(){const e=q.default.state;"completionPopup"===e.type&&"results"===e.stage&&q.default.setState({...e,hasErrored:!0})}function Ue(e){const t=q.default.state;"completionPopup"===t.type&&"results"===t.stage&&0!==t.futureRevisions.length&&(q.default.invalidateLastUpdater(),q.default.setState({...t,hasErrored:!1,loading:!1,revisions:[...t.revisions,t.futureRevisions[0]],futureRevisions:t.futureRevisions.slice(1)}),Te({environment:e,setSelection:!0}))}function Ne(e){const{environment:t,purgeFromHistory:n}=e,o=q.default.state;if("completionPopup"!==o.type||"results"!==o.stage||0===o.revisions.length)return;const i=o.revisions[o.revisions.length-1];return q.default.invalidateLastUpdater(),q.default.setState({...o,hasErrored:!1,loading:!1,revisions:o.revisions.slice(0,-1),futureRevisions:n?o.futureRevisions:[i,...o.futureRevisions]}),Te({environment:t,setSelection:!0}),i}function De(e){q.default.invalidateLastUpdater();const{environment:t,sessionId:n,inferenceId:o,exitType:i}=e,r=q.default.state;if("completionPopup"!==r.type||"initialPromptForAIBlock"===r.stage)return;if((!t.device.isMobileNative||"error_modal"!==i&&"upsell_modal"!==i)&&("cursor"===r.context.type||"textSelection"===r.context.type?A.NA({multiSelection:r.context.textSelection}):"blockSelection"===r.context.type?P.Z5({environment:t,stores:r.context.stores}):(0,h.t1)(r.context)),q.default.resetStore(e),S.HC(t,{session_id:n,inference_id:o,exit_type:i}),"results"!==r.stage)return;const a=(0,B.xM)(r);a.inferenceId&&S.NF(t,{type:"cursor_completion",inference_id:a.inferenceId,feedback_type:"cancel",timestamp:(new Date).toUTCString()})}function Ze(e){const{parentStore:t,insertAfter:n,insertStores:o,transaction:i}=e,r=v.d9(o).reverse();for(const a of r)n?x.BE({parentStore:t,insertStore:a,afterStore:n,transaction:i}):x.Ce({parentStore:t,prependStore:a,transaction:i}),I.sW({store:a,data:{parent_id:t.id,parent_table:t.table,alive:!0},transaction:i});n&&(0,Z.Nm)(n)&&x.Od({parentStore:t,childToRemoveStore:n,transaction:i})}function Ve(e){return C.jm({rootBlock:{...e.pointer,spaceId:e.getSpaceId()},getRecordValue:e.getRecordValue})}function ze(e){const{environment:t,page:n,markdownLinkifyIt:o}=e,i=v.oA(n.getContentStores().map((e=>e.getValue())));return[Ve(n),(0,R.X4)({rootBlock:{...n.pointer,spaceId:n.getSpaceId()},getRecordValue:n.getRecordValue,blockValues:i,isWindows:t.device.isWindows,markdownSerializationOptions:(0,W.KF)(),markdownLinkifyIt:o}).markdown].filter(h.$K).join("\n\n")}function $e(e){const{prompt:t,pageTitle:n,pageContent:o,selectedText:i,additionalContext:r}=e;O.mw()&&console.log("textSelectionPromptToServerContext",e);const a="string"==typeof t.name?t.name:U.default.formatMessage(t.name);if("fixSpellingGrammar"===t.key||"explainThis"===t.key||"makeLonger"===t.key||"makeShorter"===t.key||"findActionItems"===t.key||"improveWriting"===t.key||"simplifyLanguage"===t.key||"cleanUpFormatting"===t.key||"summarize"===t.key)return{serverPrompt:{type:t.key,pageTitle:n,selectedText:i},humanStep:{type:"human",prompt:a}};if("translate"===t.key){const e=(null==r?void 0:r.language)??"english";return{serverPrompt:{type:t.key,text:i,language:e},humanStep:{type:"human",prompt:`Translate to ${e}`}}}if("changeTone"===t.key){const e=(null==r?void 0:r.tone)??"professional";return{serverPrompt:{type:t.key,text:i,tone:e},humanStep:{type:"human",prompt:`Change tone to ${e}`}}}if("helpMeEdit"===t.key){const e=(null==r?void 0:r.prompt)||"";return{serverPrompt:{type:t.key,prompt:e,selectedText:i,pageTitle:n,pageContent:o},humanStep:{type:"human",prompt:e}}}}function Ye(e){const{transaction:t,completionState:{clientPrompt:n,additionalContext:o,promptTitle:i}}=e,r=(0,se.BG)({clientPrompt:n,additionalContext:o,promptTitle:i});if(!r)return;const{currentUserSettingsStore:a}=K.default.state;if(!a)return;(0,re.Gl)(a,r)||(0,se.Nv)(r,a,t)}function je(e){const{prompt:t,pageTitle:n,previousContent:o,restContent:i,additionalContext:r,pageContent:a}=e;O.mw()&&console.log("cursorPromptToServerContext",e);const s="string"==typeof t.name?t.name:U.default.formatMessage(t.name);if("continueWriting"===t.key)return{serverPrompt:{type:"continueWriting",pageTitle:n,previousContent:o,restContent:i},humanStep:{type:"human",prompt:s}};if("helpMeWrite"===t.key){const e=(null==r?void 0:r.prompt)??"";return{serverPrompt:{type:"helpMeWrite",pageTitle:n,previousContent:o,restContent:i,prompt:e},humanStep:{type:"human",prompt:e}}}if("helpMeDraft"===t.key){const e=(null==r?void 0:r.prompt)??"";return{serverPrompt:{type:"helpMeDraft",prompt:e,previousContent:o,pageTitle:n},humanStep:{type:"human",prompt:e}}}if("todoList"===t.key||"outline"===t.key||"meetingAgenda"===t.key||"brainstormIdeas"===t.key||"prosConsList"===t.key||"socialMediaPost"===t.key||"pressRelease"===t.key||"creativeStory"===t.key||"poem"===t.key||"essay"===t.key||"blogPost"===t.key||"jobDescription"===t.key||"salesEmail"===t.key||"recruitingEmail"===t.key){const e=(null==r?void 0:r.topic)??"";return{serverPrompt:{type:t.key,topic:e,pageContent:a},humanStep:{type:"human",prompt:e}}}return"summarize"===t.key||"findActionItems"===t.key?{serverPrompt:{type:t.key,pageTitle:n,selectedText:a},humanStep:{type:"human",prompt:s}}:void 0}async function He(e,t){let n;const o=O.ZE();if(o.debug)n=402!==o.showErrorCode;else{const o=await k.getAIUsageEligibility(e,{spaceId:t});if("success"===o.type){var i,r;n=o.data.isEligible;const e=!1===(null===(i=oe.Z.state)||void 0===i?void 0:i.isEligible)&&(null===(r=oe.Z.state)||void 0===r?void 0:r.requestedAccess);oe.Z.setState({...o.data,...!1===o.data.isEligible&&{requestedAccess:e}})}}return void 0!==n&&ae.Z.setState(n),n}async function Ke(e){const{environment:t,revision:o,type:i,userContent:r,shareWithNotion:a,userOptIn:s}=e;if(X.Z.isAssistantInWriterEnabled()){const{assistantDependency:e}=await Promise.resolve().then(n.bind(n,81598)),{assistantActions:o}=await e.load(),c=G.default.getActiveSessionId();if(!c)throw new Error("No assistantSessionId.");o.saveFeedback({environment:t,inferenceId:"",type:"thumbsup"===i?"assistant_thumbs_up":"assistant_thumbs_down",sessionId:c,userComment:r,shareWithNotion:a,userOptIn:s})}else{const e=q.default.state;if(!o.inferenceId||"completionPopup"!==e.type||"results"!==e.stage)return;S.NF(t,{type:"cursor_completion",inference_id:o.inferenceId,feedback_type:i,timestamp:(new Date).toUTCString(),user_comment:r,share_with_notion:a,user_opt_in:s}),q.default.setState({...e,revisions:e.revisions.map((e=>e.inferenceId===o.inferenceId?{...e,hasFeedback:!0}:e))})}}function Xe(e,t){const n=q.default.state;"completionPopup"===n.type&&"initialPromptForAIBlock"===n.stage&&_.createAndCommit({userAction:"completionActions.updatePromptForCurrentAiBlock",environment:e,perform:o=>{b.sO({environment:e,store:n.store.getBlockTitleStore(),value:(0,f.TPx)(t),transaction:o})}})}function Ge(e){const{environment:t,stores:n,listId:o,inMemoryRecordCache:i,transaction:r}=e,a=new J.ST({environment:t,pointer:{table:u.iU,id:o||(0,E.TS)({environment:t,table:u.iU,spaceId:n[0].getSpaceId()})},recordStoreOptions:{inMemoryRecordCache:i,userId:t.currentUser.id},path:["content"]});for(const s of n)x.R3({parentStore:a,appendStore:s,transaction:r}),I.sW({store:s,data:{parent_id:a.id,parent_table:a.table,alive:!0},transaction:r});return a}},852286:(e,t,n)=>{n.r(t),n.d(t,{LazyAssistantWriterPopup:()=>r,assistantWriterDependency:()=>i});var o=n(277907);const i=new o.Ss("assistantWriter",(()=>Promise.all([n.e(62743),n.e(52774),n.e(44832),n.e(33993),n.e(5242),n.e(71891),n.e(84885),n.e(69343),n.e(93270),n.e(76940),n.e(16732),n.e(11002),n.e(16536),n.e(30433),n.e(76197),n.e(4617),n.e(50116),n.e(81499),n.e(42748),n.e(65496),n.e(23879),n.e(29657),n.e(61105),n.e(43617),n.e(51783),n.e(86467),n.e(75306),n.e(44500),n.e(76644),n.e(98530),n.e(52193),n.e(83264),n.e(35691),n.e(13874),n.e(18240),n.e(62069),n.e(14418),n.e(79411),n.e(8077),n.e(1313),n.e(88054),n.e(31658),n.e(24207),n.e(24199),n.e(36154),n.e(85584)]).then(n.bind(n,760754)))),r=(0,o.kF)(i,(e=>e.AssistantWriterPopup))},896318:(e,t,n)=>{n.d(t,{SA:()=>g,ZE:()=>d,mw:()=>p});n(757658);var o=n(292595),i=n(937850),r=n(95477);let a=0;const s="clipboard",c={debug:Boolean(r.default.isDevelopingInAirplaneMode),responseText:s,showErrorCode:!1,delayBetweenChunks:20,chunkSize:5,numLoremIpsums:3},l="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec porta auctor sem vel efficitur. Vivamus efficitur eros sed erat efficitur efficitur. Vivamus et augue vel est efficitur efficitur.";function p(){return c.debug}function d(){return c}function u(e){return{async*[Symbol.asyncIterator](){for(const t of e)await(0,i.Vs)(c.delayBetweenChunks),yield t}}}function m(e,t){const n=Math.ceil(e.length/t),o=new Array(n);for(let i=0,r=0;i<n;++i,r+=t)o[i]=e.substr(r,t);return o}function f(e){return e.map((e=>({type:"success",p:"padding",completion:e,inferenceId:"mock"})))}async function g(e,t){console.log("Retrieving fake completion for data",t);const{context:n}=t,o=n.selectedText,i=[];let{responseText:p}=c;if(p===s&&(p=await async function(){try{return await navigator.clipboard.readText()}catch(e){return}}()??"Unable to retrieve clipboard text."),void 0===p&&(i.push({type:"success",p:"padding",completion:"\n",inferenceId:"mock"},{type:"success",p:"padding",completion:"this is ",inferenceId:"mock"},{type:"success",p:"padding",completion:"fake ",inferenceId:"mock"},{type:"success",p:"padding",completion:`streaming response ${a++}.`,inferenceId:"mock"}),r.default.isDevelopingInAirplaneMode&&i.push({type:"success",p:"padding",completion:"\n\nTo see a real AI response, run the server with `--airplaneMode=false`.",inferenceId:"mock"}),"string"==typeof o)){i.push({type:"success",p:"padding",completion:"\n\nHere is the text you selected:\n\n",inferenceId:"mock"});for(const e of m(o,c.chunkSize))i.push({type:"success",completion:e,p:"padding",inferenceId:"mock"})}if(c.showErrorCode)i.push({type:"error",message:"alas",errorCode:c.showErrorCode});else if(void 0===p)for(let r=0;r<c.numLoremIpsums;r++)i.push(...f([`\n\n${r+1}. `,...m(l,0===c.delayBetweenChunks?l.length:c.chunkSize)]));else if(p.length>0){const e=m(p,c.chunkSize);i.push(...f(e))}return Promise.resolve({type:"success",data:u(i),status:200,headers:{}})}(0,o.exposeDebugValue)("completionDebugSettings",c)},887199:(e,t,n)=>{n.d(t,{h:()=>r,k:()=>i});var o=n(709291);const i=(0,o.defineMessages)({paymentMethodUnverified:{id:"subscriptions.paymentMethodUnverified",defaultMessage:"Your payment is being processed. Please try again when your payment has completed."},otherPaymentMethod:{id:"subscriptions.otherPaymentMethod",defaultMessage:"Other"},adminOnlyAction:{id:"subscriptions.adminOnlyAction",defaultMessage:"Only workspace owners can perform this action."},iosSubscriptionRestriction:{id:"subscriptions.iosSubscriptionRestriction",defaultMessage:"You're currently subscribed through an in-app purchase with Apple. To switch plans, cancel your subscription with Apple first."}}),r=(0,o.defineMessages)({trialTitle:{id:"nudges.trial.title",defaultMessage:"Notion for collaboration"},trialDescription:{id:"nudges.trial.description",defaultMessage:"Get 14 days of unlimited content creation with others"},trialCta:{id:"nudges.trial.cta",defaultMessage:"Try it for free"},trialTooltip:{id:"nudges.trial.tooltip",defaultMessage:"Use Notion as much as you want, with as many people as you like. You’ll receive a reminder when your trial is ending, and can cancel anytime."},approachingBlockLimitTitle:{id:"nudges.approachingBlockLimit.title",defaultMessage:"Upgrade to go unlimited"},approachingBlockLimitDescription:{id:"nudges.approachingBlockLimit.description",defaultMessage:"Continue using Notion to collaborate with others"},approachingBlockLimitTooltip:{id:"nudges.approachingBlockLimit.tooltip",defaultMessage:"You’re reaching the maximum number of free blocks given on your plan ({percentageUsed}). You won’t be able to create more content unless you upgrade to the Plus plan."},reachedBlockLimitTitle:{id:"nudges.reachedBlockLimit.title",defaultMessage:"Keep using Notion"},reachedBlockLimitDescription:{id:"nudges.reachedBlockLimit.description",defaultMessage:"{spaceName} has used 100% of the free blocks in the workspace"},reachedBlockLimitCta:{id:"nudges.reachedBlockLimit.cta",defaultMessage:"Upgrade plan"},reachedBlockLimitTooltip:{id:"nudges.reachedBlockLimit.tooltip",defaultMessage:"You’ve reached the maximum number of free blocks for your plan (100%). You won’t be able to create more content unless you upgrade to the Plus plan."}})},44041:(e,t,n)=>{n.d(t,{y:()=>w});n(667294);var o=n(647425),i=n(709291),r=n(286572),a=n(547307),s=n(296994),c=n(433929),l=n(352533),p=n(80444),d=n(992083),u=n(739343),m=n(887199),f=n(735993),g=n(170060),y=n(88893),v=n(535057),h=n(288280),S=n(897630),k=n(864891),C=n(785893);async function w(e,t){var n;r.sA(e,{from:t.from,for_subscription_tier:t.for,addOnFeature:t.addOnFeature});if((0,v.QM)()&&["block_limit_sidebar","block_limit_settings","block_limit_banner"].includes(t.from)&&!t.addOnFeature){if(e.device.isMobileBrowser){const n=await s.FF.payments.load();return void(await n.plans.showPlans({environment:e,from:t.from}))}return(0,g.iZ)(e)?void(0,f.a)({openedFrom:t.from}):void d.Z.setState({open:!0,openedFrom:"upsell",currentTab:"plans",defaultSubtab:void 0,highlightedSetting:void 0})}if(!t.addOnFeature&&(0,o.QM)(t.for))return;const w=(0,l.S$)({environment:e})&&"personal"===t.for;if(e.device.isMobileNative){if("ai"===t.addOnFeature){const t=(0,l.Y2)({environment:e})?(0,C.jsx)(i.FormattedMessage,{id:"upsellActions.noIAPForAIWithExternalPurchaseOption",defaultMessage:"Your workspace does not have unlimited AI. Visit on desktop to purchase Notion AI and go unlimited."}):(0,C.jsx)(i.FormattedMessage,{id:"upsellActions.noIAPForAIWithoutExternalPurchaseOption",defaultMessage:"Your workspace does not have unlimited AI. Unfortunately, unlimited AI cannot be purchased on mobile."});return void a.showErrorMessage(t)}if(!w)return}const x=p.default.state.currentSpaceStore;if(!x)return;if(!x.canAdmin())return;await S.bi(e);const I=h.subscriptionDataStoreInstance.state;if(!I)return;if("unsubscribed_admin"!==I.type&&"subscribed_admin"!==I.type)return void(t.dontOpenPlansOnCancel||d.Z.setState({open:!0,openedFrom:"upsell",currentTab:"plans",defaultSubtab:void 0,highlightedSetting:void 0}));if(y.ri(I))return void a.showErrorMessage(c.default.formatMessage(m.k.paymentMethodUnverified));if(y.ff(I)){const e=(0,C.jsx)(i.FormattedMessage,{id:"upsellActions.referToSalesRep",defaultMessage:"This workspace is part of a managed account. Please contact your account representative to discuss any changes to your subscription."});return void a.showErrorMessage(e)}if(w)return void(e.mobileNative&&x.id&&e.mobileNative.openUpgradeModal(x.id));if("revenueCat"===(null===(n=I.customerData)||void 0===n?void 0:n.activeSubscriptionPlatform)){const e=(0,C.jsx)(i.FormattedMessage,{id:"upsellActions.switchPlanFromInAppPurchase",defaultMessage:"You're currently subscribed through an in-app purchase with Apple. To switch plans, cancel your subscription with Apple first."});return void a.showErrorMessage(e)}const P=y.XX(I);if(t.addOnFeature&&(0,u.Fk)(P)){const e=(0,C.jsx)(i.FormattedMessage,{id:"upsellActions.noAddOnPurchaseDuringFreeTrial",defaultMessage:"Unfortunately, additional {addOn, select, ai {AI responses} other {features}} cannot be purchased while a workspace is on a free trial.",values:{addOn:t.addOnFeature}});a.showErrorMessage(e)}else{if(P&&y.MM(I))return t.addOnFeature?void k.af({environment:e,from:t.from,view:"add_ons",addOnFeature:t.addOnFeature,billingInterval:P.interval,pageSection:t.pageSection}):void k.af({environment:e,from:t.from,view:"plans",temporarySubscriptionTier:t.for,billingInterval:P.interval,pageSection:t.pageSection});{const n=(0,g.px)(e,t.for)?"ai_fifty_percent":void 0;S.I0(e,{subscriptionTier:t.for,from:t.from,addOnFeature:t.addOnFeature,coupon:n,isTrial:t.isTrial,dismissMobilePlansModal:t.dismissMobilePlansModal})}}}},735993:(e,t,n)=>{n.d(t,{X:()=>s,a:()=>a});var o=n(471924),i=n(286572),r=n(868187);function a(e){const{openedFrom:t}=e,n=o.Il();r.Z.open({modalId:n,openedFrom:t})}function s(e,t){i.LY(e,{modal_id:t,modal_type:"contextual"}),r.Z.setState({open:!1})}},868187:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(749085);class i extends o.default{getInitialState(){return{open:!1}}open(e){this.setState({open:!0,...e})}}const r=new i},739343:(e,t,n)=>{n.d(t,{Fk:()=>s,U6:()=>l,nx:()=>c});var o=n(730120),i=n(313991),r=n(407057),a=n(95477);function s(e){return!(null==e||!e.trialEnd)&&e.trialEnd>=o.ou.now().toSeconds()}function c(e){const t=function(e){if(!s(e))return;const t=1e3*(null==e?void 0:e.trialEnd);return null!=e&&e.periodEnd&&e.periodEnd>=o.ou.now().toSeconds()&&e.periodEnd<t?e.periodEnd:t}(e);return t?(0,r.Yx)(t,"long",i.SP):void 0}function l(e){return e?a.default.trials[e.id].duration:a.default.trials.default.duration}}}]);