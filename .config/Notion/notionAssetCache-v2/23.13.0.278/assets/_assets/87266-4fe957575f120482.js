"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[87266],{806758:(e,t,o)=>{o.d(t,{Pq:()=>ue,oe:()=>pe,bU:()=>de});o(757658);var r=o(667294),n=o(800480),l=o(724405),i=o(576205),a=o(68965),s=o(542853),c=o(356666),d=o(388437),p=o(762208),u=o(747453),x=o(937612),g=o(709291),f=o(653965),m=o(401898),h=o(436610),y=o(108406),v=o(502005),M=o(397004),j=o(717335),S=o(460709),C=o(223196),b=o(61766),w=o(713401),F=o(886628),V=o(180951),T=o(143690),Z=o(433929),P=o(98742),_=o(825464),I=o(552275),k=o(814871),O=o(526388),A=o(164369),R=o(162045),G=o(785893);function B(e){const{filter:t}=e,{isMobile:o}=(0,n.Fy)(),r=Z.default.getIntl(),l={width:190,menuTitle:r.formatMessage({defaultMessage:"Date Options",id:"database.filterMenu.mobileDateFilterModeMenu.title"}),items:i.T,selectedItem:(0,i.TX)(t),getKey:e=>e,onSelect:o=>{const r={...t,use_end:(0,i.UG)(o)};e.onChange(r)},renderItem:e=>(0,G.jsx)(O.Z,{renderTooltip:()=>(0,j._T)(e.value),render:t=>(0,G.jsx)(I.Z,{title:(0,j.IF)(e.value),...(0,P.Z)(e,t)}),placement:_.u.Right,textWrap:!0,style:{width:"260px"}}),renderOrigin:e=>(0,G.jsx)(R.Z,{...e,placeholder:r.formatMessage({defaultMessage:"Date Options",id:"database.filterMenu.dateFilterModeMenu.label"}),title:(0,G.jsx)(A.Z,{isMobile:o,children:(0,j.IF)((0,i.TX)(t))}),disableMargins:!0,desktopStyle:{width:"100px"}})};return(0,G.jsx)(k.Z,{...l,mobileActionSheet:!0},"date-filter-mode")}var U=o(334299);const $=(0,g.injectIntl)((function(e){const t=(0,n.O7)(),{filterValueType:o,filter:r,intl:l}=e,a=(0,i.xm)(o),s={width:190,menuTitle:l.formatMessage({defaultMessage:"Comparator",id:"database.filterMenu.mobileComparatorValueMenu.title"}),items:a,selectedItem:r.operator,getKey:e=>e,onSelect:n=>{const l=(0,j.li)(o,r,n,"combinator");e.onChange(l),e.collectionContextStore?y.wd({environment:t,collectionContextStore:e.collectionContextStore,action:"set_filter_comparator"}):h.wd(t,{view_type:e.collectionViewType,action:"set_filter_comparator"})},renderItem:e=>(0,G.jsx)(I.Z,{title:(0,j.WC)(e.value),...e}),renderOrigin:e=>(0,G.jsx)(R.Z,{...e,placeholder:l.formatMessage({defaultMessage:"Comparator",id:"database.filterMenu.comparatorMenuDropdownButton.label"}),title:(0,G.jsx)(A.Z,{isMobile:t.device.isMobile,children:(0,j.WC)(r.operator)}),disableMargins:!0})};return(0,G.jsx)(k.Z,{...s,mobileActionSheet:!0},"comparator")}));var K=o(949068);const Q=(0,g.defineMessages)({setFilter:{defaultMessage:"Set filter",id:"database.filterMenu.rollupPropertyValue.mobileMenu.title"}});const W=(0,g.injectIntl)((function(e){const t=(0,n.O7)();if((0,i.a_)(e.filter))return(0,G.jsx)(z,{intl:e.intl,onChange:e.onChange,collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType,property:e.property,schema:e.schema,parentStore:e.parentStore,collectionViewId:e.collectionViewId,filter:e.filter});const o=(0,i.fI)({schema:e.schema,property:e.property,getRecordModel:e.parentStore.getRecordModel});if(!(0,i.ZB)(o,e.filter)){const t=(0,j.rn)(o);return(0,G.jsxs)(r.Fragment,{children:[(0,G.jsx)($,{filterValueType:o,filter:t,collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType,onChange:e.onChange}),(0,G.jsx)(K.Z,{filterValueType:o,filter:t,schema:e.schema,property:e.property,parentStore:e.parentStore,collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType,collectionViewId:e.collectionViewId,onChange:e.onChange})]})}const l=(0,G.jsx)(g.FormattedMessage,{...j.xe[o],values:{property:(0,G.jsx)(g.FormattedMessage,{id:"collectionFilterMenuFilter.property.name",defaultMessage:"Property"}),operator:(0,G.jsx)($,{filterValueType:o,filter:e.filter,collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType,onChange:e.onChange}),operatorValue:(0,G.jsx)(K.Z,{filterValueType:o,filter:e.filter,schema:e.schema,property:e.property,parentStore:e.parentStore,collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType,collectionViewId:e.collectionViewId,onChange:e.onChange})}});return t.device.isMobile?l:(0,G.jsx)("div",{style:{alignItems:"center",display:"grid",gridAutoFlow:"column",gridAutoColumns:"1fr",gridColumnEnd:e.isArrayFilter?void 0:"span 2",gridColumnGap:`${v.l0}px`,gridTemplateRows:`${v.fg}px`,gridTemplateColumns:"[value-start] max-content auto [value-end operator-start] auto"},children:l})})),E=W;function z(e){let{filter:t,intl:o,onChange:l,collectionContextStore:a,collectionViewType:s,property:c,schema:d,parentStore:p,collectionViewId:u}=e;const x=(0,n.O7)(),g={menuTitle:o.formatMessage(Q.setFilter),items:i.Rf,getKey:e=>e,selectedItem:t.operator,onSelect:e=>{const o={...t,operator:e};l(o),a?y.wd({environment:x,collectionContextStore:a,action:"set_rollup_set_filter"}):h.wd(x,{view_type:s,action:"set_rollup_set_filter"})},renderItem:e=>(0,G.jsx)(I.Z,{title:(0,j.SW)(e.value,o),...e}),renderOrigin:e=>(0,G.jsx)(R.Z,{...e,placeholder:o.formatMessage(Q.setFilter),title:(0,j.SW)(t.operator,o),disableMargins:!0,desktopStyle:{minWidth:70}})},{targetProperty:f,targetCollectionSchema:m}=(0,F.VK)((()=>{var e;if("rollup"===(null==d||null===(e=d[c])||void 0===e?void 0:e.type)){const e=(0,U.gT)({schema:d,property:c,getRecordModel:p.getRecordModel});return{targetProperty:null==e?void 0:e.targetProperty,targetCollectionSchema:null==e?void 0:e.targetCollectionSchema}}return{targetProperty:c,targetCollectionSchema:d}}),[c,d,p]);if(!f||!m)return(0,G.jsx)("div",{style:{gridColumnEnd:"span 2"}});const M=(0,G.jsxs)(r.Fragment,{children:[(0,G.jsx)(k.Z,{...g,mobileActionSheet:!0},"set_filter"),(0,G.jsx)(W,{collectionViewId:u,filter:t.subfilter,schema:m,property:f,parentStore:p,collectionContextStore:a,collectionViewType:s,onChange:e=>{const o={...t,subfilter:e};l(o)},isArrayFilter:!0})]});return x.device.isMobile?M:(0,G.jsx)("div",{style:{display:"grid",gridAutoFlow:"column",gridAutoColumns:"1fr",gridColumnEnd:"span 2",gridColumnGap:`${v.l0}px`,gridTemplateColumns:"max-content",gridTemplateRows:`${v.fg}px`},children:M})}var D=o(231945),L=o(177498),H=o(750542);const N=function(e){let{schema:t,propertyFilter:o,parentStore:l,index:a,collectionContextStore:s,collectionViewType:c,onChange:d,filterOperator:p,collectionViewId:u}=e;const x=(0,n.O7)(),{device:f}=x,m=(0,V.Qm)({schema:t,property:o.property}),v=(0,F.VK)((()=>(0,i.J5)(t,o.property,o.filter,l.getRecordModel)),[l,o,t]);if(!m)return null;if(!v)return null;const M=(0,i.gE)(o.filter)&&(0,i.vR)(o.filter)&&(0,i.c3)(m),S=M?{width:"120px",marginRight:"4px"}:{},C=(0,G.jsxs)(r.Fragment,{children:[(0,G.jsx)(D.ZP,{popupType:f.isMobile?D.Z4.SlideUp:D.Z4.Popup,renderOrigin:e=>(0,G.jsx)(H.Z,{...e,propertySchema:m,disableMargins:!0,textWrapperStyle:{width:"100%",...S}}),render:e=>(0,G.jsx)(L.Z,{isRelationProperty:!1,schema:t,onAccept:e=>function(e,t,o,r,n,l,a,s,c){const{property:d,filter:p}=r,u=o[d],x=o[e],g={property:e,filter:p},f=x&&(0,i.J5)(o,e,p,n.getRecordModel),m=x&&"relation"===x.type&&d!==e,v=u&&("created_by"===u.type||"last_edited_by"===u.type)&&x&&"person"===x.type,M=(0,i.Gb)(p)&&!(0,i.mv)(p)&&(0,i.R8)(p).some((e=>"exact"===e.type&&e.value&&"bot"===e.value.table));(!f||m||v&&M||!(0,T.dN)(g,o))&&(g.filter=(0,j.zZ)({schema:o,property:e,getRecordModel:n.getRecordModel}));null==c||c(l,g),a?y.wd({environment:t,collectionContextStore:a,action:"set_filter_property"}):h.wd(t,{view_type:s,action:"set_filter_property"})}(e,x,t,o,l,a,s,c,d),onClose:e.close,allowProperty:V.Kf})}),M&&(0,G.jsx)(B,{filter:o.filter,onChange:e=>{const t={...o,filter:e};null==d||d(a,t)}})]});return(0,G.jsxs)(r.Fragment,{children:[p,f.isMobile?C:(0,G.jsx)("div",{style:{display:"flex"},children:C}),(0,G.jsx)(g.FormattedMessage,{id:"collectionFilterMenuRow.propertyConjunction.label",defaultMessage:" "}),(0,G.jsx)(E,{filter:o.filter,schema:t,property:o.property,parentStore:l,collectionViewId:u,collectionContextStore:s,collectionViewType:c,onChange:e=>{const t={...o,filter:e};null==d||d(a,t)},isArrayFilter:!1})]})};function q(){return(0,G.jsx)(g.FormattedMessage,{defaultMessage:"Add filter rule",id:"database.filterMenu.addFilterRuleButtonTitle"})}const J=(0,g.defineMessages)({operatorPlaceholder:{defaultMessage:"Operator",id:"database.filterMenu.operatorPlaceholder"}});const X=(0,g.injectIntl)((function(e){const{intl:t,filterOperator:o,onChange:r,disableMargins:n}=e,l={width:"auto",menuTitle:t.formatMessage({defaultMessage:"Operator",id:"database.filterMenu.filterOperatorMenu.title"}),items:i.Uz,getKey:e=>e,selectedItem:o,onSelect:r,renderItem:e=>(0,G.jsx)(I.Z,{title:(0,j.KV)(e.value,t),caption:(0,j.Qz)(e.value,t),...e}),renderOrigin:e=>(0,G.jsx)(R.Z,{...e,title:o&&(0,j.KV)(o,t),placeholder:t.formatMessage(J.operatorPlaceholder),disableMargins:n})};return(0,G.jsx)(k.Z,{...l,mobileActionSheet:!0},"operator")}));var Y=o(831339),ee=o(708982),te=o(573063),oe=o(478140),re=o(632163),ne=o(840721),le=o(953437),ie=o(672495);const ae=60,se=120,ce=110,de=170,pe=400;function ue(e){const{combinatorFilter:t,index:o,level:l,schema:a,onChange:s,parentStore:c,collectionContextStore:d,collectionViewType:p,collectionViewId:u}=e,x=(0,n.Fy)(),g=(0,r.useRef)([]),f=(t.filters??[]).flatMap((e=>(0,i.Mm)(e)?[]:[e]));return(0,G.jsxs)(r.Fragment,{children:[Ie(t,l)?void 0:(0,G.jsx)("div",{style:x.isMobile?void 0:{display:"grid",gridTemplateColumns:`\n             [boolean-start] ${ae}px\n             [boolean-end property-start] minmax(min-content, ${se}px)\n             [property-end operator-start] ${ce}px\n             [operator-end value-start] auto\n             [value-end menu-start] ${v.fg}px\n             [menu-end]\n        `,gridAutoRows:`minmax(${v.fg}px, auto)`,gridColumnGap:v.l0,gridRowGap:v.cn,padding:`${v.cn}px ${v.l0}px 0 ${v.l0}px`,justifyItems:"stretch",alignItems:"start"},children:f.map(((o,r)=>(0,G.jsx)(xe,{childFilter:o,newIndex:r,schema:a,level:l,combinatorFilter:t,onChange:s,index:e.index,collectionContextStore:d,collectionViewType:p,buttonPopupStores:g.current,parentStore:c,collectionViewId:u},r)))}),(0,G.jsx)(ye,{schema:a,level:l,combinatorFilter:t,onChange:s,index:o,buttonPopupStores:g.current,collectionContextStore:d,collectionViewType:p})]})}function xe(e){const{childFilter:t,newIndex:o,...r}=e,l=(0,n.Fy)();return(0,i.vA)(t)?l.isMobile?(0,G.jsx)(he,{childFilter:t,newIndex:o,...r}):(0,G.jsx)(me,{childFilter:t,newIndex:o,...r}):(0,i.aN)(t)?l.isMobile?(0,G.jsx)(fe,{childFilter:t,newIndex:o,...r}):(0,G.jsx)(ge,{childFilter:t,newIndex:o,...r}):null}function ge(e){const{newIndex:t,childFilter:o}=e;return(0,G.jsxs)(r.Fragment,{children:[(0,G.jsx)(N,{index:t,propertyFilter:o,schema:e.schema,filterOperator:(0,G.jsx)(Be,{combinatorFilter:e.combinatorFilter,onChange:e.onChange,index:e.index,collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType,newIndex:t}),parentStore:e.parentStore,onChange:(t,o)=>Re(t,o,e.combinatorFilter,e.onChange,e.index),collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType,collectionViewId:e.collectionViewId},t),(0,G.jsx)(ve,{filter:o,indexToChange:t,level:e.level,combinatorFilter:e.combinatorFilter,onChange:e.onChange,index:e.index,collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType,buttonPopupStores:e.buttonPopupStores})]},t)}function fe(e){const{childFilter:t,newIndex:o}=e;return(0,G.jsxs)(r.Fragment,{children:[(0,G.jsx)(Be,{combinatorFilter:e.combinatorFilter,onChange:e.onChange,index:e.index,collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType,newIndex:o}),(0,G.jsxs)(ie.Z,{title:(0,G.jsx)(g.FormattedMessage,{defaultMessage:"Filter {index}",id:"database.filterMenu.filterIndex",values:{index:o+1}}),children:[(0,G.jsx)(N,{index:o,propertyFilter:t,schema:e.schema,filterOperator:null,parentStore:e.parentStore,onChange:(t,o)=>Re(t,o,e.combinatorFilter,e.onChange,e.index),collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType,collectionViewId:e.collectionViewId},o),(0,G.jsx)(ve,{filter:t,indexToChange:o,level:e.level,combinatorFilter:e.combinatorFilter,onChange:e.onChange,index:e.index,collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType,buttonPopupStores:e.buttonPopupStores})]})]},o)}function me(e){const{newIndex:t,childFilter:o}=e,n=(0,l.yK)((e=>({wrapperStyles:{gridColumn:"property-start / value-end",...Ae(e)}})),[]);return(0,G.jsxs)(r.Fragment,{children:[(0,G.jsx)(Be,{combinatorFilter:e.combinatorFilter,onChange:e.onChange,index:e.index,collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType,newIndex:t}),(0,G.jsx)("div",{style:n.wrapperStyles,children:(0,G.jsx)(ue,{index:t,level:e.level+1,combinatorFilter:o,onChange:(t,o)=>Re(t,o,e.combinatorFilter,e.onChange,e.index),parentStore:e.parentStore,schema:e.schema,collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType,collectionViewId:e.collectionViewId})}),(0,G.jsx)(ve,{filter:o,indexToChange:t,level:e.level,combinatorFilter:e.combinatorFilter,onChange:e.onChange,index:e.index,collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType,buttonPopupStores:e.buttonPopupStores})]},t)}function he(e){const{childFilter:t,newIndex:o}=e,n=(t.filters||[]).length,l=(0,G.jsx)(g.FormattedMessage,{defaultMessage:"Filter Group {index}",id:"database.filterMenu.filterGroupIndex",values:{index:o+1}});return(0,G.jsxs)(r.Fragment,{children:[(0,G.jsx)(Be,{combinatorFilter:e.combinatorFilter,onChange:e.onChange,index:e.index,collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType,newIndex:o}),(0,G.jsxs)(ie.Z,{title:l,children:[(0,G.jsx)(D.ZP,{buttonPopupStore:be(o,e.buttonPopupStores),popupType:D.Z4.SlideUp,renderOrigin:o=>(0,G.jsx)(I.Z,{focused:!1,...o,showExtensionArrow:!0,right:n.toString(),title:(0,j.qh)({filter:t,schema:e.schema})}),render:r=>(0,G.jsx)(oe.Z,{menuType:S.og.Modal,title:l,left:(0,G.jsx)(ne.BackMenuText,{}),onClickLeft:r.close,children:(0,G.jsx)(ue,{index:o,level:e.level+1,combinatorFilter:t,onChange:(t,o)=>Re(t,o,e.combinatorFilter,e.onChange,e.index),parentStore:e.parentStore,schema:e.schema,collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType,collectionViewId:e.collectionViewId})})}),(0,G.jsx)(ve,{filter:t,indexToChange:o,level:e.level,combinatorFilter:e.combinatorFilter,onChange:e.onChange,index:e.index,collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType,buttonPopupStores:e.buttonPopupStores})]})]},o)}function ye(e){const t=(0,n.O7)(),o=(0,n.Fy)(),{schema:r,level:i,combinatorFilter:a,onChange:c,index:d,buttonPopupStores:p,collectionContextStore:u,collectionViewType:x}=e,g=(0,l.yK)((()=>({buttonMenuItemStyles:{height:32},sectionMenuItemStyles:{padding:`${v.cn}px 0`}})),[]);return o.isMobile?(0,G.jsxs)(ie.Z,{topBorder:Ie(a,i),children:[(0,G.jsx)(ke,{props:{onClick:()=>Ge(t,r,a,c,d,u,x)}}),Ze(e.level)&&(0,G.jsx)(Oe,{props:{onClick:()=>Se(t,r,a,c,d,u,x,p)}})]}):Ze(i)?(0,G.jsx)(ie.Z,{topBorder:Ie(a,i),desktopStyle:g.sectionMenuItemStyles,children:(0,G.jsx)(D.ZP,{alignmentToOrigin:le.ZP.Alignment.Start,popupType:C.k.Popup,renderOrigin:e=>(0,G.jsx)(ee.i,{action:()=>e.onClick(),render:t=>{const{focused:o,...r}=t;return(0,G.jsx)(w.Z,{...e,...r,focused:o,isBlue:!1,style:g.buttonMenuItemStyles,title:(0,G.jsxs)("div",{children:[(0,G.jsx)(q,{}),(0,s.i)({width:10,marginLeft:6,display:"inline"})]})})}}),render:e=>(0,G.jsx)(re.Z,{type:re.i.Vertical,initialFocus:0,sections:[{key:"actions",render:e=>(0,G.jsx)(ie.Z,{...e}),items:[{key:"add_filter",render:e=>(0,G.jsx)(ke,{props:e}),action:o=>{e.close(),Ge(t,r,a,c,d,u,x)}},{key:"add_filter_group",render:e=>(0,G.jsx)(Oe,{props:e}),action:o=>{e.close(),Se(t,r,a,c,d,u,x,p)}}]}]})})}):(0,G.jsx)(ie.Z,{topBorder:Ie(a,i),desktopStyle:g.sectionMenuItemStyles,children:(0,G.jsx)(ee.i,{action:()=>Ge(t,e.schema,e.combinatorFilter,e.onChange,e.index,e.collectionContextStore,e.collectionViewType),render:e=>{const{focused:o,...n}=e;return(0,G.jsx)(w.Z,{...n,focused:e.focused,isBlue:!1,style:g.buttonMenuItemStyles,onClick:()=>Ge(t,r,a,c,d,u,x),title:(0,G.jsx)(q,{})})}})})}function ve(e){const t=(0,n.Fy)(),o=(0,g.useIntl)();return t.isMobile?(0,G.jsx)(Me,{filter:e.filter,indexToChange:e.indexToChange,level:e.level,parent:void 0,combinatorFilter:e.combinatorFilter,onChange:e.onChange,index:e.index,buttonPopupStores:e.buttonPopupStores,collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType}):(0,G.jsx)(D.ZP,{popupType:C.k.Popup,renderOrigin:e=>(0,G.jsx)(ee.i,{action:()=>e.onClick(),render:e=>(0,G.jsx)(te.Z,{...e,hovered:e.focused,style:{width:"100%",height:32},icon:c.o,ariaLabel:o.formatMessage({id:"collections.CollectionFilterCombinatorGrid.RowActions.threeDotActionMenu",defaultMessage:"Edit filter actions"})})}),render:t=>(0,G.jsx)(Me,{filter:e.filter,indexToChange:e.indexToChange,level:e.level,parent:t,combinatorFilter:e.combinatorFilter,onChange:e.onChange,index:e.index,buttonPopupStores:e.buttonPopupStores,collectionContextStore:e.collectionContextStore,collectionViewType:e.collectionViewType})})}function Me(e){const{filter:t,indexToChange:o,parent:r}=e,l=(0,n.O7)(),a=(0,n.Fy)(),s=(0,i.vA)(t),c=s?(0,G.jsx)(g.FormattedMessage,{defaultMessage:"Remove",id:"database.filterMenu.removeFilterGroupMenuTitle"}):(0,G.jsx)(g.FormattedMessage,{defaultMessage:"Remove",id:"database.filterMenu.removeFilterMenuTitle"}),u=s?(0,G.jsx)(g.FormattedMessage,{defaultMessage:"Duplicate",id:"database.filterMenu.duplicateFilterGroupMenuTitle"}):(0,G.jsx)(g.FormattedMessage,{defaultMessage:"Duplicate",id:"database.filterMenu.duplicateFilterMenuTitle"}),m=[{key:"delete",action:()=>{var t,n,l,i,a;r&&r.close(),t=o,n=e.buttonPopupStores,l=e.combinatorFilter,i=e.onChange,a=e.index,_e((e=>e.splice(t,1)),l,i,a),be(t,n).reset(),n.splice(t,1)},render:e=>(0,G.jsx)(I.Z,{...e,icon:(0,G.jsx)(Ve,{icon:x.y}),isRedOnHover:!0,title:c})},{key:"duplicate",action:()=>{r&&r.close(),function(e,t,o,r,n,l,i){_e((t=>{const o=t[e];if(o){const r={...o};t.splice(e,0,r)}}),t,o,r),n?y.wd({environment:i,collectionContextStore:n,action:"add_filter_group"}):h.wd(i,{view_type:l,action:"duplicate_filter"})}(o,e.combinatorFilter,e.onChange,e.index,e.collectionContextStore,e.collectionViewType,l)},render:e=>(0,G.jsx)(I.Z,{...e,icon:(0,G.jsx)(Ve,{icon:d.a}),title:u})}];if((0,i.aN)(t)&&Ze(e.level)&&m.push({key:"turn_into_group",action:()=>{r&&r.close(),je(l,o,t,e.combinatorFilter,e.onChange,e.index,e.buttonPopupStores,e.collectionContextStore,e.collectionViewType)},render:e=>(0,G.jsx)(I.Z,{...e,icon:(0,G.jsx)(Ve,{icon:p.z}),title:(0,G.jsx)(g.FormattedMessage,{defaultMessage:"Turn into group",id:"database.filterMenu.turnIntoGroupMenuTitle"})})}),(0,i.vA)(t)&&t.filters&&1===t.filters.length){const n=(0,i.vA)(t.filters[0])?(0,G.jsx)(g.FormattedMessage,{defaultMessage:"Unwrap group",id:"database.filterMenu.unwrapGroupMenuTitle"}):(0,G.jsx)(g.FormattedMessage,{defaultMessage:"Turn into filter",id:"database.filterMenu.turnIntoFilterMenuTitle"});m.push({key:"turn_into_filter",action:()=>{r&&r.close(),function(e,t,o,r,n,l,a,s){const c=f.Ps(t.filters||[]);c&&!(0,i.Mm)(c)&&Re(e,c,r,n,l);a?y.wd({environment:o,collectionContextStore:a,action:"turn_into_filter"}):h.wd(o,{view_type:s,action:"turn_into_filter"})}(o,t,l,e.combinatorFilter,e.onChange,e.index,e.collectionContextStore,e.collectionViewType)},render:e=>(0,G.jsx)(I.Z,{...e,icon:(0,G.jsx)(Ve,{icon:p.z}),title:n})})}const v=we(t);return(0,i.vA)(t)&&e.level+v+1<3&&m.push({key:"wrap_in_group",action:()=>{r&&r.close(),je(l,o,t,e.combinatorFilter,e.onChange,e.index,e.buttonPopupStores,e.collectionContextStore,e.collectionViewType)},render:e=>(0,G.jsx)(I.Z,{...e,icon:(0,G.jsx)(Ve,{icon:p.z}),title:(0,G.jsx)(g.FormattedMessage,{defaultMessage:"Wrap in group",id:"database.filterMenu.wrapInGroupMenuTitle"}),caption:(0,G.jsx)(g.FormattedMessage,{defaultMessage:"Create a filter group around this",id:"database.filterMenu.wrapInGroupMenuCaption"})})}),(0,G.jsx)(re.Z,{initialFocus:a.isMobile?void 0:0,type:re.i.Vertical,sections:[{key:"actions",render:a.isMobile?e=>(0,G.jsx)("div",{...e}):e=>(0,G.jsx)(ie.Z,{...e}),items:m}]})}function je(e,t,o,r,n,l,i,a,s){Re(t,{operator:Te(r),filters:[o]},r,n,l),Ce(t,i),a?y.wd({environment:e,collectionContextStore:a,action:"turn_into_filter_group"}):h.wd(e,{view_type:s,action:"turn_into_filter_group"})}function Se(e,t,o,r,n,l,i,a){const s=Pe(t,o),c={operator:Te(o),filters:[s]};Ce(_e((e=>e.push(c)),o,r,n)-1,a),l?y.wd({environment:e,collectionContextStore:l,action:"add_filter_group"}):h.wd(e,{view_type:i,action:"add_filter_group"})}function Ce(e,t){be(e,t).setState({open:!0})}function be(e,t){for(;t.length<e+1;){const e=new b.Z;t.push(e)}return t[e]}function we(e){if((0,i.vA)(e)){const t=(e.filters||[]).filter(i.vA);return 1+(f.Fp(t.map(we))||0)}return 0}function Fe(e){const{operator:t,lowercase:o}=e;return"or"===t?o?(0,G.jsx)(g.FormattedMessage,{id:"collectionFilterCombinatorGrid.filterOperator.or.lowercase",defaultMessage:"or"}):(0,G.jsx)(g.FormattedMessage,{id:"collectionFilterCombinatorGrid.filterOperator.or",defaultMessage:"Or"}):"and"===t?o?(0,G.jsx)(g.FormattedMessage,{id:"collectionFilterCombinatorGrid.filterOperator.and.lowercase",defaultMessage:"and"}):(0,G.jsx)(g.FormattedMessage,{id:"collectionFilterCombinatorGrid.filterOperator.and",defaultMessage:"And"}):(0,m.t1)(t)}function Ve(e){let{icon:t,styles:o}=e;return(0,G.jsx)(Y.Z,{icon:t,styles:o})}function Te(e){return"or"===e.operator?"and":"or"}function Ze(e){return e<2}function Pe(e,t){const o=(t.filters||[]).filter(i.aN),r=o[o.length-1];return r?f.Xh(r):(0,M.Me)(e)}function _e(e,t,o,r){const n=[...t.filters||[]],l=e(n);return o(r,{...t,filters:n}),l}function Ie(e,t){return(0,i.$1)(e)&&0===t}function ke(e){let{props:t}=e;const o=(0,G.jsx)(Ve,{icon:u.R});return(0,G.jsx)(I.Z,{focused:!1,...t,icon:o,title:(0,G.jsx)(q,{})})}function Oe(e){let{props:t}=e;const o=(0,G.jsx)(Ve,{icon:a.t});return(0,G.jsx)(I.Z,{focused:!1,...t,icon:o,title:(0,G.jsx)(g.FormattedMessage,{defaultMessage:"Add filter group",id:"database.filterMenu.addFilterGroup2ButtonTitle"}),caption:(0,G.jsx)(g.FormattedMessage,{defaultMessage:"A group to nest more filters",id:"database.filterMenu.addFilterGroupButtonCaption"})})}function Ae(e){return{background:e.filterGroupBackground,borderRadius:4,boxShadow:`0 0 0 1px ${e.filterGroupBorder}`,margin:1,alignSelf:"stretch"}}function Re(e,t,o,r,n){_e((o=>o.splice(e,1,t)),o,r,n)}function Ge(e,t,o,r,n,l,i){const a=Pe(t,o);_e((e=>e.push(a)),o,r,n),l?y.wd({environment:e,collectionContextStore:l,action:"add_filter"}):h.wd(e,{view_type:i,action:"add_filter"})}function Be(e){let{newIndex:t,combinatorFilter:o,onChange:r,index:l,collectionContextStore:i,collectionViewType:a}=e;const s=(0,n.O7)(),c=o.operator,{device:d}=s,p={justifySelf:"end"},u={...p,lineHeight:"32px",paddingRight:4};if(0===t)return d.isMobile?null:(0,G.jsx)(A.Z,{style:u,children:(0,G.jsx)(g.FormattedMessage,{defaultMessage:"Where",id:"database.filterMenu.where"})});if(1===t){const e=(0,G.jsx)(X,{disableMargins:!0,filterOperator:c,onChange:e=>function(e,t,o,r,n,l,i){r(n,{...o,operator:e}),l?y.wd({environment:t,collectionContextStore:l,action:"set_filter_operator"}):h.wd(t,{view_type:i,action:"set_filter_operator"})}(e,s,o,r,l,i,a)});return s.device.isMobile?(0,G.jsx)(ie.Z,{children:e}):(0,G.jsx)("div",{style:p,children:e})}return d.isMobile?null:(0,G.jsx)(A.Z,{style:u,children:(0,G.jsx)(Fe,{operator:c})})}},949068:(e,t,o)=>{o.d(t,{Z:()=>H,$:()=>L});var r=o(667294),n=o(800480),l=o(886628),i=o(724405),a=o(266897),s=o(576205),c=o(399036),d=o(180951),p=o(984619),u=o(640506),x=o(676725),g=o(396367),f=o(709291),m=o(401898),h=o(137810),y=o(436610),v=o(108406),M=o(502005),j=o(717335),S=o(205691),C=o(729376),b=o(206258),w=o(806758),F=o(576852),V=o(168834),T=o(433929),Z=o(708982),P=o(436488),_=o(374194),I=o(268894),k=o(785893);const O=(0,f.defineMessages)({value:{defaultMessage:"Value",id:"database.filterAndSort.propertyValueInput.placeholder"}});function A(e){let{value:t,onChange:o}=e;const{device:l}=(0,n.O7)(),a=(0,r.useRef)(null),[s,c]=(0,r.useState)(!1),d=(0,r.useCallback)((()=>c(!0)),[c]),p=(0,r.useCallback)((()=>c(!1)),[c]),u=(0,r.useCallback)((e=>{o(e.target.value)}),[o]),x=(0,r.useCallback)((()=>{a.current&&(a.current.handleBlur(),p())}),[p]),g=(0,i.yK)((e=>({focused:{background:e.buttonHoveredBackground},unfocused:{background:"transparent"}})),[]),m=t||"";return(0,k.jsx)("div",{style:{display:"flex",margin:0,width:"100%",height:"100%",transition:"background 120ms ease-in"},onClick:d,children:l.isMobile?(0,k.jsx)(I.ZP,{value:m,onChange:u,placeholder:T.default.formatMessage(O.value),onBlur:p,rightMobileEditLabel:(0,k.jsx)(f.FormattedMessage,{defaultMessage:"Edit",id:"database.filterAndSort.mobileEditButton.label"})}):(0,k.jsx)(Z.i,{action:d,render:e=>(0,k.jsx)("div",{ref:e.ref,onMouseEnter:e.onMouseEnter,style:{...e.focused&&!s?g.focused:g.unfocused,margin:0,width:"100%",height:"100%",transition:"background 120ms ease-in"},children:(0,k.jsx)(P.Z,{capture:s,render:e=>(0,k.jsx)("div",{...e,style:{margin:0,width:"100%",height:"100%",transition:"background 120ms ease-in"},children:(0,k.jsx)(_.Z,{focus:s,ref:a,value:m,onChange:u,placeholder:T.default.formatMessage(O.value),onBlur:p,onCancel:x,style:{marginRight:8,paddingLeft:6,paddingRight:0,width:80,height:30,...{margin:0,width:"100%",height:"100%",transition:"background 120ms ease-in"},minWidth:w.bU}})})})})})})}var R=o(552275),G=o(231945),B=o(260458),U=o(814871),$=o(992864),K=o(289845),Q=o(162045),W=o(125845),E=o(314390),z=o(122084);const D=(0,f.defineMessages)({dateTitle:{defaultMessage:"Date",id:"database.filterMenu.mobileDateSelectMenu.title"},emptyPlaceholder:{defaultMessage:"Empty",id:"database.filterMenu.dateSelectMenu.emptyPlaceholder"}});function L(e){return e?(0,k.jsx)(f.FormattedMessage,{defaultMessage:"Select one person",id:"database.personPropertyValue.selectPerson.searchPlaceholderWithLimit"}):(0,k.jsx)(f.FormattedMessage,{defaultMessage:"Select one or more people",id:"database.personPropertyValue.selectPerson.searchPlaceholder"})}const H=function(e){let{schema:t,property:o,parentStore:r,filter:l,collectionViewId:i,filterValueType:a,onChange:c,collectionContextStore:d,collectionViewType:p}=e;const u=(0,n.O7)(),x=(0,f.useIntl)(),g=(0,k.jsx)("span",{});if("date"===a)return(0,s.gE)(l)?(0,s.mv)(l)?g:(0,s.TQ)(l)?(0,k.jsx)(re,{intl:x,parentStore:r,schema:t,collectionViewId:i,property:o,onChange:c,collectionContextStore:d,collectionViewType:p,filter:l}):(0,k.jsx)(oe,{intl:x,collectionViewId:i,property:o,schema:t,parentStore:r,onChange:c,collectionContextStore:d,collectionViewType:p,filter:l}):g;if("text"===a){if(!(0,s.Ly)(l))return g;const e=l;if((0,s.mv)(e))return g;if("string_has_no_alphabet_prefix"===e.operator)return null;const t=e.value;return(0,k.jsx)(A,{value:t.value,onChange:t=>{const o={type:"exact",value:t},r={...e,value:o};c(r)}})}if("number"===a){if(!(0,s.h6)(l))return g;const e=l;if((0,s.mv)(e))return g;const t=e.value;return(0,k.jsx)(A,{value:void 0===t.value?"":t.value.toString(),onChange:t=>{const o={type:"exact",value:(0,S.m)(t,x)},r={...e,value:o};c(r)}})}if("checkbox"===a){if(!(0,s.XA)(l)||!i)return g;const e=l,n=e.value;return(0,k.jsx)(G.ZP,{popupType:u.device.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>(0,k.jsx)(J,{operatorValue:n,events:e}),render:n=>(0,k.jsx)(F.ZP,{collectionViewId:i,propertyFilter:{property:o,filter:e},schema:t,onChange:e=>{c(e)},onClose:n.close,parentStore:r,context:F.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("select"===a||"multi_select"===a||"status"===a){if(!((0,s.dx)(l)||(0,s.NU)(l)||(0,s.r2)(l))||!i)return g;const e=l;if((0,s.mv)(e))return g;const n=t[o];if(!n)return g;const a=(0,s.dx)(e)?(0,s.mg)(e):(0,s.NU)(e)?(0,s.qC)(e):(0,s.Js)(n,(0,s.wB)(e));return(0,k.jsx)(G.ZP,{popupType:u.device.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>(0,k.jsx)(te,{schema:t,property:o,operatorValues:a,events:e}),render:n=>(0,k.jsx)(F.ZP,{collectionViewId:i,propertyFilter:{property:o,filter:e},schema:t,onChange:e=>{c(e)},onClose:n.close,parentStore:r,context:F.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("location"===a){if(!(0,s.Mp)(l))return g;const e=l,n=(0,s.u0)(e);return(0,k.jsx)(G.ZP,{popupType:u.device.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>(0,k.jsx)(Y,{parentStore:r,operatorValues:n,events:e}),render:n=>(0,k.jsx)(F.ZP,{collectionViewId:i,propertyFilter:{property:o,filter:e},schema:t,onChange:e=>{c(e)},onClose:n.close,parentStore:r,context:F.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("relation"===a){if(!(0,s.e)(l)||!i)return g;const e=l;if((0,s.mv)(e))return g;const n=(0,s.YO)(e);return(0,k.jsx)(G.ZP,{popupType:u.device.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>(0,k.jsx)(ie,{parentStore:r,operatorValues:n,events:e,schema:t,property:o}),render:n=>(0,k.jsx)(F.ZP,{collectionViewId:i,propertyFilter:{property:o,filter:e},schema:t,onChange:e=>{c(e)},onClose:n.close,parentStore:r,context:F.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("person"===a){if(!(0,s.Gb)(l)||!i)return g;const e=l;if((0,s.mv)(e))return g;const n=(0,s.R8)(e);return(0,k.jsx)(G.ZP,{popupType:u.device.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>(0,k.jsx)(le,{parentStore:r,operatorValues:n,events:e}),render:n=>(0,k.jsx)(F.ZP,{collectionViewId:i,propertyFilter:{property:o,filter:e},schema:t,onChange:e=>{c(e)},onClose:n.close,parentStore:r,context:F.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("file"===a){if(!(0,s.W6)(l))return g;const e=l;if((0,s.mv)(e))return g;(0,m.t1)(e)}return"verification"===a?(0,s.Jw)(l)?(0,k.jsx)(G.ZP,{popupType:u.device.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>(0,k.jsx)(X,{operatorValues:(0,s.fl)(l),events:e}),render:e=>(0,k.jsx)(F.ZP,{collectionViewId:i,propertyFilter:{property:o,filter:l},schema:t,onChange:e=>{c(e)},onClose:e.close,parentStore:r,context:F.Qv.AdvancedFilter,allowRelativePersonFilter:!1})}):g:((0,m.t1)(a),null)};function N(){return{maxWidth:w.oe}}function q(e){return{paddingTop:e?6:void 0,overflow:"hidden"}}function J(e){let{operatorValue:t,events:o}=e;const r=null==t?void 0:t.value;return(0,k.jsx)(Q.Z,{...o,disableMargins:!0,placeholder:(0,k.jsx)(f.FormattedMessage,{defaultMessage:"Select a value",id:"database.filterOperatorValue.checkboxPlaceholder.title"}),title:"boolean"==typeof r&&(0,k.jsx)(B.Z,{checked:r,size:16,disabled:!0})})}function X(e){let{operatorValues:t,events:o}=e;const r=t.filter((e=>{let{value:t}=e;return Boolean(t)})).map(j.cq);return(0,k.jsx)(Q.Z,{...o,disableMargins:!0,placeholder:(0,k.jsx)(f.FormattedMessage,{defaultMessage:"Select an option",id:"CollectionFilterMenuFilterOperatorValue.verificationFilterSelect.placeholder"}),title:r.length&&(0,k.jsx)("span",{children:(0,x.Z)(r,(e=>(0,k.jsx)("span",{style:{whiteSpace:"pre"},children:(0,k.jsx)(f.FormattedMessage,{defaultMessage:", ",id:"CollectionFilterMenuFilterOperatorValue.verificationFilterSelect.commaSeparator"})},e)))})})}function Y(e){let{operatorValues:t,events:o,parentStore:r}=e;return(0,k.jsx)(Q.Z,{...o,disableMargins:!0,desktopStyle:N(),innerStyle:q(t.length>0),placeholder:(0,k.jsx)(f.FormattedMessage,{defaultMessage:"Select a location",id:"databaseLocationOperators.selectPlaceholder"}),title:t.length>0&&t.map((e=>e.value&&(0,k.jsx)("div",{style:{margin:"0 10px 6px 0"},children:(0,k.jsx)(V.Z,{collectionStore:b.NW.createChildStore(r,{table:"collection",id:e.value})})},e.value)))})}function ee(e){let{operatorValue:t,events:o,isRange:r,schema:n,property:l}=e;const i=n[l],a=i&&"date"===i.type?i.date_format:void 0;let s;if("exact"===t.type&&t.value)if((0,u.J_)(t.value))s=t.value;else if((0,u.gR)(t.value)){const e=(0,u.Gc)(t.value);e&&(s=e.value)}return(0,k.jsx)(Q.Z,{...o,placeholder:r?(0,k.jsx)(f.FormattedMessage,{defaultMessage:"Select a range",id:"database.filterAndSort.dateRangePropertyValue.placeholder"}):(0,k.jsx)(f.FormattedMessage,{defaultMessage:"Select a date",id:"database.filterAndSort.datePropertyValue.placeholder"}),desktopStyle:{minWidth:165},title:s&&(0,k.jsx)("span",{style:{...h.Z.textOverflowStyle},children:(0,k.jsx)(K.Z,{value:s,dateFormat:a||u.sF})}),disableMargins:!0})}function te(e){let{operatorValues:t,events:o,schema:r,property:l}=e;const i=(0,n.O7)(),{device:a}=i,s=r[l],u=s&&((0,c.cu)(s)||"status"===s.type)&&s.options||[];return(0,k.jsx)(Q.Z,{...o,disableMargins:!0,desktopStyle:N(),innerStyle:q(t.length>0),placeholder:(0,k.jsx)(f.FormattedMessage,{defaultMessage:"Select an option",id:"collections.operatorValueSelect.placeholder"}),title:t.length>0&&(0,k.jsx)(k.Fragment,{children:t.map((e=>{if(void 0===e.value)return null;const t=(0,d.i7)(u,e.value);return t?(0,k.jsx)(z.a,{format:a.isMobile?p.lo.Large:p.lo.Medium,isSingle:!1,value:t.value,color:t.color,showRemoveButton:!1},e.value):null}))})})}function oe(e){let{filter:t,intl:o,collectionViewId:l,property:i,schema:a,parentStore:c,onChange:d,collectionContextStore:p,collectionViewType:u}=e;const x=(0,n.O7)();if(!l)return null;const g={menuTitle:o.formatMessage(D.dateTitle),items:s.tO,getKey:e=>"relative"===e.type?e.value:e.type,selectedItem:t.value,onSelect:e=>{const o={...t,value:e};d(o),p?v.wd({environment:x,collectionContextStore:p,action:"set_filter_value_type"}):y.wd(x,{view_type:u,action:"set_filter_value_type"})},renderItem:e=>(0,k.jsx)(R.Z,{title:(0,j.x)(e.value),...e}),renderOrigin:e=>(0,k.jsx)(Q.Z,{...e,disableMargins:!0,placeholder:o.formatMessage(D.emptyPlaceholder),title:(0,j.x)(t.value)})},m=t.value;if("exact"===m.type){const e=(0,k.jsx)(r.Fragment,{children:(0,k.jsx)(f.FormattedMessage,{id:"collectionFilterMenuFilterOperatorValue.date.exact.order",defaultMessage:"{exact}{dateValue}",values:{exact:(0,k.jsx)(U.Z,{...g,mobileActionSheet:!0},"date-filter-value-type"),dateValue:(0,k.jsx)(G.ZP,{popupType:x.device.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>(0,k.jsx)(ee,{schema:a,property:i,operatorValue:m,events:e,isRange:!1}),render:e=>(0,k.jsx)(F.ZP,{collectionViewId:l,propertyFilter:{property:i,filter:t},schema:a,onChange:e=>{d(e)},onClose:e.close,parentStore:c,context:F.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}})}),o=x.device.isDesktop?{display:"grid",justifyContent:"stretch",gridTemplateColumns:"1fr 1fr",gridColumnGap:M.l0,width:"100%"}:void 0;return(0,k.jsx)("div",{style:o,children:e})}return(0,k.jsx)(U.Z,{...g,mobileActionSheet:!0},"date-filter-value-type")}function re(e){let{filter:t,intl:o,parentStore:l,schema:i,collectionViewId:a,property:c,onChange:d,collectionContextStore:p,collectionViewType:u}=e;const x=(0,n.O7)();if(!a)return null;const g={menuTitle:o.formatMessage(D.dateTitle),items:(0,s.bS)(),getKey:e=>(0,s.eX)(e),selectedItem:t.value,onSelect:e=>{const o={...t,value:e};d(o),p?v.wd({environment:x,collectionContextStore:p,action:"set_filter_value_type"}):y.wd(x,{view_type:u,action:"set_filter_value_type"})},renderItem:e=>(0,k.jsx)(R.Z,{title:(0,j.ip)(e.value),...e}),renderOrigin:e=>(0,k.jsx)(Q.Z,{...e,disableMargins:!0,placeholder:o.formatMessage(D.emptyPlaceholder),title:(0,j.ip)(t.value)})},m=t.value;if("exact"===m.type){const e=(0,k.jsx)(r.Fragment,{children:(0,k.jsx)(f.FormattedMessage,{id:"collectionFilterMenuFilterOperatorValue.dateRange.exact.order",defaultMessage:"{dateValue}",values:{exact:(0,k.jsx)(U.Z,{...g,mobileActionSheet:!0},"date-filter-value-type"),dateValue:(0,k.jsx)(G.ZP,{popupType:x.device.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>(0,k.jsx)(ee,{schema:i,property:c,operatorValue:m,events:e,isRange:!0}),render:e=>(0,k.jsx)(F.ZP,{collectionViewId:a,propertyFilter:{property:c,filter:t},schema:i,onChange:e=>{d(e)},onClose:e.close,parentStore:l,context:F.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}})}),o=x.device.isDesktop?{display:"grid",justifyContent:"stretch",gridTemplateColumns:"1fr 1fr",gridColumnGap:M.l0,width:"100%"}:void 0;return(0,k.jsx)("div",{style:o,children:e})}return"relative"!==m.type||"custom"!==m.value&&"surrounding"!==m.value?(0,k.jsx)(U.Z,{...g,mobileActionSheet:!0},"date-filter-value-type"):(0,k.jsx)(E.b,{renderAsQueryDropdown:x.device.isMobile,filter:m,onUpdate:e=>{const o={...t,value:e};d(o),p?v.wd({environment:x,collectionContextStore:p,action:"set_filter_value_type"}):y.wd(x,{view_type:u,action:"set_filter_value_type"})}})}function ne(e){var t;let{operatorValue:o,parentStore:r}=e;const i=(0,n.O7)(),{device:s}=i,c=(0,l.VK)((()=>!o.value||"relative"===o.type&&"me"===o.value?void 0:(0,a.Hl)({pointer:o.value,getRecordValue:r.getRecordValue})),[o,r]);return o.value?"relative"===o.type&&"me"===o.value?(0,k.jsx)("span",{style:{marginTop:1,marginRight:10,marginBottom:6},children:(0,k.jsx)(f.FormattedMessage,{defaultMessage:"Me",id:"database.filterAndSort.firstPersonPropertyValue.title"},"relative")}):c?(0,k.jsx)($.ZP,{actor:c,isSingle:!1,shouldShrink:!1,format:s.isMobile?$.vw.Format.Large:$.vw.Format.Medium,showRemoveButton:!1},null===(t=c.asActor)||void 0===t?void 0:t.id):null:null}function le(e){let{operatorValues:t,events:o,parentStore:r}=e;return(0,k.jsx)(Q.Z,{...o,placeholder:L(void 0),disableMargins:!0,desktopStyle:N(),innerStyle:q(t.length>0),title:t.length>0&&t.map((e=>(0,k.jsx)(ne,{operatorValue:e,parentStore:r},`${e.type}__${e.value}`)))})}function ie(e){let{operatorValues:t,events:o,parentStore:r,schema:a,property:s}=e;const d=(0,i.Fg)(),u=(0,n.O7)(),{device:x}=u,h=(0,l.VK)((()=>{const e=a[s];if(e&&(0,c.p_)(e))return(0,C.ke)(e,r)}),[a,s,r]);return(0,k.jsx)(Q.Z,{...o,disableMargins:!0,desktopStyle:N(),innerStyle:q(t.length>0),placeholder:(0,k.jsx)(f.FormattedMessage,{defaultMessage:"Select a page",id:"databaseRelationOperators.selectPlaceholder"}),title:t.length>0&&t.map(((e,t)=>{if(!e.value)return null;const o=e.type,n={isSingle:!1,shouldShrink:!1,format:x.isMobile?p.lo.Large:p.lo.Medium};if("exact"===o)return(0,k.jsx)(W.Z,{blockId:e.value,parentStore:r,...n},e.value);if("relative"===o){if("builtin"===e.value.type)return h?(0,k.jsx)(p.ZP,{value:(0,k.jsx)(f.FormattedMessage,{...g.qB[h][e.value.variable].messageDescriptor}),backgroundColor:"transparent",theme:d,...n},t):null;if("current_page_in_related_collection"===e.value.type)return(0,k.jsx)(p.ZP,{value:(0,k.jsx)(f.FormattedMessage,{defaultMessage:"This page",id:"database.filterAndSort.currentPagePropertyValue.title"}),backgroundColor:"transparent",theme:d,...n},t)}else(0,m.t1)(o)}))})}},177498:(e,t,o)=>{o.d(t,{Z:()=>C});o(430541);var r=o(443261),n=o.n(r),l=(o(667294),o(800480)),i=o(886628),a=o(598953),s=o(399036),c=o(180951),d=o(709291),p=o(653965),u=o(492658),x=o(966603),g=o(460709),f=o(268894),m=o(478140),h=o(632163),y=o(743765),v=o(840721),M=o(672495),j=o(69872),S=o(785893);const C=function(e){let{selectedProperty:t,onAccept:o,schema:r,onClose:C,allowProperty:b,isRelationProperty:w}=e;const F=(0,l.O7)(),V=(0,d.useIntl)(),T=(0,i.qz)(void 0,u.Z);let Z=Object.keys(r);const P=Z.some(a.w);Z=p.MR(Z,(e=>{const t=(0,c.Qm)({schema:r,property:e});return t?t.name:""}));const _=P?s.bf:s.iw;Z=p.zu(Z,_),Z.unshift(_);const I=(0,i.VK)((()=>T.state.inputValue),[T]);if(b&&(Z=Z.filter((e=>{const t=(0,c.Qm)({schema:r,property:e});return t&&b(t)}))),I){let e=Z.map((e=>{const t=(0,c.Qm)({schema:r,property:e});return t&&t.name}));e=n().filter(I,e).map((e=>{let{original:t}=e;return t})),Z=Z.filter((t=>{const o=(0,c.Qm)({schema:r,property:t});return o&&o.name&&e.includes(o.name)}))}const k=I||Z.length>x.nt,O=p.oA(Z.map((e=>{const n=(0,c.Qm)({schema:r,property:e});if(!n)return null;return{key:e,render:o=>(0,S.jsx)(j.Z,{...o,propertySchema:n,format:j.L.Name,selected:e===t}),action:()=>o(e)}}))),A=[{key:0,render:e=>(0,S.jsx)(M.Z,{...e}),items:O}],{device:R}=F,G=k?(0,S.jsx)(M.Z,{isInput:!0,children:(0,S.jsx)(f.ZP,{focus:!R.isMobile||void 0,focusAfterAnimation:!0,value:I,onChange:e=>T.setState({focus:!0,inputValue:e.target.value}),placeholder:w?V.formatMessage({defaultMessage:"Search for a relation property…",id:"propertySelectMenu.searchForProperty.relation.placeholder"}):V.formatMessage({defaultMessage:"Search for a property…",id:"propertySelectMenu.searchForProperty.default.placeholder"})})}):null;let B;return B=R.isMobile?{menuType:g.og.Modal,title:w?V.formatMessage({defaultMessage:"Relation property",id:"propertySelectMenu.mobileMenu.relationProperty.header"}):V.formatMessage({defaultMessage:"Property",id:"propertySelectMenu.mobileMenu.property.header"}),right:(0,S.jsx)(v.CancelMenuText,{}),onClickRight:C,header:G}:{menuType:g.og.Popup,width:280,maxHeight:480,header:G},(0,S.jsx)(m.Z,{...B,children:0===O.length?(0,S.jsx)(M.Z,{children:(0,S.jsx)(y.Z,{title:(0,S.jsx)(d.FormattedMessage,{defaultMessage:"No results",id:"propertySelectMenu.search.noResults.title"})})}):(0,S.jsx)(h.Z,{type:h.i.Vertical,sections:A,onAccept:C,initialFocus:I.length>0?0:void 0})})}},750542:(e,t,o)=>{o.d(t,{Z:()=>d});o(667294);var r=o(800480),n=o(709291),l=o(552275),i=o(297820),a=o(69872),s=o(162045),c=o(785893);const d=function(e){const t=(0,r.O7)(),{device:o}=t;if(o.isMobile)return e.propertySchema?(0,c.jsx)(a.Z,{propertySchema:e.propertySchema,onClick:e.onClick,focused:!1,format:a.L.Name,showExtensionArrow:!e.disabled}):(0,c.jsx)(l.Z,{focused:!1,title:(0,c.jsx)(n.FormattedMessage,{defaultMessage:"Property",id:"database.mobileFilterAndSortMenu.property.buttonMenuItem.label"})});{const t=e.propertySchema&&(0,c.jsx)(i.Z,{propertySchema:e.propertySchema,showIcon:!0,style:{lineHeight:1.4}}),o=(0,c.jsx)(n.FormattedMessage,{defaultMessage:"Property",id:"database.filterAndSortMenu.propertyButton.label"});return(0,c.jsx)(s.Z,{title:t,placeholder:o,onClick:e.onClick,disabled:e.disabled,disableMargins:e.disableMargins,desktopStyle:e.textWrapperStyle})}}},68965:(e,t,o)=>{o.d(t,{t:()=>l});o(667294);var r=o(745238),n=o(785893);const l=(0,r.IU)("addFilterGroup",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M2.374 12.42h1.293v1.157c0 1.557.787 2.344 2.375 2.344h7.591c1.573 0 2.367-.787 2.367-2.344V5.924c0-1.557-.794-2.344-2.367-2.344h-1.3V2.423C12.333.866 11.539.08 9.966.08H2.374C.786.08 0 .866 0 2.423v7.653c0 1.557.786 2.344 2.374 2.344zm.015-1.218c-.756 0-1.172-.408-1.172-1.194V2.49c0-.786.416-1.194 1.172-1.194h7.554c.749 0 1.172.408 1.172 1.194v1.09H6.042c-1.588 0-2.375.778-2.375 2.343v5.278H2.39zm3.668 3.501c-.749 0-1.172-.408-1.172-1.194V5.991c0-.786.423-1.194 1.172-1.194h7.554c.748 0 1.172.408 1.172 1.194v7.516c0 .787-.424 1.195-1.172 1.195H6.057zm3.773-1.565c.4 0 .643-.272.643-.71v-2.042h2.17c.423 0 .718-.227.718-.628 0-.408-.272-.643-.718-.643h-2.17V6.938c0-.447-.242-.719-.643-.719-.4 0-.628.288-.628.719v2.177h-2.17c-.438 0-.718.235-.718.643 0 .4.295.628.718.628h2.17v2.041c0 .424.227.711.628.711z"})})}}]);