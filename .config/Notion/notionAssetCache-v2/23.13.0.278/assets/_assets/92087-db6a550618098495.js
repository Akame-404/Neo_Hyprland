"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[92087],{346978:(e,t,o)=>{o.d(t,{Z:()=>s});var r=o(667294),a=o(724405),n=o(785893);function i(e,t){let{isSelected:o}=e;const{radioButtonStyle:r,dotStyle:i}=(0,a.yK)((e=>({radioButtonStyle:{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:16,height:16,borderRadius:16,marginRight:8,background:o?e.blueColor:e.whiteButtonBackground,border:o?"none":`1px solid ${e.radioButtonBorder}`,transition:"background 100ms ease-out"},dotStyle:{width:6,height:6,borderRadius:6,background:e.regularInvertedTextColor,transition:"opacity 100ms ease-out",opacity:o?1:0}})),[o]);return(0,n.jsx)("div",{ref:t,style:r,children:(0,n.jsx)("div",{style:i})})}const s=r.forwardRef(i)},418145:(e,t,o)=>{o.d(t,{Z:()=>I,t:()=>_});var r=o(667294),a=o(800480),n=o(886628),i=o(724405),s=o(202032),l=o(399036),d=o(542853),p=o(709291),c=o(653965),u=o(436610),m=o(694166),h=o(566890),g=o(816187),y=o(368585),f=o(460709),M=o(98742),S=o(61766),x=o(206258),v=o(552275),b=o(231945),j=o(478140),k=o(632163),C=o(840721),P=o(953437),T=o(672495),w=o(526388),Z=o(297820),F=o(603072),Y=o(69872),O=o(177498),R=o(785893);let _=function(e){return e[e.BlockPropertyOverlay=0]="BlockPropertyOverlay",e[e.ViewSettings=1]="ViewSettings",e}({});const I=function(e){let{context:t,schema:o,property:r,parentStore:s,onDismiss:l,disabled:d,analyticsFrom:u,onChange:h}=e;const g=(0,i.Fg)(),y=(0,a.O7)(),x=(0,n.qz)(void 0,S.Z),v=(0,n.qz)(void 0,S.Z),T=(0,n.qz)(void 0,S.Z),F=(0,a.Fy)(),Y=(0,n.VK)((()=>V(o,r,s)),[o,r,s]),O=Boolean(null==Y?void 0:Y.propertySchema.relation_property),I=Boolean((null==Y?void 0:Y.propertySchema.relation_property)&&(null==Y?void 0:Y.propertySchema.target_property)),D=(0,n.VK)((()=>c.oA([$(y,g,d,o,r,s,u,T,h),q(O,y,g,d,o,r,s,u,v,h),Q(I,y,g,d,o,r,s,u,x,h)])),[O,I,y,g,d,o,r,s,u,h,x,T,v]),z=(0,n.VK)((()=>x.state.open),[x]),E=(0,n.VK)((()=>T.state.open),[T]),W=(0,n.VK)((()=>v.state.open),[v]);if(!Y)return null;if(t===_.BlockPropertyOverlay){let e;return e=F.isMobile?{menuType:f.og.Modal,title:Y.propertySchema.name,right:(0,R.jsx)(C.DoneMenuText,{}),onClickRight:l}:{menuType:f.og.Popup},(0,R.jsx)(j.Z,{...e,children:(0,R.jsx)(k.Z,{type:k.i.Vertical,initialFocus:void 0,sections:D})})}return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(b.ZP,{popupType:F.isMobile?P.kQ.SlideUp:P.kQ.Popup,alignmentToOrigin:b.vR.End,renderOrigin:e=>(0,R.jsx)(m.Z,{title:(0,R.jsx)(p.FormattedMessage,{defaultMessage:"Relation",id:"database.viewSettings.rollupOptions.relationProperty"}),disabled:d,showChevron:!0,rotateChevron:E,right:Y.relationPropertySchema?(0,R.jsx)(Z.Z,{propertySchema:Y.relationPropertySchema,showIcon:!0}):(0,R.jsx)(p.FormattedMessage,{id:"database.viewSettings.rollupOptions.selectRelation",defaultMessage:"Select"}),...e}),render:e=>(0,R.jsx)(K,{parent:e,analyticsFrom:u,schema:o,property:r,parentStore:s,onChange:h}),buttonPopupStore:T}),(0,R.jsx)(w.Z,{renderTooltip:()=>(0,R.jsx)(A,{}),disableTooltip:O,render:e=>(0,R.jsx)(b.ZP,{popupType:F.isMobile?P.kQ.SlideUp:P.kQ.Popup,alignmentToOrigin:b.vR.End,renderOrigin:t=>(0,R.jsx)(m.Z,{title:(0,R.jsx)("span",{style:{...!I&&{color:g.mediumTextColor}},children:(0,R.jsx)(p.FormattedMessage,{defaultMessage:"Property",id:"database.viewSettings.rollupOptions.targetProperty"})}),disabled:!O||d,showChevron:!0,rotateChevron:W,right:O&&(Y.targetPropertySchema?(0,R.jsx)(Z.Z,{propertySchema:Y.targetPropertySchema,showIcon:!0}):(0,R.jsx)(p.FormattedMessage,{id:"database.viewSettings.rollupOptions.selectTargetProperty",defaultMessage:"Select"})),...(0,M.Z)(e,t)}),render:e=>(0,R.jsx)(H,{parent:e,analyticsFrom:u,schema:o,property:r,parentStore:s,onChange:h}),buttonPopupStore:v})}),(0,R.jsx)(w.Z,{renderTooltip:()=>(0,R.jsx)(B,{}),disableTooltip:I,render:e=>(0,R.jsx)(b.ZP,{popupType:F.isMobile?P.kQ.SlideUp:P.kQ.Popup,alignmentToOrigin:b.vR.End,renderOrigin:t=>(0,R.jsx)(m.Z,{disabled:!I||d,title:(0,R.jsx)("span",{style:{...!I&&{color:g.mediumTextColor}},children:(0,R.jsx)(p.FormattedMessage,{defaultMessage:"Calculate",id:"database.viewSettings.rollupOptions.calculate"})}),showChevron:!0,rotateChevron:z,right:I&&(0,R.jsx)(L,{schema:o,property:r,parentStore:s}),...(0,M.Z)(e,t)}),render:e=>(0,R.jsx)(U,{parent:e,analyticsFrom:u,schema:o,property:r,parentStore:s,onChange:h}),buttonPopupStore:x})})]})};function V(e,t,o){var r;const a=e[t];if(!a)return;let n,i;if(a.relation_property){const t=e[a.relation_property];t&&"relation"===t.type&&(n=t)}if(n){const e=l.j0(n);i=e?x.NW.createChildStore(o,e):void 0}const s=null===(r=i)||void 0===r?void 0:r.getValue(),d=s?l.oC(s):{};let p;if(s&&a.target_property){var c;p=d[(null===(c=i)||void 0===c?void 0:c.getMappedProperty(a.target_property))??a.target_property]}return{propertySchema:a,relationPropertySchema:n,relatedCollectionValue:s,relatedCollectionSchema:d,targetPropertySchema:p}}function L(e){let{schema:t,property:o,parentStore:r}=e;const a=(0,n.VK)((()=>V(t,o,r)),[r,o,t]);return a?a.propertySchema.aggregation?(0,R.jsx)(R.Fragment,{children:g.VN[(0,s.gu)(a.propertySchema.aggregation)]}):(0,R.jsx)(p.FormattedMessage,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}):null}function A(){return(0,R.jsx)(p.FormattedMessage,{id:"database.rollupProperty.editProperty.tooltip",defaultMessage:"Select an existing relation first."})}function B(){return(0,R.jsx)(p.FormattedMessage,{id:"database.rollupProperty.editAggregate.tooltip",defaultMessage:"Select an existing relation and property first."})}function D(e,t){return e?void 0:(0,d.i)({width:11,fill:t.mediumIconColor})}function z(e){return"relation"===e.type}function E(e){return"rollup"!==e.type&&!l.Eu.includes(e.type)}function K(e){let{parent:t,analyticsFrom:o,schema:n,property:i,parentStore:s,onChange:l}=e;const d=(0,a.O7)(),p=(0,h.Y$)(),c=(0,r.useCallback)((e=>function(e,t,o,r,a,n,i,s){const l=V(r,a,n);if(!l)return;const d={...l.propertySchema,relation_property:e,target_property:"title",target_property_type:"title",aggregation:void 0};null==i||i({propertySchema:d}),u.Zr(t,{...(0,y.Pn)(s),from:o})}(e,d,o,n,i,s,l,p)),[d,o,n,i,s,l,p]);return(0,R.jsx)(O.Z,{schema:n,isRelationProperty:!0,onAccept:c,onClose:t.close,allowProperty:z})}function H(e){let{parent:t,analyticsFrom:o,schema:i,property:s,parentStore:l,onChange:d}=e;const p=(0,a.O7)(),c=(0,h.Y$)(),m=(0,r.useCallback)((e=>function(e,t,o,r,a,n,i,s){const l=V(r,a,n);if(!l||!l.relatedCollectionValue||!l.relatedCollectionSchema)return;const d=l.relatedCollectionSchema[e];if(!d)return;const p={...l.propertySchema,target_property:e,target_property_type:d.type,aggregation:void 0};null==i||i({propertySchema:p}),u.yj(t,{...(0,y.Pn)(s),from:o,property_type:d.type})}(e,p,o,i,s,l,d,c)),[p,o,i,s,l,d,c]),g=(0,n.VK)((()=>V(i,s,l)),[l,s,i]);return g?(0,R.jsx)(O.Z,{isRelationProperty:!1,schema:g.relatedCollectionSchema,onAccept:m,allowProperty:E,onClose:t.close}):null}function U(e){let{parent:t,analyticsFrom:o,schema:i,property:l,parentStore:d,onChange:c}=e;const m=(0,a.O7)(),g=(0,h.Y$)(),f=(0,r.useCallback)((e=>function(e,t,o,r,a,n,i,l){const d=V(r,a,n);if(!d)return;const p={...d.propertySchema,aggregation:e,show_as:void 0};null==i||i({propertySchema:p});const c=e?(0,s.gu)(e):void 0;u.en(t,{...(0,y.Pn)(l),from:o,aggregation:c})}(e,m,o,i,l,d,c,g)),[m,o,i,l,d,c,g]),M=(0,n.VK)((()=>V(i,l,d)),[d,l,i]);return M&&M.propertySchema.target_property?(0,R.jsx)(F.Z,{property:M.propertySchema.target_property,schema:M.relatedCollectionSchema,currentAggregation:M.propertySchema.aggregation?{aggregator:M.propertySchema.aggregation,property:M.propertySchema.target_property}:void 0,onChange:f,onClose:t.close,noneText:(0,R.jsx)(p.FormattedMessage,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}),source:"rollupPropertyMenu"}):null}function $(e,t,o,r,a,n,i,s,l){const{device:d}=e,c=V(r,a,n);if(c)return{key:0,render:e=>(0,R.jsx)(T.Z,{...e,title:(0,R.jsx)(p.FormattedMessage,{id:"database.rollupProperty.editRelation.title",defaultMessage:"Relation"}),isTitleUppercase:!0}),items:[{key:0,render:e=>(0,R.jsx)(b.ZP,{popupType:d.isMobile?P.kQ.SlideUp:P.kQ.Popup,renderOrigin:r=>c.relationPropertySchema?(0,R.jsx)(Y.Z,{...(0,M.Z)(e,r),propertySchema:c.relationPropertySchema,format:Y.L.Name,right:D(o,t),disabled:o}):(0,R.jsx)(v.Z,{...(0,M.Z)(e,r),title:(0,R.jsx)(p.FormattedMessage,{id:"database.rollupProperty.editRelation.buttonTitle",defaultMessage:"Select an existing relationâ€¦"}),right:D(o,t),style:{color:t.mediumTextColor},disabled:o}),render:e=>(0,R.jsx)(K,{parent:e,analyticsFrom:i,schema:r,property:a,parentStore:n,onChange:l}),buttonPopupStore:s},e.key),action:()=>{s.setState({open:!0})}}]}}function q(e,t,o,r,a,n,i,s,l,d){const{device:c}=t,u=V(a,n,i);if(u)return{key:1,render:e=>(0,R.jsx)(T.Z,{...e,title:(0,R.jsx)(p.FormattedMessage,{id:"database.rollupProperty.editProperty.title",defaultMessage:"Property"}),topBorder:!0,isTitleUppercase:!0}),items:[{key:0,render:t=>(0,R.jsx)(w.Z,{renderTooltip:()=>(0,R.jsx)(A,{}),disableTooltip:e,render:m=>(0,R.jsx)(b.ZP,{popupType:c.isMobile?P.kQ.SlideUp:P.kQ.Popup,renderOrigin:a=>u.targetPropertySchema?(0,R.jsx)(Y.Z,{...(0,M.Z)(t,a),propertySchema:u.targetPropertySchema,format:Y.L.Name,right:D(r,o),disabled:r}):(0,R.jsx)(v.Z,{...(0,M.Z)(t,m),title:(0,R.jsx)(p.FormattedMessage,{id:"database.rollupProperty.editProperty.buttonTitle",defaultMessage:"Select a property to displayâ€¦"}),right:D(!e||r,o),disabled:!e||r,disabledFeedback:!0}),render:e=>(0,R.jsx)(H,{parent:e,analyticsFrom:s,schema:a,property:n,parentStore:i,onChange:d}),buttonPopupStore:l})},t.key),action:()=>{l.setState({open:!0})}}]}}function Q(e,t,o,r,a,n,i,s,l,d){const{device:c}=t;if(V(a,n,i))return{key:2,render:e=>(0,R.jsx)(T.Z,{...e,title:(0,R.jsx)(p.FormattedMessage,{id:"database.rollupProperty.editAggregate.title",defaultMessage:"Calculate"}),topBorder:!0,isTitleUppercase:!0}),items:[{key:0,render:t=>(0,R.jsx)(w.Z,{renderTooltip:()=>(0,R.jsx)(B,{}),disableTooltip:e,render:u=>e?(0,R.jsx)(b.ZP,{popupType:c.isMobile?P.kQ.SlideUp:P.kQ.Popup,renderOrigin:e=>(0,R.jsx)(v.Z,{...(0,M.Z)(t,e),title:(0,R.jsx)(L,{schema:a,property:n,parentStore:i}),right:D(r,o),disabled:r}),render:e=>(0,R.jsx)(U,{parent:e,analyticsFrom:s,schema:a,property:n,parentStore:i,onChange:d}),buttonPopupStore:l}):(0,R.jsx)(v.Z,{...(0,M.Z)(t,u),title:(0,R.jsx)(p.FormattedMessage,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}),right:D(r,o),disabled:!0,disabledFeedback:!0})},t.key),action:()=>{l.setState({open:!0})}}]}}},873456:(e,t,o)=>{o.d(t,{Z:()=>B});o(757658);var r=o(667294),a=o(800480),n=o(886628),i=o(749085),s=o(399036),l=o(984619),d=o(196711),p=o(780926),c=o(937612),u=o(606287),m=o(709291),h=o(531701),g=o(653965),y=o(137810),f=o(436610),M=o(547307),S=o(217095),x=o(127871),v=o(18533),b=o(566890),j=o(492658),k=o(368585),C=o(460709),P=o(223196),T=o(374617),w=o(693405),Z=o(268894),F=o(478140),Y=o(632163),O=o(840721),R=o(953437),_=o(672495),I=o(409050),V=o(122084),L=o(785893);const A=i.default.createClass(!1,{name:"ShowSelectDescriptionStore"});const B=function(e){let{onClose:t,collectionId:o,propertySchema:i,property:s,onChange:l,option:d,analyticsFrom:p,statusGroup:c,origin:u,open:m,alignmentToOrigin:h}=e;const g=(0,a.O7)(),y=(0,n.qz)(void 0,A),f=(0,n.qz)(void 0,j.Z),M=(0,r.useRef)(m);(0,r.useEffect)((()=>{!M.current&&m&&f.setState({...f.state,inputValue:d.value}),M.current=m}),[m,d.value,f]);const S=(0,r.useCallback)((()=>(0,L.jsx)(z,{onClose:t,collectionId:o,propertySchema:i,property:s,onChange:l,option:d,analyticsFrom:p,statusGroup:c,renameInputStore:f,showSelectDescriptionStore:y})),[t,o,i,s,l,d,p,c,f,y]),x=(0,r.useCallback)((()=>function(e,t,o,r,a,n,i){e(),D(t,o,r,a,n,i)}(t,o,i,s,l,d,f)),[t,o,i,s,l,d,f]),{device:v}=g;return(0,L.jsx)(R.ZP,{popupType:v.isMobile?P.k.SlideUp:P.k.Popup,open:m,onDismiss:x,origin:u,render:S,alignmentToOrigin:h})};function D(e,t,o,r,a,n){const i=n.state.inputValue,s=t.options||[],l=s.find((e=>e.id!==a.id&&e.value.trim().toLowerCase()===i.trim().toLowerCase()));if(a.value!==i)if(i)if(l)M.showErrorMessage((0,L.jsx)(m.FormattedMessage,{defaultMessage:"This select option already exists.",id:"database.editProperty.errorDialog.duplicateSelectValue.message"}));else{const n=s.find((e=>e.id===a.id));if(!n)return;const l=i.trim(),d={...n,value:l},p={pointer:{table:u.vF,id:e},command:"keyedObjectListUpdate",path:["schema",o,"options"],args:{value:d}},c="status"===t.type&&a.value===t.defaultOption?{pointer:{table:u.vF,id:e},command:"update",path:["schema",o],args:{defaultOption:l}}:void 0;r(g.oA([p,c]))}else M.showErrorMessage((0,L.jsx)(m.FormattedMessage,{defaultMessage:"Please type a value.",id:"database.editProperty.errorDialog.missingSelectValue.message"}))}function z(e){let{onClose:t,collectionId:o,propertySchema:i,property:g,onChange:j,option:P,analyticsFrom:R,statusGroup:A,renameInputStore:B,showSelectDescriptionStore:z}=e;const E=(0,m.useIntl)(),K=(0,a.O7)(),H=(0,b.Y$)(),U=(0,r.useCallback)((e=>function(e,t){const o=e.target.value.replace(/,/g,"");t.setState({...t.state,inputValue:o}),t.emit()}(e,B)),[B]),$=(0,r.useCallback)((()=>function(e,t,o,r,a,n,i){e(),D(t,o,r,a,n,i)}(t,o,i,g,j,P,B)),[t,o,i,g,j,P,B]),q=(0,r.useCallback)((()=>function(e,t,o,r,a,n,i,l,d,p){"status"!==n.type||t.value!==n.defaultOption?M.showDialog({showCancel:!0,keepFocus:!1,message:(0,L.jsx)(m.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.deleteModal.prompt",defaultMessage:"Are you sure you want to delete this option?"}),items:[{label:(0,L.jsx)(m.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.deleteModal.confirmButton",defaultMessage:"Delete"}),color:"red",onAccept:()=>{if(!s.cu(n)&&"status"!==n.type)return;const c={table:u.vF,id:o},m=[],h={pointer:c,command:"keyedObjectListRemove",path:["schema",i,"options"],args:{remove:{id:t.id}}};if(m.push(h),d&&"status"===n.type){const e=(n.groups??[]).findIndex((e=>e.id===d.id)),o={pointer:c,command:"listRemove",path:["schema",i,"groups",e,"optionIds"],args:{id:t.id}};m.push(o)}r(m),l(),f.$q(e,{...(0,k.Pn)(p),property_type:n.type,action:"select_delete_option",from:a})}}]}):M.showErrorMessage((0,L.jsx)(m.FormattedMessage,{defaultMessage:"Cannot delete default option.",id:"database.editProperty.errorDialog.forbidDeleteDefaultOption.message"}))}(K,P,o,j,R,i,g,t,A,H)),[K,P,o,j,R,i,g,t,A,H]),{device:Q}=K,W=(0,n.VK)((()=>z.state),[z]),N=(0,n.VK)((()=>B.state.inputValue),[B]),G=[];W&&G.push({key:"description",render:e=>(0,L.jsx)(_.Z,{...e,desktopStyle:{paddingTop:0},title:Q.isMobile?E.formatMessage(x.k.descriptionHeader):void 0}),items:[{key:"description",render:e=>(0,L.jsx)(x.i,{...e,initialDescription:P.description,handleSaveDescription:e=>function(e,t,o,r,a,n,i,s){if(e===(s.description??""))return;const l={...s,description:e};o([{pointer:{table:u.vF,id:r},command:"keyedObjectListUpdate",path:["schema",a,"options"],args:{value:l}}]),f.$q(t,{property_type:n.type,action:"select_set_description",from:i})}(e,K,j,o,g,i,R,P),disableAutoSection:!0}),action:()=>{}}]});const J={key:"action",render:e=>(0,L.jsx)(_.Z,{...e}),items:[]};G.push(J),J.items.push({key:"delete",render:e=>(0,L.jsx)(w.Z,{...e,title:(0,L.jsx)(m.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.deleteLabel",defaultMessage:"Delete"}),svg:c.y}),action:q}),A&&"status"===i.type&&(J.items.push({key:"setAsDefault",render:e=>(0,L.jsx)(w.Z,{...e,title:(0,L.jsx)(m.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.setAsDefault",defaultMessage:"Set as default"}),svg:p.z}),action:()=>async function(e,t,o,r,a,n,i,s,l){if("status"!==o.type||!l)return;if(n.value===o.defaultOption)return;if(void 0!==o.defaultOption&&!(await M.confirmUserAction({message:(0,L.jsx)("span",{children:(0,L.jsx)(m.FormattedMessage,{defaultMessage:"Change default to <b>{defaultValue}</b>?",id:"database.editProperty.setAsDefault.confirm.title",values:{defaultValue:n.value,b:e=>(0,L.jsx)("span",{style:{fontWeight:y.Z.fontWeight.semibold},children:e})}})}),description:(0,L.jsx)("span",{children:(0,L.jsx)(m.FormattedMessage,{defaultMessage:"New pages will start with {defaultValue} as the default status. Existing pages <b>without a status explicitly set</b> will switch to {defaultValue}.",id:"database.editProperty.setAsDefault.confirm.description",values:{defaultValue:n.value,b:e=>(0,L.jsx)("span",{style:{fontWeight:y.Z.fontWeight.semibold},children:e})}})}),acceptLabel:(0,L.jsx)(m.FormattedMessage,{defaultMessage:"Continue",id:"database.editProperty.setAsDefault.confirm.continueButton"})})))return;const d=[],p={pointer:{table:u.vF,id:e},command:"update",path:["schema",t],args:{defaultOption:n.value}};d.push(p),r(d),i(),f.$q(s,{property_type:o.type,action:"status_set_default",from:a,collection_id:e})}(o,g,i,j,R,P,t,K,A)}),J.items.push({key:"Group",render:e=>(0,L.jsx)("div",{...e,children:(0,L.jsx)(v.Z,{...e,title:(0,L.jsx)(m.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.Group",defaultMessage:"Group"}),selectedKey:A.name,options:(i.groups??[]).map((e=>({key:e.name,title:T.ZA[e.name]??e.name}))),icon:e=>(0,d.V)({...e,width:16,marginRight:0}),onChange:e=>{!function(e,t,o,r,a,n,i,s,l){if("status"!==i.type||!l)return;const d={table:u.vF,id:t},p=[],c=i.groups??[],m=c.findIndex((e=>e.id===l.id)),h=c.findIndex((t=>t.name===e));if(m===h)return;const g={pointer:d,command:"listRemove",path:["schema",r,"groups",m,"optionIds"],args:{id:o.id}},y={pointer:d,command:"listAfter",path:["schema",r,"groups",h,"optionIds"],args:{id:o.id}};p.push(g,y);const M=i.options??[],S=c.flatMap((e=>{const t=e.optionIds??[],o=M.filter((e=>t.includes(e.id)));return o})),x={pointer:d,command:"set",path:["schema",r,"options"],args:S};p.push(x),a(p),f.$q(s,{property_type:i.type,action:"status_set_default",from:n,collection_id:t})}(e,o,P,g,j,R,i,K,A)}})}),action:()=>{}}));const X=h.AP.map((e=>{const t={key:e,render:t=>(0,L.jsx)(I.Z,{...t,color:e,checkState:P.color===e}),action:()=>{!function(e,t,o,r,a,n,i,s){const l={...t,color:e};n([{pointer:{table:u.vF,id:o},command:"keyedObjectListUpdate",path:["schema",r,"options"],args:{value:l}}]),f.$q(s,{property_type:a.type,action:"select_change_color",from:i,collection_id:o})}(e,P,o,g,i,j,R,K)}};return t})),ee={key:"color",render:e=>(0,L.jsx)(_.Z,{...e,title:(0,L.jsx)(m.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.colorsSection",defaultMessage:"Colors"}),isTitleUppercase:!0,topBorder:!0}),items:X};let te;return G.push(ee),te=Q.isMobile?{menuType:C.og.Modal,title:(0,L.jsx)(V.a,{format:l.lo.Large,value:P.value,color:P.color,showRemoveButton:!1,isSingle:!0}),right:(0,L.jsx)(O.DoneMenuText,{}),onClickRight:$}:{menuType:C.og.Popup,width:220},(0,L.jsxs)(F.Z,{...te,children:[(0,L.jsx)(_.Z,{isInput:!0,children:(0,L.jsx)(Z.ZP,{focusInitial:!0,selectAll:!Q.isMobile,value:N,maxlength:180,onChange:U,onSubmit:$,showClearButton:!1,inputRight:(0,L.jsx)(S.l,{onClick:()=>z.setState(!W),description:P.description,showTooltip:!W})})}),(0,L.jsx)(Y.Z,{type:Y.i.Vertical,disableKeyboard:!0,initialFocus:void 0,sections:G})]})}},872589:(e,t,o)=>{o.d(t,{Z:()=>E});var r=o(667294),a=o(118466),n=o(800480),i=o(886628),s=o(724405),l=o(453809),d=o(435011),p=o(984619),c=o(173110),u=o(773717),m=o(877097),h=o(335102),g=o(842875),y=o(966673),f=o(44643),M=o(755964),S=o(430548),x=o(959753),v=o(709291),b=o(940470),j=o(137810),k=o(436610),C=o(566890),P=o(368585),T=o(433929),w=o(460709),Z=o(573807),F=o(825464),Y=o(80444),O=o(219629),R=o(630752),_=o(508606),I=o(753876),V=o(573063),L=o(478140),A=o(526388),B=o(887986),D=o(785893);const z=200;function E(e){var t,o,s,l;const{property:p,disabled:m,formulas:f,getRecordModel:M,propertySchema:S,collectionStore:v,handleSave:j,handleClose:F,blockStore:O,analyticsFrom:R}=e,_=(0,n.O7)(),I=(0,C.Y$)(),[V,A]=(0,r.useState)(null==S||null===(t=S.formula2)||void 0===t?void 0:t.code),E=(0,y.Kt)(V,z,Object.is),[H,$]=(0,r.useState)(),q=(0,r.useRef)(null===(o=S.formula2)||void 0===o?void 0:o.code),Q=(0,r.useRef)(V),W=(0,r.useRef)(null==S||null===(s=S.formula2)||void 0===s?void 0:s.result_type),N=(0,r.useCallback)((e=>{Q.current=e,A(e)}),[]),G=(0,r.useCallback)((e=>{W.current=e}),[]),[J,X]=(0,r.useState)((()=>a.Z.withListenerIgnored((()=>U.state??!1)))),[ee,te]=(0,r.useState)([]),oe=(0,n.Fy)();(0,r.useEffect)((()=>()=>{const e=q.current,t=Q.current,o=W.current;t===e&&void 0===ie||(j({newValue:t,newType:(0,d.x9)(o??{type:"unknown"}),propertySchema:S,collectionStore:v,property:p}),k.$q(_,{...(0,P.Pn)(I),property_type:S.type,action:"formula_v2_edit",from:R}))}),[]);const re=(0,i.VK)((()=>v.pointer),[v.pointer]),ae=(0,r.useMemo)((()=>{const e={type:"block",collection:re};return{kind:c.yp.ThisRow,type:e}}),[re]),ne=(0,r.useMemo)((()=>{const e=x.s8.fromGetRecordModelFn(M);return{sourceProperty:p,valueTypes:[ae],handleDataRequest:f.createFormulaDataRequestHandler(M,e),formulaPropertyNames:V&&(0,h.Ny)(V)}}),[V,f,M,p,ae]),ie=(0,i.VK)((()=>{if("v2"!==S.version&&S.formula)return f.convertCollectionFormulaToFormula2(S.formula,re,v.getSchema())}),[re,v,f,S.formula,S.version]),se=(0,r.useRef)(!1);(0,r.useEffect)((()=>{!async function(){if(!ie||se.current)return;const e=await f.analyzeFormula(ie,ne);let t;t=b.x.isFail(e)?{type:"unknown"}:e.value.type??{type:"unknown"},se.current=!0,N(ie),G(t)}()}),[v,f,N,G,p,S,ie,ne]);const le=(0,r.useMemo)((()=>{var e;const t="v2"===S.version?null===(e=S.formula2)||void 0===e?void 0:e.code:ie;return q.current=t,t}),[null===(l=S.formula2)||void 0===l?void 0:l.code,S.version,ie]),de=(0,i.VK)((()=>{var e;return null===(e=Y.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),pe=(0,Z._)(),ce=(0,i.VK)((()=>{te([]);const e=v.getModel(),t=null==O?void 0:O.getModel(),o=null==O?void 0:O.getRecordModel;if(!(t&&e&&E&&o))return;const r=J?(0,d.lH)({block:t,property:p,formulaCode:E,getRecordModel:o,intl:T.default.getIntl(),userTimeZone:(0,g.r)(),depth:0,visitedProperties:new Set,formulaTimeoutTimestampMs:Date.now()+pe,resultCache:new Map}):(0,d.NM)({block:t,property:p,formulaCode:E,getRecordModel:o,intl:T.default.getIntl(),userTimeZone:(0,g.r)(),depth:0,visitedProperties:new Set,formulaTimeoutTimestampMs:Date.now()+pe,resultCache:new Map});if(r){if(!b.x.isFail(r))return $(W.current),r.value;(0,u.y_)(r.error)&&te([r.error])}}),[v,O,E,J,p,pe]);return ne&&de?(0,D.jsx)(L.Z,{menuType:oe.isMobile?w.og.Modal:w.og.Popup,hideMobileTopbar:!0,width:oe.isMobile?void 0:740,disableBottomPadding:!0,maxHeight:"unset",disableHeaderBorder:!0,disableScroller:!0,children:(0,D.jsx)(B.Z,{initialCode:le,outputFooter:void 0!==O&&(0,D.jsx)(K,{formulaResult:ce,isAdvancedMode:J,setIsAdvancedMode:X,formulaType:H,blockStore:O,formulaSchema:S}),formulas:f,getRecordModel:M,focus:!0,disabled:m,parentSpaceId:de,typecheckContext:ne,onCodeChange:N,onTypeChange:G,handleClose:F,parentCollectionStore:v,evaluationErrors:ee})}):null}const K=r.memo((function(e){let{formulaResult:t,formulaType:o,blockStore:a,formulaSchema:n,isAdvancedMode:i,setIsAdvancedMode:l}=e;const c=(0,s.yK)((e=>({output:{display:"flex",alignItems:"center",zIndex:1,fontSize:j.Z.fontSize.UISmall.desktop,height:38,padding:10,width:"100%",borderTop:`1px solid ${e.outlineButtonBorder}`,overflow:"hidden"},equals:{fontSize:j.Z.fontSize.UIRegular.desktop,color:e.mediumTextColor,marginRight:6,marginLeft:2},type:{fontSize:j.Z.fontSize.UISmall.desktop,color:e.mediumTextColor,marginLeft:6},iconStyle:{height:16,width:16},iconButtonStyle:{marginLeft:"auto"}})),[]),u=(0,r.useMemo)((()=>({baseStyles:{sizing:"small",tokenFormat:p.lo.Small,textStyle:{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},tokenWrapStyle:{display:"flex",flexWrap:"nowrap",...I.RQ[p.lo.Medium]}},store:a,isEmpty:!1,isReadOnly:!0,shouldRenderTooltip:!1,shouldWrap:!1,collectionContextStore:void 0,templateVariableContext:void 0,property:void 0,propertyFormat:void 0,propertySchema:i?void 0:n,trackEditBlockProperty:()=>{},format:0,containerRef:null})),[a,n,i]),h=(0,r.useMemo)((()=>o?(0,d.Z5)(o):m.l7.unknown),[o]);return(0,D.jsx)(_.O.Provider,{value:u,children:(0,D.jsxs)("div",{style:c.output,children:[(0,D.jsx)("span",{style:c.equals,children:"="}),t&&(0,D.jsx)(H,{value:t,withComma:!1,blockStore:a,formulaSchema:n,isAdvancedMode:i,renderWrapper:!0}),i&&Boolean(t)&&(0,D.jsx)("span",{style:c.type,children:(0,D.jsx)(v.FormattedMessage,{...h})}),(0,D.jsx)(A.Z,{renderTooltip:()=>i?(0,D.jsx)(v.FormattedMessage,{defaultMessage:"Hide details",id:"formulas.editor.toggleAdvancedModeOff"}):(0,D.jsx)(v.FormattedMessage,{defaultMessage:"Show details",id:"formulas.editor.toggleAdvancedModeOn"}),placement:F.u.Top,alignment:F.v.Center,render:e=>(0,D.jsx)(V.Z,{icon:i?f.L:M.N,onClick:()=>{const e=!i;l(e),U.setState(e)},iconStyle:c.iconStyle,style:c.iconButtonStyle,ariaLabel:"Toggle advanced mode on formula editor",...e})})]})})})),H=r.memo((function e(t){let{value:o,withComma:a,blockStore:n,formulaSchema:l,isAdvancedMode:d,renderWrapper:p}=t;const[c,u]=(0,i.VK)((()=>{var e;if(!o)return[[],"text"];if("undefined"===o.type&&d)return[[O.eL],"empty"];const t=(0,R.$I)(o,n.getRecordModel,(0,g.r)());return[t,(null===(e=t[0])||void 0===e?void 0:e.type)??"text"]}),[n.getRecordModel,d,o]),m=(0,s.yK)((e=>({rightBracket:{color:e.mediumTextColor,fontSize:j.Z.fontSize.UISmall.desktop,marginLeft:2},leftBracket:{color:e.mediumTextColor,fontSize:j.Z.fontSize.UISmall.desktop,marginRight:2},comma:{color:e.mediumTextColor,fontSize:j.Z.fontSize.UISmall.desktop,marginRight:2}})),[]);let h;if("array"===o.type)h=(0,D.jsxs)(r.Fragment,{children:[d?(0,D.jsx)("span",{style:m.leftBracket,children:"["}):null,o.values.map(((t,r)=>(0,D.jsx)(e,{value:t,withComma:r<o.values.length-1,blockStore:n,formulaSchema:l,isAdvancedMode:d,renderWrapper:!1},r))),d?(0,D.jsx)("span",{style:m.rightBracket,children:"]"}):null,a?(0,D.jsx)("span",{style:m.comma,children:", "}):""]});else{const e=a&&!d&&(0,O.vQ)(u,l);h=null==c?void 0:c.map(((t,o)=>(0,D.jsxs)(r.Fragment,{children:[(0,D.jsx)(O.gZ,{token:t,targetPropertySchema:l,blockStore:n,withComma:e,numberRightAlign:!1}),d&&a?(0,D.jsx)("span",{style:m.comma,children:", "}):null]},`${t.id}-${o}`)))}return p&&!d?(0,D.jsx)(O.E1,{propertyType:u,rootPropertySchema:l,numberRightAlign:!1,children:h}):(0,D.jsx)(r.Fragment,{children:h})})),U=new l.D({key:"formulas_show_details",namespace:S.$p,important:!0,trackingType:"preference"})},220603:(e,t,o)=>{o.d(t,{z:()=>s});o(667294);var r=o(724405),a=o(552275),n=o(629551),i=o(785893);function s(e){const{icon:t,name:o,subText:s,...l}=e,d=(0,r.yK)((e=>({iconContainer:{background:e.white,border:`1px solid ${e.accentColors.gray[100]}`,minWidth:32,width:32,height:32,borderRadius:4},buttonMenuItem:{padding:6},subText:{color:e.lightTextColor,fontSize:12}})),[]);return(0,i.jsx)(a.Z,{...l,buttonStyle:{margin:0},style:d.buttonMenuItem,itemMarginLeft:0,title:(0,i.jsxs)(n.gq,{gap:8,alignItems:"center",children:[(0,i.jsx)(n.gq,{style:d.iconContainer,alignItems:"center",justifyContent:"center",children:t}),(0,i.jsxs)(n.Ht,{children:[(0,i.jsx)("span",{children:o}),s?(0,i.jsx)("span",{style:d.subText,children:s}):null]})]})})}},312775:(e,t,o)=>{o.d(t,{R:()=>c});o(667294);var r=o(886628),a=o(724405),n=o(180951),i=o(12396),s=o(623879),l=o(152840),d=o(220603),p=o(785893);function c(e){const{propertyId:t}=e,{collectionStore:o}=(0,l.J9)(),c=(0,a.Fg)(),u=(0,r.VK)((()=>{if(!o)return;const e=o.getSchema();return(0,n.Qm)({schema:e,property:t})}),[o,t]);if(!u)return null;const m=u.type;return(0,p.jsx)(d.z,{...e,icon:(0,p.jsx)(i.ZP,{size:16,theme:c,icon:u.icon,type:m}),name:u.name,subText:s.SO[m]})}},446737:(e,t,o)=>{o.d(t,{c:()=>d});var r=o(667294),a=o(724405),n=o(12396),i=o(623879),s=o(220603),l=o(785893);function d(e){let{actionHandler:t}=e;const o=(0,a.Fg)();return(0,r.useCallback)((e=>({key:e,keywords:[i.SO[e]],render:t=>{let{ref:r,...a}=t;return(0,l.jsx)(s.z,{icon:(0,l.jsx)(n.ZP,{size:16,theme:o,type:e,icon:void 0}),name:i.SO[e],...a})},action:()=>{t(e)}})),[t,o])}},152489:(e,t,o)=>{o.d(t,{Z:()=>n});var r=o(749085);class a extends r.default{getInitialState(){return{isModalOpen:!1,collectionContextStore:void 0}}}const n=new a},111843:(e,t,o)=>{o.d(t,{E:()=>i,S:()=>n});var r=o(640506);const a={"de-DE":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"da-DK":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"fi-FI":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"nb-NO":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"nl-NL":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"sv-SE":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"en-US":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"es-ES":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"es-LA":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"fr-FR":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"pt-BR":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"},"ko-KR":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"YYYY[ë…„] MMMM"},"zh-CN":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"YYYY[å¹´]MMM"},"zh-TW":{time:{"12h":"LT","24h":"H:mm",hidden:r.n3},month:"YYYY[å¹´]MMM"},"ja-JP":{time:{"12h":"A h:mm","24h":"H:mm",hidden:r.n3},month:"YYYY[å¹´]MMM"},pseudo:{time:{"12h":"A h:mm","24h":"H:mm",hidden:r.n3},month:"MMMM YYYY"}},n=["de-DE","fr-FR"];function i(e){return a[e]}}}]);