"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[1352],{480671:(e,t,n)=>{n.d(t,{Cl:()=>h,jw:()=>S,k2:()=>_,v5:()=>g});n(21703);var o=n(471924),s=n(772141),a=n(519889),r=n(590965),i=n(500896),u=n(712139),c=n(653965),d=n(286572),p=n(206258),l=n(88893),f=n(163423),m=n(288280);function _(e){f.Z.setState({open:!0,addOnFeature:e,stage:"limit_reached",addOnUpgradeId:o.Il(),tax:0})}function g(){f.Z.setState({open:!1})}function h(e){const t=f.Z.state;t.open&&f.Z.setState({...t,stage:"confirm_purchase",coupon:e&&!(0,i.$v)(e)?e:void 0})}async function S(e){const{environment:t,spaceStore:n,from:o}=e,i=function(){const e=m.subscriptionDataStoreInstance.state,t=(e?l.CM(e):[]).filter((e=>(0,r.nB)(e)&&(0,s.zz)(e.role))).map((e=>e.userId));if(!t||0===t.length)throw new Error("No admins found in the current space");return(0,c.UP)(t)}(),f=n.getName(),_=p.U6.createChildStore(n,{table:a.KJ,id:i});await _.load();const g=_.getEmail();g?d.bf(t,{admin_id:i,admin_email:g,space_name:f,from:o}):u.IE(new Error("Could not get email for admin in sendMemberRequestForAddOn"))}},71487:(e,t,n)=>{n.d(t,{AG:()=>c,an:()=>d,yY:()=>u});var o=n(709291),s=n(454642),a=n(547307),r=n(433929);const i=(0,o.defineMessages)({invalidCoupon:{id:"applyCoupon.error.invalidCoupon",defaultMessage:"Unable to apply the coupon to your account."}});async function u(e,t){const{customerId:n,offerType:o}=t,r=await s.getCustomerOffer(e,{customerId:n,newPlan:"downgrade_flow"===o?t.newPlan:void 0,offerType:o});if("failed"===r.type)a.showError(r);else{const e=r.data;if(e.offerType===o)return e.coupon}}async function c(e,t){const{customerId:n,coupon:o,offerType:u}=t;if(!o)return void a.showErrorMessage(r.default.formatMessage(i.invalidCoupon));const c=await s.applyCustomerOffer(e,{customerId:n,newPlan:"downgrade_flow"===u?t.newPlan:void 0,offerType:u,coupon:o});"failed"===c.type&&a.showError(c)}async function d(e){const{environment:t,spaceId:n}=e,o=await s.getCustomerOfferEligibility(t,{spaceId:n});return"failed"!==o.type&&o.data.isEligible}},308956:(e,t,n)=>{n.r(t),n.d(t,{AIAddOnDiscountPopup:()=>A});var o=n(667294),s=n(800480),a=n(886628),r=n(724405),i=n(292595),u=n(11751),c=n(803791),d=n(500896),p=n(709291),l=n(286572),f=n(210228),m=n(237181),_=n(296994),g=n(548779),h=n(80444),S=n(480671),y=n(71487),w=n(170060),b=n(843163),v=n(88893),M=n(535057),C=n(288280),P=n(785893);function A(){const e=(0,s.O7)(),[t,n]=o.useState(void 0);(0,o.useEffect)((()=>{(0,i.exposeDebugValue)("resetAddOnDiscountPopup",(()=>{const{currentUserSettingsStore:t}=h.default.state;t&&f.createAndCommit({userAction:"AddOnDiscountPopup.resetAddOnPromoPopup",environment:e,perform:e=>{m.d2({userSettingsStore:t,transaction:e,data:{seen_ai_discount_popup:!1}})}})}))}),[e]);const{currentUserSettingsStore:A,currentSpaceStore:I}=(0,a.VK)((()=>{const{currentUserSettingsStore:e,currentSpaceStore:t}=h.default.state;return{currentUserSettingsStore:e,currentSpaceStore:t}}),[]),O=(0,a.VK)((()=>C.subscriptionDataStoreInstance.state),[]);(0,o.useEffect)((()=>{!async function(){var t;if(!I)return;if(!O)return;if(!(0,v.GJ)(O))return;if("unsubscribed_admin"!==O.type&&"subscribed_admin"!==O.type)return;if("stripe"!==(null===(t=O.customerData)||void 0===t?void 0:t.activeSubscriptionPlatform)||!O.customerData.stripe.isSubscribed)return;const o=v.XX(O);if((0,c.de)(null==o?void 0:o.addOns))return;const s=null!=o&&o.customerId?await y.yY(e,{offerType:"add_on_upgrade_flow",customerId:o.customerId}):void 0;(0,d.pp)(s)&&n(s)}()}),[e,I,O]);const x=(0,o.useCallback)((()=>{A&&(f.createAndCommit({userAction:"AddOnDiscountPopup.markSeen",environment:e,perform:e=>{m.d2({userSettingsStore:A,transaction:e,data:{seen_ai_discount_popup:!0}})}}),l.j(e,{name:"add_on_discount_popup_dismissed"}))}),[A,e]),E=(0,o.useCallback)((()=>{t&&(S.k2("ai"),S.Cl(t))}),[t]),D=(0,a.VK)((()=>!(!(0,d.pp)(t)||!(0,w.px)(e,(0,M.zt)())||(0,g.CV)(I))),[t,e,I]),j=(0,r.yK)((e=>({icon:{width:20,height:20,fill:e.accentColors.purple[400]}})),[]);return D?(0,P.jsx)(_.u8,{calloutId:"add_on_discount_popup",initialPromo:{icon:u.t,iconStyle:j.icon,header:(0,P.jsx)(p.FormattedMessage,{id:"AddOnDiscountPopup.header",defaultMessage:"Add unlimited AI for {percentage} off?",values:{percentage:(0,d.pp)(t)?(0,b.o)(t):void 0}}),description:(0,P.jsx)(p.FormattedMessage,{id:"AddOnDiscountPopup.description",defaultMessage:"Project management is better with Notion AI. Add it on top of your paid plan with half off."})},steps:[],seenFeatureUserSetting:"seen_ai_discount_popup",userSettingsStore:A,allowExternalMouseEvents:!0,onDismiss:x,onTryFeatureClick:E,isUserEligible:D,onPopupSeen:()=>l.j(e,{name:"add_on_discount_popup_seen"}),onLearnMore:()=>{t&&E(),x()},ctaMessage:(0,P.jsx)(p.FormattedMessage,{id:"AddOnDiscountPopup.purchase.button",defaultMessage:"Claim your deal"})}):null}},843163:(e,t,n)=>{n.d(t,{W:()=>i,o:()=>r});n(667294);var o=n(709291),s=n(401898),a=n(785893);function r(e){switch(e){case"team_three_months":case"ai_fifty_percent":return(0,a.jsx)(o.FormattedMessage,{id:"coupon.percentage.fiftyPercent",defaultMessage:"50%"});case"team_annual":case"business_three_months":case"business_annual":case"enterprise_three_months":case"enterprise_annual":return(0,a.jsx)(o.FormattedMessage,{id:"coupon.percentage.tenPercent",defaultMessage:"10%"});default:(0,s.t1)(e)}}function i(e){switch(e){case"team_annual":case"business_annual":case"enterprise_annual":return(0,a.jsx)(o.FormattedMessage,{id:"coupon.duration.twelveMonths",defaultMessage:"12 months"});case"team_three_months":case"business_three_months":case"enterprise_three_months":case"ai_fifty_percent":return(0,a.jsx)(o.FormattedMessage,{id:"coupons.duration.threeMonths",defaultMessage:"3 months"})}}}}]);