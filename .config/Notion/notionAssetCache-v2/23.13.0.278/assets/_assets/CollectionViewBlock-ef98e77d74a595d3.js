"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[53190,55061],{766461:(e,t,o)=>{o.d(t,{BO:()=>f,Ft:()=>h,YG:()=>m,y$:()=>g});o(757658);var r=o(730120),i=o(830823),n=o(640506),s=o(253877),l=o(842875),a=o(959753),c=o(709291),d=o(653965),u=o(628020),p=o(840863);function h(e){const{collectionContextStore:t}=e,o=t.collectionViewStore();if(!o)return;const r=t.normalizedSchemaStore.state,i=o.getQuery(r);if(!i||!i.calendar_by)return;const n=t.dateRangeStartStore.state,a=t.dateRangeEndStore.state,c=(0,s.hT)(n,(0,l.r)()),d=(0,s.hT)(a,(0,l.r)());return S({calendarBy:i.calendar_by,dateRangeStartDate:c,dateRangeEndDate:d})}function m(e){const{collectionContextStore:t,startOfDay:o}=e,i=t.collectionViewStore();if(!i)return;const n=t.normalizedSchemaStore.state,a=i.getQuery(n);if(!a||!a.calendar_by)return;const c=r.ou.fromMillis(o).endOf("day").valueOf(),d=(0,s.hT)(o,(0,l.r)()),u=(0,s.hT)(c,(0,l.r)());return S({calendarBy:a.calendar_by,dateRangeStartDate:d,dateRangeEndDate:u})}function S(e){const{dateRangeStartDate:t,dateRangeEndDate:o,calendarBy:r}=e;return{type:"results",filter:{operator:"and",filters:[{property:r,filter:{operator:"date_is_on_or_after",use_end:!0,value:{type:"exact",value:t}}},{property:r,filter:{operator:"date_is_on_or_before",value:{type:"exact",value:o}}}]},limit:5e3}}function g(e){var t;const{collectionContextStore:o,results:r,getRecordValue:i,intl:a}=e,c=o.collectionViewStore(),h=o.normalizedQueryStore.state,m=o.normalizedSchemaStore.state,S=h?h.calendar_by:void 0,g=o.dateRangeStartStore.state,v=o.dateRangeEndStore.state,y=(null===(t=o.collectionViewStore())||void 0===t?void 0:t.getFormat().calendar_show_weekends)??!0,x=u.AK.state,b=(0,l.r)(),w=o.getCurrentUserId();if(!(c&&h&&S&&m))return;const k=new Map,T=d.oA(r.map((e=>f({blockStore:e,calendarBy:S,schema:m,getRecordValue:i,userId:w,intl:a,resultCache:k})))),_={};r.forEach(((e,t)=>{_[e.id]=t}));0===(h.sort||[]).length&&T.sort(((e,t)=>{const o=e.start.valueOf(),r=t.start.valueOf();if(o===r){return _[e.id]-_[t.id]}return o-r}));const V=y?(0,s.em)(g,x,b):(0,s.Ty)(g,x,b),O=y?(0,s.gQ)(v,x,b):(0,s.Kw)(v,x,b);let M=V;const P=[];do{const e=y?(0,s.gQ)(M.valueOf(),x,b):(0,s.Kw)(M.valueOf(),x,b),t={},o=T.filter((t=>(0,n.b8)(M.valueOf(),e.valueOf(),t.start.valueOf(),t.end?t.end.valueOf():void 0))).map((o=>{const{id:r,start:i,end:n,includeTime:s,timeZone:l}=o,{startColumn:a,columnCount:c}=(0,p.du)({startUnixTimestampMS:i.valueOf(),endUnixTimestampMS:n?n.valueOf():void 0,startOfWeekUnixTimestampMS:M.valueOf(),endOfWeekUnixTimestampMS:e.valueOf()}),d=C(a,c,t);return{id:r,start:i.valueOf(),end:n?n.valueOf():void 0,row:d,includeTime:s,timeZone:l}}));P.push({start:M.valueOf(),end:e.valueOf(),items:o}),M=y?(0,s.em)(M.plus({week:1}).plus({hour:25}).valueOf(),x,b):(0,s.Ty)(M.plus({week:1}).plus({hour:25}).valueOf(),x,b)}while(M<O);return P}function f(e){const{blockStore:t,calendarBy:o,schema:r,getRecordValue:n,intl:c,userId:d,resultCache:u}=e,p=t.getAssociatedCollectionStore(),h=t.getModel();if(!h)return;const m=(0,i.FT)({property:o,schema:r,block:h,getRecordModel:a.om.fromGetRecordValueFn(n),propertyMapping:null==p?void 0:p.getPropertyMapping(),collectionRequestContext:{userId:d,userTimeZone:(0,l.r)(),depth:0,intl:c,visitedProperties:new Set,resultCache:u}}).next().value;if("date"!==m.type)return;const S=m.value,g=S&&(0,s.NK)(S,(0,l.r)());if(!S||!g)return;return{id:h.id,start:g.start,end:g.end,includeTime:"datetime"===S.type||"datetimerange"===S.type,timeZone:"datetime"===S.type||"datetimerange"===S.type?S.time_zone:void 0}}function C(e,t,o){let r=0;for(;;){let i=!1;for(let n=0;n<t;n++)v(o,e+n,r)&&(i=!0);if(!i)break;r++}for(let i=0;i<t;i++)y(o,e+i,r);return r}function v(e,t,o){return Boolean(e[o]&&e[o][t])}function y(e,t,o){e[o]||(e[o]={}),e[o][t]=!0}(0,c.defineMessages)({week:{defaultMessage:"Week",id:"calendar.viewRanges.week"},month:{defaultMessage:"Month",id:"calendar.viewRanges.month"}})},336597:(e,t,o)=>{o.d(t,{h:()=>c});o(667294);var r=o(886628),i=o(653965),n=o(595550),s=o(566890),l=o(134232),a=o(785893);function c(e){const{isFullScreen:t,hasGroups:o,hasPartialResults:c,hasSearchQuery:d,overrideNumShimmerRows:u}=e,p=(0,s.DK)(),h=(0,r.VK)((()=>null==p?void 0:p.isInHomeWidgetStore.state),[p]);if(!(0,l.Z)(!0,0,100))return null;let m=1;void 0!==u?m=u:o||c||d||(m=t?10:3);const S=m>1?["50%","30%","40%","40%","30%","30%","40%","40%","30%","30%"]:["35%"],g=i.DZ(m).map((e=>(0,a.jsx)(n.G,{widthPercentage:e<S.length?S[e]:void 0},e)));return(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",marginLeft:h?8:3},children:g})}},459827:(e,t,o)=>{o.d(t,{Q:()=>a});o(667294);var r=o(137810),i=o(623879),n=o(785893);const s={...r.Z.textOverflowStyle,position:"absolute",left:0,right:0,top:0,bottom:0},l={marginLeft:4,fontWeight:r.Z.fontWeight.semibold};function a(e){const{prefix:t,viewName:o,viewType:r}=e;return(0,n.jsxs)("div",{style:{position:"relative",width:"100%"},children:[" ",(0,n.jsxs)("div",{style:s,children:[t,r&&i.aW[r]({marginLeft:8,marginRight:2,width:"1em",display:"inline",verticalAlign:"bottom"}),(0,n.jsx)("span",{style:l,children:o})]})]})}},781870:(e,t,o)=>{o.d(t,{Z:()=>d});o(667294);var r=o(800480),i=o(724405),n=o(584169),s=o(225888),l=o(573063),a=o(316354),c=o(785893);const d=function(e){const t=(0,r.O7)(),o=(0,i.Fg)();return(0,c.jsx)(a.Z,{href:e.href,external:!0,onClick:()=>s.Fs(t,{from:e.helpButtonContext}),children:(0,c.jsx)(l.Z,{icon:n.m,style:{height:24,width:24,marginRight:-6,fill:o.mediumIconColor}})})}},491496:(e,t,o)=>{o.d(t,{Z:()=>K});var r=o(667294),i=o(800480),n=o(886628),s=o(724405),l=o(815145),a=o(158573),c=o(747453),d=o(435840),u=o(709291),p=o(653965),h=o(981193),m=o(498834),S=o(608055),g=o(210228),f=o(459827),C=o(566890),v=o(466213),y=o(27105),x=o(492658),b=o(214976),w=o(368585),k=o(484210),T=o(460709),_=o(918514),V=o(80444),O=o(229798),M=o(206258),P=o(897630),R=o(713401),j=o(781870),I=o(240071),F=o(279131),N=o(268894),B=o(478140),E=o(828992),A=o(632163),L=o(840721),D=o(672495),Z=o(38933),H=o(785893);const z=(0,u.defineMessages)({filterPlaceholder:{id:"collectionPicker.searchBarFilter.text",defaultMessage:"Filter…"}});const K=function(e){let{collectionStore:t,isOverlay:o,onEmptyEnter:r,onEmptyPageClick:l,onCancelClick:c,canConfigureCollection:d,locked:p,onTemplateClick:h}=e;const m=(0,s.Fg)(),S=(0,i.Fy)(),g=(0,n.qz)(void 0,x.Z),f=(0,n.qz)(void 0,O.Z),C=(0,n.VK)((()=>t.getTemplatePageStores().filter((e=>e.getAlive()))),[t]),v=(0,n.VK)((()=>C.every((e=>e.isReady()))),[C]),y=(0,n.VK)((()=>g.state.inputValue),[g]),b=(0,n.VK)((()=>o&&null!=y&&y.length?(0,a.ZP)(y,C,(e=>String(e.getProperties().title)??"")):C),[C,y,o]);if(!v)return null;let w=(0,H.jsx)($,{collectionStore:t,onEmptyEnter:r,onEmptyPageClick:l,onCancelClick:c,canConfigureCollection:d,isOverlay:o,locked:p,onTemplateClick:h,menuListStore:f,templateInputStore:g,filteredTemplatePageStores:b,draggable:!0});const k=(0,H.jsx)(q,{templateInputStore:g});if(o){let e;return e=S.isMobile?{menuType:T.og.Modal,title:(0,H.jsx)(u.FormattedMessage,{defaultMessage:"Database templates",id:"database.mobileTemplatesMenu.title"}),left:(0,H.jsx)(L.CancelMenuText,{}),onClickLeft:c}:{menuType:T.og.Popup,width:360},C.length>6&&y&&(w=(0,H.jsx)($,{collectionStore:t,onEmptyEnter:r,onEmptyPageClick:l,onCancelClick:c,canConfigureCollection:d,isOverlay:o,locked:p,onTemplateClick:h,menuListStore:f,templateInputStore:g,filteredTemplatePageStores:b,draggable:!1})),(0,H.jsxs)(B.Z,{...e,header:(0,H.jsx)(G,{collectionStore:t}),children:[0===C.length&&(0,H.jsx)(D.Z,{children:(0,H.jsx)("div",{style:{fontSize:14,padding:S.isMobile?"12px 16px":"0 14px 3px 14px",color:m.lightTextColor,wordBreak:"keep-all",...S.isMobile&&{background:m.contentBackground,boxShadow:`0 1px 0 ${m.regularDividerColor}`,marginBottom:1}},children:(0,H.jsx)(u.FormattedMessage,{defaultMessage:"Replicate page formats inside this database with templates.",id:"database.emptyTemplatesList.info"})})}),C.length>6?k:void 0,w]})}return w};function G(e){let{collectionStore:t}=e;const o=(0,i.O7)(),r=(0,n.VK)((()=>t.getNameStore().getValue()),[t]);if(o.device.isMobile)return null;const s=r?(0,H.jsx)(H.Fragment,{children:(0,b.Xh)(r,t)}):(0,H.jsx)(u.FormattedMessage,{defaultMessage:"Untitled",id:"database.templateList.UntitledDatabaseTitle"});return(0,H.jsx)(E.Z,{style:{marginTop:6},title:(0,H.jsx)(f.Q,{prefix:(0,H.jsx)(u.FormattedMessage,{id:"database.templatesList.templatesFor",defaultMessage:"Templates for"}),viewName:s}),right:(0,H.jsx)(j.Z,{helpButtonContext:"collection_templates_menu",href:(0,_.UY)("guides.databaseTemplates")})})}function W(e){let{props:{ref:t,...o},isOverlay:r,locked:n}=e;const l=(0,s.Fg)(),a=(0,i.O7)(),d=(0,H.jsx)(u.FormattedMessage,{defaultMessage:"New template",id:"database.templateView.newTemplateButton"});return r?(0,H.jsx)(R.Z,{isBlue:a.device.isDesktop,title:d,...o}):(0,H.jsx)(Z.Z,{title:d,icon:(0,c.R)({width:18,fill:l.lightIconColor,marginLeft:1,marginRight:11}),type:"new_template",format:r?"collection-overlay":"page-menu-item",locked:n,...o})}function U(e,t,o){const{mainEditorCurrentBlockStore:r}=V.default.state;!function(e,t,o){o?o(e):S.c4({environment:t,url:e})}(r?(0,k.ZP)({store:r,peekViewBlockId:e.id,fullyQualified:!1,pageVisitSource:l.tY.Create}):(0,k.ZP)({store:e,fullyQualified:!1,pageVisitSource:l.tY.Create}),t,o)}function q(e){let{templateInputStore:t}=e;const o=(0,u.useIntl)(),s=(0,i.O7)(),l=(0,r.useCallback)((e=>function(e,t){t.setState({...t.state,inputValue:e.currentTarget.value})}(e,t)),[t]),a=(0,n.VK)((()=>t.state),[t]),{device:c}=s,p=!c.isMobile||void 0;return(0,H.jsx)("div",{style:{margin:c.isMobile?0:"10px 0"},children:(0,H.jsx)(N.ZP,{value:a.inputValue,focusInitial:p,placeholder:o.formatMessage(z.filterPlaceholder),showClearButton:!0,inputLeft:(0,H.jsx)(N.f_,{icon:d.R}),onChange:l,style:{...c.isAndroid&&{borderBottom:"none"}}})})}function $(e){let{filteredTemplatePageStores:t,draggable:o,collectionStore:s,onEmptyEnter:l,onEmptyPageClick:a,onCancelClick:c,canConfigureCollection:d,isOverlay:u,locked:S,onTemplateClick:f,menuListStore:x,templateInputStore:b}=e;const k=(0,i.O7)(),T=(0,r.useContext)(C.cu),_=(0,r.useContext)(v.ZO),V=(0,r.useCallback)((e=>function(e,t,o,r){r.unsetFocus(),g.createAndCommit({userAction:"CollectionTemplatePicker.handleCollectionTemplatesReorder",environment:t,perform:t=>m.$p({collectionStore:o,newTemplateIds:e,transaction:t})})}(e,k,s,x)),[k,s,x]),O=(0,r.useCallback)((()=>function(e,t,o,r){var i;P.M_(e)&&(o(),h.rN(e,{template_name:"empty",is_keyboard:!0,collection_id:t.id,collection_view_id:null==r||null===(i=r.collectionViewStore())||void 0===i?void 0:i.id}))}(k,s,l,T)),[k,s,l,T]),R=(0,r.useCallback)((e=>function(e,t,o,r){P.M_(t)&&(o(e.event),h.rN(t,{template_name:"empty",is_keyboard:"keydown"===e.event.type,...r&&(0,w.Pn)(r)}))}(e,k,a,T)),[T,k,a]),j=(0,r.useCallback)((e=>function(e,t,o,r,i,n,s){if(P.M_(t)){var l;const{performResult:i}=g.createAndCommit({userAction:"CollectionTemplatePicker.newPage",environment:t,perform:i=>m.nx({environment:t,collectionStore:o,transaction:i,title:r?r.state.inputValue:void 0,useCrdt:(0,y.SL)({event:e.event,source:"collection_instantiate_template"})})});i&&U(i,t,n),h.dZ(t,{collection_id:o.id,collection_view_id:null==s||null===(l=s.collectionViewStore())||void 0===l?void 0:l.id})}null==i||i()}(e,k,s,b,c,_,T)),[k,s,b,c,_,T]),{device:N}=k,B=(0,r.useMemo)((()=>({key:"create-template",render:(e,t)=>(0,H.jsx)(W,{isOverlay:u,locked:S,props:e}),action:j})),[j,u,S]),E=(0,n.VK)((()=>null==T?void 0:T.defaultPageTemplateStore.state),[T]),L=(0,n.VK)((()=>({key:"empty",render:(e,o)=>{if(0!==t.length&&""===b.state.inputValue)return(0,H.jsx)(I.Z,{collectionStore:s,canConfigureCollection:d,isOverlay:u,templateStore:void 0,isMobile:k.device.isMobile,locked:S||!d,draggable:!0,isDefault:void 0===(null==E?void 0:E.id),onCancelClick:c,...e})},action:R})),[d,s,null==E?void 0:E.id,k.device.isMobile,R,u,S,c,b,t.length]),Z=(0,n.VK)((()=>{const e=t.map((e=>e.id));return p.oA([0!==t.length&&{key:"templates",render:t=>{const i=t.children.slice(0,t.children.length-1),n=t.children[t.children.length-1];return(0,H.jsx)(D.Z,{...t,disableDesktopPadding:!u,disableMobileBorders:!0,children:(0,H.jsxs)(r.Fragment,{children:[N.isMobile||S||!d?i.map(((e,t)=>i[t])):(0,H.jsx)(F.ZP,{direction:"vertical",keys:e,disabled:!o,renderKey:(t,o)=>i[e.indexOf(t)],onDrop:V}),n]})})},items:[...t.map((e=>function(e,t,o,i,n,s,l,a,c,d){const{device:u}=e,p=null==d?void 0:d.defaultPageTemplateStore.state,h=M.Mz.fromBlockStore(t),m=null!=h&&h.isActive()?h.getRecurrence():void 0,S="disabled_duplication"===(null==h?void 0:h.getStatus());return{key:t.id,render:e=>(0,r.createElement)(I.Z,{...e,key:t.id,isOverlay:l,collectionStore:i,canConfigureCollection:n,templateStore:t,isMobile:u.isMobile,locked:s,onCancelClick:a,draggable:o,isDefault:(null==p?void 0:p.id)===t.id,recurrence:m,recurrenceDisabled:S}),action:o=>{P.M_(e)&&c({templateStore:t,isKeyboard:"keydown"===o.event.type,useCrdt:(0,y.SL)({event:o.event,source:"collection_instantiate_template",contextualDefault:t.useCrdt()})})}}}(k,e,o,s,d,S,u,c,f,T))),L]},d?{key:"create-template",render:e=>(0,H.jsx)(D.Z,{topBorder:u,disableDesktopPadding:!u,disableMobileBorders:!0,...e}),items:[B]}:void 0])}),[d,T,s,B,N.isMobile,o,L,k,V,u,S,c,f,t]);return(0,H.jsx)(A.Z,{type:A.i.Vertical,store:x,initialFocus:void 0,disableInitialScroll:!0,disableCommandEnter:!0,onEmptyEnter:O,sections:Z})}},402243:(e,t,o)=>{o.r(t),o.d(t,{CollectionViewBLockErrorBoundaryWithRef:()=>tC,FULL_SCREEN_PADDING_BOTTOM:()=>Qf,default:()=>oC});o(21703);var r=o(730120),i=o(667294),n=o(973935),s=o(883355),l=o(701302),a=o(706740),c=o(749085),d=o(815145),u=o(371663),p=o(202032),h=o(642509),m=o(665422),S=o(849019),g=o(821197),f=o(745238),C=o(785893);const v=(0,f.IU)("folderUnknownLarge",{viewBox:"0 0 48 48",svg:(0,C.jsx)("path",{d:"M39.1702 25.1855C43.1252 25.1855 46.4504 21.8896 46.4504 17.9053C46.4504 13.9062 43.1692 10.625 39.1702 10.625C35.1858 10.625 31.8899 13.9209 31.8899 17.9053C31.8899 21.9189 35.1858 25.1855 39.1702 25.1855ZM11.6604 37.5195H36.1379C38.7014 37.5195 40.1663 36.0547 40.1663 33.2422V26.8408C39.6829 26.9141 38.9504 26.9141 38.3498 26.8408V33.1543C38.3498 34.8389 37.427 35.7178 35.801 35.7178H11.6897C10.0491 35.7178 9.15551 34.8389 9.15551 33.1543V21.1133H30.7327C30.5276 20.5713 30.3811 20 30.3079 19.3994H9.15551V15.3125C9.15551 13.7598 9.94652 12.9834 11.4553 12.9834H14.8391C15.9084 12.9834 16.4797 13.2031 17.2707 13.9062L18.1057 14.6387C19.0286 15.4443 19.761 15.708 21.2405 15.708H30.4543C30.6008 15.0635 30.7766 14.5215 31.0842 13.8916H21.6799C20.5666 13.8916 19.9807 13.6865 19.219 13.0127L18.3694 12.2803C17.4172 11.4307 16.7434 11.1963 15.2786 11.1963H11.1038C8.67211 11.1963 7.3391 12.5293 7.3391 15.21V33.2422C7.3391 36.084 8.80395 37.5195 11.6604 37.5195ZM39.053 19.6924C38.5989 19.6924 38.3352 19.4287 38.3352 18.9746V18.916C38.3352 18.0811 38.76 17.6416 39.4485 17.1582C40.2248 16.6162 40.7375 16.2793 40.7375 15.5615C40.7375 14.9023 40.1955 14.4775 39.3606 14.4775C38.6575 14.4775 38.1741 14.8145 37.8664 15.166C37.6174 15.4297 37.4416 15.6934 37.0608 15.6934C36.6653 15.6934 36.4016 15.4297 36.4016 15.0195C36.4016 14.0088 37.8079 13.1299 39.3606 13.1299C41.133 13.1299 42.2463 14.1699 42.2463 15.4883C42.2463 16.5869 41.6164 17.0557 40.7815 17.6709C40.1077 18.1689 39.844 18.4473 39.7854 19.0479C39.7414 19.4434 39.5071 19.6924 39.053 19.6924ZM39.053 22.5195C38.4817 22.5195 38.0129 22.0508 38.0129 21.4795C38.0129 20.9229 38.4817 20.4541 39.053 20.4541C39.6243 20.4541 40.093 20.9229 40.093 21.4795C40.0784 22.0508 39.6243 22.5195 39.053 22.5195Z"})});var y=o(949019),x=o(375071),b=o(814601),w=o(382138),k=o(915157),T=o(144615),_=o(421202),V=o(213493),O=o(712139),M=o(151454),P=o(709291),R=o(653965),j=o(137810),I=o(436610),F=o(108406),N=o(454642),B=o(234993),E=o(554569),A=o(805149),L=o(498834),D=o(532603),Z=o(587420),H=o(52989),z=o(761045),K=o(587531),G=o(524677),W=o(436821),U=o(898104),q=o(210228),$=o(691851),Q=o(940663),Y=o(800480),X=o(886628),J=o(724405),ee=o(114714),te=o(897058),oe=o(215828),re=o(496802),ie=o(709953),ne=o(275754),se=o(926999),le=o(710274),ae=o(110906),ce=o(399036),de=o(747453),ue=o(471924),pe=o(926249),he=o(401898),me=o(76233),Se=o(240745),ge=o(628020);function fe(e){const{collectionContextStore:t,groupsPointer:o,hasPartialResults:r}=e,i=t.shouldShowSpinnerStore.state,n="load_general"===t.loadingDetailsStore.state.type&&!r||"load_more_blocks"===t.loadingDetailsStore.state.type&&R.Xy(t.loadingDetailsStore.state.group,o);return i&&n}function Ce(e){const{collectionContextStore:t,isForColumnGroups:o}=e,r=o?"load_more_columns":"load_more_groups";return t.isLoadingStore.state&&t.loadingDetailsStore.state.type===r}function ve(e){const{collectionContextStore:t,groupsPointer:o}=e;return t.shouldShowSpinnerStore.state&&"load_more_blocks"===t.loadingDetailsStore.state.type&&R.Xy(t.loadingDetailsStore.state.group,o)}var ye=o(212534),xe=o(164921),be=o(568785),we=o(406695),ke=o(356666),Te=o(231945),_e=o(573063),Ve=o(953437),Oe=o(460709),Me=o(552275),Pe=o(478140),Re=o(632163),je=o(672495);const Ie=(0,P.injectIntl)((function(e){const{limit:t}=e;return(0,C.jsx)(P.FormattedMessage,{defaultMessage:"{limit} pages",values:{limit:t.limit},id:"database.FirstLoadLimitSelectOption.limitPagesTitle"})}));const Fe=(0,P.injectIntl)((function(e){const t=(0,Y.O7)(),{device:o}=t,{currentLimit:r,onAccept:i,onClose:n,showTitle:s}=e,l=[{key:0,render:e=>(0,C.jsx)(je.Z,{enableActionSheetTitle:!0,title:s&&(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Show on first load",id:"database.firstLoadLimitSelectMenu.firstLoadLimitSetting"}),...e}),items:R.oA(we.jk.map(((e,t)=>{const o={key:t,render:t=>(0,C.jsx)(Me.Z,{...t,disabled:!1,title:(0,C.jsx)(Ie,{limit:e}),checkState:R.Xy(r,e)}),action:()=>i(e)};return o})))}];let a;return a=o.isMobile?{menuType:Oe.og.ActionSheet}:{menuType:Oe.og.Popup,width:200},(0,C.jsx)(Pe.Z,{...a,children:(0,C.jsx)(Re.Z,{type:Re.i.Vertical,sections:l,onAccept:n,initialFocus:void 0})})}));const Ne=function(e){let{format:t,collectionContextStore:o}=e;const r=(0,Y.O7)(),{device:i}=r;return(0,C.jsx)(Te.ZP,{popupType:i.isMobile?Ve.kQ.SlideUp:Ve.kQ.Popup,renderOrigin:e=>(0,C.jsx)(_e.Z,{icon:ke.o,style:{marginLeft:4,marginRight:4},...e}),alignmentToOrigin:Te.vR.End,placementToOrigin:Te.pO.Bottom,originGap:8,render:e=>(0,C.jsx)(Ee,{parent:e,format:t,collectionContextStore:o})})};function Be(e){return(0,we.rx)(e.inline_collection_first_load_limit,Boolean(e.collection_group_by))}function Ee(e){let{parent:t,format:o,collectionContextStore:r}=e;const i=(0,Y.O7)();return(0,C.jsx)(Fe,{currentLimit:Be(o),onAccept:e=>function(e,t,o){const r=t.collectionViewStore();if(!r)return;r.getType()&&(q.createAndCommit({userAction:"FirstLoadLimitActionButton.handleFirstLoadLimitAccept",environment:o,perform:t=>{re.FH({stores:[r],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),F.wd({environment:o,collectionContextStore:t,action:"set_first_load_limit"}))}(e,r,i),onClose:t.close,showTitle:!0})}const Ae=function(e){let{style:t,store:o,format:r,collectionContextStore:i,groupsPointer:n,incrementLimitsInRelatedGroups:s,isFullScreen:l}=e;const a=(0,J.Fg)(),c=(0,Y.O7)(),u=(0,X.VK)((()=>i.groupsStore.getGroupState(n)),[i,n]),p=(0,X.VK)((()=>ve({collectionContextStore:i,groupsPointer:n})),[i,n]),h=(0,X.VK)((()=>i.isInHomeWidgetStore.state),[i]),m=(0,X.VK)((()=>o.canEdit()),[o]);return u?h?(0,C.jsx)(xe.Z,{onClick:e=>function(e,t,o){const r=e.metaKey||e.ctrlKey?"tab":void 0,i=(0,ge.qG)(o.id)?d.tY.PersonalHomeTileTasks:d.tY.PersonalHomeTileCustomDb;ne._c({environment:t,store:o,pageVisitSource:i,openInNew:r})}(e,c,o),onMouseDown:ye.$0,style:{display:"flex",alignItems:"center",height:30,borderRadius:4,whiteSpace:"break-spaces",fontSize:14,paddingLeft:8,marginBottom:8,...t},children:(0,C.jsx)("div",{style:{color:a.lightTextColor},children:(0,C.jsx)(P.FormattedMessage,{id:"database.viewAllButtonTitle",defaultMessage:"View all"})})}):(0,C.jsxs)(xe.Z,{onClick:e=>function(e,t,o,r,i,n){const s=o.groupsStore.getGroupState(r);if(!s)return;const l=s.reducerResultStore.state;(0,ye.Wi)(e),G.ZH({debug:{userAction:"CollectionGroupLoadMoreButton.handleLoadMoreClick"},environment:t}),l&&E.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:n,currentResultCount:l.blockIds.length,groupsPointer:s.groupsPointer,incrementLimitsInRelatedGroups:i}});I.uD(t)}(e,c,i,n,s,l),onMouseDown:ye.$0,disabled:p,hoveredStyle:p?{background:a.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:30,borderRadius:4,whiteSpace:"break-spaces",fontSize:14,...t},children:[(0,Se.M)(Le(a)),(0,C.jsx)("div",{style:{color:a.lightTextColor},children:(0,C.jsx)(P.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),p?(0,C.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,C.jsx)(be.Z,{style:{width:12,height:12}})}):m&&(0,C.jsx)(Ne,{collectionContextStore:i,format:r})]}):null};function Le(e){return{width:14,height:14,marginLeft:4,marginRight:6,fill:e.lightIconColor}}var De=o(790424),Ze=o(514248),He=o(842875),ze=o(547307);var Ke=o(368585),Ge=o(892918),We=o(433929),Ue=o(645010),qe=o(318245),$e=o(319385),Qe=o(188923),Ye=o(206258),Xe=o(576205),Je=o(559054),et=o(95371),tt=o(237524),ot=o(397004),rt=o(277181),it=o(573807),nt=o(720144),st=o(27724),lt=o(100952),at=o(492973),ct=o(551365),dt=o(843250),ut=o(248543),pt=o(519511),ht=o(155367),mt=o(278030),St=o(279954);function gt(e){const{store:t,resultProps:o,resultComponent:r,collectionContextStore:n,canDrag:s,canDrop:a,getItemSelectableStyle:c,belowDropZoneMargin:d,analyticsName:u,disabled:p,direction:h,onSelectableEnter:m,disableScrollToRevealHorizontal:S,touchDragOnly:g,isLast:f,groupsPointer:v,toggleButton:y,subitemPath:x,disableSelectable:b,itemSelectableHaloStyle:w,passesFilter:k,onSelectableInsertRow:T,blockPropertyValueOverlayStore:_,dropzoneGap:V}=e,O=(0,Y.O7)(),M=(0,X.VK)((()=>t.canEdit()),[t]),R=(0,X.VK)((()=>t.getAssociatedCollectionStore()),[t]),j=(0,X.VK)((()=>"collectionTypedView"===n.contextType),[n]),I=(0,X.VK)((()=>{const e=n.groupsStore.getGroupState(v);return null==e?void 0:e.resultsStore}),[n,v]),F=(0,X.VK)((()=>ae.Sc(t)),[t]),N=(0,X.VK)((()=>{const e=pt.Z.state;return e.isActive&&e.store===t}),[t]),B=(0,X.VK)((()=>!p&&M),[p,M]),A=(0,X.VK)((()=>e.shouldShowHoverMenu&&B),[e.shouldShowHoverMenu,B]),L=h!==wt.Vertical&&a,D=h!==wt.Vertical&&a,H=h===wt.Vertical&&a,z=(0,J.yK)((e=>({haloStyle:{...ae.pB(F,e),...w}})),[w,F]),K=(0,i.useCallback)((e=>{const{insertStores:o,transaction:r}=e;return R?E.$T({environment:O,collectionStore:R,collectionContextStore:n,groupsPointer:v,insertStores:o,store:t,before:!1,transaction:r}):[]}),[R,n,O,v,t]),G=(0,i.useCallback)((e=>{const{insertStores:o,transaction:r}=e;return R?E.$T({environment:O,collectionStore:R,collectionContextStore:n,groupsPointer:v,insertStores:o,store:t,before:!0,transaction:r}):[]}),[R,n,O,v,t]),W=(0,i.useCallback)((e=>{const{droppedDirection:o,duplicate:r}=e;if(!R)return[];const i=qe.default.mark("collections.drop_item_lag");qe.default.measureAfterNextFlush(i,{environment:O,getData:()=>Ke.yr({collectionContextStore:n,is_native_drop:!1,is_empty:!1})});const s=o!==ht.vh.Onto?(0,Ge.F6)({stores:e.droppedStores,collectionContextStore:n}):e.droppedStores;0===s.length&&j?ze.showErrorMessage((0,C.jsx)(P.FormattedMessage,{...Ge.nX.unsupportedGroupAction})):q.createAndCommit({userAction:"CollectionGroupResultsItem.handleDrop",environment:O,perform:e=>{!E.by({environment:O,collectionStore:j?void 0:R,targetStore:t,droppedDirection:o,collectionContextStore:n,groupsPointer:v,droppedStores:s,duplicate:r,transaction:e,subitemPath:x,collapsedGroup:!1})&&j&&ze.showErrorMessage((0,C.jsx)(P.FormattedMessage,{...Ge.nX.unsupportedGroupAction}))}})}),[R,n,O,v,j,t,x]),U=(0,i.useCallback)((e=>{const{files:o,droppedDirection:r}=e;if(!R)return[];const i=qe.default.mark("collections.drop_item_lag");qe.default.measureAfterNextFlush(i,{environment:O,getData:()=>Ke.yr({collectionContextStore:n,is_native_drop:!0,is_empty:!1})}),q.createAndCommit({userAction:"CollectionGroupResultsItem.handleNativeDrop",environment:O,perform:e=>{E.tQ({environment:O,collectionStore:R,targetStore:t,droppedDirection:r,collectionContextStore:n,groupsPointer:v,files:o,transaction:e})}})}),[R,n,O,v,t]),$=(0,i.useCallback)((e=>o=>{let{transaction:r}=o;if(!R)return[];const i=E.yk({environment:O,collectionContextStore:n,groupsPointer:v,store:t,before:"above"===e,collectionStore:R,transaction:r,subitemPath:x,subitemInsertDirection:"below"});if(lt.W(O,{...Ke.Pn(n),type:"page",from:"below"===e?"table_insert_below":"table_insert_above",new_page_id:null==i?void 0:i.id,creating_block_id:null==i?void 0:i.id}),i&&T&&T(t,i),i&&_){const e=()=>{ct.bA({isNewBlock:!0,environment:O,blockPropertyValueOverlayStore:_,store:i,property:"title",format:mt.C.Table,collectionContextStore:n})};$e.default.checkGate({gateName:"collections_item_mounted_callbacks"})?n.registerCallbackForItemMounted(i,e):l.default.afterNextFlush((()=>{l.default.afterNextFlush(e)}))}}),[R,_,n,O,v,T,t,x]),Q=e.handleOpenPeekPage,ee=(0,i.useCallback)((()=>{const e=n.collectionViewStore();qe.default.mark("collections.open_item_page_lag"),Q&&Q(),Z.Xd({collectionContextStore:n,resultsStore:I});const t=null==e?void 0:e.getType();if(t){const e=n.normalizedFormatStore.state.collection_peek_mode,o=e||ut.Ls[t];at.hy(O,{is_peek:!0,from:t,peek_mode:o})}}),[n,O,Q,I]),te=(0,X.VK)((()=>c?c(f):void 0),[c,f]);(0,i.useEffect)((()=>{n.onItemMount(t)}),[t,n]);const oe=i.createElement(r,{handleOpenPeekPage:ee,collectionContextStore:n,...o,store:t,key:t.id,isLast:f,toggleButton:y,subitemPath:x,passesFilter:k});return b?oe:(0,C.jsx)(St.Z,{style:te,store:t,canSelect:B,shouldShowHalo:!N,shouldForceRenderSelectionHalo:F,haloStyle:z.haloStyle,canDrag:s,canDropBelow:H,canDropLeft:L,canDropRight:D,canNativeDropBelow:H&&!j,canNativeDropLeft:L&&!j,canNativeDropRight:D&&!j,canDropOnto:a,canTriggerContextMenu:B,showBlockMenuInput:!0,shouldShowHoverMenu:A,shouldShowCommentMenu:!1,onSelectableDrop:W,onNativeDrop:U,onInsertBelow:K,onInsertAbove:G,onRemove:e=>function(e,t,o,r,i){const{transaction:n}=e;i.length>0&&E.BN({store:o,transaction:n,groupsPointer:i,collectionContextStore:r,environment:t});E.Od({store:o,transaction:n})}(e,O,t,n,v),canInsertAbove:a,canInsertBelow:a,onInsertRowBelow:$("below"),onInsertRowAbove:$("above"),belowDropZoneMargin:d,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:u,shouldShowDropZone:a,dropzoneGap:V,onEnter:m,className:dt.K4T,disableScrollToRevealHorizontal:S,touchDragOnly:g,groupsPointer:v,children:oe})}const ft=i.memo(gt,pe.Z);var Ct=o(605210);function vt(e){const{store:t,collectionContextStore:o,subitemPath:r,titleColumnIndex:n,nestedCreateSubitemButton:s,getItemSelectableStyle:l}=e,{currentSubitemFormatStoreForUiDisplayStore:a,subitemExpandedStore:c,subitemTreeStore:d}=o,u=(0,X.VK)((()=>ae.Bm({store:t,collectionContextStore:o})),[o,t]),p=(0,X.VK)((()=>r&&r.length>0?r:(0,et.DY)(d.state.children,(e=>e.value.store===t))),[r,d,t],{useDeepEqual:!0}),h=(0,i.useMemo)((()=>p?(0,rt.Af)(p.map((e=>e.value.store))):""),[p]),m=(0,X.VK)((()=>c.state.get(h)),[c,h]),S=Boolean(null==m?void 0:m.isExpanded),g=(0,Y.O7)(),f=(0,X.VK)((()=>{const e=a.state;if(!e||!u)return;const t=u.getSchema()[e.property];return void 0!==t&&(0,ce.p_)(t)?t:void 0}),[a,u]),v=(0,X.VK)((()=>{var e;return f&&"relation"===f.type&&(0,ce.F0)(f)===(null===(e=o.collectionStore())||void 0===e?void 0:e.id)&&f.property}),[o,f]),y=(0,X.VK)((()=>{var e;return null===(e=o.collectionViewStore())||void 0===e?void 0:e.getType()}),[o]),x=(0,X.VK)((()=>{const e=!v||y&&(0,rt.Av)(y)?void 0:{property:v,filter:{operator:"is_empty"}};return!(!a.state||!u)&&(0,rt.kC)({store:t,collectionStore:u,subitemFormat:a.state,subitemPathKey:h,collectionContextStore:o,propertyFilters:[...e&&v?[{id:v,filter:e}]:[],...o.currentPropertyFiltersStore.state],combinatorFilter:o.currentCombinatorFilterStore.state,currentUserId:g.currentUser.id,resultCache:new Map}).length>0}),[o,y,a,g.currentUser.id,v,u,h,t]),b=(0,X.VK)((()=>{var e;if(!a.state||!u)return!1;const t=null===(e=o.collectionViewStore())||void 0===e?void 0:e.getType();return x||S||g.device.isMobile||"timeline"===t}),[a,g.device.isMobile,u,x,S,o]),w=(0,X.VK)((()=>nt.Z.getState().hoveredStore===t),[t]),k=(0,X.VK)((()=>{const e=(0,ot.m1)({collectionContextStore:o,collectionStore:u,environment:g});if(e)return(0,Xe.q)(e)}),[o,u,g]),T=(0,i.useCallback)((()=>{const e=c.state;if(S){e.delete(h);const r=st.default.state.stores.filter((e=>t.uiContains(e)));r.length>0&&G.Af({stores:(0,R.e5)(st.default.state.stores,r)}),I.a_(g,{...(0,Ke.Pn)(o),depth:(null==p?void 0:p.length)||0}),c.emit()}else{e.set(h,{isExpanded:!0,limit:20}),I._k(g,{...(0,Ke.Pn)(o),depth:(null==p?void 0:p.length)||0});const r=a.state;k&&e&&f&&r?(0,rt.fd)({blockStore:t,subitemExpandedStore:c,subitemFormat:r,propertySchema:f,compiledFilter:k,pathKey:h,forceStoresToLoad:!1,visitedIds:new Set,resultCache:new Map}).then((()=>{c.emit()})):c.emit()}}),[k,c,S,h,o,a,g,p,t,f]),_=(0,X.VK)((()=>{const o=d.state;return o&&p?(0,rt.Ns)(o).value.store===t:e.isLast}),[d,e.isLast,t,p]),V=(0,it._)(),O=(0,X.VK)((()=>{var e;const o=t.getModel(),r=t.getRecordModel;if(!k||!o)return!0;const i=null===(e=t.getAssociatedCollectionStore())||void 0===e?void 0:e.getPropertyMapping();return k({block:o,getRecordModel:r,propertyMapping:i,formulaTimeoutTimestampMs:Date.now()+V,resultCache:new Map})}),[t,k,V]),M=(0,X.VK)((()=>l&&!O?()=>({...l?l(_):{},...O?{}:{opacity:.5}}):l),[l,O,_]);(0,Je.r5)((async()=>{const e=t.getModel();await t.load();const o=t.getRecordModel,r=a.state;if(!b||!e||!k||!f||!o||!r||O)return;(0,rt.xb)({store:t,subitemFormat:r,propertySchema:f}).length>0||(await(0,rt.fd)({blockStore:t,subitemExpandedStore:c,subitemFormat:r,propertySchema:f,compiledFilter:k,pathKey:h,forceStoresToLoad:!0,visitedIds:new Set,resultCache:new Map}),c.emit())}),[b,k,a,O,h,t,c,f]);const P=(0,J.Fg)(),j=(0,C.jsx)(ft,{...e,passesFilter:O,isLast:_,getItemSelectableStyle:M,subitemPath:p,toggleButton:(b||w)&&(0,C.jsx)(Ct.Z,{isSidebar:!1,open:S,fill:!0,onClick:T,color:x||S?P.regularIconColor:P.mediumIconColor,disabled:p&&p.length>=rt.F0})});if(!S||!p||0===p.length||p.length>=rt.F0)return j;const F=p[p.length-1].children;return(0,C.jsxs)(C.Fragment,{children:[j,F.map((t=>{const o=t.value.store;return(0,i.createElement)(vt,{...e,key:o.id,store:o,subitemPath:[...p,t]})})),u&&s&&s({store:t,parentStore:u,subitemPath:p,indentLevel:p.length,titleColumnIndex:n}),m&&F.length>0&&F.length===m.limit&&(0,C.jsx)(yt,{collectionContextStore:e.collectionContextStore,pathKey:h,titleColumnIndex:n,limit:m.limit,indentLevel:p.length})]})}const yt=i.memo((function(e){const{collectionContextStore:t,pathKey:o,titleColumnIndex:r,limit:n,indentLevel:s}=e,l=(0,i.useCallback)((()=>{const{subitemExpandedStore:e}=t;e.state.set(o,{isExpanded:!0,limit:n+20}),e.emit()}),[t,n,o]),a=(0,Y.O7)(),c=(0,X.VK)((()=>ae.fk({environment:a,collectionContextStore:t})),[t,a]),d=(0,X.VK)((()=>{var e;return"title"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[t]),u=(0,J.yK)((e=>({button:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:8+(0,tt.f2)({columnIndex:0,titleColumnIndex:r,shouldShowBulkActionsToolbar:c,indentLevel:s+1,isSubitemToggleOnTitleColumn:d}),fontSize:14,lineHeight:j.Z.lineHeight.UIRegular.desktop,borderTop:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,background:e.cardContentBackground},icon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor},label:{color:e.lightTextColor}})),[s,c,r,d]);return(0,C.jsxs)(xe.Z,{onClick:l,onMouseDown:ye.$0,style:u.button,children:[(0,Se.M)(u.icon),(0,C.jsx)("span",{style:u.label,children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Load more",id:"database.loadMoreButtonTitle"})})]})})),xt=i.memo(vt);var bt=o(475498);let wt=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e}({});class kt extends s.Z{constructor(){super(...arguments),this.instanceCollectionViewBlockStore=void 0,this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEmptyDroppableDrop=e=>function(e,t,o,r,i){const{droppedDirection:n,duplicate:s}=e,l=i.state,a=o.collectionViewBlockStore();if(!a)return;const c=qe.default.mark("collections.drop_item_lag");qe.default.measureAfterNextFlush(c,{environment:t,getData:()=>Ke.yr({collectionContextStore:o,is_native_drop:!1,is_empty:!0})});const d="collectionTypedView"===o.contextType,u=(0,Ge.F6)({stores:e.droppedStores,collectionContextStore:o});if(0===u.length&&d)return void ze.showErrorMessage(We.default.formatMessage(Ge.nX.unsupportedGroupAction));q.createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableDrop",environment:t,perform:e=>{!E.by({environment:t,collectionStore:l,targetStore:a,droppedDirection:n,collectionContextStore:o,groupsPointer:r,droppedStores:u,duplicate:s,transaction:e,collapsedGroup:!1})&&d&&ze.showErrorMessage(We.default.formatMessage(Ge.nX.unsupportedGroupAction))}})}(e,this.environment,this.props.collectionContextStore,this.props.groupsPointer,this.emptyDroppableIntoStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEmptyDroppableNativeDrop=e=>function(e,t,o,r,i){const{files:n,droppedDirection:s}=e,l=i.state;if(!l)return;const a=o.collectionViewBlockStore();if(!a)return;const c=qe.default.mark("collections.drop_item_lag");qe.default.measureAfterNextFlush(c,{environment:t,getData:()=>Ke.yr({collectionContextStore:o,is_native_drop:!0,is_empty:!0})}),q.createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableNativeDrop",environment:t,perform:e=>{E.tQ({environment:t,collectionStore:l,targetStore:a,droppedDirection:s,collectionContextStore:o,groupsPointer:r,files:n,transaction:e})}})}(e,this.environment,this.props.collectionContextStore,this.props.groupsPointer,this.emptyDroppableIntoStore),this.resultsReducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t,loadContentCover:o}=this.props,r=e.groupsStore.getGroupState(t);if(!r)return;const i=r.currentLimit.state,n=e.normalizedSchemaStore.state,s=R.oA(t.map((e=>(0,Ze.Ko)({schema:n,propertyMapping:void 0,group:e,timeZone:(0,He.r)()}))));return{type:"results",filter:s.length>0?{operator:"and",filters:s}:void 0,limit:i,loadContentCover:o}})),this.resultStoresStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props,o=e.groupsStore.getGroupState(t);return(null==o?void 0:o.resultsStore.state)??[]})),this.emptyDroppableIntoStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return"collectionTypedView"===e.contextType?void 0:e.collectionStore()}))}getNode(){return super.getNode()}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.instanceCollectionViewBlockStore=new Ye.G(this.environment,t.pointer))}didMountOrUpdate(){this.props.collectionContextStore.renderEmitter.emit()}renderComponent(){const{emptyDroppableStyle:e,direction:t,collectionContextStore:o,groupsPointer:r,virtualizeResults:i}=this.props,n=this.props.emptyDroppableSize||"none",s=t===wt.Vertical;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{style:{...s?{height:n}:{width:n},...e},children:this.renderEmptyDroppable()}),i&&$e.default.checkGate({gateName:"collections_virtualization"})?(0,C.jsx)(Vt,{collectionContextStore:o,groupsPointer:r,resultComponentProps:this.props}):this.resultStoresStore.state.map(((e,t,o)=>(0,C.jsx)(Mt,{store:e,isLast:t===o.length-1,...this.props},e.id))),(0,C.jsx)(Pt,{collectionContextStore:this.props.collectionContextStore,groupsPointer:this.props.groupsPointer,disableRequest:this.props.disableRequest,resultsReducerStore:this.resultsReducerStore})]})}renderEmptyDroppable(){const{collectionContextStore:e,disabled:t,analyticsName:o,direction:r,onSelectableEnter:i,canDrop:n,groupsPointer:s}=this.props;if(this.instanceCollectionViewBlockStore){const l=r!==wt.Vertical&&(!t&&0===this.resultStoresStore.state.length),a=r===wt.Vertical&&!t,c="collectionTypedView"===e.contextType,d=e.isInHomeWidgetStore.state;return(0,C.jsx)(St.Z,{store:this.instanceCollectionViewBlockStore,canSelect:!1,canEditText:!1,shouldShowHalo:!d,canDrag:!1,canDropLeft:n&&l,canNativeDropLeft:n&&l&&!c,canDropBelow:n&&a,canNativeDropBelow:n&&a&&!c,canTriggerContextMenu:!1,showBlockMenuInput:!1,shouldShowHoverMenu:!1,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEmptyDroppableDrop,onNativeDrop:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEmptyDroppableNativeDrop,analyticsName:o,shouldShowDropZone:n,onEnter:i,groupsPointer:s,style:r===wt.Vertical?void 0:{width:"100%",height:"100%"}})}}}kt.displayName="CollectionGroupResults";const Tt=kt;function _t(e){let{collectionContextStore:t,groupsPointer:o,resultComponentProps:r}=e;const n=(0,X.VK)((()=>t.groupsStore.getGroupState(o)),[t,o]),s=(0,X.VK)((()=>(null==n?void 0:n.resultsStore.state)??[]),[null==n?void 0:n.resultsStore]),l=(0,X.VK)((()=>{const e=t.collectionViewBlockStore();return Qe.default.peekTargetStore.state===e&&(Qe.default.isSidePeekOpen()||Qe.default.isCenterPeekOpen())?"PeekViewScroller":"PageScroller"}),[t]),[a,c]=(0,i.useState)(0),d=(0,i.useCallback)((e=>{if(0===a){var t;const o=(null==e||null===(t=e.getBoundingClientRect())||void 0===t?void 0:t.top)??0;o!==a&&c(o)}}),[a]),u=(0,i.useCallback)((e=>s[e].id),[s]),p=(0,De.MG)({count:s.length,estimateSize:()=>34,scrollMargin:a,getScrollElement:()=>{var e;return null===(e=Ue.Z[l])||void 0===e?void 0:e.getNode()},getItemKey:u,overscan:10});return function(e){let{virtualizer:t,resultsStores:o,collectionContextStore:r,groupState:n}=e;const s=(0,i.useRef)({fetching:!1,previousTotal:0}),l=(0,Y.O7)(),a=t.getVirtualItems(),c=o.length+1,d=(0,X.VK)((()=>{var e;return(null==n||null===(e=n.reducerResultStore)||void 0===e||null===(e=e.state)||void 0===e?void 0:e.hasMore)??!1}),[null==n?void 0:n.reducerResultStore]);(0,i.useEffect)((()=>{const{fetching:e,previousTotal:t}=s.current;e&&t!==c&&(s.current={fetching:!1,previousTotal:0})}),[c]),(0,i.useEffect)((()=>{if(!d||null==n||!n.groupsPointer||s.current.fetching)return;const[e]=a.slice(-1);!e||c<=0||e.index-t.options.overscan>.67*c&&(s.current={fetching:!0,previousTotal:c},r.infiniteScrollLongTaskObserver.observe(),E.ID({collectionContextStore:r,environment:l,incrementLimitArgs:{isFullScreen:!0,currentResultCount:o.length,groupsPointer:null==n?void 0:n.groupsPointer,incrementLimitsInRelatedGroups:!1}}))}),[r,l,null==n?void 0:n.groupsPointer,d,o.length,c,a,t.options.overscan])}({virtualizer:p,resultsStores:s,collectionContextStore:t,groupState:n}),(0,i.useEffect)((()=>{t.virtualizedModule.setVirtualizer(p)}),[t,p]),s.length<=0?null:(0,C.jsx)("div",{ref:d,style:{height:p.getTotalSize(),width:"100%",position:"relative"},children:p.getVirtualItems().map((e=>{const t=s[e.index],o=s.length-1===e.index;return(0,C.jsx)("div",{"data-index":e.index,ref:p.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${(e.start??0)-p.options.scrollMargin}px)`},children:(0,C.jsx)(Mt,{store:t,isLast:o,...r},t.id)},e.key)}))})}const Vt=i.memo(_t,pe.Z);function Ot(e){const{isLast:t,collectionContextStore:o,dropzoneGap:r,resultProps:n,resultComponent:s,groupsPointer:l,shouldShowHoverMenu:a,canDrag:c,disabled:d,format:u,getItemSelectableStyle:p,handleOpenPeekPage:h,belowDropZoneMargin:m,analyticsName:S,direction:g,onSelectableEnter:f,canDrop:v,disableScrollToRevealHorizontal:y,touchDragOnly:x,blockPropertyValueOverlayStore:b,onSelectableInsertRow:w,disableSelectable:k,titleColumnIndex:T,nestedCreateSubitemButton:_,itemSelectableHaloStyle:V}=e,O=(0,X.VK)((()=>ae.Bm({store:e.store,collectionContextStore:o})),[o,e.store]),M=(0,i.useMemo)((()=>[]),[]);return O?(0,C.jsx)(xt,{getItemSelectableStyle:p,itemSelectableHaloStyle:V,store:e.store,canDrag:c,resultProps:n,resultComponent:s,collectionContextStore:o,groupsPointer:l,shouldShowHoverMenu:a,canDrop:v&&!d,format:u,handleOpenPeekPage:h,belowDropZoneMargin:m,analyticsName:S,disabled:d,direction:g,dropzoneGap:r,onSelectableEnter:f,disableScrollToRevealHorizontal:y,touchDragOnly:x,isLast:t,subitemPath:M,titleColumnIndex:T,blockPropertyValueOverlayStore:b,onSelectableInsertRow:w,disableSelectable:k,nestedCreateSubitemButton:_}):null}const Mt=i.memo(Ot,pe.Z);function Pt(e){let{collectionContextStore:t,groupsPointer:o,disableRequest:r,resultsReducerStore:i}=e;const n=(0,X.VK)((()=>i.state),[i]),s=(0,X.VK)((()=>t.groupsStore.getGroupState(o)),[t,o]),l=(0,X.VK)((()=>$e.default.getConfigKey("collection_reducer_request_settings","general_debounce_wait_ms")),[]);return!r&&n&&s?(0,C.jsx)(bt.Z,{id:o.length>0?`results:${(0,ee.KW)(o)}`:"collection_group_results",reducer:n,groupsPointer:o,collectionContextStore:t,resultStore:s.reducerResultStore,debounceWait:l}):null}var Rt=o(543145),jt=o(27105),It=o(623879),Ft=o(925489),Nt=o(897630);function Bt(e){var t;const{transaction:o,environment:r,collectionContextStore:i,isFullScreen:n,groupsPointer:s,insertAtIndex:l,from:a,transient:c,useCrdt:u}=e,p=null===(t=i.groupsStore.getGroupState(s))||void 0===t?void 0:t.resultsStore;if(!p)return;i.searchQueryStore.state&&le.Ug({searchQuery:"",collectionContextStore:i,isFullScreen:n});const h=E.IW({environment:r,collectionContextStore:i,groupsPointer:s,insertAtIndex:l,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:o,from:a,useCrdt:u});if(!h)return;const m=h.coercionSucceeded,S=h.newStore;if(r.device.isMobile)ne._c({environment:r,store:S,pageVisitSource:d.tY.Create});else if(m){const e=S.getBlockTitleStore();G.eP({environment:r,store:S}),U.NX({store:e}),le.Z5({store:S,transient:c})}else{const e="collectionTypedView"===i.contextType;se.CH({environment:r,store:S,peekMode:(0,ae.kr)(i),showMoveTo:e,resultsStore:p,collectionContextStore:i,pageVisitSource:d.tY.Create})}lt.W(r,{from:a,type:"page",new_page_id:S.id,creating_block_id:S.id,...(0,Ke.Pn)(i)})}var Et=o(489728);const At=function(e){let{shouldShowSpinner:t,color:o,collectionContextStore:r,isFullScreen:i,groupsPointer:n}=e;const s=(0,J.Fg)(),l=(0,Y.O7)(),a=s.lightTextColor;return(0,C.jsxs)(Et.Z,{icon:e=>(0,de.R)({...e,fill:o||a}),isLightGray:!0,isLarge:!0,style:{width:"100%",color:o||a},onClick:e=>function(e,t,o,r,i){if(!Nt.M_(r))return;q.createAndCommit({userAction:"BoardGroupAddItemButton.handleClick",environment:r,perform:n=>{Bt({transaction:n,environment:r,collectionContextStore:e,isFullScreen:t,groupsPointer:o,from:"board_group_add_item_bottom",transient:!1,useCrdt:i})}})}(r,i,n,l,(0,jt.SL)({event:e,source:"collection_non_table_view"})),onMouseDown:ye.$0,children:[(0,C.jsx)(P.FormattedMessage,{defaultMessage:"New",id:"database.boardView.addItemButtonTitle"}),t&&(0,C.jsx)("div",{style:{margin:"0 0 0 auto"},children:(0,C.jsx)(be.Z,{style:{width:12,height:12}})})]})};var Lt=o(508769),Dt=o(725651),Zt=o(654497),Ht=o(106404),zt=o(608055),Kt=o(487636),Gt=o(4827),Wt=o(76485),Ut=o(865089),qt=o(244831),$t=o(241137),Qt=o(203386),Yt=o(584076),Xt=o(731278),Jt=o(526388),eo=o(427016),to=o(965187),oo=o(88940),ro=o(296994),io=o(595645),no=o(128651),so=o(849616),lo=o(484210),ao=o(268056),co=o(165598),uo=o(80444),po=o(896049),ho=o(222294),mo=o(924666);const So=(0,P.defineMessages)({untitledBlock:{defaultMessage:"Untitled",id:"collectionViewCardItem.untitledBlock"},typeAName:{defaultMessage:"Type a name…",id:"collectionViewCardItem.itemName.placeholder"}});class go extends io.Z{constructor(){super(...arguments),this.lastProxiedUrl=void 0,this.storeTypes={mouseStore:no.Z,editModeStore:c.default},this.subitemCountIndicatorWrapStyle={display:"flex",alignItems:"center"},this.parentItemIndicatorWrapStyle={paddingRight:4,paddingTop:8,paddingBottom:0,paddingLeft:6,maxWidth:"100%"},this.onLoadProxiedImage=e=>{this.lastProxiedUrl=e},this.renderControl=e=>{let{isVisible:t,isRepositioning:o,handleCancelClick:r,handleRepositionClick:i,handleSavePositionClick:n}=e;const{store:s,coverFormat:l,coverAspectFormat:a,collectionContextStore:c}=this.props,{device:d}=this.environment,{isMobile:u}=d,p=this.lastProxiedUrl&&l&&"contain"!==a,h=c.permissionScopesStore.state,m=s.canEdit()&&("collectionTypedView"===c.contextType||s.canEdit())&&!h.isLocked&&h.canEditContent;if(t&&!this.shouldShowActionButtonStore.state)return;const S=Qe.default.state.open&&Qe.default.state.targetStore.id===s.id,g=ae.kr(c),f=(0,so.X9)(g,!1);return(0,C.jsxs)(Kt.Z,{isVisible:t,position:"top",children:[p&&!o&&!u&&(0,C.jsx)(xe.Z,{style:eo.ar,onClick:e=>i(e,this.lastProxiedUrl),children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Reposition",id:"collectionViewCardItem.action.reposition"})}),p&&o&&!u&&(0,C.jsx)(xe.Z,{style:eo.ar,onClick:n,children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Save position",id:"collectionViewCardItem.action.savePosition"})}),p&&o&&!u&&(0,C.jsx)(xe.Z,{style:eo.ar,onClick:r,children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Cancel",id:"collectionViewCardItem.action.cancel"})}),this.shouldShowEditButtonStore.state&&m&&!this.normalizedCardSelectionStore.state&&!h.isSyncedCollection&&!h.isExternallyImportedAndSyncedCollection&&(0,C.jsx)(Jt.Z,{renderTooltip:()=>(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Edit",id:"collectionCardItem.edit.tooltip"}),render:e=>(0,C.jsx)(xe.Z,{style:eo.ar,onClick:()=>{Ro(this.environment,this.props.store,this.props.collectionContextStore,this.stores.editModeStore,"click")},...e,children:(0,Dt.R)({width:16,height:16})})}),this.normalizedCardSelectionStore.state&&!S&&(0,C.jsx)(Jt.Z,{renderTooltip:()=>f.tooltip,render:e=>(0,C.jsx)(xe.Z,{style:eo.ar,onClick:()=>{this.peekUrlStore.state&&(zt.c4({environment:this.environment,url:this.peekUrlStore.state}),Io(this.stores.editModeStore))},...e,children:f.icon({width:14,height:14})})}),!o&&(0,C.jsx)(Jt.Z,{renderTooltip:()=>(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Rename, delete, move to and more…",id:"collectionViewCardItem.repositionAction.tooltip"}),render:e=>(0,C.jsx)(xe.Z,{style:eo.ar,onClick:e=>function(e,t,o,r){G.Ys({environment:t,store:r}),Ht.Qn({environment:t,stores:st.default.state.stores,left:e.clientX,top:e.clientY,showInput:!0,actionSectionGroupKey:$e.default.checkGate({gateName:"db_comments"})?"block_in_collection":"default",analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{collectionContextStore:o}})}(e,this.environment,this.props.collectionContextStore,this.props.store),...e,children:(0,ke.o)({width:14,height:14})})})]})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderProperty=e=>(0,C.jsx)(Uo,{store:this.props.store,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,schema:this.props.schema,format:this.props.format,collectionContextStore:this.props.collectionContextStore,disabled:this.props.disabled,editModeStore:this.stores.editModeStore,normalizedCardSelectionStore:this.normalizedCardSelectionStore,propertyFormat:e},e.property),this.renderFooterIcons=()=>{const{store:e}=this.props,t=co.Xp(e,{recursivelyLoadAllDiscussions:!1}),o=function(e,t){return(0,rt.wI)({collectionContextStore:e,blockStore:t})}(this.props.collectionContextStore,this.props.store),r=t>0;var i;if(r||o)return(0,C.jsxs)("div",{style:Go(this.environment,this.props.collectionContextStore,this.props.store,this.props.schema,this.props.format,this.props.shouldShowTitle,this.normalizedCardSelectionStore,r,o),children:[o&&(0,C.jsx)("div",{style:this.subitemCountIndicatorWrapStyle,children:(0,C.jsx)($t.B,{blockStore:e,collectionContextStore:this.props.collectionContextStore})}),(0,C.jsx)(Wt.s,{store:e,iconStyle:(i=this.theme,{display:"flex",alignItems:"center",color:i.lightTextColor,fill:i.lightTextColor,fontWeight:j.Z.fontWeight.medium,fontSize:12}),buttonStyle:{position:"relative",marginLeft:o?-3:0}})]})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockSpace=()=>{return e=this.environment,t=this.props.store,o=this.props.collectionContextStore,r=this.stores.editModeStore,void Ro(e,t,o,r,"space");var e,t,o,r},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEditButtonClick=e=>Ro(this.environment,this.props.store,this.props.collectionContextStore,this.stores.editModeStore,e),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleClick=e=>function(e,t,o,r){if(r.state)return void e.preventDefault();t(),Io(o)}(e,this.props.handleOpenPeekPage,this.stores.editModeStore,this.normalizedCardSelectionStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTextEnter=()=>Fo(this.environment,this.props.store,this.props.onTextEnter,this.props.onTextEsc,this.props.collectionContextStore,this.stores.editModeStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTextEsc=()=>No(this.environment,this.props.store,this.props.onTextEsc,this.props.collectionContextStore,this.stores.editModeStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTextTab=()=>Zo(this.environment,this.props.store,this.props.blockPropertyValueOverlayStore,this.props.schema,this.props.format,this.props.collectionContextStore,this.stores.editModeStore,this.normalizedCardSelectionStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTrackTitlePropertyEdit=()=>Bo(this.environment,this.props.collectionContextStore,this.props.store,this.stores.editModeStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTextUntab=()=>Ho(this.environment,this.props.store,this.props.schema,this.props.format,this.props.collectionContextStore,this.props.blockPropertyValueOverlayStore,this.stores.editModeStore,this.normalizedCardSelectionStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockPropertyEsc=()=>Eo(this.environment,this.props.blockPropertyValueOverlayStore,this.props.store,this.stores.editModeStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockPropertyTab=()=>zo(this.environment,this.props.store,this.props.blockPropertyValueOverlayStore,this.props.schema,this.props.format,this.props.collectionContextStore,this.stores.editModeStore,this.normalizedCardSelectionStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockPropertyUntab=()=>Ko(this.environment,this.props.store,this.props.blockPropertyValueOverlayStore,this.props.schema,this.props.format,this.props.collectionContextStore,this.stores.editModeStore,this.normalizedCardSelectionStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove=()=>{return e=this.stores.mouseStore,void(po.Z.state||e.setState({...e.state,mouseEntered:!0}));var e},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave=()=>{var e;(e=this.stores.mouseStore).setState({...e.state,mouseEntered:!1})},this.handleMouseMoveThrottled=R.P2(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove,100),this.handleMouseLeaveDebounced=R.Ds(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave,100),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRecordIconChange=e=>Ao(e,this.environment,this.props.store,this.stores.editModeStore),this.tryDeleteEmptyOnBlur=()=>{const{store:e,onTextEsc:t,collectionContextStore:o}=this.props,{editModeStore:r}=this.stores;"new_empty"!==r.state||this.normalizedCardSelectionStore.state||o.defaultPageTemplateStore.state||(t(e),this.normalizedCardSelectionStore.removeListener(this.tryDeleteEmptyOnBlur))},this.normalizedCardSelectionStore=this.createComputedStore((()=>{const e=pt.Z.state;return e.isActive&&e.store===this.props.store})),this.isItemSelectedStore=this.createComputedStore((()=>st.default.state.stores.includes(this.props.store))),this.shouldShowEditButtonStore=this.createComputedStore((()=>{const e=this.isEditingTitleStore.state,t=To(this.props.format,this.props.collectionContextStore),o=Lo(this.environment,this.props.store,this.props.schema,this.props.format,this.props.collectionContextStore,this.normalizedCardSelectionStore);return!e&&(this.props.shouldShowTitle||t.length>0&&t.length!==o.length)})),this.isEditingTitleStore=this.createComputedStore((()=>{var e;const{blockPropertyValueOverlayStore:t}=this.props,o=mo.default.state;return"editing"===o.mode&&(null===(e=(0,ao.QY)(o.multiSelection))||void 0===e?void 0:e.store)===(0,It.JI)(this.props.store)&&!t.state.isOpen})),this.peekUrlStore=this.createComputedStore((()=>{const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=uo.default.state;return ae.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})})),this.pageUrlStore=this.createComputedStore((()=>{const{store:e}=this.props;return(0,lo.ZP)({store:e,fullyQualified:!1,pageVisitSource:d.tY.LinkInPage})})),this.shouldShowActionButtonStore=this.createComputedStore((()=>{const{device:e}=this.environment,{isKeyboardMode:t}=ho.Z.state;return!e.isMobile&&this.canEdit()&&!t})),this.mouseIsEnteredStore=this.createComputedStore((()=>this.stores.mouseStore.state.mouseEntered&&!po.Z.state))}activate(){const e=this.peekUrlStore.state;e&&(this.props.handleOpenPeekPage(),zt.c4({environment:this.environment,url:e}))}UNSAFE_willMount(){var e;const{editModeStore:t}=this.stores,o=mo.default.state,r="editing"===o.mode&&(null===(e=(0,ao.QY)(o.multiSelection))||void 0===e?void 0:e.store)===(0,It.JI)(this.props.store),i=pt.Z.state,n=i.isActive&&i.transient;r&&n?t.setState("new_empty"):r?t.setState("new"):t.setState("existing")}didMount(){const{editModeStore:e}=this.stores;super.didMount(),this.normalizedCardSelectionStore.state&&"new_empty"===e.state&&this.normalizedCardSelectionStore.addListener(this.tryDeleteEmptyOnBlur)}willUnmount(){super.willUnmount(),this.normalizedCardSelectionStore.removeListener(this.tryDeleteEmptyOnBlur)}renderComponent(){const{device:e}=this.environment,{collectionContextStore:t,store:o,coverFormat:r,coverAspectFormat:n,coverWidth:s,coverHeight:l,coverSizeFormat:a,shouldShowTitle:c,colorStyle:d,onShiftEnter:u}=this.props,p=this.pageUrlStore.state,h=this.peekUrlStore.state,m=this.mouseIsEnteredStore.state,S=this.normalizedCardSelectionStore.state,g=ko(this.props.collectionContextStore),f=(0,i.createRef)(),v=(0,C.jsxs)(Yt.Z,{ref:f,style:{...Vo(d,t,this.theme),position:m?"relative":"static",..."gallery"===g&&{height:"100%"}},innerStyle:{userSelect:S?void 0:"none",WebkitUserSelect:S?void 0:"none",height:"100%",..."board"===g&&{minHeight:40},..."gallery"===g&&{display:"flex",flexDirection:"column"}},hoveredStyle:S?{background:_o(d,t,this.theme)}:Oo(d,t,this.theme),pressedStyle:S?{background:_o(d,t,this.theme)}:Mo(d,t,this.theme),href:p,metaHref:e.isMobile?p:h,onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced,onClick:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleClick,children:[(0,C.jsx)(oo.Z,{mouseStore:this.stores.mouseStore,onFlushTemporaryPosition:e=>function(e,t,o){const{imagePosition:r,reset:i}=e;q.createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:t,perform:e=>{re.bf({store:o,coverPosition:r,transaction:e}),i()}})}(e,this.environment,this.props.store),source:g,small:"small"===a,store:this.props.store,renderControl:this.renderControl,render:e=>{let{imagePosition:i}=e;return r&&(0,C.jsx)(ro.Ss,{variant:"gallery",store:o,coverWidth:s,coverHeight:l,coverFormat:r,coverAspectFormat:n,coverSizeFormat:a,coverPosition:i,showEmptyGalleryCover:"gallery"===g,onLoadProxiedImage:this.onLoadProxiedImage,isInHomeWidget:t.isInHomeWidgetStore.state})}}),jo(this.props.collectionContextStore,this.props.store)&&(0,C.jsx)("div",{style:this.parentItemIndicatorWrapStyle,children:(0,C.jsx)(qt.O,{blockStore:o,collectionContextStore:this.props.collectionContextStore})}),c&&(0,C.jsx)(Wo,{collectionContextStore:this.props.collectionContextStore,store:this.props.store,schema:this.props.schema,format:this.props.format,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,onTextEsc:this.props.onTextEsc,onTextEnter:this.props.onTextEnter,editModeStore:this.stores.editModeStore,normalizedCardSelectionStore:this.normalizedCardSelectionStore}),this.renderProperties(),this.renderFooterIcons()]}),y=this.isItemSelectedStore.state;return(0,C.jsx)(Qt.Z,{debugName:"CollectionViewCardItem",capture:S,onEsc:()=>{le.MO(),Io(this.stores.editModeStore)},onEnter:()=>function(e,t){t&&t(e)}(this.props.store,this.props.onTextEnter),onSpace:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockSpace,onTab:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockPropertyTab,onUntab:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEditButtonClick,children:(0,C.jsxs)(Qt.Z,{debugName:"CollectionViewCardItem",capture:y,onShiftEnter:()=>{q.createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:this.environment,perform:e=>{u({blocks:st.default.state.stores,transaction:e})}})},children:[v,wo(this.props.store,this.props.collectionContextStore)&&(0,C.jsx)(Ut.bZ,{origin:f})]})})}renderProperties(){const e=Lo(this.environment,this.props.store,this.props.schema,this.props.format,this.props.collectionContextStore,this.normalizedCardSelectionStore);if(0!==e.length)return(0,C.jsx)("div",{style:Po(this.props.shouldShowTitle,this.props.collectionContextStore),children:e.map(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderProperty)})}}go.displayName="CollectionViewCardItem";const fo=go,Co={float:"left",marginTop:2,marginRight:4,marginLeft:-2},vo={float:"left",marginTop:0,marginRight:4,marginLeft:-2},yo={fontSize:14,lineHeight:1.5,minHeight:21,fontWeight:j.Z.fontWeight.medium,width:"auto"},xo={fontSize:16,lineHeight:1.5,minHeight:24,fontWeight:j.Z.fontWeight.medium,width:"auto"};function bo(e,t){const o=t[e];return Boolean(o&&!ce.uk.includes(o.type))}function wo(e,t){var o,r,i;return!(e.getSpaceId()!==(null===(o=uo.default.state.currentSpaceStore)||void 0===o?void 0:o.id))&&((null===(r=t.collectionViewStore())||void 0===r?void 0:r.getFormat().app_config_uri)===u.g3&&e.getFormat().app_config_uri===u.z3&&"sprint_board"===(null===(i=uo.default.state.mainEditorCurrentBlockStore)||void 0===i?void 0:i.getFormat().special_page_for_pm_launch))}function ko(e){const t=e.collectionViewStore();return null==t?void 0:t.getType()}function To(e,t){return(("board"===ko(t)?e.board_properties:e.gallery_properties)||[]).filter((e=>e.visible))}function _o(e,t,o){return"board"===ko(t)?(null==e?void 0:e.cardBackgroundColor)||o.boardItemDefaultBackground:o.collectionGalleryPreviewCardBackground}function Vo(e,t,o){const r=ko(t),i=t.isInHomeWidgetStore.state;return{...i?{boxShadow:o.homeShadow.card.base}:{boxShadow:e?o.selectTypeBoardBoxShadow:o.lightBoxShadow},borderRadius:i?6:"board"===r?4:3,background:_o(e,t,o),overflow:"hidden",transition:"background 100ms ease-out",..."board"===r&&{marginBottom:Gn}}}function Oo(e,t,o){return t.isInHomeWidgetStore.state?{background:_o(e,t,o),boxShadow:o.homeShadow.card.hovered}:{background:(null==e?void 0:e.cardHoveredBackgroundColor)||o.cardHoveredBackground}}function Mo(e,t,o){return t.isInHomeWidgetStore.state?{background:_o(e,t,o),boxShadow:o.homeShadow.card.hovered}:{background:(null==e?void 0:e.cardPressedBackgroundColor)||o.cardPressedBackground}}function Po(e,t){const o=ko(t),r=t.isInHomeWidgetStore.state;return{paddingTop:e?0:8,paddingBottom:10,..."board"===o&&{lineHeight:1.5,paddingBottom:4,display:"flex",flexDirection:"column"},..."gallery"===o&&r&&{display:"flex",flexWrap:"wrap"}}}function Ro(e,t,o,r,i){const n=(0,It.JI)(t);G.eP({environment:e,store:t}),U.NX({store:n}),le.Z5({store:t}),i&&I.sd(e,"board_item_edit_mode_enter",{...(0,Ke.Pn)(o),block_id:t.id,from:i,view_type:ko(o)}),r.setState("existing")}function jo(e,t){return(0,rt.Cr)({collectionContextStore:e,blockId:t.id,blockStore:t})}function Io(e){"new_empty"===e.state&&(e.setState("new"),pt.Z.state.isActive&&pt.Z.setState({...pt.Z.state,transient:!1}))}function Fo(e,t,o,r,i,n){le.MO(),U.ZH({debug:{userAction:"CollectionViewCardItem.handleTextEnter"},environment:e});t.canEdit()&&i.permissionScopesStore.state.canEditContent&&("new_empty"===n.state?r(t):"new"===n.state?o(t):G.Ys({environment:e,store:t}),Io(n))}function No(e,t,o,r,i){le.MO();t.canEdit()&&r.permissionScopesStore.state.canEditContent&&("new_empty"===i.state?o(t):G.Ys({environment:e,store:t}),Io(i))}function Bo(e,t,o,r){const i=ko(t);i&&(F.rv({environment:e,collectionContextStore:t,block_id:o.id,property:"title",property_type:"text",from:i}),Io(r))}function Eo(e,t,o,r){ct.xv({environment:e,blockPropertyValueOverlayStore:t}),G.Ys({environment:e,store:o}),Io(r)}async function Ao(e,t,o,r){const i=o.getIconStore();if(i){const{serverCommitResult:o}=q.createAndCommit({userAction:"PageViewBlock.handleRecordIconChange",environment:t,perform:t=>{ie.sO({store:i,value:e,transaction:t})}});await o}Io(r)}function Lo(e,t,o,r,i,n){const s=To(r,i);if(!t.isDefined())return[];return s.filter((r=>{const i=n.state&&"title"!==r.property;return(0,Lt.X)({block:t.getModel(),property:r.property,schema:o,getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,He.r)(),intl:We.default.getIntl()})||i}))}function Do(e,t,o,r,i,n){return 0===Lo(e,t,o,r,i,n).length}function Zo(e,t,o,r,i,n,s,l){const a=Lo(e,t,r,i,n,l).map((e=>e.property));a.length>0&&ct.bA({environment:e,blockPropertyValueOverlayStore:o,store:t,property:a[0],format:mt.C.Page,collectionContextStore:n}),Io(s)}function Ho(e,t,o,r,i,n,s,l){const a=Lo(e,t,o,r,i,l).map((e=>e.property)),c=R.dF(a,((e,t)=>bo(e,o)));c&&ct.bA({environment:e,blockPropertyValueOverlayStore:n,store:t,property:c,format:mt.C.Page,collectionContextStore:i}),Io(s)}function zo(e,t,o,r,i,n,s,a){const c=o.state,d=Lo(e,t,r,i,n,a).map((e=>e.property)),u=c.isOpen?d.findIndex((e=>e===c.property)):-1,p=d.find(((e,t)=>t>u&&bo(e,r)))||d.find(((e,t)=>!a.state&&bo(e,r)));p?l.default.afterNextFlush((()=>{ct.bA({environment:e,blockPropertyValueOverlayStore:o,store:t,property:p,format:mt.C.Page,collectionContextStore:n})})):a.state&&l.default.afterNextFlush((()=>{Ro(e,t,n,s)})),ct.xv({environment:e,blockPropertyValueOverlayStore:o}),Io(s)}function Ko(e,t,o,r,i,n,s,a){const c=o.state;if(!c.isOpen)return;const d=Lo(e,t,r,i,n,a).map((e=>e.property)),u=d.findIndex((e=>e===c.property)),p=R.dF(d,((e,t)=>t<u&&bo(e,r)))||R.dF(d,((e,t)=>!a.state&&bo(e,r)));p?l.default.afterNextFlush((()=>{ct.bA({environment:e,blockPropertyValueOverlayStore:o,store:t,property:p,format:mt.C.Page,collectionContextStore:n})})):a.state&&l.default.afterNextFlush((()=>{Ro(e,t,n,s)})),ct.xv({environment:e,blockPropertyValueOverlayStore:o}),Io(s)}function Go(e,t,o,r,i,n,s,l,a){const c=ko(t);return{display:"flex",alignItems:"center",paddingLeft:l&&!a?4:10,paddingRight:10,paddingBottom:l?4:8,..."gallery"===c&&{paddingTop:Do(e,o,r,i,t,s)&&!n?8:0},..."board"===c&&l&&{marginTop:-2}}}const Wo=i.memo((function(e){let{collectionContextStore:t,store:o,schema:r,format:n,blockPropertyValueOverlayStore:s,onTextEsc:l,onTextEnter:a,editModeStore:c,normalizedCardSelectionStore:d}=e;const u=(0,J.Fg)(),p=(0,Y.O7)(),h=(0,P.useIntl)(),m=(0,i.useCallback)((()=>Bo(p,t,o,c)),[p,t,o,c]),{collectionViewBlockId:S,collectionViewId:g}=(0,X.VK)((()=>{var e,o;return{collectionViewId:null===(e=t.collectionViewStore())||void 0===e?void 0:e.id,collectionViewBlockId:null===(o=t.collectionViewBlockStore())||void 0===o?void 0:o.id}}),[t]),f=(0,i.useMemo)((()=>({type:"page_property_value_match",propertyId:"title",collectionViewId:g,collectionViewBlockId:S})),[S,g]),v=(0,i.useCallback)((()=>Ho(p,o,r,n,t,s,c,d)),[p,o,r,n,t,s,c,d]),y=(0,i.useCallback)((()=>Zo(p,o,s,r,n,t,c,d)),[p,o,s,r,n,t,c,d]),x=(0,i.useCallback)((()=>No(p,o,l,t,c)),[p,o,l,t,c]),b=(0,i.useCallback)((()=>Fo(p,o,a,l,t,c)),[p,o,a,l,t,c]),w=(0,i.useCallback)((e=>Ao(e,p,o,c)),[p,o,c]),{device:k}=p,T=(0,X.VK)((()=>(0,It.JI)(o)),[o]),_=(0,X.VK)((()=>(o.hasIcon()||!o.isEmptyPage())&&t.shouldShowPageIcon()),[o,t]),V=(0,X.VK)((()=>o.hasError()),[o]),O=(0,X.VK)((()=>o.canEdit()&&t.permissionScopesStore.state.canEditContent),[o,t]),M=(0,X.VK)((()=>d.state),[d]),R=(0,X.VK)((()=>ko(t)),[t]),j=(0,X.VK)((()=>function(e){return{..."board"===ko(e)&&{marginTop:1,marginLeft:0,marginRight:2,borderRadius:5,padding:2,width:24,height:24}}}(t)),[t]),I=(0,X.VK)((()=>o.getIcon()),[o]),F=(0,X.VK)((()=>o.isEmptyPage()),[o]),N=(0,X.VK)((()=>function(e,t,o,r,i,n){const s=ko(t);return{..."gallery"===s&&{width:"100%"},display:"flex",paddingTop:jo(t,o)?4:8,paddingLeft:"board"===s?6:10,paddingRight:10,paddingBottom:"gallery"===s&&Do(e,o,r,i,t,n)?10:6,position:"relative"}}(p,t,o,r,n,d)),[p,t,o,r,n,d]),B=O?(0,C.jsx)(Xt.Z,{disabled:!1,bucket:"secure",style:{...j,...k.isMobile?vo:Co,..."board"===R&&{marginTop:1,marginLeft:0,marginRight:2,borderRadius:5,padding:2,width:24,height:24}},progressContainerStyle:{top:14,bottom:"unset",right:"unset",fontSize:12},icon:I,store:o,onChange:w,size:k.isMobile?24:20,isEmptyPage:F}):(0,C.jsx)(Xt.Z,{disabled:!0,bucket:"secure",style:{...j,...k.isMobile?vo:Co},progressContainerStyle:{top:14,bottom:"unset",right:"unset",fontSize:12},icon:I,store:o,size:k.isMobile?24:O?20:18,isEmptyPage:F}),E=(0,C.jsx)(to.Z,{store:T,disabled:!M,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:b,onEsc:x,onTab:y,onUntab:v,onChange:m,placeholder:M?h.formatMessage(So.typeAName):h.formatMessage(So.untitledBlock),style:{...k.isMobile?xo:yo,..."board"===R&&{flexGrow:1,padding:2},pointerEvents:M?void 0:"none",cursor:M?"text":void 0,..."gallery"===R&&{whiteSpace:"pre-wrap"}},disableSelectAllBlocks:!0,pasteBehavior:"inline",inPageFind:f});return(0,C.jsxs)("div",{style:N,children:[(_||M)&&!V&&B,V&&(0,Zt.t)({fill:u.accentColors.orange[500],width:k.isMobile?20:16,marginLeft:k.isMobile?2:4,marginRight:k.isMobile?4:6,paddingBottom:6,paddingTop:6,display:"inline-block",verticalAlign:"bottom"}),E]})})),Uo=i.memo((function(e){let{propertyFormat:t,store:o,blockPropertyValueOverlayStore:r,schema:n,format:s,collectionContextStore:l,disabled:a,editModeStore:c,normalizedCardSelectionStore:d}=e;const u=(0,Y.O7)(),p=(0,i.useCallback)((()=>Ko(u,o,r,n,s,l,c,d)),[u,o,r,n,s,l,c,d]),h=(0,i.useCallback)((()=>zo(u,o,r,n,s,l,c,d)),[u,o,r,n,s,l,c,d]),m=(0,i.useCallback)((()=>Eo(u,r,o,c)),[u,r,o,c]),S=(0,X.VK)((()=>o.getAssociatedCollectionStore()),[o]),g=(0,X.VK)((()=>d.state),[d]),f="gallery"===(0,X.VK)((()=>ko(l)),[l])?mt.C.GalleryView:mt.C.Board,v=(0,X.VK)((()=>Boolean(l.normalizedFormatStore.state.table_wrap)),[l]),y=(0,X.VK)((()=>o.canEdit()),[o]),x=(0,X.VK)((()=>l.collectionViewStore()),[l]),b=(0,X.VK)((()=>l.permissionScopesStore.state.isLocked||!l.permissionScopesStore.state.canEditContent),[l]);return S?(0,C.jsx)(Gt.Z,{store:o,property:t.property,disabled:a||!y,locked:b,format:f,tableWrap:v||Boolean(t.wrap),blockPropertyValueOverlayStore:r,collectionStore:S,showIfEmpty:g,onEnter:m,onEsc:m,onBgClick:m,onTab:h,onUntab:p,collectionViewStore:x},t.property):null}));const qo=function(e){let{store:t,disabled:o,isFirstItem:r,isLastItem:i,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:h,format:m,schema:S,coverFormat:g,coverAspectFormat:f,coverSizeFormat:v,shouldShowTitle:y,colorStyle:x,onTextEnter:b,onTextEsc:w,onShiftEnter:k,blockPropertyValueOverlayStore:T,isLast:_,handleOpenPeekPage:V,collectionContextStore:O}=e;return(0,C.jsx)(fo,{store:t,disabled:o,isFirstItem:r,isLastItem:i,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:h,format:m,schema:S,coverFormat:g,coverAspectFormat:f,coverSizeFormat:v,coverHeight:void 0,coverWidth:void 0,shouldShowTitle:y,colorStyle:x,onTextEnter:b,onTextEsc:w,onShiftEnter:k,blockPropertyValueOverlayStore:T,isLast:_,handleOpenPeekPage:V,collectionContextStore:O})};var $o=o(134232),Qo=o(337989),Yo=o(816187),Xo=o(177546),Jo=o(305971),er=(o(757658),o(545453)),tr=o(309056),or=o(937612),rr=o(531701),ir=o(693405),nr=o(840721),sr=o(409050);const lr="color";const ar=function(e){let{parent:t,groupFormat:o,collectionContextStore:r,groupsFormatKey:n,format:s,query:l,currentGroups:a,groupsLimitStore:c,schema:d}=e;const u=(0,Y.O7)(),p=(0,P.useIntl)(),{device:h}=u,m=(0,X.VK)((()=>R.oA([ur(u,o,r,n,s,l,a,c,p),cr(u,d,o,r)])),[u,o,r,n,s,l,a,c,p,d]),S=(0,i.useCallback)((e=>{"string"==typeof e.key&&e.key.includes(lr)||t.close()}),[t]);let g;return g=h.isMobile?{menuType:Oe.og.Modal,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Action",id:"database.collectionGroupActionMenu.title"}),right:(0,C.jsx)(nr.DoneMenuText,{}),onClickRight:t.close}:{menuType:Oe.og.Popup},(0,C.jsx)(Pe.Z,{...g,children:(0,C.jsx)(Re.Z,{type:Re.i.Vertical,initialFocus:0,sections:m,onAccept:S})})};function cr(e,t,o,r){const i=o.value;if(void 0===i.value)return;const n=t[o.property];if(!n)return;if("select"!==n.type&&"multi_select"!==n.type)return;if(i.type!==n.type)return;const s=(n.options||[]).find((e=>e.value===i.value));if(!s)return;const l=rr.AP.map((i=>{const n={key:`${lr}_${i}`,render:e=>(0,C.jsx)(sr.Z,{...e,color:i,checkState:s.color===i}),action:()=>{!function(e,t,o,r,i){const n=r[o.property];if(!n)return;if(!ce.cu(n))return;const s=i.collectionStore();if(!s)return;const l=o.value;if(l.type!==n.type)return;const a=(n.options||[]).map((t=>t.value===l.value?{...t,color:e}:t)),c={...n,options:a},d={...r,[o.property]:c};q.createAndCommit({userAction:"CollectionGroupActionMenu.handleSelectPropertyColorPickerChange",environment:t,perform:e=>{le.Rm({environment:t,collectionStore:s,update:{schema:d},transaction:e})}}),F.wd({environment:t,collectionContextStore:i,action:"group_change_color"})}(i,e,o,t,r)}};return n}));return{key:"collection color section",render:e=>(0,C.jsx)(je.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Colors",id:"database.collectionGroupActionMenu.colorSectionTitle"}),topBorder:!0}),items:l}}function dr(e,t,o,r,i,n){ze.showDialog({message:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Are you sure? All pages inside this group will be deleted.",id:"database.collectionGroupActionMenu.deleteDialogMessage"}),showCancel:!0,keepFocus:!1,items:[{label:"Delete",color:"red",onAccept:()=>async function(e,t,o,r,i,n){const s=t.collectionStore();if(!s)return;const l=r.value;if("relation"===l.type&&(0,ee.RA)(l.value)){const e=Ye.G.createChildStore(s,{id:l.value.id,table:_.iU});await e.load();const t=e.getAssociatedCollectionStore();await(null==t?void 0:t.load())}q.createAndCommit({userAction:"CollectionGroupActionMenu.handleDelete",environment:e,perform:l=>{E.iE({environment:e,collectionStore:s,property:r.property,groupFormat:r,currentGroups:o,groupsFormatKey:i,collectionContextStore:t,transaction:l,intl:n})}}),F.wd({environment:e,collectionContextStore:t,action:"delete_group"})}(e,t,o,r,i,n)}]})}function ur(e,t,o,r,i,n,s,l,a){const c=[],d=t.value,u=o.permissionScopesStore.state,p="board_columns"===r?void 0===n.aggregations:void 0===i.collection_group_aggregation;(0,Yo.hX)()&&(p?c.push({key:"addAggregation",render:e=>(0,C.jsx)(ir.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Show aggregation",id:"database.collectionGroupActionMenu.addAggregationTitle"}),svg:tr.g}),action:()=>function(e,t,o,r){const i=r.collectionViewStore();if(i)if("board_columns"===t){const t={...o,aggregations:[ee.Vb]};q.createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,perform:e=>{le.iG({collectionViewStore:i,update:{query2:t},transaction:e})}})}else q.createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,perform:e=>{re.FH({stores:[i],update:{collection_group_aggregation:ee.Vb},transaction:e})}})}(e,r,n,o)}):c.push({key:"removeAggregation",render:e=>(0,C.jsx)(ir.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Hide aggregation",id:"database.collectionGroupActionMenu.removeAggregationTitle"}),svg:er.p}),action:()=>function(e,t,o,r){const i=r.collectionViewStore();if(i)if("board_columns"===t){const t={...o,aggregations:void 0};q.createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,perform:e=>{le.iG({collectionViewStore:i,update:{query2:t},transaction:e})}})}else q.createAndCommit({userAction:"CollectionGroupActionMenu.handleHideGroupAggregation",environment:e,perform:e=>{re.FH({stores:[i],update:{collection_group_aggregation:void 0},transaction:e})}})}(e,r,n,o)})),(0,ee.eF)(t)?c.push({key:"show",render:e=>(0,C.jsx)(ir.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Show group",id:"database.collectionGroupActionMenu.showButtonTitle"}),svg:tr.g}),action:()=>function(e,t,o,r,i,n){const s={...t,hidden:!1},l=(0,Ge.nr)(i,s,n.state);q.createAndCommit({userAction:"CollectionGroupActionMenu.handleShow",environment:e,perform:e=>{E.A6({collectionContextStore:o,newGroups:l,groupsFormatKey:r,transaction:e})}}),F.wd({environment:e,collectionContextStore:o,action:"show_group"})}(e,t,o,r,s,l)}):c.push({key:"hide",render:e=>(0,C.jsx)(ir.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Hide group",id:"database.collectionGroupActionMenu.hideButtonTitle"}),svg:er.p}),action:()=>function(e,t,o,r,i){const n={...t,hidden:!0},s=(0,Ge.ar)(i,n);q.createAndCommit({userAction:"CollectionGroupActionMenu.handleHide",environment:e,perform:e=>{E.A6({collectionContextStore:o,newGroups:s,groupsFormatKey:r,transaction:e})}}),F.wd({environment:e,collectionContextStore:o,action:"hide_group"})}(e,t,o,r,s)}),void 0===d.value||!u.canEditContent||u.isSyncedCollection||"collectionTypedView"===o.contextType||u.isExternallyImportedAndSyncedCollection||c.push({key:"delete",render:e=>(0,C.jsx)(ir.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Delete pages",id:"database.collectionGroupActionMenu.deleteButtonTitle"}),svg:or.y}),action:()=>dr(e,o,s,t,r,a)});return{key:"collection group",render:e=>(0,C.jsx)(je.Z,{...e}),items:c}}var pr=o(847853),hr=o(98742);function mr(e,t){const{calculating:o,aggregation:r}=e.asyncAggregationStatusStore.state;return r?o&&(0,R.Xy)(t,r):o}function Sr(e){let{collectionContextStore:t,aggregation:o,children:r}=e;const{isCalculating:n,changingType:s}=(0,X.VK)((()=>({isCalculating:mr(t,o),changingType:t.asyncAggregationStatusStore.state.changingType})),[t,o]),l=function(e,t){const o=(0,i.useRef)(e);return(0,i.useEffect)((()=>{t||void 0===e&&"-"===e||(o.current=e)}),[t,e]),o.current}(r,n);return n?s?(0,C.jsx)(be.Z,{}):(0,C.jsx)("span",{style:{opacity:.5},children:l??r}):(0,C.jsx)(C.Fragment,{children:r})}const gr=(0,P.defineMessages)({propertyAggregation:{id:"collection.aggregation.propertyType",defaultMessage:"{aggregationType} in {propertyName}{calculating, select, true { (Calculating…)} other {}}"},aggregationType:{id:"collection.aggregation.aggregationType",defaultMessage:"{aggregationType}{calculating, select, true { (Calculating…)} other {}}"},aggregationCalculating:{id:"collection.aggregation.calculating",defaultMessage:"Calculating…"}});var fr=o(886825),Cr=o(842782);function vr(e){let{schema:t,groupFormat:o,format:r,groupAggregationKey:i,collectionContextStore:n,disabled:s}=e;const l=(0,J.Fg)(),a=(0,Y.Fy)(),c=(0,X.VK)((()=>r[i]||{aggregator:"count"}),[r,i]),d=(0,X.VK)((()=>({type:"aggregation",filter:(0,Ze.zk)({schema:t,group:o,propertyMapping:void 0,timeZone:(0,He.r)()}),aggregation:c})),[t,o,c]);return(0,C.jsx)(Jt.Z,{renderTooltip:()=>(0,C.jsx)(Or,{schema:t,collectionContextStore:n,aggregation:c}),render:e=>(0,C.jsx)(Te.ZP,{popupType:a.isMobile?Te.Z4.SlideUp:Te.Z4.Popup,renderOrigin:r=>(0,C.jsx)(Et.Z,{disabled:s,style:{fontWeight:j.Z.fontWeight.medium,color:l.lightTextColor,height:24},...(0,hr.Z)((0,hr.Z)(e,r),{onClick:ye.Wi}),children:(0,C.jsx)(Vr,{schema:t,collectionContextStore:n,groupFormat:o,aggregation:c,reducer:d})}),disabled:s,render:e=>(0,C.jsx)(_r,{aggregation:c,parent:e,collectionContextStore:n,format:r,groupAggregationKey:i,schema:t})})})}function yr(e){let{aggregationType:t,isSelected:o,label:r,props:i}=e;const n=Yo.Sn[t];return(0,C.jsx)(Jt.Z,{placement:Ve.GI.Placement.Right,delayThreshold:0,render:e=>(0,C.jsx)(Me.Z,{title:r,checkState:o,...(0,hr.Z)(e,i)}),renderTooltip:()=>(0,C.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[n&&(0,C.jsx)("img",{src:(0,pr.D)(n),style:{borderRadius:4,width:140,marginTop:4}}),Yo.BG[t]]})},i.key)}function xr(e,t,o,r,i){const n=o.collectionViewStore();n&&(o.isLoadingStore.state||o.loadingDetailsStore.setState({type:"load_aggregation"}),o.isClientModeEnabledStore.state||o.asyncAggregationStatusStore.setState({calculating:!0,aggregation:e,changingType:!0}),q.createAndCommit({userAction:"CollectionGroupAggregation.handleChangeAggregation",environment:t,perform:t=>{le.iG({collectionViewStore:n,update:{format:{...r,[i]:e}},transaction:t})}})),F.wd({environment:t,collectionContextStore:o,action:"change_aggregation"})}function br(e,t,o,r,i,n){const s=Yo.VN[t];return{key:t,render:o=>(0,C.jsx)(yr,{isSelected:e,aggregationType:t,label:s,props:o}),action:()=>{xr({aggregator:t},o,r,i,n)}}}function wr(e,t,o,r,i){const n=e.enforceMaxAggregationLimit??!1,s={...e,enforceMaxAggregationLimit:!n};return{key:"aggregationLimitToggle",render:e=>(0,C.jsx)("div",{children:(0,C.jsx)(fr.Z,{...e,caption:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"This improves performance for large databases.",id:"BoardAggregations.aggregationLimitToggle.description"}),shouldWrapCaption:!0,captionStyle:{width:"90%",marginTop:5},style:{alignItems:void 0},title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Show large counts as 99+",id:"BoardAggregations.aggregationLimitToggle.title"}),on:n,focused:!1,onClick:()=>xr(s,t,o,r,i)})}),action:()=>{}}}function kr(e,t,o,r,i,n,s,l){const{device:a}=r,c=Yo.VN[t],d=R.oA(o.map((o=>function(e,t,o,r,i,n,s,l){const a=i[t];if(!a)return;const c=a.name;return{key:`${t}${o}`,render:t=>(0,C.jsx)(yr,{isSelected:e,aggregationType:o,label:c,props:t}),action:()=>{xr({aggregator:o,property:t},r,n,s,l)}}}((null==e?void 0:e.aggregator)===t&&(null==e?void 0:e.property)===o,o,t,r,i,n,s,l)))),u=d.findIndex((o=>o.key===`${e.property}${t}`));return{key:t+c,render:(e,t)=>(0,C.jsx)(Cr.Z,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,C.jsx)(Me.Z,{...e,ref:t,title:c}),renderExtension:(e,o)=>{let r;return r=a.isMobile?{menuType:Oe.og.Modal,title:c,right:a.isPhone?(0,C.jsx)(nr.DoneMenuText,{}):void 0,onClickRight:o.close,...e}:{menuType:Oe.og.Popup,width:200,...e},(0,C.jsx)(Pe.Z,{...r,children:(0,C.jsx)(Re.Z,{type:Re.i.Vertical,initialFocus:u,sections:[{key:"results",render:e=>(0,C.jsx)(je.Z,{...e}),items:d}],onAccept:t.onAccept})})}}),action:()=>null}}function Tr(e,t,o,r,i,n){const s={};for(const u of p.o5)s[u]=br(e.aggregator===u,u,t,o,r,i);const l=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,p.iV)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}(n);if(l.length>0)for(const u of p.Sy)"show_unique"!==u&&(s[u]=kr(e,u,l,t,n,o,r,i));const a=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,p.O4)(o)}))}(n);if(a.length>0)for(const u of p.k$)s[u]=kr(e,u,a,t,n,o,r,i);const c=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,p.dN)(o)}))}(n);if(c.length>0)for(const u of p.f8)s[u]=kr(e,u,c,t,n,o,r,i);const d=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,p.Mv)(o)}))}(n);if(d.length>0)for(const u of p.gC)s[u]=kr(e,u,d,t,n,o,r,i);return s}function _r(e){let{aggregation:t,parent:o,collectionContextStore:r,format:i,groupAggregationKey:n,schema:s}=e;const l=(0,Y.O7)(),{device:a}=l,c=(0,X.VK)((()=>(0,Yo.hX)()),[]),{actions:d,initialFocus:u}=function(e,t,o,r,i,n,s){const{device:l}=t,a=[];let c=0,d=0;const u=Tr(e,t,o,r,i,n);let h=0;return Object.entries(p.cY).forEach((n=>{let[p,m]=n;const S=[];for(const t of m)u[t]&&(S.push(u[t]),e.aggregator===t&&(c=h,d=S.length-1));const g=[];if(s&&"count_aggregations"===p&&g.push({key:"limitToggleSection",render:e=>(0,C.jsx)(je.Z,{...e}),items:[wr(e,t,o,r,i)]}),g.push({key:"aggregations",render:e=>(0,C.jsx)(je.Z,{topBorder:!0,...e}),items:S}),S.length>0){h++;const e=Yo.nL[p],t={key:e,render:(t,o)=>(0,C.jsx)(Cr.Z,{...t,disableDefaultClick:!0,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,C.jsx)(Me.Z,{...t,ref:o,title:e}),renderExtension:(t,r)=>{let i;return i=l.isMobile?{menuType:Oe.og.Modal,title:e,right:(0,C.jsx)(nr.DoneMenuText,{}),onClickRight:r.close,...t}:{menuType:Oe.og.Popup,width:250,...t},(0,C.jsx)(Pe.Z,{...i,children:(0,C.jsx)(Re.Z,{type:Re.i.Vertical,initialFocus:d,sections:g,onAccept:(e,t,i)=>{r.close(),o.onAccept&&o.onAccept(e,t,i)}})})}}),action:()=>null};a.push(t)}})),{actions:a,initialFocus:c}}(t,l,r,i,n,s,c);let h;return h=a.isMobile?{menuType:Oe.og.Modal,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Aggregation",id:"database.collectionGroupAggregation.title"}),right:(0,C.jsx)(nr.DoneMenuText,{}),onClickRight:o.close}:{menuType:Oe.og.Popup,width:200},(0,C.jsx)(Pe.Z,{...h,children:(0,C.jsx)(Re.Z,{type:Re.i.Vertical,initialFocus:u,sections:[{key:"aggregation section",render:e=>(0,C.jsx)(je.Z,{...e}),items:d}],onAccept:o.close})})}function Vr(e){let{schema:t,collectionContextStore:o,groupFormat:r,aggregation:i,reducer:n}=e;return n?(0,C.jsx)(bt.Z,{id:`group_aggregation:${(0,ee.mD)(r)}`,collectionContextStore:o,reducer:n,groupsPointer:[r],render:e=>{const r=e.state;let n,s;if((0,p.pK)(i)){const e=t[i.property];!e||"formula"!==e.type&&"number"!==e.type||(n=e.number_format),e&&"date"===e.type&&(s=e.date_format)}return(0,C.jsx)(Sr,{aggregation:i,collectionContextStore:o,children:r?(0,Yo.Zy)({numberFormat:n,dateFormat:s,aggregation:i,userTimeZone:(0,He.r)(),value:r.aggregationResult,roundDecimal:5}):"-"})}}):null}function Or(e){let{schema:t,collectionContextStore:o,aggregation:r}=e;const i=(0,P.useIntl)(),n=Yo.VN[(0,p.OV)(r)],s=(0,X.VK)((()=>mr(o,r)),[o,r]);if((0,p.pK)(r)){const e=t[r.property];if(e){const t=e.name;return(0,C.jsx)(C.Fragment,{children:i.formatMessage(gr.propertyAggregation,{aggregationType:n,propertyName:t,calculating:s})})}}return(0,C.jsx)(C.Fragment,{children:i.formatMessage(gr.aggregationType,{aggregationType:n,calculating:s})})}var Mr=o(538769),Pr=function(e){return e[e.Top=0]="Top",e[e.Bottom=1]="Bottom",e[e.IGNORE=2]="IGNORE",e}(Pr||{});const Rr=Pr;var jr=o(434859),Ir=o(953336);function Fr(e){return e?Rr.IGNORE:Rr.Top}function Nr(e){const{style:t,children:o,isInHomeWidget:r}=e,i=(0,J.yK)((()=>({scroller:{height:"100%",maxHeight:"inherit",...r&&{paddingTop:12},...t}})),[r,t]);return(0,C.jsx)(Ir.Z,{type:jr.Z.Y,style:i.scroller,children:o})}var Br=o(45697),Er=o.n(Br),Ar=o(455010),Lr=o(304926);function Dr(e){const{element:t,container:o}=e,r=function(e){for(;;){const t=Kr(e);if(!t)return e;e=t}}(o),{store:i}=r.stores,{containerMap:n}=i.state,s=n.get(o);s?s.add(t):n.set(o,new Set([t])),i.emit()}function Zr(e,t,o,r){return e<-r||e>t?0:e>=t-o-1?t-o+r-1:e+r}function Hr(e,t,o,r){return e-r<0||e>t?0:e<o?o-t:e-t}function zr(e){const t=[];for(;;){const o=Kr(e);if(!o)break;e=o,t.push(e)}return t}function Kr(e){if(e.context.computedStickyContainer&&!e.props.ignoreAncestorContainer)return e.context.computedStickyContainer}function Gr(e,t){for(const o in t)e.style[o]=t[o]||""}o(95477);class Wr extends s.Z{constructor(){super(...arguments),this.element=void 0}didMount(){const{computedStickyContainer:e}=this.context;e&&Dr({element:this,container:e});const t=n.findDOMNode(this);if(t){this.element=t;const e=this.props.getComputedStyle?this.props.getComputedStyle(!1):void 0;e&&Gr(t,e)}}willUnmount(){const{computedStickyContainer:e}=this.context;e&&function(e){const{element:t,container:o}=e,{store:r}=o.stores,{containerMap:i}=r.state,n=i.get(o);n&&n.delete(t),r.emit()}({element:this,container:e}),this.element=void 0}renderComponent(){if(this.props.children)return i.Children.only(this.props.children)}}Wr.displayName="ComputedStickyElement",Wr.contextTypes={computedStickyContainer:Er().any,...s.w};const Ur=Wr;function qr(e){const{onMount:t,isInPeekRenderer:o,style:r,paddingTop:n,disabled:s,getComputedStickyStyle:a,groupFormat:c,collectionContextStore:d,format:u,groupAggregationKey:p}=e,[h,m]=(0,i.useState)(void 0),S=(0,Y.O7)(),g=(0,i.useRef)(null);(0,i.useEffect)((()=>{null==t||t()}),[t]),(0,i.useEffect)((()=>{const e=d.collectionViewBlockStore();e&&m(new Ye.G(S,{table:_.iU,id:e.id}))}),[d,S]);const f=(0,X.VK)((()=>d.groupsStore.getGroupState(c)),[d.groupsStore,c]),v=(0,X.VK)((()=>null==f?void 0:f.toggleStateStore.state),[f]),y=(0,X.VK)((()=>d.permissionScopesStore.state),[d.permissionScopesStore]),x=(0,X.VK)((()=>d.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[d]),b=(0,X.VK)((()=>d.isInHomeWidgetStore.state),[d.isInHomeWidgetStore]),w=(0,X.VK)((()=>!(0,Yo.hX)()||void 0!==u[p]),[u,p]),k=(0,X.VK)((()=>{var e;return b?"transparent":(null===(e=d.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||void 0}),[d.inheritedBlockColorStore,b]),T=(0,J.yK)((t=>{const i=o?t.cardContentBackground:t.contentBackground;return{topLevelDiv:{position:"relative",zIndex:M.sL,width:"100%",background:void 0===k?i:k,fontSize:14,...r},stickyWrapStyle:{display:"flex",alignItems:"center",height:Xr(e.height),paddingTop:n,...e.stickyLeft&&{position:"sticky",left:e.isFullScreen||e.isRootChild?e.paddingLeft:0},...!v&&{marginBottom:e.toggleClosedMarginBottom}}}}),[k,o,v,n,e.height,e.isFullScreen,e.isRootChild,e.paddingLeft,e.stickyLeft,e.toggleClosedMarginBottom,r]),V=(0,X.VK)((()=>S.WindowSizeStore.state.height),[S.WindowSizeStore]),O=(0,i.useCallback)((()=>{if(!f)return;G.ZH({debug:{userAction:"CollectionGroupHeader.handleToggleButtonClick"},environment:S});const e=!v;if(E.uo({environment:S,groupFormat:c,toggleStateStore:f.toggleStateStore,newValue:e,collectionContextStore:d}),!e){const e=g.current,t=null==e?void 0:e.parentElement;t&&l.default.afterNextFlush((()=>{(0,Xo.Oc)({el:t,windowHeight:V,minEdgeDist:50}),d.renderEmitter.emit()}))}}),[d,S,c,f,v,V]),P=(0,i.useCallback)((()=>(0,C.jsx)(Ct.Z,{isSidebar:!1,open:v??!1,fill:!0,onClick:O,onMouseDown:ye.$0,style:{flexShrink:0}})),[O,v]),R=(0,i.useCallback)((t=>{const{droppedStores:o,duplicate:r}=t,{collectionContextStore:i,groupFormat:n}=e,s=g.current;s&&s instanceof Element&&q.createAndCommit({userAction:"CollectionGroupHeader.handleDrop",environment:S,perform:e=>E.by({environment:S,collectionContextStore:i,groupsPointer:[n],droppedStores:o,duplicate:r,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0})})}),[S,e]);return f&&h?(0,C.jsx)(Ur,{position:Fr(b),getComputedStyle:a,children:(0,C.jsxs)("div",{style:T.topLevelDiv,ref:g,children:[(0,C.jsx)("div",{style:T.stickyWrapStyle,children:(0,C.jsx)("div",{style:{display:"flex",alignItems:"center",position:e.stickyLeft?"sticky":void 0,left:e.paddingLeft,overflow:"hidden"},children:(0,C.jsxs)(St.Z,{store:h,canDropOnto:!s&&!v,onSelectableDrop:R,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,groupsPointer:[c],style:{display:"flex",alignItems:"center",height:"100%",overflow:"hidden"},canSelect:!1,children:[P(),(0,C.jsx)(ri,{collectionGroupHeaderProps:e}),w&&(0,C.jsx)(ti,{disabled:e.disabled,format:e.format,schema:e.schema,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,groupAggregationKey:e.groupAggregationKey}),!s&&y.canConfigureBlock&&(0,C.jsx)(oi,{groupFormat:e.groupFormat,currentGroups:e.currentGroups,format:e.format,schema:e.schema,query:e.query,collectionContextStore:e.collectionContextStore,groupsFormatKey:e.groupsFormatKey,isGroupHoveredStore:e.isGroupHoveredStore}),x&&(0,C.jsx)(ii,{collectionGroupHeaderProps:e,isGroupHoveredStore:e.isGroupHoveredStore})]})})}),e.children]})}):null}class $r extends s.Z{constructor(){super(...arguments),this.handleToggleButtonClick=()=>{const{groupFormat:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);if(!o)return;G.ZH({debug:{userAction:"CollectionGroupHeader.handleToggleButtonClick"},environment:this.environment});const r=!o.toggleStateStore.state;if(E.uo({environment:this.environment,groupFormat:e,toggleStateStore:o.toggleStateStore,newValue:r,collectionContextStore:t}),!r){const e=n.findDOMNode(this),o=null==e?void 0:e.parentElement;o&&l.default.afterNextFlush((()=>{(0,Xo.Oc)({el:o,windowHeight:this.environment.WindowSizeStore.state.height,minEdgeDist:50}),t.renderEmitter.emit()}))}},this.handleDrop=e=>{const{droppedStores:t,duplicate:o}=e,{collectionContextStore:r,groupFormat:i}=this.props,s=n.findDOMNode(this);s&&s instanceof Element&&q.createAndCommit({userAction:"CollectionGroupHeader.handleDrop",environment:this.environment,perform:e=>E.by({environment:this.environment,collectionContextStore:r,groupsPointer:[i],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0})})}}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.selectableBlockStore=new Ye.G(this.environment,{table:_.iU,id:t.id}))}didMount(){var e,t;null===(e=(t=this.props).onMount)||void 0===e||e.call(t)}renderComponent(){var e;const{disabled:t,getComputedStickyStyle:o,groupFormat:r,collectionContextStore:i}=this.props,n=i.groupsStore.getGroupState(r);if(!n)return;const s=n.toggleStateStore.state,l=i.permissionScopesStore.state,a=i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}),c=i.isInHomeWidgetStore.state,d=!(0,Yo.hX)()||void 0!==this.props.format[this.props.groupAggregationKey],u=c?"transparent":(null===(e=i.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||void 0;return(0,C.jsx)(Ur,{position:Fr(c),getComputedStyle:o,children:(0,C.jsxs)("div",{style:Jr(this.props.isInPeekRenderer,this.theme,u,this.props.style),children:[(0,C.jsx)("div",{style:ei(s,this.props.isFullScreen,this.props.isRootChild,this.props.paddingLeft,this.props.paddingTop,this.props.toggleClosedMarginBottom,this.props.height,this.props.stickyLeft),children:(0,C.jsx)("div",{style:{display:"flex",alignItems:"center",position:this.props.stickyLeft?"sticky":void 0,left:this.props.paddingLeft,overflow:"hidden"},children:(0,C.jsxs)(St.Z,{store:this.selectableBlockStore,canDropOnto:!t&&!s,onSelectableDrop:this.handleDrop,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,groupsPointer:[r],style:{display:"flex",alignItems:"center",height:"100%",overflow:"hidden"},canSelect:!1,children:[this.renderToggleButton(n.toggleStateStore),(0,C.jsx)(ri,{collectionGroupHeaderProps:this.props}),d&&(0,C.jsx)(ti,{disabled:this.props.disabled,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,groupFormat:this.props.groupFormat,groupAggregationKey:this.props.groupAggregationKey}),!t&&l.canConfigureBlock&&(0,C.jsx)(oi,{groupFormat:this.props.groupFormat,currentGroups:this.props.currentGroups,format:this.props.format,schema:this.props.schema,query:this.props.query,collectionContextStore:this.props.collectionContextStore,groupsFormatKey:this.props.groupsFormatKey,isGroupHoveredStore:this.props.isGroupHoveredStore}),a&&(0,C.jsx)(ii,{collectionGroupHeaderProps:this.props,isGroupHoveredStore:this.props.isGroupHoveredStore})]})})}),this.props.children]})})}renderToggleButton(e){const t=e.state;return(0,C.jsx)(Ct.Z,{isSidebar:!1,open:t,fill:!0,onClick:this.handleToggleButtonClick,onMouseDown:ye.$0,style:{flexShrink:0}})}}function Qr(e){return(0,Jo.E)("collection_group_header_functional")?(0,C.jsx)(qr,{...e}):(0,C.jsx)($r,{...e})}$r.displayName="CollectionGroupHeaderClass";const Yr=i.memo(Qr);function Xr(e){return e||33}function Jr(e,t,o,r){const i=e?t.cardContentBackground:t.contentBackground;return{position:"relative",zIndex:M.sL,width:"100%",background:void 0===o?i:o,fontSize:14,...r}}function ei(e,t,o,r,i,n,s,l){return{display:"flex",alignItems:"center",height:Xr(s),paddingTop:i,...l&&{position:"sticky",left:t||o?r:0},...!e&&{marginBottom:n}}}function ti(e){let{disabled:t,format:o,schema:r,collectionContextStore:i,groupFormat:n,groupAggregationKey:s}=e;const l=(0,X.VK)((()=>i.permissionScopesStore.state.canConfigureBlock),[i]);return(0,C.jsx)(vr,{groupFormat:n,disabled:t||!l,groupAggregationKey:s,format:o,schema:r,collectionContextStore:i})}function oi(e){let{groupFormat:t,currentGroups:o,format:r,schema:i,query:n,collectionContextStore:s,groupsFormatKey:l,isGroupHoveredStore:a}=e;const c=(0,P.useIntl)(),d=(0,Y.Fy)(),u=(0,X.VK)((()=>s.groupsLimitStore),[s]),p=(0,X.VK)((()=>a.state),[a]),[h,m]=(0,Qo.Z)(),S=(0,J.yK)((()=>({button:{transition:d.isMobile?void 0:"opacity 100ms ease-in-out",opacity:d.isMobile?void 0:p||m?1:0}})),[d.isMobile,m,p]);return(0,C.jsx)(Te.ZP,{popupType:d.isMobile?Te.Z4.SlideUp:Te.Z4.Popup,renderOrigin:e=>(0,C.jsx)(_e.Z,{ariaLabel:c.formatMessage({id:"actionButtonComponent.ariaLabel",defaultMessage:"Show group options"}),ref:h,icon:ke.o,style:S.button,...e}),onClick:ye.Wi,render:e=>(0,C.jsx)(ar,{parent:e,groupFormat:t,currentGroups:o,format:r,schema:i,query:n,collectionContextStore:s,groupsFormatKey:l,groupsLimitStore:u})})}function ri(e){let{collectionGroupHeaderProps:t}=e;const o=(0,Y.O7)(),{groupFormat:r,schema:i,disabled:n,currentGroups:s,groupBy:l,collectionContextStore:a}=t,c=(0,X.VK)((()=>a.permissionScopesStore.state),[a]);return(0,C.jsx)(Mr.Z,{groupBy:l,groupFormat:r,currentGroups:s,schema:i,disabled:n||!c.canConfigureCollection||c.isSyncedCollection,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:r}=o,i=r.collectionStore();i&&(E.w$({...e,environment:t,collectionStore:i,...o}),F.wd({environment:t,collectionContextStore:r,action:"rename_group"}))}(e,o,t),style:{maxWidth:400,lineHeight:"24px"},uncategorizedIconStyle:{marginLeft:2},collectionContextStore:a})}function ii(e){let{collectionGroupHeaderProps:t,isGroupHoveredStore:o}=e;const r=(0,P.useIntl)(),i=(0,Y.Fy)(),n=(0,Y.O7)(),s=(0,X.VK)((()=>o.state),[o]),[l,a]=(0,Qo.Z)(),c=(0,J.yK)((()=>({button:{transition:i.isMobile?void 0:"opacity 100ms ease-in-out",opacity:i.isMobile?void 0:s||a?1:0}})),[i.isMobile,a,s]);return(0,C.jsx)(Jt.Z,{renderTooltip:()=>(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Create new",id:"database.collectionGroupHeader.actions.addNewPage.tooltip"}),render:e=>(0,C.jsx)(_e.Z,{ariaLabel:r.formatMessage({id:"collectionGroupHeader.actions.addNewPage.ariaLabel",defaultMessage:"Add new page in group"}),ref:l,icon:de.R,onClick:()=>function(e,t){const{groupFormat:o,collectionContextStore:r,isFullScreen:i,onGroupHeaderAddItem:n}=t;r.groupsStore.getGroupState(o)&&Nt.M_(e)&&(r.searchQueryStore.state&&le.Ug({searchQuery:"",collectionContextStore:r,isFullScreen:i}),q.createAndCommit({userAction:"CollectionGroupHeader.handleAddItemClick",environment:e,perform:i=>{const s=E.IW({environment:e,collectionContextStore:r,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:i,from:"group_header"});s&&(n(s.newStore,s.coercionSucceeded,t),lt.W(e,{from:"group_add_item_top",type:"page",new_page_id:s.newStore.id,creating_block_id:s.newStore.id,...(0,Ke.Pn)(r)}))}}))}(n,t),style:c.button,...e})})}var ni=o(612183),si=o(598953);class li extends c.default{getInitialState(){return!1}}const ai=li;class ci extends c.default{getInitialState(){}}const di=ci;var ui=o(973744);class pi extends c.default{getInitialState(){return{containerMap:new Map}}}const hi=pi;class mi extends s.Z{constructor(){super(...arguments),this.element=void 0,this.scrollableAncestor=void 0,this.resizingAncestor=void 0,this.callbackQueued=!1,this.resizeObserver=new ResizeObserver((()=>{this.handleScroll()})),this.storeTypes={store:hi},this.handleScroll=()=>{this.callbackQueued||(this.callbackQueued=!0,window.requestAnimationFrame((()=>{this.callbackQueued=!1,this.mutateDOM((()=>{!function(e){const{environment:t,container:o}=e,{device:r}=t,{store:i}=o.stores,{containerMap:n}=i.state,s=Array.from(n.keys()).sort(((e,t)=>{if(e.element&&t.element)return(0,Ar.Z)(e.element,t.element);throw new Error("Element not found")})),l=new Map;for(const a of s){const{element:e,scrollableAncestor:t}=a,o=n.get(a);if(!e||!t||!o)continue;const i=zr(a).reduce(((e,t)=>e+(l.get(t)||0)),0),s=t.getBoundingClientRect(),c=e.getBoundingClientRect(),d=s.height,u=Math.floor(s.top-c.top),p=Math.floor(s.top+d-c.top),h=Math.floor(c.height)+(a.props.isFullScreen&&!r.isSafari?Lr.Z.state:0),m=Array.from(o.values()).sort(((e,t)=>{if(e.element&&t.element)return(0,Ar.Z)(e.element,t.element);throw new Error("Element not found")}));let S=i,g=0;for(const r of m){if(!r.element)continue;const e=r.element.getBoundingClientRect(),t=S+e.height;r.props.position===Rr.Top&&(g+=e.height);const o=Zr(u,h,t,i),n=Hr(p,h,t,g);if(r.props.position===Rr.Top){const e=0!==o,t=r.props.getComputedStyle?r.props.getComputedStyle(e):void 0;e?(r.element.style.transform=`translate3d(0, ${o}px, 0)`,r.element.style.bottom=""):(r.element.style.transform="",r.element.style.bottom=""),t&&Gr(r.element,t)}else if(r.props.position===Rr.Bottom){const e=0!==n,t=r.props.getComputedStyle?r.props.getComputedStyle(e):void 0;if(e?(r.element.style.transform=`translate3d(0, ${n}px, 0)`,r.element.style.top=""):(r.element.style.transform="",r.element.style.top=""),t)for(const o in t)r.element.style[o]=t[o]||""}S=t}l.set(a,S)}}({environment:this.environment,container:this})}))})))},this.handleResizeThrottled=R.P2(this.handleScroll,100)}didMount(){!function(e){const{container:t,parentContainer:o}=e,r=o?o.stores.store:t.stores.store;r.state.containerMap.has(t)||r.state.containerMap.set(t,new Set),r.emit()}({container:this,parentContainer:Kr(this)}),(0,Xo.Gf)(this.environment)&&this.attachEvents()}willUnmount(){!function(e){const{container:t,parentContainer:o}=e,r=o?o.stores.store:t.stores.store;r.state.containerMap.delete(t),r.emit()}({container:this,parentContainer:Kr(this)}),(0,Xo.Gf)(this.environment)&&this.removeEvents(),this.element=void 0,this.scrollableAncestor=void 0}getChildContext(){return{...this.context,computedStickyContainer:this}}renderComponent(){if(this.props.children)return this.props.children}attachEvents(){const e=Kr(this),t=n.findDOMNode(this);if(t){this.element=t;const o=(0,Xo.VW)(t);o&&(this.scrollableAncestor=o,e||((0,ui.lj)(o,"scroll",this.handleScroll),(0,ui.lj)(window,"resize",this.handleResizeThrottled),this.resizeObserver.observe(this.element)));const r=(0,Xo.Ez)(this.element);r&&(this.resizingAncestor=r,this.resizeObserver.observe(this.resizingAncestor))}this.props.renderEmitter&&this.props.renderEmitter.addListener(this.handleScroll)}removeEvents(){this.scrollableAncestor&&((0,ui.ZV)(this.scrollableAncestor,"scroll",this.handleScroll),(0,ui.ZV)(window,"resize",this.handleResizeThrottled),this.element&&this.resizeObserver.unobserve(this.element)),this.resizingAncestor&&this.resizeObserver.unobserve(this.resizingAncestor),this.props.renderEmitter&&this.props.renderEmitter.removeListener(this.handleScroll)}}mi.displayName="ComputedStickyContainer",mi.contextTypes={computedStickyContainer:Er().any,...s.w},mi.childContextTypes={computedStickyContainer:Er().any,...s.w};const Si=mi,gi=c.default.createClass(!1,{name:"IsGroupHoveredStore"});function fi(e){let{renderGroup:t,groupFormat:o,groupsDisplayState:r,disabled:n,groupsFormatKey:s,groupAggregationKey:l,format:a,schema:c,query:d,collectionContextStore:u,onGroupHeaderAddItem:p,renderHeader:h,getGroupStyle:m,stickyLeft:S,ignoreAncestorStickyContainer:g,paddingLeft:f,isFullScreen:v,index:y,isRootChild:x,isInPeekRenderer:b,groupBy:w,isLast:k}=e;const T=(0,Y.O7)();(0,i.useEffect)((()=>{E.V$({environment:T,collectionContextStore:u,groupFormat:o})}),[]);const _=(0,X.qz)(void 0,gi),[V,O,M,P,R,j]=(0,X.VK)((()=>{const e=u.groupsStore.getGroupState(o),i=e?e.toggleStateStore:null,g=!!i&&i.state?t(o):null,T={groupFormat:o,currentGroups:r.currentGroups,disabled:n,groupsFormatKey:s,groupAggregationKey:l,format:a,schema:c,query:d,collectionContextStore:u,isFullScreen:v,isInPeekRenderer:b,onGroupHeaderAddItem:p,stickyLeft:S,index:y,paddingLeft:f,isRootChild:x,groupBy:w,isGroupHoveredStore:_},V=h?h(T):(0,C.jsx)(Yr,{...T});return[e,i,u.renderEmitter,m&&i?m({groupFormat:o,...r,index:y,isLast:k,toggleStateStore:i}):void 0,g,V]}),[u,o,t,r,n,s,l,a,c,d,v,b,p,S,y,f,x,w,_,h,m,k]),I=(0,i.useCallback)((()=>{_.setState(!0)}),[_]),F=(0,i.useCallback)((()=>{_.setState(!1)}),[_]);return V&&O?(0,C.jsx)(Si,{ignoreAncestorContainer:g,renderEmitter:M,isFullScreen:v,children:(0,C.jsxs)("div",{style:{width:"100%",position:"relative",...P},onMouseEnter:I,onMouseLeave:F,children:[j,R]})}):null}const Ci=i.memo(fi);var vi=o(51592),yi=o(466213);const xi=function(e){let{aggregation:t,schema:o,groupFormat:r,collectionContextStore:i,disabled:n,color:s,onChange:l}=e;const a=(0,J.Fg)(),c=(0,Y.O7)(),{device:d}=c;return(0,C.jsx)(Jt.Z,{renderTooltip:()=>(0,C.jsx)(bi,{aggregation:t,schema:o,collectionContextStore:i}),render:e=>(0,C.jsx)(Te.ZP,{popupType:d.isMobile?Te.Z4.SlideUp:Te.Z4.Popup,renderOrigin:l=>(0,C.jsx)(Et.Z,{disabled:n,style:{fontWeight:j.Z.fontWeight.regular,color:s||a.lightTextColor,paddingTop:4,paddingBottom:4,height:void 0,lineHeight:void 0},...(0,hr.Z)(e,l),children:(0,C.jsx)(Pi,{schema:o,aggregation:t,collectionContextStore:i,groupFormat:r})}),disabled:n,render:e=>(0,C.jsx)(Mi,{parent:e,selectedAggregation:t,onChange:l,collectionContextStore:i,schema:o})})})};function bi(e){let{aggregation:t,schema:o,collectionContextStore:r}=e;const i=(0,X.VK)((()=>!!t&&mr(r,t)),[r,t]);if(t){const e=Yo.VN[(0,p.OV)(t)];if((0,p.pK)(t)){const r=o[t.property];if(r){const t=r.name;return(0,C.jsx)(C.Fragment,{children:We.default.formatMessage(gr.propertyAggregation,{aggregationType:e,propertyName:t,calculating:i})})}}return(0,C.jsx)(C.Fragment,{children:We.default.formatMessage(gr.aggregationType,{aggregationType:e,calculating:i})})}return(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Aggregate",id:"database.boardAggregation.tooltip"})}function wi(e){let{aggregationType:t,isSelected:o,label:r,props:i}=e;const n=Yo.Sn[t];return(0,C.jsx)(Jt.Z,{placement:Ve.GI.Placement.Right,delayThreshold:0,render:e=>(0,C.jsx)(Me.Z,{title:r,checkState:o,...(0,hr.Z)(e,i)}),renderTooltip:()=>(0,C.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[n&&(0,C.jsx)("img",{src:(0,pr.D)(n),style:{borderRadius:4,width:140,marginTop:4}}),Yo.BG[t]]})})}function ki(e,t,o,r){o.isLoadingStore.state||o.loadingDetailsStore.setState({type:"load_aggregation"}),o.isClientModeEnabledStore.state||o.asyncAggregationStatusStore.setState({calculating:!0,aggregation:e,changingType:!0}),t(e),F.wd({environment:r,collectionContextStore:o,action:"board_change_aggregation"})}function Ti(e,t,o,r,i){const n=Yo.VN[t];return{key:t,render:o=>(0,C.jsx)(wi,{isSelected:e,aggregationType:t,label:n,props:o}),action:()=>{ki({aggregator:t},o,r,i)}}}function _i(e,t,o,r,i,n,s){const{device:l}=r,a=Yo.VN[t],c=R.oA(o.map((o=>function(e,t,o,r,i,n,s){const l=r[t];if(!l)return;const a=l.name;return{key:`${t}${o}`,render:t=>(0,C.jsx)(wi,{isSelected:e,aggregationType:o,label:a,props:t}),action:()=>{ki({aggregator:o,property:t},i,n,s)}}}((null==e?void 0:e.aggregator)===t&&(null==e?void 0:e.property)===o,o,t,i,n,s,r)))),d=c.findIndex((o=>o.key===`${e.property}${t}`));return{key:t+a,render:(e,t)=>(0,C.jsx)(Cr.Z,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,C.jsx)(Me.Z,{...e,ref:t,title:a}),renderExtension:(e,o)=>{let r;return r=l.isMobile?{menuType:Oe.og.Modal,title:a,right:(0,C.jsx)(nr.DoneMenuText,{}),onClickRight:o.close,...e}:{menuType:Oe.og.Popup,width:200,...e},(0,C.jsx)(Pe.Z,{...r,children:(0,C.jsx)(Re.Z,{type:Re.i.Vertical,initialFocus:d,sections:[{key:"results",render:e=>(0,C.jsx)(je.Z,{...e}),items:c}],onAccept:(e,r,i)=>{o.close(),t.onAccept&&t.onAccept(e,r,i)}})})}}),action:()=>null}}function Vi(e,t,o,r,i){const n={};for(const d of p.o5)n[d]=Ti(e.aggregator===d,d,o,r,t);const s=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,p.iV)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}(i);if(s.length>0)for(const d of p.Sy)"show_unique"!==d&&(n[d]=_i(e,d,s,t,i,o,r));const l=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,p.O4)(o)}))}(i);if(l.length>0)for(const d of p.k$)n[d]=_i(e,d,l,t,i,o,r);const a=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,p.dN)(o)}))}(i);if(a.length>0)for(const d of p.f8)n[d]=_i(e,d,a,t,i,o,r);const c=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,p.Mv)(o)}))}(i);if(c.length>0)for(const d of p.gC)n[d]=_i(e,d,c,t,i,o,r);return n}function Oi(e,t){const o=e.enforceMaxAggregationLimit??!1,r={...e,enforceMaxAggregationLimit:!o};return{key:"aggregationLimitToggle",render:e=>(0,C.jsx)("div",{children:(0,C.jsx)(fr.Z,{...e,caption:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"This improves performance for large databases.",id:"BoardAggregations.aggregationLimitToggle.description"}),shouldWrapCaption:!0,captionStyle:{width:"90%",marginTop:5},style:{alignItems:void 0},title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Show large counts as 99+",id:"BoardAggregations.aggregationLimitToggle.title"}),on:o,focused:!1,onClick:()=>t(r)})}),action:()=>{}}}function Mi(e){let{selectedAggregation:t,parent:o,onChange:r,collectionContextStore:i,schema:n}=e;const s=(0,Y.O7)(),{device:l}=s,a=(0,X.VK)((()=>(0,Yo.hX)()),[]),{actions:c,initialFocus:d}=function(e,t,o,r,i,n){const{device:s}=t,l=[];let a=0,c=0;const d=Vi(e,t,o,r,i);let u=0;return Object.entries(p.cY).forEach((t=>{let[r,i]=t;const p=[];for(const o of i)d[o]&&(p.push(d[o]),e.aggregator===o&&(a=u,c=p.length-1));const h=[];if(n&&"count_aggregations"===r&&h.push({key:"limitToggleSection",render:e=>(0,C.jsx)(je.Z,{...e}),items:[Oi(e,o)]}),h.push({key:"aggregations",render:e=>(0,C.jsx)(je.Z,{topBorder:!0,...e}),items:p}),p.length>0){u++;const e=Yo.nL[r],t={key:e,render:(t,o)=>(0,C.jsx)(Cr.Z,{...t,disableDefaultClick:!0,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,C.jsx)(Me.Z,{...t,ref:o,title:e}),renderExtension:(t,r)=>{let i;return i=s.isMobile?{menuType:Oe.og.Modal,title:e,right:(0,C.jsx)(nr.DoneMenuText,{}),onClickRight:r.close,...t}:{menuType:Oe.og.Popup,width:250,...t},(0,C.jsx)(Pe.Z,{...i,children:(0,C.jsx)(Re.Z,{type:Re.i.Vertical,initialFocus:c,sections:h,onAccept:(e,t,i)=>{r.close(),o.onAccept&&o.onAccept(e,t,i)}})})}}),action:()=>null};l.push(t)}})),{actions:l,initialFocus:a}}(t,s,r,i,n,a);let u;return u=l.isMobile?{menuType:Oe.og.Modal,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Aggregation",id:"database.mobileBoardAggregationMenu.title"}),right:(0,C.jsx)(nr.DoneMenuText,{}),onClickRight:o.close}:{menuType:Oe.og.Popup,width:200},(0,C.jsx)(Pe.Z,{...u,children:(0,C.jsx)(Re.Z,{type:Re.i.Vertical,initialFocus:d,sections:[{key:"aggregation section",render:e=>(0,C.jsx)(je.Z,{...e}),items:c}],onAccept:o.close})})}function Pi(e){let{schema:t,aggregation:o,collectionContextStore:r,groupFormat:i}=e;const n=(0,X.VK)((()=>({type:"aggregation",filter:(0,Ze.zk)({schema:t,group:i,propertyMapping:void 0,timeZone:(0,He.r)()}),aggregation:o})),[o,t,i]);return n?(0,C.jsx)(bt.Z,{id:`board:${(0,ee.mD)(i)}`,collectionContextStore:r,reducer:n,groupsPointer:[i],render:e=>{const i=e.state;let n,s;if((0,p.pK)(o)){const e=t[o.property];!e||"formula"!==e.type&&"number"!==e.type||(n=e.number_format),e&&"date"===e.type&&(s=e.date_format)}return(0,C.jsx)(Sr,{aggregation:o,collectionContextStore:r,children:i?(0,Yo.Zy)({numberFormat:n,dateFormat:s,aggregation:o,userTimeZone:(0,He.r)(),value:i.aggregationResult,roundDecimal:5}):"-"})}}):null}function Ri(e){return(0,ae.rD)(e.board_cover_size)}const ji=function(e){const{hoveredGroupStore:t,groupFormat:o,schema:r,format:i,collectionContextStore:n,disabled:s,hidden:l,isPopup:a,isInPeekRenderer:c,query:d,currentGroups:u,isFullScreen:p}=e,h=(0,J.Fg)(),m=(0,Y.O7)(),S=(0,X.VK)((()=>!!m.device.isMobile||(0,ee.ZH)(t.state,o)),[m,t,o]),g=(0,X.VK)((()=>(0,Ge.II)({environment:m,groupFormat:o,schema:r,format:i,theme:h})),[o,r,i,m,h]),f=(0,X.VK)((()=>n.permissionScopesStore.state),[n]),v=(0,X.VK)((()=>n.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[n]),y=(0,X.VK)((()=>!(0,Yo.hX)()||d.aggregations&&d.aggregations.length>0),[d]),x=(0,X.VK)((()=>function(e,t,o,r,i,n,s){const{device:l}=e,a=Ri(o),c=Boolean(o.collection_group_by),d=r.isInHomeWidgetStore.state,u=d?qn:Gn,p=d?$n:Wn;return{display:"flex",alignItems:"center",fontSize:14,width:a,paddingLeft:u,paddingRight:u,marginRight:2*Un,marginBottom:t?4:0,boxSizing:"content-box",flexShrink:0,...i&&{padding:l.isMobile?"6px 16px":"8px 12px 4px",width:"none",minWidth:a},...s&&!t&&{backgroundColor:n?s.peekBackgroundColor:s.backgroundColor,...c?{borderRadius:p}:{borderTopLeftRadius:p,borderTopRightRadius:p}}}}(m,l,i,n,a,c,g)),[m,l,i,n,a,c,g]);return(0,C.jsxs)("div",{style:x,onMouseMove:()=>function(e,t){e.state!==t&&e.setState(t)}(t,o),children:[(0,C.jsx)(Fi,{boardGroupHeaderProps:e}),y&&(0,C.jsx)(Ai,{disabled:s,query:d,schema:r,collectionContextStore:n,groupFormat:o,hidden:l,boardSelectStyle:g}),(0,C.jsx)("div",{style:{flexGrow:1}}),!s&&f.canConfigureBlock&&(0,C.jsx)(Li,{hidden:l,groupFormat:o,currentGroups:u,format:i,schema:r,query:d,collectionContextStore:n,boardSelectStyle:g,isHovered:S}),v&&(0,C.jsx)(Di,{format:i,groupFormat:o,collectionContextStore:n,isFullScreen:p,hidden:l,isHovered:S,boardSelectStyle:g})]})};function Ii(e){let{parent:t,groupFormat:o,currentGroups:r,format:i,schema:n,query:s,collectionContextStore:l}=e;const a=l.boardColumnsLimitStore;return(0,C.jsx)(ar,{parent:t,groupFormat:o,currentGroups:r,format:i,query:s,schema:n,collectionContextStore:l,groupsFormatKey:"board_columns",groupsLimitStore:a})}function Fi(e){let{boardGroupHeaderProps:t}=e;const{groupFormat:o,schema:r,disabled:i,currentGroups:n,format:s,groupBy:l,collectionContextStore:a}=t,c=(0,Y.O7)(),d=Ri(s),u=(0,X.VK)((()=>a.permissionScopesStore.state),[a]);return(0,X.VK)((()=>a.groupsStore.getGroupState(o)),[a,o])?(0,C.jsx)(Mr.Z,{groupBy:l,groupFormat:o,currentGroups:n,schema:r,disabled:i||!u.canConfigureBlock,isHiddenGroup:!1,onChange:e=>function(e,t,o){const{collectionContextStore:r}=o,i=r.collectionStore();i&&(E.w$({...e,environment:t,groupsFormatKey:"board_columns",collectionStore:i,...o}),F.wd({environment:t,collectionContextStore:r,action:"rename_group"}))}(e,c,t),style:{maxWidth:d-70},collectionContextStore:a}):null}function Ni(e,t,o){return!t&&o?o.textColor:e.lightTextColor}function Bi(e,t){if(!e)return{transition:"opacity 100ms ease-in-out",opacity:t?1:0}}function Ei(e,t,o,r,i,n){const{device:s}=e;if(!Nt.M_(e))return;const l="collectionTypedView"===r.contextType,a=Boolean(t.collection_group_by);r.searchQueryStore.state&&le.Ug({searchQuery:"",collectionContextStore:r,isFullScreen:i});const c=r.groupsStore.getGroupState(o);if(!c)return;const u=c.resultsStore;q.createAndCommit({userAction:"BoardGroupHeader.handleAddItemClick",environment:e,perform:t=>{const i=E.IW({environment:e,collectionContextStore:r,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:t,from:"board_group_header"});if(!i)return;const c=i.coercionSucceeded,p=i.newStore;if(s.isMobile){!function(e,t,o){o?o(e):zt.c4({environment:t,url:e})}((0,lo.ZP)({store:p,pageVisitSource:d.tY.Create}),e,n)}else if(c&&!a){const t=p.getBlockTitleStore();G.eP({environment:e,store:p}),U.NX({store:t}),le.Z5({store:p})}else se.CH({environment:e,store:p,peekMode:(0,ae.kr)(r),showMoveTo:l,resultsStore:u,collectionContextStore:r,pageVisitSource:d.tY.Create});lt.W(e,{from:"board_group_add_item_top",type:"page",new_page_id:p.id,creating_block_id:p.id,...(0,Ke.Pn)(r)})}})}function Ai(e){let{disabled:t,query:o,schema:r,collectionContextStore:i,groupFormat:n,hidden:s,boardSelectStyle:l}=e;const a=(0,J.Fg)(),c=(0,Y.O7)(),d=o.aggregations?o.aggregations[0]:void 0,u=(0,X.VK)((()=>i.permissionScopesStore.state),[i]);if(!d)return null;const p=Ni(a,s,l);return(0,C.jsx)(xi,{groupFormat:n,disabled:t||!u.canConfigureBlock,aggregation:d,schema:r,collectionContextStore:i,color:p,onChange:e=>function(e,t,o,r){const i=t.collectionViewStore(),n={...o,aggregations:e?[e]:[]};i&&q.createAndCommit({userAction:"BoardGroupHeader.handleAggregationChange",environment:r,perform:e=>{le.iG({collectionViewStore:i,update:{query2:n},transaction:e})}})}(e,i,o,c)})}function Li(e){let{hidden:t,groupFormat:o,currentGroups:r,format:i,schema:n,query:s,collectionContextStore:l,boardSelectStyle:a,isHovered:c}=e;const d=(0,J.Fg)(),u=(0,Y.O7)(),{device:p}=u,h=Ni(d,t,a),m=Bi(t,c);return(0,C.jsx)(Te.ZP,{popupType:p.isMobile?Te.Z4.SlideUp:Te.Z4.Popup,renderOrigin:e=>(0,C.jsx)(_e.Z,{icon:ke.o,iconStyle:{fill:h},style:m,...e}),render:e=>(0,C.jsx)(Ii,{parent:e,groupFormat:o,currentGroups:r,format:i,schema:n,query:s,collectionContextStore:l})})}function Di(e){let{format:t,groupFormat:o,collectionContextStore:r,isFullScreen:n,hidden:s,isHovered:l,boardSelectStyle:a}=e;const c=(0,J.Fg)(),d=(0,Y.O7)(),u=(0,i.useContext)(yi.ZO),p=(0,i.useCallback)((()=>Ei(d,t,o,r,n,u)),[d,t,o,r,n,u]),h=(0,X.VK)((()=>{var e;return null===(e=r.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[r]),m=Ni(c,s,a),S=Bi(s,l),g=(0,vi.sN)(h);return(0,C.jsx)(Jt.Z,{renderTooltip:()=>(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Create new {newItemName}",values:{newItemName:g},id:"database.boardView.actions.addNewItem.tooltip"}),render:e=>(0,C.jsx)(_e.Z,{icon:de.R,onClick:p,style:S,iconStyle:{fill:m},...e})})}var Zi=o(542853);const Hi=30,zi=4;function Ki(e){const{hiddenGroupsVisibleStore:t}=e,o=(0,X.VK)((()=>t.state),[t]);return(0,C.jsx)(Et.Z,{onClick:function(){t.setState(!t.state)},onMouseDown:ye.$0,style:{height:Hi,marginBottom:zi,...e.style},icon:e=>(0,Zi.i)({...e,...o&&{transform:"rotate(180deg)"}}),isLightGray:!0,children:(0,C.jsx)(P.FormattedMessage,{id:"collectionHiddenGroupsButton.hiddenGroupsButton.text",defaultMessage:"{numberOfHiddenGroups, plural, one {{numberOfHiddenGroups} hidden group} other {{numberOfHiddenGroups} hidden groups}}",values:{numberOfHiddenGroups:e.hiddenGroups.length}})})}function Gi(e){const t=(0,X.VK)((()=>e.columnsDisplayState.visibleGroups.length*(Ri(e.format)+2*Gn+2*Un)),[e.columnsDisplayState.visibleGroups,e.format]);return(0,C.jsx)("div",{style:{display:"flex",minWidth:t},children:(0,C.jsx)(Ki,{...e})})}const Wi=30,Ui=4;function qi(e){let{type:t,visibleGroups:o,hiddenGroups:r,total:i,groupsLimitStore:n,schema:s,collectionContextStore:l,style:a}=e;const c=(0,Y.O7)(),d=(0,J.Fg)(),u=(0,X.VK)((()=>l.normalizedFormatStore.state),[l]),p=(0,X.VK)((()=>Ce({collectionContextStore:l,isForColumnGroups:"board"===t})),[l,t]),h=(0,X.VK)((()=>"board"===t?(0,Ge.II)({environment:c,groupFormat:void 0,schema:s,format:u,theme:d}):void 0),[c,u,s,d,t]),m=(0,J.yK)((e=>({hovered:{background:e.whiteButtonBackground},dots:{width:14,fill:e.mediumTextColor,marginLeft:4,marginTop:1,..."default"===t?{marginRight:8}:{}},..."board"===t?{button:{background:null==h?void 0:h.backgroundColor,color:e.mediumTextColor,fontWeight:j.Z.fontWeight.medium,paddingLeft:8,paddingRight:8,height:33,marginRight:2*Un,borderRadius:Wn,width:90,...a}}:{}})),[h,a,t]),S=Math.min(Ge.kW,i-r.length-o.length);return"default"===t?(0,C.jsxs)(Et.Z,{onClick:()=>function(e,t,o){o.setState(o.state+Ge.kW),t.loadingDetailsStore.setState({type:"load_more_groups"}),F.tf(e)}(c,l,n),onMouseDown:ye.$0,disabled:p,hoveredStyle:p?m.hovered:{},style:{display:"flex",alignItems:"center",fontSize:14,borderRadius:4,height:Wi,marginTop:Ui,marginBottom:Ui,paddingLeft:2,paddingTop:2,paddingBottom:2,paddingRight:8,...a},children:[(0,ke.o)(m.dots),(0,C.jsx)(P.FormattedMessage,{id:"database.groups.loadMoreButtonDefault.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",values:{loadMoreAmount:S}}),p&&(0,C.jsx)("div",{style:{marginTop:1,marginLeft:8},children:(0,C.jsx)(be.Z,{style:{width:12,height:12}})})]}):(0,C.jsxs)(Et.Z,{onClick:()=>function(e,t,o){o.setState(o.state+Ge.kW),t.loadingDetailsStore.setState({type:"load_more_columns"}),F.tf(e)}(c,l,n),onMouseDown:ye.$0,disabled:p,hoveredStyle:p?m.hovered:{},style:m.button,children:[(0,C.jsx)("span",{style:{flexGrow:1},children:(0,C.jsx)(P.FormattedMessage,{id:"database.groups.loadMoreButton.text",defaultMessage:"{loadMoreAmount} more",values:{loadMoreAmount:S}})}),p?(0,C.jsx)("div",{style:{marginLeft:4},children:(0,C.jsx)(be.Z,{style:{width:12,height:12}})}):(0,ke.o)(m.dots)]})}const $i=i.memo(qi,pe.Z);var Qi=o(504430);function Yi(e){const{format:t,isFullScreen:o,paddingLeft:r,isRootChild:i}=e,n=(0,Y.O7)(),s=(0,X.VK)((()=>(0,Qi.C1)({environment:n,format:t,isFullScreen:o,isRootChild:i})),[n,t,o,i]),l=(0,X.VK)((()=>"collectionTypedView"===e.collectionContextStore.contextType),[e.collectionContextStore]),a=(0,X.VK)((()=>(0,Qi.fj)({environment:n,isRootChild:i,isFullScreen:o,format:t})?Qi.Qw:r),[n,t,o,i,r]);return s||l?null:(0,C.jsx)("div",{style:{width:"100%",height:as+cs,display:"flex"},children:(0,C.jsx)(ps,{type:"default",groupBy:e.groupBy,currentGroups:e.currentGroups,schema:e.schema,groupsLimitStore:e.groupsLimitStore,collectionContextStore:e.collectionContextStore,onAccept:e.onAccept,parentStore:e.parentStore,style:{position:"sticky",left:e.isFullScreen?a:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}function Xi(e){const{format:t,isFullScreen:o,isRootChild:r,paddingLeft:i}=e,n=(0,Y.O7)(),s=(0,X.VK)((()=>(0,Qi.C1)({environment:n,format:t,isFullScreen:o,isRootChild:r})),[n,t,o,r]),l=(0,X.VK)((()=>(0,Qi.fj)({environment:n,isRootChild:r,isFullScreen:o,format:t})?Qi.Qw:i),[n,t,o,r,i]);return s?null:(0,C.jsx)("div",{style:{width:"100%",height:Hi+zi,display:"flex"},children:(0,C.jsx)(Ki,{...e,style:{position:"sticky",left:o?l:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}function Ji(e){const{format:t,isFullScreen:o,isRootChild:r}=e,i=(0,Y.O7)(),n=(0,X.VK)((()=>(0,Qi.C1)({environment:i,format:t,isFullScreen:o,isRootChild:r})),[i,t,o,r]),s=(0,X.VK)((()=>(0,Qi.fj)({environment:i,isRootChild:r,isFullScreen:o,format:t})?Qi.Qw:e.paddingLeft),[i,t,o,r,e.paddingLeft]);return n?null:(0,C.jsx)("div",{style:{width:"100%",height:Wi+2*Ui,display:"flex"},children:(0,C.jsx)($i,{type:"default",visibleGroups:e.visibleGroups,hiddenGroups:e.hiddenGroups,total:e.total,groupsLimitStore:e.groupsLimitStore,schema:e.schema,collectionContextStore:e.collectionContextStore,style:{position:"sticky",left:o?s:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}const en=(0,f.IU)("collectionGroupAccordion",{svg:(0,C.jsx)("path",{d:"M6.741 0a1 1 0 01.875 1.485l-2.742 4.94a1 1 0 01-1.748 0L.384 1.485A1 1 0 011.26 0h5.48z"}),viewBox:"0 0 8 7"});var tn=o(636596);function on(e){const t=e.minHeight||Pn,o=(0,J.yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,background:e.largeShimmerColor,minHeight:t}})),[t]);return(0,C.jsx)(tn.Z,{style:o.card})}function rn(e){const{width:t}=e,o=(0,Y.O7)(),r=(0,X.VK)((()=>o.WindowSizeStore.state.width<=Mn),[o]),i=(0,J.yK)((e=>({container:{display:"flex",flexDirection:"column",alignItems:"flexStart",alignSelf:"stretch",paddingBottom:12,height:t},groupContainer:{display:"flex",height:46,alignItems:"center",alignSelf:"stretch"},itemsContainer:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${r?"100%":`${t}px`}, 1fr))`,gap:16,paddingTop:1,paddingBottom:4,width:"100%",height:"100%"},iconContainer:{display:"flex",width:22,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,marginLeft:8,borderRadius:12,backgroundColor:e.lightDividerColor}})),[t,r]);return(0,C.jsxs)("div",{style:i.container,children:[(0,C.jsxs)("div",{style:i.groupContainer,children:[(0,C.jsx)("div",{style:i.iconContainer,children:en(i.icon)}),(0,C.jsx)(tn.Z,{style:i.groupShimmer})]}),(0,C.jsxs)("div",{style:i.itemsContainer,children:[(0,C.jsx)(on,{}),(0,C.jsx)(on,{}),(0,C.jsx)(on,{})]})]})}function nn(e){const{isFullScreen:t,galleryCoverSize:o}=e,r=t?2:1,i=(0,ae.rD)(o),n=R.DZ(r,(e=>(0,C.jsx)(rn,{width:i},e)));return(0,C.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:n})}function sn(){const e=(0,J.yK)((e=>({container:{padding:"8px 0px",width:"100%"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",paddingLeft:16,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch",borderBottom:`1px solid ${e.regularDividerColor}`},lastRowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:100,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:60,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerLong:{width:200,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},firstColumn:{display:"flex",width:360,height:34,padding:"7px 8px",alignItems:"center",gap:6},column:{display:"flex",width:200,height:34,padding:"6px 8px",alignItems:"center",gap:6}})),[]);return(0,C.jsxs)("div",{style:e.container,children:[(0,C.jsxs)("div",{style:e.groupContainer,children:[(0,C.jsx)("div",{style:e.iconContainer,children:en(e.icon)}),(0,C.jsx)(tn.Z,{style:e.groupShimmer})]}),(0,C.jsxs)("div",{style:e.rowsContainer,children:[(0,C.jsxs)("div",{style:e.rowContainer,children:[(0,C.jsxs)("div",{style:e.firstColumn,children:[(0,C.jsx)(tn.Z,{style:e.circleShimmer}),(0,C.jsx)(tn.Z,{style:e.rowShimmerShort})]}),(0,C.jsx)("div",{style:e.column,children:(0,C.jsx)(tn.Z,{style:e.rowShimmerShort})}),(0,C.jsx)("div",{style:e.column,children:(0,C.jsx)(tn.Z,{style:e.rowShimmerShort})}),(0,C.jsx)("div",{style:e.column,children:(0,C.jsx)(tn.Z,{style:e.rowShimmerShort})})]}),(0,C.jsxs)("div",{style:e.rowContainer,children:[(0,C.jsxs)("div",{style:e.firstColumn,children:[(0,C.jsx)(tn.Z,{style:e.circleShimmer}),(0,C.jsx)(tn.Z,{style:e.rowShimmerLong})]}),(0,C.jsx)("div",{style:e.column,children:(0,C.jsx)(tn.Z,{style:e.rowShimmer})}),(0,C.jsx)("div",{style:e.column,children:(0,C.jsx)(tn.Z,{style:e.rowShimmer})}),(0,C.jsx)("div",{style:e.column,children:(0,C.jsx)(tn.Z,{style:e.rowShimmer})})]}),(0,C.jsxs)("div",{style:e.lastRowContainer,children:[(0,C.jsxs)("div",{style:e.firstColumn,children:[(0,C.jsx)(tn.Z,{style:e.circleShimmer}),(0,C.jsx)(tn.Z,{style:e.rowShimmerLong})]}),(0,C.jsx)("div",{style:e.column,children:(0,C.jsx)(tn.Z,{style:e.rowShimmer})}),(0,C.jsx)("div",{style:e.column,children:(0,C.jsx)(tn.Z,{style:e.rowShimmer})}),(0,C.jsx)("div",{style:e.column,children:(0,C.jsx)(tn.Z,{style:e.rowShimmer})})]})]})]})}function ln(e){const{isFullScreen:t}=e,o=t?2:1,r=R.DZ(o,(e=>(0,C.jsx)(sn,{},e)));return(0,C.jsx)("div",{style:{display:"flex",paddingTop:8,paddingLeft:4,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",width:"100%"},children:r})}function an(){const e=(0,J.yK)((e=>({rowsContainer:{paddingTop:8},rowContainer:{display:"flex",height:28,alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0"},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:"50%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,C.jsxs)("div",{style:e.rowsContainer,children:[(0,C.jsx)("div",{style:e.rowContainer,children:(0,C.jsx)(tn.Z,{style:e.rowShimmerShort})}),(0,C.jsx)("div",{style:e.rowContainer,children:(0,C.jsx)(tn.Z,{style:e.rowShimmer})})]})}var cn=o(595550);function dn(){const e=(0,J.yK)((e=>({container:{display:"flex",padding:"8px 0px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor}})),[]),t=["50%","30%","40%"].map(((e,t)=>(0,C.jsx)(cn.G,{widthPercentage:e},t)));return(0,C.jsxs)("div",{style:e.container,children:[(0,C.jsxs)("div",{style:e.groupContainer,children:[(0,C.jsx)("div",{style:e.iconContainer,children:en(e.icon)}),(0,C.jsx)(tn.Z,{style:e.groupShimmer})]}),(0,C.jsx)("div",{style:e.rowsContainer,children:t})]})}function un(e){const{isFullScreen:t}=e,o=t?2:1,r=R.DZ(o,(e=>(0,C.jsx)(dn,{},e)));return(0,C.jsx)("div",{style:{display:"flex",padding:"8px 4px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},children:r})}function pn(e){const{viewType:t,isFullScreen:o,galleryCoverSize:r}=e;if(!(0,$o.Z)(!0,0,100))return null;switch(t){case"table":return(0,C.jsx)(ln,{isFullScreen:o});case"list":return(0,C.jsx)(un,{isFullScreen:o});case"gallery":return(0,C.jsx)(nn,{isFullScreen:o,galleryCoverSize:r});case"timeline":return(0,C.jsx)(an,{});default:return null}}const hn=new Set(["dropzone","table"]),mn=new Set(["item","table"]),Sn=new Set(["table"]);function gn(e){const{collectionContextStore:t,timelineProps:o}=e,r=(0,Y.O7)(),{collectionViewBlockStore:n,viewType:s}=(0,X.VK)((()=>{var e;return{collectionViewBlockStore:t.collectionViewBlockStore(),viewType:null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()}}),[t]),l=(0,X.VK)((()=>t.permissionScopesStore.state),[t.permissionScopesStore]),a=(0,X.VK)((()=>t.normalizedFormatStore.state),[t.normalizedFormatStore]),c=null==a?void 0:a.app_config_uri,d=null==a?void 0:a.collection_group_by,u=null==a?void 0:a.board_columns_by,p=(0,X.VK)((()=>t.groupsLimitStore.state),[t.groupsLimitStore]),h=(0,X.VK)((()=>t.boardColumnsLimitStore.state),[t.boardColumnsLimitStore]),m=(0,X.VK)((()=>t.normalizedSchemaStore.state),[t.normalizedSchemaStore]),S=(0,X.VK)((()=>t.normalizedQueryStore.state??{}),[t.normalizedQueryStore]),g=(0,X.VK)((()=>{if(d)return(0,ee.Qq)({schema:m,groupBy:d})}),[d,m]),f=(0,X.VK)((()=>t.relativeVariableStore.state),[t.relativeVariableStore]),v=(0,X.VK)((()=>t.remoteRequestStore.state),[t.remoteRequestStore]),y=(0,X.VK)((()=>{if(!d||!a)return;if(null!=o&&o.type&&hn.has(null==o?void 0:o.type))return;const e=$e.default.checkGate({gateName:"use_collection_reducer_request_hook"})?(0,ot.ze)(t,!0):null==v?void 0:v.loader.filter;return(0,Ge.ej)({groupBy:d,schema:m,format:a,filter:e,groupsFormatKey:ee.Uh,limit:p})}),[d,a,o,t,null==v?void 0:v.loader.filter,m,p]),x=(0,X.qz)(null==o?void 0:o.reducerResultStore,di),b=(0,X.qz)(null==o?void 0:o.hiddenGroupsVisibleStore,ai),w=(0,X.VK)((()=>b.state),[b]),k=(0,X.SI)((()=>{if(!n)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const e=x.state,o=e?e.results:void 0,r=(0,Ge.Cz)({groupBy:d,schema:m,schemaGroups:g,formatGroups:(null==a?void 0:a[ee.Uh])||[],reducerResults:o,getRecordModel:n.getRecordModel,relativeVariableResult:f,viewAppConfigUri:c,allowedCollectionStores:t.collectionStoresStore.state}),i=r.filter((e=>!(0,ee.eF)(e))).slice(0,p),s=r.filter((e=>(0,ee.eF)(e))),l=e?e.total:0;return{currentGroups:[...i,...s],visibleGroups:i,hiddenGroups:s,total:l}}),[n,t,a,d,p,x,f,m,g,c],{useDeepEqual:!0}),T=(0,X.Kw)(k,{debugName:"groupsDisplayState"}),_=(0,X.VK)((()=>{if(!n||!u)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const e=x.state,o=e?e.results:void 0,r=(0,Ge.Cz)({groupBy:d,schema:m,schemaGroups:g,formatGroups:(null==a?void 0:a.board_columns)||[],reducerResults:o,getRecordModel:n.getRecordModel,relativeVariableResult:f,viewAppConfigUri:c,allowedCollectionStores:t.collectionStoresStore.state}),i=r.filter((e=>!(0,ee.eF)(e))).slice(0,h),s=r.filter((e=>(0,ee.eF)(e))),l=e?e.total:0;return{currentGroups:[...i,...s],visibleGroups:i,hiddenGroups:s,total:l}}),[h,n,t,a,d,u,x,f,m,g,c],{useDeepEqual:!0}),V=i.useCallback((()=>{const e=t.normalizedFormatStore.state;if(""!==t.searchQueryStore.state)return;(0,ot.yU)(t)||E.$D({environment:r,format:e,groupsFormatKey:ee.Uh,collectionContextStore:t,currentGroups:k.state.currentGroups})}),[t,r,k]),O=(0,ni.v)(V,5e3);i.useEffect((()=>{if(null==o||!o.type||!hn.has(null==o?void 0:o.type))return k.addListener(O),()=>{k.removeListener(O),O.cancel()}}),[k,O,o]);const M=(0,X.VK)((()=>k.state.hiddenGroups.slice(0,Ge.ew)),[k]),P=(0,X.VK)((()=>!(null!=o&&o.type&&mn.has(null==o?void 0:o.type))&&function(e){const{collectionContextStore:t,displayState:o}=e;return t.shouldShowSpinnerStore.state&&0===o.visibleGroups.length}({collectionContextStore:t,displayState:T})),[t,T,o]),R=(0,X.VK)((()=>{const{visibleGroups:e}=T;return 0===e.length&&!t.shouldShowSpinnerStore.state||e.length>0}),[t,T]),j=(0,X.VK)((()=>{const{total:e,hiddenGroups:o}=T;return p<e-o.length&&R||Ce({collectionContextStore:t,isForColumnGroups:!1})}),[R,t,T,p]),I=(0,X.VK)((()=>!e.disabled&&!l.isLocked&&l.canConfigureBlock&&!P&&d&&(0,ee.Wz)(d,l.canConfigureCollection)&&"collectionTypedView"!==t.contextType&&!(0,si.w)(d.property)&&R),[R,t,l.canConfigureBlock,l.canConfigureCollection,l.isLocked,e.disabled,d,P]),F=(0,X.VK)((()=>$e.default.getConfigKey("collection_reducer_request_settings","general_debounce_wait_ms")),[]);if(!a)return null;const N=(0,C.jsxs)("div",{style:{position:"relative"},children:[(0,C.jsx)(Cn,{groups:T.visibleGroups,groupBy:d,groupsDisplayState:T,format:a,schema:m,query:S,reducerId:e.reducerId,store:e.store,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,timelineProps:o}),P&&(0,C.jsx)(pn,{viewType:s,isFullScreen:e.isFullScreen,galleryCoverSize:a.gallery_cover_size}),j&&(0,C.jsx)(vn,{timelineType:null==o?void 0:o.type,collectionContextStore:e.collectionContextStore,schema:m,format:a,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,groupsDisplayState:T}),M.length>0&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(xn,{reducerId:e.reducerId,timelineType:null==o?void 0:o.type,format:a,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,columnsDisplayState:_,hiddenGroups:M,hiddenGroupsVisibleStore:b}),w&&(0,C.jsx)(Cn,{groups:M,groupBy:d,groupsDisplayState:T,format:a,schema:m,query:S,reducerId:e.reducerId,store:e.store,collectionContextStore:e.collectionContextStore,disabled:e.disabled,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,getGroupStyle:e.getGroupStyle,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,timelineProps:o})]}),I&&(0,C.jsx)(yn,{timelineType:null==o?void 0:o.type,store:e.store,collectionContextStore:e.collectionContextStore,schema:m,format:a,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,groupsDisplayState:T,groupBy:d})]});return y?(0,C.jsx)(bt.Z,{id:e.reducerId,reducer:y,collectionContextStore:e.collectionContextStore,resultStore:x,render:()=>N,debounceWait:F}):N}const fn=i.memo(gn,pe.Z);function Cn(e){const t=(0,X.VK)((()=>e.collectionContextStore.groupsStore.getGroupState),[e.collectionContextStore.groupsStore]),o=(0,X.VK)((()=>e.collectionContextStore.isInPeekRendererStore.state),[e.collectionContextStore]);return(0,C.jsx)(C.Fragment,{children:e.groups.map(((r,i)=>{var n,s;return t&&e.groupBy?(0,C.jsx)(Ci,{collectionContextStore:e.collectionContextStore,groupsDisplayState:e.groupsDisplayState,groupFormat:r,groupBy:e.groupBy,disabled:e.disabled,groupsFormatKey:ee.Uh,groupAggregationKey:ee.dQ,format:e.format,schema:e.schema,query:e.query,isInPeekRenderer:o,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,stickyLeft:e.stickyLeft,renderGroup:e.renderGroup,renderHeader:e.renderHeader,onGroupHeaderAddItem:e.onGroupHeaderAddItem,getGroupStyle:e.getGroupStyle,ignoreAncestorStickyContainer:(null===(n=e.timelineProps)||void 0===n?void 0:n.type)&&Sn.has(null===(s=e.timelineProps)||void 0===s?void 0:s.type),index:i,isLast:i===e.groups.length-1},(0,ee.mD)(r)):null}))})}function vn(e){const t=(0,X.VK)((()=>e.collectionContextStore.groupsLimitStore),[e.collectionContextStore]);return"dropzone"===e.timelineType?null:"item"===e.timelineType?(0,C.jsx)(Ji,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:t,visibleGroups:e.groupsDisplayState.visibleGroups,hiddenGroups:e.groupsDisplayState.hiddenGroups,total:e.groupsDisplayState.total,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft}):(0,C.jsx)("div",{style:{display:"flex"},children:(0,C.jsx)($i,{type:"default",schema:e.schema,collectionContextStore:e.collectionContextStore,groupsLimitStore:t,visibleGroups:e.groupsDisplayState.visibleGroups,hiddenGroups:e.groupsDisplayState.hiddenGroups,total:e.groupsDisplayState.total,style:e.stickyLeft?{position:"sticky",left:e.paddingLeft}:void 0})})}function yn(e){const t=(0,Y.O7)(),o=(0,X.VK)((()=>e.collectionContextStore.groupsLimitStore),[e.collectionContextStore]),r=i.useCallback(((e,t,o,r,i)=>{const n=o.collectionStore();n&&E.tH({update:e,collectionContextStore:o,groupsFormatKey:ee.Uh,collectionStore:n,environment:t,groupBy:r,schema:i})}),[]);return"dropzone"!==e.timelineType&&e.groupBy?"item"===e.timelineType?(0,C.jsx)(Yi,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft,onAccept:o=>{e.groupBy&&r(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):(0,C.jsx)(ps,{type:"default",collectionContextStore:e.collectionContextStore,parentStore:e.store,groupsLimitStore:o,groupBy:e.groupBy,currentGroups:e.groupsDisplayState.currentGroups,schema:e.schema,paddingLeft:e.paddingLeft,stickyLeft:!0,onAccept:o=>{e.groupBy&&r(o,t,e.collectionContextStore,e.groupBy,e.schema)}}):null}function xn(e){return"board_collection_groups"===e.reducerId?(0,C.jsx)(Gi,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,format:e.format,columnsDisplayState:e.columnsDisplayState}):"dropzone"===e.timelineType?null:"item"===e.timelineType?(0,C.jsx)(Xi,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,format:e.format,isFullScreen:e.isFullScreen,isRootChild:e.isRootChild,paddingLeft:e.paddingLeft}):(0,C.jsx)("div",{style:{display:"flex"},children:(0,C.jsx)(Ki,{hiddenGroups:e.hiddenGroups,hiddenGroupsVisibleStore:e.hiddenGroupsVisibleStore,style:{marginTop:10,...e.stickyLeft?{position:"sticky",left:e.paddingLeft}:{}}})})}var bn=o(917504);class wn extends c.default{getInitialState(){return{}}}const kn=wn;const Tn=function(e){let{store:t,disabled:o,isFirstItem:r,isLastItem:i,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:h,format:m,schema:S,coverFormat:g,coverAspectFormat:f,coverSizeFormat:v,coverHeight:y,coverWidth:x,shouldShowTitle:b,onTextEnter:w,onTextEsc:k,onShiftEnter:T,blockPropertyValueOverlayStore:_,isLast:V,handleOpenPeekPage:O,collectionContextStore:M}=e;return(0,C.jsx)(fo,{store:t,disabled:o,isFirstItem:r,isLastItem:i,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:h,format:m,schema:S,coverFormat:g,coverAspectFormat:f,coverSizeFormat:v,coverHeight:y,coverWidth:x,shouldShowTitle:b,colorStyle:void 0,onTextEnter:w,onTextEsc:k,onShiftEnter:T,blockPropertyValueOverlayStore:_,isLast:V,handleOpenPeekPage:O,collectionContextStore:M})},_n=i.memo((function(e){let{collectionContextStore:t,groupFormat:o,format:r,schema:n,disabled:s,store:l,blockPropertyValueOverlayStore:a,collectionGalleryViewStore:c,isSingleColumn:d}=e;const u=(0,Y.O7)(),p=(0,i.useMemo)((()=>o?[o]:[]),[o]),h=(0,X.VK)((()=>t.permissionScopesStore.state),[t.permissionScopesStore]),m=(0,X.VK)((()=>l.canEdit()&&("collectionTypedView"===t.contextType||h.canEditContent)),[t,h.canEditContent,l]),S=(0,i.useCallback)((e=>{const t=e.blocks;if(t.length>0){const e=t[0],o=e.getBlockTitleStore();G.eP({environment:u,store:e}),U.NX({store:o}),le.Z5({store:e})}}),[u]),g=(0,i.useCallback)((e=>{const o=t.collectionStore(),r=e.getTitleStore();if(!r)return;me.QaF(r.getValue())?G.Ys({environment:u,store:e}):o&&q.createAndCommit({userAction:"CollectionGalleryView.handleItemTextEsc",environment:u,perform:t=>{E.Od({store:e,transaction:t})}})}),[t,u]),f=(0,i.useMemo)((()=>d?{position:"absolute",top:6,left:0,right:0,height:4}:{position:"absolute",top:16,bottom:4,width:4,height:"none"}),[d]),{gallery_cover:v,gallery_cover_aspect:y,gallery_cover_size:x}=r,b=!s&&m&&!h.isSyncedCollection,{coverHeight:w,coverWidth:k}=(0,X.VK)((()=>{const{coverHeight:e,coverWidth:t}=c.state;return{coverHeight:e,coverWidth:t}}),[c]),T=(0,i.useMemo)((()=>({format:r,schema:n,onTextEnter:g,onTextEsc:g,onShiftEnter:S,disabled:s,coverFormat:v,coverAspectFormat:y,coverSizeFormat:x,coverHeight:w,coverWidth:k,shouldShowTitle:It.K8(r,"gallery"),blockPropertyValueOverlayStore:a,collectionContextStore:t})),[a,t,w,k,y,v,x,s,r,S,g,n]);return(0,C.jsx)(Tt,{collectionContextStore:t,groupsPointer:p,format:r,canDrag:b,onSelectableEnter:S,resultProps:T,resultComponent:Tn,canDrop:!0,disabled:s,shouldShowHoverMenu:!1,direction:d?wt.Vertical:wt.Horizontal,belowDropZoneMargin:6,emptyDroppableSize:4,dropzoneGap:10,analyticsName:"gallery",emptyDroppableStyle:f,loadContentCover:v&&"page_content"===v.type})}));var Vn=o(417311);function On(e){const{hasPartialResults:t}=e;if(!(0,$o.Z)(!0,0,100))return null;const o=e.coverHeight??Vn.Z.card.desktop.medium.height,r=t?void 0:o+40,i=t?1:3,n=R.DZ(i,(e=>(0,C.jsx)(on,{minHeight:r},e)));return(0,C.jsx)(C.Fragment,{children:n})}const Mn=480,Pn=40;class Rn extends s.Z{constructor(){super(...arguments),this.storeTypes={collectionGalleryViewStore:kn},this.selectableContainer=null,this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderGroup=e=>(0,C.jsx)(Zn,{store:this.props.store,format:this.props.format,disabled:this.props.disabled,collectionContextStore:this.props.collectionContextStore,schema:this.props.schema,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,isFullScreen:this.props.isFullScreen,collectionGalleryViewStore:this.stores.collectionGalleryViewStore,isSingleColumnStore:this.isSingleColumnStore,isReadyStore:this.isReadyStore,groupFormat:e}),this.handleResize=()=>{const{collectionGalleryViewStore:e}=this.stores,t=this.getGalleryCardCoverHeight(),o=this.getGalleryCardActualWidth();e.state.coverHeight!==t&&this.setCardCoverHeight(t),e.state.coverWidth!==o&&En(this.props.format,this.stores.collectionGalleryViewStore,o)},this.handleResizeDebounced=(0,R.Ds)(this.handleResize,1e3),this.handleResizeThrottled=(0,R.P2)(this.handleResize,100),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem=e=>Bn(e,this.environment,this.props.collectionContextStore),this.isSingleColumnStore=this.createComputedStore((()=>this.environment.WindowSizeStore.state.width<=Mn)),this.isReadyStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()}))}didUpdate(e){(e.format||{}).gallery_cover_size!==(this.props.format||{}).gallery_cover_size&&(this.setCardCoverHeight(),En(this.props.format,this.stores.collectionGalleryViewStore))}didMount(){En(this.props.format,this.stores.collectionGalleryViewStore),this.setCardCoverHeight(),(0,ui.lj)(window,"resize",this.handleResizeThrottled),this.environment.device.isMobile&&(0,ui.lj)(window,"orientationchange",this.handleResizeDebounced)}willUnmount(){(0,ui.ZV)(window,"resize",this.handleResizeThrottled),this.environment.device.isMobile&&(0,ui.ZV)(window,"orientationchange",this.handleResizeDebounced)}renderComponent(){const{store:e,format:t,paddingBottom:o,paddingLeft:r,paddingRight:i,isFullScreen:n,collectionContextStore:s}=this.props,l=ae.az(s,n),a=t.collection_group_by,c=s.isInHomeWidgetStore.state;return(0,bn.Z)((t=>(0,C.jsxs)("div",{style:{paddingBottom:o,paddingLeft:r,paddingRight:i,minWidth:this.props.minWidth},className:dt.sbt,children:[(0,C.jsx)(St.Z,{store:e,shouldShowHalo:!n&&!c,canSelect:!n,analyticsName:"gallery",...t,ref:e=>this.selectableContainer=e,children:a?(0,C.jsx)(Hn,{collectionContextStore:this.props.collectionContextStore,store:this.props.store,format:this.props.format,disabled:this.props.disabled,schema:this.props.schema,query:this.props.query,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,isFullScreen:this.props.isFullScreen,paddingLeft:this.props.paddingLeft,isRootChild:this.props.isRootChild,isInPeekRenderer:this.props.isInPeekRenderer,collectionGalleryViewStore:this.stores.collectionGalleryViewStore,isSingleColumnStore:this.isSingleColumnStore,isReadyStore:this.isReadyStore,groupBy:a}):(0,C.jsx)(Zn,{store:this.props.store,format:this.props.format,disabled:this.props.disabled,collectionContextStore:this.props.collectionContextStore,schema:this.props.schema,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,isFullScreen:this.props.isFullScreen,collectionGalleryViewStore:this.stores.collectionGalleryViewStore,isSingleColumnStore:this.isSingleColumnStore,isReadyStore:this.isReadyStore,groupFormat:void 0})}),!l&&(0,C.jsx)(Rt.Z,{onChange:e=>function(e,t,o,r){var i;const n=o.isLoadingStore.state,s=null===(i=function(e){var t;return null===(t=e.groupsStore.getGroupState([]))||void 0===t?void 0:t.reducerResultStore}(o))||void 0===i?void 0:i.state;e<Ft.Z.incrementScrollOffset&&s&&!n&&null!=s&&s.hasMore&&E.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:r,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}(e,this.environment,this.props.collectionContextStore,this.props.isFullScreen)})]})))}setCardCoverHeight(e){const{collectionGalleryViewStore:t}=this.stores;t.setState({...t.state,coverHeight:e||this.getGalleryCardCoverHeight()})}getGalleryCardActualWidth(){if(this.selectableContainer){const e=this.selectableContainer.getNode();if(e){const t=e.querySelector(`.${dt.K4T}`);if(t)return t.offsetWidth}}return In(this.props.format)}getGalleryCardCoverHeight(){return this.getGalleryCardActualWidth()*(9/16)}}Rn.displayName="CollectionGalleryView",Rn.contextTypes={...yi.wK,...s.w};const jn=Rn;function In(e){const t=e.gallery_cover_size;return ae.rD(t)}function Fn(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor}}function Nn(e){let{args:t}=e;const o=(0,J.Fg)(),r=(0,X.VK)((()=>t.collectionContextStore.isInHomeWidgetStore.state),[t.collectionContextStore]);return(0,C.jsx)(Yr,{...t,height:r?It.yZ:48,getComputedStickyStyle:e=>function(e,t){return{boxShadow:e?`0 -1px 0 ${t.contentBackground}`:void 0}}(e,o)})}function Bn(e,t,o){if(t.device.isMobile)ne._c({environment:t,store:e,pageVisitSource:d.tY.Create});else{const r="collectionTypedView"===o.contextType;se.CH({environment:t,store:e,peekMode:ae.kr(o),showMoveTo:r,resultsStore:void 0,collectionContextStore:o,pageVisitSource:d.tY.Create})}}function En(e,t,o){t.setState({...t.state,coverWidth:o||In(e)})}function An(e,t,o){const r=e.collection_group_by;return{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${o?"100%":`${In(e)}px`}, 1fr))`,gridRowGap:16,gridColumnGap:16,paddingTop:r?1:16,paddingBottom:4,...t?{paddingLeft:8,paddingRight:8}:{}}}function Ln(e,t,o,r,i){if(!Nt.M_(o))return;const n=r.groupsStore.getGroupState(e);n&&q.createAndCommit({userAction:"CollectionGalleryView.handleAddItemClick",environment:o,perform:s=>{const{mainEditorCurrentBlockStore:l}=uo.default.state,a=E.IW({environment:o,collectionContextStore:r,groupsPointer:e,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:s,from:"gallery",useCrdt:t});if(!a)return;!function(e,t,o){o?o(e):zt.c4({environment:t,url:e})}(ae.mb({store:a.newStore,mainEditorCurrentBlockStore:l,collectionContextStore:r})??(0,lo.ZP)({store:a.newStore,pageVisitSource:d.tY.Create}),o,i),Z.Xd({collectionContextStore:r,resultsStore:n.resultsStore}),lt.W(o,{from:"gallery_view_add_item_bottom",type:"page",new_page_id:a.newStore.id,creating_block_id:a.newStore.id,...(0,Ke.Pn)(r)})}})}function Dn(e){let{groupsPointer:t,collectionContextStore:o}=e;const r=(0,J.Fg)(),n=(0,Y.O7)(),s=(0,i.useContext)(yi.ZO);return(0,C.jsx)(xe.Z,{onClick:e=>Ln(t,(0,jt.SL)({event:e,source:"collection_non_table_view"}),n,o,s),onMouseDown:ye.$0,style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,borderRadius:4,boxShadow:"dark"===r.mode?`${r.darkDividerColor} 0px 0px 0px 1px inset`:`${r.regularDividerColor} 0px 0px 0px 1px inset`,minHeight:Pn},children:(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:-6},children:[(0,de.R)(Fn(r)),(0,C.jsx)("div",{style:{color:r.lightIconColor},children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"New",id:"database.galleryView.addItemButtonTitle"})})]})})}function Zn(e){let{groupFormat:t,store:o,format:r,disabled:n,collectionContextStore:s,schema:l,blockPropertyValueOverlayStore:a,isFullScreen:c,collectionGalleryViewStore:d,isSingleColumnStore:u,isReadyStore:p}=e;const h=(0,J.Fg)(),m=(0,X.VK)((()=>u.state),[u]),S=(0,X.VK)((()=>p.state),[p]),g=(0,i.useMemo)((()=>t?[t]:[]),[t]),f=(0,X.VK)((()=>s.groupsStore.getGroupState(g)),[s,g]),v=(0,X.VK)((()=>d.state.coverHeight),[d]),y=(0,X.VK)((()=>null==f?void 0:f.reducerResultStore.state),[f]),x=void 0!==t,b=void 0!==y&&(null==y?void 0:y.blockIds.length)>0,w=(0,X.VK)((()=>fe({collectionContextStore:s,groupsPointer:g,hasPartialResults:b})),[s,g,b]),k=(0,X.VK)((()=>ae.VM({collectionContextStore:s,reducerResult:y,isFullScreen:c})),[s,y,c]),T=(0,X.VK)((()=>s.permissionScopesStore.state),[s]),_=T.isSyncedCollection,V=(0,X.VK)((()=>o.canEdit()&&("collectionTypedView"===s.contextType||T.canEditContent)),[o,s,T]),O=(0,X.VK)((()=>s.isInHomeWidgetStore.state),[s]);if(!f)return null;const M=!O&&S&&!n&&V&&!_&&(b||!w);return(0,C.jsxs)("div",{style:{paddingBottom:t?16:void 0},children:[(0,C.jsxs)("div",{style:An(r,O,m),children:[(0,C.jsx)(_n,{collectionContextStore:s,groupFormat:t,format:r,schema:l,disabled:n,store:o,blockPropertyValueOverlayStore:a,collectionGalleryViewStore:d,isSingleColumn:m}),w&&(0,C.jsx)(On,{hasGroups:x,hasPartialResults:b,coverHeight:v}),M&&(0,C.jsx)(Dn,{collectionContextStore:s,groupsPointer:g})]}),k&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{style:{width:"100%",borderTop:t?void 0:`1px solid ${h.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,C.jsx)(Ae,{groupsPointer:g,store:o,collectionContextStore:s,format:r,isFullScreen:c,incrementLimitsInRelatedGroups:!1})]})]})}function Hn(e){let{groupBy:t,collectionContextStore:o,store:r,format:n,disabled:s,schema:l,query:a,blockPropertyValueOverlayStore:c,isFullScreen:d,paddingLeft:u,isRootChild:p,isInPeekRenderer:h,collectionGalleryViewStore:m,isSingleColumnStore:S,isReadyStore:g}=e;const f=(0,J.Fg)(),v=(0,Y.O7)(),y=(0,i.useCallback)((e=>Bn(e,v,o)),[v,o]),x=(0,i.useCallback)((e=>(0,C.jsx)(Zn,{store:r,format:n,disabled:s,collectionContextStore:o,schema:l,blockPropertyValueOverlayStore:c,isFullScreen:d,collectionGalleryViewStore:m,isSingleColumnStore:S,isReadyStore:g,groupFormat:e})),[r,n,s,o,l,c,d,m,S,g]);return(0,C.jsx)(fn,{reducerId:"gallery_groups",store:r,collectionContextStore:o,disabled:s,isFullScreen:d,isRootChild:p,paddingLeft:u,stickyLeft:!1,renderGroup:x,getGroupStyle:e=>function(e,t){return 0===e.index?{}:{borderTop:`1px solid ${t.tableDividerColor}`}}(e,f),renderHeader:e=>(0,C.jsx)(Nn,{args:e}),onGroupHeaderAddItem:y})}function zn(e){const t=e.minHeight||Pn,o=(0,J.yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,backgroundColor:e.largeShimmerColor,minHeight:t,width:"100%",marginBottom:4}})),[t]);return(0,C.jsx)(tn.Z,{style:o.card})}function Kn(){return(0,$o.Z)(!0,0,100)?(0,C.jsx)(zn,{}):null}const Gn=5,Wn=5,Un=5,qn=8,$n=8;function Qn(e,t){return t?0:e?8:12}const Yn=function(e){let{groupsPointer:t,schema:o,format:r,collectionContextStore:i,store:n,disabled:s,blockPropertyValueOverlayStore:l,isFullScreen:a,anyGroupHasResults:c,isInPeekRenderer:d,hoveredGroupStore:u}=e;const p=(0,J.Fg)(),h=(0,Y.O7)(),m=(0,X.VK)((()=>{const e=R.Z$(t);return(0,Ge.II)({environment:h,groupFormat:e,schema:o,format:r,theme:p})}),[t,o,r,h,p]),S=(0,X.VK)((()=>{const e=i.groupsStore.getGroupState(t);return Boolean(null==e?void 0:e.reducerResultStore.state)}),[t,i]),g=(0,X.VK)((()=>i.groupsStore.getGroupState(t)),[i,t]),f=(0,X.VK)((()=>(0,ae.az)(i,a)),[i,a]),v=(0,X.VK)((()=>null==g?void 0:g.reducerResultStore.state),[g]),y=(0,X.VK)((()=>i.permissionScopesStore.state),[i]),x=(0,X.VK)((()=>i.isInHomeWidgetStore.state),[i]),b=(0,X.VK)((()=>!s&&S&&i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!x})),[s,S,i,x]),w=(0,X.VK)((()=>(0,ae.VM)({reducerResult:v,collectionContextStore:i,isFullScreen:a})),[v,i,a]),k=(0,X.VK)((()=>fe({collectionContextStore:i,groupsPointer:t,hasPartialResults:c})),[i,t,c]),T=(0,X.VK)((()=>c&&i.shouldShowSpinnerStore.state&&"load_general"===i.loadingDetailsStore.state.type),[i,c]);if(!g)return null;const _=function(e){return e?e.board_cover:void 0}(r),V=!s&&!y.isSyncedCollection,O=Boolean(r.collection_group_by),M=!c&&O&&k;return(0,C.jsxs)("div",{style:ns(r,x,d,S,m),onMouseDown:e=>function(e,t){const{device:o}=t,{target:r}=e;!o.isMobile&&r instanceof HTMLElement&&(0,ye.ZP)({event:e,context:ye.Af.EditorMouseDown,callback:()=>{e.preventDefault(),H.AI({environment:t,target:r,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,h),onClick:os,className:dt.GfL,onMouseMove:()=>function(e,t){const o=R.Z$(e);o&&t.state!==o&&t.setState(o)}(t,u),children:[(0,C.jsx)(Tt,{collectionContextStore:i,groupsPointer:t,format:r,canDrag:V,onSelectableEnter:e=>rs(e,t,i,a,h),resultProps:{format:r,schema:o,onTextEnter:e=>function(e,t,o,r,i,n){if(!Nt.M_(n)||!o.collectionStore())return is(e,o,i,t,n);const s=ts(t,o);if(!s)return;const l=s.state.findIndex((t=>t===e))+1;q.createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:n,perform:e=>{Bt({transaction:e,environment:n,collectionContextStore:o,isFullScreen:r,groupsPointer:t,insertAtIndex:l,from:"board_group_enter_add_item",transient:!0,useCrdt:(0,jt.dy)({source:"collection_non_table_view"})})}})}(e,t,i,a,n,h),onShiftEnter:e=>rs(e,t,i,a,h),coverFormat:_,coverAspectFormat:Xn(r),coverSizeFormat:Jn(r),shouldShowTitle:It.K8(r,"board"),colorStyle:m,onTextEsc:e=>is(e,i,n,t,h),disabled:s,blockPropertyValueOverlayStore:l,collectionContextStore:i},canDrop:!0,resultComponent:qo,disabled:s,direction:wt.Vertical,shouldShowHoverMenu:!1,belowDropZoneMargin:2,emptyDroppableSize:O?Gn:3,analyticsName:"board",loadContentCover:_&&"page_content"===_.type}),M&&(0,C.jsx)(Kn,{}),w&&(0,C.jsx)(Ae,{groupsPointer:t,store:n,collectionContextStore:i,format:r,isFullScreen:a,incrementLimitsInRelatedGroups:!0}),b&&(0,C.jsxs)(C.Fragment,{children:[w&&(0,C.jsx)("div",{style:{width:"100%",borderTop:`1px solid ${p.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,C.jsx)(At,{groupsPointer:t,collectionContextStore:i,isFullScreen:a,color:null==m?void 0:m.textColor,shouldShowSpinner:T})]}),!f&&(0,C.jsx)(Rt.Z,{onChange:e=>function(e,t,o,r,i){const n=t.isLoadingStore.state,s=t.groupsStore.getGroupState(r),l=null==s?void 0:s.reducerResultStore.state;e<Ft.Z.incrementScrollOffset&&!n&&l&&l.hasMore&&(E.ID({collectionContextStore:t,environment:i,incrementLimitArgs:{isFullScreen:o,currentResultCount:l.blockIds.length,groupsPointer:r,incrementLimitsInRelatedGroups:!1}}),t.loadingDetailsStore.setState({type:"load_general"}))}(e,i,a,t,h)})]})};function Xn(e){return e?e.board_cover_aspect:void 0}function Jn(e){return e?e.board_cover_size:void 0}function es(e){const t=e.board_cover_size;return(0,ae.rD)(t)}function ts(e,t){const o=t.groupsStore.getGroupState(e);return null==o?void 0:o.resultsStore}function os(e){(0,ye.ZP)({event:e,context:ye.Af.EditorClick,callback:()=>{}})}function rs(e,t,o,r,i){const{blocks:n,transaction:s}=e;if(0===n.length)return;const l=n[0];if(!Nt.M_(i)||!o.collectionStore()||!o.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const a=ts(t,o);if(!a)return;Bt({transaction:s,environment:i,collectionContextStore:o,isFullScreen:r,groupsPointer:t,insertAtIndex:a.state.findIndex((e=>e===l))+1,from:"board_group_enter_add_item",transient:!0,useCrdt:(0,jt.dy)({source:"collection_non_table_view"})})}function is(e,t,o,r,i){const n=t.collectionStore(),s=e.getTitleStore();if(!s)return;if(me.QaF(s.getValue()))G.Ys({environment:i,store:e});else if(n){const n=ts(r,t);if(!n)return;const s=n.state.findIndex((t=>t===e))-1,l=t.collectionViewStore(),a=t.collectionViewBlockStore();if(l&&a&&I.sG(i,{...(0,Ke.Pn)(t),block_id:o.id}),q.createAndCommit({userAction:"BoardGroupResults.handleItemTextEsc",environment:i,perform:t=>{E.Od({store:e,transaction:t})}}),s>=0){const e=n.state[s];G.Ys({environment:i,store:e})}}}function ns(e,t,o,r,i){const n=Boolean(e.collection_group_by),s=t?qn:Gn,l=t?$n:Wn;return{flex:"none",paddingLeft:s,paddingRight:s,paddingBottom:s,marginRight:2*Un,boxSizing:"content-box",width:es(e),height:n?void 0:"max-content",...i&&r&&{backgroundColor:o?i.peekBackgroundColor:i.backgroundColor,...n?{borderRadius:l}:{borderBottomLeftRadius:l,borderBottomRightRadius:l}}}}var ss=o(61766),ls=o(68500);const as=28,cs=4,ds=(0,P.defineMessages)({iconAriaLabel:{defaultMessage:"Add a group",id:"database.collectionAddGroupButton.ariaLabel"}});function us(e){let{type:t,style:o,groupBy:r,currentGroups:n,schema:s,groupsLimitStore:l,collectionContextStore:a,parentStore:c,onAccept:d,paddingLeft:u,stickyLeft:p}=e;const h=(0,Y.O7)(),m=(0,J.Fg)(),S=(0,X.qz)(void 0,ss.Z),g=s[r.property],f=(0,X.VK)((()=>(0,Ge.II)({environment:h,groupFormat:void 0,schema:s,format:a.normalizedFormatStore.state,theme:m})),[a,h,s,m]),v=(0,J.yK)((e=>({plusIcon:{fill:e.mediumTextColor},iconButton:{width:35,background:null==f?void 0:f.backgroundColor,paddingLeft:10,paddingRight:10,paddingTop:Gn,paddingBottom:Gn,marginRight:Un,borderRadius:Wn,height:33,...o}})),[f,o]),y=(0,i.useCallback)((e=>{!function(e){let{schema:t,groupBy:o,currentGroups:r,groupsLimitStore:i,collectionContextStore:n,onAccept:s,environment:l,buttonPopupStore:a,update:c}=e;const{newGroupValue:d}=c,u=t[o.property],p=i.state;if(!u||!(0,ee.LG)(u))return;if(F.wd({environment:l,collectionContextStore:n,action:"board_add_group"}),a.reset(),ce.cu(u)){if(u.type!==d.type)return;if(void 0===d.value)return;const e=u.options||[],i={id:ue.Il(),value:d.value,color:(0,ce.TL)(e)},n=[...e,i],l={...u,options:n},a={...t,[o.property]:l},c={property:o.property,value:d,hidden:!1};return void s({newGroups:(0,Ge.nr)(r,c,p),newSchema:a})}if("person"===u.type||"relation"===u.type||(0,ee.HB)(u.type)){const e={property:o.property,value:d,hidden:!1};return void s({newGroups:(0,Ge.nr)(r,e,p),newPage:c.newPage})}if((0,ee.A1)(u.type)||"status"===u.type||"number"===u.type||"created_by"===u.type||"last_edited_by"===u.type||"formula"===u.type||"checkbox"===u.type||"location"===u.type)return;(0,he.t1)(u.type)}({schema:s,groupBy:r,currentGroups:n,groupsLimitStore:l,collectionContextStore:a,onAccept:d,environment:h,buttonPopupStore:S,update:e})}),[S,a,n,h,r,l,d,s]),x=(0,i.useCallback)((()=>{!function(e){e.reset()}(S)}),[S]),b=(0,i.useCallback)((()=>(0,C.jsx)(ls.Q,{groupFormat:void 0,groupBy:r,currentGroups:n,schema:s,onChange:y,onClose:x,parentStore:c})),[n,r,y,x,c,s]);return g&&(0,ee.LG)(g)?(0,C.jsx)(Te.ZP,{render:b,buttonPopupStore:S,popupType:h.device.isMobile?Te.Z4.SlideUp:Te.Z4.Popup,renderOrigin:e=>"default"===t?(0,C.jsx)(Et.Z,{isLightGray:!0,icon:de.R,style:{display:"flex",height:as,marginTop:12,marginBottom:cs,width:"max-content",position:p?"sticky":void 0,left:p&&u?u:0,...o},...e,children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Add a group",id:"database.boardView.addGroupButtonTitle"})}):(0,C.jsx)(_e.Z,{ariaLabel:We.default.formatMessage(ds.iconAriaLabel),icon:e=>(0,de.R)({...e,...v.plusIcon}),style:v.iconButton,...e})}):null}const ps=i.memo(us,pe.Z);var hs=o(863296);function ms(e){const t=(0,J.yK)((()=>({button:{display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"}})),[]);return(0,C.jsx)(xe.Z,{style:t.button,onClick:e.onClick,children:e.children})}const Ss=function(e){const{title:t,description:o,icon:r,style:i,buttonText:n,buttonOnClick:s}=e,l=(0,$o.Z)(!0,300,0),a=(0,J.yK)((e=>({wrapper:{paddingTop:8,minHeight:250,height:1,display:"flex",alignItems:"center",justifyContent:"center",...i},innerWrapper:{paddingTop:16,paddingLeft:16,paddingRight:16,paddingBottom:16},title:{fontSize:17,fontWeight:j.Z.fontWeight.medium,color:e.lightTextColor,textAlign:"center",marginBottom:-2},description:{margin:"0 auto",fontSize:14,color:e.lightTextColor},button:{marginTop:12,fontSize:14,fontWeight:j.Z.fontWeight.medium,color:e.regularTextColor}})),[i]);if(!l)return null;const c=(0,C.jsxs)("div",{style:a.innerWrapper,children:[r,(0,C.jsx)("div",{style:a.title,children:t}),o?(0,C.jsx)("div",{style:a.description,children:o}):void 0,n?(0,C.jsx)(hs.Z,{onClick:s,style:a.button,children:n}):void 0]});return(0,C.jsx)("div",{style:a.wrapper,children:c})};var gs=o(279131);function fs(e){const{height:t,boardCoverSize:o,showGroupHeader:r,areColumnsColored:i,isInHomeWidget:n}=e,s=e.numBoardColumns||3,l=function(e,t){const o=t?qn:Gn,r=2*o;return(0,ae.rD)(e)+r}(o,n),a=(0,J.yK)((e=>({container:{display:"flex",alignItems:"flex-start",paddingTop:r?10:0},groupHeader:{backgroundColor:e.largeShimmerColor,height:16,marginBottom:10,borderRadius:12,width:"50%"},group:{marginTop:r?i?20:8:0,marginRight:10,width:"100%",minWidth:l}})),[i,r,l]),c=R.DZ(s,(e=>(0,C.jsxs)("div",{style:a.group,children:[(0,C.jsx)(tn.Z,{style:a.groupHeader}),(0,C.jsx)(zn,{minHeight:t})]},e)));return(0,C.jsx)("div",{style:a.container,children:c})}var Cs=o(268894),vs=o(743765),ys=o(903553),xs=o(724098);class bs extends c.default{getInitialState(){return{searchQuery:"",limit:bs.defaultLimit}}}bs.defaultLimit=20,bs.loadMoreScrollOffset=200,bs.loadMoreIncrement=20;const ws=bs;var ks=o(672087);const Ts={display:"flex",alignItems:"center",justifyContent:"flex-start",height:32,padding:4,borderRadius:4},_s=(0,P.defineMessages)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"boardHiddenGroup.searchPlaceholder"}});class Vs extends s.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:ss.Z,boardHiddenGroupStore:ws,requestStore:ks.Z},this.renderPopup=()=>{const{device:e}=this.environment,{groupFormat:t,schema:o,currentGroups:r,collectionContextStore:i,groupBy:n}=this.props;let s;s=e.isMobile?{menuType:Oe.og.Modal,title:(0,C.jsx)(Mr.Z,{groupBy:n,groupFormat:t,currentGroups:r,schema:o,disabled:!0,isHiddenGroup:!0,collectionContextStore:i}),left:(0,C.jsx)(Te.ZP,{popupType:Ve.kQ.SlideUp,renderOrigin:e=>(0,C.jsx)("div",{...e,children:(0,ke.o)({width:18,height:18,color:this.theme.lightTextColor})}),render:e=>(0,C.jsx)(Ns,{parent:e,groupFormat:this.props.groupFormat,currentGroups:this.props.currentGroups,format:this.props.format,schema:this.props.schema,query:this.props.query,collectionContextStore:this.props.collectionContextStore})}),right:(0,C.jsx)(nr.DoneMenuText,{}),onClickRight:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePopupClose,header:this.renderHeader()}:{menuType:Oe.og.Popup,header:this.renderHeader(),width:(0,ae.rD)(Rs(this.props.format))+20};const l=this.reducerStore.state;if(l)return(0,C.jsx)(ys.Z,{store:this.selectableBlockStore,isDefaultContainer:!0,droppable:!0,render:e=>{let{selectableEvents:o}=e;return(0,C.jsxs)(Pe.Z,{...s,...o,children:[(0,C.jsx)(bt.Z,{id:`board_hidden_group:${(0,ee.mD)(t)}`,reducer:l,groupsPointer:[t],collectionContextStore:i,resultStore:js(this.props.collectionContextStore,this.props.groupFormat),render:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderResults}),(0,C.jsx)(Rt.Z,{onChange:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleScrollOffsetChange})]})}})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderResults=()=>(0,C.jsx)(Ls,{groupFormat:this.props.groupFormat,disabled:this.props.disabled,format:this.props.format,collectionContextStore:this.props.collectionContextStore,schema:this.props.schema,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,isFullScreen:this.props.isFullScreen,buttonPopupStore:this.stores.buttonPopupStore}),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePopupClose=()=>As(this.stores.buttonPopupStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSearchInputChange=e=>function(e,t,o){o.setState({searchQuery:e.target.value,limit:ws.defaultLimit}),Fs(t)}(e,this.environment,this.stores.boardHiddenGroupStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSearchClearButtonClick=()=>{return e=this.environment,this.stores.boardHiddenGroupStore.reset(),void Fs(e);var e},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleButtonPopupClick=()=>{return e=this.environment,this.stores.boardHiddenGroupStore.reset(),void Fs(e);var e},this.handleDrop=e=>{const{droppedStores:t,duplicate:o}=e,{collectionContextStore:r,groupFormat:i}=this.props,s=n.findDOMNode(this);s&&s instanceof Element&&q.createAndCommit({userAction:"BoardHiddenGroup.handleDrop",environment:this.environment,perform:e=>E.by({environment:this.environment,collectionContextStore:r,groupsPointer:[i],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0})})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleScrollOffsetChange=e=>function(e,t,o,r){var i;const n=r.state,s=null===(i=js(t,o))||void 0===i||null===(i=i.state)||void 0===i?void 0:i.blockIds,l=t.isLoadingStore.state;e<ws.loadMoreScrollOffset&&!l&&s&&n.limit<=s.length&&r.setState({...n,limit:n.limit+ws.loadMoreIncrement})}(e,this.props.collectionContextStore,this.props.groupFormat,this.stores.boardHiddenGroupStore),this.reducerStore=this.createComputedStore((()=>{const{groupFormat:e,schema:t,format:o}=this.props,{boardHiddenGroupStore:r}=this.stores,{searchQuery:i,limit:n}=r.state,s=(0,Ze.zk)({schema:t,group:e,propertyMapping:void 0,timeZone:(0,He.r)()});if(!s)return;return{type:"results",filter:s,limit:n,searchQuery:i,loadContentCover:Boolean(o&&o.board_cover&&"page_content"===o.board_cover.type)}}))}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.selectableBlockStore=new Ye.G(this.environment,{table:_.iU,id:t.id}))}renderComponent(){const{device:e}=this.environment,{groupBy:t,groupFormat:o,disabled:r,query:i,schema:n,currentGroups:s,collectionContextStore:l}=this.props,a=i.aggregations?i.aggregations[0]:void 0,c=l.isInHomeWidgetStore.state;return(0,C.jsx)(St.Z,{store:this.selectableBlockStore,canDropOnto:!r,onSelectableDrop:this.handleDrop,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,children:(0,C.jsx)(Te.ZP,{popupType:e.isMobile?Ve.kQ.SlideUp:Ve.kQ.Popup,renderOrigin:e=>(0,C.jsxs)(xe.Z,{style:{...Ts,...c?{fontSize:14}:{}},...e,children:[(0,C.jsx)(Mr.Z,{groupBy:t,groupFormat:o,currentGroups:s,schema:n,disabled:!0,isHiddenGroup:!0,collectionContextStore:l}),a&&(0,C.jsx)(xi,{groupFormat:o,aggregation:a,schema:n,collectionContextStore:l,disabled:!0,onChange:e=>function(e,t,o,r){const i=t.collectionViewStore(),n=e?[e]:[],s={...o,aggregations:n};i&&q.createAndCommit({userAction:"BoardHiddenGroup.handleBoardAggregationChange",environment:r,perform:e=>{le.iG({collectionViewStore:i,update:{query2:s},transaction:e})}})}(e,this.props.collectionContextStore,this.props.query,this.environment)})]},(0,ee.mD)(o)),render:this.renderPopup,buttonPopupStore:this.stores.buttonPopupStore,onClick:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleButtonPopupClick})})}renderHeader(){const{device:e}=this.environment,{groupFormat:t,disabled:o,format:r,schema:n,query:s,currentGroups:l,collectionContextStore:a,isFullScreen:c,hoveredGroupStore:d,groupBy:u,isInPeekRenderer:p}=this.props,{searchQuery:h}=this.stores.boardHiddenGroupStore.state;return(0,C.jsxs)(i.Fragment,{children:[!e.isMobile&&(0,C.jsx)(ji,{groupBy:u,currentGroups:l,groupFormat:t,query:s,schema:n,format:r,collectionContextStore:a,disabled:o||Boolean(h),hidden:!0,isPopup:!0,isFullScreen:c,hoveredGroupStore:d,isInPeekRenderer:p},(0,ee.mD)(t)),(0,C.jsx)("div",{style:{margin:e.isMobile?0:"6px 0"},children:(0,C.jsx)(xs.Z,{capture:!0,render:t=>(0,C.jsx)(Cs.ZP,{value:h,placeholder:We.default.formatMessage(_s.searchPlaceholder),autoFocus:!e.isMobile,showClearButton:!0,onChange:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSearchInputChange,onClearButtonClick:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleSearchClearButtonClick,...t})})})]})}}Vs.displayName="BoardHiddenGroup";const Os=Vs;function Ms(e){return e?e.board_cover:void 0}function Ps(e){return e?e.board_cover_aspect:void 0}function Rs(e){return e?e.board_cover_size:void 0}function js(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.reducerResultStore}function Is(e,t){const o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore}function Fs(e){st.default.state.stores.length>0&&G.ZH({debug:{userAction:"BoardHiddenGroup.clearSelectionIfBlockIsSelected"},environment:e})}function Ns(e){let{parent:t,groupFormat:o,currentGroups:r,format:i,schema:n,query:s,collectionContextStore:l}=e;const a=(0,X.VK)((()=>l.collectionStore()),[l]),c=l.boardColumnsLimitStore;return a?(0,C.jsx)(ar,{parent:t,groupFormat:o,currentGroups:r,format:i,schema:n,query:s,collectionContextStore:l,groupsFormatKey:"board_columns",groupsLimitStore:c}):null}function Bs(e,t,o,r,i){const{blocks:n,transaction:s}=e,l=o.groupsStore.getGroupState(t);if(!l)return;const a=l.resultsStore;if(n.length>0&&a.state.length>0){const e=n[0];if(!Nt.M_(i)||!o.collectionStore()||!o.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;Bt({transaction:s,environment:i,collectionContextStore:o,isFullScreen:r,groupsPointer:[t],insertAtIndex:a.state.findIndex((t=>t===e))+1,from:"board_group_enter_add_item",transient:!0,useCrdt:(0,jt.dy)({source:"collection_non_table_view"})})}}function Es(e,t,o,r){const i=t.collectionStore(),n=e.getTitleStore();if(me.QaF(null==n?void 0:n.getValue()))return void G.Ys({environment:r,store:e});if(!i)return;const s=Is(t,o);if(!s)return;const l=s.state.findIndex((t=>t===e))-1,a=t.collectionViewStore(),c=t.collectionViewBlockStore();if(a&&c&&I.sG(r,{...(0,Ke.Pn)(t),block_id:e.id}),q.createAndCommit({userAction:"BoardHiddenGroup.handleBoardItemTextEsc",environment:r,perform:t=>{E.Od({store:e,transaction:t})}}),l>=0){const e=s.state[l];G.Ys({environment:r,store:e})}}function As(e){e.setState({open:!1})}function Ls(e){let{groupFormat:t,disabled:o,format:r,collectionContextStore:n,schema:s,blockPropertyValueOverlayStore:l,isFullScreen:a,buttonPopupStore:c}=e;const d=(0,Y.O7)(),u=(0,i.useCallback)((()=>As(c)),[c]),{device:p}=d,h=(0,X.VK)((()=>{var e;return null===(e=js(n,t))||void 0===e?void 0:e.state}),[n,t]),m=(0,X.VK)((()=>{var e;return null===(e=Is(n,t))||void 0===e?void 0:e.state}),[n,t]),S=(0,X.VK)((()=>Qe.default.isSidePeekOpen()),[]);return h&&m?0===m.length?(0,C.jsx)(je.Z,{children:(0,C.jsx)(vs.Z,{title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"No results",id:"database.boardView.searchResults.noResults.label"})})}):(0,C.jsx)("div",{style:{padding:p.isMobile?"8px 16px":"6px 14px 8px"},children:(0,C.jsx)(Tt,{collectionContextStore:n,groupsPointer:[t],format:r,canDrag:!o,onSelectableEnter:e=>Bs(e,t,n,a,d),disableRequest:!0,resultProps:{format:r,schema:s,disabled:o,coverFormat:Ms(r),coverAspectFormat:Ps(r),coverSizeFormat:Rs(r),shouldShowTitle:It.K8(r,"board"),colorStyle:void 0,blockPropertyValueOverlayStore:l,onTextEnter:e=>function(e,t,o,r,i){const n=Is(t,r);if(!n)return;if(!Nt.M_(i)||!t.collectionStore())return Es(e,t,r,i);const s=n.state.findIndex((t=>t===e))+1;q.createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:i,perform:e=>{Bt({transaction:e,environment:i,collectionContextStore:t,isFullScreen:o,groupsPointer:[r],insertAtIndex:s,from:"board_group_enter_add_item",transient:!0,useCrdt:(0,jt.dy)({source:"collection_non_table_view"})})}})}(e,n,a,t,d),onTextEsc:e=>Es(e,n,t,d),onShiftEnter:e=>Bs(e,t,n,a,d),collectionContextStore:n},resultComponent:qo,handleOpenPeekPage:S?void 0:u,canDrop:!0,disabled:o,shouldShowHoverMenu:!1,direction:wt.Vertical,belowDropZoneMargin:2,emptyDroppableSize:4,analyticsName:"board"})}):(0,C.jsx)(je.Z,{children:(0,C.jsx)(vs.Z,{title:(0,C.jsx)(be.Z,{})})})}class Ds extends io.Z{constructor(e){super(e),this.storeTypes={groupsResultStore:c.default.createClass(void 0,{name:"groupsResultStore"}),hoveredGroupStore:c.default.createClass(void 0,{name:"hoveredGroupStore"}),subgroupsMountedStore:c.default.createClass(!1,{name:"subgroupsMountedStore"}),lastColumnsByStore:c.default.createClass(void 0,{name:"lastColumnsByStore"}),lastGroupByStore:c.default.createClass(void 0,{name:"lastGroupByStore"})},this.hiddenGroupsContainerRef=void 0,this.hiddenGroupsHeaderRef=void 0,this.hiddenGroupsHeaderLastOffset=void 0,this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderBoardHiddenGroupsButton=e=>(0,C.jsx)(ol,{format:this.props.format,columnsDisplayStateStore:this.columnsDisplayStateStore,args:e}),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderSubGroupHeader=e=>(0,C.jsx)(rl,{collectionContextStore:this.props.collectionContextStore,isInPeekRenderer:this.props.isInPeekRenderer,format:this.props.format,subgroupsMountedStore:this.stores.subgroupsMountedStore,columnsDisplayStateStore:this.columnsDisplayStateStore,args:e}),this.renderHiddenGroup=e=>{const{collectionContextStore:t,query:o,schema:r,format:i,disabled:n,blockPropertyValueOverlayStore:s,isFullScreen:l,isInPeekRenderer:a}=this.props,c=this.columnsDisplayStateStore.state.currentGroups;if(!Hs(e,this.props.collectionContextStore)||!i.board_columns_by)return;const d=t.permissionScopesStore.state,u="collectionTypedView"===t.contextType;return(0,C.jsx)(Os,{query:o,schema:r,format:i,groupFormat:e,groupBy:i.board_columns_by,currentGroups:c,collectionContextStore:t,disabled:n||!this.canEdit()||!d.canEditContent&&!u,blockPropertyValueOverlayStore:s,isFullScreen:l,hoveredGroupStore:this.stores.hoveredGroupStore,isInPeekRenderer:a},(0,ee.mD)(e))},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleGroupsChange=()=>function(e,t,o,r){const i=r.state.currentGroups;E.$D({environment:e,format:t,groupsFormatKey:"board_columns",collectionContextStore:o,currentGroups:i})}(this.environment,this.props.format,this.props.collectionContextStore,this.columnsDisplayStateStore),this.handleGroupsChangeDebounced=R.Ds(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleGroupsChange,5e3),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave=()=>{this.stores.hoveredGroupStore.setState(void 0)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem=e=>function(e,t,o){!function(e,t,o){const{device:r}=o;if(r.isMobile)ne._c({environment:o,store:e,pageVisitSource:d.tY.Create});else{const r="collectionTypedView"===t.contextType;se.CH({environment:o,store:e,peekMode:ae.kr(t),showMoveTo:r,resultsStore:void 0,collectionContextStore:t,pageVisitSource:d.tY.Create})}}(e,o,t)}(e,this.environment,this.props.collectionContextStore),this.subgroupsOnChangeStore=this.createComputedStore((()=>{var e,t;const{collectionContextStore:o}=this.props,r=o.collectionViewStore();if(!r)return;const i=null==r||null===(e=r.getFormatStore())||void 0===e?void 0:e.getKeyStore("collection_group_by").getValue(),n=null==r||null===(t=r.getFormatStore())||void 0===t?void 0:t.getKeyStore("board_columns_by").getValue();R.Xy(i,this.stores.lastGroupByStore.state)&&R.Xy(n,this.stores.lastColumnsByStore.state)||this.stores.subgroupsMountedStore.setState(!1),this.stores.lastGroupByStore.setState(i),this.stores.lastColumnsByStore.setState(n)})),this.anyVisibleGroupHasResultsStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t,format:o,schema:r}=this.props,i=this.columnsDisplayStateStore.state,{visibleGroups:n}=i,s=o.collection_group_by,l=t.collectionViewBlockStore(),a=this.stores.groupsResultStore.state,c=a?a.results:void 0,d=void 0!==l?(0,Ge.Cz)({groupBy:s,schema:r,formatGroups:o.collection_groups||[],schemaGroups:this.schemaGroupsStore.state,reducerResults:c,getRecordModel:l.getRecordModel,relativeVariableResult:t.relativeVariableStore.state,viewAppConfigUri:null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri,allowedCollectionStores:t.collectionStoresStore.state}):[];if(0===d.length){if(void 0!==s)return!1;for(const e of n){const o=t.groupsStore.getGroupState(e);if(null!=o&&o.reducerResultStore.state)return!0}}else for(const u of d)for(const e of n){const o=[u,e],r=t.groupsStore.getGroupState(o);if(null!=r&&r.reducerResultStore.state)return!0}return!1})),this.schemaGroupsStore=this.createComputedStore((()=>{const{format:e,schema:t}=this.props,o=e.board_columns_by;if(o)return(0,ee.Qq)({schema:t,groupBy:o})}),{useDeepEqual:!0}),this.groupsReducerStore=this.createComputedStore((()=>{const{format:e,schema:t,collectionContextStore:o}=this.props,r=o.remoteRequestStore.state,i=$e.default.checkGate({gateName:"use_collection_reducer_request_hook"})?(0,ot.ze)(o,!0):null==r?void 0:r.loader.filter,n=e.board_columns_by;if(n)return(0,Ge.ej)({groupBy:n,schema:t,format:e,filter:i,groupsFormatKey:"board_columns",limit:o.boardColumnsLimitStore.state})})),this.columnsDisplayStateStore=this.createComputedStore((()=>{const{format:e,schema:t,collectionContextStore:o}=this.props,r=e.board_columns_by;if(!r)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const i=o.collectionViewBlockStore();if(!i)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const n=o.collectionViewStore(),s=o.boardColumnsLimitStore.state,l=this.schemaGroupsStore.state,a=this.stores.groupsResultStore.state,c=a?a.results:void 0,d=a?a.total:0,u=(0,Ge.Cz)({groupBy:r,schema:t,formatGroups:e.board_columns||[],schemaGroups:l,reducerResults:c,getRecordModel:i.getRecordModel,relativeVariableResult:o.relativeVariableStore.state,viewAppConfigUri:null==n?void 0:n.getFormat().app_config_uri,allowedCollectionStores:o.collectionStoresStore.state}),p=u.filter((e=>!(0,ee.eF)(e))).slice(0,s),h=u.filter((e=>(0,ee.eF)(e)));return{currentGroups:[...p,...h],visibleGroups:p,hiddenGroups:h,total:d}}),{useDeepEqual:!0}),this.disableBoardColorColumnsStore=this.createComputedStore((()=>{const{schema:e,format:t}=this.props;return!Boolean((0,Ge.II)({environment:this.environment,groupFormat:void 0,schema:e,format:t,theme:this.theme}))})),this.hiddenGroupsContainerRef=i.createRef(),this.hiddenGroupsHeaderRef=i.createRef(),this.hiddenGroupsHeaderLastOffset=0}UNSAFE_willMount(){this.columnsDisplayStateStore.addListener(this.handleGroupsChangeDebounced)}UNSAFE_willUnmount(){this.columnsDisplayStateStore.removeListener(this.handleGroupsChangeDebounced),this.handleGroupsChangeDebounced.cancel()}UNSAFE_willMountOrUpdate(e){const{format:t,store:o,collectionContextStore:r}=e,i=r.collectionStore();i&&(!t.board_columns_by&&o.isDefined()&&i.isDefined()&&function(e,t,o){const{collectionContextStore:r,schema:i}=e,n=r.collectionStore(),s=r.permissionScopesStore.state;if(!n)return;const l=r.collectionViewStore();if(!l||!s.canConfigureBlock)return;q.createAndCommit({userAction:"Board.updateOrCreateColumnsByProperty",environment:o,perform:e=>{let a,c=ae.Se(i);if(!c&&s.canConfigureCollection){c=(0,oe.ZP)();a={[c]:{name:t.formatMessage({id:"collection.boardView.selectProperty.defaultName",defaultMessage:"Status"}),type:"select",options:[]}}}if(!c)return;const d=(a||i)[c];d&&(0,ee.LG)(d)&&(re.FH({stores:[l],update:{board_columns_by:(0,ee.fw)(c,d,"collectionTypedView"===r.contextType)},transaction:e}),ie.sW({store:l,data:{type:"board"},transaction:e}),a&&le.xO({environment:o,collectionStore:n,update:a,transaction:e}))}})}(e,this.props.intl,this.environment),l.default.afterNextFlush((()=>this.updateHiddenGroupsHeaderOffset())))}renderPersisted(){const{format:e,collectionContextStore:t,isFullScreen:o,paddingLeft:r,paddingRight:i,paddingBottom:n}=this.props,s=t.permissionScopesStore.state,l=t.settingsStore;return e.board_columns_by?this.renderBoard():(0,C.jsx)(Ss,{title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"No group by property",id:"database.boardView.missingSelectPropertyTitle"}),description:s.canConfigureBlock?(0,C.jsx)(P.FormattedMessage,{defaultMessage:"<opensettingslink>Add a property to group by</opensettingslink> to your database in order to display a Board view.",id:"database.boardView.missingSelectProperty",values:{opensettingslink:e=>(0,C.jsx)(ms,{onClick:()=>{A.r$({collectionContextStore:t,collectionSettingsStore:l}),A.H4({collectionSettingsStore:l,item:{type:"properties",timelineViewTab:"table"}})},children:e})}}):(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Board views require a property to group by in order to display.",id:"database.boardView.missingSelectPropertyNoPermissions"}),style:{paddingLeft:r,paddingRight:i,paddingBottom:o?void 0:n}})}renderBoard(){const{store:e,format:t,isFullScreen:o,collectionContextStore:r}=this.props,i=this.columnsDisplayStateStore.state,{visibleGroups:n,hiddenGroups:s}=i,l=t.collection_group_by,a=this.anyVisibleGroupHasResultsStore.state,c=this.stores.subgroupsMountedStore.state;this.subgroupsOnChangeStore.state;const d=r.shouldShowSpinnerStore.state&&!c&&!a,u=r.isInHomeWidgetStore.state,p=o?480:u?220:360,h=u;return(0,C.jsx)(el,{collectionContextStore:this.props.collectionContextStore,groupsResultStore:this.stores.groupsResultStore,groupsReducerStore:this.groupsReducerStore,render:()=>(0,bn.Z)((c=>{return(0,C.jsx)(Si,{isFullScreen:o,renderEmitter:r.renderEmitter,children:(0,C.jsx)("div",{style:(S=this.props.paddingLeft,g=this.props.paddingRight,{marginLeft:S,marginRight:g,float:"left",minWidth:"100%"}),className:dt.EGJ,...c,children:(0,C.jsxs)(St.Z,{style:(m=this.props.paddingBottom,{display:"flex",position:"relative",flexGrow:1,paddingBottom:m}),store:e,shouldShowHalo:!o&&!u,canSelect:!o,onMouseDown:e=>function(e,t){const{device:o}=t,{target:r}=e;!o.isMobile&&r instanceof HTMLElement&&(0,ye.ZP)({event:e,context:ye.Af.EditorMouseDown,callback:()=>{e.preventDefault(),H.AI({environment:t,target:r,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,this.environment),analyticsName:"board",onMouseLeave:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave,children:[(!h||!d)&&this.renderHeader(i),d&&(0,C.jsx)(fs,{height:p,numBoardColumns:n.length,boardCoverSize:t.board_cover_size,areColumnsColored:!this.disableBoardColorColumnsStore.state,showGroupHeader:!h,isInHomeWidget:u}),n.length>0&&(0,C.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,C.jsx)("div",{style:{height:34+Qn(this.disableBoardColorColumnsStore.state,u),color:"red"}}),l?this.renderBoardColumnsForGroups(n,a):this.renderBoardColumnsForGroup(void 0,n,a)]}),zs(i,this.props.collectionContextStore)&&(0,C.jsx)("div",{style:{width:90,marginLeft:Un,marginRight:Un}}),Ks(i,this.props.format,this.props.collectionContextStore)&&(0,C.jsx)("div",{style:{width:35,marginLeft:Un,marginRight:Un}}),s.length>0&&this.renderHiddenGroups(s)]})})});var m,S,g}))})}renderHeader(e){const{format:t,isFullScreen:o,isRootChild:r,collectionContextStore:i}=this.props,{hiddenGroups:n,visibleGroups:s,currentGroups:l}=e;if(0===s.length&&0===n.length)return;const a=s.map((e=>(0,ee.mD)(e))),c=t.board_columns_by;if(!c)return;const d=(0,ee.mu)(c),u=i.permissionScopesStore.state,p="manual"===d.type&&u.canConfigureBlock,h=(0,Ge.qW)({device:this.environment.device,isFullScreen:o,isRootChild:r}),m=i.isInHomeWidgetStore.state;return(0,C.jsx)(Ur,{position:Fr(m),children:(0,C.jsxs)("div",{style:Qs(this.theme,this.props.collectionContextStore,this.props.isInPeekRenderer,this.disableBoardColorColumnsStore),children:[h&&(0,C.jsx)("div",{style:qs(this.props.isInPeekRenderer,this.theme,m)}),p?(0,C.jsx)(gs.ZP,{direction:"horizontal",keys:a,renderKey:(e,t)=>(0,C.jsx)($s,{schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,format:this.props.format,query:this.props.query,disabled:this.props.disabled,isFullScreen:this.props.isFullScreen,isInPeekRenderer:this.props.isInPeekRenderer,hoveredGroupStore:this.stores.hoveredGroupStore,groupFormat:s[t],currentGroups:l}),onDrop:e=>Js(e,!1,this.environment,this.props.collectionContextStore,this.columnsDisplayStateStore)}):a.map(((e,t)=>(0,C.jsx)($s,{schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,format:this.props.format,query:this.props.query,disabled:this.props.disabled,isFullScreen:this.props.isFullScreen,isInPeekRenderer:this.props.isInPeekRenderer,hoveredGroupStore:this.stores.hoveredGroupStore,groupFormat:s[t],currentGroups:l},(0,ee.mD)(s[t])))),zs(e,this.props.collectionContextStore)&&(0,C.jsx)(Gs,{collectionContextStore:this.props.collectionContextStore,schema:this.props.schema,displayState:e}),Ks(e,this.props.format,this.props.collectionContextStore)&&(0,C.jsx)(tl,{format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,store:this.props.store,columnsDisplayStateStore:this.columnsDisplayStateStore}),n.length>0&&(0,C.jsx)("div",{style:Us(this.props.isInPeekRenderer,this.theme,m),ref:this.hiddenGroupsHeaderRef,children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Hidden groups",id:"collection.boardView.hiddenGroups.label"})})]})})}renderHiddenGroups(e){const{device:t}=this.environment,{collectionContextStore:o}=this.props,r=this.canEdit()&&!t.isMobile&&!o.permissionScopesStore.state.isLocked&&o.permissionScopesStore.state.canEditContent,i=e.slice(0,Ge.ew),n=i.map((e=>(0,ee.mD)(e)));return(0,C.jsx)("div",{style:Ys(this.props.collectionContextStore,this.disableBoardColorColumnsStore),ref:this.hiddenGroupsContainerRef,children:i.length>0&&(r?(0,C.jsx)(gs.ZP,{direction:"vertical",keys:n,renderKey:(e,t)=>this.renderHiddenGroup(i[t]),onDrop:e=>Js(e,!0,this.environment,this.props.collectionContextStore,this.columnsDisplayStateStore)}):(0,C.jsx)("div",{children:i.map(this.renderHiddenGroup)}))})}renderBoardColumnsForGroups(e,t){const{store:o,collectionContextStore:r,disabled:i,isFullScreen:n,paddingLeft:s,isRootChild:l}=this.props;return(0,C.jsx)(fn,{reducerId:te.M9,store:o,collectionContextStore:r,disabled:i,isFullScreen:n,isRootChild:l,paddingLeft:s,stickyLeft:!this.environment.device.isMobile,renderGroup:o=>this.renderBoardColumnsForGroup(o,e,t),getGroupStyle:Ws,renderHeader:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderSubGroupHeader,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem})}renderBoardColumnsForGroup(e,t,o){return(0,C.jsx)("div",{style:gs.l8,children:t.map(((r,i)=>{const n=i===t.length-1;return this.renderGroupResults(e?[e,r]:[r],n,o)}))})}renderGroupResults(e,t,o){const{store:r,collectionContextStore:i,isFullScreen:n,query:s,schema:l,format:a,disabled:c,blockPropertyValueOverlayStore:d}=this.props,{hiddenGroups:u}=this.columnsDisplayStateStore.state,p=0!==u.length;if(!i.groupsStore.getGroupState(e))return;const h=i.permissionScopesStore.state,m=this.canEdit()&&("collectionTypedView"===i.contextType||h.canEditContent);return(0,C.jsx)(Yn,{store:r,hoveredGroupStore:this.stores.hoveredGroupStore,query:s,schema:l,format:a,groupsPointer:e,collectionContextStore:i,isFullScreen:n,isInPeekRenderer:this.props.isInPeekRenderer,disabled:c||!m,isLast:t&&!p,blockPropertyValueOverlayStore:d,anyGroupHasResults:o},(0,ee.KW)(e))}updateHiddenGroupsHeaderOffset(){var e;if("function"==typeof this.hiddenGroupsHeaderRef||null===(e=this.hiddenGroupsHeaderRef)||void 0===e||!e.current)return;const t=(this.getHiddenGroupsHeaderOffset()||0)+this.hiddenGroupsHeaderLastOffset;this.hiddenGroupsHeaderLastOffset=t,this.hiddenGroupsHeaderRef.current.style.left=`${t}px`}getHiddenGroupsHeaderOffset(){var e,t;if("function"==typeof this.hiddenGroupsHeaderRef||"function"==typeof this.hiddenGroupsContainerRef||null===(e=this.hiddenGroupsHeaderRef)||void 0===e||!e.current||null===(t=this.hiddenGroupsContainerRef)||void 0===t||!t.current)return;const o=this.hiddenGroupsHeaderRef.current.getBoundingClientRect().left;return this.hiddenGroupsContainerRef.current.getBoundingClientRect().left-o+8}}Ds.displayName="Board";const Zs=(0,P.injectIntl)(Ds);function Hs(e,t){return t.groupsStore.getGroupState([e])}function zs(e,t){const{visibleGroups:o,hiddenGroups:r,total:i}=e,n=0===o.length&&!t.shouldShowSpinnerStore.state||o.length>0,s=Ce({collectionContextStore:t,isForColumnGroups:!0}),l=t.boardColumnsLimitStore.state<i-r.length;return n&&l||s}function Ks(e,t,o){const{visibleGroups:r}=e,i=t.board_columns_by,n=o.permissionScopesStore.state,s=0===r.length&&!o.shouldShowSpinnerStore.state||r.length>0;return n.canConfigureBlock&&i&&(0,ee.Wz)(i,n.canConfigureCollection)&&!n.isSyncedCollection&&s}function Gs(e){let{displayState:t,collectionContextStore:o,schema:r}=e;const i=o.boardColumnsLimitStore;return(0,C.jsx)($i,{visibleGroups:t.visibleGroups,hiddenGroups:t.hiddenGroups,total:t.total,groupsLimitStore:i,type:"board",schema:r,collectionContextStore:o})}function Ws(e){return{marginTop:4,...e.isLast&&{paddingBottom:12}}}function Us(e,t,o){return{position:"relative",width:220,flexShrink:0,display:"flex",alignItems:"center",fontSize:14,color:t.lightTextColor,...o?{}:{background:e?t.cardContentBackground:t.contentBackground},marginLeft:20}}function qs(e,t,o){return{height:"calc(100% + 17px)",...o?{}:{background:e?t.cardContentBackground:t.contentBackground},width:20,marginLeft:-20,marginTop:-17}}function $s(e){let{groupFormat:t,currentGroups:o,schema:r,collectionContextStore:i,format:n,query:s,disabled:l,isFullScreen:a,isInPeekRenderer:c,hoveredGroupStore:d}=e;return(0,X.VK)((()=>Hs(t,i)),[i,t])&&n.board_columns_by?(0,C.jsx)(ji,{currentGroups:o,groupFormat:t,query:s,schema:r,format:n,groupBy:n.board_columns_by,collectionContextStore:i,hoveredGroupStore:d,disabled:l,hidden:!1,isPopup:!1,isInPeekRenderer:c,isFullScreen:a}):null}function Qs(e,t,o,r){var i;const n=t.isInHomeWidgetStore.state,s=n?"transparent":(null===(i=t.inheritedBlockColorStore.state)||void 0===i?void 0:i.background)||(o?e.cardContentBackground:e.contentBackground),l=Qn(r.state,n);return{position:"absolute",background:s,height:34+l,paddingTop:l,zIndex:M.LN,display:"flex",boxShadow:`-3px 0 0 ${s}`,minWidth:"100%"}}function Ys(e,t){const o=e.isInHomeWidgetStore.state;return{width:220,flexShrink:0,marginTop:34+Qn(t.state,o),marginLeft:12}}function Xs(e,t){return t.state.visibleGroups.length*(Ri(e)+2*Gn+2*Un)}function Js(e,t,o,r,i){const n=i.state.currentGroups,s=n.filter((t=>e.indexOf((0,ee.mD)(t))<0)),l=n.filter((t=>e.indexOf((0,ee.mD)(t))>=0)),a=R.MR(l,(t=>{const o=e.indexOf((0,ee.mD)(t));return o>=0?o:1/0})),c=t?[...s,...a]:[...a,...s];q.createAndCommit({userAction:"Board.handleGroupReorder",environment:o,perform:e=>{E.A6({collectionContextStore:r,newGroups:c,groupsFormatKey:"board_columns",transaction:e})}}),F.wd({environment:o,collectionContextStore:r,action:t?"board_reorder_hidden_groups":"board_reorder_groups"})}function el(e){let{render:t,collectionContextStore:o,groupsResultStore:r,groupsReducerStore:i}=e;const n=(0,X.VK)((()=>i.state),[i]);return n?(0,C.jsx)(bt.Z,{id:"board_columns",reducer:n,collectionContextStore:o,resultStore:r,render:t}):(0,C.jsx)(C.Fragment,{children:t()})}function tl(e){let{format:t,schema:o,collectionContextStore:r,store:i,columnsDisplayStateStore:n}=e;const s=(0,Y.O7)(),l=(0,X.VK)((()=>r.contextType),[r]),a=(0,X.VK)((()=>n.state.currentGroups),[n]);return t.board_columns_by?"collectionTypedView"===l?null:(0,C.jsx)(ps,{groupBy:t.board_columns_by,schema:o,currentGroups:a,onAccept:e=>function(e,t,o,r,i){const n=t.collectionStore();if(!n)return;const s=r.board_columns_by;s&&E.tH({update:e,collectionContextStore:t,groupsFormatKey:"board_columns",collectionStore:n,schema:o,groupBy:s,environment:i})}(e,r,o,t,s),groupsLimitStore:r.boardColumnsLimitStore,parentStore:i,type:"board",collectionContextStore:r}):null}function ol(e){let{args:t,format:o,columnsDisplayStateStore:r}=e;const i=(0,X.VK)((()=>Xs(o,r)),[o,r]);return(0,C.jsx)("div",{style:{display:"flex",minWidth:i},children:(0,C.jsx)(Ki,{...t})})}function rl(e){let{args:t,collectionContextStore:o,isInPeekRenderer:r,format:i,subgroupsMountedStore:n,columnsDisplayStateStore:s}=e;const l=(0,J.Fg)(),a=(0,X.VK)((()=>o.isInHomeWidgetStore.state),[o]),c=(0,X.VK)((()=>Xs(i,s)),[i,s]);return(0,C.jsx)(Yr,{...t,height:a?It.yZ:36,getComputedStickyStyle:e=>a?{}:function(e,t,o){return{background:t?o.cardContentBackground:o.contentBackground,boxShadow:e?`0 1px 0 ${t?o.cardContentBackground:o.contentBackground}`:void 0}}(e,r,l),style:{...t.style,minWidth:c},onMount:()=>n.setState(!0)})}var il=o(493911),nl=o(313991),sl=o(640506),ll=o(407057),al=o(253877),cl=o(2585),dl=o(605257),ul=o(997466),pl=o(671574),hl=o(86615),ml=o(828451),Sl=o(548779),gl=o(530874),fl=o(992083),Cl=o(584437),vl=o(235599),yl=o(481415);const xl=(0,P.defineMessages)({defaultTitle:{id:"openInNotionCalendarOnboardingTooltip.header",defaultMessage:"Get Notion Calendar"},defaultContent:{id:"openInNotionCalendarOnboardingTooltip.content",defaultMessage:"View any Notion database with calendar and timeline views with your Google Calendar events"},connectCalendarTitle:{id:"openInNotionCalendarOnboardingTooltip.connectCalendarTitle",defaultMessage:"Connect Calendar"},successTitle:{id:"openInNotionCalendarOnboardingTooltip.success.header",defaultMessage:"Successfully connected"},successContent:{id:"openInNotionCalendarOnboardingTooltip.success.content",defaultMessage:"You can now view any database with calendar and timeline views in Notion Calendar"}});function bl(e){let{variant:t,origin:o,onCloseClick:r,onConnectCalendarClick:i}=e;const n=(0,J.yK)((e=>({tooltip:{width:233},content:{opacity:1},contentInner:{display:"flex",flexDirection:"column",gap:14},contentMessage:{opacity:.8,color:e.regularInvertedTextColor},footer:{display:"flex",alignItems:"center",gap:12},primaryButton:{display:"flex",alignItems:"center",height:24,padding:"0 12px",marginLeft:"auto",borderRadius:4,background:"#FFF",color:"#1D1B16",fontSize:12,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},primaryButtonHover:{background:"rgba(255,255,255,0.9)"},primaryButtonPressed:{background:"rgba(255,255,255,0.8)"}})),[]);return(0,C.jsx)(yl.U,{origin:o,placementToOrigin:"bottom",header:(0,C.jsx)(P.FormattedMessage,{..."success"===t?xl.successTitle:xl.defaultTitle}),content:(0,C.jsxs)("div",{style:n.contentInner,children:[(0,C.jsx)("div",{style:n.contentMessage,children:(0,C.jsx)(P.FormattedMessage,{..."success"===t?xl.successContent:xl.defaultContent})}),"default"===t&&(0,C.jsx)("div",{style:n.footer,children:(0,C.jsx)(xe.Z,{style:n.primaryButton,hoveredStyle:n.primaryButtonHover,pressedStyle:n.primaryButtonPressed,onClick:i,children:(0,C.jsx)(P.FormattedMessage,{...xl.connectCalendarTitle})})})]}),contentStyle:n.content,onCloseClick:r,shouldDismissUponOutsideClick:!0,enableMouseCapture:!1,pointerPosition:"33%",style:{...n.tooltip}})}function wl(e){let{collectionContextStore:t}=e;const o=(0,i.useRef)(null),[r,n]=(0,i.useState)(!1),[s,l]=(0,i.useState)(!1),a=(0,Y.O7)(),c=(0,X.VK)((()=>uo.default.state.currentSpaceStore),[]),d=(0,X.VK)((()=>uo.default.state.currentUserSettingsStore),[]),u=(0,X.VK)((()=>(0,pl.tE)()),[]),p=(0,X.VK)((()=>t.isFullScreenStore.state),[t]),h=(0,X.VK)((()=>{var e;if(!c)return!1;if(!p)return!1;if((0,Sl.XY)({env:"production",spaceStore:c}))return!1;if(!d)return!1;if(!gl.Z.state.loaded)return!1;return!(fl.Z.state.open||t.settingsStore.state.open)&&(!!uo.default.state.inAppCalloutStore.getCalloutVisibility("open_in_calendar_tooltip").canShow&&(!Qe.default.state.open&&(!s&&(!(null!==(e=d.getSettings())&&void 0!==e&&e.seen_open_in_calendar_tooltip)||r))))}),[c,p,d,t.settingsStore,s,r]),m=(0,i.useCallback)((()=>{const e=t.collectionViewStore(),o=t.collectionStore(),r=null==o?void 0:o.getParentBlockStore();e&&o&&r&&c&&(hl.QK(a,{is_calendar_connected:u,collection_id:o.id,collection_view_id:e.id,collection_view_block_id:r.id}),Cl.sh({environment:a,collectionViewStore:e,spaceStore:c,from:"openInCalendarButton"}))}),[a,t,c,u]),S=(0,i.useCallback)((()=>{r?l(!0):d&&Cl.Bm({environment:a,userSettingsStore:d,transactionUserAction:"OpenInCalendarTooltip.dismiss"})}),[a,r,d]),g=(0,i.useCallback)((()=>{n(!0),d&&Cl.Bm({environment:a,userSettingsStore:d,transactionUserAction:"OpenInCalendarTooltip.connectCalendar"}),m(),requestAnimationFrame((()=>{l(!1)}))}),[a,d,m]),f=(0,J.yK)((e=>({button:{marginRight:8,paddingRight:12,fontSize:14,fontWeight:500,height:26},calendarIcon:{marginLeft:4},calendarIconSvg:{fill:e.timelineRed}})),[]);return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(hs.Z,{ref:o,style:f.button,iconStyle:f.calendarIconSvg,icon:e=>(0,C.jsx)(vl.Z,{style:{...e,...f.calendarIcon}}),onClick:m,children:(0,C.jsx)(P.FormattedMessage,{id:"openInNotionCalendarButton.label",defaultMessage:"Open in Calendar"})}),h&&(0,C.jsx)(ml.P,{calloutId:"open_in_calendar_tooltip",children:(0,C.jsx)(bl,{variant:r||u?"success":"default",origin:o,onCloseClick:S,onConnectCalendarClick:g})})]})}function kl(e){const t=(0,Y.O7)();return(0,X.VK)((()=>(0,pl.ZH)({environment:t,collectionContextType:e.collectionContextStore.contextType,spaceStore:uo.default.state.currentSpaceStore})),[t,e.collectionContextStore])?(0,C.jsx)(wl,{...e}):null}var Tl=o(95802),_l=o(415723),Vl=o(650628),Ol=o(766461),Ml=o(866),Pl=o(753876),Rl=o(706685),jl=o(566890),Il=o(840863),Fl=o(637034),Nl=o(99340),Bl=o(510084);function El(e,t){const{store:o,collectionContextStore:r,handleOpenPeekPage:n}=e,s=(0,Y.O7)(),l=(0,i.useRef)(null),a=(0,i.useCallback)((()=>{const e=function(e,t){const{mainEditorCurrentBlockStore:o}=uo.default.state;return ae.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})}(o,r);e&&(n(),zt.c4({environment:s,url:e}))}),[r,s,n,o]),c=(0,i.useMemo)((()=>({store:o,renderedType:"page",getNode:()=>l.current,getBlockStore:()=>o,activate:a})),[a,o]);(0,X.VK)((()=>{r.onItemMount(o)}),[r,o]);const d=(0,C.jsx)("div",{ref:l,children:(0,C.jsx)(Ll,{...e})});return(0,Nl.ez)(o,t,c,d)}const Al=i.forwardRef(El);function Ll(e){const{store:t,row:o,schema:r,format:i,disabled:n,calendarBy:s,showWeekends:l,collectionContextStore:a,includeTime:c,resultsStore:d,handleOpenPeekPage:u,blockPropertyValueOverlayStore:p,calendarStore:h}=e,m=(0,Y.O7)(),S=r[s],g=(0,X.VK)((()=>!n&&"date"===(null==S?void 0:S.type)&&!a.permissionScopesStore.state.isSyncedCollection),[a.permissionScopesStore,n,null==S?void 0:S.type]),{start:f,end:v,startOfWeek:y,endOfWeek:x,startColumn:b,columnCount:w}=(0,Il.du)({startUnixTimestampMS:e.start,endUnixTimestampMS:e.end,startOfWeekUnixTimestampMS:e.startOfWeek,endOfWeekUnixTimestampMS:e.endOfWeek}),k=(0,X.VK)((()=>{const e=i.calendar_properties?i.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[],o=e.filter((e=>(0,Lt.X)({block:t.getModel(),property:e,schema:r,getRecordModel:t.getRecordModel,userId:m.currentUser.id,userTimeZone:(0,He.r)(),intl:We.default.getIntl()})));return o.concat(R.e5(e,o))}),[m.currentUser.id,i.calendar_properties,r,t]),T=(0,X.VK)((()=>(0,rt.ls)({collectionContextStore:a})),[a]);if(!S||!ce.Lt(S))return null;const _=k.length+(T?1:0),V=f<y,O=void 0!==v&&v>x;return(0,C.jsxs)(Dl,{store:t,row:o,numRows:_,columnCount:w,startIsBeforeStartOfWeek:V,endIsAfterEndOfWeek:O,startColumn:b,disabled:n,isEditableDate:g,calendarBy:s,showWeekends:l,resultsStore:d,handleOpenPeekPage:u,children:[T&&(0,C.jsx)("span",{style:{paddingRight:4,paddingLeft:8,maxWidth:"100%",overflowX:"hidden",textOverflow:"ellipsis"},children:(0,C.jsx)(qt.O,{blockStore:t,collectionContextStore:a})}),(0,C.jsx)(Kl,{store:t,collectionContextStore:a,disabled:n,start:f,startOfWeek:y,end:v,endOfWeek:x,includeTime:c,propertySchema:S}),(0,C.jsx)(Wl,{store:t,sortedProperties:k,startIsBeforeStartOfWeek:V,disabled:n,blockPropertyValueOverlayStore:p}),g&&(0,C.jsx)(Ul,{store:t,start:f,startOfWeek:y,end:v,endOfWeek:x,calendarBy:s,calendarStore:h})]})}function Dl(e){const{store:t,children:o,columnCount:r,row:n,numRows:s,startColumn:l,disabled:a,isEditableDate:c,calendarBy:u,showWeekends:p,resultsStore:h,handleOpenPeekPage:m,startIsBeforeStartOfWeek:S,endIsAfterEndOfWeek:g}=e,f=(0,Y.O7)(),v=(0,jl.Y$)(),y=(0,X.VK)((()=>ae.Sc(t)),[t]),x=zl(s,(0,X.VK)((()=>{var e;return null===(e=v.collectionViewStore())||void 0===e?void 0:e.getFormat()}),[v])),b=oa+x*n,w=(0,X.qz)(void 0,Bl.Z),k=(0,X.VK)((()=>po.Z.state?!0===w.state.dragging:nt.Z.state.hoveredStore===t),[t,w]),T=p?7:5,_=(0,J.yK)((e=>({selectable:{position:"absolute",paddingTop:3,paddingBottom:3,paddingLeft:S?0:6,paddingRight:g?0:6,width:g?`calc(100% / ${T} * ${r} - 1px)`:`calc(100% / ${T} * ${r})`,left:`calc(100% / ${T} * ${l})`,height:x,top:b},haloStyle:{...ae.pB(y,e),borderRadius:5,marginTop:2,marginBottom:2,marginLeft:S?0:5,marginRight:g?0:5},linkBoxStyle:{height:"100%",background:e.calendarItemBackground,borderTopLeftRadius:4,borderTopRightRadius:4,borderBottomLeftRadius:4,borderBottomRightRadius:4,boxShadow:e.lightBoxShadow,...g&&{borderTopRightRadius:0,borderBottomRightRadius:0},...S&&{borderTopLeftRadius:0,borderBottomLeftRadius:0}},linkBoxHoveredStyle:{opacity:1,background:e.calendarItemHoveredBackground},linkBoxInnerStyle:{display:"flex",position:"relative",paddingTop:2,paddingBottom:2,height:"100%",alignItems:"flex-start",flexDirection:"column"}})),[r,g,x,T,y,l,S,b]),V=(0,i.useCallback)((e=>{const o=t.getAssociatedCollectionStore();return o?il.QG({environment:f,collectionStore:o,collectionContextStore:v,store:t,insertStores:e.insertStores,calendarBy:u,transaction:e.transaction,results:h.state}):[]}),[u,v,f,h,t]),O=(0,i.useCallback)((e=>{const{transaction:o}=e;t.getAssociatedCollectionStore()&&E.Od({store:t,transaction:o})}),[t]),[M,P]=(0,X.VK)((()=>{const{mainEditorCurrentBlockStore:e}=uo.default.state,o=ae.mb({store:t,mainEditorCurrentBlockStore:e,collectionContextStore:v,fullyQualified:!1});return[(0,lo.ZP)({store:t,fullyQualified:!1,pageVisitSource:d.tY.LinkInPage}),o]}),[v,t]),R=(0,X.VK)((()=>v.isInHomeWidgetStore.state),[v]);return(0,C.jsx)(St.Z,{store:t,style:_.selectable,canSelect:!a,shouldShowHalo:!R,shouldForceRenderSelectionHalo:y,haloStyle:_.haloStyle,canTriggerContextMenu:!a,showBlockMenuInput:!0,canDrag:c,onInsertAbove:V,onInsertBelow:V,onRemove:O,canInsertAbove:c,canInsertBelow:c,analyticsName:"calendar",shouldShowDropZone:!0,className:dt.K4T,draggableStore:w,children:(0,C.jsx)(Yt.Z,{style:_.linkBoxStyle,hoveredStyle:_.linkBoxHoveredStyle,pressedStyle:_.linkBoxHoveredStyle,innerStyle:_.linkBoxInnerStyle,onClick:m,href:M,metaHref:P,hovered:k,children:o})},t.id)}const Zl=24,Hl=36;function zl(e,t){var o;return((null==t?void 0:t.table_wrap)||!0===(null==t||null===(o=t.calendar_properties)||void 0===o||null===(o=o.find((e=>"title"===e.property)))||void 0===o?void 0:o.wrap)?Hl:Zl)+e*Pl.ch+2*ra+2*ia}function Kl(e){const{store:t,collectionContextStore:o,disabled:n,start:s,startOfWeek:l,end:a,endOfWeek:c,includeTime:d,propertySchema:u}=e,p=(0,Y.O7)(),h=(0,P.useIntl)(),m=s<l,S=a&&a>c,g=(0,X.VK)((()=>(0,rt.wI)({collectionContextStore:o,blockStore:t})),[o,t]),f="time_format"in u?u.time_format:sl.c_,[v,y,x]=(0,X.VK)((()=>[t.getIcon(),t.isEmptyPage(),t.hasError()]),[t]),b=(0,i.useCallback)((e=>{const o=t.getIconStore();o&&q.createAndCommit({userAction:"CalendarItem.handleRecordIconChange",environment:p,perform:t=>{ie.sO({store:o,value:e,transaction:t})}})}),[p,t]),w=(0,X.VK)((()=>{var e,t,r;const i=null===(e=o.collectionViewStore())||void 0===e?void 0:e.getFormat().calendar_properties;return(null===(t=o.collectionViewStore())||void 0===t?void 0:t.getFormat().table_wrap)||!0===(null==i||null===(r=i.find((e=>"title"===e.property)))||void 0===r?void 0:r.wrap)}),[o]),k=(0,J.yK)((e=>({titleContainer:{paddingLeft:6,paddingRight:6,overflow:"hidden",...m&&{paddingLeft:12},...S&&{paddingRight:11},width:"100%",...w?{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"17px",height:Hl,paddingTop:2}:{height:Zl,whiteSpace:"nowrap"},overflowWrap:"break-word",textOverflow:"ellipsis",fontSize:14,fontWeight:j.Z.fontWeight.semibold},recordIconStyle:{display:"inline",float:"left",marginRight:3,paddingTop:w?2:4},iconWarningStyle:{display:"inline",float:"left",marginLeft:1,marginRight:5,width:10,height:16,paddingTop:w?2:4,fill:e.accentColors.orange[500]},subitemCountIndicatorContainer:{display:"flex",alignItems:"center",float:"right",paddingTop:w?2:4},timeStyle:{color:e.mediumTextColor,float:"right",fontSize:10,marginLeft:4,height:14,paddingTop:w?2:4},subitemsWrapperStyle:{paddingRight:0,paddingLeft:4}})),[S,m,w]),T=d&&a&&r.Xp.fromDateTimes(l,c).contains(a)&&s.day!==a.day,_=(0,X.VK)((()=>o.shouldShowPageIcon()&&(void 0!==v||!y)&&!x),[o,v,y,x]),V=(0,X.VK)((()=>{const e=(0,Fl.V)(t,h,p,!1);return e||(0,Fl.NO)(t,h)}),[p,t,h]);return(0,C.jsxs)("div",{style:k.titleContainer,children:[_&&(n?(0,C.jsx)(Xt.Z,{disabled:!0,icon:v,isEmptyPage:y,size:14,style:k.recordIconStyle}):(0,C.jsx)(Xt.Z,{disabled:!1,store:t,bucket:"secure",icon:v,isEmptyPage:y,size:14,style:k.recordIconStyle,onChange:b})),x&&(0,Zt.t)(k.iconWarningStyle),(0,C.jsx)(Gl,{store:t,titlePropertyIsWrapped:w}),g&&(0,C.jsx)("div",{style:k.subitemCountIndicatorContainer,children:(0,C.jsx)($t.B,{blockStore:t,collectionContextStore:o,wrapperStyle:k.subitemsWrapperStyle})}),d&&r.Xp.fromDateTimes(l,c).contains(s)&&(0,C.jsxs)("div",{style:k.timeStyle,children:[(0,ll.xE)({dateTime:s,humanReadable:!1,timeFormat:f}),T&&(0,C.jsxs)("span",{children:[" → ",(0,ll.xE)({dateTime:a,humanReadable:!1,timeFormat:f})]})]}),V]})}function Gl(e){const{store:t,titlePropertyIsWrapped:o}=e,r=(0,J.yK)((e=>({discussionIndicatorStyle:{display:"flex",alignItems:"center",color:e.lightTextColor,fontSize:12,flexShrink:0},discussionIndicatorContainerStyle:{float:"right",marginLeft:4,marginTop:o?-2:1}})),[o]);return(0,C.jsx)(Wt.s,{store:t,iconStyle:r.discussionIndicatorStyle,buttonStyle:r.discussionIndicatorContainerStyle,size:12})}function Wl(e){const{store:t,sortedProperties:o,startIsBeforeStartOfWeek:r,disabled:i,blockPropertyValueOverlayStore:n}=e,s=(0,jl.Y$)(),l=(0,X.VK)((()=>s.permissionScopesStore.state.isLocked||!s.permissionScopesStore.state.canEditContent),[s.permissionScopesStore]),[a,c]=(0,X.VK)((()=>[ae.Bm({store:t,collectionContextStore:s}),s.collectionViewStore()]),[t,s]);return a?(0,C.jsx)("div",{style:{paddingLeft:6,paddingRight:6,overflow:"hidden",width:"100%",...r&&{paddingLeft:12}},children:o.map((e=>(0,C.jsx)(Gt.Z,{store:t,property:e,disabled:i,locked:l,format:mt.C.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:n,collectionStore:a,collectionViewStore:c},e)))}):null}function Ul(e){const{store:t,calendarStore:o,start:r,startOfWeek:n,end:s,endOfWeek:l,calendarBy:a}=e,c=(0,Y.O7)(),d=(0,J.yK)((()=>({leftDragHandle:{position:"absolute",top:0,left:-4,height:"100%",width:12,cursor:"col-resize"},rightDragHandle:{position:"absolute",top:0,right:-4,height:"100%",width:12,cursor:"col-resize"}})),[]),u=(0,i.useCallback)((e=>{il.td({calendarStore:o,x:e.currentX,y:e.currentY,calendarBy:a})}),[o,a]),p=(0,i.useCallback)((()=>{q.createAndCommit({userAction:"CalendarItem.handleDraggableDragEnd",environment:c,perform:e=>{il.fX({environment:c,transaction:e,calendarStore:o,calendarBy:a})}})}),[a,o,c]),h=(0,i.useCallback)((()=>{il.cQ({calendarStore:o})}),[o]),m=r>=n&&(0,C.jsx)(Rl.Z,{render:e=>(0,C.jsx)("div",{style:d.leftDragHandle,...e}),onDraggableDragStart:()=>{il.f$({calendarStore:o,targetStore:t,direction:Ml.t.Left})},onDraggableDragMove:u,onDraggableDragEnd:p,onDraggableDragCancel:h}),S=(!s||s&&s<l)&&(0,C.jsx)(Rl.Z,{render:e=>(0,C.jsx)("div",{style:d.rightDragHandle,...e}),onDraggableDragStart:e=>{il.f$({calendarStore:o,targetStore:t,direction:Ml.t.Right})},onDraggableDragMove:u,onDraggableDragEnd:p,onDraggableDragCancel:h});return(0,C.jsxs)(C.Fragment,{children:[m,S]})}const ql={height:28,width:28,lineHeight:"28px",borderRadius:"100%",textAlign:"center",color:rr.ZP.white,background:rr.ZP.red,marginLeft:"auto",marginRight:"auto"},$l={height:28,display:"flex",alignItems:"center",justifyContent:"center"},Ql={width:"100%",height:44,borderRadius:4},Yl={position:"absolute",fontSize:14,top:4,right:10,height:24,lineHeight:"24px",textAlign:"right",transition:"color 100ms ease-out"},Xl={position:"relative",display:"flex"},Jl={},ea={height:74},ta={height:66},oa=30,ra=2,ia=3;class na extends io.Z{constructor(){super(...arguments),this.headerEl=void 0,this.root=void 0,this.verticalScrollableAncestor=void 0,this.storeTypes={calendarStore:Ml.Z,resultStore:c.default.createClass(void 0,{name:"resultStore"})},this.handleHeaderMount=e=>{this.headerEl=e},this.handleScroll=()=>{if(!this.headerEl)return;if(!ca(this.props.collectionContextStore,this.props.isFullScreen,this.environment))return;const{calendarStore:e}=this.stores,t=e.state,o=this.headerEl.getBoundingClientRect();let r=[];t.dayStoreMap.forEach(((e,t)=>{r.push({store:e,timestamp:t})})),r=R.MR(r,(e=>{let{timestamp:t}=e;return t}));const i=r.find((e=>{let{store:t}=e;const r=Tl.C.getRectFromStore(t);return Boolean(r&&r.top<=o.top+o.height&&r.top+r.height>=o.top+o.height)}));if(i){const o=(0,al.kl)((0,al.Xz)({date:(0,al.V7)(i.timestamp,ge.AK.state),daysToAdd:1}));o!==t.startingMonth&&e.setState({...e.state,startingMonth:o})}},this.handleScrollThrottled=R.P2(this.handleScroll,100),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove=e=>function(e,t){const o=t.state;if(!o.isDragging&&!po.Z.state){const r=function(e,t,o){G.Ch();const{dayStoreMap:r}=o.state,{selectableRectMap:i}=Vl.Z.state,n=Array.from(r.keys()),s=Array.from(r.values());for(const[l,a]of i.entries())if(a&&_l.uh(a,e,t)&&s.indexOf(l.props.store)>=0)return n.find((e=>r.get(e)===l.props.store))}(e.clientX,e.clientY,t);o.hoveredDay!==r&&t.setState({...o,hoveredDay:r})}}(e,this.stores.calendarStore),this.handleMouseMoveThrottled=R.P2(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove,50),this.handleTodayClick=()=>{const e=la(this.props.collectionContextStore),t="month"===e?(0,al.IS)((0,al.kl)(Date.now()),ge.AK.state):(0,al.IS)(Date.now(),ge.AK.state);this.setNewCalendarStart(t,e)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleOpenPeekPage=()=>function(e,t,o){qe.default.mark("collections.open_item_page_lag"),Z.Xd({collectionContextStore:t,resultsStore:o});const r=t.normalizedFormatStore.state.collection_peek_mode,i=r||ut.Ls.calendar;at.hy(e,{is_peek:!0,from:"calendar",peek_mode:i})}(this.environment,this.props.collectionContextStore,this.sortedResultsStore),this.startOfWeekSettingStore=this.createComputedStore((()=>{const{currentUserSettingsStore:e}=uo.default.state;if(!e)return 0;const t=e.getSettings();return null!=t&&t.start_day_of_week?t.start_day_of_week:0}),{useDeepEqual:!0}),this.reducerStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,Ol.Ft)({collectionContextStore:e})}),{useDeepEqual:!0}),this.resultsStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();if(!t)return[];const o=this.stores.resultStore.state;return o?o.blockIds.map((e=>Ye.G.createChildStore(t,{id:e,table:_.iU}))):[]}),{useDeepEqual:!0}),this.weeksStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=We.default.getIntl();return(0,Ol.y$)({collectionContextStore:e,results:this.resultsStore.state,getRecordValue:this.getRecordValue,intl:t})}),{useDeepEqual:!0}),this.sortedResultsStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t}=this.props,o=t.collectionViewStore();return o&&(null===(e=this.weeksStore.state)||void 0===e?void 0:e.flatMap((e=>e.items.map((e=>Ye.G.createChildStore(o,{table:_.iU,id:e.id}))))))||[]}),{useDeepEqual:!0}),this.isTypedMSVCollectionStore=this.createComputedStore((()=>"collectionTypedView"===this.props.collectionContextStore.contextType)),this.getRecordValue=this.props.store.getRecordValue}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const{collectionContextStore:t}=e;this.handleMount(t),ge.AK.addListener((()=>{this.handleMount(this.props.collectionContextStore)}))}UNSAFE_willMountOrUpdate(e){super.UNSAFE_willMountOrUpdate(e),po.Z.state&&(this.stores.calendarStore.state.isDragging||this.stores.calendarStore.setState({...this.stores.calendarStore.state,hoveredDay:void 0}));const{query:t}=e;t.calendar_by||function(e,t,o){const{schema:r}=e,i=t.permissionScopesStore.state,n=We.default.getIntl(),s=t.collectionStore();if(!s)return;const l=t.collectionViewStore();if(!l||!i.canConfigureBlock)return;q.createAndCommit({userAction:"Calendar.updateOrCreateCalendarProperty",environment:o,perform:e=>{let t,a=ae.PD(r);if(!a&&i.canConfigureCollection){a=(0,oe.ZP)();t={[a]:{name:n.formatMessage({id:"database.calendarView.dateProperty.defaultName",defaultMessage:"Date"}),type:"date"}}}le.Es({collectionViewStore:l,update:{calendar_by:a},transaction:e}),ie.sW({store:l,data:{type:"calendar"},transaction:e}),t&&le.xO({environment:o,collectionStore:s,update:t,transaction:e})}})}(e,this.props.collectionContextStore,this.environment)}didMountOrUpdate(){this.handleScrollThrottled(),this.root||(this.root=n.findDOMNode(this),this.root&&(this.verticalScrollableAncestor=(0,Xo.VW)(this.root),this.verticalScrollableAncestor&&ui.lj(this.verticalScrollableAncestor,"scroll",this.handleScrollThrottled),ui.lj(this.root,"mousemove",this.handleMouseMoveThrottled)))}willUnmount(){super.willUnmount(),this.verticalScrollableAncestor&&ui.ZV(this.verticalScrollableAncestor,"scroll",this.handleScrollThrottled),this.root&&ui.ZV(this.root,"mousemove",this.handleMouseMoveThrottled)}renderPersisted(){const{device:e}=this.environment,{store:t,paddingBottom:o,paddingLeft:r,paddingRight:i,query:n,schema:s,collectionContextStore:l,isFullScreen:a}=this.props,{calendar_by:c}=n;if(!c)return(0,C.jsx)(aa,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom,paddingLeft:this.props.paddingLeft,paddingRight:this.props.paddingRight});const d=s[c];if(!d||!ce.Lt(d))return(0,C.jsx)(aa,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom,paddingLeft:this.props.paddingLeft,paddingRight:this.props.paddingRight});const u=this.reducerStore.state;if(!u)return;const p=la(l),h=l.isInHomeWidgetStore.state;return(0,bn.Z)((n=>(0,C.jsx)(bt.Z,{id:"calendar_results",resultStore:this.stores.resultStore,collectionContextStore:l,reducer:u,render:()=>(0,C.jsx)(Si,{isFullScreen:a,children:(0,C.jsx)(Rt.Z,{onChange:e=>function(e,t,o,r){const i=t.isLoadingStore.state,n=ca(t,o,r);if(e<Ft.Z.incrementScrollOffset&&!i&&n){const e=t.dateRangeStartStore.state,o=t.dateRangeEndStore.state,r=(0,al.V7)((0,al._)({date:o,monthsToAdd:2}),ge.AK.state);le.t5({dateRangeStart:e,dateRangeEnd:r,collectionContextStore:t})}}(e,this.props.collectionContextStore,this.props.isFullScreen,this.environment),style:h?{height:"100%",maxHeight:"inherit"}:{},children:(0,C.jsx)("div",{style:{paddingBottom:o,paddingLeft:r,paddingRight:i,minWidth:this.props.minWidth,...h?{height:"100%",maxHeight:"inherit"}:{}},className:dt.c7X,children:(0,C.jsxs)(St.Z,{style:{position:"relative",paddingLeft:1,...h?{height:"100%",maxHeight:"inherit"}:{}},store:t,shouldShowHalo:!a&&!h,canSelect:!a,onMouseDown:e=>function(e,t,o){const{device:r}=o,{target:i}=e;!r.isPhone&&i instanceof HTMLElement&&(0,ye.ZP)({event:e,context:ye.Af.EditorMouseDown,callback:()=>{e.preventDefault(),H.AI({environment:o,target:i,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[t],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1})}})}(e,this.props.store,this.environment),analyticsName:"calendar",...n,children:[this.renderHeader(ma(this.environment,this.props.collectionContextStore,this.props.isFullScreen,this.stores.calendarStore),p),h?(0,C.jsx)(Nr,{style:{height:"calc(100% - 66px)",maxHeight:this.props.maxHeight?this.props.maxHeight-(e.isPhone?74:66):"inherit",paddingBottom:16,maskImage:"none",WebkitMaskImage:"none"},isInHomeWidget:h,children:this.renderCalendarBody()}):(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{style:e.isPhone?ea:ta}),this.renderCalendarBody()]})]})})})})})))}renderHeader(e,t){var o;const{device:r}=this.environment,{collectionContextStore:i}=this.props,n=We.default.getIntl(),s=i.isInHomeWidgetStore.state,l=(null===(o=i.collectionViewStore())||void 0===o?void 0:o.getFormat().calendar_show_weekends)??!0?(0,ll.kv)(ge.AK.state,nl.SP):(0,ll.vI)(nl.SP);return(0,C.jsx)(Ur,{position:Fr(s),children:(0,C.jsxs)("div",{style:r.isPhone?ua(this.props.collectionContextStore,this.theme):da({collectionContextStore:this.props.collectionContextStore,isInPeekRenderer:this.props.isInPeekRenderer,theme:this.theme}),ref:this.handleHeaderMount,children:[(0,C.jsxs)("div",{style:{display:"flex",height:42,alignItems:"center",marginBottom:2},children:[(0,C.jsx)("div",{style:{fontWeight:j.Z.fontWeight.semibold,marginLeft:8,marginRight:8,lineHeight:1,fontSize:r.isPhone?16:14},children:Sa(t,e,nl.SP,this.weeksStore)}),(0,C.jsx)("div",{style:{flexGrow:1}}),(0,C.jsx)(kl,{collectionContextStore:i}),(0,C.jsx)(_e.Z,{ariaLabel:n.formatMessage({id:"database.calendarView.previousMonthButton.label",defaultMessage:"Previous Month"}),mobileFeedback:r.isMobile,icon:cl.f,onClick:()=>this.handleCalendarClick("left",i)}),(0,C.jsx)(Et.Z,{isSmall:!0,onClick:this.handleTodayClick,children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Today",id:"database.calendarView.todayButton.label"})}),(0,C.jsx)(_e.Z,{ariaLabel:n.formatMessage({id:"database.calendarView.nextMonthButton.label",defaultMessage:"Next Month"}),mobileFeedback:r.isMobile,icon:dl.o,onClick:()=>this.handleCalendarClick("right",i)})]}),(0,C.jsx)("div",{style:{display:"flex",marginTop:r.isPhone?8:0,boxShadow:`0 1px 0 ${this.theme.tableDividerColor}`},className:dt.GNl,children:l.map((e=>{let[t,o]=e;return(0,C.jsx)("div",{style:(r=this.theme,{flexGrow:1,flexBasis:0,textAlign:"center",fontSize:12,height:24,color:r.lightTextColor}),children:o},t);var r}))})]})})}renderCalendarBody(){var e,t,o;const{device:r}=this.environment,{query:i,schema:n,collectionContextStore:s}=this.props,{calendar_by:l}=i;if(!l)return null;const a=n[l];if(!a)return null;const c=(void 0===(null===(e=this.stores.resultStore.getState())||void 0===e?void 0:e.blockIds)||0===(null===(t=this.stores.resultStore.getState())||void 0===t?void 0:t.blockIds.length))&&fe({collectionContextStore:s,groupsPointer:[],hasPartialResults:!1}),d=la(s),u=this.weeksStore.state,p=(null===(o=s.collectionViewStore())||void 0===o?void 0:o.getFormat().calendar_show_weekends)??!0;return(0,C.jsx)("div",{style:r.isPhone?Jl:(h=this.theme,{boxShadow:`-1px 0 0 ${h.tableDividerColor}`,marginTop:1,overflow:"hidden"}),children:u&&u.map((e=>r.isPhone?this.renderMobileWeek(e.start,e.items,l,p,d,c):this.renderWeek(e.start,e.end,e.items,l,p,a,d,c)))});var h}renderWeek(e,t,o,r,i,n,s,l){const{collectionContextStore:a,format:c,schema:d,blockPropertyValueOverlayStore:u}=this.props,p=a.collectionViewStore();if(!p)return;const{calendarStore:h}=this.stores,m=h.state,S=[...Array(i?7:5).keys()].map((t=>this.renderDay(t,(0,al.Xz)({date:e,daysToAdd:t}),r,n,s,l))),g=[];let f=0;for(const k of o){const o=Ye.G.createChildStore(p,{table:_.iU,id:k.id});if(!m.isDragging||m.targetStore!==o||!m.temporaryValue){const n=o.getAssociatedCollectionStore();g.push((0,C.jsx)(Al,{collectionContextStore:a,store:o,startOfWeek:e,endOfWeek:t,showWeekends:i,start:k.start,end:k.end,row:k.row,includeTime:k.includeTime,format:c,schema:(null==n?void 0:n.getSchema())??d,calendarBy:(null==n?void 0:n.getMappedProperty(r))??r,disabled:!o.canEdit(),calendarStore:h,blockPropertyValueOverlayStore:u,resultsStore:this.resultsStore,handleOpenPeekPage:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleOpenPeekPage},o.id))}k.row>f&&(f=k.row)}const v=m.isDragging&&m.temporaryValue&&(0,al.Y_)(m.temporaryValue,(0,He.r)());if(m.isDragging&&m.temporaryValue&&v&&(0,sl.b8)(e,t,v.start,v.end)){const{targetStore:n,temporaryValue:s}=m,l=o.find((e=>e.id===n.id)),p=n.getAssociatedCollectionStore();g.push((0,C.jsx)(Al,{collectionContextStore:a,store:n,startOfWeek:e,endOfWeek:t,start:v.start,end:v.end,row:l?l.row:0,includeTime:"datetime"===s.type||"datetimerange"===s.type,format:c,schema:(null==p?void 0:p.getSchema())??d,calendarBy:(null==p?void 0:p.getMappedProperty(r))??r,showWeekends:i,disabled:!n.canEdit(),calendarStore:h,blockPropertyValueOverlayStore:u,resultsStore:this.resultsStore,handleOpenPeekPage:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleOpenPeekPage},n.id))}const y=(c.calendar_properties?c.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[]).length+((0,rt.ls)({collectionContextStore:a})?1:0),x="week"===s?372:124,b=zl(y,c),w=Math.max((f+1)*b+oa+4,x);return(0,C.jsxs)("div",{style:{...Xl,height:w},children:[S,g]},e.toString())}renderDay(e,t,o,r,i,n){const{store:s,collectionContextStore:l}=this.props,{calendarStore:a}=this.stores,{dayStoreMap:c}=a.state,d=We.default.getIntl(),u=a.state,p="date"===r.type,h=l.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}),m=l.isInHomeWidgetStore.state;let S=c.get(t);S||(S=new Ye.G(this.environment,s.pointer,{userId:s.userId,inMemoryRecordCache:s.inMemoryRecordCache}),c.set(t,S));const g=!u.isDragging&&u.hoveredDay===t,f=(0,al.Bn)({firstDate:t,secondDate:ma(this.environment,this.props.collectionContextStore,this.props.isFullScreen,this.stores.calendarStore)}),v=(0,al.Y3)(t),y=(0,al.LY)(t),x=!f&&!v&&"week"!==i,b=d.formatMessage({defaultMessage:"Add an item",id:"database.calendarView.addItemButtonTooltip"});return(0,C.jsxs)(St.Z,{style:y?ha({isInPeekRenderer:this.props.isInPeekRenderer,isInHomeWidget:m,theme:this.theme}):pa(this.theme),store:S,canDropOnto:this.canEditCalendar()&&p,onSelectableDrop:e=>{q.createAndCommit({userAction:"Calendar.renderDay",environment:this.environment,perform:r=>{const i=l.collectionStore();if(!i&&"collectionTypedView"!==l.contextType)return;const n=qe.default.mark("collections.drop_item_lag");qe.default.measureAfterNextFlush(n,{environment:this.environment,getData:()=>Ke.yr({collectionContextStore:l,is_native_drop:!1,is_empty:!1})}),il.JN({...e,environment:this.environment,startOfDay:t,calendarBy:o,collectionStore:i,collectionContextStore:l,results:this.resultsStore.state,transaction:r})}})},onDoubleClick:()=>{if(this.canEditCalendar()&&Nt.M_(this.environment)&&h){const e=ga(t,o,this.environment,this.props.collectionContextStore,this.isTypedMSVCollectionStore,this.context.overrideLinkClick);lt.W(this.environment,{type:"page",from:"calendar_day_double_click",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,Ke.Pn)(l)})}},analyticsName:"calendar_day",shouldShowDropZone:!0,children:[g&&(p||v)&&h&&this.canEditCalendar()&&(0,C.jsx)(Jt.Z,{renderTooltip:()=>b,render:e=>(0,C.jsx)(_e.Z,{ariaLabel:b,icon:de.R,showShadow:!0,hasBackground:!0,style:{position:"absolute",top:6,left:6,width:20,height:20},onClick:()=>{if(Nt.M_(this.environment)){const e=ga(t,o,this.environment,this.props.collectionContextStore,this.isTypedMSVCollectionStore,this.context.overrideLinkClick);lt.W(this.environment,{type:"page",from:"calendar_day_add_button",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,Ke.Pn)(l)})}},...(0,hr.Z)(e,{onMouseDown:ye.$0})})}),(0,C.jsx)("div",{style:{...v?(w=this.theme,{position:"absolute",fontSize:14,top:4,right:4,height:24,width:24,lineHeight:"24px",borderRadius:"100%",textAlign:"center",color:rr.ZP.white,background:w.calendarTodayBackground}):Yl,...x&&{color:this.theme.lightTextColor}},className:n?`${dt.irE} notion-shimmer-text animation-delay-${e} notion-shimmer-calendar-transition`:`${dt.irE} notion-shimmer-calendar-transition`,children:1!==(0,al.TE)(t)||v?(0,al.TE)(t):`${new Intl.DateTimeFormat(d.locale,{month:"short",day:"numeric"}).format(new Date(t))} `})]},t.toString());var w}renderMobileWeek(e,t,o,r,i,n){const s=[...Array(r?7:5).keys()].map((r=>{const s=(0,al.Xz)({date:e,daysToAdd:r});return this.renderMobileDay(r,s,(0,al.us)(s),t,o,i,n)}));return(0,C.jsx)("div",{style:(l=this.theme,{display:"flex",boxShadow:`0 -1px 0 ${l.tableDividerColor}`,paddingTop:8,paddingBottom:8,fontSize:14}),children:s},e.toString());var l}renderMobileDay(e,t,o,r,i,n,s){const{collectionContextStore:l,query:a,format:c,schema:d,blockPropertyValueOverlayStore:u}=this.props,p=this.canEditCalendar(),h=r.find((e=>(0,sl.b8)(t,o,e.start,e.end?e.end:void 0))),m=(0,al.TE)(t),S=(0,al.Bn)({firstDate:t,secondDate:ma(this.environment,this.props.collectionContextStore,this.props.isFullScreen,this.stores.calendarStore)}),g=(0,al.Y3)(t),f=!S&&!g&&"week"!==n;return(0,C.jsx)(Te.ZP,{popupType:Te.Z4.SlideUp,renderOrigin:t=>{return(0,C.jsxs)(xe.Z,{style:Ql,...t,children:[(0,C.jsx)("div",{style:{...g?ql:$l,...f&&{color:this.theme.lightTextColor}},className:s?`notion-shimmer-calendar-transition notion-shimmer-text animation-delay-${e}`:"notion-shimmer-calendar-transition",children:m}),h&&(0,C.jsx)("div",{style:(o=this.theme,{width:8,height:8,background:o.mediumIconColor,borderRadius:"100%",marginTop:2,marginLeft:"auto",marginRight:"auto"})})]});var o},render:e=>(0,C.jsx)(ro.bJ,{collectionContextStore:l,initialStartOfDay:t,format:c,schema:d,query:a,calendarBy:i,disabled:!p,onDismiss:e.close,blockPropertyValueOverlayStore:u,resultsStore:this.resultsStore})},m.toString())}handleCalendarClick(e,t){const o=(0,al.V7)(t.dateRangeStartStore.state,ge.AK.state),r=la(this.props.collectionContextStore);if("month"===r){const t="left"===e?-1:1,i=(0,al.IS)((0,al.kl)((0,al._)({date:o,monthsToAdd:t})),ge.AK.state);this.setNewCalendarStart(i,r)}else{const o="left"===e?-7:7,i=(0,al.IS)((0,al.Xz)({date:t.dateRangeStartStore.state,daysToAdd:o}),ge.AK.state);this.setNewCalendarStart(i,r)}}handleMount(e){const t=e.collectionViewStore();if(!t)return;const o=this.startOfWeekSettingStore.state,r=la(e),i=Ml.Z.getLocalDateRangeStart({collectionViewId:t.id,currentUserId:this.environment.currentUser.id}),n=(0,al.IS)(i,o),s=(0,al.IS)((0,al.kl)(i),o),l="month"===r?s:n;this.stores.calendarStore.setState({...this.stores.calendarStore.state,startingMonth:s.valueOf()}),this.setNewCalendarStart(l,r)}setNewCalendarStart(e,t){const{collectionContextStore:o}=this.props,r=o.collectionViewStore();if(!r)return;const i=ca(this.props.collectionContextStore,this.props.isFullScreen,this.environment),n=ge.AK.state,s=(0,al.V7)(e,n);let l;"month"===t?(l=i?(0,al.V7)((0,al._)({date:s,monthsToAdd:1}),n):(0,al.V7)((0,al.RN)(s),n),this.verticalScrollableAncestor&&i&&(this.verticalScrollableAncestor.scrollTop=0)):l=s,function(e,t,o,r){le.t5({dateRangeStart:e,dateRangeEnd:t,collectionContextStore:o}),r.setState({...r.state,startingMonth:(0,al.kl)((0,al.V7)(e,ge.AK.state))})}(e,l,this.props.collectionContextStore,this.stores.calendarStore),(0,sl.nQ)(e,l,Date.now())?Ml.Z.clearLocalDateRangeStart({collectionViewId:r.id,currentUserId:this.environment.currentUser.id}):Ml.Z.setLocalDateRangeStart({collectionViewId:r.id,currentUserId:this.environment.currentUser.id,dateRangeStart:e})}canEditCalendar(){const e=this.props.collectionContextStore.permissionScopesStore.state;return this.canEdit()&&(e.canEditContent||"collectionTypedView"===this.props.collectionContextStore.contextType)}}na.displayName="Calendar",na.contextTypes={...yi.wK,...s.w};const sa=na;function la(e){const t=e.collectionViewStore(),o=null==t?void 0:t.getFormatStore();return(null==o?void 0:o.getKeyStore("calendar_view_range").getValue())??"month"}function aa(e){let{collectionContextStore:t,isFullScreen:o,paddingBottom:r,paddingLeft:i,paddingRight:n}=e;const s=t.settingsStore,l=(0,X.VK)((()=>t.permissionScopesStore.state.canConfigureBlock),[t]);return(0,C.jsx)(Ss,{title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"No date property",id:"database.calendarView.missingDatePropertyTitle"}),description:l?(0,C.jsx)(P.FormattedMessage,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Calendar view.",id:"database.calendarView.missingDateProperty",values:{opensettingslink:e=>(0,C.jsx)(ms,{onClick:()=>{A.r$({collectionContextStore:t,collectionSettingsStore:s}),A.H4({collectionSettingsStore:s,item:{type:"properties",timelineViewTab:"table"}})},children:e})}}):(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Calendar views require a date property in order to display.",id:"database.calendarView.missingDatePropertyNoPermissions"}),style:{paddingLeft:i,paddingRight:n,paddingBottom:o?void 0:r}})}function ca(e,t,o){const{device:r}=o,i="month"===la(e);return t&&!r.isMobile&&i}function da(e){var t;const{collectionContextStore:o,isInPeekRenderer:r,theme:i}=e;if(o.isInHomeWidgetStore.state)return{};return{position:"absolute",left:0,right:0,background:(null===(t=o.inheritedBlockColorStore.state)||void 0===t?void 0:t.background)||(r?i.cardContentBackground:i.contentBackground),zIndex:M.VT}}function ua(e,t){return e.isInHomeWidgetStore.state?{}:{position:"absolute",left:0,right:0,background:t.contentBackground,zIndex:M.VT}}function pa(e){return{position:"relative",flexGrow:1,flexShrink:0,flexBasis:0,borderRight:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,cursor:"default"}}function ha(e){const{isInPeekRenderer:t,isInHomeWidget:o,theme:r}=e;return{...pa(r),background:o?(0,ul.Fq)(r.tableHomeDividerColor,.05):t?r.cardSidebarBackground:r.sidebarBackground}}function ma(e,t,o,r){const i=t.dateRangeStartStore.state;return ca(t,o,e)||!i?r.state.startingMonth:(0,al.kl)((0,al.V7)(i,ge.AK.state))}function Sa(e,t,o,r){var i;const n=(0,ll.Yx)(t,"month_year_long",o);if("month"===e)return n;const s=null==r||null===(i=r.state)||void 0===i?void 0:i[0];if(void 0===s)return"";if((0,al.Bn)({firstDate:s.start,secondDate:s.end}))return n;return`${(0,ll.Yx)(s.start,(0,al.Xh)({firstDate:s.start,secondDate:s.end})?"month_short":"month_year_short",o)} - ${(0,ll.Yx)(s.end,"month_year_short",o)}`}function ga(e,t,o,r,i,n){const{mainEditorCurrentBlockStore:s}=uo.default.state,{performResult:l}=q.createAndCommit({userAction:"Calendar.createBlockInDay",environment:o,perform:l=>{const a=i.state,c=E.IW({environment:o,collectionContextStore:r,groupsPointer:[],insertAtIndex:0,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:l,from:"calendar"});if(!c)return;const u=c.newStore.getAssociatedCollectionStore(),p=(null==u?void 0:u.getMappedProperty(t))??t;il.xD({type:"timestamp",environment:o,store:c.newStore,propertyId:p,timestampMs:e,transaction:l});return function(e,t,o){o?o(e):zt.c4({environment:t,url:e})}(ae.mb({store:c.newStore,mainEditorCurrentBlockStore:s,collectionContextStore:r,showMoveTo:a})??(0,lo.ZP)({store:c.newStore,pageVisitSource:d.tY.Create}),o,n),Z.Xd({collectionContextStore:r,resultsStore:void 0}),c.newStore}});return l}var fa=o(727714),Ca=o(800893),va=o(381726);function ya(e){const{collectionContextStore:t}=e,o=(0,Y.O7)(),[r,n]=(0,i.useState)(!1),s=(0,X.VK)((()=>t.collectionViewStore()),[t]),l=(0,X.VK)((()=>{const e=t.collectionViewStore();return null==e?void 0:e.getFormat().form_block_pointer}),[t]),a=(0,J.yK)((e=>({container:{display:"flex",flexDirection:"row",alignItems:"center"},openFormButton:{marginLeft:6,height:28,fontWeight:j.Z.fontWeight.medium,borderTopRightRadius:0,borderBottomRightRadius:0},copyLinkButton:{height:28,borderTopLeftRadius:0,borderBottomLeftRadius:0,marginLeft:-1,paddingLeft:8,paddingRight:8},linkIcon:{width:14,height:14,color:e.v2.icon.secondary}})),[]);if(!s||!l)return null;const c=(0,va.sP)(l.id);return(0,C.jsx)(C.Fragment,{children:(0,C.jsxs)("div",{style:a.container,children:[(0,C.jsx)(hs.Z,{style:a.openFormButton,onClick:()=>{window.open(c,"_blank")},children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Open form",id:"collectionViewBlock.formEditorView.openForm"})}),(0,C.jsx)(Jt.Z,{forceVisibleState:!!r||void 0,renderTooltip:()=>r?(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Copied",id:"database.collectionViewBlock.formEditorShareButton.copiedLinkToForm.tooltip"}):(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Copy link to form",id:"database.collectionViewBlock.formEditorShareButton.copyLinkToForm.tooltip"}),render:e=>(0,C.jsx)(hs.Z,{style:a.copyLinkButton,onClick:()=>{n(!0),Ca.RD({stringValue:c,environment:o,copiedMessage:void 0}),setTimeout((()=>{n(!1)}),1e3)},...e,children:(0,fa.N)(a.linkIcon)})})]})})}var xa=o(638086),ba=o(206776);function wa(e){const{environment:t,newStore:o,previousStore:r}=e;G.eP({environment:t,store:o}),le.Z5({store:o}),ba.Z.setState({store:o,editMode:"new",previousStore:r})}var ka=o(60217);function Ta(e){const t=(0,Y.O7)(),{store:o,collectionContextStore:r,disabled:n,groupsPointer:s,collectionStore:l,subitemPath:a,indentLevel:c,onSubitemCreate:d}=e,u=(0,X.VK)((()=>(0,ae.fk)({environment:t,collectionContextStore:r})),[r,t]),p=(0,X.VK)((()=>{var e;return"timeline"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType())}),[r]),h=(0,X.VK)((()=>{var e;return"title"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[r]),m=(0,ka.L2)(o),S=(0,X.VK)((()=>(0,tt.f2)({columnIndex:0,titleColumnIndex:0,shouldShowBulkActionsToolbar:u,indentLevel:c+1,isSubitemToggleOnTitleColumn:h})),[c,h,u]),g=(0,J.yK)((t=>({newRowButton:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:S,fontSize:14,lineHeight:j.Z.lineHeight.UIRegular.desktop,borderBottom:`1px solid ${t.tableDividerColor}`,left:0,right:0,...p&&{borderTop:"none"},...e.styles},newRowContainer:{display:"inline-flex",alignItems:"center",position:"sticky",left:S+8,color:t.lightTextColor},newIcon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:t.lightIconColor},newText:{color:t.lightTextColor}})),[S,p,e.styles]),f=(0,X.VK)((()=>{const e=r.permissionScopesStore.state,t=l.isSyncedCollection();return!n&&e.canEditContent&&!t}),[r,n,l]),v=(0,i.useCallback)((e=>{q.createAndCommit({userAction:"CollectionNestedCreateSubitemButton.handleClick",environment:t,perform:i=>{const n=E.yk({environment:t,collectionContextStore:r,groupsPointer:s,store:o,before:!1,collectionStore:l,transaction:i,subitemPath:a,subitemInsertDirection:"into",from:"cvb_new_subitem",event:e});n&&d(n)}}),I.JE(t,{...(0,Ke.Pn)(r)})}),[r,t,s,l,o,a,d]);return!f||m?null:(0,C.jsx)(xe.Z,{onClick:v,onMouseDown:ye.$0,style:g.newRowButton,children:(0,C.jsxs)("span",{style:g.newRowContainer,children:[(0,de.R)(g.newIcon),(0,C.jsx)("span",{style:g.newText,children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"New sub-item",id:"database.tableView.nest.addSubitem"})})]})})}var _a=o(180951);class Va extends io.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:no.Z},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderProperty=e=>(0,C.jsx)(Za,{blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:this.props.store,schema:this.props.schema,showProperties:this.props.showProperties,collectionContextStore:this.props.collectionContextStore,disabled:this.props.disabled,isEditingStore:this.isEditingStore,mouseIsEnteredStore:this.mouseIsEnteredStore,property:e},e),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove=()=>{return e=this.stores.mouseStore,void(po.Z.state||e.setState({...e.state,mouseEntered:!0}));var e},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave=()=>{var e;(e=this.stores.mouseStore).setState({...e.state,mouseEntered:!1})},this.handleMouseMoveThrottled=R.P2(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove,100),this.handleMouseLeaveDebounced=R.Ds(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseLeave,100),this.mouseIsEnteredStore=this.createComputedStore((()=>this.stores.mouseStore.state.mouseEntered)),this.isEditingStore=this.createComputedStore((()=>{const e=pt.Z.state;return Boolean(e.isActive&&e.store.id===this.props.store.id)})),this.newItemEditModeStore=this.createComputedStore((()=>{const e=ba.Z.state;return e.store&&e.store.id===this.props.store.id?e.editMode:void 0})),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockPropertyTab=()=>La(this.environment,this.props.blockPropertyValueOverlayStore,this.props.store,this.props.schema,this.props.showProperties,this.props.collectionContextStore,this.isEditingStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleBlockPropertyUntab=()=>Da(this.environment,this.props.blockPropertyValueOverlayStore,this.props.store,this.props.schema,this.props.showProperties,this.props.collectionContextStore,this.isEditingStore),this.shouldCaptureKeyboardStore=this.createComputedStore((()=>st.default.state.stores.length>0&&st.default.state.stores[0].id===this.props.store.id))}activate(){const e=Pa(this.props.store,this.props.collectionContextStore);e&&(this.props.handleOpenPeekPage(),zt.c4({environment:this.environment,url:e}))}didMount(){super.didMount(),this.isEditingStore.state&&"new"===this.newItemEditModeStore.state&&U.NX({store:this.props.store.getBlockTitleStore()})}willUnmount(){super.willUnmount(),ba.Z.reset(),pt.Z.reset()}renderComponent(){const{device:e}=this.environment,{showProperties:t}=this.props,o=e.isPhone&&this.props.showProperties.length>0,r=(0,C.jsx)(ja,{collectionContextStore:this.props.collectionContextStore,toggleButton:this.props.toggleButton,subitemPath:this.props.subitemPath});if(o){const o=t.indexOf("title"),[i,s]=[t.slice(0,o+1),t.slice(o+1)];return(0,C.jsxs)("div",{style:{display:"flex"},children:[r,(0,C.jsxs)(Yt.Z,{href:Ra(this.props.store),metaHref:Pa(this.props.store,this.props.collectionContextStore),external:!1,style:(n=this.theme,{flexGrow:1,textDecoration:"none",overflow:"hidden",borderBottom:`1px solid ${n.tableDividerColor}`}),innerStyle:{paddingLeft:4,paddingRight:4,paddingBottom:4,paddingTop:4},children:[(0,C.jsx)("div",{style:{display:"flex",alignItems:"center"},children:i.map(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderProperty)}),s.length>0&&(0,C.jsx)("div",{style:{display:"flex",alignItems:"center",paddingLeft:e.isMobile?0:6,paddingBottom:e.isMobile?0:4},children:s.map(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderProperty)})]})]})}return(0,C.jsx)(Qt.Z,{debugName:"CollectionListViewItem",capture:this.shouldCaptureKeyboardStore.state,onShiftEnter:this.props.onShiftEnter,children:(0,C.jsxs)("div",{style:{display:"flex"},children:[r,(0,C.jsx)(Yt.Z,{href:Ra(this.props.store),metaHref:Pa(this.props.store,this.props.collectionContextStore),altHref:Pa(this.props.store,this.props.collectionContextStore),onClick:()=>function(e,t){Ia(e),t()}(this.props.store,this.props.handleOpenPeekPage),external:!1,style:(i=this.isEditingStore.state?"multi":"single",{display:"flex",flexGrow:1,textDecoration:"none",overflow:"hidden",borderRadius:4,..."single"===i?{height:30}:{minHeight:30}}),innerStyle:{display:"flex",alignItems:"center",paddingLeft:4,paddingRight:4,userSelect:this.isEditingStore.state?void 0:"none",WebkitUserSelect:this.isEditingStore.state?void 0:"none"},hoveredStyle:{background:this.isEditingStore.state?"transparent":this.theme.buttonHoveredBackground},pressedStyle:{background:this.isEditingStore.state?"transparent":this.theme.buttonPressedBackground},onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced,children:t.map(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderProperty)})]})});var i,n}}Va.displayName="CollectionListViewItem";const Oa=Va;function Ma(e,t){const o=t[e];return Boolean(o&&!ce.uk.includes(o.type))}function Pa(e,t){const{mainEditorCurrentBlockStore:o}=uo.default.state;return ae.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})}function Ra(e){return(0,lo.ZP)({store:e,fullyQualified:!1,pageVisitSource:d.tY.LinkInPage})}function ja(e){let{collectionContextStore:t,toggleButton:o,subitemPath:r}=e;const i=(0,X.VK)((()=>t.currentSubitemFormatStoreForUiDisplayStore.state),[t]),n=(null==r?void 0:r.length)??0;if(!i)return null;const s=Math.max((n-1)*rt.Hw,0)+rt.gY;return o?(0,C.jsxs)("div",{style:{paddingTop:4,display:"flex"},children:[(0,C.jsx)("div",{style:{width:s}}),o]}):(0,C.jsx)("div",{style:{minWidth:s+rt.Hw}})}function Ia(e){le.IH({store:e})}function Fa(e,t,o,r,i){if("title"===e){ct.xv({environment:i,blockPropertyValueOverlayStore:o});const e=t.getBlockTitleStore();G.eP({environment:i,store:t}),le.Z5({store:t}),U.NX({store:e})}else e?(ct.xv({environment:i,blockPropertyValueOverlayStore:o}),ct.bA({environment:i,blockPropertyValueOverlayStore:o,store:t,property:e,format:mt.C.ListView,collectionContextStore:r})):ct.xv({environment:i,blockPropertyValueOverlayStore:o});Ia(t)}function Na(e,t,o){ct.xv({environment:e,blockPropertyValueOverlayStore:t}),G.Ys({environment:e,store:o}),Ia(o)}function Ba(e,t,o,r,i){return t.isDefined()?r.filter((r=>{const n="title"!==r&&i.state;return!_a.wV({property:r,schema:o,block:t.getModel(),getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,He.r)(),intl:We.default.getIntl()})||n})):[]}function Ea(e,t,o,r,i,n){const s=t.state,l=s.isOpen?s.property:"title",a=Ba(e,o,r,i,n),c=a.findIndex((e=>e===l)),d=R.dF(a,((e,t)=>t<c&&Ma(e,r)));return d||(n.state?"title":function(e,t){return R.dF(e,(e=>Ma(e,t)))}(a,r))}function Aa(e,t,o,r,i,n){const s=t.state,l=s.isOpen?s.property:"title",a=Ba(e,o,r,i,n),c=a.findIndex((e=>e===l)),d=a.find(((e,t)=>t>c&&Ma(e,r)));return d||(n.state?"title":function(e,t){return e.find((e=>Ma(e,t)))}(a,r))}function La(e,t,o,r,i,n,s){Fa(Aa(e,t,o,r,i,s),o,t,n,e)}function Da(e,t,o,r,i,n,s){Fa(Ea(e,t,o,r,i,s),o,t,n,e)}function Za(e){let{property:t,blockPropertyValueOverlayStore:o,store:r,schema:n,showProperties:s,collectionContextStore:l,disabled:a,isEditingStore:c,mouseIsEnteredStore:d}=e;const u=(0,Y.O7)(),p=(0,i.useCallback)((()=>Da(u,o,r,n,s,l,c)),[u,o,r,n,s,l,c]),h=(0,i.useCallback)((()=>La(u,o,r,n,s,l,c)),[u,o,r,n,s,l,c]),m=(0,X.VK)((()=>ae.Bm({store:r,collectionContextStore:l})),[r,l]),S=(0,X.VK)((()=>{const e=l.isInHomeWidgetStore.state,o=l.isUnlistedViewStore.state&&l.isInlineViewStore.state;return"title"===t&&d.state&&!e&&!o}),[l,d,t]),g=(0,X.VK)((()=>r.canEdit()),[r]),f=(0,X.VK)((()=>l.collectionViewStore()),[l]),v=(0,X.VK)((()=>c.state||l.isInHomeWidgetStore.state),[c,l]),y=(0,X.VK)((()=>l.permissionScopesStore.state.isLocked||!l.permissionScopesStore.state.canEditContent),[l]);return m?(0,C.jsx)(Gt.Z,{store:r,property:t,disabled:a||!g,locked:y,format:mt.C.ListView,tableWrap:!1,blockPropertyValueOverlayStore:o,collectionStore:m,collectionViewStore:f,forceMouseEntered:S,showIfEmpty:v,onBgClick:()=>Na(u,o,r),onEnter:()=>Na(u,o,r),onEsc:()=>Na(u,o,r),onTab:h,onUntab:p,onClick:()=>Ia(r)},t):null}function Ha(){return{marginTop:1,marginBottom:1,borderRadius:4}}const za=i.memo((function(e){let{groupFormat:t,store:o,format:r,disabled:n,collectionContextStore:s,schema:l,blockPropertyValueOverlayStore:a}=e;const c=(0,Y.O7)(),d=(0,i.useMemo)((()=>t?[t]:[]),[t]),u=(0,i.useMemo)((()=>(r.list_properties?r.list_properties:[]).filter((e=>e.visible)).map((e=>{let{property:t}=e;return t}))),[r]),{permissionScopes:p}=(0,X.VK)((()=>({permissionScopes:s.permissionScopesStore.state})),[s]),h=(0,X.VK)((()=>s.groupsStore.getGroupState(d)),[d,s]),m=(0,X.VK)((()=>!n&&o.canEdit()&&p.canEditContent&&!p.isSyncedCollection),[n,o,p]),S=(0,i.useCallback)((()=>{if(!h)return;const e=s.collectionStore();if(!e||!s.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const t=st.default.state.stores[0];if(!t)return;const o=s.subitemTreeStore.state,r=(0,et.DY)(o.children,(e=>e.value.store===t));if(!r)return;const i=r?(0,rt.Af)(r.map((e=>e.value.store))):"",n=s.subitemExpandedStore.state.get(i),l=Boolean(null==n?void 0:n.isExpanded);q.createAndCommit({userAction:"CollectionListView.onItemShiftEnter",environment:c,perform:o=>{const i=E.yk({environment:c,collectionContextStore:s,groupsPointer:h.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:r,subitemInsertDirection:l?"into":"below",from:"list_selection_overlay_shift_enter"});i&&wa({environment:c,newStore:i,previousStore:t})}}),I.sd(c,"list_item_edit_mode_enter",{...(0,Ke.Pn)(s),block_id:t.id,from:"shiftEnter",view_type:"list"})}),[s,c,h]),g=(0,i.useCallback)(((e,t)=>{wa({environment:c,newStore:t,previousStore:e})}),[c]),f=(0,i.useMemo)((()=>({schema:l,collectionViewBlockStore:o,showProperties:u,disabled:n,blockPropertyValueOverlayStore:a,collectionContextStore:s,onShiftEnter:S})),[a,s,n,S,l,u,o]),v=(0,i.useCallback)((e=>{const{store:t,parentStore:o,subitemPath:r,indentLevel:i}=e;if(o)return(0,C.jsx)(Ta,{store:t,collectionStore:o,subitemPath:r,indentLevel:i,collectionContextStore:s,disabled:n,groupsPointer:d,styles:{borderBottom:void 0,borderTop:void 0},onSubitemCreate:e=>{le.Z5({store:e,transient:!1}),ba.Z.setState({store:e,editMode:"new",previousStore:void 0})}})}),[s,n,d]);return h?(0,C.jsx)(Tt,{collectionContextStore:s,groupsPointer:d,format:r,canDrag:m,resultProps:f,canDrop:!0,resultComponent:Oa,disabled:n,shouldShowHoverMenu:!0,direction:wt.Vertical,analyticsName:"list",getItemSelectableStyle:Ha,emptyDroppableSize:0,onSelectableInsertRow:g,nestedCreateSubitemButton:v}):null}));var Ka=o(336597);const Ga=i.memo((function(e){const t=(0,Y.O7)(),o=(0,J.Fg)(),{store:r,format:n,paddingBottom:s,paddingLeft:l,paddingRight:a,isFullScreen:c,isRootChild:u,minWidth:p,disabled:h,collectionContextStore:m}=e,S=(0,X.VK)((()=>ae.az(m,c)),[m,c]),g=n.collection_group_by,f=(0,X.VK)((()=>null==m?void 0:m.isInHomeWidgetStore.state),[m]),v=(0,X.VK)((()=>"collectionVirtualView"===(null==m?void 0:m.contextType)),[m]),y=(0,i.useCallback)(((e,o,r)=>{!function(e,t,o,r,i){if(r.device.isMobile)ne._c({environment:r,store:e,pageVisitSource:d.tY.Create});else if(t)wa({environment:r,newStore:e,previousStore:void 0});else{const{groupFormat:t}=o,n=t?[t]:[],s=i.groupsStore.getGroupState(n),l="collectionTypedView"===i.contextType;se.CH({environment:r,store:e,peekMode:ae.kr(i),showMoveTo:l,resultsStore:null==s?void 0:s.resultsStore,collectionContextStore:i,pageVisitSource:d.tY.Create})}}(e,o,r,t,m)}),[t,m]),x=(0,i.useCallback)((t=>(0,C.jsx)(fn,{reducerId:"list_groups",store:r,collectionContextStore:m,disabled:h,isFullScreen:c,isRootChild:u,paddingLeft:l,stickyLeft:!1,renderGroup:t=>(0,C.jsx)(Qa,{...e,groupFormat:t}),getGroupStyle:e=>function(e,t){if(0===e.index)return{};return{borderTop:`1px solid ${t.tableDividerColor}`}}(e,o),renderHeader:e=>(0,C.jsx)(qa,{args:e}),onGroupHeaderAddItem:y})),[m,h,c,u,y,l,e,r,o]);return(0,bn.Z)((o=>(0,C.jsxs)("div",{style:{paddingBottom:s,paddingLeft:l,paddingRight:a,minWidth:p},className:dt.nM$,children:[(0,C.jsx)(St.Z,{store:r,shouldShowHalo:!c&&!f,canSelect:!c,analyticsName:"list",style:Wa(n,f,v),...o,children:g?x(g):(0,C.jsx)(Qa,{...e,groupFormat:g})}),!S&&(0,C.jsx)(Rt.Z,{onChange:e=>function(e,t,o,r){const i=o.isLoadingStore.state,n=o.groupsStore.getGroupState([]);if(!n)return;if("collectionVirtualView"===o.contextType)return;const s=n.reducerResultStore.state;e<Ft.Z.incrementScrollOffset&&s&&!i&&s.hasMore&&E.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:r,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}(e,t,m,c)})]})))}));function Wa(e,t,o){return{display:"flex",flexDirection:"column",paddingTop:e.collection_group_by||t||o?void 0:4,paddingBottom:4}}function Ua(e){return{width:14,height:14,marginLeft:4,marginRight:6,fill:e.lightIconColor}}function qa(e){let{args:t}=e;const{collectionContextStore:o}=t,r=(0,J.Fg)(),i=(0,X.VK)((()=>o.isInHomeWidgetStore.state),[o]);return(0,C.jsx)(Yr,{...t,height:i?It.yZ:48,getComputedStickyStyle:e=>function(e,t){return{boxShadow:e?`0 -1px 0 ${t.contentBackground}`:void 0}}(e,r)})}function $a(e,t,o,r,i){if(!Nt.M_(t))return;const n=o.currentSubitemFormatStoreForUiDisplayStore.state;q.createAndCommit({userAction:"CollectionListView.handleAddItemClick",environment:t,perform:s=>{!function(e){var t;const{transaction:o,environment:r,results:i,collectionContextStore:n,isFullScreen:s,groupsPointer:l,insertAtIndex:a,from:c,useCrdt:u}=e;n.searchQueryStore.state&&le.Ug({searchQuery:"",collectionContextStore:n,isFullScreen:s});const p=null===(t=n.groupsStore.getGroupState(l))||void 0===t?void 0:t.resultsStore;if(!p)return;let h;a>0&&(h=i[a]);const m=E.IW({environment:r,collectionContextStore:n,groupsPointer:l,insertAtIndex:a,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:o,from:c,useCrdt:u});if(!m)return;const S=m.coercionSucceeded,g=m.newStore;r.device.isMobile?ne._c({environment:r,store:g,pageVisitSource:d.tY.Create}):S?wa({environment:r,newStore:g,previousStore:h}):se.CH({environment:r,store:g,peekMode:(0,ae.kr)(n),resultsStore:p,collectionContextStore:n,pageVisitSource:d.tY.Create}),lt.W(r,{from:c,type:"page",new_page_id:g.id,creating_block_id:g.id,...(0,Ke.Pn)(n)})}({transaction:s,environment:t,results:e.resultsStore.state,collectionContextStore:o,isFullScreen:r,groupsPointer:e.groupsPointer,insertAtIndex:e.resultsStore.state.length,from:n?"list_view_add_parent_item_bottom":"list_view_add_item_bottom",useCrdt:i})}})}const Qa=i.memo((function(e){let{store:t,format:o,schema:r,disabled:n,groupFormat:s,isFullScreen:l,collectionContextStore:a,blockPropertyValueOverlayStore:c}=e;const d=(0,J.Fg)(),u=void 0!==s,p=(0,i.useMemo)((()=>s?[s]:[]),[s]),h=(0,X.VK)((()=>a.groupsStore.getGroupState(p)),[a,p]),m=(0,X.VK)((()=>null==h?void 0:h.reducerResultStore.state),[h]),S=(0,X.VK)((()=>a.groupsStore.anyGroupHasResults()),[a]),g=(0,X.VK)((()=>{const e=a.permissionScopesStore.state;return{canEditContent:e.canEditContent,isSyncedCollection:e.isSyncedCollection}}),[a]),f=(0,X.VK)((()=>"collectionTypedView"===a.contextType),[a]),v=(0,X.VK)((()=>a.isInHomeWidgetStore.state),[a]),y=(0,X.VK)((()=>!v&&S&&!n&&t.canEdit()&&(g.canEditContent||f)&&!g.isSyncedCollection),[v,f,n,S,g.canEditContent,g.isSyncedCollection,t]),x=(0,X.VK)((()=>""!==a.searchQueryStore.state),[a]),b=(0,X.VK)((()=>void 0!==m&&(null==m?void 0:m.blockIds.length)>0),[m]),w=(0,X.VK)((()=>fe({collectionContextStore:a,groupsPointer:p,hasPartialResults:b})),[a,p,b]),k=(0,X.VK)((()=>ae.VM({collectionContextStore:a,reducerResult:m,isFullScreen:l})),[a,m,l]);return h?(0,C.jsxs)("div",{style:{paddingBottom:s?v?8:16:void 0},children:[(0,C.jsx)(za,{groupFormat:s,store:t,format:o,disabled:n,collectionContextStore:a,schema:r,blockPropertyValueOverlayStore:c}),w&&(0,C.jsx)(Ka.h,{isFullScreen:l,hasGroups:u,hasPartialResults:b,hasSearchQuery:x,overrideNumShimmerRows:v&&!b?6:void 0}),k&&(0,C.jsx)(Ae,{groupsPointer:p,store:t,collectionContextStore:a,format:o,isFullScreen:l,incrementLimitsInRelatedGroups:!1}),y&&(0,C.jsxs)(C.Fragment,{children:[k&&(0,C.jsx)("div",{style:{width:"100%",borderTop:s?void 0:`1px solid ${d.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,C.jsx)(Ya,{collectionContextStore:a,isFullScreen:l,groupState:h})]})]}):null}));function Ya(e){let{groupState:t,collectionContextStore:o,isFullScreen:r}=e;const i=(0,J.Fg)(),n=(0,Y.O7)();return(0,C.jsxs)(xe.Z,{onClick:e=>$a(t,n,o,r,(0,jt.SL)({event:e,source:"collection_non_table_view"})),onMouseDown:ye.$0,style:{display:"flex",alignItems:"center",height:30,borderRadius:4,fontSize:14},children:[(0,de.R)(Ua(i)),(0,C.jsx)("div",{style:{color:i.lightTextColor},children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"New",id:"database.listView.addItemButtonTitle"})})]})}var Xa=o(413182),Ja=o(134464),ec=o(543696),tc=o(497372);class oc extends c.default{getInitialState(){return{}}getCurrentFormat(e){return this.state.temporaryFormat?this.state.temporaryFormat:e}getCurrentProperties(e,t){return this.getCurrentFormat(t)[e]||[]}}const rc=oc;var ic=o(801742),nc=o(273959);const sc={display:"flex",width:32,height:"100%",alignItems:"center",justifyContent:"center"};function lc(e){(0,ye.ZP)({event:e,context:ye.Af.EditorMouseDown,callback:()=>{}})}function ac(e,t){return!e&&t}var cc=o(668709),dc=o(932426),uc=o(374617),pc=o(623063),hc=o(603072),mc=o(729376),Sc=o(825464);function gc(e){const{disabled:t,property:o,schema:r,collectionContextStore:n,groupFormat:s,propertyFormat:l,isHovered:a,aggregation:c,onChange:d}=e,u=(0,i.useMemo)((()=>!!(null!=l&&l.width&&l.width<100)),[l]),h=(0,Y.O7)(),m=(0,P.useIntl)(),{isMobile:S}=(0,Y.Fy)(),[g,f]=(0,i.useState)(void 0),v=(0,X.VK)((()=>{if(!c)return;return{type:"aggregation",filter:s?(0,Ze.zk)({schema:r,propertyMapping:void 0,group:s,timeZone:(0,He.r)()}):void 0,aggregation:c}}),[r,s,c]),y=(0,i.useCallback)(((e,t)=>{if(e){const r={aggregator:e,property:o,enforceMaxAggregationLimit:t};d(o,r),f(r),F.wd({environment:h,collectionContextStore:n,action:"table_change_aggregation"})}else d(o,void 0),F.wd({environment:h,collectionContextStore:n,action:"table_remove_aggregation"})}),[h,d,o,n]),x=(0,J.yK)((()=>({buttonStyle:{display:"flex",alignItems:"center",justifyContent:"flex-end",width:"100%",height:32,paddingRight:8,overflow:"hidden",whiteSpace:"nowrap",userSelect:"auto",WebkitUserSelect:"auto"}})),[]),b=(0,X.VK)((()=>mr(n,c)),[n,c]);(0,i.useEffect)((()=>{g&&!mr(n,g)&&(0,R.Xy)(c,g)&&f(void 0)}),[b,g,n,c]);const w=u&&null!=c&&c.aggregator?Yo.VN[(0,p.OV)(c)]:void 0;return(0,C.jsx)(Te.ZP,{popupType:S?Te.Z4.SlideUp:Te.Z4.Popup,disabled:t,renderOrigin:e=>v?(0,C.jsx)(bt.Z,{id:fc(s,o,v.aggregation),collectionContextStore:n,reducer:v,groupsPointer:s?[s]:void 0,render:i=>(0,C.jsx)(Jt.Z,{alignment:u?Sc.v.Center:Sc.v.End,disableTooltip:!b&&!w,renderTooltip:()=>b?m.formatMessage(gr.aggregationCalculating):w,render:n=>(0,C.jsx)(xe.Z,{disabled:t,style:x.buttonStyle,...(0,hr.Z)(n,e),children:(0,C.jsx)(Cc,{resultStore:i,aggregation:c,schema:r,property:o,hideLabelText:u})})})}):(0,C.jsx)(xe.Z,{disabled:t,style:x.buttonStyle,...e,children:(0,C.jsx)(vc,{disabled:t,isHovered:a,hideLabelText:u})}),render:e=>{let{close:t}=e;return(0,C.jsx)(hc.Z,{currentAggregation:c,property:o,schema:r,onChange:y,onClose:t,source:"tableAggregation"})}})}function fc(e,t,o){let r=`${o.aggregator}`;return"object"==typeof o.aggregator&&"operator"in o.aggregator&&(r=`${o.aggregator.operator}:${o.aggregator.groupName}`),`table:${(0,ee.mD)(e)}:${t}:${r}`}function Cc(e){const{aggregation:t,resultStore:o,schema:r,property:n,hideLabelText:s}=e,l=(0,jl.Y$)(),a=(0,J.yK)((e=>({valueStyle:{display:"flex",alignItems:"center",height:"100%"},aggregationTypeNameStyle:{fontSize:10,textTransform:"uppercase",letterSpacing:1,color:e.mediumTextColor,marginTop:2,marginRight:4,userSelect:"none",WebkitUserSelect:"none"}})),[]),c=(0,X.VK)((()=>o.state),[o]),d=(0,i.useMemo)((()=>{if(!t)return;let e=Yo.v6[(0,p.OV)(t)];return(0,p.en)(t.aggregator)&&(e=t.aggregator.groupName in uc.ZA?uc.ZA[t.aggregator.groupName]:t.aggregator.groupName),e}),[t]),u=r[n],h=(0,X.VK)((()=>{if(u&&("formula"===u.type||"number"===u.type))return u.number_format;if("rollup"===(null==u?void 0:u.type)&&u.relation_property&&u.target_property&&"number"===u.target_property_type){if(r[u.relation_property]){var e;const t=(0,mc.ny)(l,r[u.relation_property]),o=null==t||null===(e=t.getModel())||void 0===e?void 0:e.getNormalizedSchema(),i=null==o?void 0:o[u.target_property];if("number"===(null==i?void 0:i.type))return i.number_format}}}),[u,r,l]);if(d){const e=(0,C.jsx)("span",{style:a.valueStyle,children:t&&(0,C.jsx)(Sr,{aggregation:t,collectionContextStore:l,children:c?(0,Yo.Zy)({numberFormat:h,dateFormat:void 0,aggregation:t,userTimeZone:(0,He.r)(),value:c.aggregationResult,roundDecimal:5}):void 0})},"value");return s?e:(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("span",{style:a.aggregationTypeNameStyle,children:d},"type"),e]})}return null}function vc(e){let{disabled:t,isHovered:o,hideLabelText:r}=e;const i=(0,J.yK)((e=>({placeholderWrapper:{display:"flex",alignItems:"center"},placeholderText:{color:e.lightTextColor},chevronIcon:{width:10,marginLeft:r?1:4,fill:e.lightIconColor},summationIcon:{width:12,fill:e.lightIconColor}})),[r]),{isMobile:n}=(0,Y.Fy)();return t||!o&&!n?null:(0,C.jsx)(pc.Z,{isVisible:!0,animationStyle:{opacity:1},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},render:()=>(0,C.jsxs)("div",{style:i.placeholderWrapper,children:[r?(0,C.jsx)("span",{style:i.placeholderText,children:(0,dc.D)(i.summationIcon)},"placeholder"):(0,C.jsx)("span",{style:i.placeholderText,children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Calculate",id:"database.tableView.aggregationPlaceholder"})},"placeholder"),(0,Zi.i)(i.chevronIcon)]})})}const yc=i.memo((function(e){let{collectionContextStore:t,disabled:o,groupFormat:r,isFullScreen:n,isInPeekRenderer:s,query:l,schema:a,showHoverActionsStore:c,showPropertyFormats:d,showRightActionsSpacer:u,style:p}=e;const h=(0,Y.O7)(),m=(0,J.Fg)(),[S,g]=(0,i.useState)(!1),f=(0,X.VK)((()=>t.frozoneStore.state.frozenIndex),[t.frozoneStore]),{unfrozenIndexAddendum:v,frozenPropertyFormats:y,unfrozenPropertyFormats:x}=(0,X.VK)((()=>{const e=d;let t=[],o=e;const r=(0,ae.bW)(f);return void 0!==f&&(t=e.slice(0,r),o=e.slice(r)),{unfrozenIndexAddendum:r,frozenPropertyFormats:t,unfrozenPropertyFormats:o}}),[f,d]),b=(0,X.VK)((()=>t.isInHomeWidgetStore.state),[t]),w=(0,X.VK)((()=>{var e;return{display:"flex",position:"absolute",background:b?void 0:(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(s?m.cardContentBackground:m.contentBackground),zIndex:M.RJ,fontSize:14,height:Lu+(n?Lr.Z.state:0)+1,minWidth:"100%",clipPath:"polygon(0% -20%, 100% -20%, 100% 100%, 0% 100%)",left:0,...p}}),[t,n,s,p,m,b]),k=(0,X.VK)((()=>void 0!==f&&(0,tt.oc)({environment:h,collectionContextStore:t,isPhone:h.device.isPhone,theme:m})),[f,h,t,m]),T=(0,i.useCallback)((()=>{g(!0)}),[g]),_=(0,i.useCallback)((()=>{g(!1)}),[g]),V=(0,i.useCallback)((e=>e?{borderTop:`1px solid ${m.tableDividerColor}`}:{borderTop:void 0}),[m]);function O(e,i){return(0,C.jsx)(xc,{propertyFormat:e,index:i,groupFormat:r,disabled:o,mouseEntered:S,showHoverActionsStore:c,collectionContextStore:t,schema:a,query:l},e.property)}return(0,C.jsx)(Ur,{position:b?Rr.IGNORE:Rr.Bottom,getComputedStyle:V,children:(0,C.jsx)(cc.p,{allowSelectionWithin:!1,style:w,onMouseMove:T,onMouseLeave:_,onMouseDown:wc,children:(0,C.jsx)("div",{style:{display:"flex",paddingRight:!o&&u?32:0},children:(0,C.jsxs)("div",{style:{display:"flex"},children:[void 0!==f&&(0,C.jsx)("div",{style:{...k,display:"flex"},children:y.map(O)}),x.map(((e,t)=>O(e,t+v)))]})})})})}),pe.Z),xc=i.memo((function(e){var t;let{propertyFormat:o,index:r,groupFormat:n,disabled:s,mouseEntered:l,showHoverActionsStore:a,collectionContextStore:c,query:d,schema:u}=e;const p=(0,Y.O7)(),h=(0,X.VK)((()=>(0,ae.fk)({environment:p,collectionContextStore:c})),[p,c]),m=(0,X.VK)((()=>a.state),[a]),S=(0,i.useCallback)(((e,t)=>{const o=c.collectionViewStore();if(!o)return;let r=d.aggregations?[...d.aggregations]:[];const i=(d.aggregations||[]).findIndex((t=>t.property===e));r=i<0?R.oA([...r,t]):R.oA(r.map(((e,o)=>i===o?t:e)));const n={...d,aggregations:r};!c.isClientModeEnabledStore.state&&t&&c.asyncAggregationStatusStore.setState({calculating:!0,aggregation:t,changingType:!0}),q.createAndCommit({userAction:"TableAggregationRow.handleTableAggregationChange",environment:p,perform:e=>{le.iG({collectionViewStore:o,update:{query2:n},transaction:e})}})}),[c,d,p]);return(0,C.jsx)("div",{style:{display:"flex",width:void 0!==o.width?o.width+(0===r&&h?tt.Xx:0):void 0},children:(0,C.jsx)(gc,{groupFormat:n,propertyFormat:o,disabled:s,isHovered:(l||0===r&&!n&&m)&&!s,aggregation:null===(t=d.aggregations)||void 0===t?void 0:t.find((e=>e.property===o.property)),property:o.property,collectionContextStore:c,schema:u,onChange:S})})})),bc=yc;function wc(e){(0,ye.ZP)({event:e,context:ye.Af.EditorMouseDown,callback:()=>{}})}function kc(e){const{collectionContextStore:t,shouldShowAddRowButton:o,paddingLeft:r,handleAddRowClick:i}=e,n=(0,X.VK)((()=>Boolean(t.currentCombinatorFilterStore.state||t.currentPropertyFiltersStore.state.length>0)),[t]),s=(0,X.VK)((()=>t.isInHomeWidgetStore.state),[t]),l=(0,J.yK)((e=>{const t=s?e.tableHomeDividerColor:e.tableDividerColor;return{button:{display:"flex",alignItems:"center",height:Au+1,width:"100%",paddingLeft:Du,fontSize:14,lineHeight:j.Z.lineHeight.UIRegular.desktop,background:s?void 0:e.contentBackground,left:0,right:0,textAlign:"center",borderBottom:`1px solid ${t}`},buttonInner:{color:e.lightTextColor,position:"sticky",left:r+Du}}}),[s,r]);return(0,C.jsx)(xe.Z,{className:dt.Gcz,onClick:i,onMouseDown:ye.$0,disabled:!o,style:l.button,children:o?(0,C.jsx)("span",{style:l.buttonInner,children:n?(0,C.jsx)(P.FormattedMessage,{defaultMessage:"No filter results. Click to add a row.",id:"database.tableView.emptyTablePlaceholderWithFilters"}):(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Empty. Click to add a row.",id:"database.tableView.emptyTablePlaceholder"})}):(0,C.jsx)("span",{style:l.buttonInner,children:n?(0,C.jsx)(P.FormattedMessage,{defaultMessage:"No filter results.",id:"database.tableView.cannotEdit.emptyTablePlaceholderWithFilters"}):(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Empty.",id:"database.tableView.cannotEdit.emptyTablePlaceholder"})})})}var Tc=o(425962),_c=o(287085);function Vc(e){let{collectionContextStore:t}=e;const o=(0,Y.O7)(),r=(0,J.yK)((e=>({button:{display:"flex",justifyContent:"flex-start",width:32},icon:{width:12,fill:e.mediumIconColor}})),[]),n=(0,i.useCallback)((()=>{t.collectionStore()&&(U.ZH({debug:{userAction:"AddColumnButton.handleAddColumnClick"},environment:o}),G.ZH({debug:{userAction:"AddColumnButton.handleAddColumnClick"},environment:o}),le.wG(),F.wd({environment:o,collectionContextStore:t,action:"click_new_property"}),A.wl({collectionSettingsStore:t.settingsStore,item:{type:"propertyType",onAccept:(e,r,i,n)=>{_c.PW({environment:o,collectionContextStore:t,propertyType:e,isSuggestedProperty:r,propertyName:i,selectOptions:n,from:"table"})}}}))}),[t,o]);return(0,C.jsx)(xe.Z,{style:r.button,onMouseDown:lc,onClick:n,className:dt.V6y,children:(0,C.jsx)("div",{style:sc,children:(0,de.R)(r.icon)})})}function Oc(e){let{collectionContextStore:t}=e;const o=(0,Y.O7)(),r=(0,J.yK)((e=>({dotsIcon:{width:12,fill:e.mediumIconColor},button:{display:"flex",justifyContent:"flex-start",flexGrow:1,width:32}})),[]),n=(0,i.useCallback)((()=>{A.r$({collectionContextStore:t,collectionSettingsStore:t.settingsStore}),F.wd({environment:o,collectionContextStore:t,action:"click_table_header_dot_menu"}),A.H4({collectionSettingsStore:t.settingsStore,item:{type:"properties",timelineViewTab:"timeline"}})}),[t,o]);return(0,C.jsx)(xe.Z,{style:r.button,onMouseDown:lc,onClick:n,className:dt.V6y,children:(0,C.jsx)("div",{style:sc,children:(0,ke.o)(r.dotsIcon)})})}const Mc=2,Pc=3;function Rc(e){const{isCollectionViewBlockSelected:t,passesFilter:o,isScrolled:r,isCheckbox:n,isShimmerRow:s}=e,l=(0,i.useCallback)((e=>"dark"===e.mode?"transparent":o&&!t?`linear-gradient(to right, ${(0,ul.Fq)(rr.se[e.mode].gray,.15)},${(0,ul.Fq)(rr.se[e.mode].gray,.1)},  transparent)`:`linear-gradient(to right, ${(0,ul.Fq)(rr.se[e.mode].gray,.35)},${(0,ul.Fq)(rr.se[e.mode].gray,.2)},  transparent)`),[o,t]),a=(0,J.yK)((e=>({border:{position:"absolute",top:-1,right:0,width:Mc,height:s?35:"calc(100% + 2px)",background:o&&!t||"dark"===e.mode?e.tableDividerColor:e.tableFrozenFilterDividerColor},shadow:{position:"absolute",top:0,right:-Pc,width:Pc,height:s?34:"100%",background:l(e)}})),[s,o,t,l]);return(0,C.jsxs)(C.Fragment,{children:[n&&!r?null:(0,C.jsx)("div",{style:a.border}),(0,C.jsx)(pc.Z,{isVisible:!0,animationStyle:{opacity:r?1:0},render:()=>(0,C.jsx)("div",{style:a.shadow})})]})}function jc(e){const{checkedState:t,onClick:o,checkboxType:r,collectionContextStore:n,passesFilter:s,disabled:l,frozoneProps:a}=e,c=(0,Y.O7)(),d=(0,X.qz)(void 0,no.Z),u=(0,X.VK)((()=>d.state.mouseEntered),[d]),p=(0,i.useRef)(null);(0,i.useEffect)((()=>{p.current&&(p.current.indeterminate="indeterminate"===t)}),[t]);const h=(0,X.VK)((()=>ht.ZP.state.isDragging),[]),m=(0,i.useCallback)((e=>{l||(o(e),F.Ac({environment:c,collectionContextStore:n,checkbox_type:r}))}),[l,r,n,c,o]),S=(0,X.VK)((()=>!1===t&&!u||h?null!=a&&a.shouldShowStickyMultiSelectColumn?.4:0:1),[t,h,u,null==a?void 0:a.shouldShowStickyMultiSelectColumn]),g=(0,J.yK)((e=>({multiSelectCheckbox:{background:null!=a&&a.isScrolled?null==a?void 0:a.frozenStyles.background:void 0,borderBottom:e.tableDividerColor,height:"100%"},multiSelectCheckboxInner:{background:null!=a&&a.isCollectionViewBlockSelected?rr.ZP.blueWithAlpha(.14):void 0,height:"100%"},checkBoxInput:{width:tt.tA,height:tt.tA,cursor:l?void 0:"pointer",accentColor:e.fill.uiBlue,position:"relative",right:2}})),[l,null==a?void 0:a.frozenStyles.background,null==a?void 0:a.isCollectionViewBlockSelected,null==a?void 0:a.isScrolled]);return(0,C.jsx)(pc.Z,{isVisible:!0,animationStyle:{opacity:S>0?1:0},render:()=>(0,C.jsxs)("div",{style:g.multiSelectCheckbox,onMouseEnter:()=>{d.enter()},onMouseLeave:()=>{d.exit()},children:[(0,C.jsx)("div",{style:g.multiSelectCheckboxInner,children:(0,C.jsx)(pc.Z,{isVisible:!0,animationStyle:{opacity:S},render:()=>(0,C.jsx)("label",{style:{height:"100%",alignItems:"flex-start",justifyContent:"center",display:"flex",cursor:l?void 0:"pointer",zIndex:1},onClick:ye.Wi,onMouseDown:ye.$0,children:(0,C.jsx)("div",{style:{width:`${tt.bu}px`,height:tt.bu-1+"px",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,C.jsx)("input",{type:"checkbox",style:g.checkBoxInput,ref:p,checked:!0===t,onChange:m,disabled:l})})})})}),(null==a?void 0:a.shouldFreezeMultiSelectColumn)&&(0,C.jsx)(Rc,{isCollectionViewBlockSelected:null==a?void 0:a.isCollectionViewBlockSelected,passesFilter:s,isCheckbox:!0,isScrolled:!0})]})})}function Ic(e){const{groupsPointer:t,collectionContextStore:o,frozoneProps:r}=e,n=(0,Y.O7)(),s=(0,i.useCallback)((()=>(0,rt.A7)(t[0],o).filter((e=>e.canEdit()))),[o,t]),l=(0,X.VK)((()=>0===s().length),[s]),a=(0,X.VK)((()=>{const e=s(),t=e.length;if(0===t)return!1;const o=st.default.state.stores.filter((t=>e.includes(t))).length;return 0!==o&&(o===t||"indeterminate")}),[s]),c=(0,i.useCallback)((e=>{var t;const r=s(),i=st.default.state.stores,l=(0,tt.vg)({collectionViewBlockId:null===(t=o.collectionViewBlockStore())||void 0===t?void 0:t.id})?[]:i;!1===a||"indeterminate"===a?G.Z5({environment:n,stores:R.G0(l,r)}):!0===a&&G.Z5({environment:n,stores:R.zu(l,...r)}),e.stopPropagation()}),[a,o,n,s]),d=(0,X.VK)((()=>({...null==r?void 0:r.frozenStyles,...-1===(null==r?void 0:r.frozenIndex)?{background:void 0}:{}})),[null==r?void 0:r.frozenIndex,null==r?void 0:r.frozenStyles]);return(0,C.jsx)("div",{style:d,children:(0,C.jsx)(jc,{passesFilter:!0,checkedState:a,onClick:c,checkboxType:"group",collectionContextStore:o,frozoneProps:r?{...r,isCollectionViewBlockSelected:!1}:void 0,disabled:l})})}var Fc=o(846283),Nc=o(473060),Bc=o(918514),Ec=o(584169);function Ac(e){const{href:t,style:o}=e,r=(0,J.yK)((e=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:e.mediumTextColor}})),[]);return(0,C.jsxs)("a",{href:t,target:"_blank",style:{...r.default,...o},children:[(0,Ec.m)({width:14,marginRight:4}),(0,C.jsx)(P.FormattedMessage,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more"})]})}var Lc=o(971424);function Dc(e){const{origin:t,propertyType:o}=e,r=(0,Y.O7)();return(0,C.jsx)(yl.U,{origin:t,placementToOrigin:"bottom",header:function(){switch(o){case"owner":return(0,C.jsx)(P.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.ownerProperty",defaultMessage:"Owner"});case"verification":return(0,C.jsx)(P.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.verificationProperty",defaultMessage:"Verification"});case"tags":return(0,C.jsx)(P.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.tagsProperty",defaultMessage:"Add tags and more"});default:(0,he.t1)(o)}}(),content:function(){switch(o){case"owner":return(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Owners are responsible for keeping the page updated. By default, the owner is the page creator",id:"WikiPropertiesOnboardingTooltip.content.ownerProperty",values:{bold:e=>(0,C.jsx)("span",{style:{fontWeight:j.Z.fontWeight.semibold},children:e})}});case"verification":return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Page owners can mark a page as verified or expired, to help viewers understand whether they can trust the content",id:"WikiPropertiesOnboardingTooltip.content.verificationProperty"}),(0,C.jsx)(Ac,{href:(0,Bc.UY)("guides.wikis"),style:{color:rr.ZP.uiLightGray}})]});case"tags":return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Customize your wiki with tags or other database properties",id:"WikiPropertiesOnboardingTooltip.content.tagsProperty"}),(0,C.jsx)(Ac,{href:(0,Bc.UY)("guides.databaseProperties"),style:{color:rr.ZP.uiLightGray}})]});default:(0,he.t1)(o)}}(),numSteps:3,currStepIndex:function(){switch(o){case"owner":return 0;case"verification":return 1;case"tags":return 2;default:(0,he.t1)(o)}}(),onCloseClick:()=>{Nc.nX(r)},onPrimaryButtonClick:()=>Nc.Rg(r),onBackButtonClick:()=>Nc.FO(r),enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,pointerLength:Lc.EZ,pointerOffset:Lc.FD,style:{width:Lc.G5}})}var Zc=o(533125),Hc=o(134078),zc=o(627948),Kc=o(297820),Gc=o(243224),Wc=o(319124),Uc=o(67695),qc=o(12396),$c=o(379362),Qc=o(908597),Yc=o(388437),Xc=o(44643),Jc=o(844495),ed=o(16184),td=o(920669),od=o(204635),rd=o(923903),id=o(79310),nd=o(959753),sd=o(519889),ld=o(316956),ad=o(680402),cd=o(644866),dd=o(416536),ud=o(793174),pd=o(217095),hd=o(127871),md=o(171214),Sd=o(23159),gd=o(830905),fd=o(828992),Cd=o(974420),vd=o(942402),yd=o(896026);class xd extends s.Z{constructor(){super(...arguments),this.storeTypes={propertyTypeButtonPopupStore:ss.Z,inputStore:c.default.createClass("",{name:"inputStore"}),showPropertyDescriptionStore:c.default.createClass(!1,{name:"showPropertyDescriptionStore"})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyNameSubmit=e=>_d(e,this.environment,this.props.property,this.props.schema,this.props.collectionContextStore,this.stores.inputStore),this.isRightmostFrozenStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.frozoneStore.state.frozenIndex;return Boolean(this.props.columnIndex===t)})),this.canFreezeThisColumnStore=this.createComputedStore((()=>{const{collectionContextStore:e,columnIndex:t}=this.props,{frozenIndex:o,scrollerWidth:r}=e.frozoneStore.state,i=this.props.collectionContextStore.collectionViewStore();if(void 0===o)return!1;return t>((null==i?void 0:i.getTableMaxFrozenColumnIndex(r,e.normalizedFormatStore.state))??-1)}))}UNSAFE_willMountOrUpdate(e){const{property:t,schema:o,collectionContextStore:r}=e,i=o[t];if(i&&"relation"===i.type){const e=mc.ny(r,i);null==e||e.load()}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:Oe.og.ActionSheet}:{menuType:Oe.og.Popup,minWidth:220};const o=this.getMenuSections(this.props.parent);return(0,C.jsx)(Pe.Z,{...t,children:(0,C.jsx)(Re.Z,{type:Re.i.Vertical,initialFocus:void 0,sections:R.oA(o.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,C.jsx)(je.Z,{...e,topBorder:0!==t}),items:e}})))})})}getMenuSections(e){var t;const{property:o,schema:r,collectionContextStore:i,formatKey:n,allowHidingTitle:s,format:l,intl:a}=this.props,{environment:c,theme:d}=this,{device:u}=c,p=r[o],h=i.permissionScopesStore.state,m=i.isInHomeWidgetStore.state,S=i.settingsStore,f=i.collectionViewStore(),v=i.collectionStore();if(!f||!p)return[];const y=(0,si.w)(o),x=Boolean((null===(t=wd(this.props.format,this.props.formatKey,this.props.property))||void 0===t?void 0:t.wrap)||f.getFormat().table_wrap)&&"timeline"!==f.getType(),b=i.databaseType,w=Boolean(v&&b&&Q.cR((0,dd.appConfigs)(),b,o,v)),k="title"===p.type,T=[];if(y&&"person"===p.type){const e=[];T.push(e),e.push({key:"synced_person",render:e=>(0,C.jsx)(fd.Z,{...e,title:p.name||"",icon:(0,Jc.D)({width:14}),caption:(0,C.jsx)("div",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",minWidth:300,maxWidth:350},children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"People synced from external sources may require additional set up. Visit <helpcenterlink>the help center</helpcenterlink> for more information.",id:"database.tableHeaderCell.syncedPersonPropertyCaption",values:{helpcenterlink:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return(0,C.jsx)(vd.Z,{href:(0,Bc.UY)("guides.syncedContent"),children:t})}}})})}),action:()=>{}})}const _=[];if(T.push(_),h.canConfigureCollection&&!y&&!h.isExternallyImportedAndSyncedCollection){const t=Boolean(this.stores.showPropertyDescriptionStore.state);_.push({key:"rename",render:o=>(0,C.jsxs)(je.Z,{children:[(0,C.jsx)(md.I,{...o,initialValue:p.name||"",placeholder:We.default.formatMessage(zc.Z.inputPlaceholder),focusInitial:!0,inputStore:this.stores.inputStore,onBlur:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyNameSubmit,onSubmit:t=>{_d(t,this.environment,this.props.property,this.props.schema,this.props.collectionContextStore,this.stores.inputStore),e.close()},iconButton:{icon:e=>(0,C.jsx)(qc.ZP,{type:p.type,icon:p.icon,size:16,theme:d,style:e}),iconStyle:{fill:$c.Lr[d.mode].gray},enforceIconColor:"gray",onSubmit:(e,t)=>function(e,t,o,r,i){const n=t.collectionStore();if(!n)return;q.createAndCommit({userAction:"TableHeaderCell.handlePropertyIconSubmit",environment:o,perform:t=>{ld.OK({collectionStore:n,property:e,icon:r,transaction:t})}}),F.$q({environment:o,collectionContextStore:t,property:e,icon:r,from:"table",action:"change_icon"})}(this.props.property,this.props.collectionContextStore,this.environment,e)},inputRightButton:(0,C.jsx)(pd.l,{description:p.description,showTooltip:!t,onClick:()=>this.stores.showPropertyDescriptionStore.setState(!t),addDescriptionText:a.formatMessage(Gc.aB.addPropertyDescriptionTooltip),editDescriptionText:a.formatMessage(Gc.aB.editPropertyDescriptionTooltip)})}),Td(this.props.property,this.props.schema,this.stores.inputStore)&&(0,C.jsx)(Sd.Z,{propertyName:this.stores.inputStore.state,styles:u.isMobile?{paddingBottom:5,paddingLeft:16,paddingRight:16,margin:0,boxShadow:`inset 0 -1px 0 ${d.regularDividerColor}`}:{}})]}),action:()=>{F.wd({environment:this.environment,collectionContextStore:i,action:"table_header_rename"}),le.n1({collectionContextStore:i}),e.close()}}),t&&_.push({key:"description",render:e=>(0,C.jsx)(je.Z,{...e,desktopStyle:{paddingTop:0},title:u.isMobile?a.formatMessage(hd.k.descriptionHeader):void 0,children:(0,C.jsx)(hd.i,{initialDescription:p.description,handleSaveDescription:e=>function(e,t,o,r){var i;const n=o.collectionStore(),s=null==n||null===(i=n.getSchema())||void 0===i?void 0:i[r];if(!n||void 0===s||e===s.description)return;q.createAndCommit({userAction:"CollectionSettingsProperty.handleDescriptionChange",environment:t,perform:o=>{le.xO({environment:t,collectionStore:n,update:{[r]:{...s,description:e}},transaction:o})}}),F.$q({environment:t,collectionContextStore:o,property:r,from:"view_properties",action:"set_description"})}(e,this.environment,this.props.collectionContextStore,this.props.property),disableAutoSection:!0})}),action:R.ZT})}if(!h.canConfigureBlock||y||null!=v&&v.isNonEditableState()||h.isExternallyImportedAndSyncedCollection||_.push({key:"edit_property",render:e=>(0,C.jsx)(Jt.Z,{placement:Sc.u.Left,render:t=>(0,C.jsx)(Me.Z,{title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Edit property",id:"database.tableHeaderCell.editProperty"}),icon:(0,od.W)({width:14}),...(0,hr.Z)(e,t)}),style:{whiteSpace:"normal"},renderTooltip:()=>(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Edit property name, type, and other options...",id:"database.tableHeaderCell.editPropertyTooltip"})}),action:()=>{F.wd({environment:this.environment,collectionContextStore:i,action:"table_header_edit"}),le.n1({collectionContextStore:i}),e.close(),A.r$({collectionContextStore:i,collectionSettingsStore:S}),A.H4({collectionSettingsStore:S,item:{type:"properties",timelineViewTab:"table"}}),A.H4({collectionSettingsStore:S,item:{type:"property",formatKey:n,property:o}})}}),h.canConfigureCollection&&!y&&!h.isExternallyImportedAndSyncedCollection&&v&&(0,Wc.Zt)(this.environment)&&(0,ce.qQ)(p)&&("text"===p.type||(0,Wc.KZ)())){const t=(0,ce.q3)(p),r=we.De(v.getFormat(),o),s=r.isRunning||!v||!(0,Wc.mX)(c,yd.Z.getMode(c,v),v);t?_.push({key:"fill_all_pages",render:e=>(0,C.jsx)(Jt.Z,{placement:Sc.u.Left,renderTooltip:()=>(0,C.jsx)(gd.qQ,{collectionStore:v,propertySchema:p}),render:t=>(0,C.jsx)(Me.Z,{titleStyle:{color:s?d.lightTextColor:void 0},disabled:s,icon:(0,C.jsx)(gd.Xh,{updateAiInferencesTaskStatus:r,iconStyle:{marginLeft:-1,marginRight:-1},progressIconStyle:{marginTop:4,marginLeft:0,marginRight:-3}}),title:(0,C.jsx)(gd.ZP,{updateAiInferencesTaskStatus:r}),caption:void 0!==r.numPagesFilled&&void 0!==r.numPagesRequested&&(0,C.jsx)(gd.Y7,{updateAiInferencesTaskStatus:r}),...(0,hr.Z)(e,t)})}),action:async()=>{await cd.autofillPropertyForCollection({environment:c,collectionStore:v,propertySchema:p,property:o})}}):_.push({key:"autofill_with_ai",render:e=>(0,C.jsx)(Me.Z,{disabled:void 0===v,title:(0,C.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Set up AI autofill",id:"database.tableHeaderCell.autofillWithAI"}),(0,C.jsx)(Cd.Z,{style:{display:"inline-block"}})]}),icon:(0,td.y)({width:14,fill:d.aiPurpleColor}),...e}),action:()=>{v&&(e.close(),A.r$({collectionContextStore:i,collectionSettingsStore:S}),A.H4({collectionSettingsStore:S,item:{type:"properties",timelineViewTab:"table"}}),A.H4({collectionSettingsStore:S,item:{type:"property",formatKey:n,property:o}}),"text"===p.type&&A.H4({collectionSettingsStore:S,item:{type:"propertyAiAutofill",propertySchema:p,property:o}}))}})}if(h.canConfigureBlock&&((0,_a.bA)(p)||(0,_a.Kf)(p))){const t=[];T.push(t),(0,_a.bA)(p)&&(t.push({key:"sort_asc",render:e=>(0,C.jsx)(Me.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Sort ascending",id:"database.tableHeaderCell.sortAscending"}),icon:(0,Qc.Z)({width:14})}),action:()=>{F.wd({environment:this.environment,collectionContextStore:i,action:"table_header_sort_asc"}),e.close(),function(e,t,o,r){bd(!0,e,t,o,r)}(this.props.property,this.props.collectionContextStore,this.props.schema,this.environment)}}),t.push({key:"sort_desc",render:e=>(0,C.jsx)(Me.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Sort descending",id:"database.tableHeaderCell.sortDescending"}),icon:(0,Se.M)({width:14})}),action:()=>{F.wd({environment:this.environment,collectionContextStore:i,action:"table_header_sort_desc"}),e.close(),function(e,t,o,r){bd(!1,e,t,o,r)}(this.props.property,this.props.collectionContextStore,this.props.schema,this.environment)}})),(0,_a.Kf)(p)&&t.push({key:"filter",render:e=>(0,C.jsx)(Me.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Filter",id:"database.tableHeaderCell.filter"}),icon:(0,g.Q)({width:14})}),action:()=>{"collectionVirtualView"!==i.contextType&&(F.wd({environment:this.environment,collectionContextStore:i,action:"table_header_filter"}),e.close(),function(e,t,o,r){const i=t.currentPropertyFiltersStore.state,n=t.collectionViewBlockStore(),s=(null==n?void 0:n.getRecordModel)??nd.om.constant(void 0);let l=i.find((t=>{let{filter:o}=t;return o.property===e}));if(!l){const n=(0,ot.H_)({property:e,schema:o,getRecordModel:s});if(!n)return;const a={id:ue.Il(),filter:n};t.filtersBarOpenStore.setState(!0),B.iU({environment:r,collectionContextStore:t,temporaryState:{...t.temporaryStateStore.state,propertyFilters:{value:[...i,a]}}}),l=a}if(!l)return;const a=t.getFilterBarItemSettingsStore(l);A.wl({collectionSettingsStore:a,item:{type:"filter"}}),le.n1({collectionContextStore:t})}(this.props.property,this.props.collectionContextStore,this.props.schema,this.environment))}})}const V=[];if(T.push(V),(s||"title"!==p.type)&&h.canConfigureBlock&&V.push({key:"hide",render:e=>(0,C.jsx)(Me.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Hide in view",id:"database.tableHeaderCell.hideInView"}),icon:(0,Xc.L)({width:22,marginLeft:-4,marginRight:-4})}),action:()=>{F.wd({environment:this.environment,collectionContextStore:i,action:"table_header_hide"}),e.close(),function(e,t,o,r,i,n){const s=e.collectionViewStore();if(!s)return;const l=o[r]||[],a=l.map((e=>e.property===t?{...e,visible:!1}:e)),c={...o,[r]:a};q.createAndCommit({userAction:"TableHeaderCell.updatePropertyFormat",environment:n,perform:t=>{le.iG({collectionViewStore:s,update:{format:c},transaction:t}),ad.oz({environment:n,collectionContextStore:e,currentIndex:i,entrypoint:"TableHeaderCell",transaction:t,propertyAction:"hide"})}})}(this.props.collectionContextStore,this.props.property,this.props.format,this.props.formatKey,this.props.columnIndex,this.environment)}}),h.canConfigureBlock&&!m&&!u.isPhone){const e=this.canFreezeThisColumnStore.state;V.push({key:"freeze_column",render:t=>(0,C.jsx)(Jt.Z,{placement:Sc.u.Left,disableTooltip:!e,renderTooltip:e=>(0,C.jsx)(P.FormattedMessage,{...e,defaultMessage:"Insufficient space to freeze columns",id:"database.tableHeaderCell.freezePropertyTooltip",description:"If the width of the frozen columns is wider than the screen, show the user this tooltip warning."}),render:o=>(0,C.jsx)(Me.Z,{...t,...o,disabled:e,buttonStyle:{color:e?this.theme.text.quaternary:void 0},title:this.isRightmostFrozenStore.state?(0,C.jsx)(P.FormattedMessage,{defaultMessage:"{numberFrozenColumns, plural, one {Unfreeze column} other {Unfreeze columns}}",values:{numberFrozenColumns:this.props.columnIndex+1},id:"database.tableHeaderCell.unfreezeColumns"}):(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Freeze up to column",id:"database.tableHeaderCell.freezeUpToColumn"}),icon:this.isRightmostFrozenStore.state?(0,id.A)({width:14}):(0,rd.P)({width:12,margin:"0px 1px"})})}),action:()=>{!function(e,t,o){q.createAndCommit({userAction:"TableHeaderCell.handleFreezeColumns",environment:o,perform:r=>{ad.oz({environment:o,collectionContextStore:e,currentIndex:t,transaction:r,entrypoint:"TableHeaderCell",propertyAction:"toggle"})}})}(this.props.collectionContextStore,this.props.columnIndex,this.environment)}})}if(!It.Tr.includes(p.type)||(0,ce.dx)(p)||!h.canConfigureCollection||y||k||h.isExternallyImportedAndSyncedCollection||V.push({key:"duplicate",render:e=>(0,C.jsx)(Me.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Duplicate property",id:"database.tableHeaderCell.duplicateProperty"}),icon:(0,Yc.a)({width:14})}),action:async()=>{F.wd({environment:this.environment,collectionContextStore:i,action:"table_header_duplicate"}),e.close(),await async function(e,t,o,r,i,n){const s=wd(i,o,e),l=t.collectionStore(),a=t.collectionViewStore(),c=t.normalizedFormatStore.state[o]||[],d=null==l?void 0:l.getSpaceId();if(!(l&&a&&d&&s))return;const u=l.getSchema(),p=u[e];if(!p)return;const h=await(0,ae.xy)({environment:n,schema:u,property:e,properties:c,parentStore:l,spaceId:d});if(!h)return;const m=n.currentUser.id,S=m?{id:m,table:sd.KJ}:void 0,{automationActions:g}=await ud._1.load();q.createAndCommit({userAction:"TableHeaderCell.handleDuplicate",environment:n,perform:e=>{le.xO({environment:n,collectionStore:l,update:{[h.newProperty]:h.newPropertySchema},transaction:e}),ad.oz({environment:n,collectionContextStore:t,currentIndex:r,entrypoint:"TableHeaderCell",transaction:e,propertyAction:"duplicate"}),(0,he.$K)(h.automationUpdate)&&g.duplicateAutomation({actorPointer:S,environment:n,sourceAutomationStore:h.automationUpdate.sourceAutomationStore,targetAutomationId:h.automationUpdate.targetAutomationId,transaction:e}),o&&re.FH({stores:[a],update:{[o]:h.newProperties},transaction:e})}}),F.wd({environment:n,collectionContextStore:t,action:"duplicate_property",original_view_type:null==a?void 0:a.getType(),property_type:p.type})}(this.props.property,this.props.collectionContextStore,this.props.formatKey,this.props.columnIndex,this.props.format,this.environment)}}),!It.Tr.includes(p.type)||!h.canConfigureCollection||y||k||h.isExternallyImportedAndSyncedCollection||V.push({key:"delete",render:e=>(0,C.jsx)(Jt.Z,{placement:Sc.u.Left,disableTooltip:!w,renderTooltip:e=>(0,vi.A7)(b,e),render:t=>(0,C.jsx)(Me.Z,{...e,...t,disabled:w,disabledFeedback:w,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Delete property",id:"database.tableHeaderCell.deleteProperty"}),caption:this.environment.device.isMobile&&w?(0,vi.A7)(b):null,icon:w?(0,C.jsx)("div",{...t,children:(0,ed.Q)({width:14})}):(0,or.y)({width:14}),isRedOnHover:!0})}),action:async()=>{e.close(),await async function(e,t,o,r,i,n){await ld.TI({environment:i,collectionContextStore:e,property:t,handleDeleteAccept:()=>function(e,t,o,r,i){const n=o.collectionStore();if(!n)return;const s=n.getSchema()[e];q.createAndCommitAsync({environment:i,userAction:"TableHeaderCell.handleDeleteAccept",waitForServerCommit:!1,perform:async s=>{await ld.yV({environment:i,collectionStore:n,schema:t,property:e,transaction:s}),ad.oz({environment:i,collectionContextStore:o,currentIndex:r,entrypoint:"TableHeaderCell",transaction:s,propertyAction:"delete"})}}),s&&F.y9({environment:i,collectionContextStore:o,property_type:s.type,from:"table_column",property:e})}(t,o,e,r,i),theme:n,from:"table_column"})}(this.props.collectionContextStore,this.props.property,this.props.schema,this.props.columnIndex,this.environment,this.theme)}}),h.canConfigureBlock&&"timeline"!==f.getType()){const e=[];T.push(e),e.push({key:"wrap_cell",render:e=>(0,C.jsx)(fr.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Wrap column",id:"database.tableHeaderCell.wrapColumn"}),on:x}),action:()=>{ad.K4({currentValue:x,environment:this.environment,property:o,collectionViewStore:f,format:l,formatKey:n}),F.wd({environment:this.environment,collectionContextStore:i,action:"table_header_wrap_column"})}})}return T}}function bd(e,t,o,r,i){if(!r[t])return;const n=[{property:t,direction:e?"ascending":"descending"}];o.filtersBarOpenStore.setState(!0),B.iU({environment:i,collectionContextStore:o,temporaryState:{...o.temporaryStateStore.state,sorts:{value:n}}}),le.n1({collectionContextStore:o})}function wd(e,t,o){var r;return null===(r=e[t])||void 0===r?void 0:r.find((e=>e.property===o))}xd.displayName="TableHeaderCellMenu";const kd=(0,P.injectIntl)(xd);function Td(e,t,o){const r=o.state,i=Object.keys(t).find((o=>{var i;return o!==e&&(null===(i=t[o])||void 0===i?void 0:i.name)===r}));return Boolean(i)}function _d(e,t,o,r,i,n){if(Td(o,r,n))return;const s=i.collectionStore();if(!s)return;const l=s.getSchema()[o];(null==l?void 0:l.name)!==e&&(q.createAndCommit({userAction:"TableHeaderCell.handlePropertyNameSubmit",environment:t,perform:t=>{ld.Bv({collectionStore:s,property:o,name:e,transaction:t})}}),F.$q({environment:t,collectionContextStore:i,property:o,from:"view_settings",action:"rename"}))}const Vd=i.memo((function(e){const{allowHidingTitle:t,collectionContextStore:o,columnIndex:r,format:n,formatKey:s,parent:l,property:a,schema:c}=e,d=(0,P.useIntl)(),u=(0,Y.O7)(),{device:p}=u,h=(0,J.Fg)(),m=(0,X.VK)((()=>{const e=o.frozoneStore.state.frozenIndex;return Boolean(r===e)}),[o,r]),S=(0,X.VK)((()=>{const{frozenIndex:e,scrollerWidth:t}=o.frozoneStore.state,i=o.collectionViewStore();if(void 0===e)return!1;const n=(null==i?void 0:i.getTableMaxFrozenColumnIndex(t,o.normalizedFormatStore.state))??-1;return r>n}),[o,r]),f=(0,X.VK)((()=>o.permissionScopesStore.state),[o]),v=(0,X.VK)((()=>o.isInHomeWidgetStore.state),[o]),y=(0,X.VK)((()=>o.settingsStore),[o]),x=(0,X.VK)((()=>o.collectionViewStore()),[o]),b=(0,X.VK)((()=>o.collectionStore()),[o]),w=(0,X.VK)((()=>null==b?void 0:b.isNonEditableState()),[b]),k=(0,X.VK)((()=>null==b?void 0:b.getFormat()),[b]),T=(0,X.VK)((()=>{var e;return!!x&&(Boolean((null===(e=Md({format:n,formatKey:s,property:a}))||void 0===e?void 0:e.wrap)||x.getFormat().table_wrap)&&"timeline"!==x.getType())}),[x,n,s,a]),_=(0,X.VK)((()=>o.databaseType),[o]),V=(0,X.VK)((()=>null==x?void 0:x.getType()),[x]),O=(0,i.useMemo)((()=>k?we.De(k,a):null),[k,a]),M=(0,X.VK)((()=>(null==O?void 0:O.isRunning)||!b||!(0,Wc.mX)(u,yd.Z.getMode(u,b),b)),[b,u,O]),j=(0,X.VK)((()=>(0,Wc.Zt)(u)),[u]),I=(0,X.VK)((()=>(0,Wc.KZ)()),[]),[N,E]=(0,i.useState)(!1),[L,D]=(0,i.useState)("");(0,i.useEffect)((()=>{const e=c[a];e&&D(e.name||"")}),[]),(0,i.useEffect)((()=>{const e=c[a];if(e&&"relation"===e.type){const t=mc.ny(o,e);null==t||t.load()}}),[o,a,c]);const Z=(0,i.useCallback)((e=>{!function(e){const{collectionContextStore:t,environment:o,inputValue:r,name:i,property:n,schema:s}=e;if(Pd({property:n,schema:s,inputValue:r}))return;const l=t.collectionStore();if(!l)return;const a=l.getSchema(),c=a[n];if((null==c?void 0:c.name)===i)return;q.createAndCommit({userAction:"TableHeaderCell.handlePropertyNameSubmit",environment:o,perform:e=>{ld.Bv({collectionStore:l,property:n,name:i,transaction:e})}}),F.$q({environment:o,collectionContextStore:t,property:n,from:"view_settings",action:"rename"})}({collectionContextStore:o,environment:u,inputValue:L,name:e,property:a,schema:c})}),[o,u,L,a,c]),H=(0,i.useCallback)((e=>{D(e)}),[]),z=(0,X.VK)((()=>{const e=c[a];if(!x||!e)return[];const i=(0,si.w)(a),k=Boolean(b&&_&&Q.cR((0,dd.appConfigs)(),_,a,b)),D="title"===e.type,z=[];if(i&&"person"===e.type){const t=[];z.push(t),t.push({key:"synced_person",render:t=>(0,C.jsx)(fd.Z,{...t,title:e.name||"",icon:(0,Jc.D)({width:14}),caption:(0,C.jsx)("div",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",minWidth:300,maxWidth:350},children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"People synced from external sources may require additional set up. Visit <helpcenterlink>the help center</helpcenterlink> for more information.",id:"database.tableHeaderCell.syncedPersonPropertyCaption",values:{helpcenterlink:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return(0,C.jsx)(vd.Z,{href:(0,Bc.UY)("guides.syncedContent"),children:t})}}})})}),action:()=>{}})}const K=[];if(z.push(K),!f.canConfigureCollection||i||f.isExternallyImportedAndSyncedCollection||(K.push({key:"rename",render:t=>(0,C.jsxs)(je.Z,{children:[(0,C.jsx)(md.I,{...t,initialValue:e.name||"",placeholder:We.default.formatMessage(zc.Z.inputPlaceholder),focusInitial:!0,onChange:H,onBlur:Z,onSubmit:Z,iconButton:{icon:t=>(0,C.jsx)(qc.ZP,{type:e.type,icon:e.icon,size:16,theme:h,style:t}),iconStyle:{fill:$c.Lr[h.mode].gray},enforceIconColor:"gray",onSubmit:(e,t)=>function(e,t,o,r,i){const n=t.collectionStore();if(!n)return;q.createAndCommit({userAction:"TableHeaderCell.handlePropertyIconSubmit",environment:o,perform:t=>{ld.OK({collectionStore:n,property:e,icon:r,transaction:t})}}),F.$q({environment:o,collectionContextStore:t,property:e,icon:r,from:"table",action:"change_icon"})}(a,o,u,e)},inputRightButton:(0,C.jsx)(pd.l,{description:e.description,showTooltip:!N,onClick:()=>E(!N),addDescriptionText:d.formatMessage(Gc.aB.addPropertyDescriptionTooltip),editDescriptionText:d.formatMessage(Gc.aB.editPropertyDescriptionTooltip)})}),Pd({property:a,schema:c,inputValue:L})&&(0,C.jsx)(Sd.Z,{propertyName:L,styles:p.isMobile?{paddingBottom:5,paddingLeft:16,paddingRight:16,margin:0,boxShadow:`inset 0 -1px 0 ${h.regularDividerColor}`}:{}})]}),action:()=>{F.wd({environment:u,collectionContextStore:o,action:"table_header_rename"}),le.n1({collectionContextStore:o}),l.close()}}),N&&K.push({key:"description",render:t=>(0,C.jsx)(je.Z,{...t,desktopStyle:{paddingTop:0},title:p.isMobile?d.formatMessage(hd.k.descriptionHeader):void 0,children:(0,C.jsx)(hd.i,{initialDescription:e.description,handleSaveDescription:e=>function(e){var t;const{collectionContextStore:o,description:r,environment:i,property:n}=e,s=o.collectionStore(),l=null==s||null===(t=s.getSchema())||void 0===t?void 0:t[n];if(!s||void 0===l||r===l.description)return;q.createAndCommit({userAction:"CollectionSettingsProperty.handleDescriptionChange",environment:i,perform:e=>{le.xO({environment:i,collectionStore:s,update:{[n]:{...l,description:r}},transaction:e})}}),F.$q({environment:i,collectionContextStore:o,property:n,from:"view_properties",action:"set_description"})}({collectionContextStore:o,description:e,environment:u,property:a}),disableAutoSection:!0})}),action:R.ZT})),!f.canConfigureBlock||i||w||f.isExternallyImportedAndSyncedCollection||K.push({key:"edit_property",render:e=>(0,C.jsx)(Jt.Z,{placement:Sc.u.Left,render:t=>(0,C.jsx)(Me.Z,{title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Edit property",id:"database.tableHeaderCell.editProperty"}),icon:(0,od.W)({width:14}),...(0,hr.Z)(e,t)}),style:{whiteSpace:"normal"},renderTooltip:()=>(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Edit property name, type, and other options...",id:"database.tableHeaderCell.editPropertyTooltip"})}),action:()=>{F.wd({environment:u,collectionContextStore:o,action:"table_header_edit"}),le.n1({collectionContextStore:o}),l.close(),A.r$({collectionContextStore:o,collectionSettingsStore:y}),A.H4({collectionSettingsStore:y,item:{type:"properties",timelineViewTab:"table"}}),A.H4({collectionSettingsStore:y,item:{type:"property",formatKey:s,property:a}})}}),f.canConfigureCollection&&!i&&!f.isExternallyImportedAndSyncedCollection&&b&&O&&j&&(0,ce.qQ)(e)&&("text"===e.type||I)){(0,ce.q3)(e)?K.push({key:"fill_all_pages",render:t=>(0,C.jsx)(Jt.Z,{placement:Sc.u.Left,renderTooltip:()=>(0,C.jsx)(gd.qQ,{collectionStore:b,propertySchema:e}),render:e=>(0,C.jsx)(Me.Z,{titleStyle:{color:M?h.lightTextColor:void 0},disabled:M,icon:(0,C.jsx)(gd.Xh,{updateAiInferencesTaskStatus:O,iconStyle:{marginLeft:-1,marginRight:-1},progressIconStyle:{marginTop:4,marginLeft:0,marginRight:-3}}),title:(0,C.jsx)(gd.ZP,{updateAiInferencesTaskStatus:O}),caption:void 0!==O.numPagesFilled&&void 0!==O.numPagesRequested&&(0,C.jsx)(gd.Y7,{updateAiInferencesTaskStatus:O}),...(0,hr.Z)(t,e)})}),action:async()=>{await cd.autofillPropertyForCollection({environment:u,collectionStore:b,propertySchema:e,property:a})}}):K.push({key:"autofill_with_ai",render:e=>(0,C.jsx)(Me.Z,{disabled:void 0===b,title:(0,C.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Set up AI autofill",id:"database.tableHeaderCell.autofillWithAI"}),(0,C.jsx)(Cd.Z,{style:{display:"inline-block"}})]}),icon:(0,td.y)({width:14,fill:h.aiPurpleColor}),...e}),action:()=>{b&&(l.close(),A.r$({collectionContextStore:o,collectionSettingsStore:y}),A.H4({collectionSettingsStore:y,item:{type:"properties",timelineViewTab:"table"}}),A.H4({collectionSettingsStore:y,item:{type:"property",formatKey:s,property:a}}),"text"===e.type&&A.H4({collectionSettingsStore:y,item:{type:"propertyAiAutofill",propertySchema:e,property:a}}))}})}if(f.canConfigureBlock&&((0,_a.bA)(e)||(0,_a.Kf)(e))){const t=[];z.push(t),(0,_a.bA)(e)&&(t.push({key:"sort_asc",render:e=>(0,C.jsx)(Me.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Sort ascending",id:"database.tableHeaderCell.sortAscending"}),icon:(0,Qc.Z)({width:14})}),action:()=>{F.wd({environment:u,collectionContextStore:o,action:"table_header_sort_asc"}),l.close(),function(e){const{property:t,collectionContextStore:o,schema:r,environment:i}=e;Od({collectionContextStore:o,environment:i,isAscending:!0,property:t,schema:r})}({collectionContextStore:o,environment:u,property:a,schema:c})}}),t.push({key:"sort_desc",render:e=>(0,C.jsx)(Me.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Sort descending",id:"database.tableHeaderCell.sortDescending"}),icon:(0,Se.M)({width:14})}),action:()=>{F.wd({environment:u,collectionContextStore:o,action:"table_header_sort_desc"}),l.close(),function(e){const{property:t,collectionContextStore:o,schema:r,environment:i}=e;Od({collectionContextStore:o,environment:i,isAscending:!1,property:t,schema:r})}({collectionContextStore:o,environment:u,property:a,schema:c})}})),(0,_a.Kf)(e)&&t.push({key:"filter",render:e=>(0,C.jsx)(Me.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Filter",id:"database.tableHeaderCell.filter"}),icon:(0,g.Q)({width:14})}),action:()=>{"collectionVirtualView"!==o.contextType&&(F.wd({environment:u,collectionContextStore:o,action:"table_header_filter"}),l.close(),function(e){const{collectionContextStore:t,environment:o,property:r,schema:i}=e,n=t.currentPropertyFiltersStore.state,s=t.collectionViewBlockStore(),l=(null==s?void 0:s.getRecordModel)??nd.om.constant(void 0);let a=n.find((e=>{let{filter:t}=e;return t.property===r}));if(!a){const e=(0,ot.H_)({property:r,schema:i,getRecordModel:l});if(!e)return;const s={id:ue.Il(),filter:e};t.filtersBarOpenStore.setState(!0),B.iU({environment:o,collectionContextStore:t,temporaryState:{...t.temporaryStateStore.state,propertyFilters:{value:[...n,s]}}}),a=s}if(!a)return;const c=t.getFilterBarItemSettingsStore(a);A.wl({collectionSettingsStore:c,item:{type:"filter"}}),le.n1({collectionContextStore:t})}({collectionContextStore:o,environment:u,property:a,schema:c}))}})}const G=[];if(z.push(G),(t||"title"!==e.type)&&f.canConfigureBlock&&G.push({key:"hide",render:e=>(0,C.jsx)(Me.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Hide in view",id:"database.tableHeaderCell.hideInView"}),icon:(0,Xc.L)({width:22,marginLeft:-4,marginRight:-4})}),action:()=>{F.wd({environment:u,collectionContextStore:o,action:"table_header_hide"}),l.close(),function(e){const{collectionContextStore:t,columnIndex:o,environment:r,format:i,formatKey:n,property:s}=e,l=t.collectionViewStore();if(!l)return;const a=i[n]||[],c=a.map((e=>e.property===s?{...e,visible:!1}:e)),d={...i,[n]:c};q.createAndCommit({userAction:"TableHeaderCell.updatePropertyFormat",environment:r,perform:e=>{le.iG({collectionViewStore:l,update:{format:d},transaction:e}),ad.oz({environment:r,collectionContextStore:t,currentIndex:o,entrypoint:"TableHeaderCell",transaction:e,propertyAction:"hide"})}})}({collectionContextStore:o,columnIndex:r,environment:u,format:n,formatKey:s,property:a})}}),!f.canConfigureBlock||v||p.isPhone||G.push({key:"freeze_column",render:e=>(0,C.jsx)(Jt.Z,{placement:Sc.u.Left,disableTooltip:!S,renderTooltip:e=>(0,C.jsx)(P.FormattedMessage,{...e,defaultMessage:"Insufficient space to freeze columns",id:"database.tableHeaderCell.freezePropertyTooltip",description:"If the width of the frozen columns is wider than the screen, show the user this tooltip warning."}),render:t=>(0,C.jsx)(Me.Z,{...e,...t,disabled:S,buttonStyle:{color:S?h.text.quaternary:void 0},title:m?(0,C.jsx)(P.FormattedMessage,{defaultMessage:"{numberFrozenColumns, plural, one {Unfreeze column} other {Unfreeze columns}}",values:{numberFrozenColumns:r+1},id:"database.tableHeaderCell.unfreezeColumns"}):(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Freeze up to column",id:"database.tableHeaderCell.freezeUpToColumn"}),icon:m?(0,id.A)({width:14}):(0,rd.P)({width:12,margin:"0px 1px"})})}),action:()=>{!function(e){const{collectionContextStore:t,columnIndex:o,environment:r}=e;q.createAndCommit({userAction:"TableHeaderCell.handleFreezeColumns",environment:r,perform:e=>{ad.oz({environment:r,collectionContextStore:t,currentIndex:o,transaction:e,entrypoint:"TableHeaderCell",propertyAction:"toggle"})}})}({collectionContextStore:o,columnIndex:r,environment:u})}}),!It.Tr.includes(e.type)||(0,ce.dx)(e)||!f.canConfigureCollection||i||D||f.isExternallyImportedAndSyncedCollection||G.push({key:"duplicate",render:e=>(0,C.jsx)(Me.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Duplicate property",id:"database.tableHeaderCell.duplicateProperty"}),icon:(0,Yc.a)({width:14})}),action:async()=>{F.wd({environment:u,collectionContextStore:o,action:"table_header_duplicate"}),l.close(),await async function(e){const{collectionContextStore:t,columnIndex:o,environment:r,format:i,formatKey:n,property:s}=e,l=Md({format:i,formatKey:n,property:s}),a=t.collectionStore(),c=t.collectionViewStore(),d=t.normalizedFormatStore.state[n]||[],u=null==a?void 0:a.getSpaceId();if(!(a&&c&&u&&l))return;const p=a.getSchema(),h=p[s];if(!h)return;const m=await(0,ae.xy)({environment:r,schema:p,property:s,properties:d,parentStore:a,spaceId:u});if(!m)return;const S=r.currentUser.id,g=S?{id:S,table:sd.KJ}:void 0,{automationActions:f}=await ud._1.load();q.createAndCommit({userAction:"TableHeaderCell.handleDuplicate",environment:r,perform:e=>{le.xO({environment:r,collectionStore:a,update:{[m.newProperty]:m.newPropertySchema},transaction:e}),ad.oz({environment:r,collectionContextStore:t,currentIndex:o,entrypoint:"TableHeaderCell",transaction:e,propertyAction:"duplicate"}),(0,he.$K)(m.automationUpdate)&&f.duplicateAutomation({actorPointer:g,environment:r,sourceAutomationStore:m.automationUpdate.sourceAutomationStore,targetAutomationId:m.automationUpdate.targetAutomationId,transaction:e}),n&&re.FH({stores:[c],update:{[n]:m.newProperties},transaction:e})}}),F.wd({environment:r,collectionContextStore:t,action:"duplicate_property",original_view_type:null==c?void 0:c.getType(),property_type:h.type})}({collectionContextStore:o,columnIndex:r,environment:u,format:n,formatKey:s,property:a})}}),!It.Tr.includes(e.type)||!f.canConfigureCollection||i||D||f.isExternallyImportedAndSyncedCollection||G.push({key:"delete",render:e=>(0,C.jsx)(Jt.Z,{placement:Sc.u.Left,disableTooltip:!k,renderTooltip:e=>(0,vi.A7)(_,e),render:t=>(0,C.jsx)(Me.Z,{...e,...t,disabled:k,disabledFeedback:k,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Delete property",id:"database.tableHeaderCell.deleteProperty"}),caption:u.device.isMobile&&k?(0,vi.A7)(_):null,icon:k?(0,C.jsx)("div",{...t,children:(0,ed.Q)({width:14})}):(0,or.y)({width:14}),isRedOnHover:!0})}),action:async()=>{l.close(),await async function(e){const{collectionContextStore:t,columnIndex:o,environment:r,property:i,schema:n,theme:s}=e;await ld.TI({environment:r,collectionContextStore:t,property:i,handleDeleteAccept:()=>function(e){const{collectionContextStore:t,columnIndex:o,environment:r,property:i,schema:n}=e,s=t.collectionStore();if(!s)return;const l=s.getSchema()[i];q.createAndCommitAsync({environment:r,userAction:"TableHeaderCell.handleDeleteAccept",waitForServerCommit:!1,perform:async e=>{await ld.yV({environment:r,collectionStore:s,schema:n,property:i,transaction:e}),ad.oz({environment:r,collectionContextStore:t,currentIndex:o,entrypoint:"TableHeaderCell",transaction:e,propertyAction:"delete"})}}),l&&F.y9({environment:r,collectionContextStore:t,property_type:l.type,from:"table_column",property:i})}({collectionContextStore:t,columnIndex:o,environment:r,property:i,schema:n}),theme:s,from:"table_column"})}({collectionContextStore:o,columnIndex:r,environment:u,property:a,schema:c,theme:h})}}),f.canConfigureBlock&&"timeline"!==V){const e=[];z.push(e),e.push({key:"wrap_cell",render:e=>(0,C.jsx)(fr.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Wrap column",id:"database.tableHeaderCell.wrapColumn"}),on:T}),action:()=>{ad.K4({currentValue:T,environment:u,property:a,collectionViewStore:x,format:n,formatKey:s}),F.wd({environment:u,collectionContextStore:o,action:"table_header_wrap_column"})}})}return z}),[t,S,o,y,b,x,r,_,p.isMobile,p.isPhone,u,n,s,H,Z,L,d,M,j,v,w,m,I,l,f.canConfigureBlock,f.canConfigureCollection,f.isExternallyImportedAndSyncedCollection,a,c,N,O,h,V,T]);let K;return K=p.isMobile?{menuType:Oe.og.ActionSheet}:{menuType:Oe.og.Popup,minWidth:220},(0,C.jsx)(Pe.Z,{...K,children:(0,C.jsx)(Re.Z,{type:Re.i.Vertical,initialFocus:void 0,sections:R.oA(z.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,C.jsx)(je.Z,{...e,topBorder:0!==t}),items:e}})))})})}));function Od(e){const{collectionContextStore:t,environment:o,isAscending:r,property:i,schema:n}=e;if(!n[i])return;const s=[{property:i,direction:r?"ascending":"descending"}];t.filtersBarOpenStore.setState(!0),B.iU({environment:o,collectionContextStore:t,temporaryState:{...t.temporaryStateStore.state,sorts:{value:s}}}),le.n1({collectionContextStore:t})}function Md(e){var t;const{format:o,formatKey:r,property:i}=e;return null===(t=o[r])||void 0===t?void 0:t.find((e=>e.property===i))}function Pd(e){const{inputValue:t,property:o,schema:r}=e,i=Object.keys(r).find((e=>{var i;return e!==o&&(null===(i=r[e])||void 0===i?void 0:i.name)===t}));return Boolean(i)}const Rd={fontSize:14},jd=i.memo((function(e){let{allowHidingTitle:t,collectionContextStore:o,columnIndex:r,disableCellRightBorder:n,disabled:s,format:l,formatKey:a,isLast:c,paddingTop:d,property:u,renderSpacer:p,schema:h,width:m}=e;const S=(0,i.useRef)(null);(0,Zc.c)(Uc.Z,(()=>({collectionContextStore:o,property:u,getNode:()=>S.current})),[o,u]);const g=(0,Y.O7)(),f=(0,Y.Fy)(),[v,y]=(0,i.useState)(!1),x=(0,X.VK)((()=>o.permissionScopesStore.state),[o.permissionScopesStore]),b=(0,X.qz)(void 0,ss.Z),{isRightMostFrozenColumn:w,isScrolled:k}=(0,X.VK)((()=>{const{frozenIndex:e,isScrolled:t}=o.frozoneStore.state;return{isRightMostFrozenColumn:e===r,isScrolled:t}}),[o.frozoneStore,r]),T=(0,X.VK)((()=>$e.default.checkGate({gateName:"functional_table_header_cell_menu"})),[]),_=(0,J.yK)((e=>({div:{display:"flex",flexShrink:0,overflow:"hidden",fontSize:14,padding:0,width:m,borderRight:n?void 0:`1px solid ${e.tableDividerColor}`},description:{color:e.mediumInvertedTextColor},aiUpdate:{color:e.mediumInvertedTextColor}})),[m,n]),V=(0,i.useCallback)((()=>{U.ZH({debug:{userAction:"TableHeaderCell.handleClick"},environment:g}),G.ZH({debug:{userAction:"TableHeaderCell.handleClick"},environment:g}),le.wG()}),[g]),O=(0,i.useCallback)((e=>{f.isMobile||(e.preventDefault(),(0,ye.ZP)({event:e,context:ye.Af.EditorContextMenu,callback:()=>{V(),b.setState({open:!0})}}))}),[f,b,V]),M=(0,i.useCallback)((e=>{y(e)}),[y]),R=h[u];return R?(0,C.jsx)("div",{ref:S,style:_.div,className:dt.VMO,onContextMenu:O,children:(0,C.jsx)(Te.ZP,{popupType:f.isMobile?Ve.kQ.SlideUp:Ve.kQ.Popup,disabled:!x.canConfigureBlock,originGap:1,alignmentToOrigin:Te.vR.Start,buttonPopupStore:b,renderOrigin:e=>(0,C.jsx)(Jt.Z,{renderTooltip:e=>{const t=(0,ce.qQ)(R)&&("text"===R.type||(0,Wc.KZ)())&&(0,ce.q3)(R);return(0,C.jsxs)("div",{...e,style:Gc.F6,children:[(0,C.jsx)("div",{children:R.name}),void 0!==(null==R?void 0:R.description)&&R.description.length>0?(0,C.jsx)("div",{style:_.description,children:R.description}):null,t&&t.auto_update_on_edit&&(0,C.jsx)("div",{style:_.aiUpdate,children:(0,C.jsx)(P.FormattedMessage,{...zc.Z.keptUpToDateWithNotionAITooltip})})]})},delayThreshold:v?0:500,placement:Sc.u.Right,render:t=>{var o;return(0,C.jsxs)(xe.Z,{style:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:8,paddingRight:8,paddingTop:d},disabled:s,...(0,hr.Z)(t,e),children:[p&&p(c),(0,C.jsx)(Kc.Z,{propertySchema:R,showIcon:!0,badge:(0,C.jsxs)(C.Fragment,{children:[!(null===(o=R.description)||void 0===o||!o.length)&&!f.isMobile&&(0,C.jsx)(Hc.Z,{setIsHovered:M}),(0,C.jsx)(Kc.o,{propertySchema:R})]}),style:Rd,property:u}),w&&(0,C.jsx)(Rc,{isCollectionViewBlockSelected:!1,passesFilter:!0,isScrolled:Boolean(k)})]})}}),render:e=>T?(0,C.jsx)(Vd,{allowHidingTitle:t,collectionContextStore:o,columnIndex:r,format:l,formatKey:a,property:u,schema:h,parent:e}):(0,C.jsx)(kd,{allowHidingTitle:t,collectionContextStore:o,columnIndex:r,format:l,formatKey:a,property:u,schema:h,parent:e}),onClick:V})}):null}));var Id=o(435011),Fd=o(358299);const Nd={position:"absolute",right:0,width:0,flexGrow:0,zIndex:1};function Bd(e){let{leftFormat:t,height:o,onTemporaryResize:r,onAccept:n,onCancel:s,propertySchema:l,resultStore:a}=e;const c=(0,i.useRef)(void 0),d=c.current,u=(0,Y.Fy)(),[p,h]=(0,i.useState)(!1),[m,S]=(0,i.useState)(!1),g=(m||p)&&!u.isPhone,f=(0,i.useCallback)((e=>{if(d&&d.width){const o=Math.max(d.width+e.diffX,Zd(l,t,d.width,e.optionKey));return{...d,width:o}}}),[t,l,d]),v=(0,i.useCallback)((e=>{e.preventDefault(),c.current=t,S(!0)}),[t]),y=(0,i.useCallback)((e=>{const t=f(e);t&&r(t)}),[f,r]),x=(0,i.useCallback)((e=>{const t=f(e);t&&n(t),S(!1)}),[f,n]),b=(0,i.useCallback)((()=>{s(),c.current=void 0,S(!1)}),[s]),w=(0,i.useCallback)((e=>{const o=a.state?a.state.blockIds:[],r=R.oA(o.map((e=>{const o=Fd.Z.findBlockPropertyValueByBlockId(e,t.property),r=null==o?void 0:o.getNode();if(r)return function(e){const t=e.cloneNode(!0);let o=!1;"relative"===(null==e?void 0:e.style.position)&&(e.style.position="unset",o=!0);const r=getComputedStyle(e);for(let s=0;s<r.length;s++){const e=r[s],o=r.getPropertyValue(e);t.style[e]=o}o&&(e.style.position="relative");t.id="notion-table-view-cell-shadow",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.width="auto",t.style.opacity="0",t.style.display="flex",t.style.position="absolute";const i=t.querySelectorAll("*");for(const s of i)s.style&&(s.style.pointerEvents="none",s.style.width="auto");document.body.appendChild(t);const n=t.getBoundingClientRect();return t.remove(),null!=n&&n.width?Math.ceil(n.width)+1:void 0}(r)})));if(t.width){const e={...t,width:Math.min(800,Math.max(Math.max(...r),Zd(l,t,t.width)))};n(e)}}),[t,n,l,a]),k=(0,i.useCallback)((e=>(0,C.jsx)("div",{style:g?zd(o):Hd(o),onDoubleClick:w,...e})),[w,o,g]);return(0,C.jsx)("div",{style:Nd,onMouseMove:()=>h(!0),onMouseLeave:()=>h(!1),children:(0,C.jsx)(Rl.Z,{onDraggableDragStart:v,onDraggableDragMove:y,onDraggableDragEnd:x,onDraggableDragCancel:b,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:k})})}const Ed=i.memo(Bd);const Ad=32,Ld=64,Dd=100;function Zd(e,t,o){if(arguments.length>3&&void 0!==arguments[3]&&arguments[3])return Ad;const r=function(e,t){if("checkbox"===(null==e?void 0:e.type))return Ad;if("status"===(null==e?void 0:e.type)&&"checkbox"===t.statusShowAs)return Ad;var o;if(("number"===(null==e?void 0:e.type)||"formula"===(null==e?void 0:e.type)&&"number"===(0,Id.mm)(e))&&"ring"===(null==e||null===(o=e.show_as)||void 0===o?void 0:o.type))return Ad;if("auto_increment_id"===(null==e?void 0:e.type))return Ld;return Dd}(e,t);return o&&o<r?Ad:r}function Hd(e){return{width:5,marginLeft:-3,marginTop:-1,height:e,transition:"background 200ms ease-out",background:rr.ZP.blueWithAlpha(0),cursor:"col-resize"}}function zd(e){return{...Hd(e),background:rr.ZP.blueWithAlpha(.8)}}function Kd(e){let{store:t,collectionContextStore:o,schema:r,query:n,disabled:s,formatKey:l,disableCellRightBorder:a,renderSpacer:c,allowHidingTitle:d,paddingTop:p,showRightActions:h,showPropertyFormats:m,resultStore:S,format:g,tableStore:f,height:v,groupsPointer:y,property:x,index:b,isLast:w}=e;const k=(0,Y.O7)(),T=(0,Y.Fy)(),_=(0,i.useRef)(null),V=(0,X.VK)((()=>f.getCurrentFormat(g)),[g,f]),O=m[b],{wikiOnboardingPhase:M,showWikiTooltip:P}=(0,X.VK)((()=>{var e,i,n,s;const l=Nc.B1(),a=(null===(e=o.collectionStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("app_config_uri").getValue())===u.GZ&&t.isCollectionViewPageWithContent()&&t.id===(null===(i=o.collectionViewBlockStore())||void 0===i?void 0:i.id),c=a&&x===Fc.k.Owner&&"owner"===l,d=a&&"verification"===(null===(n=r[x])||void 0===n?void 0:n.type)&&"verification"===l,p=a&&"multi_select"===(null===(s=r[x])||void 0===s?void 0:s.type)&&"tags"===l;return{wikiOnboardingPhase:l,showWikiTooltip:!T.isMobile&&(c||d||p)}}),[o,T.isMobile,x,r,t]),R=(0,X.VK)((()=>a||w&&!ac(s,h)),[a,s,w,h]),j=(0,X.VK)((()=>(0,tt.vf)({environment:k,propertyFormat:O})),[k,O]);return(0,C.jsxs)("div",{style:{display:"flex",position:"relative"},ref:P?_:null,children:[P&&(0,C.jsx)(Dc,{origin:_,propertyType:M}),O&&j&&(0,C.jsx)(jd,{format:V,schema:r,query:n,property:x,width:j,collectionViewBlockStore:t,collectionContextStore:o,disabled:s,formatKey:l,isLast:w,disableCellRightBorder:R,allowHidingTitle:d,renderSpacer:c,paddingTop:p,columnIndex:b,groupsPointer:y}),!s&&!T.isPhone&&(0,C.jsx)(Ed,{leftFormat:O,onTemporaryResize:e=>function(e,t,o,r){t.setState({...t.state,temporaryFormat:Gd(e,o,r,t)})}(e,f,l,V),onAccept:e=>function(e,t,o,r,i,n){const s=t.collectionViewStore();if(!s)return;const l=i.getCurrentFormat(r),a=i.getCurrentProperties(o,r).map((t=>t.property===e.property?e:t)),c={...l,[o]:a};q.createAndCommit({userAction:"TableHeaderRow.handleColumnResizeAccept",environment:n,perform:e=>{le.iG({collectionViewStore:s,update:{format:c},transaction:e})}}),i.setState({...i.state,temporaryFormat:void 0}),F.wd({environment:n,collectionContextStore:t,action:"table_resize_columns"})}(e,o,l,V,f,k),onCancel:()=>function(e){e.setState({...e.state,temporaryFormat:void 0})}(f),height:v,propertySchema:r[x],resultStore:S})]},x)}function Gd(e,t,o,r){const i=r.getCurrentFormat(o),n=r.getCurrentProperties(t,i).map((t=>t.property===e.property?e:t));return{...i,[t]:n}}function Wd(e,t,o,r,i,n){const s=t.collectionViewStore();if(!s)return;const l={...i.getCurrentFormat(r),[o]:R.MR(i.getCurrentProperties(o,r),(t=>{const o=e.indexOf(t.property);return o>=0?o:1/0}))};q.createAndCommit({userAction:"TableHeaderRow.handleColumnReorder",environment:n,perform:e=>{le.iG({collectionViewStore:s,update:{format:l},transaction:e})}}),F.wd({environment:n,collectionContextStore:t,action:"table_reorder_columns"})}const Ud=c.default.createClass(void 0,{name:"ReducerResultStore"}),qd=i.memo((function(e){let{store:t,disabled:o,showRightActions:r,disableCellRightBorder:i,disableHorizontalEdgeScroll:n,collectionContextStore:s,frozoneProps:l,height:a,minWidth:c,isInPeekRenderer:d,isInHomeWidget:u,disableTopBorder:p,groupFormat:h,showPropertyFormats:m,format:S,formatKey:g,tableStore:f,resultStore:v,allowHidingTitle:y,renderSpacer:x,paddingTop:b,query:w,schema:k,children:T}=e;const _=(0,Y.O7)(),V=(0,J.Fg)(),O=(0,X.VK)((()=>(0,ae.fk)({environment:_,collectionContextStore:s})),[s,_]),P=(0,X.qz)(v,Ud),R=(0,X.VK)((()=>h?[h]:[]),[h],{useDeepEqual:!0}),j=(0,X.VK)((()=>function(e,t,o,r,i,n,s){var l;const a=e.collectionViewStore();if(!a)return{};const c=n?"transparent":(null===(l=e.inheritedBlockColorStore.state)||void 0===l?void 0:l.background)||(t?i.cardContentBackground:i.contentBackground),d=n?i.tableHomeDividerColor:i.tableDividerColor;return{display:"flex",position:"absolute",background:c,zIndex:M.bF,height:o-1,color:i.mediumTextColor,borderTop:s?void 0:`1px solid ${d}`,boxShadow:`\n\t\t\t-3px 0 0 ${c},\n\t\t\t0 1px 0 ${d}\n\t\t`,minWidth:r,left:"timeline"===a.getType()?void 0:0,right:"timeline"===a.getType()?void 0:0}}(s,d,a,c,V,u,p)),[s,p,a,u,d,c,V]),I=(0,X.VK)((()=>ac(o,r)),[o,r]);return(0,C.jsx)(Ur,{position:Fr(u),children:(0,C.jsxs)("div",{className:dt.kUP,style:j,children:[O&&(0,C.jsx)(Ic,{groupsPointer:R,collectionContextStore:s,frozoneProps:l}),(0,C.jsx)($d,{showRightActions:r,store:t,collectionContextStore:s,schema:k,query:w,disabled:o,formatKey:g,disableCellRightBorder:i,renderSpacer:x,allowHidingTitle:y,paddingTop:b,frozoneProps:l,disableHorizontalEdgeScroll:n,showMultiSelectCheckbox:O,showPropertyFormats:m,format:S,height:a,tableStore:f,groupsPointer:R,resultStore:P}),I&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(Vc,{collectionContextStore:s}),(0,C.jsx)(Oc,{collectionContextStore:s})]}),T]})})}));function $d(e){let{disabled:t,collectionContextStore:o,disableCellRightBorder:r,disableHorizontalEdgeScroll:n,showMultiSelectCheckbox:s,formatKey:l,format:a,schema:c,query:d,tableStore:u,showPropertyFormats:p,allowHidingTitle:h,showRightActions:m,height:S,frozoneProps:g,groupsPointer:f,resultStore:v,paddingTop:y,renderSpacer:x,store:b}=e;const w=(0,Y.O7)(),k=(0,X.VK)((()=>o.permissionScopesStore.state.canConfigureBlock),[o]),T=(0,X.VK)((()=>p.map((e=>e.property))),[p],{useDeepEqual:!0}),_=(0,i.useCallback)(((e,i,n)=>(0,C.jsx)(Kd,{collectionContextStore:o,store:b,schema:c,query:d,disabled:t,format:a,formatKey:l,allowHidingTitle:h,showPropertyFormats:p,resultStore:v,showRightActions:m,disableCellRightBorder:r,renderSpacer:x,paddingTop:y,tableStore:u,groupsPointer:f,height:S,property:e,index:i,isLast:n},e)),[h,o,r,t,a,l,f,S,y,d,x,v,c,p,m,b,u]),V=null==g?void 0:g.frozenIndex,O=(0,ae.bW)(V),M=null==g?void 0:g.frozenStyles.left,P={...s?{...null==g?void 0:g.frozenStyles,left:tt.Xx+(M??0)}:null==g?void 0:g.frozenStyles},R=T.slice(0,O),j=T.slice(O);return t||!k?(0,C.jsxs)("div",{style:gs.l8,children:[(0,C.jsx)("div",{style:{display:"flex",...P},children:R.map(((e,t)=>_(e,t,t===T.length-1)))}),j.map(((e,t)=>_(e,t+O,t===T.length-1)))]}):(0,ae.Ql)(V)?(0,C.jsx)(Tc.Z,{style:{display:"flex"},direction:"horizontal",keys:T,sectionedKeys:{frozen:R,unfrozen:j},sectionStyles:{frozen:{display:"flex",...P},unfrozen:{display:"flex"}},renderKey:_,onDrop:e=>Wd(e,o,l,a,u,w),disableHorizontalEdgeScroll:n}):(0,C.jsx)(gs.ZP,{direction:"horizontal",keys:T,renderKey:_,onDrop:e=>Wd(e,o,l,a,u,w),disableHorizontalEdgeScroll:n})}function Qd(e){const{children:t,isCollectionViewBlockSelected:o,passesFilter:r,shouldFreeze:i}=e;return i?(0,C.jsx)(pc.Z,{enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},isVisible:!0,render:()=>(0,C.jsx)("div",{style:{display:"flex",background:o&&r?rr.ZP.blueWithAlpha(.14):void 0},children:t})},"halo"):(0,C.jsx)(C.Fragment,{children:t})}var Yd=o(186486),Xd=o(559183);function Jd(e,t){const{disabled:o,store:r,groupFormat:n,collectionContextStore:s,propertyFormats:l,disableTableWrap:a,frozoneProps:c,passesFilter:d,shouldShowMultiSelectCheckbox:u,isLast:p,...h}=e,{handleOpenPeekPage:m}=e,S=(0,i.useRef)(null),g=(0,Y.O7)(),f=(0,X.VK)((()=>!o&&r.canEdit()),[o,r]),v=(0,X.VK)((()=>(0,rt.A7)(n,s)),[n,s]),y=(0,X.VK)((()=>v.findIndex((e=>e===r))),[v,r]),x=(0,X.VK)((()=>{const e=s.collectionViewBlockStore();return!(!e||s.isFullScreenStore.state)&&(0,nc.sY)(e)}),[s]),b=(0,X.VK)((()=>s.isUnlistedViewStore.state&&s.isInlineViewStore.state),[s]),w=(0,X.VK)((()=>{const e=Xd.Z.state;if(e.isActive)return(0,tt.OG)(e.selection,l,v)}),[v,l]),k=null==c?void 0:c.frozenIndex,T=void 0!==k,_=(0,X.VK)((()=>{const{collectionContextStore:t,groupFormat:o}=e,r=Xd.Z.state,i=t.collectionViewBlockStore();if(!i)return!1;if(!r.isActive||!(0,Xd.N)(r.selectionKey,{collectionViewBlockStore:i,groupFormat:o})||!w)return!1;const n=w,{start:s}=n;return void 0!==k&&y===s.row&&s.col<=k}),[e,w,k,y]),V=(0,X.VK)((()=>ae.bW(k)),[k]),O=(0,i.useMemo)((()=>T?{...null==c?void 0:c.frozenStyles,..._?{zIndex:M.mK}:{zIndex:M.IK},...-1===k?{background:void 0}:{}}:{}),[k,null==c?void 0:c.frozenStyles,T,_]),[P,R]=(0,i.useMemo)((()=>T?[l.slice(0,k+1),l.slice(k+1)]:[[],l]),[k,l,T]),j=(0,X.VK)((()=>{var e;return Boolean(!a&&(null===(e=s.collectionViewStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("table_wrap").getValue()))}),[s,a]),I=(0,X.VK)((()=>{var e;return Boolean("timeline"===(null===(e=s.collectionViewStore())||void 0===e?void 0:e.getType())||!j&&!l.some((e=>e.wrap)))}),[s,l,j]),F=(0,X.VK)((()=>{const e=s.permissionScopesStore.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[s.permissionScopesStore]),N=(0,X.VK)((()=>s.isInHomeWidgetStore.state),[s]),B=(0,J.yK)((e=>{const t=N?e.tableHomeDividerColor:e.tableDividerColor;return{tableViewRowStyle:{display:"flex",...p&&N?{}:{borderBottom:`1px solid ${t}`},width:"100%"}}}),[N,p]),E=(0,X.VK)((()=>{var e;return!N&&"timeline"!==(null===(e=s.collectionViewStore())||void 0===e?void 0:e.getType())}),[s,N]),A=(0,C.jsxs)(i.Fragment,{children:[(0,C.jsx)("div",{className:dt.zwY,style:B.tableViewRowStyle,ref:S,children:(0,C.jsxs)("div",{style:{display:"flex"},children:[(0,C.jsx)("div",{style:T?O:{},children:(0,C.jsx)(Qd,{isCollectionViewBlockSelected:x,passesFilter:Boolean(d),shouldFreeze:-1!==k,children:(0,C.jsxs)(C.Fragment,{children:[u&&(0,C.jsx)(ru,{store:r,passesFilter:Boolean(d),frozoneProps:c,canEdit:f}),(0,C.jsx)(eu,{store:r,canEdit:f,propertyFormats:P,shouldSetCellHeight:I,indexAddendum:0,rowIndex:y,disabled:o,groupFormat:n,disableTableWrap:a,isLocked:F,isCollectionViewBlockSelected:x,passesFilter:Boolean(d),shouldShowMultiSelectCheckbox:u,frozoneProps:c,normalizedTableSelection:w,...h})]})})}),(0,C.jsx)(eu,{store:r,canEdit:f,propertyFormats:R,shouldSetCellHeight:I,indexAddendum:V,rowIndex:y,disabled:o,groupFormat:n,disableTableWrap:a,isLocked:F,isCollectionViewBlockSelected:x,passesFilter:!0,shouldShowMultiSelectCheckbox:u,frozoneProps:c,normalizedTableSelection:w,...h})]})}),E?(0,C.jsx)("div",{style:{...B.tableViewRowStyle,display:"flex",justifyContent:"flex-start",flexGrow:1,width:64}}):null]});return(0,Nl.ez)(r,t,(0,i.useMemo)((()=>({renderedType:"table_row",getNode:()=>S.current,getBlockStore:()=>r,activate(){const{mainEditorCurrentBlockStore:e}=uo.default.state,t=ae.mb({store:r,mainEditorCurrentBlockStore:e,collectionContextStore:s,fullyQualified:!1,overridePeekMode:b?"center_peek":void 0});t&&(m(),zt.c4({environment:g,url:t}))}})),[s,g,m,b,r]),A)}function eu(e){const{blockPropertyValueOverlayStore:t,propertyFormats:o,store:r,disableTableWrap:i,shouldSetCellHeight:n,indexAddendum:s,frozoneProps:l,normalizedTableSelection:a,...c}=e,d=(0,jl.Y$)(),u=(0,X.VK)((()=>d.collectionViewStore()),[d]),p=(0,X.VK)((()=>r.getAssociatedCollectionStore()),[r]),h=(0,X.VK)((()=>!!u&&Boolean(!i&&u.getFormatStore().getKeyStore("table_wrap").getValue())),[u,i]),m=(0,X.VK)((()=>{const e=Yd.default.state;return Boolean(e.isOpen&&e.currentStore===r)}),[r]),S=(0,X.VK)((()=>!t.state.isOpen&&st.default.state.stores.length>0&&st.default.state.stores[0].id===r.id),[r.id,t]),g=(0,X.VK)((()=>d.currentSubitemFormatStoreForUiDisplayStore.state),[d]),f=(0,X.VK)((()=>"title"===(null==u?void 0:u.getFormat().table_subitem_toggle_column)),[u]),v=(0,X.VK)((()=>d.frozoneStore.state.frozenIndex),[d]);return(0,C.jsx)(C.Fragment,{children:o.map(((e,i)=>(0,C.jsx)(tu,{index:i+(s??0),store:r,propertyFormat:e,isLastColumn:i===o.length-1,isRightMostFrozenColumn:v===i+(s??0),collectionViewStore:u,collectionStore:p,tableWrap:h,shouldSetCellHeight:n,isShowingHoverMenu:m,shouldCaptureKeyboard:S,subitemFormat:g,isSubitemToggleOnTitleColumn:f,blockPropertyValueOverlayStore:t,isScrolled:(null==l?void 0:l.isScrolled)??!1,normalizedTableSelection:a,...c},e.property)))})}function tu(e){const{propertyFormat:t,index:o,canEdit:r,isLastColumn:n,isRightMostFrozenColumn:s,store:l,schema:a,disabled:c,disableCellBorderRight:d,disableLastCellBorderRight:u,subitemPath:p,onShiftEnter:h,tableWrap:m,subitemFormat:S,isShowingHoverMenu:g,shouldCaptureKeyboard:f,isLocked:v,toggleButton:y,onPropertyClick:x,titleColumnIndex:b,isSubitemToggleOnTitleColumn:w,onPropertyTab:k,onPropertyUntab:T,onPropertyEnter:_,onPropertyEsc:V,onPropertyBgClick:O,onPropertyContextMenu:M,collectionViewStore:P,collectionStore:j,blockPropertyValueOverlayStore:I,shouldSetCellHeight:F,onOpenProperty:N,disableHorizontalEdgeScroll:B,handleOpenPeekPage:E,groupFormat:A,rowIndex:L,isCollectionViewBlockSelected:D,passesFilter:Z,isScrolled:H,shouldShowMultiSelectCheckbox:z,isInHomeWidget:K,normalizedTableSelection:G}=e,{property:W,wrap:U}=t,q=(0,Y.O7)(),$=(0,X.VK)((()=>(0,tt.vf)({environment:q,propertyFormat:t})),[q,t]),Q=(0,jl.Y$)(),ee=(null==p?void 0:p.length)??0,te=S&&(0,tt.lO)({columnIndex:o,titleColumnIndex:b,isSubitemToggleOnTitleColumn:w}),oe=(0,i.useMemo)((()=>{if(void 0!==$)return te?$-(0,tt.lZ)({columnIndex:o,indentLevel:ee,titleColumnIndex:b,isSubitemToggleOnTitleColumn:w}):$}),[ee,o,w,te,b,$]),re=(0,i.useMemo)((()=>te?(0,C.jsx)(ou,{subitemFormat:S,toggleButton:y,subitemPath:p,shouldShowMultiSelectCheckbox:z,propertyIndex:o}):void 0),[te,S,p,y,z,o]),ie=(0,i.useCallback)((()=>x(l,W,a)),[x,W,a,l]),ne=c||!r,se=(0,X.VK)((()=>{const e=Xd.Z.state,t=Q.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,Xd.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:A})||!G)return!1;const r=G,{start:i,end:n}=r,s=L===i.row||L===n.row||R.Z2(L,i.row,n.row),l=o===i.col||o===n.col||R.Z2(o,i.col,n.col);return s&&l}),[Q,A,o,G,L]),le=(0,X.VK)((()=>{const e=Xd.Z.state,t=Q.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,Xd.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:A})||!G)return!1;const r=G,{start:i}=r;return L===i.row&&o===i.col}),[Q,A,o,G,L]),ae=(0,X.VK)((()=>{const e=Q.frozoneStore.state.frozenIndex;return void 0!==e&&o<=e}),[Q,o]),ce=(0,J.yK)((e=>{const t=K?e.tableHomeDividerColor:e.tableDividerColor,r=D?e.tableFrozenSelectedDividerColor:t;return{tableCell:{display:"flex",width:$||void 0,position:"relative",borderRight:d||s||n&&u?"none":`1px solid ${ae?r:t}`},tableSelectionOverlay:{background:se?rr.ZP.blueWithAlpha(.07):void 0,borderRadius:le?3:void 0,boxShadow:le?e.collectionTableOutlineBlueInputBoxShadow:void 0,position:"absolute",pointerEvents:"none",top:0,height:"100%",zIndex:84,...0===o&&z?{width:"calc(100% + 8px)",left:-8}:{width:"100%",left:0}},propertyValueContainer:{display:"flex",overflowX:"clip",height:"100%",width:$||void 0}}}),[K,D,$,d,s,n,u,ae,se,le,o,z]),de=(0,X.VK)((()=>Q.isInlineViewStore.state&&Q.isUnlistedViewStore.state),[Q]),ue=(0,C.jsxs)(Qt.Z,{debugName:"TableRow",capture:f,onShiftEnter:h,children:[(0,C.jsx)(Gt.Z,{collectionStore:j,store:l,property:W,disabled:ne,locked:v,width:oe,format:mt.C.Table,forceMouseEntered:"title"!==W||!r||K||de?void 0:g,tableWrap:Boolean(m||U),isLast:n,indentLevel:0===o&&p?p.length:void 0,onTab:k,onUntab:T,onEnter:_,onClick:ie,onEsc:V,onBgClick:O,onContextMenu:M,collectionViewStore:P,shouldSetCellHeight:F,onOpenProperty:N,blockPropertyValueOverlayStore:I,disableHorizontalEdgeScroll:B,handleOpenPeekPage:E,propertyIndex:o,shouldShowMultiSelectCheckbox:z},W),s&&(0,C.jsx)(Rc,{isCollectionViewBlockSelected:D,passesFilter:Z,isScrolled:H})]});return(0,C.jsxs)("div",{className:dt.mWS,"data-row-index":L,"data-col-index":o,style:ce.tableCell,children:[re,(0,C.jsx)("div",{style:ce.propertyValueContainer,children:ue}),se&&(0,C.jsx)("div",{style:ce.tableSelectionOverlay})]})}function ou(e){const{toggleButton:t,subitemPath:o,shouldShowMultiSelectCheckbox:r,propertyIndex:i}=e,n=(null==o?void 0:o.length)??0,s=Math.max((n-1)*rt.Hw,0)+rt.gY;return t?(0,C.jsxs)("div",{style:{paddingTop:4,display:"flex",...0===i&&r?{marginLeft:-8,marginRight:4}:{}},children:[(0,C.jsx)("div",{style:{width:s}}),t]}):(0,C.jsx)("div",{style:{minWidth:s+rt.Hw,...0===i&&r?{marginLeft:-8,marginRight:4}:{}}})}const ru=i.memo((function(e){const{store:t,passesFilter:o,canEdit:r,frozoneProps:n}=e,s=(0,jl.Y$)(),l=(0,Y.O7)(),a=(0,X.VK)((()=>st.default.state.stores.includes(t)),[t]),c=(0,i.useCallback)((e=>{var o;(0,tt.vg)({collectionViewBlockId:null===(o=s.collectionViewBlockStore())||void 0===o?void 0:o.id})?G.Z5({environment:l,stores:[t]}):G.Ys({environment:l,store:t,toggle:!0}),e.stopPropagation()}),[s,l,t]);return(0,C.jsx)(jc,{checkedState:a,onClick:c,checkboxType:"single_row",collectionContextStore:s,frozoneProps:n,passesFilter:o,disabled:!r})})),iu=i.memo(i.forwardRef(Jd));var nu=o(755061),su=o(211302),lu=o(412714),au=o(137231),cu=o(239865),du=o(311368),uu=o(224646);const pu=function(e){const{frozenColumnRepositionStore:t,frozenIndex:o,maxFrozenIndex:r,xForFirstCellInRow:n,showPropertyFormats:s,frozenSectionWidth:l}=e,a=(0,Y.O7)(),c=(0,jl.DK)(),d=(0,i.useRef)(null),u=(0,i.useRef)(null),[p,h]=i.useState({x:0,y:0,width:0,maxY:0,isEntered:!1,isMouseDown:!1}),[m,S]=i.useState(0),[g,f]=i.useState(0),v=(0,X.VK)((()=>t.state.isRepositioning||p.isMouseDown),[t,p.isMouseDown]),y=(0,X.VK)((()=>t.state.newFrozenIndex),[t]),x=(0,X.VK)((()=>!!c&&(0,ae.fk)({environment:a,collectionContextStore:c})),[a,c]),b=(0,X.VK)((()=>null==c?void 0:c.frozoneStore.state.isScrolled),[c]),w=(0,X.VK)((()=>!b&&-1===o&&x?-4:0),[o,b,x]),k=(0,X.VK)((()=>p.isEntered||v),[p.isEntered,v]),T=(0,X.VK)((()=>t.state.newFrozenColumnXPosition),[t]),_=(0,i.useContext)(du.Ue),V=(0,X.VK)((()=>null==_?void 0:_.horizontalScroller),[_]),O=(0,i.useCallback)((()=>{var e,t,o;if(!V||!d.current)return 0;const r=(null===(e=d.current.getBoundingClientRect())||void 0===e?void 0:e.top)??0,i=null===(t=V.scrollerEl())||void 0===t?void 0:t.getElementsByClassName(dt.kUP);return(i&&i.length>0?null===(o=i[0].getBoundingClientRect())||void 0===o?void 0:o.top:0)-r}),[V]),I=(0,i.useCallback)((()=>{var e,t,o,r,i;if(!V||!d.current)return 0;const n=(null===(e=d.current)||void 0===e||null===(e=e.getBoundingClientRect())||void 0===e?void 0:e.bottom)??0,s=null===(t=V.scrollerEl())||void 0===t?void 0:t.getElementsByClassName(dt.zwY),l=s&&s.length>0?null===(o=s[s.length-1].getBoundingClientRect())||void 0===o?void 0:o.bottom:0,a=null===(r=V.scrollerEl())||void 0===r?void 0:r.getElementsByClassName(dt.Gcz),c=a&&a.length>0?null===(i=a[a.length-1].getBoundingClientRect())||void 0===i?void 0:i.bottom:0;return Math.max(l,c)-n}),[V]),F=(0,X.VK)((()=>{var e;const t=null===(e=d.current)||void 0===e?void 0:e.getBoundingClientRect();return t&&void 0!==l?new DOMRect(t.x+l+p.x+10,t.y+p.y+10,3,3):void 0}),[l,p]),N=(0,X.VK)((()=>{const e=(null==c?void 0:c.frozoneStore.state.scrollerLeftOffset)??0,t=(0,uu.Wk)(a),o=Math.max(t-e,0);return c&&(0,tt.iZ)(a,c)?o:0}),[c,a]),B=(0,i.useCallback)((e=>{if(void 0===o||void 0===r||void 0===l||null===d.current||null===u.current)return;const i=d.current.getBoundingClientRect(),a=e.clientX-i.x;if(null==c||c.frozoneStore.setState({...null==c?void 0:c.frozoneStore.state,tryShowHiddenFrozenColumn:a<42}),!k)return;const p=O();S(p);const m=I();f(m);const g=2+l,C=Math.max(a-g,-g),y=e.clientY-i.y-14,x=i.bottom-i.top-14+m,w=v?p:-14,T=Math.max(Math.min(y,x),w);if(h((e=>({...e,x:v?C:0,y:T}))),v){const e=s,i=u.current.getBoundingClientRect();let c=a,d=n,p=-1,h=d,m=Math.abs(d-c);for(let t=0;t<e.length&&!(t>r);t++){const r=e[t];d+=(null==r?void 0:r.width)??0,b&&t===o+1&&(c-=i.x);const n=Math.abs(d-c);n<m&&(m=n,h=d,p=t)}t.setState({...t.state,newFrozenIndex:p,newFrozenColumnXPosition:h-l-1})}}),[o,r,l,null==c?void 0:c.frozoneStore,k,O,I,v,s,n,t,b]);(0,i.useEffect)((()=>{const e=R.P2((e=>{B(e)}),25);return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[B]);const E=(0,i.useCallback)((e=>{v||(B(e.nativeEvent),h((e=>({...e,isEntered:!0,isMouseDown:!1}))))}),[v,B]),A=(0,i.useCallback)((e=>{v||h((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[v]),L=(0,i.useCallback)((e=>{h((e=>({...e,isMouseDown:!0})))}),[]),D=(0,i.useCallback)((e=>{v&&h((e=>({...e,isEntered:!0})))}),[v]),Z=(0,i.useCallback)((e=>{h((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[]),H=(0,i.useCallback)((e=>{v&&h((e=>({...e,x:0,isEntered:!1,isMouseDown:!1})))}),[v]),z=void 0!==y&&void 0!==o&&y<=o,K=(0,J.yK)((e=>({repositionerContainer:{zIndex:M.hc,display:"flex",position:"absolute",width:"100%",height:"100%",cursor:v?"grabbing":"grab",pointerEvents:v?void 0:"none"},repositionerOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)",height:"100%"},repositionerInsideStickyWrapper:{position:"sticky",left:N,height:"100%"},tooltipContainer:{position:"absolute",left:l??0,zIndex:M.xP,height:"100%"},tooltipOrigin:{position:"absolute",left:-3,top:0,width:8,pointerEvents:"auto",cursor:v?"grabbing":"grab",height:"100%"},tooltipColumn:{position:"absolute",left:v?p.x-1:-1,top:v?m:0,width:2,height:v?`calc(100% + ${g-m}px`:"100%",background:"dark"===e.mode?e.accentColors.gray[500]:e.accentColors.gray[200]},ghostColumnBase:{position:"absolute",top:v?m:0,width:1,height:v?`calc(100% + ${g-m}px`:"100%",background:e.accentColors.blue[300]},frozenGhostColumn:{left:T,opacity:v&&z?1:0},unfrozenGhostColumn:{left:(l??0)+(T??0),opacity:k&&v&&!z?1:0},tooltipDraggable:{position:"absolute",left:v?p.x-2:-2,top:p.y,width:4,height:28,background:e.accentColors.blue[400],borderRadius:4},tooltipText:{color:e.mediumInvertedTextColor,maxWidth:200,...j.Z.textOverflowStyle}})),[v,N,l,p,m,g,k,T,z]);return(0,C.jsx)("div",{className:dt.wXs,style:K.repositionerContainer,onMouseEnter:D,onMouseLeave:Z,onMouseUp:H,children:(0,C.jsxs)("div",{style:K.repositionerOutsideStickyWrapper,ref:u,children:[(0,C.jsx)("div",{style:K.repositionerInsideStickyWrapper,ref:d,children:(0,C.jsx)(Jt.Z,{renderTooltip:()=>v&&void 0!==y&&y!==o?(0,C.jsx)(P.FormattedMessage,{id:"tableView.selectionOverlay.repositioner.dynamicTooltip",defaultMessage:"Freeze {numColumns} {numColumns, select, 1 {column} other {columns}}",values:{numColumns:y+1}}):(0,C.jsx)(P.FormattedMessage,{id:"tableView.selectionOverlay.repositioner.tooltip",defaultMessage:"Drag horizontally to freeze columns"}),delayThreshold:300,forceVisibleState:v||void 0,placement:Sc.u.Right,originRect:F,render:e=>(0,C.jsx)(pc.Z,{isVisible:!0,animationStyle:{translateX:w,opacity:k?1:0},render:()=>(0,C.jsxs)("div",{...e,style:K.tooltipContainer,children:[(0,C.jsx)("div",{style:K.tooltipOrigin,onMouseEnter:E,onMouseLeave:A,onMouseDown:L}),(0,C.jsx)("div",{style:{...K.ghostColumnBase,...K.frozenGhostColumn}}),(0,C.jsx)("div",{style:K.tooltipColumn}),(0,C.jsx)("div",{style:K.tooltipDraggable})]})})})}),(0,C.jsx)("div",{style:{...K.ghostColumnBase,...K.unfrozenGhostColumn}})]})})};var hu=o(304708),mu=o(639500),Su=o(277907),gu=o(480796),fu=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down",e}(fu||{});class Cu extends s.Z{constructor(){super(...arguments),this.rowsWrapEl=null,this.observer=void 0,this.storeTypes={dragAndFillStore:c.default.createClass(void 0,{name:"dragAndFillStore"}),frozenColumnRepositionStore:c.default.createClass({isRepositioning:!1,newFrozenIndex:void 0,newFrozenColumnXPosition:void 0},{name:"frozenColumnRepositionStore"})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragStart=e=>function(e,t,o,r,i,n,s,l,a,c,d){if(e.preventDefault(),function(e){let t=e;for(;null!==t;){if(t.classList.contains(dt.wXs))return!0;t=t.parentElement}return!1}(e.target))l.setState({isRepositioning:!0,newFrozenIndex:a.state,newFrozenColumnXPosition:void 0}),function(e,t,o,r,i){var n;if(!t.frozoneStore.state.isScrolled)return;const s=i.state[0],l=o[0].property,a=Fd.Z.findBlockPropertyValue(s,l),c=t.frozoneStore.state.scrollerLeftOffset??0,d=(0,uu.Wk)(e),u=Math.max(d-c,0),p=(0,tt.iZ)(e,t)?u:0;null==a||null===(n=a.getContextHorizontalScroller())||void 0===n||n.scrollTo(void 0,r-p)}(t,o,r,i,c),gu.Z.setState({...gu.Z.state,disableHorizontalEdgeScroll:!0,disableVerticalEdgeScroll:!0});else{const t=d.state;if(t&&wu(n,o)&&function(e){let t=e;for(;null!==t;){if(t.classList.contains(dt.JR_))return!0;t=t.parentElement}return!1}(e.target))return void s.setState({...t})}le.wG()}(e,this.environment,this.props.collectionContextStore,this.props.showPropertyFormats,this.props.paddingLeft,this.props.disabled,this.stores.dragAndFillStore,this.stores.frozenColumnRepositionStore,this.frozenIndexStore,this.allRowsStore,this.normalizedTableSelectionStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragMove=e=>function(e,t,o,r,i,n,s,l,a,c){if(s.state.isRepositioning);else if(mu.X9()){var d;const s=bu(e.target);if(!s)return;const u=n.state,p=(null==u?void 0:u.start)??(null===(d=l.state)||void 0===d?void 0:d.start)??s;if(!p)return;const h=s;if(n.state&&p.col!==h.col)return;Mu({selection:{start:p,end:h},shouldNormalize:!0},t,o,r,i,a,c)}}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.stores.dragAndFillStore,this.stores.frozenColumnRepositionStore,this.normalizedTableSelectionStore,this.allRowsStore,this.selectionStartRectStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragEnd=()=>{return e=this.environment,t=this.props.collectionContextStore,o=this.props.showPropertyFormats,r=this.props.schema,i=this.stores.dragAndFillStore,n=this.stores.frozenColumnRepositionStore,s=this.normalizedTableSelectionStore,l=this.allRowsStore,function(e,t,o){const r=o.state.isRepositioning;r&&q.createAndCommit({userAction:"TableHeaderCell.handleFreezeColumns",environment:e,perform:r=>{ad.oz({environment:e,collectionContextStore:t,currentIndex:o.state.newFrozenIndex,transaction:r,entrypoint:"TableSelectionOverlay.FrozenColumnRepositioner"}),o.reset()}})}(e,t,n),void function(e,t,o,r,i,n,s){var l;const a=i.state;if(!a)return;const{start:c,end:d}=a;if(c.col!==d.col||c.row!==d.row)return;const u=t,p=u[c.col],h=null===(l=o[p.property])||void 0===l?void 0:l.type;if("verification"===h)return;const m=n.state;if(!m)return;q.createAndCommit({userAction:"TableSelectionOverlay.handleDragAndFill",environment:e,perform:e=>{Ou({transaction:e,selection:m,start:c},t,s)}});const S=Math.min(m.start.row,m.end.row),g=Math.max(m.start.row,m.end.row);h&&g!==S&&F.qm({environment:e,collectionContextStore:r,property_type:h,num_rows:g-S}),i.reset()}(e,o,r,t,i,s,l);var e,t,o,r,i,n,s,l},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragCancel=()=>{return e=this.stores.dragAndFillStore,t=this.stores.frozenColumnRepositionStore,e.reset(),t.reset(),void le.wG();var e,t},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleLeft=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault&&e.preventDefault();ho.Z.setKeyboardMode(!0);const d=n.state;if(!d)return;const u=o.collectionViewBlockStore();if(!u)return;ad.e2({environment:t,selectionKey:{collectionViewBlockStore:u,groupFormat:r},selection:d,shiftKey:"shiftKey"in e&&e.shiftKey||!1,columnCount:i.length}),Vu(fu.Left,i,n,s,l,a,c)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.frozenSectionWidthStore,this.frozenIndexStore,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRight=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault&&e.preventDefault();ho.Z.setKeyboardMode(!0);const d=n.state;if(!d)return;const u=o.collectionViewBlockStore();if(!u)return;ad.FC({environment:t,selectionKey:{collectionViewBlockStore:u,groupFormat:r},selection:d,columnCount:i.length,rowCount:s.state.length,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),Vu(fu.Right,i,n,s,l,a,c)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.frozenSectionWidthStore,this.frozenIndexStore,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleUp=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault&&e.preventDefault();ho.Z.setKeyboardMode(!0);const d=n.state;if(!d)return;const u=o.collectionViewBlockStore();if(!u)return;ad.zJ({environment:t,selectionKey:{collectionViewBlockStore:u,groupFormat:r},selection:d,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),Vu(fu.Up,i,n,s,l,a,c)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.frozenSectionWidthStore,this.frozenIndexStore,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDown=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault&&e.preventDefault();ho.Z.setKeyboardMode(!0);const d=n.state;if(!d)return;const u=o.collectionViewBlockStore();if(!u)return;ad.DI({environment:t,selectionKey:{collectionViewBlockStore:u,groupFormat:r},selection:d,rowCount:s.state.length,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),Vu(fu.Down,i,n,s,l,a,c)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.frozenSectionWidthStore,this.frozenIndexStore,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEnter=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault&&e.preventDefault();ho.Z.setKeyboardMode(!0);const d=l.state;if(!d)return;const u=a.state,p=u[d.start.row],h=r[d.start.col].property,m=o[h];if(!m)return;if(!i)if(ce.uk.includes(m.type)){if("checkbox"===m.type){const e=p.getPropertyStore(h),o=_a.Ml(e.getValue()),r=u.slice(d.start.row,d.end.row+1);q.createAndCommit({userAction:"TableSelectionOverlay.handleEnter",environment:t,perform:e=>{for(const i of r)au.sO({environment:t,store:i.getNormalizedPropertyStore(h),value:_a._I(!o),transaction:e})}})}}else ct.bA({environment:t,blockPropertyValueOverlayStore:n,store:p,property:h,format:mt.C.Table,disableHorizontalEdgeScroll:c,collectionContextStore:s}),le.wG()}(e,this.environment,this.props.schema,this.props.showPropertyFormats,this.props.disabled,this.props.blockPropertyValueOverlayStore,this.props.collectionContextStore,this.normalizedTableSelectionStore,this.allRowsStore,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTab=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault(),ho.Z.setKeyboardMode(!0);const d=n.state;if(!d)return;const u=o.collectionViewBlockStore();if(!u)return;ad.FC({environment:t,selectionKey:{collectionViewBlockStore:u,groupFormat:r},selection:d,columnCount:i.length,rowCount:s.state.length,shiftKey:!1}),Vu(fu.Right,i,n,s,l,a,c)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.frozenSectionWidthStore,this.frozenIndexStore,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleUntab=e=>function(e,t,o,r,i,n,s,l,a,c){e.preventDefault(),ho.Z.setKeyboardMode(!0);const d=n.state;if(!d)return;const u=o.collectionViewBlockStore();if(!u)return;ad.e2({environment:t,selectionKey:{collectionViewBlockStore:u,groupFormat:r},selection:d,shiftKey:!1,columnCount:i.length}),Vu(fu.Left,i,n,s,l,a,c)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.frozenSectionWidthStore,this.frozenIndexStore,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEsc=e=>function(e,t,o,r){const{device:i}=t;if(i.isMobile)return;e.preventDefault(),ho.Z.setKeyboardMode(!0);const n=o.state;if(le.wG(),n){const e=(0,tt.AV)(n),o=r.state.slice(e.minRow,e.maxRow+1);G.Z5({environment:t,stores:o})}}(e,this.environment,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMoveTo=e=>function(e,t,o,r){e.preventDefault&&e.preventDefault();ho.Z.setKeyboardMode(!0);const i=o.state;if(le.wG(),i){const e=(0,tt.AV)(i),o=r.state.slice(e.minRow,e.maxRow+1);if(0===o.length)return;G.Z5({environment:t,stores:o});const n=Tl.C.getRectFromStore(o[0]);su.bA({environment:t,blocks:o,originRect:n,moveToContext:"action_menu"})}}(e,this.environment,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDelete=e=>function(e,t,o,r,i,n,s){const l=n.state,a=o.normalizedSchemaStore.state;l&&!r&&q.createAndCommit({userAction:"TableSelectionOverlay.handleDelete",environment:t,perform:e=>{ad.NE({selection:l,schema:a,currentPropertyFormats:i,currentRows:s.state,transaction:e})}})}(0,this.environment,this.props.collectionContextStore,this.props.disabled,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCut=e=>function(e,t,o,r,i,n,s,l){const a=s.state,c=o.normalizedSchemaStore.state,d=o.collectionViewBlockStore();if(!d)return;a&&!r&&q.createAndCommit({userAction:"TableSelectionOverlay.handleCut",environment:t,perform:t=>{ad.nA({selectionKey:{collectionViewBlockStore:d,groupFormat:i},schema:c,selection:a,currentPropertyFormats:n,currentRows:l.state,event:e,transaction:t})}})}(e,this.environment,this.props.collectionContextStore,this.props.disabled,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCopy=e=>function(e,t,o,r,i,n){const s=i.state,l=t.normalizedSchemaStore.state,a=t.collectionViewBlockStore();if(!a)return;s&&ad.qn({selectionKey:{collectionViewBlockStore:a,groupFormat:o},schema:l,selection:s,currentPropertyFormats:r,currentRows:n.state,event:e})}(e,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePaste=e=>function(e,t,o,r,i,n,s,l,a,c,d){const u=c.state,p=o.collectionViewBlockStore();if(!p)return;u&&!a&&q.createAndCommit({userAction:"TableSelectionOverlay.handlePaste",environment:t,perform:a=>{ad.j0({environment:t,collectionContextStore:o,selectionKey:{collectionViewBlockStore:p,groupFormat:r},selection:u,currentPropertyFormats:n,currentRows:d.state,event:e,transaction:a,schema:i,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l})}})}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.schema,this.props.showPropertyFormats,this.props.markdownLinkifyIt,this.props.tinyMceMicrosoftWordPasteFilter,this.props.disabled,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCommandEnter=e=>function(e,t,o,r,i,n){const{device:s}=t,l=r.state;if(s.isMobile||!l)return;const a=i.state[l.start.row],{mainEditorCurrentBlockStore:c}=uo.default.state,d=ae.mb({store:a,mainEditorCurrentBlockStore:c,collectionContextStore:o,fullyQualified:!1});d&&function(e,t,o){o?o(e):zt.c4({environment:t,url:e})}(d,t,n)}(0,this.environment,this.props.collectionContextStore,this.normalizedTableSelectionStore,this.allRowsStore,this.context.overrideLinkClick),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleShiftEnter=()=>function(e,t,o,r,i,n,s,a,c,u,p){const{device:h}=e;if(h.isMobile)return;const m=n.state;if(!m)return;if(!Nt.M_(e))return;if(!t.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const S=s.state,g=S[m.start.row],f=t.subitemTreeStore.state,C=(0,et.DY)(f.children,(e=>e.value.store===g)),v="table_selection_overlay_shift_enter";if(C){const n=C?(0,rt.Af)(C.map((e=>e.value.store))):"",c=t.subitemExpandedStore.state.get(n),u=Boolean(null==c?void 0:c.isExpanded),p=[...C].splice(0,C.length-1),h=p?(0,rt.Af)(p.map((e=>e.value.store))):"",f=t.subitemExpandedStore.state.get(h),y=Boolean(null==f?void 0:f.isExpanded);if(u||y)q.createAndCommit({userAction:"TableSelectionOverlay.handleNestedItemShiftEnter",environment:e,perform:i=>{const n=t.collectionStore();if(!n)return;const s=E.yk({environment:e,collectionContextStore:t,groupsPointer:o?[o]:[],store:g,before:!1,collectionStore:n,transaction:i,subitemPath:C,subitemInsertDirection:y&&!u?"below":"into",from:v});if(s&&r){const o=()=>{ct.bA({isNewBlock:!0,environment:e,blockPropertyValueOverlayStore:r,store:s,property:"title",format:mt.C.Table,collectionContextStore:t})};$e.default.checkGate({gateName:"collections_item_mounted_callbacks"})?t.registerCallbackForItemMounted(s,o):l.default.afterNextFlush((()=>{l.default.afterNextFlush(o)}))}}});else{const r={col:m.end.col,row:t.currentViewHasSort()?S.length:m.end.row+1};q.createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:e,perform:i=>{const n=E.IW({environment:e,collectionContextStore:t,groupsPointer:o?[o]:[],insertAtIndex:r.row,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:i,from:v});if(n&&!n.coercionSucceeded){const r=o?[o]:[],i=t.groupsStore.getGroupState(r);se.CH({environment:e,store:n.newStore,peekMode:ae.kr(t),resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:t,pageVisitSource:d.tY.Create})}}}),l.default.afterNextFlush((()=>{Mu({selection:{start:r,end:r},shouldNormalize:!1},e,t,o,i,s,a)}))}}else{const r={col:m.end.col,row:t.currentViewHasSort()?S.length:m.end.row+1};q.createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:e,perform:i=>{const n=E.IW({environment:e,collectionContextStore:t,groupsPointer:o?[o]:[],insertAtIndex:r.row,shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:i,from:v});if(n&&!n.coercionSucceeded){const r=o?[o]:[],i=t.groupsStore.getGroupState(r);se.CH({environment:e,store:n.newStore,peekMode:ae.kr(t),resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:t,pageVisitSource:d.tY.Create})}}}),l.default.afterNextFlush((()=>{Mu({selection:{start:r,end:r},shouldNormalize:!1},e,t,o,i,s,a)}))}Vu(fu.Down,i,n,s,c,u,p),ct.xv({environment:e,blockPropertyValueOverlayStore:r})}(this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.blockPropertyValueOverlayStore,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore,this.selectionStartRectStore,this.frozenSectionWidthStore,this.frozenIndexStore,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDuplicate=e=>function(e,t,o,r,i,n){const{device:s}=t;if(s.isMobile)return;const l=i.state;if(!l||l.start.col!==l.end.col||o)return;if(!Nt.M_(t))return;e.preventDefault(),q.createAndCommit({userAction:"TableSelectionOverlay.handleDuplicate",environment:t,perform:e=>{Ou({transaction:e,selection:l,start:l.start},r,n)}})}(e,this.environment,this.props.disabled,this.props.showPropertyFormats,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCommandShiftEnter=e=>function(e,t,o,r){const{device:i}=t;if(i.isMobile)return;const n=o.state;if(n){const e=r.state[n.start.row],o=(0,lo.ZP)({store:e,fullyQualified:!1,pageVisitSource:d.tY.LinkInPage});lu.D({environment:t,url:o})}}(0,this.environment,this.normalizedTableSelectionStore,this.allRowsStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleKeypress=e=>function(e,t,o,r,i,n,s,l,a,c){if(!e.key||e.metaKey||e.ctrlKey)return;e.preventDefault(),ho.Z.setKeyboardMode(!0);const d=l.state;if(!d)return;const u=a.state[d.start.row],p=r[d.start.col].property,h=o[p];if(!h)return;!i&&ce.ub.includes(h.type)&&e.key&&1===e.key.length&&(ct.bA({environment:t,blockPropertyValueOverlayStore:n,store:u,property:p,format:mt.C.Table,disableHorizontalEdgeScroll:c,insertChar:e.key,collectionContextStore:s}),le.wG())}(e,this.environment,this.props.schema,this.props.showPropertyFormats,this.props.disabled,this.props.blockPropertyValueOverlayStore,this.props.collectionContextStore,this.normalizedTableSelectionStore,this.allRowsStore,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyTab=()=>function(e,t,o,r,i,n,s,l,a,c,d){const u=t.state;if(u.isOpen){const{store:p,property:h}=u,m=_u(p,h,o,n),S=o,g={col:Math.min(m.col+1,S.length-1),row:m.row};Mu({selection:{start:g,end:g},shouldNormalize:!0},e,r,i,o,n,s),Vu(fu.Right,o,l,n,a,c,d),ct.xv({environment:e,blockPropertyValueOverlayStore:t})}}(this.environment,this.props.blockPropertyValueOverlayStore,this.props.showPropertyFormats,this.props.collectionContextStore,this.props.groupFormat,this.allRowsStore,this.selectionStartRectStore,this.normalizedTableSelectionStore,this.frozenSectionWidthStore,this.frozenIndexStore,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyUntab=()=>function(e,t,o,r,i,n,s,l,a,c,d){const u=t.state;if(u.isOpen){const{store:p,property:h}=u,m=_u(p,h,o,n),S={col:Math.max(m.col-1,0),row:m.row};Mu({selection:{start:S,end:S},shouldNormalize:!0},e,r,i,o,n,s),Vu(fu.Left,o,l,n,a,c,d),ct.xv({environment:e,blockPropertyValueOverlayStore:t})}}(this.environment,this.props.blockPropertyValueOverlayStore,this.props.showPropertyFormats,this.props.collectionContextStore,this.props.groupFormat,this.allRowsStore,this.selectionStartRectStore,this.normalizedTableSelectionStore,this.frozenSectionWidthStore,this.frozenIndexStore,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyEnter=()=>function(e,t,o,r,i,n,s,a,c,d,u){const p=t.state;if(!p.isOpen)return;const{store:h,property:m}=p;if(e.device.isMobile){const t=r.normalizedSchemaStore.state[m],o=mo.default.state;return void("text"===(null==t?void 0:t.type)&&"editing"===o.mode&&q.createAndCommit({userAction:"TableSelectionOverlay.mobileEnter",environment:e,perform:t=>{au.hJ({environment:e,editorMode:"default",multiSelection:o.multiSelection,string:"\n",disableMentions:!0,disableEmojiCommands:!0,disableSlashCommands:!0,transaction:t})}}))}const S=_u(h,m,o,n),g={col:S.col,row:S.row+1};l.default.afterNextFlush((()=>{ku(t,e)&&Mu({selection:{start:g,end:g},shouldNormalize:!0},e,r,i,o,n,s)})),Vu(fu.Down,o,a,n,c,d,u),ct.xv({environment:e,blockPropertyValueOverlayStore:t})}(this.environment,this.props.blockPropertyValueOverlayStore,this.props.showPropertyFormats,this.props.collectionContextStore,this.props.groupFormat,this.allRowsStore,this.selectionStartRectStore,this.normalizedTableSelectionStore,this.frozenSectionWidthStore,this.frozenIndexStore,this.props.disableHorizontalEdgeScroll),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyClick=(e,t,o)=>function(e,t,o,r,i,n,s,l,a){var c;const{device:d}=r;if("checkbox"!==(null===(c=o[t])||void 0===c?void 0:c.type)||d.isMobile)le.wG();else{const o=_u(e,t,i,l);Mu({selection:{start:o,end:o},shouldNormalize:!0},r,n,s,i,l,a)}}(e,t,o,this.environment,this.props.showPropertyFormats,this.props.collectionContextStore,this.props.groupFormat,this.allRowsStore,this.selectionStartRectStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyBgClick=()=>{return e=this.environment,t=this.props.blockPropertyValueOverlayStore,o=this.props.showPropertyFormats,r=this.props.collectionContextStore,i=this.props.groupFormat,n=this.allRowsStore,s=this.selectionStartRectStore,l=this.normalizedTableSelectionStore,a=this.frozenSectionWidthStore,c=this.frozenIndexStore,d=this.props.disableHorizontalEdgeScroll,void Pu(e,t,o,r,i,n,s,l,a,c,d);var e,t,o,r,i,n,s,l,a,c,d},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyEsc=()=>{return e=this.environment,t=this.props.collectionContextStore,o=this.props.blockPropertyValueOverlayStore,r=this.props.showPropertyFormats,i=this.props.groupFormat,n=this.allRowsStore,s=this.selectionStartRectStore,l=this.normalizedTableSelectionStore,a=this.frozenSectionWidthStore,c=this.frozenIndexStore,d=this.props.disableHorizontalEdgeScroll,void Pu(e,o,r,t,i,n,s,l,a,c,d,(o=>{const{isNewBlock:r,store:i}=o;r&&i.isEmptyTitle()&&i.isEmptyPage()&&q.createAndCommit({userAction:"TableSelectionOverlay.handlePropertyEsc",environment:e,perform:o=>{cu.y8({environment:e,blocks:[i],transaction:o}),o.postSubmitCallbacks.push((o=>{if(!o){const o=t.collectionStore(),r=t.collectionViewBlockStore();I.dh(e,{analyticsName:"delete",from:"collection_esc_shortcut",block_id:i.id,block_type:"page",collection_id:null==o?void 0:o.id,collection_view_id:null==r?void 0:r.id})}}))}})}));var e,t,o,r,i,n,s,l,a,c,d},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyOpenProperty=e=>{!function(e,t,o,r,i){const n=t.state;if(n.isOpen){const{store:s}=n;ct.bA({environment:i,blockPropertyValueOverlayStore:t,store:s,property:e,format:mt.C.Table,disableHorizontalEdgeScroll:o,collectionContextStore:r})}}(e,this.props.blockPropertyValueOverlayStore,Boolean(this.props.disableHorizontalEdgeScroll),this.props.collectionContextStore,this.environment)},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyContextMenu=e=>function(e,t,o,r,i){e.preventDefault();const n=r.state,s=i.state,l=bu(e.target);let a=!1;if(s&&l){const r=Math.min(s.start.row,s.end.row),i=Math.max(s.start.row,s.end.row);if(l.row>=r&&l.row<=i){const s=n.slice(r,i+1);s.length>0&&(G.Z5({environment:t,stores:s}),G.Ys({environment:t,store:s[0]}),Ht.Qn({environment:t,stores:st.default.state.stores,left:e.clientX,top:e.clientY,actionSectionGroupKey:$e.default.checkGate({gateName:"db_comments"})?"block_in_collection":"default",showInput:!0,analyticsFrom:"content_block_menu",optionalAnalyticsProperties:{collectionContextStore:o}}),a=!0)}}if(!a&&l){const r=n[l.row];r&&(G.Ys({environment:t,store:r}),Ht.Qn({environment:t,stores:st.default.state.stores,left:e.clientX,top:e.clientY,actionSectionGroupKey:$e.default.checkGate({gateName:"db_comments"})?"block_in_collection":"default",showInput:!0,analyticsFrom:"content_block_menu",optionalAnalyticsProperties:{collectionContextStore:o}}))}}(e,this.environment,this.props.collectionContextStore,this.allRowsStore,this.normalizedTableSelectionStore),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRowSelectableEnter=e=>function(e,t,o,r,i,n,s){const l=n.state,a=e.blocks.map((e=>l.indexOf(e))),c=R.VV(a)||0,d=R.Fp(a)||0;c>=0&&d>=0&&Mu({selection:{start:{col:0,row:c},end:{col:0,row:d}},shouldNormalize:!0},t,o,r,i,n,s)}(e,this.environment,this.props.collectionContextStore,this.props.groupFormat,this.props.showPropertyFormats,this.allRowsStore,this.selectionStartRectStore),this.handleRowsWrapMount=e=>{this.rowsWrapEl=e},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRowsObserverChange=()=>{this.selectionStartRectStore.recompute()},this.allRowsStore=this.createComputedStore((()=>{const{groupFormat:e,collectionContextStore:t}=this.props;return(0,rt.A7)(e,t)})),this.normalizedTableSelectionStore=this.createComputedStore((()=>{const e=Xd.Z.state,t=this.props.collectionContextStore.collectionViewBlockStore();if(!t)return;const{groupFormat:o}=this.props;if(!e.isActive||!(0,Xd.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:o}))return;const{selection:r}=e;return(0,tt.OG)(r,this.props.showPropertyFormats,this.allRowsStore.state)}),{useDeepEqual:!0}),this.selectionStartRectStore=this.createComputedStore((()=>{const e=this.normalizedTableSelectionStore.state;if(e)return this.getCellRect(e.start)}),{useDeepEqual:!0}),this.frozenIndexStore=this.createComputedStore((()=>this.props.collectionContextStore.frozoneStore.state.frozenIndex)),this.maxFrozenIndexStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore(),o=e.frozoneStore.state.scrollerWidth;return null==t?void 0:t.getTableMaxFrozenColumnIndex(o,e.normalizedFormatStore.state)})),this.frozenSectionWidthStore=this.createComputedStore((()=>{const e=this.frozenIndexStore.state;if(void 0!==e){let t=Tu(this.props.collectionContextStore,this.environment);const{showPropertyFormats:o}=this.props,r=o;for(let i=0;i<=e&&!(i>=r.length);i++){const e=r[i];e.width&&(t+=e.width)}return t-1}}),{useDeepEqual:!0}),this.multiSelectCheckedStore=this.createComputedStore((()=>{const e=function(e,t){const o=t?[t]:[];return(0,rt.A7)(o[0],e)}(this.props.collectionContextStore,this.props.groupFormat),t=e.length;if(0===t)return!1;const o=st.default.state.stores.filter((t=>e.includes(t))).length;return 0!==o&&(o===t||"indeterminate")})),this.shouldRenderFrozenColumnRepositionerStore=this.createComputedStore((()=>void 0!==this.frozenIndexStore.state&&!this.stores.dragAndFillStore.state&&!this.multiSelectCheckedStore.state&&!Xd.Z.state.isActive&&void 0===this.props.tableStore.state.temporaryFormat&&this.props.collectionContextStore.permissionScopesStore.state.canConfigureBlock)),this.renderArgs={onPropertyTab:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyTab,onPropertyUntab:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyUntab,onPropertyEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyEnter,onPropertyClick:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyClick,onPropertyEsc:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyEsc,onPropertyBgClick:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyBgClick,onPropertyContextMenu:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyContextMenu,onOpenProperty:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePropertyOpenProperty,onSelectableEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRowSelectableEnter}}willUnmount(){super.willUnmount(),this.observer&&this.observer.disconnect()}didMount(){super.didMount(),this.rowsWrapEl&&(this.observer=new MutationObserver(this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRowsObserverChange),this.observer.observe(this.rowsWrapEl,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))}renderComponent(){const{store:e,schema:t,showPropertyFormats:o}=this.props,r=this.normalizedTableSelectionStore.state,i=r&&r.start.col===r.end.col&&r.start.row===r.end.row,n=wu(this.props.disabled,this.props.collectionContextStore)&&r&&(i||this.stores.dragAndFillStore.state)?(0,C.jsx)(yu,{store:e,schema:t,selection:r,dragAndFillStore:this.stores.dragAndFillStore,showPropertyFormats:o,selectionStartRectStore:this.selectionStartRectStore,rowsWrapRect:this.getRowsWrapRect(),frozenIndexStore:this.frozenIndexStore,currentRowsStore:this.allRowsStore}):null,s=this.shouldRenderFrozenColumnRepositionerStore.state?(0,C.jsx)(pu,{frozenColumnRepositionStore:this.stores.frozenColumnRepositionStore,frozenIndex:this.frozenIndexStore.state,maxFrozenIndex:this.maxFrozenIndexStore.state,xForFirstCellInRow:Tu(this.props.collectionContextStore,this.environment),showPropertyFormats:o,frozenSectionWidth:this.frozenSectionWidthStore.state}):null,l=this.props.render(this.renderArgs);return(0,C.jsx)(Qt.Z,{debugName:"TableSelectionOverlay",capture:void 0!==this.normalizedTableSelectionStore.state,onLeft:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleLeft,onRight:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleRight,onUp:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleUp,onDown:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDown,onEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEnter,onTab:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleTab,onUntab:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleUntab,onEsc:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleEsc,onDelete:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDelete,onBackspace:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDelete,onCut:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCut,onCopy:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCopy,onPaste:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handlePaste,onCommandEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCommandEnter,onShiftEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleShiftEnter,onCommandShiftEnter:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleCommandShiftEnter,onDuplicate:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDuplicate,onKeypress:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleKeypress,onMoveTo:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMoveTo,children:(0,C.jsx)(Rl.Z,{onDraggableDragStart:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragStart,onDraggableDragMove:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragMove,onDraggableDragEnd:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragEnd,onDraggableDragCancel:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleDragCancel,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,render:e=>(0,C.jsxs)("div",{style:{position:"relative",minWidth:this.props.minWidth},...e,ref:this.handleRowsWrapMount,children:[s,n,l]})})})}getRowsWrapRect(){return this.rowsWrapEl?this.rowsWrapEl.getBoundingClientRect():void 0}getCellRect(e){const{rowsWrapEl:t}=this;if(!t)return;const{showPropertyFormats:o}=this.props,r=o,i=function(e,t){if(!t)return;const o=Tl.C.findSelectablesFromStore(e),r=o.map((e=>e.getNode())).find((e=>t.contains(e)));if(!r)return;return r.getBoundingClientRect()}(this.allRowsStore.state[e.row],t);if(!i)return;const n=t.getBoundingClientRect(),s=i.height,l=i.top-n.top-1,a=r[e.col].width||0,c=s+1;let d=Tu(this.props.collectionContextStore,this.environment);for(let u=0;u<e.col;u++){const e=r[u];e.width&&(d+=e.width)}return new DOMRect(d-1,l,a+1,c)}}Cu.displayName="TableSelectionOverlay",Cu.contextTypes={...yi.wK,...s.w};const vu=10;function yu(e){var t;const{store:o,schema:r,selection:i,dragAndFillStore:n,currentRowsStore:s,showPropertyFormats:l,selectionStartRectStore:a,rowsWrapRect:c,frozenIndexStore:d}=e,u=(0,X.VK)((()=>n.state),[n]),p=(0,X.VK)((()=>{const e=(null==u?void 0:u.start)||i.start;return l[e.col]}),[u,i,l]),h=(0,P.useIntl)(),m=(0,X.VK)((()=>{if(!u||!p)return[];const{start:e}=u,t=s.state[e.row].getModel();return t?(0,nu.v4)({property:p.property,schema:r,block:t,getRecordValue:o.getRecordValue,userTimeZone:(0,He.r)(),baseURL:void 0,intl:h}):""}),[s,u,h,p,r,o]),S=p?null===(t=r[p.property])||void 0===t?void 0:t.type:void 0,g=(0,X.VK)((()=>a.state),[a]),f=(0,X.VK)((()=>d.state),[d]),v=(0,X.VK)((()=>void 0!==f&&i.start.col<=f),[f,i]),y=(0,J.yK)((e=>({dragAndFillContainer:{zIndex:v?M.hc+4:void 0,display:"flex",position:"relative"},dragAndFillOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)"},dragAndFillInsideStickyWrapper:{position:v?"sticky":void 0,left:"0"},tooltipContainer:{position:"absolute",left:g?g.left+g.width-5:void 0,zIndex:M.IK},tooltipOrigin:{position:"absolute",left:0,top:g?g.bottom-7:void 0,width:vu,height:1.5*vu,pointerEvents:"auto",cursor:"ns-resize"},tooltipCircle:{position:"absolute",left:0,top:g?g.bottom-5:void 0,width:9,height:9,border:`2px solid ${rr.ZP.blueWithAlpha(.57)}`,transform:u?"scale(1.3)":void 0,transition:"transform 0.2s ease",background:e.contentBackground,borderRadius:"50%",cursor:"ns-resize"},tooltipText:{color:e.mediumInvertedTextColor,maxWidth:200,...j.Z.textOverflowStyle}})),[v,g,u]);if(!g)return null;if(!S||ce.ZY(S)||"rollup"===S||"formula"===S||"verification"===S)return null;let x;return c&&(x=new DOMRect(g.x+c.x+g.width-4,g.y+c.y+g.height-4,7,7)),(0,C.jsx)(Jt.Z,{renderTooltip:()=>{const e=(0,C.jsx)(P.FormattedMessage,{id:"tableView.selectionOverlay.dragAndFill.tooltip",defaultMessage:"Drag vertically to fill value"});return u?(0,C.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[e,(0,C.jsx)("div",{style:y.tooltipText,children:m})]}):e},delayThreshold:300,forceVisibleState:!!u||void 0,originRect:x,placement:Sc.u.Right,render:e=>(0,C.jsx)("div",{...e,className:dt.JR_,style:y.dragAndFillContainer,children:(0,C.jsx)("div",{style:y.dragAndFillOutsideStickyWrapper,children:(0,C.jsx)("div",{style:y.dragAndFillInsideStickyWrapper,children:(0,C.jsxs)("div",{style:y.tooltipContainer,children:[(0,C.jsx)("div",{style:y.tooltipOrigin}),(0,C.jsx)("div",{style:y.tooltipCircle})]})})})})})}function xu(e){const{value:t}=(0,Su.XJ)(ro.FF.markdownLinkifyIt),{value:o}=(0,Su.XJ)(ro.FF.tinyMceMicrosoftWordPasteFilter);return(0,C.jsx)(Cu,{...e,markdownLinkifyIt:t,tinyMceMicrosoftWordPasteFilter:o})}function bu(e){let t=e;for(;null!==t&&!t.classList.contains(dt.mWS);)t=t.parentElement;if(null===t)return;return{col:parseInt(t.getAttribute("data-col-index")??"0"),row:parseInt(t.getAttribute("data-row-index")??"0")}}function wu(e,t){const o=t.permissionScopesStore.state;return!e&&o.canEditContent}function ku(e,t){if(!(0,hu.zq)(t))return!0;const o=e.state;return!o.isOpen||0===o.additionalStores.length}function Tu(e,t){return(0,ae.fk)({environment:t,collectionContextStore:e})?tt.Xx:0}function _u(e,t,o,r){const i=r.state;return{col:o.findIndex((e=>e.property===t)),row:i.findIndex((t=>e===t))}}function Vu(e,t,o,r,i,n,s){const l=o.state;if(l){let o;o=e===fu.Down?l.start.row>l.end.row?l.start:l.end:e===fu.Up?l.start.row<l.end.row?l.start:l.end:e===fu.Right?l.start.col>l.end.row?l.start:l.end:l.start.col<l.end.row?l.start:l.end;const a=r.state[o.row],c=t[o.col].property,d=Fd.Z.findBlockPropertyValue(a,c),u=(null==d?void 0:d.getNode())??null;if(u){const e=i.state??0,t=n.state,o=s||t&&l.start.col<=t&&l.end.col<=t;z.bx({element:u,vertical:{reveal:"closest",paddingToTopEdge:96,paddingToBottomEdge:48},horizontal:o?void 0:{reveal:"closest",paddingToLeftEdge:e},scrollers:{verticalScroller:null==d?void 0:d.getContextVerticalScroller(),horizontalScroller:null==d?void 0:d.getContextHorizontalScroller()}})}}}function Ou(e,t,o){const{transaction:r,selection:i,start:n}=e,s=o.state,l=t[n.col],a=s[n.row].getPropertyValue(l.property)||[],c=Math.min(i.start.row,i.end.row),d=Math.max(i.start.row,i.end.row);s.slice(c,d+1).forEach((e=>{e.pointer!==s[n.row].pointer&&au.sO({environment:e.environment,store:e.getNormalizedPropertyStore(l.property),value:a,transaction:r})}))}function Mu(e,t,o,r,i,n,s){const{selection:l,shouldNormalize:a}=e,c=o.collectionViewBlockStore();c&&(ad.Z5({environment:t,selectionKey:{collectionViewBlockStore:c,groupFormat:r},selection:a?(0,tt.OG)(l,i,n.state):l}),s.recompute())}function Pu(e,t,o,r,i,n,s,l,a,c,d,u){const{device:p}=e,h=t.state;if(h.isOpen){const{store:m,property:S}=h,g=_u(m,S,o,n);p.isMobile?le.wG():ku(t,e)&&Mu({selection:{start:g,end:g},shouldNormalize:!0},e,r,i,o,n,s),Vu(fu.Down,o,l,n,a,c,d),ct.xv({environment:e,blockPropertyValueOverlayStore:t}),null==u||u(h)}}function Ru(e){const{isFullScreen:t,hasGroups:o,propertyWidths:r,hasPartialResults:i,hasSearchQuery:n,frozoneProps:s}=e,l=(0,Y.O7)(),a=(0,J.Fg)(),c=(0,Y.Fy)().isPhone,d=(0,jl.DK)(),u=(0,$o.Z)(!0,0,100),p=(0,X.VK)((()=>Boolean(null==d?void 0:d.normalizedFormatStore.state.hide_table_vertical_lines)),[d]),h=(0,X.VK)((()=>!!d&&(0,ae.fk)({environment:l,collectionContextStore:d})),[d,l]),m=s.isScrolled,S=s.frozenIndex,g=void 0!==S,f=(0,X.VK)((()=>{if(!d)return!1;const e=d.collectionViewBlockStore();return!!e&&(0,nc.sY)(e)}),[d]),v=(0,X.VK)((()=>d?(0,tt.oc)({environment:l,collectionContextStore:d,isPhone:c,theme:a}):{}),[d,l,c,a]),y=(0,J.yK)((e=>({container:{display:"flex",flexDirection:"row",alignItems:"flex-start"},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},frozenColumnsContainer:{display:"flex",flexDirection:"row",...v,...-1===S?{background:void 0}:{}},multiselectCheckbox:{display:"flex",flexDirection:"row",pointerEvents:"none",cursor:"pointer",...v},rowContainer:{display:"flex",alignItems:"flex-start",padding:g?void 0:"0px 16px",borderBottom:`1px solid ${e.tableDividerColor}`,width:"100%"},rowShimmer:{height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor,marginLeft:g?0:8},column:{display:"flex",height:32,padding:"0px 8px",alignItems:"center",borderRight:p?void 0:`1px solid ${e.tableDividerColor}`}})),[v,S,g,p]);if(!u||!d)return null;const x=r.map(((e,t)=>(0,C.jsx)("div",{style:{...y.column,width:e},children:(0,C.jsx)(tn.Z,{style:{...y.rowShimmer,width:.6*(e-16)}})},t)));let b=null,w=[];if(g&&void 0!==S){const e=x.slice(0,S+1);b=(0,C.jsxs)("div",{style:y.frozenColumnsContainer,children:[(0,C.jsxs)(Qd,{isCollectionViewBlockSelected:f,passesFilter:!0,shouldFreeze:-1!==S,children:[h&&(0,C.jsx)("div",{style:{width:32,height:31}}),e]}),e.length>0?(0,C.jsx)(Rc,{isCollectionViewBlockSelected:f,passesFilter:!0,isShimmerRow:!0,isScrolled:m}):null]}),w=x.slice(S+1,x.length)}else w=x;let k=1;o||i||n||(k=t?10:3);const T=[...Array(k)].map(((e,t)=>(0,C.jsxs)("div",{style:y.rowContainer,children:[b,w]},t)));return(0,C.jsx)("div",{style:y.container,children:(0,C.jsx)("div",{style:y.rowsContainer,children:T})})}const ju=i.memo((function(e){const{groupFormat:t,store:o,format:r,schema:n,query:s,collectionContextStore:a,showHoverActionsStore:c,isFullScreen:u,isInPeekRenderer:p,disabled:h,blockPropertyValueOverlayStore:m,minWidth:S,paddingBottom:g,paddingLeft:f,tableStore:v}=e,y=(0,Y.O7)(),x=(0,Y.Fy)(),b=(0,i.useContext)(yi.ZO),w=(0,X.VK)((()=>{const e=t?[t]:[];return a.groupsStore.getGroupState(e)}),[t,a]),k=(0,X.VK)((()=>{const e=function(e,t){const o=Nu(e,t);return o&&o.table_properties?o.table_properties:[]}(r,v).filter((e=>e.visible));return x.isMobile?e.slice(0,20):e}),[x.isMobile,r,v],{useDeepEqual:!0}),T=(0,X.VK)((()=>null==w?void 0:w.reducerResultStore.state),[w]),_=(0,X.VK)((()=>void 0!==T),[T]),V=(0,X.VK)((()=>a.permissionScopesStore.state),[a]),O=(0,Nl.PE)(e.store,e.disabled),M=(0,X.VK)((()=>!!O&&(!V.isSyncedCollection&&V.canEditContent)),[O,V]),R=(0,X.VK)((()=>"collectionTypedView"===a.contextType),[a]),F=(0,X.VK)((()=>a.isInHomeWidgetStore.state),[a]),N=(0,X.VK)((()=>Boolean(!F&&_&&(M||R)&&a.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))),[M,a,_,R,F]),B=(0,X.VK)((()=>k.reduce(((e,t)=>e+(t.width||0)),0)+(V.canEditContent?32:0)),[k,V]),A=(0,X.VK)((()=>k.map((e=>e.width||we.Nx))),[k]),L=(0,X.VK)((()=>k.findIndex((e=>"title"===e.property))),[k]),D=(0,X.VK)((()=>{const e=t?[t]:[],o=(0,rt.A7)(e[0],a);return st.default.state.stores.filter((e=>o.includes(e))).length>0}),[t,a]),Z=(0,X.VK)((()=>{const{device:e,ThemeModeStore:t}=y,{isScrolled:o,frozenIndex:r,tryShowHiddenFrozenColumn:i}=a.frozoneStore.state;if(void 0===r)return{isScrolled:!1,frozenIndex:void 0,frozenStyles:{},shouldFreezeMultiSelectColumn:!1,shouldShowStickyMultiSelectColumn:!1,isCollectionViewBlockSelected:!1};const n=(0,rr.gh)({theme:t.state}),s={...(0,tt.oc)({environment:y,collectionContextStore:a,isPhone:e.isPhone,theme:n}),display:"flex",...o&&-1===r&&{height:"calc(100% + 1px)",borderBottom:`1px solid ${n.tableDividerColor}`}},l=Boolean(o&&-1===r),c=Boolean(l&&(i||D)),d=a.collectionViewBlockStore(),u=!!d&&(0,nc.sY)(d);return{isScrolled:Boolean(o),frozenIndex:r,frozenStyles:s,shouldFreezeMultiSelectColumn:l,shouldShowStickyMultiSelectColumn:c,isCollectionViewBlockSelected:u}}),[D,a,y],{useDeepEqual:!0}),H=(0,X.VK)((()=>ae.VM({collectionContextStore:a,reducerResult:T,isFullScreen:u})),[a,u,T]),z=(0,i.useMemo)((()=>t?[t]:[]),[t]),K=(0,i.useMemo)((()=>void 0!==T&&T.blockIds.length>0),[T]),W=(0,X.VK)((()=>""!==a.searchQueryStore.state),[a]),U=(0,X.VK)((()=>!ka.MQ.state&&fe({collectionContextStore:a,groupsPointer:z,hasPartialResults:K})),[a,z,K]),$=(0,X.VK)((()=>a.viewIsFlushToTopbar()),[a]),Q=(0,X.VK)((()=>Boolean(a.normalizedFormatStore.state.hide_table_vertical_lines)),[a]),ee=(0,X.VK)((()=>{const e=a.collectionViewStore();return M&&x.isMobile&&!(null!=e&&e.isSyncedCollection())}),[M,a,x.isMobile]),te=(0,X.VK)((()=>ve({collectionContextStore:a,groupsPointer:z})),[a,z]),oe=(0,X.VK)((()=>Nu(r,v)),[r,v]),re=(0,X.VK)((()=>(0,ge.qG)(o.id)),[o]),ie=(0,i.useCallback)((()=>{if(!w)return;const e=a.collectionStore();if(!e||!a.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const t=st.default.state.stores[0];if(!t)return;const o=a.subitemTreeStore.state,r=(0,et.DY)(o.children,(e=>e.value.store===t));if(!r)return;const i=r?(0,rt.Af)(r.map((e=>e.value.store))):"",n=a.subitemExpandedStore.state.get(i);Boolean(null==n?void 0:n.isExpanded)&&q.createAndCommit({userAction:"TableGroupResults.onItemShiftEnter",environment:y,perform:o=>{const i=E.yk({environment:y,collectionContextStore:a,groupsPointer:w.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:r,subitemInsertDirection:"into",from:"table_group_results_shift_enter"});if(i&&m){const e=()=>{ct.bA({isNewBlock:!0,environment:y,blockPropertyValueOverlayStore:m,store:i,property:"title",format:mt.C.Table,collectionContextStore:a})};$e.default.checkGate({gateName:"collections_item_mounted_callbacks"})?a.registerCallbackForItemMounted(i,e):l.default.afterNextFlush((()=>{l.default.afterNextFlush(e)}))}}})}),[m,a,y,w]),ne=(0,i.useCallback)((e=>{const o=new ic.sA(y,"handleAddRowClick"),r=t?[t]:[],i=a.groupsStore.getGroupState(r);Nt.M_(y)&&i?(a.searchQueryStore.state&&le.Ug({searchQuery:"",collectionContextStore:a,isFullScreen:u}),q.createAndCommit({userAction:"TableGroupResults.handleAddRowClick",environment:y,perform:n=>{var s;const c=E.IW({environment:y,collectionContextStore:a,groupsPointer:t?[t]:[],shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:n,from:"table_group_results",tracker:o,useCrdt:(0,jt.SL)({event:e,source:"collection_table_view",contextualDefault:null===(s=a.defaultPageTemplateStore.state)||void 0===s?void 0:s.useCrdt()})});if(!c)return;const u=c.newStore;if(x.isMobile){const e=(0,lo.ZP)({store:u,fullyQualified:!1,pageVisitSource:d.tY.Create});b?b(e):zt.c4({environment:y,url:e})}else{if(c.coercionSucceeded){const e=()=>{ct.bA({isNewBlock:!0,environment:y,blockPropertyValueOverlayStore:m,store:u,property:"title",format:mt.C.Table,collectionContextStore:a})};$e.default.checkGate({gateName:"collections_item_mounted_callbacks"})?(a.registerCallbackForItemMounted(u,e),n.postSubmitCallbacks.push((async e=>{if(!e)return a.virtualizedModule.waitToScrollToBlock(r,u)}))):l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{l.default.afterNextFlush(e)}))}))}else se.CH({environment:y,store:u,peekMode:ae.kr(a),resultsStore:i.resultsStore,collectionContextStore:a,pageVisitSource:d.tY.Create});const e=a.currentSubitemFormatStoreForCollectionStore.state;lt.W(y,{from:e?"table_add_parent_item_bottom":"table_add_item_bottom",type:"page",new_page_id:u.id,creating_block_id:u.id,...(0,Ke.Pn)(a)})}}})):o.fail("invalid_state")}),[m,a,x.isMobile,y,t,u,b]),ce=(0,i.useCallback)((e=>{const o=a.groupsStore.getGroupState(t);if(!o)return;const r=o.reducerResultStore.state;(0,ye.Wi)(e),G.ZH({debug:{userAction:"TableGroupResults.handleLoadMoreClick"},environment:y}),r&&E.ID({collectionContextStore:a,environment:y,incrementLimitArgs:{isFullScreen:u,currentResultCount:r.blockIds.length,groupsPointer:o.groupsPointer,incrementLimitsInRelatedGroups:!1}}),I.uD(y)}),[a,y,t,u]),ue=(0,X.VK)((()=>{var e;return null===(e=a.inheritedBlockColorStore.state)||void 0===e?void 0:e.background}),[a]),pe=(0,J.yK)((e=>({iconStyle:{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor},viewAllButton:{borderTop:`1px solid ${e.tableDividerColor}`,paddingTop:6,paddingBottom:6},loadMoreButton:{display:"flex",alignItems:"center",height:Au+1,width:"100%",paddingLeft:Du,paddingBottom:2,fontSize:14,lineHeight:j.Z.lineHeight.UIRegular.desktop,borderBottom:`1px solid ${e.tableDividerColor}`,whiteSpace:"break-spaces"},loadMoreButtonHovered:{...te?{background:e.whiteButtonBackground}:{}},loadMoreButtonInner:{display:"flex",alignItems:"center",color:e.lightTextColor,position:"sticky",left:Du},addRowButton:{borderBottom:`1px solid ${e.tableDividerColor}`,display:"flex",alignItems:"center",height:Au,width:"100%",paddingLeft:8,fontSize:14,lineHeight:j.Z.lineHeight.UIRegular.desktop,background:ue||(p?e.cardContentBackground:e.contentBackground),left:0,right:0},addRowButtonInner:{display:"inline-flex",alignItems:"center",position:"sticky",left:8,color:e.lightTextColor},aggregationRow:{...(!_||F)&&{opacity:0,pointerEvents:"none",left:0,right:0}},aggregationRowPlaceholder:{height:F?0:Lu}})),[ue,p,te,_,F]),he=(0,X.VK)((()=>a.isUnlistedViewStore.state&&a.isInlineViewStore.state),[a]);if(!w)return null;const me=_&&!U&&0===(null==T?void 0:T.blockIds.length),Ce=Boolean(t),ke=$&&!Ce;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(qd,{store:o,format:oe,groupFormat:t,schema:n,query:s,collectionContextStore:a,isInPeekRenderer:p,minWidth:S,paddingBottom:g,blockPropertyValueOverlayStore:m,resultStore:w.reducerResultStore,showPropertyFormats:k,showRightActions:V.canConfigureCollection&&V.canConfigureBlock&&!he&&!re,allowHidingTitle:!1,tableStore:v,formatKey:"table_properties",disabled:h||!V.canConfigureBlock,disableTopBorder:!ke,disableCellRightBorder:!ke||Q,height:Eu,frozoneProps:Z,isInHomeWidget:F}),(0,C.jsx)("div",{style:{height:Eu}}),(0,C.jsx)(xu,{store:o,format:oe,schema:n,query:s,collectionContextStore:a,minWidth:S,blockPropertyValueOverlayStore:m,showPropertyFormats:k,disabled:!M,groupFormat:t,tableStore:v,paddingLeft:f,render:e=>(0,C.jsx)(Fu,{args:e,store:o,collectionContextStore:a,collectionViewFormat:oe,blockPropertyValueOverlayStore:m,groupFormat:t,propertyFormats:k,schema:n,canDrag:ee,disabled:h,titleColumnIndex:L,onShiftEnter:ie,frozoneProps:Z,isInHomeWidget:F,isFullScreen:u})}),U&&(0,C.jsx)(Ru,{isFullScreen:u,hasGroups:void 0!==t,propertyWidths:A,hasPartialResults:K,hasSearchQuery:W,frozoneProps:Z}),me&&(0,C.jsx)(kc,{collectionContextStore:a,shouldShowAddRowButton:N,handleAddRowClick:ne,paddingLeft:f}),(0,C.jsx)("div",{style:{width:B}}),H&&(F?(0,C.jsx)(Ae,{groupsPointer:z,store:o,collectionContextStore:a,format:r,isFullScreen:u,incrementLimitsInRelatedGroups:!1,style:pe.viewAllButton}):(0,C.jsx)(xe.Z,{onMouseDown:ye.$0,onClick:ce,disabled:te,hoveredStyle:pe.loadMoreButtonHovered,style:pe.loadMoreButton,children:(0,C.jsxs)("span",{style:pe.loadMoreButtonInner,children:[(0,Se.M)(pe.iconStyle),(0,C.jsx)(P.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"}),te?(0,C.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,C.jsx)(be.Z,{style:{width:12,height:12}})}):M&&(0,C.jsx)(Ne,{collectionContextStore:a,format:r})]})})),N&&(0,C.jsx)(xe.Z,{onClick:ne,onMouseDown:ye.$0,style:pe.addRowButton,className:dt.tfM,children:(0,C.jsxs)("span",{style:pe.addRowButtonInner,children:[(0,de.R)(pe.iconStyle),(0,C.jsx)(P.FormattedMessage,{defaultMessage:"New",id:"database.tableView.addRowButton"})]})}),(0,C.jsx)(bc,{groupFormat:t,disabled:h||!V.canConfigureBlock,schema:n,query:s,collectionContextStore:a,isInPeekRenderer:p,isFullScreen:u,showPropertyFormats:k,showRightActionsSpacer:V.canConfigureCollection,showHoverActionsStore:c,style:pe.aggregationRow}),(0,C.jsx)("div",{style:pe.aggregationRowPlaceholder})]})})),Iu=ju,Fu=i.memo((function(e){const t=(0,Y.O7)(),{args:o,store:r,collectionContextStore:n,collectionViewFormat:s,blockPropertyValueOverlayStore:a,groupFormat:c,propertyFormats:d,schema:u,canDrag:p,disabled:h,titleColumnIndex:m,onShiftEnter:S,frozoneProps:g,isInHomeWidget:f,isFullScreen:v}=e,y=(0,i.useMemo)((()=>c?[c]:[]),[c]),x=(0,X.VK)((()=>Boolean(n.normalizedFormatStore.state.hide_table_vertical_lines)),[n.normalizedFormatStore]),b=(0,X.VK)((()=>ae.fk({environment:t,collectionContextStore:n})),[n,t]),w=(0,X.VK)((()=>r.isNonEditableState()),[r]),k=(0,J.yK)((e=>({itemSelectableHalo:{borderRadius:3,zIndex:M.iO},itemSelectableStyle:{display:"flex",height:"calc(100% + 2px)"}})),[]),T=(0,i.useCallback)((()=>k.itemSelectableStyle),[k]),_=(0,i.useCallback)((e=>{const{store:o,parentStore:r,subitemPath:i,indentLevel:s}=e;if(r)return(0,C.jsx)(Ta,{store:o,collectionStore:r,subitemPath:i,indentLevel:s,collectionContextStore:n,disabled:h,groupsPointer:y,onSubitemCreate:e=>{if(a){const o=()=>{ct.bA({isNewBlock:!0,environment:t,blockPropertyValueOverlayStore:a,store:e,property:"title",format:mt.C.Table,collectionContextStore:n})};$e.default.checkGate({gateName:"collections_item_mounted_callbacks"})?n.registerCallbackForItemMounted(e,o):l.default.afterNextFlush((()=>{l.default.afterNextFlush(o)}))}}})}),[a,n,h,t,y]),V=(0,i.useMemo)((()=>({schema:u,collectionContextStore:n,propertyFormats:d,onPropertyTab:o.onPropertyTab,onPropertyUntab:o.onPropertyUntab,onPropertyEnter:o.onPropertyEnter,onPropertyClick:o.onPropertyClick,onPropertyEsc:o.onPropertyEsc,onPropertyBgClick:o.onPropertyBgClick,onPropertyContextMenu:o.onPropertyContextMenu,onOpenProperty:o.onOpenProperty,disabled:h,blockPropertyValueOverlayStore:a,disableCellBorderRight:x,disableHorizontalEdgeScroll:!1,disableLastCellBorderRight:w,disableTableWrap:!1,onShiftEnter:S,titleColumnIndex:m,groupFormat:c,frozoneProps:g,shouldShowMultiSelectCheckbox:b,isInHomeWidget:f})),[o.onOpenProperty,o.onPropertyBgClick,o.onPropertyClick,o.onPropertyContextMenu,o.onPropertyEnter,o.onPropertyEsc,o.onPropertyTab,o.onPropertyUntab,a,n,h,x,S,d,u,m,c,g,b,w,f]);return(0,C.jsx)(Tt,{collectionContextStore:n,groupsPointer:y,format:s,canDrag:p,resultProps:V,canDrop:!0,resultComponent:iu,disabled:h,direction:wt.Vertical,getItemSelectableStyle:T,itemSelectableHaloStyle:k.itemSelectableHalo,shouldShowHoverMenu:!0,analyticsName:"table",emptyDroppableSize:0,touchDragOnly:!0,onSelectableEnter:o.onSelectableEnter,blockPropertyValueOverlayStore:a,titleColumnIndex:m,nestedCreateSubitemButton:_,virtualizeResults:0===y.length&&v})}),pe.Z);function Nu(e,t){const{temporaryFormat:o}=t.state;return o||e}const Bu={position:"relative",float:"left",minWidth:"100%",WebkitUserSelect:"none",fontVariantNumeric:"lining-nums tabular-nums"},Eu=34,Au=32,Lu=32,Du=8,Zu=42;class Hu extends io.Z{constructor(){super(...arguments),this.storeTypes={tableStore:rc},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem=(e,t,o)=>Gu(e,t,o,this.environment,this.props.collectionContextStore),this.viewSettingsSidebarOpenStore=this.createComputedStore((()=>{var e;return this.props.collectionContextStore.settingsStore.state.open&&"sidebar"===(null===(e=this.props.viewSettingsPlacementStore)||void 0===e?void 0:e.state)}))}renderPersisted(){const{store:e,paddingBottom:t,paddingLeft:o,paddingRight:r,isFullScreen:i,collectionContextStore:n,format:s}=this.props,l=ae.az(n,i),a=s.collection_group_by,c=n.isInHomeWidgetStore.state;return(0,bn.Z)((s=>{const d=(0,C.jsx)(St.Z,{store:e,shouldShowHalo:!i&&!c,canSelect:!i,analyticsName:"table",style:{position:"relative"},...s,children:a?(0,C.jsx)(Uu,{collectionContextStore:this.props.collectionContextStore,store:this.props.store,format:this.props.format,schema:this.props.schema,disabled:this.props.disabled,isFullScreen:this.props.isFullScreen,paddingLeft:this.props.paddingLeft,isRootChild:this.props.isRootChild,isInPeekRenderer:this.props.isInPeekRenderer,query:this.props.query,showHoverActionsStore:this.props.showHoverActionsStore,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,minWidth:this.props.minWidth,paddingBottom:this.props.paddingBottom,tableStore:this.stores.tableStore,groupBy:a}):(0,C.jsx)(Wu,{store:this.props.store,format:this.props.format,schema:this.props.schema,query:this.props.query,collectionContextStore:this.props.collectionContextStore,showHoverActionsStore:this.props.showHoverActionsStore,isFullScreen:this.props.isFullScreen,isInPeekRenderer:this.props.isInPeekRenderer,disabled:this.props.disabled,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,minWidth:this.props.minWidth,paddingBottom:this.props.paddingBottom,paddingLeft:this.props.paddingLeft,tableStore:this.stores.tableStore,groupFormat:void 0})});return(0,C.jsxs)("div",{style:{...Bu,paddingBottom:t,paddingLeft:o,paddingRight:r},className:dt._so,children:[a?d:(0,C.jsx)(Si,{renderEmitter:n.renderEmitter,isFullScreen:i,children:d}),!l&&!$e.default.checkGate({gateName:"collections_virtualization"})&&(0,C.jsx)(Rt.Z,{onChange:e=>function(e,t,o,r){const i=t.isLoadingStore.state,n=t.groupsStore.getGroupState([]),s=null==n?void 0:n.reducerResultStore.state;e<Ft.Z.incrementScrollOffset&&s&&!i&&s.hasMore&&(t.infiniteScrollLongTaskObserver.observe(),E.ID({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:o,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}}))}(e,this.props.collectionContextStore,this.props.isFullScreen,this.environment)})]})}))}}Hu.displayName="Table";const zu=(0,P.injectIntl)(Hu);function Ku(e){let{args:t,isInPeekRenderer:o}=e;const{collectionContextStore:r}=t,i=(0,J.Fg)(),n=(0,X.VK)((()=>r.isInHomeWidgetStore.state),[r]);return(0,C.jsx)(Yr,{...t,height:n?It.yZ:Zu,paddingTop:8,toggleClosedMarginBottom:8,getComputedStickyStyle:e=>function(e,t,o){return{boxShadow:e?`0 -1px 0 ${t?o.cardContentBackground:o.contentBackground}`:void 0}}(e,o,i)})}function Gu(e,t,o,r,i){!function(e,t,o,r){if(r.device.isMobile)ne._c({environment:r,store:e,pageVisitSource:d.tY.Create});else{const{groupFormat:i}=t,n=i?[i]:[],s=o.groupsStore.getGroupState(n),l="collectionTypedView"===o.contextType;se.CH({environment:r,store:e,peekMode:ae.kr(o),showMoveTo:l,resultsStore:null==s?void 0:s.resultsStore,collectionContextStore:o,pageVisitSource:d.tY.Create})}}(e,o,i,r)}function Wu(e){let{groupFormat:t,store:o,format:r,schema:i,query:n,collectionContextStore:s,showHoverActionsStore:l,isFullScreen:a,isInPeekRenderer:c,disabled:d,blockPropertyValueOverlayStore:u,minWidth:p,paddingBottom:h,paddingLeft:m,tableStore:S}=e;const g=(0,X.qz)(S,rc);return(0,X.VK)((()=>s.groupsStore.getGroupState(t?[t]:[])),[s,t])?(0,C.jsx)(Iu,{tableStore:g,groupFormat:t,store:o,format:r,schema:i,query:n,collectionContextStore:s,showHoverActionsStore:l,isFullScreen:a,isInPeekRenderer:c,disabled:d,blockPropertyValueOverlayStore:u,minWidth:p,paddingBottom:h,paddingLeft:m}):null}function Uu(e){let{groupBy:t,collectionContextStore:o,store:r,format:n,schema:s,query:l,disabled:a,isFullScreen:c,paddingLeft:d,isRootChild:u,isInPeekRenderer:p,showHoverActionsStore:h,blockPropertyValueOverlayStore:m,minWidth:S,paddingBottom:g,tableStore:f}=e;const v=(0,J.Fg)(),y=(0,Y.O7)(),x=(0,i.useCallback)(((e,t,r)=>Gu(e,0,r,y,o)),[y,o]);return(0,C.jsx)(fn,{reducerId:"table_groups",store:r,collectionContextStore:o,disabled:a,isFullScreen:c,isRootChild:u,paddingLeft:d,stickyLeft:!0,renderGroup:e=>(0,C.jsx)(Wu,{store:r,format:n,schema:s,query:l,collectionContextStore:o,showHoverActionsStore:h,isFullScreen:c,isInPeekRenderer:p,disabled:a,blockPropertyValueOverlayStore:m,minWidth:S,paddingBottom:g,paddingLeft:d,tableStore:f,groupFormat:e}),getGroupStyle:e=>function(e,t,o){const r=t.viewIsFlushToTopbar();return t.isInHomeWidgetStore.state?{}:0!==e.index||r?t.shouldShowSpinnerStore.state&&e.index>0?{}:{borderTop:`1px solid ${o.tableDividerColor}`}:{}}(e,o,v),renderHeader:e=>(0,C.jsx)(Ku,{args:e,isInPeekRenderer:p}),onGroupHeaderAddItem:x})}var qu=o(396310),$u=o(164815),Qu=o(429657),Yu=o(535431),Xu=o(292595),Ju=o(933147);class ep extends Yu.Z{constructor(){super(...arguments),this.eventEmitter=new Ju.Z}findCollectionTimelineViewItems(e){return this.getMembersByDOMOrder({filter:t=>e.uiContains(t.props.store)})}register(e){const t=super.register(e);return this.eventEmitter.emit(),t}unregister(e){super.unregister(e),this.eventEmitter.emit()}addListener(e){this.eventEmitter.addListener(e)}removeListener(e){this.eventEmitter.removeListener(e)}}const tp=new ep;(0,Xu.exposeDebugValue)("GlobalCollectionTimelineViewItemRegistry",tp);var op=o(720294),rp=o(853465),ip=o(343350);const np=15,sp=33,lp=12,ap={position:"absolute",left:0,top:0,zIndex:M.Gt,width:"100%",height:"100%",pointerEvents:"none"};function cp(e){const{startItemPosition:t,value:o}=e;return t&&o?(o&&t&&o.left<=t.left&&(o.right<t.left?o.left=o.right:(o.left=t.left+lp,o.top=o.top-np)),o):o}function dp(e){const{startItem:t,endItem:o,endRelationPointer:r,timelineState:n,disabled:s,isFullScreen:a,isRootChild:c,relationType:d,isUserDrawnTemp:u,isNewSubitemPlaceholder:p,renderEmitter:h}=e,m=(0,jl.Y$)(),S=(0,Y.O7)(),g=(0,op.k)(),[f,v]=(0,i.useState)(!1),y=(0,J.Fg)(),[x,b]=(0,i.useState)(null),[w,k]=(0,i.useState)(null),T=(0,i.useCallback)((e=>{b(e.state)}),[]),_=(0,i.useCallback)((e=>{k(e.state)}),[]),V=(0,i.useCallback)((()=>{l.default.afterNextFlush((()=>{g()}))}),[g]);(0,i.useEffect)((()=>(b(t.stores.nodeStore.state),k(o?o.stores.nodeStore.state:null),t.stores.nodeStore.addListener(T),null==o||o.stores.nodeStore.addListener(_),null==h||h.addListener(V),m.filtersBarOpenStore.addListener(V),()=>{t.stores.nodeStore.removeListener(T),null==o||o.stores.nodeStore.removeListener(_),null==h||h.removeListener(V),m.filtersBarOpenStore.removeListener(V)})),[t,o,h,T,_,V,m.filtersBarOpenStore]);const O=(0,X.VK)((()=>ht.ZP.state.isDragging&&ht.ZP.state.draggedStores.includes(t.props.store)),[t]),P=(0,X.VK)((()=>o&&ht.ZP.state.isDragging&&ht.ZP.state.draggedStores.includes(o.props.store)),[o]),R=(0,X.VK)((()=>{const e=ht.ZP.state;return e.isDragging?e.currentY-e.startY:0}),[]),j=x&&x.getBoundingClientRect().y+(O?R:0),I=(0,X.VK)((()=>{const e=t.itemPositionStore.state;return j&&e?{left:e.left,right:"subitem"===d?e.left+lp:e.right,top:"subitem"===d?j+np:j}:void 0}),[d,t.itemPositionStore,j]),F=w&&w.getBoundingClientRect().y+(P?R:0),N=(0,X.VK)((()=>{const e=F&&null!=o&&o.itemPositionStore.state?{...o.itemPositionStore.state,top:F}:void 0;return"subitem"===d?cp({startItemPosition:t.itemPositionStore.state,value:e}):e}),[o,F,d,t.itemPositionStore]),B=(0,X.VK)((()=>t.dateValueStore.state),[t]),E=(0,X.VK)((()=>null==o?void 0:o.dateValueStore.state),[o]),A=(0,X.VK)((()=>void 0!==n.dragState.state),[n]),L=(0,X.VK)((()=>void 0!==n.drawState.state),[n]),D=(0,X.VK)((()=>n.hoveredItem.state),[n.hoveredItem]),Z=f&&!A&&!L,H=(0,i.useCallback)((()=>{r&&!s&&Qu.IL({dependency:{store:t.props.store,relationPointer:r},collectionContextStore:m,environment:S,timelineState:n,isFullScreen:a,isRootChild:c})}),[t,s,r,m,S,n,a,c]),z=(0,i.useCallback)((()=>{v(!0)}),[v]),K=(0,i.useCallback)((()=>{v(!1)}),[v]),G=(0,i.useCallback)((e=>{if(N)return(0,C.jsx)(up,{topOffset:e,endPosition:N,handleCloseButtonClick:H})}),[N,H]),W=D===t.props.store,U=o&&D===o.props.store,q=W||U||Z||"subitem"===d?1:.7;let $;let Q=(0,X.VK)((()=>t.props.store.canEdit()),[t.props.store]);"subitem"===d?($=y.collectionUnsetDependencyArrow,Q=!1):B&&E&&($=B<=E?y.collectionValidDependencyArrow:y.collectionInvalidDependencyArrow);const ee=(0,J.yK)((()=>({svgStyle:{zIndex:"dependency"===d&&(Z||U)?M.Gt:M.wx}})),[d,Z,U]);return I?u?(0,C.jsx)(pp,{startPosition:I,timelineState:n}):p?(0,C.jsx)(hp,{startPosition:I,timelineState:n}):t!==o&&N?(0,C.jsx)(mp,{startPosition:I,endPosition:N,strokeOpacity:q,strokeColorOverride:$,svgStyle:ee.svgStyle,cornerRadiusOverride:"subitem"===d?8:void 0,relationType:d,handleMouseMove:z,handleMouseLeave:K,renderChildren:Q&&Z?G:void 0}):null:null}function up(e){const{topOffset:t,endPosition:o,handleCloseButtonClick:r}=e,i=(0,J.yK)((e=>({icon:{background:e.white,borderRadius:5,fill:e.accentColors.red[500],height:14,width:14}})),[]);return(0,C.jsx)(C.Fragment,{children:(0,C.jsx)("foreignObject",{width:16,height:16,x:o.left-16,y:o.top-t+8,style:{cursor:"pointer",pointerEvents:"all"},onClick:r,children:(0,rp.X)(i.icon)})})}function pp(e){const{startPosition:t,timelineState:o}=e,r=(0,X.VK)((()=>{const e=o.drawState.state;if(!e||void 0===e.xOffsetPx||void 0===e.yOffsetPx)return;return{left:t.right+e.xOffsetPx+18,top:t.top+e.yOffsetPx}}),[t,o.drawState]);return r?(0,C.jsx)(mp,{startPosition:t,endPosition:r,strokeOpacity:1,relationType:"dependency"}):null}function hp(e){var t;const{startPosition:o,timelineState:r}=e,i=(0,J.Fg)(),n=(0,X.VK)((()=>r.dateRangePlaceholder.state),[r.dateRangePlaceholder]),s=(0,X.VK)((()=>null!=n&&n.active?n.date:void 0),[n]),l=null!=n&&n.active?null===(t=n.newTimelineItemProps)||void 0===t?void 0:t.subitemPath:void 0,a=l?l[l.length-1].children.length:0,c=o.top+a*sp+np+5,d=(0,X.VK)((()=>{const e=(0,Qi.HZ)({timelineState:r,dateValue:s,placeholderDate:s,subitemPlaceholderDate:void 0}),t=c&&e?{...e,top:c}:void 0;return cp({startItemPosition:o,value:t})}),[s,c,o,r]);return d?(0,C.jsx)(mp,{startPosition:o,endPosition:d,strokeOpacity:1,strokeColorOverride:i.collectionUnsetDependencyArrow,relationType:"subitem"}):null}function mp(e){const{startPosition:t,endPosition:o,strokeColorOverride:r,cornerRadiusOverride:n,strokeOpacity:s,relationType:l,svgStyle:a,handleMouseMove:c,handleMouseLeave:d}=e,u=(0,jl.Y$)(),p=(0,J.Fg)(),[h,m]=(0,i.useState)(0),S=t.right,g=t.top+np-h,f=o.left-3,v=o.top+np-h,y=(0,X.VK)((()=>{if(r)return r;return(0,Qi.H5)(u)&&t.right&&o.left?t.right<o.left?p.collectionValidDependencyArrow:p.collectionInvalidDependencyArrow:p.collectionUnsetDependencyArrow}),[u,o.left,t.right,r,p]);return(0,C.jsx)("svg",{style:{...ap,...a},ref:e=>{e&&m(e.getBoundingClientRect().top)},children:(0,C.jsx)(ip.Z,{startPoint:{x:S,y:g},endPoint:{x:f,y:v},style:{stroke:y,strokeWidth:Qi.lf,strokeOpacity:s},useRightAngles:"subitem"===l,showArrowHead:"dependency"===l&&!e.renderChildren,cornerRadiusOverride:n,handleMouseMove:c,handleMouseLeave:d,children:e.renderChildren&&e.renderChildren(h)})})}function Sp(e){const{timelineState:t,disabled:o,isReady:r,isFullScreen:n,isRootChild:s,renderEmitter:l}=e,a=(0,jl.Y$)(),c=(0,i.useCallback)((()=>{t.drawState.setState(void 0)}),[t.drawState]),d=(0,X.VK)((()=>a.collectionViewBlockStore()),[a]),u=(0,X.VK)((()=>a.settingsStore.state.open),[a]);if((0,i.useEffect)((()=>{var e;!u&&null!==(e=t.drawState.state)&&void 0!==e&&e.tryToCompleteDrawnArrow&&c()}),[u,t.drawState,c]),!r||!d)return null;const p=tp.findCollectionTimelineViewItems(d);return(0,C.jsx)(C.Fragment,{children:p.map((e=>{const{store:r,groupFormat:a}=e.props,c=null==a?void 0:a.value,d=c?(0,ee.Hd)(c):"noGroup";return(0,C.jsxs)(i.Fragment,{children:[(0,C.jsx)(gp,{startItem:e,timelineState:t,disabled:o,isFullScreen:n,isRootChild:s,renderEmitter:l,relationType:"dependency"},`${r.id}-${d}-${r.key}-dependency`),(0,C.jsx)(gp,{startItem:e,timelineState:t,disabled:o,isFullScreen:n,isRootChild:s,renderEmitter:l,relationType:"subitem"},`${r.id}-${d}-${r.key}-subitem`)]},`${r.id}-${d}-${r.key}`)}))})}function gp(e){const{startItem:t,timelineState:o,disabled:r,isFullScreen:n,isRootChild:s,relationType:l,renderEmitter:a}=e,{store:c,schema:d}=t.props,u=(0,jl.Y$)(),p=(0,X.VK)((()=>"dependency"===l?o.drawState.state:void 0),[o.drawState,l]),h=(0,X.VK)((()=>(null==p?void 0:p.startStore)===c),[c,p]),m=(0,X.VK)((()=>h&&!(null!=p&&p.tryToCompleteDrawnArrow)),[p,h]),S=(0,X.VK)((()=>"dependency"===l?h&&p?p.temporaryDependencyRelationPointers:(0,Qi.YE)(u,c,d):"subitem"===l?(0,Qi.ph)(u,c,d):[]),[l,h,p,u,c,d]),g=(0,X.VK)((()=>u.collectionViewBlockStore()),[u]),f=(0,X.VK)((()=>{var e;const r=o.dateRangePlaceholder.state;if("subitem"!==l||null==r||!r.active||!r.newTimelineItemProps)return;const i=r.newTimelineItemProps.subitemPath;return(i?null===(e=i[i.length-1])||void 0===e?void 0:e.value.store:void 0)===t.props.store?r:void 0}),[l,t.props.store,o.dateRangePlaceholder]),v=(0,Jo.E)("use_collection_reducer_request_hook"),[y,x]=(0,i.useState)(v?fp({collectionViewBlockStore:g}):[]);if((0,i.useEffect)((()=>{if(v){const e=()=>{const e=fp({collectionViewBlockStore:g});R.Xy(y,e)||x(e)};return tp.addListener(e),()=>tp.removeListener(e)}}),[v,g,y]),!g)return null;const b=v?y:fp({collectionViewBlockStore:g});return(0,C.jsxs)(C.Fragment,{children:[S.map((e=>{if(c.id===e.id)return null;const d=b.filter((t=>t.props.store.id===e.id));return(0,C.jsx)(i.Fragment,{children:d.map((i=>{const c=i.props.store,d=i.props.groupFormat;return(0,C.jsx)(dp,{startItem:t,endItem:i,endRelationPointer:e,timelineState:o,disabled:r,isFullScreen:n,isRootChild:s,renderEmitter:a,relationType:l},`${c.id}-${null==d?void 0:d.value.value}-${c.key}`)}))},e.id)})),"dependency"===l&&m&&(0,C.jsx)(dp,{isUserDrawnTemp:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:n,isRootChild:s,relationType:"dependency"}),"subitem"===l&&f&&(0,C.jsx)(dp,{isNewSubitemPlaceholder:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:n,isRootChild:s,relationType:"subitem"})]})}function fp(e){let{collectionViewBlockStore:t}=e;return t?tp.findCollectionTimelineViewItems(t):[]}var Cp=o(207525),vp=o(612457),yp=o(436488);const xp=function(e){let{zoomLevel:t,onChange:o}=e;const r=(0,J.Fg)(),i=(0,Y.O7)(),{device:n}=i;return(0,C.jsx)(Te.ZP,{popupType:n.isMobile?Ve.kQ.SlideUp:Ve.kQ.Popup,renderOrigin:e=>(0,C.jsxs)(Et.Z,{isSmall:!0,isGray:!0,...e,children:[(0,C.jsx)(bp,{zoomLevel:t}),(0,Zi.i)({width:10,marginLeft:4,fill:r.mediumIconColor})]}),originGap:8,render:e=>(0,C.jsx)(wp,{parent:e,zoomLevel:t,onChange:o})})};function bp(e){let{zoomLevel:t}=e;return"hours"===t?(0,C.jsx)(P.FormattedMessage,{id:"database.timelineView.zoomLevel.hours",defaultMessage:"Hours"}):"day"===t?(0,C.jsx)(P.FormattedMessage,{id:"database.timelineView.zoomLevel.day",defaultMessage:"Day"}):"week"===t?(0,C.jsx)(P.FormattedMessage,{id:"database.timelineView.zoomLevel.week",defaultMessage:"Week"}):"bi_week"===t?(0,C.jsx)(P.FormattedMessage,{id:"database.timelineView.zoomLevel.biWeek",defaultMessage:"Bi-week"}):"month"===t?(0,C.jsx)(P.FormattedMessage,{id:"database.timelineView.zoomLevel.month",defaultMessage:"Month"}):"quarter"===t?(0,C.jsx)(P.FormattedMessage,{id:"database.timelineView.zoomLevel.quarter",defaultMessage:"Quarter"}):"year"===t?(0,C.jsx)(P.FormattedMessage,{id:"database.timelineView.zoomLevel.year",defaultMessage:"Year"}):void(0,he.t1)(t)}function wp(e){let{parent:t,zoomLevel:o,onChange:r}=e;const i=(0,Y.O7)(),{device:n}=i,s=[{key:"calendar by section",render:e=>(0,C.jsx)(je.Z,{...e}),items:we.H.map((e=>({key:e,render:t=>(0,C.jsx)(Me.Z,{...t,title:(0,C.jsx)(bp,{zoomLevel:e})}),action:()=>{r(e),t.close()}})))}];return(0,C.jsx)(yp.Z,{capture:!0,allowEsc:!0,render:e=>{let r;return r=n.isMobile?{menuType:Oe.og.Modal,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Select a zoom level",id:"database.timelineView.mobileTimelineZoomPicker.title"}),right:(0,C.jsx)(nr.DoneMenuText,{}),onClickRight:t.close,...e}:{menuType:Oe.og.Popup,width:180,...e},(0,C.jsx)(Pe.Z,{...r,children:(0,C.jsx)(Re.Z,{type:Re.i.Vertical,sections:s,initialFocus:we.H.indexOf(o)})})}})}const kp=6,Tp=32;function _p(e){let{timelineState:t,scrollerLeftOffset:o,paddingLeft:i,showTable:n,isFullScreen:s,isRootChild:l,isReady:a,collectionContextStore:c,isInPeekRenderer:d,format:u,paddingRight:p}=e;const h=(0,J.Fg)(),m=(0,Y.O7)(),S=(0,X.VK)((()=>{const e=t.zoomLevel.state,{primaryDisplayUnit:l,secondaryDisplayUnit:a}=Qi.BJ[e],c=t.scrollLeft.state,{startTimestamp:d}=t.currentRange.state;if(void 0!==c){const t=d+(0,Qi.x2)(e,c+o+(!n&&s?i:0));return(0,Qi.DS)(r.ou.fromMillis(t),l).startOf(a).valueOf()}}),[t,o,i,n,s]),g=(0,Y.Fy)(),f=(0,X.VK)((()=>t.zoomLevel.state),[t]),v=(0,X.VK)((()=>t.outerSizeObserver.rect.state.width),[t]),{secondaryDisplayUnit:y}=Qi.BJ[f],x=(0,X.VK)((()=>(0,Qi.d$)({environment:m,isFullScreen:s,isRootChild:l})),[m,s,l]),b=(0,X.VK)((()=>c.permissionScopesStore.state),[c]),w=!n&&x&&b.canConfigureBlock,k=(0,X.VK)((()=>{var e;return(null===(e=c.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(d?h.cardContentBackground:h.contentBackground)}),[c,d,h]),T=d?h.cardContentBackgroundTransparent:h.contentBackgroundTransparent,_=(0,J.yK)((()=>({secondaryDisplayUnit:{position:"absolute",top:1,left:0,paddingLeft:s&&!n?o+i:o,display:"flex",alignItems:"center",height:Tp,paddingTop:kp+(g.isMobile?2:0),background:k,fontSize:14,fontWeight:j.Z.fontWeight.medium},outerContainer:{position:"sticky",left:0,width:v,zIndex:M.Qm,height:0},controlBarRight:{position:"absolute",top:1,right:0,paddingRight:p,display:"flex",alignItems:"center",height:Tp,paddingTop:kp+1,background:k},hideTableIcon:{paddingLeft:4,paddingRight:4,marginLeft:2,marginRight:4,marginTop:g.isIOS?0:1,height:22,fill:h.lightIconColor}})),[k,g.isIOS,g.isMobile,s,v,i,p,o,n,h.lightIconColor]);return(0,C.jsx)(Ur,{position:Rr.Top,children:(0,C.jsxs)("div",{style:_.outerContainer,children:[S&&(0,C.jsxs)("div",{style:_.secondaryDisplayUnit,children:[w&&(0,C.jsx)(Jt.Z,{render:e=>(0,C.jsx)(Et.Z,{isSmall:!0,onClick:()=>function(e,t,o,r,i,n){const s=r.collectionViewStore();if(!s)return;q.createAndCommit({userAction:"CollectionTimelineViewControlBar.handleShowTableClick",environment:e,perform:e=>{const o=(0,Qi.YP)(t,!0);re.FH({stores:[s],update:o,transaction:e})}}),I.CB(e,{...(0,Qi.Ii)({environment:e,collectionContextStore:r,timelineState:o,isFullScreen:i,isRootChild:n}),show:!0})}(m,u,t,c,s,l),style:_.hideTableIcon,...e,children:(0,Cp.t)({width:14})}),renderTooltip:()=>(0,C.jsx)(P.FormattedMessage,{id:"database.timelineView.controlHeader.showTableButton.title",defaultMessage:"Show table"})}),(0,C.jsx)("span",{style:{paddingLeft:w||g.isPhone?0:s||n?16:2},children:(0,Qi.qG)(S,y)}),!a&&!n&&(0,C.jsx)(Op,{}),(0,C.jsx)("div",{style:{width:30,marginRight:-30,height:"100%",backgroundImage:`linear-gradient(to right, ${k} 20%, ${T} 100%)`}})]}),(0,C.jsxs)("div",{style:_.controlBarRight,children:[(0,C.jsx)("div",{style:{width:30,marginLeft:-30,height:"100%",backgroundImage:`linear-gradient(to left, ${k} 20%, ${T} 100%)`}}),(0,C.jsx)(kl,{collectionContextStore:c}),(0,C.jsx)(xp,{zoomLevel:f,onChange:e=>function(e,t,o,r,i,n){Qu.Nf({timelineState:o,environment:t,zoomLevel:e,centerTimestamp:(0,Qi.al)(o)}),I.zI(t,(0,Qi.Ii)({environment:t,collectionContextStore:r,timelineState:o,isFullScreen:i,isRootChild:n}))}(e,m,t,c,s,l)}),(0,C.jsx)(Et.Z,{isSmall:!0,isGray:!0,onClick:()=>function(e,t,o,r,i,n,s){const l=t.zoomLevel.state,a=t.outerSizeObserver.rect.state.width,c=(0,Qi.xI)({environment:e,paddingLeft:o,format:r,isFullScreen:i,isRootChild:n}),d=(a-c)/2,u=(0,Qi.al)(t),p=u-(0,Qi.x2)(l,d);Qu.Nf({timelineState:t,environment:e,zoomLevel:l,centerTimestamp:p}),I.Al(e,{...(0,Qi.Ii)({environment:e,collectionContextStore:s,timelineState:t,isFullScreen:i,isRootChild:n}),type:"left"})}(m,t,i,u,s,l,c),style:{marginLeft:4,paddingLeft:4,paddingRight:4},children:(0,cl.f)({width:12,fill:h.mediumIconColor})}),(0,C.jsx)(Et.Z,{isSmall:!0,onClick:()=>function(e,t,o,r,i,n,s){const l=t.zoomLevel.state,a=(0,Qi.bK)({timestamp:Date.now(),environment:e,timelineState:t,paddingLeft:o,format:r});Qu.Nf({timelineState:t,environment:e,zoomLevel:l,centerTimestamp:a}),I.H6(e,(0,Qi.Ii)({environment:e,collectionContextStore:i,timelineState:t,isFullScreen:n,isRootChild:s}))}(m,t,i,u,c,s,l),children:(0,C.jsx)(P.FormattedMessage,{id:"database.timelineView.controlHeader.todayButton.title",defaultMessage:"Today"})}),(0,C.jsx)(Et.Z,{isSmall:!0,isGray:!0,onClick:()=>function(e,t,o,r,i,n,s){const l=t.zoomLevel.state,a=t.outerSizeObserver.rect.state.width,c=(0,Qi.xI)({environment:e,paddingLeft:o,format:r,isFullScreen:i,isRootChild:n}),d=(a-c)/2,u=(0,Qi.al)(t),p=u+(0,Qi.x2)(l,d);Qu.Nf({timelineState:t,environment:e,zoomLevel:l,centerTimestamp:p}),I.Al(e,{...(0,Qi.Ii)({environment:e,collectionContextStore:s,timelineState:t,isFullScreen:i,isRootChild:n}),type:"right"})}(m,t,i,u,s,l,c),style:{paddingLeft:4,paddingRight:4},children:(0,dl.o)({width:12,fill:h.mediumIconColor})})]})]})})}const Vp=i.memo(_p);function Op(){return(0,C.jsx)(vp.Z,{show:!0,showDelay:400,showHold:0,render:e=>e?(0,C.jsx)(be.Z,{style:{marginLeft:8,marginTop:1}}):void 0})}var Mp=o(97439);const Pp=function(e){let{isGrouped:t,format:o,collectionContextStore:r,isFullScreen:i,isRootChild:n,timelineState:s}=e;const l=(0,J.Fg)(),a=(0,Y.O7)(),{device:c}=a;return(0,C.jsx)(Jt.Z,{render:e=>(0,C.jsx)(Et.Z,{isSmall:!0,onClick:()=>function(e,t,o,r,i,n){const s=o.collectionViewStore();if(!s)return;q.createAndCommit({userAction:"CollectionTimelineViewHideTableButton.handleHideTableClick",environment:e,perform:e=>{const o=(0,Qi.YP)(t,!1);re.FH({stores:[s],update:o,transaction:e})}}),I.CB(e,{...(0,Qi.Ii)({environment:e,collectionContextStore:o,timelineState:n,isFullScreen:r,isRootChild:i}),show:!1})}(a,o,r,i,n,s),style:{position:"absolute",top:t?c.isIOS?3:4:c.isIOS?7:8,right:t?6:8,zIndex:M.MC,fill:l.lightIconColor},...e,children:(0,Mp.D)({width:14})}),renderTooltip:()=>(0,C.jsx)(P.FormattedMessage,{id:"database.timelineView.tableGroupResults.hideTableButton.title",defaultMessage:"Hide table"})})};var Rp=o(14577),jp=o(924211);function Ip(e){const{shouldShowShimmer:t,children:o}=e,r=(0,$o.Z)(t,0,100)?"notion-shimmer-timeline-transition notion-shimmer-timeline":"notion-shimmer-timeline-transition";return(0,C.jsx)("div",{className:r,style:{height:"100%"},children:o})}const Fp=4,Np=22,Bp=110,Ep=7,Ap=22,Lp=12,Dp=4,Zp=32;function Hp(e){const t=(0,Jo.E)("time_bar_refactor"),o=(0,P.injectIntl)(zp);return t?(0,C.jsx)(Kp,{...e}):(0,C.jsx)(o,{...e})}class zp extends s.Z{constructor(){super(...arguments),this.interval=void 0,this.handleSeconds=()=>{0===(new Date).getSeconds()&&this.enqueueForceUpdate()},this.activeRangeStore=this.createComputedStore((()=>{const{collectionContextStore:e,timelineState:t,query:o,schema:r,intl:i}=this.props,n=e.collectionStore();if(!n)return;const s=t.dragState.state,l=t.zoomLevel.state,a=t.hoveredItem.state,c=t.dateRangePlaceholder.state,{activeRangeType:d}=Qi.BJ[l];if(!d)return;let u;if(s)u=s.temporaryValues.map((e=>(0,Qi.XO)(e,"day")));else if(c.active)u=[(0,Qi.XO)(c.date,"day")];else{const{stores:t}=st.default.state,s=t.filter((e=>e.getAssociatedCollectionId()===n.id)),l=R.jj(R.oA([...s,a]));u=R.oA(l.map((t=>{const n=(0,Qi.bk)({store:t,query:o,schema:r,userId:e.getCurrentUserId(),intl:i});if(n)return(0,Qi.XO)(n,"day")})))}const p=R.F(u,(e=>{let{start:t}=e;return t.valueOf()})),h=R.UT(u,(e=>{let{end:t}=e;return t.valueOf()}));return p&&h?{start:p.start.valueOf(),end:h.end.valueOf()}:void 0}),{useDeepEqual:!0})}UNSAFE_willMount(e){super.UNSAFE_willMount(e)}didMount(){super.didMount(),this.interval=setInterval(this.handleSeconds,1e3)}willUnmount(){super.willUnmount(),clearInterval(this.interval)}renderComponent(){const{collectionContextStore:e,timelineState:t}=this.props,o=t.zoomLevel.state,i=Qi.BJ[o],{primaryDisplayUnit:n,activeRangeType:s}=i,l=(0,Qi.ST)(n),a=r.ou.now(),c=l?a.startOf("minute"):a.startOf("day"),d=a.startOf("minute"),{device:u}=this.environment,p=!e.groupsStore.anyGroupHasNonEmptyResults()&&fe({collectionContextStore:e,groupsPointer:[],hasPartialResults:!1});return(0,C.jsx)(Ur,{position:Rr.Top,children:(0,C.jsxs)("div",{style:Up(this.props.collectionContextStore,this.props.isInPeekRenderer,this.theme),children:[(0,C.jsx)("div",{style:{height:Tp,position:"relative",overflow:"hidden"},children:!u.isPhone&&(0,C.jsx)(oh,{timelineState:this.props.timelineState})}),(0,C.jsxs)("div",{style:{height:Zp,position:"relative",overflow:"hidden"},children:[(0,C.jsx)(Ip,{shouldShowShimmer:p,children:(0,C.jsx)(th,{timelineState:this.props.timelineState,nowTimeStartOfPrimaryDisplayUnit:c})}),"highlight_days"===s&&(0,C.jsx)(ih,{timelineState:this.props.timelineState,activeRangeStore:this.activeRangeStore}),(0,C.jsx)(rh,{timelineState:this.props.timelineState,time:c}),"display_range"===s&&(0,C.jsx)(ih,{timelineState:this.props.timelineState,activeRangeStore:this.activeRangeStore})]}),(0,C.jsx)(Yp,{timelineState:this.props.timelineState,time:d})]})})}}function Kp(e){const{collectionContextStore:t,isInPeekRenderer:o,timelineState:n,query:s,schema:l}=e,a=(0,Y.Fy)(),c=(0,P.useIntl)(),d=(0,op.k)(),u=(0,i.useCallback)((()=>{0===(new Date).getSeconds()&&d()}),[d]);(0,i.useEffect)((()=>{const e=setInterval(u,1e3);return()=>clearInterval(e)}),[u]);const{primaryDisplayUnit:p,activeRangeType:h}=(0,X.VK)((()=>{const e=n.zoomLevel.state;return Qi.BJ[e]}),[n]),m=(0,Qi.ST)(p),S=r.ou.now(),g=m?S.startOf("minute"):S.startOf("day"),f=S.startOf("minute"),v=(0,X.VK)((()=>!t.groupsStore.anyGroupHasNonEmptyResults()&&fe({collectionContextStore:t,groupsPointer:[],hasPartialResults:!1})),[t]),y=(0,X.VK)((()=>{var e;return null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background}),[t]),x=(0,X.VK)((()=>t.viewIsFlushToTopbar()),[t]),b=(0,J.yK)((e=>({wrapper:{position:"absolute",left:0,top:0,width:"100%",background:y||(o?e.cardContentBackground:e.contentBackground),borderTop:x?`1px solid ${e.tableDividerColor}`:"1px solid transparent",borderBottom:`1px solid ${e.tableDividerColor}`},controlBar:{height:Tp,position:"relative",overflow:"hidden"},primaryTimeBar:{height:Zp,position:"relative",overflow:"hidden"}})),[y,x,o]),w=new Rp.Z((()=>{const e=t.collectionStore();if(!e)return;const o=n.dragState.state,r=n.zoomLevel.state,i=n.hoveredItem.state,a=n.dateRangePlaceholder.state,{activeRangeType:d}=Qi.BJ[r];if(!d)return;let u;if(o)u=o.temporaryValues.map((e=>(0,Qi.XO)(e,"day")));else if(a.active)u=[(0,Qi.XO)(a.date,"day")];else{const{stores:o}=st.default.state,r=o.filter((t=>t.getAssociatedCollectionId()===e.id)),n=R.jj(R.oA([...r,i]));u=R.oA(n.map((e=>{const o=(0,Qi.bk)({store:e,query:s,schema:l,userId:t.getCurrentUserId(),intl:c});if(o)return(0,Qi.XO)(o,"day")})))}const p=R.F(u,(e=>{let{start:t}=e;return t.valueOf()})),h=R.UT(u,(e=>{let{end:t}=e;return t.valueOf()}));return p&&h?{start:p.start.valueOf(),end:h.end.valueOf()}:void 0}),{debugName:"activeRangeStore"});return(0,C.jsx)(Ur,{position:Rr.Top,children:(0,C.jsxs)("div",{style:b.wrapper,children:[(0,C.jsx)("div",{style:b.controlBar,children:!a.isPhone&&(0,C.jsx)(oh,{timelineState:n})}),(0,C.jsxs)("div",{style:b.primaryTimeBar,children:[(0,C.jsx)(Ip,{shouldShowShimmer:v,children:(0,C.jsx)(th,{timelineState:n,nowTimeStartOfPrimaryDisplayUnit:g})}),"highlight_days"===h&&(0,C.jsx)(ih,{timelineState:n,activeRangeStore:w}),(0,C.jsx)(rh,{timelineState:n,time:g}),"display_range"===h&&(0,C.jsx)(ih,{timelineState:n,activeRangeStore:w})]}),(0,C.jsx)(Yp,{timelineState:n,time:f})]})})}function Gp(e,t,o){const r=o.zoomLevel.state,{startTimestamp:i}=o.currentRange.state,{primaryDisplayUnit:n,primaryDisplayUnitAlignment:s}=Qi.BJ[r],l=(0,Qi.DS)(e,n),a=(0,Qi.Ip)(e,n),c=(0,Qi.e$)(r,l.valueOf()-i),d=(0,Qi.e$)(r,e.valueOf()-i),u=(0,Qi.e$)(r,a.valueOf()-i)-c,p=t?Dp:0;return{left:("range_start"===s?d-u/2:d)-p,width:u+2*p}}function Wp(e,t,o,r,i){const n=e.setLocale(nl.SP),s=(0,Qi.xJ)(),l=r?i.regularTextColor:i.lightTextColor,a=r?i.regularTextColor:i.mediumTextColor,c=r?i.mediumTextColor:i.lightTextColor,d=n.toFormat("t").startsWith(n.toFormat("a"));if("fifteen_minutes"===o){if(s)return(0,C.jsx)("span",{style:{color:l},children:n.toFormat("H:mm")});{const e=(0,C.jsx)("span",{style:{color:a,paddingRight:d?void 0:3},children:n.toFormat("h:mm")}),t=(0,C.jsx)("span",{style:{color:c,paddingRight:d?3:void 0},children:n.toFormat("a")});return d?(0,C.jsxs)(C.Fragment,{children:[t,e]}):(0,C.jsxs)(C.Fragment,{children:[e,t]})}}if("hour"===o){if(s)return(0,C.jsx)("span",{style:{color:l},children:n.toFormat("H:mm")});{const e=(0,C.jsx)("span",{style:{color:a,paddingRight:d?void 0:3},children:n.toFormat("h")}),t=(0,C.jsx)("span",{style:{color:c,paddingRight:d?3:void 0},children:n.toFormat("a")});return d?(0,C.jsxs)(C.Fragment,{children:[t,e]}):(0,C.jsxs)(C.Fragment,{children:[e,t]})}}if("day"===o||"week"===o)return"week"===t||"bi_week"===t?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("span",{style:{color:c,paddingRight:3},children:n.toFormat("ccccc")}),(0,C.jsx)("span",{style:{color:a,padding:"2px 7px"},children:n.toFormat("d")})]}):(0,C.jsx)("span",{style:{color:l},children:n.toFormat("d")});(0,he.t1)(o)}function Up(e,t,o){var r;return{position:"absolute",left:0,top:0,width:"100%",background:(null===(r=e.inheritedBlockColorStore.state)||void 0===r?void 0:r.background)||(t?o.cardContentBackground:o.contentBackground),borderTop:e.viewIsFlushToTopbar()?`1px solid ${o.tableDividerColor}`:"1px solid transparent",borderBottom:`1px solid ${o.tableDividerColor}`}}function qp(e){return{color:e.regularTextColor,fontSize:Lp}}function $p(e){return{background:e.timelineRed,width:Ap,height:Ap,borderRadius:Ap/2,position:"absolute",left:`calc(50% - ${Ap/2}px)`,top:`calc(50% - ${Ap/2}px)`}}function Qp(e){let{time:t,accent:o,timelineState:r}=e;const i=(0,J.Fg)(),n=(0,X.VK)((()=>r.zoomLevel.state),[r]),{primaryDisplayUnit:s}=Qi.BJ[n],{left:l,width:a}=(0,X.VK)((()=>Gp(t,!1,r)),[t,r]);return(0,C.jsx)("div",{style:{position:"absolute",top:0,left:l,width:a,height:Zp-4,display:"flex",alignItems:"start",lineHeight:Zp-4+"px"},children:(0,C.jsx)("div",{style:{fontSize:Lp,margin:"0 auto"},children:Wp(t,n,s,o,i)})})}function Yp(e){let{time:t,timelineState:o}=e;const r=(0,J.Fg)(),i=(0,X.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:n}=(0,X.VK)((()=>o.currentRange.state),[o]),s=Math.floor((0,Qi.e$)(i,t.valueOf()-n));return(0,C.jsx)("div",{style:{position:"absolute",left:s-Ep/2+.5,top:Math.floor(Zp+Tp-Ep/2+.5),width:Ep,height:Ep,background:r.timelineRed,borderRadius:"100%"}})}function Xp(e){let{time:t,timelineState:o,intl:r}=e;const i=(0,J.Fg)(),n=(0,Y.O7)(),s=(0,X.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:l}=(0,X.VK)((()=>o.currentRange.state),[o]),{secondaryDisplayUnit:a}=Qi.BJ[s],c=(0,Qi.e$)(s,t.valueOf()-l);return(0,C.jsx)("div",{style:{position:"absolute",top:0,left:c,height:Zp,color:i.regularTextColor,fontSize:14,fontWeight:j.Z.fontWeight.medium,verticalAlign:"middle",paddingTop:kp+(n.device.isMobile?2:0),display:"flex",alignItems:"center"},children:(0,Qi.EW)((0,jp.E2)(r),t.valueOf(),a)},c)}function Jp(e){let{start:t,end:o,rangeWidth:r}=e;const i=(0,J.Fg)();return t&&o?r>=Bp?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{style:qp(i),children:(0,ll.Yx)(t.valueOf(),"month_day",nl.SP)}),(0,C.jsx)("div",{style:{flexGrow:1}}),(0,C.jsx)("div",{style:qp(i),children:(0,ll.Yx)(o.valueOf(),"month_day",nl.SP)})]}):(0,C.jsxs)("div",{style:qp(i),children:[(0,ll.Yx)(t.valueOf(),"month_day",nl.SP)," – ",t.month===o.month?(0,ll.Yx)(o.valueOf(),"day",nl.SP):(0,ll.Yx)(o.valueOf(),"month_day",nl.SP)]}):(0,C.jsx)("div",{style:qp(i),children:(0,ll.Yx)(t.valueOf(),"month_day",nl.SP)})}function eh(e,t,o,r){const i=e.setLocale(nl.SP),n=(0,Qi.ST)(o),s=(0,Qi.xJ)();return n?s?(0,C.jsx)("span",{style:{color:r.timelineRed},children:i.toFormat("H:mm")}):(0,C.jsx)("span",{style:{color:r.timelineRed,paddingRight:3},children:i.toFormat("t")}):"week"===t||"bi_week"===t?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("span",{style:{color:r.lightTextColor,paddingRight:3},children:i.toFormat("ccccc")}),(0,C.jsxs)("div",{style:{position:"relative"},children:[(0,C.jsx)("div",{style:$p(r)}),(0,C.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:i.toFormat("d")})]})]}):(0,C.jsxs)("div",{style:{position:"relative"},children:[(0,C.jsx)("div",{style:$p(r)}),(0,C.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:i.toFormat("d")})]})}function th(e){let{nowTimeStartOfPrimaryDisplayUnit:t,timelineState:o}=e;const i=(0,X.VK)((()=>o.zoomLevel.state),[o]),{startTimestamp:n,endTimestamp:s}=(0,X.VK)((()=>o.currentRange.state),[o]),l=Qi.BJ[i],{primaryDisplayUnit:a,hidePrimaryIndicatorIntersectionOffset:c}=l,d=c||0,u=(0,X.VK)((()=>Gp(t,!1,o)),[t,o]),p=u.left+d,h=u.left+u.width-d,m=[];let S=(0,Qi.DS)(r.ou.fromMillis(n),a);const g=(0,X.VK)((()=>Gp(S,!1,o)),[S,o]);for(;S.valueOf()<s;){const e=g.left+d,t=g.left+g.width-d;void 0!==c&&(p>=e&&p<=t||h>=e&&h<=t)||m.push((0,C.jsx)(Qp,{timelineState:o,time:S,accent:!1},S.valueOf()));const r=(0,Qi.Ip)(S,a);S=r}return(0,C.jsx)(C.Fragment,{children:m})}function oh(e){let{timelineState:t}=e;const o=(0,P.useIntl)(),i=(0,X.VK)((()=>t.zoomLevel.state),[t]),{startTimestamp:n,endTimestamp:s}=(0,X.VK)((()=>t.currentRange.state),[t]),l=Qi.BJ[i],{primaryDisplayUnit:a,secondaryDisplayUnit:c}=l,d=[];let u=(0,Qi.DS)(r.ou.fromMillis(n),c);for(;u.valueOf()<s;){d.push((0,C.jsx)(Xp,{timelineState:t,intl:o,time:u},u.valueOf()));const e=(0,Qi.Ip)(u,c);u=(0,Qi.xP)(e,a)}return(0,C.jsx)(C.Fragment,{children:d})}function rh(e){let{time:t,timelineState:o}=e;const r=(0,J.Fg)(),i=(0,X.VK)((()=>o.zoomLevel.state),[o]),{primaryDisplayUnit:n}=Qi.BJ[i],{left:s,width:l}=(0,X.VK)((()=>Gp(t,!0,o)),[t,o]);return(0,C.jsx)("div",{style:{position:"absolute",top:0,left:s,width:l,height:Zp-4,display:"flex",alignItems:"center",fontWeight:500},children:(0,C.jsx)("div",{style:{fontSize:Lp,margin:"0 auto",display:"flex"},children:eh(t,i,n,r)})},s)}function ih(e){let{timelineState:t,activeRangeStore:o}=e;const i=(0,J.Fg)(),n=(0,X.VK)((()=>t.zoomLevel.state),[t]),{startTimestamp:s,endTimestamp:l}=(0,X.VK)((()=>t.currentRange.state),[t]),a=Qi.BJ[n],{activeRangeType:c}=a,d=(0,X.VK)((()=>o.state),[o]);if(d){const e=(0,Qi.DS)(r.ou.fromMillis(d.start),"day"),o=(0,Qi.e$)(n,e.valueOf()-s);if("highlight_days"===c){const a=[];let c=r.ou.fromMillis(Math.max(e.valueOf(),(0,Qi.DS)(r.ou.fromMillis(s),"day").valueOf()));for(;c.valueOf()<d.end&&c.valueOf()<l;){a.push(c);c=(0,Qi.Ip)(c,"day")}const u=(0,Qi.e$)(n,c.valueOf()-s)-o+2*Fp,p=a.map(((e,o)=>(0,C.jsx)(Qp,{timelineState:t,time:e,accent:0===o||o===a.length-1},`${e.toString()}-${o}`)));return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{style:{position:"absolute",top:0,left:o-Fp,width:u,marginTop:(Zp-Np)/2-2,height:Np,background:i.timelineDarkerBackground,borderRadius:Np/2}}),p]})}{const t=(0,Qi.DS)(r.ou.fromMillis(d.end),"day"),l=(0,Qi.cK)(r.ou.fromMillis(d.end),"day"),a=(0,Qi.e$)(n,t.valueOf()-s)-o+2*Fp;return(0,C.jsx)("div",{style:{display:"flex",alignItems:"center",position:"absolute",top:0,left:o-Fp,minWidth:a,marginTop:(Zp-Np)/2-2,height:Np,background:i.timelineDarkerBackground,borderRadius:Np/2,paddingLeft:6,paddingRight:6},children:(0,C.jsx)(Jp,{start:e,end:e.valueOf()!==l.valueOf()?l:void 0,rangeWidth:a})})}}return null}function nh(e){let{timelineState:t}=e;const o=(0,op.k)(),r=(0,i.useCallback)((()=>{0===(new Date).getSeconds()&&o()}),[o]);(0,i.useEffect)((()=>{const e=setInterval(r,1e3);return()=>clearInterval(e)}),[r]);const n=(0,X.VK)((()=>t.zoomLevel.state),[t]),{startTimestamp:s,endTimestamp:l}=(0,X.VK)((()=>t.currentRange.state),[t]);return(0,C.jsxs)("div",{style:{position:"absolute",width:"100%",height:"100%",overflow:"hidden",cursor:"default"},children:[(0,C.jsx)(dh,{zoomLevel:n,startTimestamp:s,endTimestamp:l}),(0,C.jsx)(uh,{zoomLevel:n,startTimestamp:s,endTimestamp:l}),(0,C.jsx)(ch,{zoomLevel:n,startTimestamp:s})]})}zp.displayName="CollectionTimelineViewTimeBar";const sh=i.memo(nh,pe.Z),lh=i.memo((function(e){let{start:t,zoomLevel:o,startTimestamp:r}=e;const i=(0,J.yK)((e=>{const i=t.plus({day:2}).startOf("day"),n=(0,Qi.e$)(o,t.valueOf()-r);return{weekendIndicator:{position:"absolute",left:n,width:(0,Qi.e$)(o,i.valueOf()-r)-n,height:"100%",background:e.timelineDarkerBackground}}}),[t,r,o]);return(0,C.jsx)("div",{style:i.weekendIndicator},t.valueOf())}),pe.Z),ah=i.memo((function(e){let{time:t,zoomLevel:o,startTimestamp:r}=e;const i=(0,J.yK)((e=>({verticalDivider:{position:"absolute",left:(0,Qi.e$)(o,t-r),height:"100%",borderRight:`1px solid ${e.regularDividerColor}`}})),[r,t,o]);return(0,C.jsx)("div",{style:i.verticalDivider},t)}),pe.Z),ch=i.memo((function(e){let{zoomLevel:t,startTimestamp:o}=e;const i=(0,J.yK)((e=>{const i=r.ou.now().startOf("minute");return{nowVerticalDivider:{position:"absolute",left:Math.floor((0,Qi.e$)(t,i.valueOf()-o)),height:"100%",borderRight:`1px solid ${e.timelineRed}`}}}),[o,t]);return(0,C.jsx)("div",{style:i.nowVerticalDivider})}),pe.Z),dh=i.memo((function(e){let{zoomLevel:t,startTimestamp:o,endTimestamp:i}=e;const{showWeekendIndicators:n}=Qi.BJ[t];if(!n)return null;let s=(0,Qi.DS)(r.ou.fromMillis(o),"day");const l=[];for(;s.valueOf()<i;)6===s.weekday&&l.push((0,C.jsx)(lh,{start:s,zoomLevel:t,startTimestamp:o},s.valueOf())),s=(0,Qi.Ip)(s,"day");return(0,C.jsx)(C.Fragment,{children:l})}),pe.Z),uh=i.memo((function(e){let{zoomLevel:t,startTimestamp:o,endTimestamp:i}=e;const{verticalDividerUnit:n}=Qi.BJ[t];if(!n)return null;const s=[];let l=(0,Qi.DS)(r.ou.fromMillis(o),n);for(;l.valueOf()<i;)s.push((0,C.jsx)(ah,{time:l.valueOf(),zoomLevel:t,startTimestamp:o},l.valueOf())),l=(0,Qi.Ip)(l,n);return(0,C.jsx)(C.Fragment,{children:s})}),pe.Z);const ph=function(e){let{store:t,collectionContextStore:o,groupFormat:r}=e;const i=(0,Y.O7)(),n=(0,X.VK)((()=>hh(t)),[t]);return(0,C.jsx)(St.Z,{store:t,style:{width:"100%",height:qu.Z+1},canDropBelow:!0,canNativeDropBelow:!0,shouldShowDropZone:!0,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,canInsertAbove:!0,canInsertBelow:!0,onInsertBelow:n?mh(n,i,t,o,r):void 0,onInsertAbove:n?Sh(n,i,t,o,r):void 0,onSelectableDrop:e=>function(e,t,o,r,i){const{droppedDirection:n,droppedStores:s,duplicate:l}=e,a=hh(o);if(!a)return;const c=r.subitemTreeStore.state,d=(0,et.DY)(c.children,(e=>e.value.store===o)),u=qe.default.mark("collections.drop_item_lag");qe.default.measureAfterNextFlush(u,{environment:t,getData:()=>Ke.yr({collectionContextStore:r,is_native_drop:!1,is_empty:!1})});const p="collectionTypedView"===r.contextType;q.createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleDrop",environment:t,perform:e=>{E.by({environment:t,collectionStore:p?void 0:a,targetStore:o,droppedDirection:n,collectionContextStore:r,groupsPointer:i?[i]:[],droppedStores:s,duplicate:l,transaction:e,subitemPath:d,collapsedGroup:!1})}})}(e,i,t,o,r),onNativeDrop:e=>function(e,t,o,r,i){const{files:n,droppedDirection:s}=e,l=hh(i);if(!l)return;const a=o.collectionViewBlockStore(),c=qe.default.mark("collections.drop_item_lag");qe.default.measureAfterNextFlush(c,{environment:t,getData:()=>Ke.yr({collectionContextStore:o,is_native_drop:!0,is_empty:!1})}),a&&q.createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleNativeDrop",environment:t,perform:e=>{E.tQ({environment:t,collectionStore:l,targetStore:a,droppedDirection:s,collectionContextStore:o,groupsPointer:r?[r]:[],files:n,transaction:e})}})}(e,i,o,r,t),onRemove:e=>function(e,t){const{transaction:o}=e,r=hh(t);if(!r)return;E.Od({store:t,transaction:o})}(e,t),analyticsName:"timeline"},t.id)};function hh(e){return e.getAssociatedCollectionStore()}function mh(e,t,o,r,i){return n=>{const{insertStores:s,transaction:l}=n,a="collectionTypedView"===r.contextType;return E.$T({environment:t,collectionStore:a?void 0:e,collectionContextStore:r,groupsPointer:i?[i]:[],insertStores:s,store:o,before:!1,transaction:l})}}function Sh(e,t,o,r,i){return n=>{const{insertStores:s,transaction:l}=n,a="collectionTypedView"===r.contextType;return E.$T({environment:t,collectionStore:a?void 0:e,collectionContextStore:r,groupsPointer:i?[i]:[],insertStores:s,store:o,before:!0,transaction:l})}}function gh(e){let{store:t,groupFormat:o,collectionContextStore:r,canEdit:n,disabled:s,format:l}=e;const a=(0,Y.O7)(),[c]=(0,i.useState)((()=>new Ye.G(a,t.pointer))),d=(0,X.VK)((()=>r.groupsStore.getGroupState(o)),[r,o]),u=(0,X.VK)((()=>r.permissionScopesStore.state),[r]),p=(0,X.VK)((()=>r.collectionViewStore()),[r]),h=(0,X.VK)((()=>n&&u.canEditContent&&!u.isSyncedCollection&&a.device.isMobile&&!(null!=p&&p.isSyncedCollection())),[n,p,a,u]),m=(0,i.useMemo)((()=>{if(c)return(0,C.jsx)(St.Z,{store:c,shouldShowDropZone:n,canDropBelow:n,canNativeDropBelow:n,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:e=>function(e,t,o,r){const{droppedDirection:i,droppedStores:n,duplicate:s}=e,l=o.collectionStore();if(!l)return;const a=o.groupsStore.getGroupState(t);if(!a)return;const c=o.collectionViewBlockStore(),d=qe.default.mark("collections.drop_item_lag");qe.default.measureAfterNextFlush(d,{environment:r,getData:()=>Ke.yr({collectionContextStore:o,is_native_drop:!1,is_empty:!0})}),c&&q.createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableDrop",environment:r,perform:e=>{E.by({environment:r,collectionStore:l,targetStore:c,droppedDirection:i,collectionContextStore:o,groupsPointer:a.groupsPointer,droppedStores:n,duplicate:s,transaction:e,collapsedGroup:!1})}})}(e,o,r,a),onNativeDrop:e=>function(e,t,o,r){const{files:i,droppedDirection:n}=e,s=t.collectionStore();if(!s)return;const l=t.collectionViewBlockStore(),a=qe.default.mark("collections.drop_item_lag");qe.default.measureAfterNextFlush(a,{environment:r,getData:()=>Ke.yr({collectionContextStore:t,is_native_drop:!0,is_empty:!0})}),l&&q.createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableNativeDrop",environment:r,perform:e=>{E.tQ({environment:r,collectionStore:s,targetStore:l,droppedDirection:n,collectionContextStore:t,groupsPointer:o?[o]:[],files:i,transaction:e})}})}(e,r,o,a),analyticsName:"timeline",style:{width:"100%"}})}),[n,r,a,o,c]);return d?(0,C.jsxs)(C.Fragment,{children:[m,(0,C.jsx)(Tt,{collectionContextStore:r,groupsPointer:d.groupsPointer,format:l,canDrag:h,disableRequest:!0,resultProps:{groupFormat:o,collectionContextStore:r,isLast:!1,handleOpenPeekPage:R.ZT},canDrop:!0,resultComponent:ph,disabled:s,direction:wt.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,touchDragOnly:!0,disableSelectable:!0,nestedCreateSubitemButton:Ch})]}):null}const fh=i.memo(gh,pe.Z);function Ch(e){return(0,C.jsx)("div",{style:{width:"100%",height:qu.Z+1}})}var vh=o(31505),yh=o(239301),xh=function(e){return e[e.Hidden=0]="Hidden",e[e.VisibleInItem=1]="VisibleInItem",e[e.VisibleOutOfItem=2]="VisibleOutOfItem",e[e.NotDefined=3]="NotDefined",e}(xh||{});function bh(e){let{store:t,type:o,timelineState:r,scrollerLeftOffset:n,paddingLeft:s,format:l,itemPositionStore:a,dateValueStore:c,isDraggingViaTimelineItemStore:d,collectionContextStore:u,isFullScreen:p,isInPeekRenderer:h,isRootChild:m}=e;const S=(0,Y.O7)(),g=(0,i.useRef)(xh.NotDefined),f=(0,i.useRef)(null),v=(0,i.useRef)(null),[y,x]=(0,i.useState)(!1),b="left"===o?vh.Y:yh.n,w=(0,X.VK)((()=>r.outerSizeObserver.rect.state),[r]),k=(0,X.SI)((()=>{const e=a.state;if(e){const{left:t,right:i}=e;if(d.state)return xh.Hidden;const s=r.scrollLeft.state;if(void 0!==s){if("left"===o){const e=s+n;if(e-i>0)return xh.VisibleOutOfItem;if(e-t>0)return xh.VisibleInItem}else{const e=s+w.width;if(t-e>0)return xh.VisibleOutOfItem;if(i-e>0)return xh.VisibleInItem}return xh.Hidden}}return xh.NotDefined}),[d,a,w,n,r,o]),T=(0,J.yK)((e=>({arrow:{display:"flex",alignItems:"center",width:16,height:16,flexShrink:0,pointerEvents:"auto",background:y?e.regularIconColor:e.mediumIconColor,borderRadius:4,border:`1px solid ${e.contentBackground}`,..."left"===o&&{marginLeft:8,marginRight:4},..."right"===o&&{marginRight:8,marginLeft:4}},icon:{height:6,fill:h?e.cardContentBackground:e.contentBackground},wrap:{position:"sticky",left:"left"===o?n:w.width-220,width:220,height:Eu-6,marginTop:2,display:"flex",alignItems:"center",cursor:"pointer",flexDirection:"right"===o?"row-reverse":void 0,whiteSpace:"nowrap",textOverflow:"ellipsis",zIndex:M.fQ}})),[y,h,w,n,o]);(0,i.useLayoutEffect)((()=>{_()}),[]),(0,i.useEffect)((()=>(k.addListener(_),()=>{k.removeListener(_)})),[]),(0,i.useEffect)((()=>{k.enqueueRecompute()}));const _=(0,i.useCallback)((()=>{const e=f.current,t=v.current;if(e&&t){const o=k.state,r=o===xh.VisibleInItem||o===xh.VisibleOutOfItem;e.style.opacity=""+(r?1:0),e.style.transform=`scale(${r?1:.3})`,t.style.pointerEvents=o===xh.VisibleOutOfItem?"":"none";g.current!==xh.NotDefined&&o!==xh.NotDefined&&!e.style.transition&&(e.style.transition="transform 160ms ease-in-out, opacity 160ms ease-in-out"),g.current=o}}),[k]),V=(0,i.useCallback)((()=>{const e=c.state,i=r.zoomLevel.state,{snapUnit:n}=Qi.BJ[i],a=(0,Qi.x2)(i,200);if(e)if("left"===o){const{start:t}=(0,Qi.XO)(e,n),o=(0,Qi.GK)({timestamp:t.valueOf(),environment:S,timelineState:r,paddingLeft:s,format:l})-a;Qu.Nf({timelineState:r,environment:S,zoomLevel:i,centerTimestamp:o})}else{const{end:t}=(0,Qi.XO)(e,n),o=(0,Qi.PF)({timestamp:t.valueOf(),timelineState:r})+a;Qu.Nf({timelineState:r,environment:S,zoomLevel:i,centerTimestamp:o})}x(!1),G.Ys({environment:S,store:t}),I.gw(S,{...(0,Qi.Ii)({environment:S,collectionContextStore:u,timelineState:r,isFullScreen:p,isRootChild:m}),type:o})}),[u,c,S,l,p,m,s,t,r,o]),O=(0,i.useCallback)((()=>{S.device.isPhone||po.Z.state||x(!0)}),[S]),P=(0,i.useCallback)((()=>{S.device.isPhone||x(!1)}),[S]);return(0,C.jsxs)("div",{style:T.wrap,onMouseOver:O,onMouseOut:P,onMouseDown:ye.$0,onClick:V,ref:v,children:[(0,C.jsx)("div",{style:T.arrow,ref:f,children:b(T.icon)}),y&&(0,C.jsx)(kh,{dateValueStore:c,timelineState:r,isInPeekRenderer:h})]})}const wh=i.memo(bh,pe.Z);function kh(e){let{dateValueStore:t,timelineState:o,isInPeekRenderer:r}=e;const i=(0,J.yK)((e=>({dateRange:{fontSize:12,paddingLeft:4,paddingRight:4,borderRadius:4,background:r?e.peekTimelineBackground:e.timelineBackground,pointerEvents:"none"}})),[r]),n=(0,X.VK)((()=>t.state),[t]),s=(0,X.VK)((()=>o.zoomLevel.state),[o]);return n?(0,C.jsx)("span",{style:i.dateRange,children:(0,Qi._Q)(n,s)}):null}class Th extends s.Z{constructor(){super(...arguments),this.clonedStore=void 0,this.propertiesWrapElementRef=i.createRef(),this.storeTypes={nodeStore:c.default.createClass(null,{name:"nodeStore"})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove=e=>function(e,t,o,i,n,s,l,a,c){const d=o.dragState.state,u=o.drawState.state,{horizontalScroller:p}=o,h=o.scrollLeft.state,m=o.zoomLevel.state,S=o.currentRange.state,{snapUnit:g,getDateRangePlaceholderDuration:f}=Qi.BJ[m];if(!u&&po.Z.state||d||Vh(i,l,a,t)||!p||void 0===h||s)return;const C=p.getBoundingClientRect(),v=h+(e.clientX-C.left),y=(0,Qi.x2)(m,v),x=r.ou.fromMillis(S.startTimestamp+y),b=(0,Qi.DS)(x,g),w=(0,Qi.DS)(f(x),g),k=(0,al.hT)(b.valueOf(),(0,He.r)()),T=(0,Qi.AZ)({startValue:k,snapUnit:g,desiredStart:b,desiredEnd:w});o.dateRangePlaceholder.setState({active:!0,store:i,parentStore:c.state,groupFormat:n,date:T,newTimelineItemProps:void 0,existingTimelineItemProps:{query:l,schema:a}})}(e,this.environment,this.props.timelineState,this.props.store,this.props.groupFormat,this.props.disabled,this.props.query,this.props.schema,this.parentCollectionStore),this.handleClick=e=>{const{store:t,query:o,schema:r,timelineState:i,groupFormat:n,collectionContextStore:s}=this.props,l=i.dateRangePlaceholder.state,a=s.groupsStore.getGroupState(n);if(a)if(l.active){const{date:e}=l;q.createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:this.environment,perform:i=>{Qu.oP({environment:this.environment,store:t,query:o,schema:r,date:e,transaction:i})}}),i.dateRangePlaceholder.setState({active:!1})}else{const{timelineState:o,collectionContextStore:r}=this.props,{horizontalScroller:i}=o,n=o.scrollLeft.state,s=this.itemPositionStore.state,l=this.propertiesWrapElementRef.current;if(!i||void 0===n||!s||!l)return;const c=i.getBoundingClientRect(),u=n+(e.clientX-c.left),p=this.propertiesWrapElementRef.current;if(!p)return;const h=p.lastElementChild;if(!h)return;const m=n+(h.getBoundingClientRect().right-c.left);u>s.right&&u<=m&&(0,ye.ZP)({event,context:ye.Af.EditorClick,callback:()=>{(0,mu.X9)()||se.CH({environment:this.environment,store:t,openInNew:ui.DJ(e),peekMode:(0,ae.kr)(r),resultsStore:a.resultsStore,collectionContextStore:r,pageVisitSource:d.tY.PeekOpen})}})}},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onRefChange=e=>function(e,t){t.setState(e)}(e,this.stores.nodeStore),this.itemPositionStore=this.createComputedStore((()=>{const{timelineState:e}=this.props;return(0,Qi.HZ)({timelineState:e,dateValue:this.dateValueStore.state,placeholderDate:this.placeholderDateStore.state,subitemPlaceholderDate:this.subitemPlaceholderDateStore.state})})),this.shouldRenderDateRangeStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e)})),this.shouldRenderScrollArrowsStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e&&!e.isPlaceholder)})),this.subitemPlaceholderDateStore=this.createComputedStore((()=>{const{subitemPath:e}=this.props,t=(0,et.ub)(e);if(!t||Boolean(this.dateValueStore.state))return;const o=t.value.store,r=tp.findCollectionTimelineViewItems(o);if(r.length>0){return r[0].dateValueStore.state}})),this.placeholderDateStore=this.createComputedStore((()=>{const{store:e,timelineState:t,groupFormat:o}=this.props,r=t.dateRangePlaceholder.state;if(r.active&&r.store===e&&!r.newTimelineItemProps&&(0,ee.ZH)(r.groupFormat,o))return r.date})),this.dateValueStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.state,r=this.placeholderDateStore.state;if(r)return r;if(o){const t=o.stores.indexOf(e);if(t>=0)return o.temporaryValues[t]}return Vh(this.props.store,this.props.query,this.props.schema,this.environment)}),{useDeepEqual:!0}),this.isDraggingViaTimelineItemStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.state,r=ht.ZP.state;return Boolean(o&&o.stores.includes(e)&&r.isDragging&&r.draggedStores.includes(e))})),this.parentCollectionStore=this.createComputedStore((()=>this.props.store.getAssociatedCollectionStore()))}get registries(){return[tp]}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.clonedStore=e.store.clone()}renderComponent(){var e;const{store:t,timelineState:o,scrollerLeftOffset:r,paddingLeft:i,format:n,query:s,schema:l,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,collectionContextStore:u,isFullScreen:p,isRootChild:h,toggleButton:m,groupFormat:S}=this.props,g=this.shouldRenderDateRangeStore.state,f=this.shouldRenderScrollArrowsStore.state,v=null===(e=u.groupsStore.getGroupState(S))||void 0===e?void 0:e.reducerResultStore;if(v)return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)("div",{style:{display:"flex",height:0},children:[f&&(0,C.jsx)(wh,{store:t,type:"left",timelineState:o,scrollerLeftOffset:r,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,paddingLeft:i,format:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:u,isFullScreen:p,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:h}),f&&(0,C.jsx)(wh,{store:t,type:"right",timelineState:o,scrollerLeftOffset:r,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,paddingLeft:i,format:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:u,isInPeekRenderer:this.props.isInPeekRenderer,isFullScreen:p,isRootChild:h})]}),(0,C.jsx)("div",{style:{display:"flex",height:qu.Z+1,width:"100%",cursor:"default"},onMouseDown:e=>function(e,t){const{target:o}=e;if(t.device.isMobile||!(o instanceof HTMLElement))return;(0,ye.ZP)({event:e,context:ye.Af.EditorMouseDown,callback:()=>{e.preventDefault(),H.AI({environment:t,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}(e,this.environment),onMouseMove:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_handleMouseMove,onMouseLeave:()=>function(e){e.dateRangePlaceholder.setState({active:!1})}(this.props.timelineState),onClick:this.handleClick,className:dt.o4s,ref:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onRefChange,children:g&&(0,C.jsx)(ro.es,{store:t,parentStore:this.parentCollectionStore.state,toggleButton:m,clonedStore:this.clonedStore,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,query:s,schema:l,timelineState:o,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,scrollerLeftOffset:r,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:u,isFullScreen:p,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:h,intl:We.default.getIntl(),propertiesWrapElementRef:this.propertiesWrapElementRef,resultStore:v,handleOpenPeekPage:this.props.handleOpenPeekPage})})]})}}Th.displayName="CollectionTimelineViewItem";const _h=Th;function Vh(e,t,o,r){return(0,Qi.bk)({store:e,query:t,schema:o,userId:r.currentUser.id,intl:We.default.getIntl()})}class Oh extends s.Z{constructor(){super(...arguments),this.clonedStore=void 0,this.itemPositionStore=this.createComputedStore((()=>{const{timelineState:e}=this.props;return(0,Qi.HZ)({timelineState:e,dateValue:this.dateValueStore.state,placeholderDate:this.placeholderDateStore.state,subitemPlaceholderDate:void 0})})),this.shouldRenderDateRangeStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e)})),this.isDraggingViaTimelineItemStore=this.createComputedStore((()=>!1)),this.placeholderDateStore=this.createComputedStore((()=>{const{store:e,parentStore:t,timelineState:o,groupFormat:r}=this.props,i=o.dateRangePlaceholder.state;if(i.active&&i.store===e&&i.newTimelineItemProps&&i.parentStore===t&&(0,ee.ZH)(i.groupFormat,r))return i.date})),this.dateValueStore=this.createComputedStore((()=>{const e=this.placeholderDateStore.state;if(e)return e}),{useDeepEqual:!0})}UNSAFE_willMount(e){super.UNSAFE_willMount(e),e.store&&(this.clonedStore=e.store.clone())}renderComponent(){var e;const{store:t,parentStore:o,timelineState:r,scrollerLeftOffset:i,query:n,schema:s,blockPropertyValueOverlayStore:l,disabled:a,showProperties:c,collectionContextStore:d,isFullScreen:u,isRootChild:p,toggleButton:h,groupFormat:m}=this.props,S=this.shouldRenderDateRangeStore.state,g=null===(e=d.groupsStore.getGroupState(m))||void 0===e?void 0:e.reducerResultStore,f=!d.isInHomeWidgetStore.state&&!t&&!S&&d.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0});if(g)return(0,C.jsx)(C.Fragment,{children:(0,C.jsxs)("div",{style:{display:"flex",height:qu.Z+1,width:"100%",cursor:"default"},onMouseDown:e=>Nh(e,this.environment),onMouseMove:e=>Bh(e,this.props.timelineState,this.props.store,this.props.groupFormat,this.props.disabled,this.props.query,this.props.schema,this.props.isFullScreen,this.props.canEditTimelineItems,this.props.collectionContextStore,this.props.parentStore,this.props.subitemPath),onMouseLeave:()=>Eh(this.props.timelineState),onClick:e=>Ah(e,this.environment,this.props.query,this.props.schema,this.props.timelineState,this.props.isFullScreen,this.props.groupFormat,this.props.canEditTimelineItems,this.props.collectionContextStore,this.props.store,this.props.parentStore,this.props.subitemPath),className:dt.o4s,children:[S&&(0,C.jsx)(ro.es,{store:o?void 0:t,parentStore:o,toggleButton:h,clonedStore:this.clonedStore,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,query:n,schema:s,timelineState:r,blockPropertyValueOverlayStore:l,disabled:a,showProperties:c,scrollerLeftOffset:i,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:d,isFullScreen:u,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:p,intl:We.default.getIntl(),resultStore:g,handleOpenPeekPage:Rh}),f&&(0,C.jsx)(Fh,{parentStore:this.props.parentStore,collectionContextStore:this.props.collectionContextStore,paddingLeft:this.props.paddingLeft,isFullScreen:this.props.isFullScreen,showTable:this.props.showTable})]})})}}function Mh(e){const{store:t,parentStore:o,timelineState:r,scrollerLeftOffset:n,query:s,schema:l,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,collectionContextStore:u,isFullScreen:p,isRootChild:h,toggleButton:m,groupFormat:S,canEditTimelineItems:g,subitemPath:f,paddingLeft:v,showTable:y}=e,x=(0,Y.O7)(),[b,w]=(0,i.useState)(),k=(0,J.yK)((()=>({container:{display:"flex",height:qu.Z+1,width:"100%",cursor:"default"}})),[]);(0,i.useEffect)((()=>{w(null==t?void 0:t.clone())}),[t]);const T=(0,X.VK)((()=>{var e;return null===(e=u.groupsStore.getGroupState(S))||void 0===e?void 0:e.reducerResultStore}),[u.groupsStore,S]),_=(0,X.VK)((()=>{const e=r.dateRangePlaceholder.state;if(e.active&&e.store===t&&e.newTimelineItemProps&&e.parentStore===o&&(0,ee.ZH)(e.groupFormat,S))return e.date}),[S,o,t,r.dateRangePlaceholder]),V=(0,X.VK)((()=>_),[_],{useDeepEqual:!0}),O=(0,X.VK)((()=>{const{timelineState:t}=e;return(0,Qi.HZ)({timelineState:t,dateValue:V,placeholderDate:_,subitemPlaceholderDate:void 0})}),[V,_,e]),M=(0,X.VK)((()=>Boolean(O)),[O]),P=(0,X.VK)((()=>!u.isInHomeWidgetStore.state&&!t&&!M&&u.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[u,M,t]),R=(0,X.VK)((()=>u.isInPeekRendererStore.state),[u.isInPeekRendererStore]),j=(0,i.useMemo)((()=>new Rp.Z((()=>O),{debugName:"itemPositionStore"})),[O]),I=(0,i.useMemo)((()=>new Rp.Z((()=>V),{debugName:"dateValueStore"})),[V]),F=(0,i.useMemo)((()=>new Rp.Z((()=>!1),{debugName:"isDraggingViaTimelineItemStore"})),[]);return T?(0,C.jsxs)("div",{style:k.container,onMouseDown:e=>Nh(e,x),onMouseMove:e=>Bh(e,r,t,S,c,s,l,p,g,u,o,f),onMouseLeave:()=>Eh(r),onClick:e=>Ah(e,x,s,l,r,p,S,g,u,t,o,f),className:dt.o4s,children:[M&&(0,C.jsx)(ro.es,{store:o?void 0:t,parentStore:o,toggleButton:m,clonedStore:b,itemPositionStore:j,dateValueStore:I,query:s,schema:l,timelineState:r,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,scrollerLeftOffset:n,isDraggingViaTimelineItemStore:F,collectionContextStore:u,isFullScreen:p,isInPeekRenderer:R,isRootChild:h,intl:We.default.getIntl(),resultStore:T,handleOpenPeekPage:Rh}),P&&(0,C.jsx)(Fh,{parentStore:o,collectionContextStore:u,paddingLeft:v,isFullScreen:p,showTable:y})]}):null}function Ph(e){return(0,Jo.E)("collection_timeline_view_item_new_functional")?(0,C.jsx)(Mh,{...e}):(0,C.jsx)(Oh,{...e})}function Rh(){}function jh(e,t,o){return{position:"sticky",left:t&&!o?e+8:8,display:"flex",alignItems:"center"}}function Ih(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.mediumIconColor}}function Fh(e){let{parentStore:t,collectionContextStore:o,paddingLeft:r,isFullScreen:i,showTable:n}=e;const s=(0,J.Fg)(),l=(0,X.VK)((()=>o.currentSubitemFormatStoreForUiDisplayStore.state),[o]),a=(0,X.VK)((()=>{var e;return l&&t?null===(e=t.getSchema()[l.property])||void 0===e?void 0:e.name:""}),[l,t]);return(0,C.jsx)("div",{style:jh(r,i,n),children:(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingBottom:2,fontSize:14,height:Au,lineHeight:j.Z.lineHeight.UIRegular.desktop},children:[(0,de.R)(Ih(s)),(0,C.jsx)("span",{style:{color:s.mediumTextColor},children:t&&a?(0,C.jsx)(P.FormattedMessage,{defaultMessage:"New page in {propertyName}",id:"database.timelineView.nest.addSubitemWithPropertyName",values:{propertyName:a}}):(0,C.jsx)(P.FormattedMessage,{defaultMessage:"New",id:"database.timelineView.item.addRowButton"})})]})})}function Nh(e,t){const{target:o}=e;!t.device.isMobile&&o instanceof HTMLElement&&(0,ye.ZP)({event:e,context:ye.Af.EditorMouseDown,callback:()=>{e.preventDefault(),H.AI({environment:t,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})}function Bh(e,t,o,i,n,s,l,a,c,d,u,p){var h;const m=t.drawState.state,S=t.dragState.state,{horizontalScroller:g}=t,f=t.scrollLeft.state,C=t.zoomLevel.state,v=t.currentRange.state,{snapUnit:y,getDateRangePlaceholderDuration:x}=Qi.BJ[C];if(!m&&po.Z.state||S||!g||void 0===f||n)return;const b=null===(h=d.groupsStore.getGroupState(i))||void 0===h?void 0:h.resultsStore;if(!b)return;const w=g.getBoundingClientRect(),k=f+(e.clientX-w.left),T=(0,Qi.x2)(C,k),_=r.ou.fromMillis(v.startTimestamp+T),V=(0,Qi.DS)(_,y),O=(0,Qi.DS)(x(_),y),M=(0,al.hT)(V.valueOf(),(0,He.r)()),P=(0,Qi.AZ)({startValue:M,snapUnit:y,desiredStart:V,desiredEnd:O});t.dateRangePlaceholder.setState({active:!0,store:o,parentStore:u,groupFormat:i,date:P,newTimelineItemProps:{query:s,schema:l,resultsStore:b,isFullScreen:a,canEditTimelineItems:c,subitemPath:p},existingTimelineItemProps:void 0})}function Eh(e){e.dateRangePlaceholder.setState({active:!1})}function Ah(e,t,o,r,i,n,s,l,a,c,d,u){const p=i.dateRangePlaceholder.state;if(p.active){const{date:e}=p,h=u?u.length>0?"timeline_add_subitem_bottom":"timeline_add_parent_item_bottom":"timeline_add_item_bottom";q.createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:t,perform:i=>{const p=Qu.mg({environment:t,transaction:i,date:e,store:c,parentStore:d,query:o,schema:r,isFullScreen:n,groupFormat:s,canEditTimelineItems:l,collectionContextStore:a,subitemPath:u,from:h});lt.W(t,{from:h,type:"page",new_page_id:null==p?void 0:p.id,creating_block_id:null==p?void 0:p.id,...(0,Ke.Pn)(a)})}}),i.dateRangePlaceholder.setState({active:!1})}}function Lh(e){const{store:t,parentStore:o,subitemPath:r,timelineState:i,disabled:n,query:s,format:l,schema:a,collectionContextStore:c,blockPropertyValueOverlayStore:d,isFullScreen:u,isRootChild:p,groupFormat:h,paddingLeft:m,showTimelinePropertiesStore:S,scrollerLeftOffsetStore:g,showTable:f,canEditTimelineItems:v,isInPeekRenderer:y,isReady:x,canEdit:b}=e,w=(0,X.VK)((()=>c.groupsStore.getGroupState(h)),[c,h]),k=(0,X.VK)((()=>c.permissionScopesStore.state),[c.permissionScopesStore]),T=(0,X.VK)((()=>g.state),[g]),_=(0,X.VK)((()=>S.state),[S]),V=(0,X.VK)((()=>"collectionTypedView"===c.contextType),[c]);return(0,X.VK)((()=>c.isInHomeWidgetStore.state),[c])||!w||!x||!b&&!V||k.isSyncedCollection?null:(0,C.jsx)(Ph,{store:t,disabled:n||!k.canEditContent&&!V,timelineState:i,schema:a,query:s,format:l,scrollerLeftOffset:T,paddingLeft:m,showProperties:_,blockPropertyValueOverlayStore:d,collectionContextStore:c,isFullScreen:u,showTable:f,isRootChild:p,groupFormat:h,canEditTimelineItems:v,isInPeekRenderer:y,parentStore:o,subitemPath:r})}Oh.displayName="CollectionTimelineViewItemNewClass";const Dh=function(e){const{collectionContextStore:t,schema:o,groupFormat:r,query:i,showTable:n,store:s,format:l,isFullScreen:a,paddingLeft:c,isInPeekRenderer:d,timelineState:u,blockPropertyValueOverlayStore:p,showTimelinePropertiesStore:h,isRootChild:m,isReady:S,canEdit:g,canEditTimelineItems:f,disabled:v,scrollerLeftOffsetStore:y}=e,x=(0,Y.O7)(),b=(0,X.VK)((()=>{if(!i.timeline_by)return null;const e=t.groupsStore.getGroupState(r);if(!e)return null;const s=e.currentLimit.state,l=R.oA([r&&(0,Ze.Ko)({schema:o,propertyMapping:void 0,group:r,timeZone:(0,He.r)()}),!n&&{property:i.timeline_by,filter:{operator:"is_not_empty"}}]);return{type:"results",filter:l.length>0?{operator:"and",filters:l}:void 0,limit:s}}),[t,o,r,i,n]),w=(0,X.VK)((()=>t.groupsStore.getGroupState(r)),[t,r]),k=r?[r]:[],T=(0,X.VK)((()=>null==w?void 0:w.reducerResultStore.state),[null==w?void 0:w.reducerResultStore]),_=(0,X.VK)((()=>ae.VM({collectionContextStore:t,reducerResult:T,isFullScreen:a})),[t,T,a]);return w?(0,C.jsxs)(C.Fragment,{children:[b&&(0,C.jsx)(bt.Z,{id:k.length>0?`results:${(0,ee.KW)(k)}`:"timeline_results",reducer:b,groupsPointer:k,collectionContextStore:t,resultStore:w.reducerResultStore}),(0,C.jsx)(Hh,{groupFormat:r,format:l,collectionContextStore:t,store:s,schema:o,query:i,isInPeekRenderer:d,timelineState:u,blockPropertyValueOverlayStore:p,showTimelinePropertiesStore:h,paddingLeft:c,isFullScreen:a,isRootChild:m,isReady:S,canEdit:g,canEditTimelineItems:f,disabled:v,showTable:n,scrollerLeftOffsetStore:y}),_&&(0,C.jsx)("div",{style:{width:"100%"},children:n?(0,C.jsx)("div",{style:{height:33}}):(0,C.jsx)(Ae,{style:{position:"sticky",left:a?c:3,width:"max-content",height:33},groupsPointer:k,store:s,collectionContextStore:t,format:l,isFullScreen:a,incrementLimitsInRelatedGroups:!1})}),(0,C.jsx)(Lh,{...e,store:void 0,indentLevel:0,handleOpenPeekPage:()=>Zh(t,r,x)})]}):null};function Zh(e,t,o){const r=e.groupsStore.getGroupState(t);if(!r)return;qe.default.mark("collections.open_item_page_lag");const i=e.collectionViewStore();Z.Xd({collectionContextStore:e,resultsStore:r.resultsStore});const n=null==i?void 0:i.getFormat().collection_peek_mode,s=n||ut.Ls.timeline;at.hy(o,{is_peek:!0,from:"timeline",peek_mode:s})}function Hh(e){const t=(0,Y.O7)(),{groupFormat:o,format:r,collectionContextStore:i,disabled:n,query:s,schema:l,blockPropertyValueOverlayStore:a,isFullScreen:c,isRootChild:d,showTable:u,canEditTimelineItems:p,scrollerLeftOffsetStore:h,timelineState:m,paddingLeft:S,showTimelinePropertiesStore:g,isInPeekRenderer:f}=e,v=(0,X.VK)((()=>{const e=i.permissionScopesStore.state;return{disabled:n||!("collectionTypedView"===i.contextType||e.canEditContent),timelineState:m,schema:l,query:s,format:r,scrollerLeftOffset:h.state,paddingLeft:S,showProperties:g.state,blockPropertyValueOverlayStore:a,collectionContextStore:i,isFullScreen:c,showTable:u,isRootChild:d,groupFormat:o,canEditTimelineItems:p,isInPeekRenderer:f,handleOpenPeekPage:()=>Zh(i,o,t),isLast:!1}}),[i,o,r,t,n,s,l,a,c,d,u,p,h,m,S,g,f]),y=(0,X.VK)((()=>i.groupsStore.getGroupState(o)),[i,o]);return y?(0,C.jsx)(Tt,{disableSelectable:!0,collectionContextStore:i,groupsPointer:y.groupsPointer,format:r,canDrag:!1,disableRequest:!0,resultProps:v,canDrop:!1,resultComponent:_h,disabled:!0,direction:wt.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,nestedCreateSubitemButton:o=>function(e,t,o){return(0,C.jsx)(Lh,{...o,store:e.store,indentLevel:e.indentLevel,parentStore:e.parentStore,subitemPath:e.subitemPath,handleOpenPeekPage:()=>Zh(o.collectionContextStore,o.groupFormat,t)})}(o,t,e)}):null}function zh(){const e=(0,J.yK)((e=>({rowContainer:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0",borderBottom:`1px solid ${e.regularDividerColor}`},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,C.jsx)("div",{style:e.rowContainer,children:(0,C.jsx)(tn.Z,{style:e.rowShimmer})})}const Kh=function(e){let{showTablePropertyFormatsStore:t,groupFormat:o,isFullScreen:r,collectionContextStore:n,blockPropertyValueOverlayStore:s,isReady:l,store:a,disabled:c,format:d,schema:u,isInPeekRenderer:p,query:h,showHoverActionsStore:m,paddingBottom:S,tableStore:g,timelineState:f,isRootChild:v,canEdit:y,paddingLeft:x}=e;const b=(0,X.VK)((()=>t.state.findIndex((e=>"title"===e.property))),[t]),w=(0,i.useMemo)((()=>o?[o]:[]),[o]),k=(0,X.VK)((()=>n.groupsStore.getGroupState(w)),[n,w]),T=(0,X.VK)((()=>null==k?void 0:k.reducerResultStore.state),[k]),_=(0,X.VK)((()=>(0,ae.VM)({collectionContextStore:n,reducerResult:T,isFullScreen:r})),[n,T,r]),V=(0,X.VK)((()=>n.shouldShowSpinnerStore.state),[n]),O=(0,X.VK)((()=>n.permissionScopesStore.state),[n]),M=(0,X.VK)((()=>t.state),[t]),P=(0,X.VK)((()=>n.isInHomeWidgetStore.state),[n]),R=(0,X.VK)((()=>function(e,t,o){const r=e.permissionScopesStore.state,i="collectionTypedView"===e.contextType;return Boolean(!e.isInHomeWidgetStore.state&&t&&(o||i)&&!r.isSyncedCollection)}(n,l,y)),[n,l,y]);if(!k)return null;const j=l&&0===(null==T?void 0:T.blockIds.length)&&!V;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(Uh,{store:a,format:d,schema:u,query:h,collectionContextStore:n,disabled:c,paddingBottom:S,isInPeekRenderer:p,blockPropertyValueOverlayStore:s,tableStore:g,showTablePropertyFormats:M,timelineState:f,isFullScreen:r,isRootChild:v,groupFormat:o,isInHomeWidget:P}),(0,C.jsx)("div",{style:{height:(0,Qi.vX)(Boolean(o)),width:0}}),j&&(0,C.jsx)(Yh,{collectionContextStore:n,isFullScreen:r,groupFormat:o,blockPropertyValueOverlayStore:s,canEdit:y}),(0,C.jsx)(om,{store:a,schema:u,query:h,collectionContextStore:n,blockPropertyValueOverlayStore:s,showTablePropertyFormatsStore:t,canEdit:y,format:d,tableStore:g,paddingLeft:x,disabled:c,groupFormat:o,titleColumnIndex:b,groupsPointer:w}),V&&(0,C.jsx)(zh,{}),_&&(0,C.jsx)(Jh,{collectionContextStore:n,format:d,canEdit:y,groupFormat:o,isFullScreen:r,groupsPointer:w}),R&&(0,C.jsx)(Xh,{collectionContextStore:n,isFullScreen:r,groupFormat:o,blockPropertyValueOverlayStore:s,isInPeekRenderer:p}),(0,C.jsx)(bc,{groupFormat:o,style:Wh(l,o,r,x),disabled:c||!O.canConfigureBlock,schema:u,query:h,collectionContextStore:n,isInPeekRenderer:p,isFullScreen:r,showPropertyFormats:M,showHoverActionsStore:m,showRightActionsSpacer:!1}),(o||r)&&(0,C.jsx)("div",{style:{height:Lu,width:0,marginBottom:o?Qi.y1:void 0}})]})};function Gh(){}function Wh(e,t,o,r){return{...!e&&{opacity:0,pointerEvents:"none"},...!o&&!t&&{position:"sticky",left:r},...o&&!t&&{left:r}}}function Uh(e){let{groupFormat:t,store:o,format:r,schema:i,query:n,collectionContextStore:s,disabled:l,paddingBottom:a,isInPeekRenderer:c,blockPropertyValueOverlayStore:d,tableStore:u,showTablePropertyFormats:p,timelineState:h,isFullScreen:m,isRootChild:S,isInHomeWidget:g}=e;const f=(0,X.VK)((()=>s.groupsStore.getGroupState(t)),[s,t]),v=(0,X.VK)((()=>s.permissionScopesStore.state),[s]),y=(0,X.VK)((()=>s.viewIsFlushToTopbar()),[s]);if(!f)return null;const x=Boolean(t);return(0,C.jsx)(qd,{store:o,format:r,schema:i,query:n,collectionContextStore:s,isInPeekRenderer:c,minWidth:void 0,paddingBottom:a,blockPropertyValueOverlayStore:d,showPropertyFormats:p,showRightActions:!1,allowHidingTitle:!0,tableStore:u,formatKey:"timeline_table_properties",disabled:l||!v.canConfigureBlock,disableHorizontalEdgeScroll:!0,height:(0,Qi.vX)(x),paddingTop:x?0:Qi.Ne-Qi.pe,disableTopBorder:!y||x,disableCellRightBorder:!0,groupFormat:t,isInHomeWidget:g,children:!x&&v.canConfigureBlock&&(0,C.jsx)(Pp,{isGrouped:!1,format:r,collectionContextStore:s,timelineState:h,isFullScreen:m,isRootChild:S})})}function qh(e,t){return{borderBottom:`1px solid ${t.tableDividerColor}`,display:"flex",alignItems:"center",height:Au,width:"100%",paddingLeft:8,fontSize:14,lineHeight:j.Z.lineHeight.UIRegular.desktop,background:e?t.cardContentBackground:t.contentBackground}}function $h(e){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor}}function Qh(e,t,o,r,i,n){const{device:s}=e,a=r?[r]:[],c=t.groupsStore.getGroupState(a);if(!Nt.M_(e)||!c)return;t.searchQueryStore.state&&le.Ug({searchQuery:"",collectionContextStore:t,isFullScreen:o});const u=t.currentSubitemFormatStoreForCollectionStore.state;q.createAndCommit({userAction:"TimelineTableGroupResults.handleAddRowClick",environment:e,perform:o=>{const a=E.IW({environment:e,collectionContextStore:t,groupsPointer:r?[r]:[],shouldCoerce:!0,initializeDefaultTemplate:!0,transaction:o,from:"timeline_table_group_results"});if(a){if(s.isMobile){!function(e,t,o){o?o(e):zt.c4({environment:t,url:e})}((0,lo.ZP)({store:a.newStore,fullyQualified:!1,pageVisitSource:d.tY.Create}),e,n)}else if(a.coercionSucceeded){const o=()=>{ct.bA({environment:e,blockPropertyValueOverlayStore:i,store:a.newStore,property:"title",format:mt.C.Table,collectionContextStore:t,disableHorizontalEdgeScroll:!0})};$e.default.checkGate({gateName:"collections_item_mounted_callbacks"})?t.registerCallbackForItemMounted(a.newStore,o):l.default.afterNextFlush((()=>{l.default.afterNextFlush(o)}))}else{const o=r?[r]:[],i=t.groupsStore.getGroupState(o);se.CH({environment:e,store:a.newStore,peekMode:(0,ae.kr)(t),resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:t,pageVisitSource:d.tY.Create})}lt.W(e,{from:u?"timeline_add_parent_item_bottom":"timeline_add_item_bottom",type:"page",new_page_id:a.newStore.id,creating_block_id:a.newStore.id,...(0,Ke.Pn)(t)})}}})}function Yh(e){let{collectionContextStore:t,isFullScreen:o,groupFormat:r,blockPropertyValueOverlayStore:n,canEdit:s}=e;const l=(0,J.Fg)(),a=(0,Y.O7)(),c=(0,i.useContext)(yi.ZO),d=(0,i.useCallback)((()=>Qh(a,t,o,r,n,c)),[a,t,o,r,n,c]);return(0,C.jsx)(xe.Z,{onClick:d,onMouseDown:ye.$0,disabled:!s,style:{display:"flex",alignItems:"center",height:Au,width:"100%",paddingLeft:8,fontSize:14,lineHeight:j.Z.lineHeight.UIRegular.desktop,background:l.contentBackground,left:0,right:0,borderBottom:`1px solid ${l.tableDividerColor}`},children:s?(0,C.jsx)("span",{style:{color:l.lightTextColor},children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Empty. Click to add a row.",id:"database.timelineView.emptyTablePlaceholder"})}):(0,C.jsx)("span",{style:{color:l.lightTextColor},children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Empty.",id:"database.timelineView.cannotEdit.emptyTablePlaceholder"})})})}function Xh(e){let{collectionContextStore:t,isFullScreen:o,groupFormat:r,blockPropertyValueOverlayStore:n,isInPeekRenderer:s}=e;const l=(0,J.Fg)(),a=(0,Y.O7)(),c=(0,i.useContext)(yi.ZO),d=(0,i.useCallback)((()=>Qh(a,t,o,r,n,c)),[a,t,o,r,n,c]);return(0,C.jsxs)(xe.Z,{onClick:d,style:qh(s,l),className:dt.tfM,onMouseDown:ye.$0,children:[(0,de.R)($h(l)),(0,C.jsx)("span",{style:{color:l.lightTextColor},children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"New",id:"database.timelineView.addRowButton"})})]})}function Jh(e){let{groupsPointer:t,collectionContextStore:o,format:r,canEdit:i,groupFormat:n,isFullScreen:s}=e;const l=(0,J.Fg)(),a=(0,Y.O7)(),c=(0,X.VK)((()=>o.groupsStore.getGroupState(t)),[o,t]),d=(0,X.VK)((()=>ve({collectionContextStore:o,groupsPointer:t})),[o,t]);return c?(0,C.jsxs)(xe.Z,{onMouseDown:ye.$0,onClick:e=>function(e,t,o,r,i){const n=t.groupsStore.getGroupState(o);if(!n)return;const s=n.reducerResultStore.state;(0,ye.Wi)(e),G.ZH({debug:{userAction:"TimelineTableGroupResults.handleLoadMoreClick"},environment:i}),s&&E.ID({collectionContextStore:t,environment:i,incrementLimitArgs:{isFullScreen:r,currentResultCount:s.blockIds.length,groupsPointer:n.groupsPointer,incrementLimitsInRelatedGroups:!1}}),I.uD(i)}(e,o,n,s,a),disabled:d,hoveredStyle:d?{background:l.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:Au+1,width:"100%",paddingLeft:8,paddingBottom:2,fontSize:14,lineHeight:j.Z.lineHeight.UIRegular.desktop,boxShadow:`0 -1px 0 ${l.tableDividerColor}`,borderBottom:`1px solid ${l.tableDividerColor}`,whiteSpace:"break-spaces"},children:[(0,Se.M)($h(l)),(0,C.jsx)("span",{style:{color:l.lightTextColor},children:(0,C.jsx)(P.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),d?(0,C.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,C.jsx)(be.Z,{style:{width:12,height:12}})}):i&&(0,C.jsx)(Ne,{collectionContextStore:o,format:r})]}):null}function em(e){const t=(0,Y.O7)(),{store:o,parentStore:r,subitemPath:i,indentLevel:n,groupsPointer:s,collectionContextStore:a,disabled:c,blockPropertyValueOverlayStore:d}=e;return r?(0,C.jsx)(Ta,{store:o,collectionStore:r,subitemPath:i,indentLevel:n,collectionContextStore:a,disabled:c,groupsPointer:s,onSubitemCreate:e=>function(e,t,o,r){if(o){const i=()=>{ct.bA({isNewBlock:!0,environment:r,blockPropertyValueOverlayStore:o,store:e,property:"title",format:mt.C.Table,collectionContextStore:t,disableHorizontalEdgeScroll:!0})};$e.default.checkGate({gateName:"collections_item_mounted_callbacks"})?t.registerCallbackForItemMounted(e,i):l.default.afterNextFlush((()=>{l.default.afterNextFlush(i)}))}}(e,a,d,t)}):null}function tm(e){let{args:t,schema:o,disabled:r,collectionContextStore:i,blockPropertyValueOverlayStore:n,showTablePropertyFormatsStore:s,canEdit:l,format:a,groupFormat:c,titleColumnIndex:d}=e;(0,J.Fg)();const u=(0,Y.Fy)(),p=(0,X.VK)((()=>i.collectionViewStore()),[i]),{groupsPointer:h}=t,m=(0,X.VK)((()=>i.groupsStore.getGroupState(h)),[i,h]),S=(0,X.VK)((()=>s.state),[s]),g=(0,X.VK)((()=>!l&&u.isMobile&&!(null!=p&&p.isSyncedCollection())),[l,u,p]),f=(0,X.VK)((()=>i.isInHomeWidgetStore.state),[i]);if(!p||!m)return null;return(0,C.jsx)(Tt,{collectionContextStore:i,groupsPointer:h,disableRequest:!0,format:a,canDrag:g,resultProps:{schema:o,collectionContextStore:i,propertyFormats:S,onPropertyTab:t.onPropertyTab,onPropertyUntab:t.onPropertyUntab,onPropertyEnter:t.onPropertyEnter,onPropertyClick:t.onPropertyClick,onPropertyEsc:t.onPropertyEsc,onPropertyBgClick:t.onPropertyBgClick,onPropertyContextMenu:t.onPropertyContextMenu,onOpenProperty:t.onOpenProperty,disabled:r,blockPropertyValueOverlayStore:n,showRightActionsSpacer:!1,disableHorizontalEdgeScroll:!0,disableTableWrap:!0,disableCellBorderRight:!1,disableLastCellBorderRight:!0,onShiftEnter:Gh,titleColumnIndex:d,groupFormat:c,shouldShowMultiSelectCheckbox:!1,isInHomeWidget:f},resultComponent:iu,canDrop:!1,disabled:r,direction:wt.Vertical,getItemSelectableStyle:()=>({display:"flex",width:"fit-content",height:33}),shouldShowHoverMenu:!0,analyticsName:"timeline",emptyDroppableSize:0,onSelectableEnter:t.onSelectableEnter,disableScrollToRevealHorizontal:!0,blockPropertyValueOverlayStore:n,titleColumnIndex:d,nestedCreateSubitemButton:e=>{let{store:t,parentStore:o,subitemPath:s,indentLevel:l}=e;return(0,C.jsx)(em,{collectionContextStore:i,disabled:r,blockPropertyValueOverlayStore:n,store:t,parentStore:o,subitemPath:s,indentLevel:l,groupsPointer:h})}})}function om(e){let{groupFormat:t,groupsPointer:o,store:r,schema:n,query:s,collectionContextStore:l,blockPropertyValueOverlayStore:a,showTablePropertyFormatsStore:c,canEdit:d,format:u,tableStore:p,paddingLeft:h,disabled:m,titleColumnIndex:S}=e;const g=(0,X.VK)((()=>l.collectionViewStore()),[l]),f=(0,X.VK)((()=>l.groupsStore.getGroupState(t)),[l,t]),v=(0,X.VK)((()=>c.state),[c]),y=(0,i.useCallback)((e=>(0,C.jsx)(tm,{schema:n,disabled:m,collectionContextStore:l,blockPropertyValueOverlayStore:a,showTablePropertyFormatsStore:c,canEdit:d,format:u,groupFormat:t,titleColumnIndex:S,args:{...e,groupsPointer:o}})),[n,m,l,a,c,d,u,t,S,o]);return g&&f?(0,C.jsx)(xu,{store:r,format:u,schema:n,query:s,collectionContextStore:l,minWidth:void 0,blockPropertyValueOverlayStore:a,showPropertyFormats:v,disabled:!d,disableHorizontalEdgeScroll:!0,groupFormat:t,render:y,tableStore:p,paddingLeft:h}):null}class rm extends io.Z{constructor(){super(...arguments),this.widthEl=null,this.storeTypes={tableStore:rc,hiddenGroupsVisibleStore:c.default.createClass(!1,{name:"hiddenGroupsVisibleStore"}),groupsReducerResultStore:c.default.createClass(void 0,{name:"groupsReducerResultStore"})},this.renderTableGroupHeader=e=>{const{format:t,collectionContextStore:o,isFullScreen:r,isRootChild:i}=this.props,n=o.permissionScopesStore.state;return(0,C.jsxs)(Yr,{...e,height:Qi.Zn-1,paddingTop:Qi.xd,toggleClosedMarginBottom:Qi.xd,getComputedStickyStyle:e=>function(e,t){return{boxShadow:e?`0 -1px 0 ${t.tableDividerColor}`:void 0}}(e,this.theme),style:lm(e.index,this.props.collectionContextStore,this.theme),children:[0===e.index&&n.canConfigureBlock&&(0,C.jsx)(Pp,{isGrouped:!0,format:t,collectionContextStore:o,timelineState:this.timelineState,isFullScreen:r,isRootChild:i})," "]})},this.renderTableGroupResults=e=>{const{store:t,isFullScreen:o,schema:r,query:i,isInPeekRenderer:n,collectionContextStore:s,blockPropertyValueOverlayStore:l,showHoverActionsStore:a,paddingBottom:c,isRootChild:d,disabled:u}=this.props,p=this.isReadyStore.state,h=sm(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment);if(s.groupsStore.getGroupState(e))return(0,C.jsx)(Kh,{store:t,groupFormat:e,schema:r,query:i,isInPeekRenderer:n,timelineState:this.timelineState,collectionContextStore:s,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:this.showTablePropertyFormatsStore,showHoverActionsStore:a,tableStore:this.stores.tableStore,paddingLeft:h,paddingBottom:c,format:am(this.props.format,this.stores.tableStore),isFullScreen:o,isRootChild:d,isReady:p,canEdit:this.canEditCollectionTimeline(),disabled:u&&this.canEditCollectionTimeline()})},this.renderTimelineItemGroupResults=e=>{const{store:t,isFullScreen:o,schema:r,query:i,isInPeekRenderer:n,collectionContextStore:s,blockPropertyValueOverlayStore:l,isRootChild:a,disabled:c}=this.props,d=this.isReadyStore.state,u=sm(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment);return(0,C.jsx)(Dh,{store:t,groupFormat:e,schema:r,query:i,isInPeekRenderer:n,timelineState:this.timelineState,collectionContextStore:s,blockPropertyValueOverlayStore:l,showTimelinePropertiesStore:this.showTimelinePropertiesStore,paddingLeft:u,format:am(this.props.format,this.stores.tableStore),isFullScreen:o,isRootChild:a,isReady:d,canEdit:this.canEditCollectionTimeline(),disabled:c,showTable:this.showTableStore.state,canEditTimelineItems:this.canEditTimelineItemsStore.state,scrollerLeftOffsetStore:this.scrollerLeftOffsetStore})},this.renderTimelineItemGroupHeader=e=>{if(this.showTableStore.state)return;const{collectionContextStore:t}=e,o=t.isInHomeWidgetStore.state,r=this.timelineState.outerSizeObserver.rect.state.width;return(0,C.jsx)("div",{style:{position:"sticky",left:0,width:r,height:Qi.Zn,zIndex:M.sL},children:(0,C.jsx)(Yr,{...e,style:{width:"100%",height:"100%",paddingLeft:this.props.isFullScreen?sm(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment):32,zIndex:void 0,transition:"background 200ms ease-in-out, border 200ms  ease-in-out",background:"transparent",borderBottom:"1px solid transparent"},getComputedStickyStyle:e=>function(e,t){return e?{background:t.contentBackground,boxShadow:`0 1px 0 ${t.tableDividerColor}`}:{background:"transparent",boxShadow:void 0}}(e&&!o,this.theme),preventToggleBackground:this.props.isInPeekRenderer})})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderTimelineItemHiddenGroupsButton=e=>(0,C.jsx)(cm,{isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild,format:this.props.format,paddingLeft:this.props.paddingLeft,showTableStore:this.showTableStore,args:e}),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderTimelineAddGroupButton=e=>(0,C.jsx)(dm,{isFullScreen:this.props.isFullScreen,collectionContextStore:this.props.collectionContextStore,isRootChild:this.props.isRootChild,format:this.props.format,paddingLeft:this.props.paddingLeft,showTableStore:this.showTableStore,args:e}),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderTimelineGroupsLoadMoreButton=e=>(0,C.jsx)(um,{isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild,format:this.props.format,paddingLeft:this.props.paddingLeft,showTableStore:this.showTableStore,args:e}),this.renderRowDropzoneSelectableGroupResults=e=>{const{collectionContextStore:t,store:o,format:r,disabled:i}=this.props;return(0,C.jsx)(fh,{store:o,groupFormat:e,collectionContextStore:t,canEdit:this.canEditCollectionTimeline(),format:r,disabled:i&&this.canEditCollectionTimeline()})},this.handleHorizontalScroll=()=>{const{timelineState:e}=this,{horizontalScroller:t,savePreference:o}=e;if(!t)return;const r=t.scrollLeft,i=e.scrollLeft.state;this.environment.device.isIOS&&void 0!==i&&0===r&&i>Qi.lx?t.scrollLeft=i:(o&&o(),e.scrollLeft.setState(r),(0,Qi.rr)(this.environment)?this.resetWindowForScrollDebounced():this.resetWindowForScroll())},this.resetWindowForScroll=()=>{const{timelineState:e}=this,{horizontalScroller:t,outerSizeObserver:o}=e;if(!t)return;const r=e.zoomLevel.state,{startTimestamp:i,endTimestamp:n}=e.currentRange.state,s=t.scrollLeft,l=o.rect.state.width,a=(0,Qi.e$)(r,n-i),c=(0,Qi.al)(e);if(s<Qi.lx){const t=-(0,Qi.x2)(r,Qi.Ge);e.currentRange.setState({startTimestamp:i+t,endTimestamp:n+t}),Qu.Nf({timelineState:e,environment:this.environment,zoomLevel:r,centerTimestamp:c})}else if(s+l>a-Qi.lx){const t=(0,Qi.x2)(r,Qi.Ge);e.currentRange.setState({startTimestamp:i+t,endTimestamp:n+t}),Qu.Nf({timelineState:e,environment:this.environment,zoomLevel:r,centerTimestamp:c})}},this.resetWindowForScrollDebounced=R.Ds(this.resetWindowForScroll,200),this.handleWidthElMount=e=>{if(e){this.widthEl=e;const{timelineState:t}=this,{outerSizeObserver:o}=t;o.observe(e);const r=(0,Xo.xH)(e);r&&(t.horizontalScroller=r,(0,ui.lj)(r,"scroll",this.handleHorizontalScroll),this.scrollToCenteredTimestamp())}},this.handleTimelineElMount=e=>{if(e){const{timelineState:t}=this,{timelineSizeObserver:o}=t;o.observe(e)}},this.scrollToCenteredTimestamp=()=>{const{timelineState:e}=this,{startTimestamp:t,endTimestamp:o}=e.currentRange.state;Qu.KA({timelineState:e,centerTimestamp:(t+o)/2})},this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem=(e,t,o)=>function(e,t,o,r,i){!function(e,t,o,r,i){if(r.device.isMobile)ne._c({environment:r,store:e,pageVisitSource:d.tY.Create});else{const{groupFormat:t}=o,n=t?[t]:[],s=i.groupsStore.getGroupState(n),l="collectionTypedView"===i.contextType;se.CH({environment:r,store:e,peekMode:ae.kr(i),showMoveTo:l,resultsStore:null==s?void 0:s.resultsStore,collectionContextStore:i,pageVisitSource:d.tY.Create})}}(e,0,o,r,i)}(e,0,o,this.environment,this.props.collectionContextStore),this.showTablePropertyFormatsStore=this.createComputedStore((()=>function(e,t){const o=am(e,t);return o&&o.timeline_table_properties?o.timeline_table_properties:[]}(this.props.format,this.stores.tableStore).filter((e=>e.visible))),{useDeepEqual:!0}),this.tableWidthStore=this.createComputedStore((()=>this.showTableStore.state?this.showTablePropertyFormatsStore.state.reduce(((e,t)=>e+(t.width||0)),0):0)),this.scrollerLeftOffsetStore=this.createComputedStore((()=>(0,Qi.xI)({environment:this.environment,paddingLeft:sm(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment),format:this.props.format,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild}))),this.scrollPixelWidthStore=this.createComputedStore((()=>{const{timelineState:e}=this,t=e.zoomLevel.state,{startTimestamp:o,endTimestamp:r}=e.currentRange.state;return(0,Qi.e$)(t,r-o)})),this.showTimelinePropertiesStore=this.createComputedStore((()=>{const{format:e}=this.props;return(e.timeline_properties||[]).filter((e=>{let{visible:t}=e;return t})).map((e=>{let{property:t}=e;return t}))})),this.showTableStore=this.createComputedStore((()=>{const{format:e,isFullScreen:t,isRootChild:o}=this.props;return(0,Qi.C1)({environment:this.environment,format:e,isFullScreen:t,isRootChild:o})})),this.canEditTimelineItemsStore=this.createComputedStore((()=>{const{query:e,schema:t}=this.props;return ae.D2({query:e,schema:t})})),this.isReadyStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()})),this.getTimelineItemGroupStyle=e=>{const t=this.showTableStore.state,o=this.getGroupPaddingState(e);let r=0,i=0;return o.groupHeader&&t&&(r+=Qi.Zn-1),o.tableHeaderRow&&(r+=Qi.pe),o.tableEmptyRow&&(r+=Au),o.tableAggregationRow&&(i+=Lu),o.hiddenGroupsButton&&t&&(i+=Hi+zi),o.groupsLoadMoreButton&&t&&(i+=Wi+2*Ui),o.addGroupButton&&t&&(i+=as+cs),o.groupPaddingBottom&&(i+=Qi.y1),o.extraGroupMarginBottom&&(i+=Qi.xd+1),{paddingTop:r,paddingBottom:i,minHeight:Qi.Zn,boxShadow:e.index>0&&(!t||o.tableHeaderRow)?`0 -1px 0 ${this.theme.tableDividerColor}`:void 0}},this.getRowDropzoneSelectableGroupStyle=e=>{if(!e)return{paddingTop:0,paddingBottom:0};const t=this.getGroupPaddingState(e);let o=0,r=0;return t.groupHeader&&(o+=Qi.Zn),t.tableHeaderRow&&(o+=Qi.pe),t.tableEmptyRow&&(o+=Au),t.addItemRow&&(r+=qu.Z),t.loadMoreButton&&(r+=33),t.tableAggregationRow&&(r+=Lu),t.hiddenGroupsButton&&(r+=Hi+zi),t.groupsLoadMoreButton&&(r+=Wi+2*Ui),t.groupPaddingBottom&&(r+=Qi.y1),t.extraGroupMarginBottom&&(r+=Qi.xd),t.addGroupButton&&(r+=as+cs),t.dropZoneSelectableGroupExtraBottomPadding&&(r+=1),{paddingTop:o,paddingBottom:r}}}get registries(){return super.registries.concat($u.Z)}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.timelineState=(0,Qi.Gz)({isFullScreen:e.isFullScreen,isRootChild:e.isRootChild});const{collectionContextStore:t}=e,o=t.collectionViewStore();o&&Qu.j2({timelineState:this.timelineState,environment:this.environment,collectionViewStore:o,collectionContextStore:t})}UNSAFE_willMountOrUpdate(e){super.UNSAFE_willMountOrUpdate(e);const{timelineState:t}=this,{query:o,collectionContextStore:r}=e;po.Z.state&&t.hoveredItem.setState(void 0);const i=r.collectionStore();i&&!o.timeline_by&&i.isDefined()&&function(e,t,o){const{schema:r}=e,i=t.permissionScopesStore.state,n=t.collectionStore();if(!n)return;const s=t.collectionViewStore();if(!s||!i.canConfigureBlock)return;const l=(0,P.defineMessages)({date:{id:"database.timelineView.dateProperty.defaultName",defaultMessage:"Date"}});q.createAndCommit({userAction:"CollectionTimelineView.updateOrCreateTimelineProperty",environment:o,perform:e=>{let t,a=ae.HI(r);if(!a&&i.canConfigureCollection){a=(0,oe.ZP)();t={[a]:{name:We.default.formatMessage(l.date),type:"date"}}}le.Es({collectionViewStore:s,update:{timeline_by:a},transaction:e}),ie.sW({store:s,data:{type:"timeline"},transaction:e}),t&&le.xO({environment:o,collectionStore:n,update:t,transaction:e})}})}(e,this.props.collectionContextStore,this.environment)}didMountOrUpdate(){super.didMountOrUpdate();const e=this.timelineState,{collectionContextStore:t,isFullScreen:o,isRootChild:r}=this.props;I.iR(this.environment,(0,Qi.Ii)({environment:this.environment,collectionContextStore:t,timelineState:e,isFullScreen:o,isRootChild:r}));const i=e.drawState.state;if(null!=i&&i.tryToCompleteDrawnArrow){(0,Qi.H5)(t)&&q.createAndCommit({userAction:"TimelineItemDependencyDrawHandle.completeUserDrawnArrow",environment:this.environment,perform:i=>{Qu.$o({timelineState:e,environment:this.environment,transaction:i,collectionContextStore:t,isFullScreen:o,isRootChild:r})}})}}willUnmount(){super.willUnmount();const{timelineState:e}=this,{horizontalScroller:t,outerSizeObserver:o,timelineSizeObserver:r}=e;o.destroy(),r.destroy(),e.destroyed=!0,t&&(t.scrollLeft=0,(0,ui.ZV)(t,"scroll",this.handleHorizontalScroll))}customizeEdgeScrollRect(e){const t=this.scrollerLeftOffsetStore.state;return _l.iL.from({top:e.top,height:e.height,left:e.left+t,width:e.width-t})}addBlockToView(e){const{store:t,transaction:o}=e,{collectionContextStore:r}=this.props,i=t.getAssociatedCollectionStore()??r.collectionStore();if(i)return Qu.Fv({environment:this.environment,store:t,timelineState:this.timelineState,query:this.props.query,collectionStore:i,collectionContextStore:this.props.collectionContextStore,groupFormat:void 0,transaction:o})}renderPersisted(){const{store:e,isInPeekRenderer:t,paddingRight:o,isFullScreen:r,isRootChild:i,query:n,schema:s,format:l,collectionContextStore:a,disabled:c}=this.props,{timeline_by:d}=n;if(!d)return(0,C.jsx)(nm,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom});const u=s[d];if(!u||!ce.Lt(u))return(0,C.jsx)(nm,{collectionContextStore:this.props.collectionContextStore,isFullScreen:this.props.isFullScreen,paddingBottom:this.props.paddingBottom});const{timelineState:p}=this,h=this.scrollerLeftOffsetStore.state,m=this.showTableStore.state,S=sm(this.props.isRootChild,this.props.isFullScreen,this.props.format,this.props.paddingLeft,this.environment),g=ae.az(a,r),f=l.collection_group_by,v=a.viewIsFlushToTopbar(),y=a.isInHomeWidgetStore.state,x=(0,bn.Z)((d=>(0,C.jsx)(Si,{isFullScreen:r,renderEmitter:a.renderEmitter,children:(0,C.jsx)("div",{style:this.getStyle(m),className:dt.kDE,...d,children:(0,C.jsxs)(St.Z,{store:e,analyticsName:"timeline",shouldShowHalo:!r&&!y,canSelect:!r,style:y?{height:"100%"}:{},children:[(0,C.jsx)(sh,{timelineState:p}),(0,C.jsxs)("div",{style:{position:"absolute",width:"100%",zIndex:0,top:Qi.Ne},ref:this.handleTimelineElMount,children:[f?this.renderTimelineItemGroups():this.renderTimelineItemGroupResults(void 0),(0,C.jsx)(Sp,{timelineState:p,disabled:c,isReady:this.isReadyStore.state,renderEmitter:a.renderEmitter,isFullScreen:r,isRootChild:i})]}),(0,C.jsx)(Hp,{isInPeekRenderer:t,timelineState:p,query:n,schema:s,scrollerLeftOffset:h,collectionContextStore:a,showTable:m}),(0,C.jsx)(Vp,{timelineState:p,isInPeekRenderer:t,paddingLeft:S,paddingRight:!r&&i?8:o,format:l,scrollerLeftOffset:h,isFullScreen:r,isRootChild:i,showTable:m,collectionContextStore:a,isReady:this.isReadyStore.state}),m&&this.renderTable(f,S),(0,C.jsx)("div",{style:{paddingTop:Qi.Ne,pointerEvents:"none"},children:f?this.renderRowDropzoneSelectableGroups():(0,C.jsx)("div",{style:this.getRowDropzoneSelectableGroupStyle(void 0),children:this.renderRowDropzoneSelectableGroupResults(void 0)})}),!g&&(0,C.jsx)(Rt.Z,{onChange:e=>function(e,t,o,r){const i=o.isLoadingStore.state,n=o.groupsStore.getGroupState([]);if(!n)return;const s=n.reducerResultStore.state;e<Ft.Z.incrementScrollOffset&&s&&!i&&s.hasMore&&E.ID({collectionContextStore:o,environment:t,incrementLimitArgs:{isFullScreen:r,currentResultCount:s.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}(e,this.environment,this.props.collectionContextStore,this.props.isFullScreen)})]})})})));return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{ref:this.handleWidthElMount}),!v&&(0,C.jsx)("div",{style:{height:4}}),x]})}renderTable(e,t){const{store:o,isFullScreen:r,collectionContextStore:i}=this.props;return(0,C.jsx)("div",{style:{position:"sticky",left:0,height:0,width:this.tableWidthStore.state,zIndex:M.eU},children:(0,C.jsx)(St.Z,{style:this.getTableSelectableStyle(t),store:o,shouldShowHalo:!1,canSelect:!r,analyticsName:"timeline",children:e?this.renderTableGroups():(0,C.jsx)(Si,{isFullScreen:r,ignoreAncestorContainer:!0,renderEmitter:i.renderEmitter,children:(0,C.jsx)("div",{children:this.renderTableGroupResults(void 0)})})})})}renderTableGroups(){const{store:e,collectionContextStore:t,disabled:o,isFullScreen:r,paddingLeft:i,isRootChild:n}=this.props;return(0,C.jsx)(fn,{reducerId:"timeline_groups",store:e,collectionContextStore:t,disabled:o,isFullScreen:r,isRootChild:n,paddingLeft:i,stickyLeft:!1,renderGroup:this.renderTableGroupResults,getGroupStyle:()=>({}),renderHeader:this.renderTableGroupHeader,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,timelineProps:{type:"table",reducerResultStore:this.stores.groupsReducerResultStore,hiddenGroupsVisibleStore:this.stores.hiddenGroupsVisibleStore}})}renderTimelineItemGroups(){const{store:e,collectionContextStore:t,disabled:o,isFullScreen:r,paddingLeft:i,isRootChild:n}=this.props;return(0,C.jsx)(fn,{reducerId:"timeline_groups",store:e,collectionContextStore:t,disabled:o,isFullScreen:r,isRootChild:n,paddingLeft:i,stickyLeft:!1,renderGroup:this.renderTimelineItemGroupResults,getGroupStyle:this.getTimelineItemGroupStyle,renderHeader:this.renderTimelineItemGroupHeader,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,timelineProps:{type:"item",reducerResultStore:this.stores.groupsReducerResultStore,hiddenGroupsVisibleStore:this.stores.hiddenGroupsVisibleStore}})}renderRowDropzoneSelectableGroups(){const{store:e,collectionContextStore:t,disabled:o,isFullScreen:r,paddingLeft:i,isRootChild:n}=this.props;return(0,C.jsx)(fn,{reducerId:"timeline_groups",store:e,collectionContextStore:t,disabled:o,isFullScreen:r,isRootChild:n,paddingLeft:i,stickyLeft:!1,renderGroup:this.renderRowDropzoneSelectableGroupResults,getGroupStyle:this.getRowDropzoneSelectableGroupStyle,renderHeader:()=>null,onGroupHeaderAddItem:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_onGroupHeaderAddItem,timelineProps:{type:"dropzone",reducerResultStore:this.stores.groupsReducerResultStore,hiddenGroupsVisibleStore:this.stores.hiddenGroupsVisibleStore}})}canEditCollectionTimeline(){const e=this.props.collectionContextStore.permissionScopesStore.state;return this.canEdit()&&e.canEditContent&&!e.isSyncedCollection}getGroupPaddingState(e){const{groupFormat:t,currentGroups:o,visibleGroups:r,hiddenGroups:i,total:n}=e,{collectionContextStore:s,isFullScreen:l,disabled:a,format:c}=this.props,{hiddenGroupsVisibleStore:d}=this.stores,u=c.collection_group_by,p=this.showTableStore.state,h=s.groupsStore.getGroupState(t),m=Boolean(t&&!(null!=h&&h.toggleStateStore.state)),S=function(e,t,o,r){if(!e)return!0;const i=o.indexOf(e);return!t&&!o.find(((e,t)=>{if(t<i){const t=r.groupsStore.getGroupState([e]);return null==t?void 0:t.toggleStateStore.state}return!1}))}(t,m,o,this.props.collectionContextStore),g=null==h?void 0:h.reducerResultStore.state,f=ae.VM({collectionContextStore:s,reducerResult:g,isFullScreen:l}),C=t===i[i.length-1],v=t===r[r.length-1],y=r.length<n,x=d.state?C:v,b=s.permissionScopesStore.state,w=x&&!a&&b.canConfigureBlock&&u&&(0,ee.Wz)(u,b.canConfigureCollection),k=g&&0===g.blockIds.length;return{groupHeader:Boolean(t&&(!p||!S)),tableHeaderRow:Boolean(p&&!m&&!S),tableAggregationRow:Boolean(p&&!m),addItemRow:Boolean(this.canEditCollectionTimeline()&&!m),hiddenGroupsButton:Boolean(v&&i.length>0),groupsLoadMoreButton:Boolean(v&&y),loadMoreButton:Boolean(!m&&f),groupPaddingBottom:Boolean(!m),tableEmptyRow:Boolean(p&&!m&&k),extraGroupMarginBottom:Boolean(p&&m),addGroupButton:Boolean(w),dropZoneSelectableGroupExtraBottomPadding:Boolean(!p)}}getStyle(e){const{isFullScreen:t,paddingBottom:o,collectionContextStore:r}=this.props,i=this.scrollPixelWidthStore.state,n=this.isReadyStore.state,s=r.isInHomeWidgetStore.state;return{position:"relative",float:"left",minWidth:"100%",width:i,...s?{}:{background:this.props.isInPeekRenderer?this.theme.peekTimelineBackground:this.theme.timelineBackground},...!t&&!e&&!s&&{borderBottom:`1px solid ${this.theme.tableDividerColor}`},...(!n||s)&&{minHeight:150},...t&&{paddingBottom:o},height:s?"100%":this.getComputedOuterHeight()}}getTableSelectableStyle(e){const{collectionContextStore:t}=this.props,o=t.isInHomeWidgetStore.state;return{whiteSpace:"nowrap",...o?{}:{background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground},paddingLeft:e,borderRight:`1px solid ${this.theme.tableDividerColor}`,boxShadow:this.theme.timelineTableBoxShadow,clipPath:"polygon(0% 0%, 120% 0%, 120% 100%, 0% 100%)",width:this.tableWidthStore.state+e+1,height:o?"100%":this.getComputedOuterHeight()}}getComputedOuterHeight(){const{device:e}=this.environment,{paddingBottom:t,isFullScreen:o}=this.props,{timelineSizeObserver:r}=this.timelineState,i=r.rect.state.height||120,n=this.showTableStore.state;return i+t+(o?0:72)+(!o&&n?28:0)+(o&&e.isMobile?72:0)}}rm.displayName="CollectionTimelineView";const im=rm;function nm(e){let{collectionContextStore:t,isFullScreen:o,paddingBottom:r}=e;const i=(0,X.VK)((()=>t.permissionScopesStore.state.canConfigureBlock),[t]),n=t.settingsStore;return(0,C.jsx)(Ss,{title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"No date property",id:"database.timelineView.missingDatePropertyTitle"}),description:i?(0,C.jsx)(P.FormattedMessage,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Timeline view.",id:"database.timelineView.missingDateProperty",values:{opensettingslink:e=>(0,C.jsx)(ms,{onClick:()=>{A.r$({collectionContextStore:t,collectionSettingsStore:n}),A.H4({collectionSettingsStore:n,item:{type:"properties",timelineViewTab:"timeline"}})},children:e})}}):(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Timeline views require a date property in order to display.",id:"database.timelineView.missingDatePropertyNoPermissions"}),style:{paddingBottom:o?void 0:r}})}function sm(e,t,o,r,i){return function(e,t,o,r){return(0,Qi.fj)({environment:r,isRootChild:e,isFullScreen:t,format:o})}(e,t,o,i)?Qi.Qw:r}function lm(e,t,o){const r=t.viewIsFlushToTopbar();return 0!==e||r?{borderTop:`1px solid ${o.tableDividerColor}`}:{}}function am(e,t){const{temporaryFormat:o}=t.state;return o||e}function cm(e){let{args:t,isFullScreen:o,isRootChild:r,format:i,paddingLeft:n,showTableStore:s}=e;const{hiddenGroupsVisibleStore:l,hiddenGroups:a}=t,c=(0,Y.O7)(),d=(0,X.VK)((()=>s.state),[s]),u=(0,X.VK)((()=>sm(r,o,i,n,c)),[r,o,i,n,c]);return d?null:(0,C.jsx)("div",{style:{width:"100%",height:Hi+zi,display:"flex"},children:(0,C.jsx)(Ki,{hiddenGroupsVisibleStore:l,hiddenGroups:a,style:{position:"sticky",left:o?u:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}function dm(e){let{args:t,isFullScreen:o,collectionContextStore:r,isRootChild:i,format:n,paddingLeft:s,showTableStore:l}=e;const a=(0,Y.O7)(),c=(0,X.VK)((()=>l.state),[l]),d=(0,X.VK)((()=>r.contextType),[r]),u=(0,X.VK)((()=>sm(i,o,n,s,a)),[i,o,n,s,a]);return c||"collectionTypedView"===d?null:(0,C.jsx)("div",{style:{width:"100%",height:as+cs,display:"flex"},children:(0,C.jsx)(ps,{...t,style:{position:"sticky",left:o?u:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}function um(e){let{args:t,isFullScreen:o,isRootChild:r,format:i,paddingLeft:n,showTableStore:s}=e;const l=(0,Y.O7)(),a=(0,X.VK)((()=>s.state),[s]),c=(0,X.VK)((()=>sm(r,o,i,n,l)),[r,o,i,n,l]);return a?null:(0,C.jsx)("div",{style:{width:"100%",height:Wi+2*Ui,display:"flex"},children:(0,C.jsx)($i,{...t,style:{position:"sticky",left:o?c:3,width:"max-content",paddingLeft:4,paddingRight:8}})})}var pm=o(509999),hm=o(439567),mm=o(776798),Sm=o(544862);const gm=function(e){const{store:t,titleStyle:o,actionButton:r,collectionContextStore:i}=e;return(0,C.jsxs)("div",{children:[(0,C.jsxs)("div",{style:{display:"flex"},children:[(0,C.jsx)(mm.Z,{store:t,style:o}),r]}),(0,C.jsx)(Sm.Z,{collectionStore:t,collectionContextStore:i})]})};var fm=o(819987),Cm=o(249394),vm=o(450627),ym=o(489086);function xm(e){const{environment:t,collectionContextStore:o,event:r,buttonPopupParent:i}=e,n=(0,ae.ay)(o);if(!n)return null;const s=ui.DJ(r);zt.c4({environment:t,url:n,openInNew:s}),s||null==i||i.close(),F.wd({environment:t,collectionContextStore:o,action:"click_source_view"})}const bm=(0,P.defineMessages)({titlePlaceholder:{defaultMessage:"Untitled",id:"database.source.titlePlaceholder"}});const wm=function(e){let{store:t,collectionContextStore:o,isFullScreen:r,canEdit:i,showHoverActionsStore:n}=e;const s=(0,Y.O7)(),l=(0,X.VK)((()=>{const e=Qe.default.state;return(0,ae.Ks)(t)||!(0,ae.en)(t)&&e.open&&e.isClosing}),[t]),a=(0,X.VK)((()=>{const e=o.collectionStore();if(!e)return!1;const t=e.getNameStore();return Boolean((0,ym.J5)(t))}),[o]),c=(0,X.VK)((()=>o.collectionStore()),[o]),d=(0,X.VK)((()=>o.permissionScopesStore.state),[o]),u=(0,X.VK)((()=>o.collectionViewBlockStore()),[o]),p=(0,X.VK)((()=>{var e;return Boolean((null==c||null===(e=c.getParentBlockStore())||void 0===e?void 0:e.id)===(null==u?void 0:u.id))}),[c,u]),h=(0,X.VK)((()=>Boolean(null==c?void 0:c.isSyncedCollection())),[c]),{WindowSizeStore:m}=s,S=(0,X.VK)((()=>Math.min(vm.zL,m.state.width)),[m]);if(!c||!u)return null;const g=(p||a)&&d.canConfigureCollection&&!h;return(0,C.jsxs)("div",{style:{...(r||l)&&(0,Xo.eA)(s)&&{position:"sticky",left:0},paddingTop:8,boxSizing:l?"content-box":void 0,width:l?S:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[g?(0,C.jsx)(jm,{collectionContextStore:o,showHoverActionsStore:n,isEditingName:a}):(0,C.jsx)(Rm,{collectionContextStore:o,showHoverActionsStore:n}),h&&(0,C.jsx)("div",{style:{display:"flex"},children:(0,C.jsx)(fm.Z,{canEdit:i,store:u,buttonStyle:{margin:0}})})]})};function km(e){return{fontWeight:j.Z.fontWeight.bold,fontSize:22,...e?{}:{display:"-webkit-box",lineClamp:1,WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden"}}}function Tm(e){const t=e.collectionStore();if(!t)return 22;return t.isSyncedCollection()?58:22}function _m(e,t){return{width:24,height:t?24:16,fill:e.regularIconColor}}function Vm(e){let{parent:t,collectionContextStore:o}=e;const r=(0,J.Fg)(),i=(0,Y.O7)(),n=(0,X.VK)((()=>o.permissionScopesStore.state),[o]),s=(0,X.VK)((()=>o.collectionStore()),[o]),l=(0,X.VK)((()=>null==s?void 0:s.isSyncedCollection()),[s]);if(!s)return null;const a=R.oA([{key:"view",render:e=>(0,C.jsx)(Me.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{id:"database.source.viewDatabase.title",defaultMessage:"View database"}),icon:(0,pm.J)(_m(r))}),action:e=>{xm({environment:i,collectionContextStore:o,event:e.event,buttonPopupParent:t})}},n.canConfigureCollection&&!l&&{key:"edit_name",render:e=>(0,C.jsx)(Me.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{id:"database.source.editTitle.title",defaultMessage:"Edit database title"}),icon:(0,Dt.R)(_m(r))}),action:()=>{U.mT({environment:i,store:s.getNameStore(),canSelectAllBlocks:!1}),t.close(),F.wd({environment:i,collectionContextStore:o,action:"click_source_edit_title"})}}]),c={key:"show_title",render:e=>(0,C.jsx)(Me.Z,{...e,icon:(0,Xc.L)(_m(r,!0)),title:(0,C.jsx)(P.FormattedMessage,{id:"database.source.hideTitle.title",defaultMessage:"Hide database title"})}),action:()=>{const e=o.collectionViewStore();if(!e)return null;q.createAndCommit({userAction:"CollectionViewBlockSource.showTitleItem",environment:i,perform:t=>{re.FH({stores:[e],update:{hide_linked_collection_name:!0},transaction:t})}}),t.close(),F.wd({environment:i,collectionContextStore:o,action:"click_source_hide_title"})}};return(0,C.jsx)(Re.Z,{type:Re.i.Vertical,sections:R.oA([{key:"actions",render:e=>(0,C.jsx)(je.Z,{...e}),items:a},n.canConfigureBlock&&{key:"show_title",render:e=>(0,C.jsx)(je.Z,{...e,topBorder:!0}),items:[c]}]),initialFocus:void 0})}function Om(e){let{showHoverActionsStore:t,collectionContextStore:o}=e;const r=(0,Y.O7)(),i=(0,X.VK)((()=>t.state),[t]);return(0,C.jsx)(pc.Z,{isVisible:!0,animationStyle:{opacity:i?1:0},render:()=>(0,C.jsx)("div",{style:{display:"flex",alignItems:"center",marginLeft:4},children:(0,C.jsx)(Te.ZP,{popupType:r.device.isMobile?Ve.kQ.SlideUp:Ve.kQ.Popup,render:e=>(0,C.jsx)(Vm,{parent:e,collectionContextStore:o}),renderOrigin:e=>(0,C.jsx)(_e.Z,{icon:ke.o,...e}),style:{width:240},originGap:4})})})}function Mm(e){G.ZH({debug:{userAction:"CollectionViewBlockSource.handleNameBlur"},environment:e})}function Pm(e){let{disabled:t,collectionContextStore:o}=e;const r=(0,J.Fg)(),i=(0,Y.O7)(),n=(0,X.VK)((()=>o.collectionStore()),[o]),s=(0,X.VK)((()=>o.collectionViewBlockStore()),[o]),l=(0,X.VK)((()=>null==n?void 0:n.getIcon()),[n]),a=(0,X.VK)((()=>{var e;return Boolean((null==n||null===(e=n.getParentBlockStore())||void 0===e?void 0:e.id)===(null==s?void 0:s.id))}),[n,s]),c=(0,X.VK)((()=>Tm(o)),[o]),d=(0,X.VK)((()=>function(e){return{width:Tm(e),height:Tm(e),marginRight:4}}(o)),[o]),u=(0,X.VK)((()=>null==s?void 0:s.getType()),[s]);return n&&s?l?(0,C.jsxs)("div",{style:{position:"relative",width:c+2,height:c+2,marginRight:4},children:[t?(0,C.jsx)(Xt.Z,{disabled:!0,bucket:"secure",store:n,icon:l,isEmptyPage:!1,style:d,size:c}):(0,C.jsx)(Xt.Z,{disabled:!1,bucket:"secure",store:n,icon:l,isEmptyPage:!1,style:d,size:c,iconLoggingData:{recordTable:n.table,source:"inline_collection",block_type:u,collection_id:n.id},onChange:e=>function(e,t,o){const r=o.collectionStore();if(!r)return;const i=r&&r.getIconStore();i&&q.createAndCommit({userAction:"CollectionViewBlockSource.handleRecordIconChange",environment:t,perform:t=>{ie.sO({store:i,value:e,transaction:t})}})}(e,i,o)}),!a&&(0,hm.Y)({position:"absolute",width:"50%",height:"50%",right:0,bottom:0,fill:"dark"===r.mode?r.regularTextColor:"#3E3C38",stroke:"dark"===r.mode?r.sidebarBackground:"white",strokeWidth:"dark"===r.mode?"1.85px":"1.5px"})]}):a?null:(0,C.jsx)("div",{style:{width:20,marginRight:4},children:(0,pm.J)({width:20})}):null}function Rm(e){let{collectionContextStore:t,showHoverActionsStore:o}=e;const r=(0,Y.O7)(),i=(0,X.VK)((()=>t.collectionStore()),[t]),n=(0,X.VK)((()=>t.collectionViewBlockStore()),[t]),s=(0,X.VK)((()=>(0,ae.ay)(t)),[t]);return i&&n?(0,C.jsxs)(Yt.Z,{style:{width:"max-content",maxWidth:"100%",marginRight:4,...j.Z.textOverflowStyle},innerStyle:{paddingLeft:4,paddingRight:4,display:"flex",alignItems:"center",borderRadius:4},href:s,onClick:()=>function(e,t){F.wd({environment:e,collectionContextStore:t,action:"click_collection_name_link_button"})}(r,t),children:[(0,C.jsx)(Pm,{collectionContextStore:t,disabled:!0}),(0,C.jsx)(gm,{actionButton:(0,C.jsx)(Om,{showHoverActionsStore:o,collectionContextStore:t}),store:i,collectionContextStore:t,titleStyle:km()})]}):null}function jm(e){let{collectionContextStore:t,showHoverActionsStore:o,isEditingName:r}=e;const i=(0,Y.O7)(),n=(0,X.VK)((()=>t.collectionStore()),[t]),s=(0,X.VK)((()=>t.collectionViewBlockStore()),[t]),l=(0,X.VK)((()=>null==n?void 0:n.getNameStore()),[n]);return n&&s&&l?(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:4,marginRight:4},children:[(0,C.jsx)(Pm,{collectionContextStore:t,disabled:!1}),(0,C.jsx)(to.Z,{store:l,style:{...km(r),marginRight:4},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableMobileActionBar:!1,disableComment:!0,placeholder:We.default.formatMessage(bm.titlePlaceholder),onEnter:()=>Mm(i),onEsc:()=>Mm(i),onClick:()=>function(e,t){F.wd({environment:e,collectionContextStore:t,action:"click_collection_name_input"})}(i,t),disableShiftEnter:!0,pasteBehavior:"inline",inPageFind:Cm.B3.none}),(0,C.jsx)(Om,{showHoverActionsStore:o,collectionContextStore:t})]}):null}var Im=o(85125),Fm=(o(252262),o(324506),o(238297)),Nm=o(145953),Bm=o(956518);const Em=new(o(453809).D)({key:"notion/async_clipboard_store",namespace:"AsyncClipboardStore",important:!0,trackingType:"necessary"});async function Am(e,t){let{lastActionWasCut:o,valuePromise:r}=t;const i=(0,Bm.tt)(e);Em.setState({eventId:i,waitingForCopy:!0,lastActionWasCut:void 0,value:void 0});const n=await r;if(!n)return void Em.setState({});const{recordMaps:s,...l}=n;Em.setState({eventId:i,waitingForCopy:!1,lastActionWasCut:o,value:{...l,recordMapsJson:Zm(s)}})}function Lm(e){const t=Em.getState(),o=(0,Bm.tt)(e);if(!t||!o||t.eventId!==o)return Promise.resolve(void 0);const{waitingForCopy:r,value:i,lastActionWasCut:n}=t;return r?new Promise((e=>{Em.addListener(function(e,t){return function o(r){const i=r.getState();if(!i)return void r.removeListener(o);const{waitingForCopy:n,value:s,lastActionWasCut:l}=i;n||i.eventId!==e||(r.removeListener(o),t(s?{lastActionWasCut:l||!1,value:{...s,recordMaps:Dm(s.recordMapsJson)}}:void 0))}}(o,e))})):i?Promise.resolve({lastActionWasCut:n||!1,value:{...i,recordMaps:Dm(i.recordMapsJson)}}):Promise.resolve(void 0)}function Dm(e){return new Map(e.map((e=>{let[t,o]=e;return[t,Nm.Ak.create(o)]})))}function Zm(e){return[...e.entries()].map((e=>{let[t,o]=e;return[t,o.toJson({allowVersionDowngrade:!1})]}))}var Hm=o(730188),zm=o(276725),Km=o(879978),Gm=o(742858),Wm=o(292283);function Um(){const e=(0,Y.O7)(),t=(0,jl.Y$)(),{value:o}=(0,Su.XJ)(ro.FF.markdownLinkifyIt),{value:r}=(0,Su.XJ)(ro.FF.tinyMceMicrosoftWordPasteFilter),n=(0,X.VK)((()=>{var e;const o=st.default.state.stores.at(0),r=null==o?void 0:o.getModel();if(!o||!r)return!1;const i=(0,Fm.ky)({block:r,getRecordModel:o.getRecordModel});return!!i&&i.id===(null===(e=t.collectionStore())||void 0===e?void 0:e.id)}),[t]),s=i.useCallback((r=>{Ca.JG({event:r,environment:e,markdownLinkifyIt:o});const i=st.default.state.stores;Am(r,{lastActionWasCut:!1,valuePromise:qm(e).then((o=>{for(const i of o){var r;I.dh(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:i.id,block_type:i.getType(),isBulk:!0,collection_id:null===(r=t.collectionStore())||void 0===r?void 0:r.id})}const n=o.length>0;for(const l of i){var s;I.dh(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:l.id,block_type:l.getType(),isBulk:n,collection_id:null===(s=t.collectionStore())||void 0===s?void 0:s.id})}return $m({environment:e,subitems:o})}))})}),[t,e,o]),a=i.useCallback((async r=>{Ca.JG({event:r,environment:e,markdownLinkifyIt:o});const i=t.collectionStore();if(null!=i&&i.isExternallyImportedAndSyncedCollection()&&(0,Wm.K6)())return;const n=st.default.state.stores,s=qm(e),l=qm(e).then((o=>{for(const n of o){var r;I.dh(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:n.id,block_type:n.getType(),isBulk:!0,collection_id:null===(r=t.collectionStore())||void 0===r?void 0:r.id})}const i=o.length>0;for(const l of n){var s;I.dh(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:l.id,block_type:l.getType(),isBulk:i,collection_id:null===(s=t.collectionStore())||void 0===s?void 0:s.id})}return $m({environment:e,subitems:o})}));await Am(r,{lastActionWasCut:!0,valuePromise:l});const a=st.default.getState().stores,c=await s;await Hm.VP({blocks:a,subitems:c,environment:e,canUndo:!0,skipConfirmation:!0})}),[t,e,o]),c=i.useCallback((async i=>{var n,s,a,c;const d=await Lm(i);if(Em.setState({...Em.getState(),lastActionWasCut:!1}),!d){var u;const n=st.default.state.stores[0];return q.createAndCommit({userAction:"CollectionViewKeyboardArea.defaultPaste",environment:e,perform:t=>{Ca.v({environment:e,event:i,disableEmbedMenu:!0,transaction:t,onPasteFiles:Ca.AL,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:r})}}),void I.dh(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:n.id,block_type:n.getType(),isBulk:!1,collection_id:null===(u=t.collectionStore())||void 0===u?void 0:u.id})}const p=t.collectionViewBlockStore();if(!p)return;const h=t.collectionStore();if(!h)return;if(h.isExternallyImportedAndSyncedCollection()&&(0,Wm.K6)())return;const{recordMaps:m,subitemFormat:S,childRelationSchema:g,parentRelationSchema:f}=d.value;if(!(m&&S&&g&&f))return;const C=[...m.entries()].map((e=>{let[t]=e;return Ye.G.createChildStore(h,{table:_.iU,id:t})}));await Promise.all(C.map((e=>e.load())));const v=st.default.getState().stores,y=!(d.lastActionWasCut&&function(e,t){const o=t.map((t=>Ye.G.createChildStore(e,t.pointer)));if(o.find((e=>!e.isReady)))return!1;return!o.find((e=>e.getAlive()))}(h,C));let x=[],b=rt.JR(t),w=null===(n=b)||void 0===n?void 0:n.parentRelationProperty,k=null===(s=b)||void 0===s?void 0:s.childRelationSchema,T=null===(a=b)||void 0===a?void 0:a.parentRelationSchema,V=null===(c=b)||void 0===c?void 0:c.subitemFormat;const O=t.permissionScopesStore.state.canConfigureCollection;for(const o of C){var M;I.dh(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:o.id,block_type:o.getType(),isBulk:d.value.isBulk,collection_id:null===(M=t.collectionStore())||void 0===M?void 0:M.id})}if(q.createAndCommit({userAction:"CollectionViewKeyboardArea.pasteWithSubitems",environment:e,perform:n=>{if(!V&&O){Hm.Bb({transaction:n,collectionContextStore:t,environment:e})&&(b=rt.JR(t),b&&(w=b.parentRelationProperty,k=b.childRelationSchema,T=b.parentRelationSchema,V=b.subitemFormat))}if(!(w&&k&&T&&V))return void Ca.v({environment:e,event:i,disableEmbedMenu:!0,transaction:n,onPasteFiles:Ca.AL,markdownLinkifyIt:o,tinyMceMicrosoftWordPasteFilter:r});const s=y?Hm.R2({blocks:C,environment:e,transaction:n,recordMaps:m,migrateSubitemFormat:{from:S,to:V},collectionContextStore:t,originalSubitemSchemas:{subitemRelationSchema:g,parentRelationSchema:f},analyticsFrom:d.lastActionWasCut?"cut":"copy"}):Hm.cI({blocks:C,transaction:n,from:S,to:V,environment:e,originAction:"paste"});!function(e){const{environment:t,selectedBlocks:o,blocksToInsert:r,subitemFormat:i,collectionContextStore:n,transaction:s}=e,l=n.collectionStore();if(!l)return;const a=o.at(-1),c=rt.qb(r,i);if(0===c.length)return;if(a){const e=rt.nK(n,a),o=function(e,t){if(e)return t;if(t.recordStoreUIParentStore instanceof Ye.G&&t.recordStoreUIParentStore.isPageBlock())return t.recordStoreUIParentStore}(Boolean(null==e?void 0:e.isExpanded),a);c.forEach((e=>{Hm.Cz({environment:t,blockStore:e,collectionStore:l,subitemFormat:i,transaction:s}),o&&Km.hE({environment:t,sourceStore:e,destStore:o,propertyWithInverse:{property:i.inverse,inverse:i.property},transaction:s,position:{type:"after"}})}))}else c.forEach((e=>{Hm.Cz({environment:t,blockStore:e,collectionStore:l,subitemFormat:i,transaction:s})}))}({environment:e,selectedBlocks:v,blocksToInsert:s,subitemFormat:V,collectionContextStore:t,transaction:n}),Gm.is({environment:e,blocks:s,selection:v,transaction:n,replaceEmptyTextBlock:!1,preventSetSelection:!0}),x=s}}),!(w&&k&&T&&V))return;const P=rt.T2({blocks:x,parentRelationProperty:w,parentRelationSchema:T,collectionViewBlockStore:p});l.default.afterNextFlush((()=>{l.default.afterNextFlush((()=>{G.Z5({environment:e,stores:P})}))}))}),[t,e,o,r]);return(0,C.jsx)(Qt.Z,{debugName:"CollectionViewKeyboardArea",capture:n,onCopy:s,onCut:a,onPaste:c})}function qm(e){const t=st.default.getState().stores;return Hm.xr({environment:e,blocks:t})}function $m(e){let{subitems:t,environment:o}=e;const r=st.default.getState().stores,i=r.at(0);if(!i)return;const n=(0,rt.g0)(i);if(!n)return;const s=[...r,...t],l=R.oA(s.map((e=>{const t=zm.K8(o,{blockId:e.id,inMemoryRecordCache:e.inMemoryRecordCache,allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0});return t&&[e.id,t]}))),a=new Map(l),{subitemFormat:c,childRelationSchema:d,parentRelationSchema:u}=n;return{recordMaps:a,subitemFormat:c,childRelationSchema:d,parentRelationSchema:u,isBulk:t.length>0}}var Qm=o(380503);const Ym=40;var Xm=o(966603),Jm=o(58202),eS=o(960709);function tS(e){const{collectionContextStore:t,headerSizeObserver:o,paddingRight:r,shouldScrollIntoView:i,settingsOpen:n}=e,s=(0,Y.O7)(),l=(0,X.VK)((()=>{const e=o.rect.state;return s.WindowSizeStore.state.height-(e.top+Ym)}),[s.WindowSizeStore,o.rect]),a=(0,X.VK)((()=>t.isInPeekRendererStore.state),[t.isInPeekRendererStore]),c=(0,X.VK)((()=>e.headerHeightStore.state),[e.headerHeightStore]),d=(0,X.VK)((()=>t.viewIsFlushToTopbar()),[t]),u=(0,X.VK)((()=>function(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}(e.collectionContextStore)),[e.collectionContextStore]),p=(0,J.yK)((e=>({topLevelDiv:{position:"absolute",top:c+(("timeline"===u||"table"===u)&&d?1:0),right:-r,background:a?e.cardContentBackground:e.contentBackground,borderLeft:`1px solid ${e.tableDividerColor}`,paddingRight:r,zIndex:M.Nm,height:l},nestedDiv:{boxShadow:`0 -1px 0 ${e.tableDividerColor}`}})),[c,l,a,r,u,d]);return(0,C.jsx)(pc.Z,{isVisible:n,enterAnimationStyle:{opacity:0,translateX:12},animationStyle:{opacity:1,translateX:0},exitAnimationStyle:{opacity:0,translateX:12},render:()=>(0,C.jsx)(yp.Z,{capture:n,allowMobileAutoScroll:!0,allowUndo:!0,render:e=>(0,C.jsx)("div",{style:p.topLevelDiv,className:dt.Dkf,...(0,hr.Z)({onMouseDown:e=>function(e,t){(0,ye.ZP)({event:e,context:ye.Af.EditorMouseDown,callback:()=>{U.ZH({debug:{userAction:"CollectionViewSettingsPopup.captureMouseDown"},environment:t})}})}(e,s)},e),children:(0,C.jsxs)("div",{style:{display:"flex",height:"100%"},children:[(0,C.jsx)("div",{style:p.nestedDiv,children:(0,C.jsx)(nS,{collectionContextStore:t,shouldScrollIntoView:i,isSidebar:!0})}),(0,C.jsx)("div",{style:{width:r}})]})})})})}function oS(e){const{collectionContextStore:t,placementToOrigin:o,alignmentToOrigin:r,originGap:n,marginTop:s,settingsOpen:l,shouldScrollIntoView:a,originRect:c}=e,d=(0,i.useCallback)((e=>(0,C.jsx)(nS,{collectionContextStore:t,shouldScrollIntoView:a,isSidebar:e})),[t,a]),u=(0,Y.O7)();return(0,C.jsx)(Ve.ZP,{popupType:u.device.isMobile?Ve.kQ.SlideUp:Ve.kQ.Popup,open:l,placementToOrigin:o,alignmentToOrigin:r,style:{marginTop:s},origin:(0,C.jsx)("div",{}),originGap:n,render:d,onDismiss:t=>function(e,t){(0,ye.ZP)({event:e,context:ye.Af.CollectionSettingsClick,callback:()=>{A.E3({collectionSettingsStore:t.settingsStore})}})}(t,e.collectionContextStore),originRect:c,keepFocus:!0,trapFocus:!0,preventScaleTransition:!0,preventOpacityTransition:!0})}const rS=function(e){const{collectionContextStore:t,headerSizeObserver:o,settingsHeaderSizeObserver:r,placementStore:n,placementToOrigin:s=eS.Iw.Top,alignmentToOrigin:l=eS.lU.Start,marginTop:a=-1,originGap:c}=e,d=(0,Y.O7)(),u=(0,X.VK)((()=>n.state),[n]),[p,h]=(0,i.useState)(!1),m=(0,X.VK)((()=>t.isInPeekRendererStore.state),[t.isInPeekRendererStore]),S=(0,X.VK)((()=>t.isFullScreenStore.state),[t.isFullScreenStore]),[g,f]=(0,i.useState)(!1),v=(0,X.VK)((()=>function(e){const t=e.settingsStore.state;return t.open&&!0!==t.hideSettingsPopup}(t)),[t]),y=(0,i.useRef)("popup");(0,X.VK)((()=>{const e=iS(t)||o.rect.state;if(0!==e.width){const o=(0,Xm.GC)(t,d.device.isMobile,e.width)??"popup";y.current=o}}),[t,d.device.isMobile,o.rect]),(0,i.useEffect)((()=>{v&&(o.recompute(),r.recompute(),n.setState(y.current)),v&&!S&&h(!0)}),[v,S,n,o,r]);const x=(0,X.VK)((()=>iS(t)||DOMRect.fromRect({x:r.rect.state.right-2,y:r.rect.state.y-2,width:0,height:r.rect.state.height})),[t,r.rect]);return(0,i.useEffect)((()=>{if(p){const e=t.collectionViewBlockStore();if(e){const t=Jm.R.findCollectionViewBlockFromStore(e);if(t){const e=t.getNode();if(e){const t=e.getBoundingClientRect(),i=d.WindowSizeStore.state.height-t.bottom,n=t.top;(i<tc.j9||n<Qm.Aj||m)&&((0,Xo.Wr)(e,{edgeDist:0,animate:!1}),o.recompute(),r.recompute())}}}h(!1)}}),[t,d.WindowSizeStore,o,r,m,p]),(0,i.useEffect)((()=>{f(!!v)}),[v]),"sidebar"===u?(0,C.jsx)(tS,{collectionContextStore:t,headerSizeObserver:o,paddingRight:e.paddingRight,shouldScrollIntoView:p,headerHeightStore:e.headerHeightStore,settingsOpen:g,isInPeekRenderer:m}):(0,C.jsx)(oS,{collectionContextStore:t,placementToOrigin:s,alignmentToOrigin:l,originGap:c??0,marginTop:a,settingsOpen:g,shouldScrollIntoView:p,originRect:x})};function iS(e){var t;return null===(t=e.settingsStore.state.ref)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect()}function nS(e){let{isSidebar:t,collectionContextStore:o,shouldScrollIntoView:r}=e;return r?null:(0,C.jsx)(Xa.PJ,{context:Xm.HV.ViewSettings,collectionContextStore:o,collectionSettingsStore:o.settingsStore,fullHeight:t})}class sS extends s.Z{constructor(){super(...arguments),this.storeTypes={placementStore:c.default.createClass(void 0,{name:"placementStore"}),shouldScrollIntoViewStore:c.default.createClass(!1,{name:"shouldScrollIntoViewStore"})},this.lastPlacement=void 0,this.justOpened=!1,this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderMenu=e=>(0,C.jsx)(dS,{collectionContextStore:this.props.collectionContextStore,shouldScrollIntoViewStore:this.stores.shouldScrollIntoViewStore,isSidebar:e}),this.heightStore=this.createComputedStore((()=>{const e=this.props.headerSizeObserver.rect.state;return this.environment.WindowSizeStore.state.height-(e.top+Ym)}))}UNSAFE_willMountOrUpdate(e){const{collectionContextStore:t}=e,o=aS(this.props.collectionContextStore),r=this.stores.placementStore.state;o&&!r&&(this.props.headerSizeObserver.recompute(),this.props.settingsHeaderSizeObserver.recompute());const i=cS(this.props.collectionContextStore)||this.props.headerSizeObserver.rect.state,n=!r||t.isInHomeWidgetStore.state;if(o&&n&&0!==i.width){const e=(0,Xm.F4)(this.props.collectionContextStore,this.environment.device.isMobile,i.width);this.stores.placementStore.setState(e),this.justOpened=!0,this.lastPlacement=e}else this.justOpened=!1;o||this.stores.placementStore.setState(void 0),this.justOpened&&(!t.isFullScreenStore.state&&"popup"!==this.stores.placementStore.state||Qe.default.isSidePeekOpen())&&this.stores.shouldScrollIntoViewStore.setState(!0)}didMountOrUpdate(){const{collectionContextStore:e}=this.props,{shouldScrollIntoViewStore:t}=this.stores;if(t.state){const o=e.collectionViewBlockStore();if(o){const t=Jm.R.findCollectionViewBlockFromStore(o);if(t){const o=t.getNode();if(o){const t=o.getBoundingClientRect(),r=this.environment.WindowSizeStore.state.height-t.bottom,i=t.top;(r<tc.j9||i<Qm.Aj||e.isInPeekRendererStore.state)&&((0,Xo.Wr)(o,{edgeDist:0,animate:!1}),this.props.headerSizeObserver.recompute())}}}t.setState(!1)}}renderComponent(){const{paddingRight:e,collectionContextStore:t,placementToOrigin:o=eS.Iw.Bottom,alignmentToOrigin:r=eS.lU.Start,marginTop:i=-1,originGap:n}=this.props,s=aS(this.props.collectionContextStore),l=this.lastPlacement,a=t.viewIsFlushToTopbar(),c=function(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}(this.props.collectionContextStore),d=("timeline"===c||"table"===c)&&a;if(l){if("sidebar"===l){const t=this.heightStore.state,o=this.props.headerHeightStore.state;return(0,C.jsx)(pc.Z,{isVisible:s,enterAnimationStyle:{opacity:0,translateX:12},animationStyle:{opacity:1,translateX:0},exitAnimationStyle:{opacity:0,translateX:12},render:()=>(0,C.jsx)(yp.Z,{capture:s,allowMobileAutoScroll:!0,allowUndo:!0,render:r=>(0,C.jsx)("div",{style:{position:"absolute",top:o+(d?1:0),right:-e,background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,borderLeft:`1px solid ${this.theme.tableDividerColor}`,paddingRight:e,zIndex:M.Nm,height:t},className:dt.Dkf,...(0,hr.Z)({onMouseDown:e=>{return t=e,o=this.environment,void(0,ye.ZP)({event:t,context:ye.Af.EditorMouseDown,callback:()=>{U.ZH({debug:{userAction:"CollectionViewSettingsPopup_Class.captureMouseDown"},environment:o})}});var t,o}},r),children:(0,C.jsxs)("div",{style:{display:"flex",height:"100%"},children:[(0,C.jsx)("div",{style:{boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`},children:(0,C.jsx)(dS,{collectionContextStore:this.props.collectionContextStore,shouldScrollIntoViewStore:this.stores.shouldScrollIntoViewStore,isSidebar:!0})}),(0,C.jsx)("div",{style:{width:e}})]})})})})}{const e=cS(this.props.collectionContextStore)||DOMRect.fromRect({x:this.props.settingsHeaderSizeObserver.rect.state.right-2,y:this.props.settingsHeaderSizeObserver.rect.state.y-2,width:0,height:this.props.settingsHeaderSizeObserver.rect.state.height});return(0,C.jsx)(Ve.ZP,{popupType:this.environment.device.isMobile?Ve.kQ.SlideUp:Ve.kQ.Popup,open:s,placementToOrigin:o,alignmentToOrigin:r,originGap:n,style:{marginTop:i},origin:(0,C.jsx)("div",{}),render:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_renderMenu,onDismiss:e=>function(e,t){(0,ye.ZP)({event:e,context:ye.Af.CollectionSettingsClick,callback:()=>{A.E3({collectionSettingsStore:t.settingsStore})}})}(e,this.props.collectionContextStore),originRect:e,keepFocus:!0,trapFocus:!0})}}}}sS.displayName="CollectionViewSettingsPopup";const lS=(0,P.injectIntl)(sS);function aS(e){const t=e.settingsStore.state;return t.open&&!0!==t.hideSettingsPopup}function cS(e){var t;return null===(t=e.settingsStore.state.ref)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect()}function dS(e){let{isSidebar:t,collectionContextStore:o,shouldScrollIntoViewStore:r}=e;return(0,X.VK)((()=>r.state),[r])?null:(0,C.jsx)(Xa.PJ,{context:Xm.HV.ViewSettings,collectionContextStore:o,collectionSettingsStore:o.settingsStore,fullHeight:t})}var uS=o(713401),pS=o(78454);function hS(e){const{origin:t}=e,o=(0,Y.O7)();return(0,C.jsx)(yl.U,{origin:t,placementToOrigin:"bottom",header:(0,C.jsx)(P.FormattedMessage,{id:"WikiHomeOnboardingTooltip.header",defaultMessage:"Welcome to your new wiki!"}),content:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Viewers will have the same reading experience as before, but editors have new features to keep content up to date",id:"WikiHomeOnboardingTooltip.content"}),onCloseClick:()=>{Nc.Rg(o)},enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,pointerPosition:"18%",pointerLength:Lc.EZ,pointerOffset:Lc.rK,style:{width:Lc.G5}})}function mS(e){const{origin:t}=e,o=(0,Y.O7)();return(0,C.jsx)(yl.U,{origin:t,placementToOrigin:"right",header:(0,C.jsx)(P.FormattedMessage,{id:"WikiViewsOnboardingTooltip.header",defaultMessage:"New views"}),content:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"The <bold>All pages</bold> and <bold>Pages I own</bold> views will give you an overview of pages in your wiki",id:"WikiViewsOnboardingTooltip.content",values:{bold:e=>(0,C.jsx)("span",{style:{fontWeight:j.Z.fontWeight.semibold},children:e})}}),onCloseClick:()=>{Nc.Rg(o)},pointerPosition:"50%",pointerLength:Lc.EZ,pointerOffset:Lc.FD,enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,style:{width:Lc.G5}})}let SS;class gS{constructor(e){this.style=void 0,this.lastResult=void 0,this.style=e.style}measure(e){var t;if(e===(null===(t=this.lastResult)||void 0===t?void 0:t.text))return this.lastResult.rect;SS||(SS=document.createElement("div"),SS.style.position="absolute",SS.style.left="0",SS.style.top="0",SS.style.pointerEvents="none",SS.style.opacity="0",document.body.appendChild(SS)),R.M6(this.style,((e,t)=>{SS&&(SS.style[t]=e)})),SS.textContent=e;const o=SS.getBoundingClientRect();return this.lastResult={text:e,rect:o},o}}var fS=o(677794),CS=o(820616),vS=o(73657),yS=o(229798),xS=o(217215),bS=o(214976),wS=o(755964),kS=o(753470),TS=o(394841);const _S={svgIcon:{width:24,height:16},svgIconPadded:{width:24,height:24}};function VS(e){let{collectionViewStore:t,collectionContextStore:o,onClose:r}=e;const i=(0,Y.O7)(),n=(0,P.useIntl)(),s=(0,X.VK)((()=>{if("form_editor"===(null==t?void 0:t.getType()))return[t.getFormBlockStore()]}),[t]),l=(0,X.VK)((()=>function(e){var t;let{collectionViewStore:o,collectionContextStore:r,formBlockStore:i,onClose:n,environment:s,intl:l,styles:a}=e;const c=r.permissionScopesStore.state,d=r.collectionViewStore(),u=r.collectionViewBlockStore();if(!d||!u)return[];const p=(0,TS.Kj)(u.id),h=(0,ge.qG)(u.id),m=d.id===o.id,S=o.getAppConfigUri(),g=r.normalizedFormatStore.state.hide_linked_collection_name,f=!S||(0,Q.R8)(S),v=r.collectionStore(),y=Boolean((null==v||null===(t=v.getParentBlockStore())||void 0===t?void 0:t.id)===u.id),x=y&&r.isFullScreenStore.state,b=!h,w=u.getCollectionViewIds().length>1,k=r.isEditableHomeCollectionStore.state,T=!h&&(w||k),_=o.getType(),V=g&&!p&&c.canConfigureBlock,O=[];if(O.push([]),c.canConfigureBlock){if(O[0].push({key:"rename",render:e=>(0,C.jsx)(Jt.Z,{placement:Sc.u.Left,disableTooltip:f,render:t=>(0,C.jsx)(Me.Z,{...e,disabled:!f,disabledFeedback:!0,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Rename",id:"database.viewSettings.viewActionMenu.rename"}),icon:(0,kS.H)(a.svgIcon),...t}),renderTooltip:()=>(0,C.jsx)(P.FormattedMessage,{id:"database.viewSettings.viewActionMenu.cannotRename",defaultMessage:"This view can’t be renamed."})}),action:()=>{F.wd({environment:s,collectionContextStore:r,action:"view_action_menu_rename"}),null==n||n(!0),m||le.f8({environment:s,collectionContextStore:r,collectionViewId:o.id,isFullScreen:r.isFullScreenStore.state,isRootChild:r.isRootChildStore.state,isInPeekRenderer:r.isInPeekRendererStore.state}),A.r$({collectionContextStore:r,collectionSettingsStore:r.settingsStore,selectViewNameInitial:!0})}}),"page"===_)return O;O[0].push({key:"edit",render:e=>(0,C.jsx)(Me.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Edit view",id:"database.viewSettings.viewActionMenu.editView"}),icon:(0,od.W)(a.svgIcon)}),action:()=>{F.wd({environment:s,collectionContextStore:r,action:"view_action_menu_edit"}),null==n||n(!0),m||le.f8({environment:s,collectionContextStore:r,collectionViewId:o.id,isFullScreen:r.isFullScreenStore.state,isRootChild:r.isRootChildStore.state,isInPeekRenderer:r.isInPeekRendererStore.state}),A.r$({collectionContextStore:r,collectionSettingsStore:r.settingsStore})}})}O.push([]),O[1].push({key:"copyLink",render:e=>(0,C.jsx)(Me.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Copy link to view",id:"database.viewSettings.viewActionMenu.copyLink"}),icon:(0,fa.N)(a.svgIcon)}),action:async()=>{F.wd({environment:s,collectionContextStore:r,action:"view_action_menu_copy_link"}),await A.Ol({environment:s,collectionContextStore:r,collectionViewStore:o}),null==n||n(!1)}}),v&&!x&&O[1].push({key:"openSourceDb",render:e=>(0,C.jsx)(Jt.Z,{placement:Sc.u.Right,render:t=>(0,C.jsx)(Me.Z,{title:y?(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Open as full page",id:"database.viewSettings.viewActionMenu.openAsFullPage"}):(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Open source database",id:"database.viewSettings.viewActionMenu.openSourceDb"}),icon:(0,pm.J)(a.svgIcon),...(0,hr.Z)(e,t)}),renderTooltip:()=>(0,C.jsx)(MS,{collectionStore:v})}),action:e=>{xm({environment:s,collectionContextStore:r,event:e.event})}});V&&O[1].push({key:"showDatabaseTitle",render:e=>(0,C.jsx)(Me.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Show database title",id:"database.viewSettings.viewActionMenu.showDatabaseTitle"}),icon:(0,wS.N)(a.svgIconPadded)}),action:()=>{F.wd({environment:s,collectionContextStore:r,action:"click_source_show_title"}),q.createAndCommit({userAction:"CollectionViewActionMenu.getMenuSections",environment:s,perform:e=>{re.FH({stores:[o],update:{hide_linked_collection_name:!1},transaction:e})}}),null==n||n(!1)}});O.push([]),c.canConfigureBlock&&b&&O[2].push({key:"duplicate",render:e=>(0,C.jsx)(Me.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Duplicate",id:"database.viewSettings.viewActionMenu.duplicate"}),icon:(0,Yc.a)(a.svgIcon)}),action:()=>{F.wd({environment:s,collectionContextStore:r,action:"view_action_menu_duplicate"}),A.zt({environment:s,collectionContextStore:r,collectionViewStore:o,collectionSettingsStore:r.settingsStore,intl:l}),null==n||n(!0)}});c.canConfigureBlock&&T&&O[2].push({key:"delete",render:e=>(0,C.jsx)(Me.Z,{...e,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Delete",id:"database.viewSettings.viewActionMenu.delete"}),icon:(0,or.y)(a.svgIcon),isRedOnHover:!0}),action:async()=>{F.wd({environment:s,collectionContextStore:r,action:"view_action_menu_delete"});await A.TT({environment:s,collectionContextStore:r,collectionViewStore:o,collectionSettingsStore:r.settingsStore,additionalBlocksToDelete:i,from:"view_action_menu"})&&(null==n||n(!1))}});return O}({collectionViewStore:t,collectionContextStore:o,formBlockStore:s,onClose:r,environment:i,intl:n,styles:_S})),[o,s,t,i,n,r]);return(0,C.jsx)(Re.Z,{type:Re.i.Vertical,initialFocus:void 0,sections:R.oA(l.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,C.jsx)(je.Z,{...e,topBorder:0!==t}),items:e}})))})}const OS=i.memo(VS,pe.Z);function MS(e){const{collectionStore:t}=e,o=(0,P.useIntl)(),r=(0,X.VK)((()=>{const e=t.getNameStore();return(0,bS.Xh)(e.getValue(),e)||o.formatMessage(bm.titlePlaceholder)}),[t,o]);return(0,C.jsx)(P.FormattedMessage,{id:"database.viewSettings.viewActionMenu.openDbTooltip",defaultMessage:"Opens “{dbName}”",values:{dbName:r}})}var PS=o(668155);function RS(e){const{collectionContextStore:t,collectionViewStore:o,menuListItemProps:r,onClose:n}=e,{device:s}=(0,Y.O7)(),l=(0,J.yK)((e=>({tooltipMessage:{color:e.mediumInvertedTextColor}})),[]),a=(0,P.useIntl)(),c=(0,X.qz)(void 0,ss.Z),[d,u,p,h,m,S]=(0,X.VK)((()=>[o.getName(),o.getType(),o.getFormat().collection_view_icon,o.getFormat().description,o.getCollectionStore(),t.permissionScopesStore.state.canConfigureBlock]),[o,t]),g=(0,i.useCallback)((e=>{c.setState({open:!1}),e&&n()}),[c,n]),f=(0,i.useCallback)((()=>{const t=s.isMobile?{menuType:Oe.og.ActionSheet}:{menuType:Oe.og.Popup,width:220};return(0,C.jsx)(Pe.Z,{...t,children:(0,C.jsx)(OS,{...e,onClose:g})})}),[s.isMobile,g,e]);return void 0===u?null:(0,C.jsx)(Jt.Z,{renderTooltip:e=>(0,C.jsxs)("div",{...e,style:Gc.F6,children:[(0,C.jsx)("div",{children:(0,ae.Cc)({collectionViewName:d,collectionViewType:u})}),void 0!==m&&(0,C.jsx)("div",{style:l.tooltipMessage,children:h||(0,C.jsx)(P.FormattedMessage,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} Form {Form} Chart {Chart view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:It.Bh[u],collection:(0,bS.Xh)(m.getName(),m)||(0,xS.Q2)(a)}})})]}),placement:Sc.u.Left,render:e=>(0,C.jsx)(Me.Z,{title:(0,C.jsx)(PS.Z,{collectionViewType:u,collectionViewName:d}),icon:(0,C.jsx)(CS.F,{color:"regular",viewIcon:p,viewType:u}),showDragHandle:!s.isMobile&&S,right:S?(0,C.jsx)(Te.ZP,{popupType:s.isMobile?Te.Z4.SlideUp:Te.Z4.Popup,renderOrigin:e=>(0,C.jsx)(_e.Z,{icon:ke.o,ariaLabel:a.formatMessage({id:"collectionViewSelectItem.viewSettings.ariaLabel",defaultMessage:"Database view settings"}),...e}),render:f,buttonPopupStore:c}):null,rightStyle:{marginRight:8},...(0,hr.Z)(e,r)})})}var jS=o(288833);const IS=(0,P.defineMessages)({suggestedSectionTitle:{defaultMessage:"Suggested",id:"database.collectionViewSuggestedViews.suggestedTitle"}});function FS(e,t){const o=(0,Y.O7)(),r=(0,X.VK)((()=>uo.default.state.currentSpaceViewStore),[]),n=(0,X.VK)((()=>e.collectionViewBlockStore()),[e]),s=(0,X.VK)((()=>e.collectionStore()),[e]),l=(0,X.VK)((()=>{var e;if(!s)return;const t=null===(e=s.getFormat())||void 0===e?void 0:e.app_config_uri;return t?(0,Q.YB)((0,dd.appConfigs)(),t):void 0}),[s]),a=i.useCallback((i=>{if(!n||!l||!r)return;const s=n.getParentStore();if(!s||"block"!==s.table&&"space"!==s.table&&"team"!==s.table)return;if(1!==i.dependencies.length)return;const a=i.dependencies[0];q.createAndCommit({userAction:"CollectionViewSuggestedViews.createView",environment:o,perform:c=>{var d;jS.applyTypedFeatures({environment:o,spaceViewStore:r,appParentStore:s,appUri:l.uri,features:[{type:"simple",featureUri:i.uri}],appCollectionViewBlockStores:[n],createOrModify:"modify",transaction:c});const u=((null===(d=n.getFormat())||void 0===d?void 0:d.app_uri_map)??{})[a.uri];le.f8({environment:o,collectionContextStore:e,collectionViewId:u,isFullScreen:e.isFullScreenStore.state,isRootChild:e.isRootChildStore.state,isInPeekRenderer:e.isInPeekRendererStore.state}),t()}}),F.xb({environment:o,collectionContextStore:e,view_type:a.value.type,view_config_uri:i.uri})}),[n,l,r,o,e,t]);return{renderSuggestedView:i.useCallback((e=>({key:e.uri,render:t=>(0,C.jsx)(Jt.Z,{placement:Sc.u.Left,render:o=>((e,t)=>{var o;const r=e.dependencies[0],i=(0,C.jsx)(CS.F,{color:"regular",viewIcon:null===(o=r.value.format)||void 0===o?void 0:o.collection_view_icon,viewType:r.value.type});return(0,C.jsx)(Me.Z,{title:r.value.name?r.value.name:"New View",icon:i,...t})})(e,{...t,...o,onMouseEnter:e=>{var r,i;null===(r=o.onMouseEnter)||void 0===r||r.call(o,e),null===(i=t.onMouseEnter)||void 0===i||i.call(t,e)}}),renderTooltip:()=>e.description}),action:()=>{a(e)}})),[a])}}function NS(e){const t=(0,Y.O7)(),o=t.device,r=(0,J.yK)((e=>({showMoreLabel:{color:e.mediumTextColor}})),[]),n=e.suggestedViews,{renderSuggestedView:s}=FS(e.collectionContextStore,e.onClose),[l,a]=(0,i.useState)(!1),{collectionContextStore:c,onClose:d,onNewEmptyViewClick:u}=e,p=(0,X.VK)((()=>c.permissionScopesStore.state),[c]),h=(0,xa.$Z)(),m=(null==n?void 0:n.map((e=>s(e))))??[],S={key:"showMore",render:e=>(0,C.jsx)(Me.Z,{...e,style:r.showMoreLabel,title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Show more...",id:"collectionViewSuggestedViews.showMore.label"})}),action:()=>{a(!0)}},g={key:"new_form",render:e=>(0,C.jsx)(je.Z,{topBorder:!0,...e}),items:[(0,va.gp)({environment:t,collectionContextStore:c})]},f={key:"suggested_views",render:e=>(0,C.jsx)(je.Z,{...e}),items:l||m.length<=5?[...m]:[...m.slice(0,5),S]},v=h?[f,g]:[f],y=(0,C.jsx)(Re.Z,{type:Re.i.Vertical,initialFocus:0,sections:v}),x=p.canConfigureBlock&&(0,C.jsx)(je.Z,{topBorder:!0,children:(0,C.jsx)(uS.Z,{title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"New empty view",id:"database.collectionViewSuggestedViews.newEmptyViewTitle"}),onClick:()=>{u("CollectionViewSuggestedViews2.handleNewEmptyViewClick"),d()},focused:!1})});return(0,C.jsx)(yp.Z,{capture:!0,allowEsc:!0,render:t=>{let r;return r=o.isMobile?{menuType:Oe.og.Modal,title:e.title?e.title:We.default.formatMessage(IS.suggestedSectionTitle),right:(0,C.jsx)(nr.DoneMenuText,{}),onClickRight:d,...t}:{menuType:Oe.og.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh",...t},(0,C.jsxs)(Pe.Z,{...r,children:[m.length&&(0,C.jsx)(je.Z,{title:!o.isMobile&&(e.title?e.title:We.default.formatMessage(IS.suggestedSectionTitle)),disableMobilePadding:!0,topBorder:!1,desktopTitleStyle:{marginTop:2,marginBottom:2},style:{paddingBottom:0},children:y}),x]})}})}function BS(e){const{collectionContextStore:t,onAddViewClick:o,onClose:r,onViewClick:n,suggestedViews:s}=e,l=(0,P.useIntl)(),a=(0,Y.Fy)(),[c,d]=i.useState(0),[u,p]=i.useState(""),h=(0,X.qz)(void 0,yS.Z),m=(0,X.VK)((()=>{var e;return!(a.isMobile||null!==(e=t.collectionViewBlockStore())&&void 0!==e&&e.isCollectionViewPageWithContent())}),[t,a.isMobile]),S=(0,X.VK)((()=>{var e;return((null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())||[]).filter((e=>(0,ae.D)(e,u)))}),[t,u]),g=i.useCallback((e=>{p(e.target.value),h.setState({...h.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}),[h]);return i.useEffect((()=>{var t,o;const{collectionContextStore:r}=e,i=null===(t=r.collectionViewStore())||void 0===t?void 0:t.id,n=((null===(o=r.collectionViewBlockStore())||void 0===o?void 0:o.getCollectionViewStores())||[]).findIndex((e=>e.id===i));n>=0&&d(n)}),[e]),(0,C.jsx)(yp.Z,{capture:!0,allowEsc:!0,render:e=>{var i;let d;return d=a.isMobile?{menuType:Oe.og.Modal,title:(0,C.jsx)(AS,{collectionContextStore:t}),right:(0,C.jsx)(nr.DoneMenuText,{}),onClickRight:r}:{menuType:Oe.og.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh"},(0,C.jsxs)(Pe.Z,{...d,...e,header:m?(0,C.jsx)(Cs.ZP,{value:u,focus:!0,style:{marginTop:8,marginBottom:4},textWrapperStyle:{marginLeft:8,marginRight:8},onChange:g,placeholder:l.formatMessage({defaultMessage:"Search for a view...",id:"collectionViewSelect.viewSearch.label"})}):null,footer:a.isMobile?null:(0,C.jsx)(HS,{collectionContextStore:t,onClose:r,onAddViewClick:o,suggestedViews:s}),children:[(0,C.jsx)(je.Z,{title:!a.isMobile&&!(null!==(i=t.collectionViewBlockStore())&&void 0!==i&&i.isCollectionViewPageWithContent)&&(0,C.jsx)(AS,{collectionContextStore:t}),disableMobilePadding:!0,topBorder:!1,desktopTitleStyle:{marginTop:0,marginBottom:0},children:(0,C.jsx)(LS,{collectionContextStore:t,filteredViewStores:S,viewFilterQuery:u,menuListStore:h,initialMenuListFocus:c,onClose:r,onViewClick:n})}),u&&0===S.length&&(0,C.jsx)(vS.Z,{caption:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"No results",id:"database.collectionViewSelect.noResultsTitle"})}),a.isMobile?(0,C.jsx)(HS,{collectionContextStore:t,onClose:r,onAddViewClick:o,suggestedViews:s}):null]})}})}const ES=i.memo(BS);function AS(e){let{collectionContextStore:t}=e;const o=(0,X.VK)((()=>{var e;return(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())||[]}),[t]);return(0,C.jsx)(P.FormattedMessage,{defaultMessage:"{numberOfViews, plural, one {{numberOfViews} view} other {{numberOfViews} views}}",id:"database.mobileSelectViewMenu.title",values:{numberOfViews:o.length}})}function LS(e){const{collectionContextStore:t}=e,o=(0,Y.O7)(),r=(0,xa.$Z)(),n=i.useCallback(((r,i)=>{const n=t.collectionViewStore(),s=ui.DJ(r);n&&e.onViewClick({currentCollectionViewStore:n,newCollectionViewStore:i,openInNew:s});const l=t.isFullScreenStore.state,a=t.isRootChildStore.state,c=t.isInPeekRendererStore.state;le.f8({environment:o,collectionContextStore:t,collectionViewId:i.id,openInNew:s,isFullScreen:l,isRootChild:a,isInPeekRenderer:c}),F.wd({environment:o,collectionContextStore:t,action:"click_view_in_dropdown",new_view_type:i.getType(),new_view_id:i.id}),s||e.onClose()}),[t,o,e]);if(0===e.filteredViewStores.length)return null;const s=e.filteredViewStores.map((t=>({key:t.id,render:o=>(0,C.jsx)(ZS,{collectionContextStore:e.collectionContextStore,onClose:e.onClose,collectionViewStore:t,props:o}),action:e=>{let{event:o}=e;n(o,t)}}))),l=(0,va.gp)({environment:o,collectionContextStore:e.collectionContextStore}),a={key:"views",render:t=>(0,C.jsx)(DS,{menuListSectionProps:t,collectionContextStore:e.collectionContextStore,filteredViewStores:e.filteredViewStores,viewFilterQuery:e.viewFilterQuery,menuListStore:e.menuListStore}),items:s},c=r?[a,{key:"new_form",render:e=>(0,C.jsx)(je.Z,{topBorder:!0,...e}),items:[l]}]:[a];return(0,C.jsx)(Re.Z,{type:Re.i.Vertical,initialFocus:e.initialMenuListFocus,sections:c,store:e.menuListStore})}function DS(e){const t=(0,Y.O7)(),o=(0,Y.Fy)(),r=(0,X.VK)((()=>{const t=e.collectionContextStore.permissionScopesStore.state;return!o.isMobile&&t.canConfigureBlock&&""===e.viewFilterQuery}),[o.isMobile,e.collectionContextStore.permissionScopesStore,e.viewFilterQuery]),n=(0,X.VK)((()=>e.filteredViewStores.map((e=>e.id))),[e.filteredViewStores]),s=i.useCallback(((o,r)=>{const i=e.collectionContextStore.collectionViewBlockStore();i&&(q.createAndCommit({userAction:"CollectionViewSelect2.handleViewsDrop",environment:t,perform:e=>{le.Wu({collectionViewBlockStore:i,newViewIds:o,transaction:e})}}),e.menuListStore.reset())}),[t,e.collectionContextStore,e.menuListStore]);return r?(0,C.jsx)(je.Z,{...e.menuListSectionProps,children:(0,C.jsx)(gs.ZP,{direction:"vertical",keys:n,renderKey:t=>e.menuListSectionProps.children[n.indexOf(t)],onDrop:s})}):(0,C.jsx)(je.Z,{...e.menuListSectionProps})}function ZS(e){let{collectionViewStore:t,props:o,collectionContextStore:r,onClose:i}=e;return(0,C.jsx)(RS,{collectionContextStore:r,collectionViewStore:t,onClose:i,menuListItemProps:o})}function HS(e){const t=(0,Y.O7)();if(!(0,X.VK)((()=>{var t;if(!e.collectionContextStore.permissionScopesStore.state.canConfigureBlock)return!1;return!(0,ge.qG)((null===(t=e.collectionContextStore)||void 0===t||null===(t=t.collectionViewBlockStore())||void 0===t?void 0:t.id)??"")}),[e.collectionContextStore]))return null;const o=(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Add view",id:"database.collectionViewSelect.addViewButtonTitle"});return(0,C.jsx)(je.Z,{topBorder:!0,children:e.suggestedViews&&e.suggestedViews.length?(0,C.jsx)(Te.ZP,{popupType:t.device.isMobile?Ve.kQ.SlideUp:Ve.kQ.Popup,alignmentToOrigin:Te.vR.Center,placementToOrigin:Te.pO.Right,renderOrigin:e=>(0,C.jsx)(uS.Z,{...e,title:o,focused:!1}),render:()=>(0,C.jsx)(NS,{collectionContextStore:e.collectionContextStore,suggestedViews:e.suggestedViews??[],onClose:e.onClose,onNewEmptyViewClick:e.onAddViewClick})}):(0,C.jsx)(uS.Z,{focused:!1,title:o,onClick:()=>{e.onAddViewClick("CollectionViewSelect2.handleCreateButtonClick"),e.onClose()}})})}var zS=o(416732),KS=o(426991);const GS=i.memo((function(e){let{collectionViewStore:t,collectionContextStore:o,hideUnderline:r,onViewClick:n,disabled:s}=e;const l=(0,Y.O7)(),a=(0,J.Fg)(),[c,d]=(0,i.useState)(!1),p=(0,i.useCallback)((e=>{e.preventDefault(),(0,ye.ZP)({event:e,context:ye.Af.EditorContextMenu,callback:()=>{d(!0)}})}),[]),h=(0,i.useCallback)((e=>{const r=o.collectionViewStore();if(!r)return;const i=ui.DJ(e);n({currentCollectionViewStore:r,newCollectionViewStore:t,openInNew:i}),r.id===t.id?d(!0):function(e,t,o,r){le.f8({environment:o,collectionContextStore:t,collectionViewId:e,openInNew:r,isFullScreen:t.isFullScreenStore.state,isRootChild:t.isRootChildStore.state,isInPeekRenderer:t.isInPeekRendererStore.state})}(t.id,o,l,i),F.wd({environment:l,collectionContextStore:o,action:"click_view_tab",new_view_type:t.getType(),new_view_id:t.id})}),[l,o,t,n]),m=(0,i.useCallback)((()=>{d(!1)}),[]),S=(0,i.useCallback)((()=>{let e;return e=l.device.isPhone?{menuType:Oe.og.Modal,right:(0,C.jsx)(nr.DoneMenuText,{}),onClickRight:m}:{menuType:Oe.og.Popup,minWidth:220},(0,C.jsx)(Pe.Z,{...e,children:(0,C.jsx)(OS,{collectionContextStore:o,collectionViewStore:t,onClose:m})})}),[o,t,l,m]),g=(0,X.VK)((()=>o.collectionViewStore()),[o]),f=(0,X.VK)((()=>o.collectionViewBlockStore()),[o]),v=(0,X.VK)((()=>null==t?void 0:t.getFormat().collection_view_icon),[t]),y=(0,X.VK)((()=>null==t?void 0:t.getType()),[t]),x=(0,X.VK)((()=>t.isDefined()),[t]),b=(0,X.VK)((()=>{var e;return(null===(e=o.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||"none"}),[o.inheritedBlockColorStore]),w=(0,i.useRef)(null),k=(0,X.VK)((()=>{var e;return(null==f?void 0:f.getSpaceId())!==(null===(e=uo.default.state.currentSpaceStore)||void 0===e?void 0:e.id)}),[f]),T=(0,X.VK)((()=>{var e;return t.getFormat().app_config_uri===u.g3&&"sprint_board"===(null===(e=uo.default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.getFormat().special_page_for_pm_launch)&&!k}),[t,k]),_=(0,X.VK)((()=>{var e;const t=null===(e=o.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores();return t&&t.length>1}),[o]),V=(null==g?void 0:g.id)===t.id,O=(0,X.VK)((()=>!r&&V&&_),[_,r,V]);return x&&g&&f?(0,C.jsx)(Ve.ZP,{popupType:l.device.isMobile?Ve.kQ.SlideUp:Ve.kQ.Popup,alignmentToOrigin:Ve.ZP.Alignment.Start,open:c,render:S,onDismiss:m,origin:(0,C.jsxs)("div",{className:dt.rTm,style:{display:"flex",alignItems:"center",background:b,height:"100%",...O&&{borderBottom:`2px solid ${a.regularTextColor}`,paddingTop:2}},onContextMenu:p,children:[T&&(0,C.jsx)(Ut.FF,{origin:w}),(0,C.jsx)(WS,{collectionViewStore:t,render:e=>(0,C.jsxs)(Et.Z,{"aria-selected":V,role:"tab",ref:w,style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:j.Z.fontWeight.medium,color:V?a.regularTextColor:a.mediumTextColor,maxWidth:$S},hovered:c,onClick:h,disabled:s,...e,children:[(0,C.jsx)(CS.F,{color:V?"regular":"light",viewIcon:v,viewType:y,style:{marginRight:6}}),(0,C.jsx)("span",{style:{...j.Z.textOverflowStyle,marginTop:1},children:(0,C.jsx)(qS,{collectionContextStore:o,collectionViewStore:t})})]},t.id)})]})}):null}));function WS(e){const t=(0,J.Fg)(),o=(0,P.useIntl)(),{collectionViewStore:r,render:i,disableTooltip:n}=e,s=(0,X.VK)((()=>r.getCollectionStore()),[r]),l=(0,X.VK)((()=>null==s?void 0:s.getModel()),[s]),a=(0,X.VK)((()=>r.getFormat().description),[r]),c=(0,X.VK)((()=>r.getModel()),[r]);return c?(0,C.jsx)(Jt.Z,{placement:Sc.u.Bottom,alignment:Sc.v.Start,delayThreshold:500,render:i,disableTooltip:n,renderTooltip:e=>(0,C.jsxs)("div",{...e,style:Gc.F6,children:[(0,C.jsx)("div",{children:(0,ae.Cc)({collectionViewName:c.getName(),collectionViewType:c.getType()})}),s&&l&&(0,C.jsx)("div",{style:{color:t.mediumInvertedTextColor},children:a||(0,C.jsx)(P.FormattedMessage,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} Form {Form} Chart {Chart view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:It.Bh[c.getType()],collection:(0,bS.Xh)(s.getName(),s)||l.getEmptyTitlePlaceholder({intl:o})}})})]})}):null}function US(e,t,o){var r;const i=e.collectionStore();if(!i)return t.getName();const n=i.getPropertyMapping(),s=t.getName(),l=null==n?void 0:n[u.Es.TaskToSprintRelation];if(!o||!l||s!==We.default.formatMessage(zS.sY.tasksCurrentSprintV2ViewName))return t.getName();const a=o[l];if(!a||"relation"!==a.type||!a.collection_pointer)return t.getName();const c=null===(r=(0,KS.As)(e,"current",a.collection_pointer,i))||void 0===r?void 0:r.getBlockTitleStore().getValue();return c?`${We.default.formatMessage(zS.sY.tasksCurrentSprintV2ViewNamePrefix)}: ${c[0]}`:t.getName()}function qS(e){const{collectionViewStore:t,collectionContextStore:o}=e,[r,i]=(0,X.VK)((()=>{const e=o.settingsStore.state;return[e.open,R.Z$(e.stack)]}),[o.settingsStore]),n=(0,X.VK)((()=>o.collectionViewStore()),[o]),s=(0,X.VK)((()=>t.getCollectionStore()),[t]),l=(0,X.VK)((()=>{if(t.isDefined()){return(null==t?void 0:t.getFormatStore().getKeyStore("app_config_uri").getValue())===u.g3&&null!=s&&s.isDefined()?{name:US(o,t,s.getSchema()),type:t.getType()}:{name:t.getName(),type:t.getType()}}}),[t,s,o]);return!l||n&&n.id===t.id&&r&&i&&("duplicateExistingView"===i.type||"createViewSource"===i.type||"createView"===i.type)?(0,C.jsx)(P.FormattedMessage,{defaultMessage:"New view",id:"collectionTabBar.newViewPlaceholder.title"}):(0,C.jsx)(PS.Z,{collectionViewName:l.name,collectionViewType:l.type})}const $S=220,QS=i.memo((function(e){const{collectionContextStore:t,showHoverActionsStore:o,isPlaceholderExternalCollectionStore:r,showOnlyCurrentView:n,onViewClick:s,disabled:l}=e,a=(0,i.useRef)(new fS.E({throttleMs:200})),c=(0,i.useRef)(new Map),d=(0,Y.O7)(),p=(0,J.Fg)(),h=(0,i.useRef)(null),m=(0,i.useRef)(null),S=(0,xa.$Z)(),g=(0,X.VK)((()=>o.state),[o]),f=(0,X.VK)((()=>t.permissionScopesStore.state),[t]);(0,i.useEffect)((()=>{const e=a.current;return()=>{e.destroy()}}),[a]);const v=(0,i.useCallback)((e=>{const t=e.getName(),o=e.getType();if(!o)return 0;let r=c.current.get(e.id);r||(r=new gS({style:{fontSize:`${j.Z.fontSize.UIRegular.desktop}px`,fontWeight:j.Z.fontWeight.medium}}),c.current.set(e.id,r));const i=(0,ae.Cc)({collectionViewName:t,collectionViewType:o}),n=r.measure(i);return Math.min(40+n.width,$S)}),[c]),y=(0,X.VK)((()=>{const e=n?[]:XS(t),o=t.collectionViewStore();if(!o)return;const i=Math.max(100,YS(t,r,n)?105:0);let s=a.current.rect.state.width-i;const l=[],c=v(o);if(!(c<s))return l;l.push(o),s-=c;for(const t of e)if(t.id!==o.id){const e=v(t);if(!(e<s))break;l.push(t),s-=e}const d=l.filter((e=>e.id!==o.id)),u=e.findIndex((e=>e.id===o.id));return d.splice(u,0,o),d}),[t,r,v,n]),x=(0,X.VK)((()=>{var e;const{device:o}=d,i=n?[]:XS(t),s=(null==y?void 0:y.length)||0,l=i.length-s,a=(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isCollectionViewPageWithContent())||o.isPhone||y&&(0===s||1===s&&i.length>1)||t.isInHomeWidgetStore.state?"dropdown":l>0?"someTabsNotVisible":"allTabsVisible",c=t.isFullScreenStore.state||g;return{showMoreViewsButton:"someTabsNotVisible"===a||"dropdown"===a,showAddViewButton:YS(t,r,n)&&"allTabsVisible"===a,addViewButtonAnimatedIn:c,viewSelectState:a,moreViewsCount:l}}),[t,d,r,g,n,y]),b=(0,i.useCallback)((e=>{e&&a.current.observe(e)}),[a]),w=(0,X.VK)((()=>{const e=t.collectionStore(),o=t.collectionViewBlockStore();if(!e||!o)return;const r=e.getFormat().app_config_uri,i=r?(0,Q.YB)((0,dd.appConfigs)(),r):void 0;return i?(0,Q.$L)({environment:d,appConfig:i,collectionStore:e,collectionViewBlockStore:o}):void 0}),[t,d]),k=(0,i.useCallback)((()=>{if(y&&"dropdown"!==x.viewSelectState)return f.canConfigureBlock?(0,C.jsx)(gs.ZP,{direction:"horizontal",keys:y.map((e=>e.id)),style:{height:"100%"},disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:e=>{const o=y.find((t=>t.id===e));if(o)return(0,C.jsx)(JS,{collectionContextStore:t,onViewClick:s,disabled:l,collectionViewStore:o,showOnlyCurrentView:n})},onDrop:e=>function(e,t,o){const r=o.collectionViewBlockStore();if(!r)return;q.createAndCommit({userAction:"CollectionViewTabBar.handleViewTabsDrop",environment:t,perform:t=>{le.Wu({collectionViewBlockStore:r,newViewIds:e,transaction:t})}})}(e,d,t)}):y.map((e=>(0,C.jsx)(JS,{collectionContextStore:t,onViewClick:s,disabled:l,collectionViewStore:e,showOnlyCurrentView:n},e.id)))}),[y,x.viewSelectState,f.canConfigureBlock,t,s,l,n,d]),T=(0,i.useCallback)((e=>{var o;const{device:r}=d,i=function(e){return e.collectionViewStore()}(t);if(!i)return;if(!i.isDefined())return;const n=(null===(o=t.collectionStore())||void 0===o?void 0:o.getFormat().app_config_uri)===u.GZ&&"page"===i.getType();if("dropdown"===x.viewSelectState){const o=i.getType(),s=i.getFormat().collection_view_icon,a=t.isInHomeWidgetStore.state,c=l||a;return(0,C.jsxs)(C.Fragment,{children:[!r.isMobile&&n&&"home"===Nc.B1()&&(0,C.jsx)(hS,{origin:h}),(0,C.jsx)(WS,{collectionViewStore:i,disableTooltip:a,render:r=>(0,C.jsxs)(Et.Z,{ref:h,style:{display:"flex",alignItems:"center",fontSize:c?j.Z.fontSize.UISmall.desktop:j.Z.fontSize.UIRegular.desktop,fontWeight:j.Z.fontWeight.semibold,color:c?p.mediumTextColor:p.regularTextColor,maxWidth:$S,paddingRight:c?0:void 0},disabled:l,...(0,hr.Z)(e,r),children:[(0,C.jsx)(CS.F,{color:c?"lightGray":"regular",viewType:o,viewIcon:s,style:{marginRight:c?8:6,marginLeft:c?0:5},size:c?14:void 0}),(0,C.jsx)("span",{style:{...j.Z.textOverflowStyle,marginRight:6,marginTop:1},children:(0,C.jsx)(qS,{collectionContextStore:t,collectionViewStore:i})}),!l&&(0,Zi.i)({marginTop:2,width:10,height:10,fill:p.lightIconColor,marginRight:6})]})})]})}return"someTabsNotVisible"===x.viewSelectState?(0,C.jsx)(Et.Z,{style:{display:"flex",alignItems:"center",fontSize:j.Z.fontSize.UIRegular.desktop,color:p.mediumTextColor},...e,children:(0,C.jsx)("span",{style:{marginTop:1},children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"{moreViewsCount} more…",id:"collectionTabBar.showMoreViews.title",values:{moreViewsCount:x.moreViewsCount}})})}):void 0}),[t,l,d,h,x,p]),_=(0,i.useCallback)(((e,o)=>{var r;const{device:i}=d,n=(null===(r=t.collectionStore())||void 0===r?void 0:r.getFormat().app_config_uri)===u.GZ;return(0,C.jsxs)(C.Fragment,{children:[!i.isMobile&&"views"===Nc.B1()&&n&&(0,C.jsx)(mS,{origin:m}),(0,C.jsx)("div",{ref:m,children:(0,C.jsx)(ES,{collectionContextStore:t,suggestedViews:o,onClose:e.close,onViewClick:s,onAddViewClick:e=>eg(e,d,t)})})]})}),[t,d,s]),V=(0,i.useCallback)((e=>{(0,ye.ZP)({event:e,context:ye.Af.EditorMouseDown,callback:()=>{e.preventDefault()}})}),[]);return(0,C.jsxs)("div",{role:"tablist",style:{display:"flex",alignItems:"center",height:"100%",flexGrow:1},ref:b,children:[k(),x.showMoreViewsButton&&(0,C.jsx)("div",{onMouseDown:V,children:(0,C.jsx)(Te.ZP,{popupType:d.device.isMobile?Ve.kQ.SlideUp:Ve.kQ.Popup,render:e=>_(e,w),renderOrigin:e=>T(e),onClick:()=>function(e,t){F.wd({environment:e,collectionContextStore:t,action:"click_views_dropdown"})}(d,t)})}),x.showAddViewButton&&(0,C.jsx)(pc.Z,{isVisible:!0,animationStyle:{opacity:x.addViewButtonAnimatedIn?1:0},render:()=>(0,C.jsx)("div",{onMouseDown:V,children:w&&w.length?(0,C.jsx)(Te.ZP,{popupType:Te.Z4.Popup,alignmentToOrigin:pS.v2.Center,render:e=>(0,C.jsx)(tg,{collectionContextStore:t,parent:e,suggestedViews:w}),renderOrigin:e=>(0,C.jsx)(_e.Z,{ariaLabel:"Add view",className:dt.rVO,icon:de.R,...e})},"suggested-views"):S?(0,C.jsx)(og,{environment:d,collectionContextStore:t}):(0,C.jsx)(_e.Z,{ariaLabel:"Add view",className:dt.rVO,icon:de.R,onClick:()=>eg("CollectionViewTabBar.handleAddViewClick",d,e.collectionContextStore)})})})]})}));function YS(e,t,o){var r;const i=e.permissionScopesStore.state,n=null===(r=e.collectionViewBlockStore())||void 0===r?void 0:r.id,s=n&&(0,ge.qG)(n);return!o&&i.canConfigureBlock&&!t.state&&!s}function XS(e){var t;return(null===(t=function(e){return e.collectionViewBlockStore()}(e))||void 0===t?void 0:t.getCollectionViewStores())||[]}function JS(e){let{collectionViewStore:t,collectionContextStore:o,onViewClick:r,disabled:i,showOnlyCurrentView:n}=e;return(0,C.jsx)(GS,{collectionContextStore:o,collectionViewStore:t,onViewClick:r,disabled:i,hideUnderline:n},t.id)}function eg(e,t,o){q.createAndCommit({userAction:e,environment:t,perform:e=>{le.ME({environment:t,collectionContextStore:o,transaction:e})}}),F.xb({environment:t,collectionContextStore:o,view_type:"table"})}function tg(e){let{parent:t,suggestedViews:o,collectionContextStore:r}=e;const i=(0,Y.O7)();return(0,C.jsx)(NS,{collectionContextStore:r,suggestedViews:o,onClose:t.close,onNewEmptyViewClick:e=>eg(e,i,r)})}function og(e){let{environment:t,collectionContextStore:o}=e;const r=(0,Y.O7)().device,i=(0,va.gp)({environment:t,collectionContextStore:o}),n=e=>(0,C.jsx)(je.Z,{topBorder:!0,children:(0,C.jsx)(uS.Z,{title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"New empty view",id:"database.collectionViewSuggestedViews.newEmptyViewTitle"}),onClick:()=>{eg("CollectionViewTabBar.handleAddViewClick",t,o),e.close()},focused:!1})});return(0,C.jsx)(Te.ZP,{popupType:Te.Z4.Popup,alignmentToOrigin:pS.v2.Center,render:e=>(0,C.jsx)(yp.Z,{capture:!0,allowEsc:!0,render:t=>{let o;return o=r.isMobile?{menuType:Oe.og.Modal,right:(0,C.jsx)(nr.DoneMenuText,{}),onClickRight:e.close,...t}:{menuType:Oe.og.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh",...t},(0,C.jsxs)(Pe.Z,{...o,children:[(0,C.jsx)(Re.Z,{type:Re.i.Vertical,initialFocus:void 0,sections:[{key:"results",render:e=>(0,C.jsx)(je.Z,{...e}),items:[i]}],onAccept:e.close}),n(e)]})}}),renderOrigin:e=>(0,C.jsx)(_e.Z,{ariaLabel:"Add new view",className:dt.rVO,icon:de.R,...e})},"new-form-view")}var rg=o(492650),ig=o(730459),ng=o(849117),sg=o(970764),lg=o(311335),ag=o(989796),cg=o(889014),dg=o(534987),ug=o(861931),pg=o(658421),hg=o(788632),mg=o(577144),Sg=o(121039),gg=o(141737),fg=o(661802),Cg=o(619671),vg=o(580123),yg=o(85844),xg=o(813023),bg=o(745589),wg=o(629026),kg=o(42239),Tg=o(502005);class _g extends c.default{getInitialState(){return{query:"",limit:20}}}const Vg=_g;var Og=o(511470);const Mg=(0,P.defineMessages)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"collectionNoDateMenu.searchPlaceholder"}}),Pg=c.default.createClass(void 0,{name:"ResultStore"});function Rg(e){let{collectionViewBlockStore:t,collectionViewType:o,property:r,collectionContextStore:n,onClose:s,onAddPage:l}=e;const a=(0,Y.O7)(),c=(0,Y.Fy)(),d=(0,X.qz)(void 0,Vg),u=(0,X.qz)(void 0,Pg),p=(0,X.VK)((()=>d.state.query),[d]),h=(0,X.VK)((()=>u.state),[u]),m=(0,X.VK)((()=>{const{query:e,limit:t}=d.state;return{type:"results",filter:{operator:"and",filters:[{property:r,filter:{operator:"is_empty"}}]},limit:t,searchQuery:e}}),[r,d]),S=(0,i.useCallback)((e=>{d.setState({query:e.target.value,limit:Fg})}),[d]),g=(0,i.useCallback)((e=>{const t=d.state.limit,o=n.isLoadingStore.state;e<Ig&&h&&h.hasMore&&!o&&d.setState({...d.state,limit:t+Fg})}),[n,h,d]),f=(0,i.useCallback)((()=>{let e;return e="calendar"===o?c.isMobile?(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Click to add date.",id:"collectionNoDateMenu.addResultToCalendar.prompt.basic"}):(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Click or drag to calendar to add date.",id:"collectionNoDateMenu.addResultToCalendar.prompt"}):(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Click to add to the timeline",id:"collectionNoDateMenu.addResultToTimeline.prompt"}),h?h&&0===h.blockIds.length?(0,C.jsx)(je.Z,{title:e,children:(0,C.jsx)(vs.Z,{title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"No results",id:"collectionNoDateMenu.noResults.title"})})}):(0,C.jsx)(Re.Z,{type:Re.i.Vertical,sections:[{key:"results",render:t=>(0,C.jsx)(je.Z,{...t,title:e}),items:Eg(h.blockIds,n,t,r,l,a,o)}],initialFocus:p?0:void 0}):(0,C.jsx)(je.Z,{children:(0,C.jsx)(Bg,{})})}),[t,o,h,n,r,l,a,p,c.isMobile]);return(0,C.jsxs)(Tg.Tp,{title:void 0,onCancel:s,desktopWidth:320,children:[(0,C.jsx)(je.Z,{isInput:!0,children:(0,C.jsx)(Cs.ZP,{placeholder:We.default.formatMessage(Mg.searchPlaceholder),focus:!c.isMobile||void 0,focusAfterAnimation:!0,value:p,onChange:S})}),(0,C.jsx)(bt.Z,{id:"no_date_results",reducer:m,collectionContextStore:n,render:f,resultStore:u}),(0,C.jsx)(Rt.Z,{onChange:g})]})}const jg=i.memo(Rg,pe.Z),Ig=200,Fg=20;function Ng(e){let{props:t,store:o,disabled:r,url:n,collectionViewType:s}=e;const l=(0,Y.O7)(),a=(0,Y.Fy)(),c=i.useRef(null),d=(0,C.jsx)(Og.Z,{...t,ref:c,store:o,hidePath:!0,disabled:r,right:void 0!==n?(0,C.jsx)(Et.Z,{isSmall:!0,href:n,disabled:r,onClick:()=>{I.tM(l)},children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Open",id:"collectionNoDateMenu.view.button.label"})},o.id):void 0,dontShrinkRight:!0});return"calendar"!==s||a.isMobile?d:(0,C.jsx)(St.Z,{canSelect:!1,canDrag:!r,canEditText:!1,store:o,shouldShowDropZone:!0,getGhostElement:()=>function(e){if(e.current){return[kg.eN(e.current)]}return[]}(c),analyticsName:"calendar_no_date_item",children:d})}function Bg(){return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(tn.Z,{style:{display:"flex",height:16,marginTop:4,marginLeft:12,marginRight:12,borderRadius:12,width:"50%"}}),(0,C.jsx)(tn.Z,{style:{display:"flex",height:16,marginTop:6,marginLeft:12,marginRight:12,marginBottom:6,borderRadius:12,width:"75%"}})]})}function Eg(e,t,o,r,i,n,s){const l=e.map((e=>Ye.G.createChildStore(o,{table:_.iU,id:e}))).filter((e=>!_a.Gl(e.getPropertyStore(r).getValue()))).map((e=>{const{mainEditorCurrentBlockStore:o}=uo.default.state;if(!o)return;const r=(0,ae.mb)({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1});return{key:e.id,render:t=>(0,C.jsx)(Ng,{props:t,store:e,disabled:!e.canEdit(),url:r,collectionViewType:s}),action:()=>{e.canEdit()&&(i(e),I.ze(n))}}}));return R.oA(l)}var Ag=o(965669),Lg=o(463087),Dg=o(937850),Zg=o(63811);class Hg{constructor(e,t){this.queuedCollectionEmit=void 0,this.queuedBlockIdsToRefetch=void 0,this.isServerRequestRequired=void 0,this.collectionContextStore=void 0,this.environment=void 0,this.isServerQueryCollectionRequired=(e,t)=>{const o=this.collectionContextStore.isClientModeEnabledStore.state;if(o&&t&&"collectionTypedView"===this.collectionContextStore.contextType)return!0;const r=Boolean(e&&(0,Zg.P9)(Lg.yd,e)&&e.hasMore);if(o&&!r)return!1;const i=this.collectionContextStore.remoteRequestStore.state;if(!i)return!0;return!!(0,he.qP)(i.loader.reducers||{}).some((e=>{let[t,o]=e;return"results"!==o.type}))||!(e&&(0,Zg.P9)(Lg.yd,e)&&!e.hasMore)},this.throttledRefetch=(0,Ag.Z)((e=>this.refetchFromRemote({...e,queuedTimestamp:Date.now()}))),this.processCollectionRefetch=async e=>{const t=this.queuedBlockIdsToRefetch,o=this.isServerRequestRequired;this.reset(),o&&this.throttledRefetch({src:e}),t&&await le.fI({environment:this.environment,collectionContextStore:this.collectionContextStore,blockIdToMinimumVersion:t})},this.refetchFromRemote=async e=>{var t;const o=this.collectionContextStore.isSlowModeEnabledStore.state,r="chart"===(null===(t=this.collectionContextStore.collectionViewStore())||void 0===t?void 0:t.getType());let i=1e3;o?i=$e.default.getConfigKey("query_collection_slow_mode","clientThrottleMs"):r&&(i=$e.default.getConfigKey("query_collection_chart_refetch_settings","clientThrottleMs")),await Promise.all([le.dj(this.environment,this.collectionContextStore,e),(0,Dg.Vs)(i)])},this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={},this.collectionContextStore=e,this.environment=t}reset(){this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={}}addBlockIdToRefetch(e,t){this.queuedBlockIdsToRefetch[e]=Math.max(this.queuedBlockIdsToRefetch[e]??0,t)}async handleCollectionEmit(e){const{src:t,passThroughData:o,shouldQueueCollectionEmit:r,isCollectionTypeChange:i}=e;if((0,Zg.P9)(Lg.yd,o)&&null!=o&&o.blockIdToVersion&&(0,he.qP)(o.blockIdToVersion).forEach((e=>{let[t,o]=e;return this.addBlockIdToRefetch(t,o)})),this.isServerRequestRequired=this.isServerRequestRequired||this.isServerQueryCollectionRequired(o,i),!r)return await this.processCollectionRefetch(t);this.queuedCollectionEmit=!0}async maybeProcessQueuedCollectionEmit(e){if(this.queuedCollectionEmit)return await this.processCollectionRefetch(e)}}var zg=o(167660),Kg=o(791007),Gg=o(670475),Wg=o(62967),Ug=o(743664);function qg(e){let{collectionContextStore:t,property:o,blockStores:r}=e;const i=t.normalizedFormatStore.state.collection_group_by;if((null==i?void 0:i.property)!==o)return;const n=function(e,t){const o=new Map,r=t.groupsStore.getAllGroupStates(),i=(0,R.jV)(e,st.default.state.stores);if(!i.length)return o;for(const n of i){const e=r.find((e=>e.groupUiParentStore===n.getRecordStoreUIParent()));e&&o.set(n,e.resultsStore)}return o}(r,t),s=[];for(const[l,a]of n.entries())a.state.includes(l)||s.push(l);s.length&&G.Af({stores:(0,R.e5)(st.default.state.stores,s)})}class $g extends c.default{getInitialState(){return{textStoresBeingEdited:[]}}getNumberOfTextStoresBeingEdited(){return this.state.textStoresBeingEdited.length}textStoresWithEmptyProperty(e){return this.state.textStoresBeingEdited.filter((t=>{const o=t.getPropertyValue(e);return""===me.QaF(o)}))}}const Qg=$g;var Yg=o(13966);function Xg(e){return{boxShadow:`1px 0 0 ${e.regularDividerColor}`,marginRight:1}}const Jg=(0,P.defineMessages)({delete:{id:"CollectionsBulkActionsToolbar.deleteButton.tooltip",defaultMessage:"Delete"}});function ef(e){const t=(0,jl.Y$)(),{marginLeft:o}=e,r=(0,Y.O7)(),n=(0,X.qz)(void 0,Qg),s=(0,i.useRef)(null),[l,a]=(0,i.useState)(!1),c=(0,X.VK)((()=>st.default.state.stores),[]),d=c.length,u=(0,X.VK)((()=>n.getNumberOfTextStoresBeingEdited()),[n]),p=(0,X.VK)((()=>c.every((e=>{var t;return null===(t=e.getAssociatedCollectionStore())||void 0===t?void 0:t.isExternallyImportedAndSyncedCollection()}))),[c]),h=(0,X.VK)((()=>{var e;return(!p||!(0,Wm.K6)())&&(!!(0,ae.fk)({environment:r,collectionContextStore:t})&&(u>0||c.length>=1&&(0,ae.v_)(c,null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id)))}),[t,r,u,c,p]),m=(0,i.useRef)(void 0);(0,X.VK)((()=>{const e=ge._H().state;e.isOpen?m.current=e.property:m.current&&qg({collectionContextStore:t,property:m.current,blockStores:c})}),[t,c],{debugName:"cleanUpSelection"});const S=(0,J.yK)((e=>({inner:{position:"absolute",top:1,left:0+(o??0),display:"inline-flex",justifyContent:"center",alignItems:"center",borderRadius:5,background:e.popoverBackground,boxShadow:e.lightBoxShadow,height:32},outer:{position:"sticky",top:0,left:0,zIndex:M.mJ,visibility:l?"visible":"hidden"},blockActionMenuButton:{width:30,height:"100%",borderRadius:void 0,borderTopRightRadius:5,borderBottomRightRadius:5},blockActionMenuButtonIcon:{fill:e.regularTextColor},trashButton:{borderRadius:0,height:"100%",border:0,...Xg(e),width:28},trashButtonIcon:{width:16},trashButtonIconHovered:{fill:e.accentColors.red[500]}})),[l,o]);return(0,C.jsx)(pc.Z,{isVisible:h,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},onAnimationEnd:e=>{e||a(!1)},render:()=>(0,C.jsx)(xs.Z,{capture:!0,render:e=>(0,C.jsx)("div",{ref:s,...e,style:S.outer,children:(0,C.jsx)(cc.p,{allowSelectionWithin:!1,children:(0,C.jsxs)("div",{style:S.inner,children:[(0,C.jsx)(tf,{selectedItemCount:d,collectionsBulkActionsToolbarStore:n}),(0,C.jsx)(cf,{collectionsBulkActionsToolbarStore:n,selectedItems:c,marginLeft:o,setIsReadyToRender:a,outerContainerRef:s}),(0,C.jsx)(Jt.Z,{renderTooltip:()=>(0,C.jsx)("div",{children:We.default.formatMessage(Jg.delete)}),render:e=>(0,C.jsx)(_e.Z,{...e,ariaLabel:We.default.formatMessage(Jg.delete),icon:()=>(0,or.y)(S.trashButtonIcon),style:S.trashButton,hoveredStyle:S.trashButtonIconHovered,hasBackground:!0,isDarkIconColor:!0,showShadow:!0,onClick:async()=>{var e;I.dh(r,{analyticsName:Wg.RE.deleteName.defaultMessage,from:"bulk_actions_toolbar",block_type:"page",collection_id:null===(e=t.collectionStore())||void 0===e?void 0:e.id}),await Gm.Qw({environment:r,blocks:c,shouldCheckSuggestEdit:!0})}}),placement:Sc.u.Top}),(0,C.jsx)(Yg.Z,{store:c[0],fadeIn:!1,style:S.blockActionMenuButton,hoveredStyle:S.blockActionMenuButton,iconStyle:S.blockActionMenuButtonIcon,extraAnalyticsData:{isFromBulkActionsToolbar:!0},isFromCollectionView:!0})]})})})})})}function tf(e){const{collectionsBulkActionsToolbarStore:t,selectedItemCount:o}=e,r=(0,Y.O7)(),i=(0,X.VK)((()=>t.getNumberOfTextStoresBeingEdited()),[t]),n=(0,X.VK)((()=>i>0?i:o),[i,o]),s=(0,J.yK)((e=>({button:{color:e.blueColor,fontSize:14,whiteSpace:"nowrap",height:"100%",alignItems:"center",display:"flex",paddingRight:10,paddingLeft:10,borderTopLeftRadius:5,borderBottomLeftRadius:5,fontVariantNumeric:"tabular-nums",...Xg(e)}})),[]);return(0,C.jsx)(xe.Z,{style:s.button,onClick:()=>G.ZH({debug:{userAction:"CollectionsBulkActionsToolbar.SelectedItemCountWidget"},environment:r}),children:(0,C.jsx)(P.FormattedMessage,{id:"SelectedItemCountWidget.numItemsSelected",defaultMessage:"{itemsSelectedCount} selected",values:{itemsSelectedCount:n}})})}const of=6,rf=450,nf=2,sf=32,lf=150,af=["title","rollup","formula","button"];function cf(e){const{outerContainerRef:t,collectionsBulkActionsToolbarStore:o,selectedItems:r,marginLeft:n,setIsReadyToRender:s}=e,l=(0,jl.Y$)(),a=(0,X.VK)((()=>l.normalizedSchemaStore.state),[l]),c=(0,i.useRef)(null),d=(0,X.VK)((()=>l.databaseType===u.Fi&&r.some((e=>e.getPropertyValue(Gg.C.MeetingNoteToCalendarEventRelation)))),[l,r]),p=(0,X.VK)((()=>{var e;const t=l.normalizedFormatStore.state;return(null==t||null===(e=t.table_properties)||void 0===e?void 0:e.filter((e=>{const t=l.collectionStore();if((0,_a.LC)(null==t?void 0:t.getModel(),e.property))return!d;const o=a[e.property];return e.visible&&o&&!af.includes(o.type)&&(0,It.Sb)({propertySchema:o,property:e.property,blockStores:r,collectionSchema:a})})))??[]}),[l,a,r,d]).slice(0,of),h=(0,i.useRef)([]),[m,S]=(0,i.useState)(of),[g,f]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{h.current.length>0&&h.current.forEach((e=>{var t;e&&(e.rightEdge=(null===(t=e.element)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect().right)??0)}))}),[h]),function(e){let{outerContainerRef:t,propertyButtonsContainerRef:o,propertyButtonRefs:r,marginLeft:n,setIsReadyToRender:s,setShowIconsOnly:l,setHiddenButtonsIndex:a}=e;(0,i.useEffect)((()=>{const e=R.Ds((()=>{var e,i,c;const d=(null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect().right)??window.innerWidth,u=((null===(i=t.current)||void 0===i?void 0:i.getBoundingClientRect().width)??window.innerWidth)-(n??0),p=(null===(c=o.current)||void 0===c?void 0:c.getBoundingClientRect().left)??0,h=d-lf;let m=r.current.findIndex((e=>e.rightEdge>h));m=-1!==m?m:of;let S=r.current.findIndex(((e,t)=>p+t*sf>h));S=-1!==S?S:of;const g=m<nf||u<=rf;l(g),a(g?S:m),s(!0)}),150,{maxWait:150,leading:!0,trailing:!1});if(t.current){const o=new ResizeObserver((t=>{e()}));return e(),o.observe(t.current),()=>{o.disconnect()}}}),[n,t,r,o,a,s,l])}({propertyButtonsContainerRef:c,propertyButtonRefs:h,outerContainerRef:t,marginLeft:n,setIsReadyToRender:s,setHiddenButtonsIndex:S,setShowIconsOnly:f}),(0,C.jsx)("div",{ref:c,style:{display:"flex"},children:p.map(((e,t)=>{var r;let n=null===(r=h.current[t])||void 0===r?void 0:r.element;if(!n){const e=i.createRef();h.current[t]={element:e,rightEdge:0},n=e}const s=t>=m;return(0,C.jsx)("div",{ref:n,children:(0,C.jsx)(df,{collectionsBulkActionsToolbarStore:o,schema:a,property:e.property,isHidden:s,showIconsOnly:g},e.property)},e.property)}))})}function df(e){const{property:t,schema:o,collectionsBulkActionsToolbarStore:r,isHidden:n,showIconsOnly:s}=e,l=(0,jl.Y$)(),a=o[t],c=(0,Y.O7)(),d=(0,X.VK)((()=>!(l.permissionScopesStore.state.canEditContent||"collectionTypedView"===l.contextType)),[l]),u=(0,J.yK)((e=>({button:{display:n?"none":"flex",padding:8,...Xg(e)}})),[n]),p=(0,i.useRef)(null),h=(0,X.qz)(void 0,no.Z),m=(0,i.useCallback)((async e=>{var o,i;if(!p.current)return;const n=st.default.state.stores;e.stopPropagation(),e.preventDefault();const s=null===(o=p.current)||void 0===o?void 0:o.getBoundingClientRect(),a=n[0].getAssociatedCollectionStore();l&&s&&a&&await Ug.z({environment:c,store:n[0],additionalStores:n.slice(1),property:t,rect:s,format:mt.C.Table,collectionStore:a,blockPropertyValueOverlayStore:ge._H(),collectionContextStore:l,statusSetCheckbox:"checkbox"===(null===(i=l.getPropertyFormat(t))||void 0===i?void 0:i.statusShowAs),mouseStore:h,preventClearSelection:!0,collectionsBulkActionsToolbarStore:r})}),[p,l,c,t,h,r]),S=(0,J.Fg)();return a?(0,C.jsx)(Jt.Z,{renderTooltip:()=>a.name,render:e=>(0,C.jsx)(xe.Z,{...e,ariaLabel:a.name,ref:p,style:u.button,disabled:d,onClick:m,children:(0,C.jsx)(Kc.Z,{style:{maxWidth:"250px",textOverflow:"ellipsis"},propertySchema:a,hideName:s,showIcon:!0,property:t,iconStyle:{fill:S.regularTextColor}})}),disableTooltip:!s,placement:Sc.u.Top}):null}var uf=o(310214),pf=o(830806),hf=o(305933),mf=o(685740),Sf=o(132662);const gf="noWritableDbs";function ff(e){const{collectionContextStore:t}=e,o=(0,Y.O7)(),r=(0,X.VK)((()=>t.isInHomeWidgetStore.state),[t]),n=(0,X.VK)((()=>t.collectionStoresStore.state.length>0),[t.collectionStoresStore]),s=(0,X.VK)((()=>{const e=t.collectionStoresStore.state;return Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())))}),[t.collectionStoresStore]),l=(0,X.VK)((()=>(0,ae.PI)(t)),[t]),a=(0,X.VK)((()=>!t.isFullScreenStore.state),[t]),c=(0,J.yK)((e=>({container:{width:"100%",height:a?"calc(100% - 4px)":void 0,paddingTop:a?32:120,paddingBottom:32,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",fontSize:14,color:e.lightTextColor},desktopInner:{width:800,minWidth:800,padding:32},icon:(0,ug.jO)(e)})),[a]),d=(0,i.useCallback)((()=>n?(0,C.jsx)(Jt.Z,{disableTooltip:s,placement:Sc.u.Bottom,renderTooltip:()=>(0,C.jsx)(P.FormattedMessage,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"tasksEmptyState.addTask.tooltip.noWritableDbs",values:{br:(0,C.jsx)("br",{})}}),render:t=>(0,C.jsx)(mf.Z,{...t,isBlue:!0,disabled:!s,disabledFeedback:!s,onClick:t=>{(0,pf.Aq)({environment:o,from:e.from}),e.onAddTaskClick(t)},icon:e=>(0,de.R)(e),children:l})}):(0,C.jsx)(mf.Z,{isBlue:!0,onClick:()=>{(0,pf.Aq)({environment:o,from:e.from}),hf.Z.setState(!0)},children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Don't see your tasks?",id:"tasksEmptyState.noDatabases.title"})})),[n,s,l,o,e]);return r&&!n?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(ro.dK,{from:e.from}),(0,C.jsx)(dg.Qi,{feature:"tasks",onSetup:()=>{(0,pf.Aq)({environment:o,from:e.from}),hf.Z.setState(!0)}})]}):(0,C.jsxs)("div",{style:c.container,children:[(0,C.jsx)(ro.dK,{from:e.from}),(0,uf.K)(c.icon),(0,C.jsx)(Sf.Z,{size:16}),s?(0,C.jsx)(P.FormattedMessage,{defaultMessage:"No matching tasks.",id:"tasksEmptyState.noMatchingTasks.title"}):(0,C.jsx)(P.FormattedMessage,{defaultMessage:"See all tasks assigned to you here.",id:"tasksEmptyState.noTasks.title"}),(0,C.jsx)(Sf.Z,{size:16}),d()]})}var Cf=o(491496),vf=o(374194),yf=o(14562);const xf=(0,f.IU)("blueArrowCircle",{viewBox:"0 0 42 42",svg:(0,C.jsx)("path",{d:"M3.90625 18.75L7.64062 13.5C7.93229 13.1042 8.26562 12.9115 8.64062 12.9219C9.02604 12.9219 9.35938 13.1146 9.64062 13.5L13.3594 18.7656C13.7135 19.2344 13.8125 19.6562 13.6562 20.0312C13.5 20.4062 13.125 20.5938 12.5312 20.5938H10.1875C10.3958 22.1562 10.8698 23.6094 11.6094 24.9531C12.3594 26.2969 13.3021 27.474 14.4375 28.4844C15.5833 29.4948 16.8854 30.276 18.3438 30.8281C19.8021 31.3906 21.3542 31.6719 23 31.6719C24.875 31.6719 26.625 31.3021 28.25 30.5625C29.8854 29.8229 31.2812 28.8177 32.4375 27.5469C32.8125 27.1823 33.2083 26.9948 33.625 26.9844C34.0521 26.9635 34.4219 27.099 34.7344 27.3906C35.0469 27.6719 35.2031 28.0365 35.2031 28.4844C35.2135 28.9219 35.0312 29.3281 34.6562 29.7031C33.2188 31.276 31.4896 32.526 29.4688 33.4531C27.4583 34.3906 25.3021 34.8594 23 34.8594C20.9271 34.8594 18.974 34.4948 17.1406 33.7656C15.3073 33.0365 13.6667 32.0156 12.2188 30.7031C10.7708 29.401 9.58854 27.8854 8.67188 26.1562C7.75521 24.4271 7.18229 22.5729 6.95312 20.5938H4.73438C4.13021 20.5938 3.75521 20.4062 3.60938 20.0312C3.46354 19.6562 3.5625 19.2292 3.90625 18.75ZM11.3438 7.73438C12.7812 6.17188 14.5052 4.92188 16.5156 3.98438C18.5365 3.04688 20.6979 2.57812 23 2.57812C25.0521 2.57812 26.9948 2.94792 28.8281 3.6875C30.6719 4.41667 32.3177 5.4375 33.7656 6.75C35.2135 8.05208 36.3958 9.56771 37.3125 11.2969C38.2292 13.026 38.8073 14.8802 39.0469 16.8594H41.2188C41.8229 16.8594 42.1979 17.0469 42.3438 17.4219C42.5 17.7969 42.4062 18.224 42.0625 18.7031L38.3438 23.9531C38.0521 24.349 37.7135 24.5469 37.3281 24.5469C36.9531 24.5365 36.625 24.3385 36.3438 23.9531L32.6094 18.7031C32.2656 18.224 32.1667 17.7969 32.3125 17.4219C32.4688 17.0469 32.8438 16.8594 33.4375 16.8594H35.8125C35.5833 15.2969 35.099 13.849 34.3594 12.5156C33.6302 11.1719 32.6927 9.99479 31.5469 8.98438C30.4115 7.97396 29.1146 7.1875 27.6562 6.625C26.1979 6.05208 24.6458 5.76562 23 5.76562C21.1354 5.76562 19.3854 6.14062 17.75 6.89062C16.125 7.63021 14.7292 8.63021 13.5625 9.89062C13.1875 10.2552 12.7865 10.4427 12.3594 10.4531C11.9427 10.4635 11.5781 10.3229 11.2656 10.0312C10.9427 9.75 10.776 9.39062 10.7656 8.95312C10.7656 8.51562 10.9583 8.10938 11.3438 7.73438Z",fill:"#2383E2"})});function bf(e){const{projectCount:t,taskCount:o,paddingLeft:r,paddingRight:i}=e,n=(0,J.yK)((e=>({backgroundForOverlay:{backgroundColor:e.white,zIndex:M.Nm,paddingLeft:r,paddingRight:i},overlay:{display:"flex",flexDirection:"column",alignItems:"center",borderRadius:8,gap:10,backgroundColor:e.accentColors.uiBlue[100],paddingTop:8,paddingBottom:8},iconContainer:{display:"flex",flexDirection:"column",alignItems:"center",color:e.blueColor,fontSize:j.Z.fontSize.UIRegular.desktop},arrowCircleIconStyles:{width:45,height:45,position:"relative",color:e.blueColor},overlayMessageContainer:{display:"flex",flexDirection:"column",alignItems:"center"},overlayMessageTitle:{fontSize:j.Z.fontSize.UIRegular.mobile,fontWeight:j.Z.fontWeight.semibold,lineHeight:j.Z.lineHeight.UIRegular.mobile},overlayMessageCaption:{fontSize:j.Z.fontSize.UIRegular.desktop,fontWeight:j.Z.fontWeight.regular,lineHeight:j.Z.lineHeight.UIRegular.desktop}})),[r,i]);return(0,C.jsx)("div",{style:n.backgroundForOverlay,children:(0,C.jsx)("div",{style:n.overlay,children:(0,C.jsxs)("div",{style:n.iconContainer,children:[(0,C.jsx)("div",{children:xf(n.arrowCircleIconStyles)}),(0,C.jsxs)("div",{style:n.overlayMessageContainer,children:[(0,C.jsx)("div",{style:n.overlayMessageTitle,children:(0,C.jsx)(P.FormattedMessage,{id:"collectionViewBlock.overlayComponents.jiraOverlayMessageTitle",defaultMessage:"Syncing {projectCount} projects and {taskCount} issues from Jira",values:{projectCount:t,taskCount:o}})}),(0,C.jsx)("div",{style:n.overlayMessageCaption,children:(0,C.jsx)(P.FormattedMessage,{id:"collectionViewBlock.overlayComponents.jiraOverlayMessageCaption",defaultMessage:"You’ll be notified when the sync is complete"})})]})]})})})}var wf=o(458493),kf=o(531192),Tf=o(295691),_f=o(709942),Vf=o(277744),Of=o(419977),Mf=o(282136),Pf=o(215201),Rf=o(472711),jf=o(457819),If=o(316772),Ff=o(955217);function Nf(e){const{store:t,disabled:o,paddingLeft:r,paddingRight:n,setRef:s}=e,l=(0,Y.O7)(),a=(0,X.VK)((()=>{const e=t.getFormat();return{pageFont:e.page_font,pageSmallText:e.page_small_text}}),[t]),c=(0,X.VK)((()=>(0,vm.CX)(t)),[t]),d=(0,ka.Nr)(t),u=(0,X.VK)((()=>(0,vm.a_)(t)||(0,vm.Wt)(t)),[t]),p=(0,X.VK)((()=>t.isNonEditableState()),[t]),{safePaddingLeft:h,safePaddingRight:m}=(0,X.VK)((()=>({safePaddingLeft:l.WindowSizeStore.getSafePaddingLeftCSS(r),safePaddingRight:l.WindowSizeStore.getSafePaddingRightCSS(n)})),[l.WindowSizeStore,r,n]),S=(0,X.VK)((()=>Boolean((0,jf.RR)(If.default.state))),[]),g=(0,X.VK)((()=>t.getContentStore()),[t]),f=(0,X.VK)((()=>(0,kf.ww)(l.device)),[l.device]),v=c?e=>Rf.og(e,t,l):void 0;function y(e,t){return(0,C.jsxs)("div",{style:e,ref:e=>{e&&s(e)},className:dt.QS0,onClick:t,children:[!u&&(0,C.jsx)(Ff.Z,{store:g,emptyDroppableStyle:{width:"100%"},disabled:o||p}),d&&(0,C.jsx)(be.Z,{})]})}const x=(0,i.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{device:t}=l,o=a.pageFont||kf.rk,r=kf.sL[o];let i;if(t.isMobile)i=t.isAndroid?kf.pE:kf.tb;else{i=a.pageSmallText?kf.Pc[o]||kf.ZY:kf.TE[o]||kf.jo}let n={},s={},d={};n={gridTemplateColumns:`${h} calc(100% - ${h} - ${m}) ${m}`},s=S?{paddingBottom:"600px"}:c?{paddingBottom:"15vh"}:{paddingBottom:0},d={...s,paddingLeft:e?0:h,paddingRight:e?0:m};const u=kf.VN[o],p=kf.n5[o]||1.5;return{wrapper:{flexShrink:0,flexGrow:1,display:"grid",gridTemplateColumns:"100%",maxWidth:"100%",width:"100%",...n},leftPadding:{},body:{display:"flex",alignItems:"flexstart",flexDirection:"column",fontFamily:r,fontSize:i,letterSpacing:u?`${u}em`:void 0,lineHeight:p,zIndex:M.ke,...s},rightPadding:{},nonIOSLayoutBody:{flexShrink:0,flexGrow:1,maxWidth:"100%",display:"flex",alignItems:"flexstart",flexDirection:"column",fontFamily:r,fontSize:i,letterSpacing:u?`${u}em`:void 0,lineHeight:p,width:"100%",zIndex:M.ke,...d}}}),[l,a.pageFont,a.pageSmallText,S,c,h,m]),b=x();return f?(0,C.jsxs)("div",{style:b.wrapper,children:[b.leftPadding&&(0,C.jsx)(cc.p,{allowSelectionWithin:!1,style:b.leftPadding,onClick:v}),y(b.body,v),b.rightPadding&&(0,C.jsx)(cc.p,{allowSelectionWithin:!1,style:b.rightPadding,onClick:v})]}):y(b.nonIOSLayoutBody,v)}const Bf=i.memo(Nf,pe.Z);function Ef(e){const{store:t,style:o,canEdit:r,padding:n}=e,s=(0,Y.O7)(),l=(0,i.useRef)(null),a=(0,X.VK)((()=>t.isNonEditableState()),[t]),c=(0,X.VK)((()=>rg.fg(s,t)),[t,s]),d=(0,ka.n1)(),u=(0,i.useMemo)((()=>({width:(0,vm.du)(t,Mf.S.CollectionPageView,s)})),[t,s]);return(0,C.jsx)(Pf.O,{displayName:"PageContent",style:o,disabled:!r||a,children:(0,C.jsxs)("div",{style:{display:"flex",width:"100%",justifyContent:"center",paddingTop:5,paddingBottom:d},children:[(0,C.jsx)(pc.Z,{isVisible:!0,animationStyle:u,render:()=>(0,C.jsx)("div",{style:{maxWidth:"100%",minWidth:0},children:(0,C.jsx)(Bf,{...e,...n,setRef:e=>{(0,Vf.k$)(l,e)}})})}),!s.device.isMobile&&c&&(0,C.jsx)(Of.Z,{pageBlockStore:t,isVisible:c,context:Mf.S.CollectionPageView,pageViewBlockAccessor:()=>l.current})]})})}var Af=o(702688);class Lf{constructor(e,t,o){this.listener=void 0,this.didEmit=void 0,this.lastValue=void 0,this.handleEmit=(e,t,o)=>{let r=!0;this.didEmit||(this.didEmit=!0,r=!1),this.lastValue===t?r=!1:this.lastValue=t,r&&this.onEmit(t,o)},this.environment=e,this.listenerEventKey=t,this.onEmit=o,this.didEmit=!1,this.lastValue=void 0}subscribe(){this.listener=Af.ZP.addListener(this.listenerEventKey,this.handleEmit,void 0,this.environment)}unsubscribe(){this.listener&&Af.ZP.removeListener(this.listener,this.environment)}}var Df=o(732566),Zf=o(321862),Hf=o(629551);function zf(e){const{collectionContextStore:t}=e,o=(0,X.VK)((()=>{const e=t.collectionViewStore(),o=null==e?void 0:e.getParentBlockStore();return o&&o.pathIsDead()}),[t]),{parentBlockStore:r,isParentCollectionDead:i}=(0,X.VK)((()=>{const e=t.collectionStore(),o=null==e?void 0:e.getParentBlockStore(),r=o&&(null==o?void 0:o.pathIsDead());return{parentBlockStore:o,isParentCollectionDead:r}}),[t]);return r&&(!o&&i)?(0,C.jsx)(Kf,{parentBlockStore:r}):null}function Kf(e){let{parentBlockStore:t}=e;const o=(0,Y.O7)(),{isMobile:r}=(0,Y.Fy)(),n=r?Hf.Ht:Hf.gq,s=(0,J.yK)((e=>({layoutComponent:{color:e.text.secondary,background:e.accentColors.gray[30],padding:"16px 16px 16px 12px",borderRadius:4,fontSize:14},trashIcon:{width:24,height:24,flexShrink:0,marginRight:10,padding:2},viewCollectionButton:{fontWeight:j.Z.fontWeight.semibold},arrowIcon:{width:16,height:16,flexShrink:0,padding:2,marginLeft:4}})),[]),l=(0,i.useCallback)((()=>{(0,ig.K4)(o,"view_deleted_database_from_deleted_collection_view_banner"),Zf.r({environment:o,store:t,pageVisitSource:d.tY.LinkInPage})}),[o,t]);return(0,C.jsxs)(n,{style:s.layoutComponent,alignItems:"center",justifyContent:r?"":"space-between",children:[(0,C.jsxs)(Hf.gq,{alignItems:"center",children:[(0,or.y)(s.trashIcon),(0,C.jsx)(P.FormattedMessage,{id:"collectionViewBlock.deletedContainerBanner.collectionInTrash",defaultMessage:"The original database has been deleted and cannot be edited"})]}),(0,C.jsxs)(Et.Z,{style:s.viewCollectionButton,onClick:l,isLightGray:!0,children:[(0,C.jsx)(P.FormattedMessage,{id:"collectionViewBlock.deletedContainerBanner.collection.viewCollectionButton",defaultMessage:"View database"}),(0,Df.k)(s.arrowIcon)]})]})}const Gf=i.memo(zf);var Wf=o(888077);class Uf extends c.default{getInitialState(){return{stage:"NOT_TRACKING"}}}function qf(e){const{collectionContextStore:t,parentMountTime:o}=e,{handleInitialDatabaseRender:r,handleNavigationDatabaseRender:n,handleItemMount:s}=function(e,t){const o=(0,Y.O7)(),r=(0,X.qz)(void 0,Uf),n=(0,i.useRef)(0),s=(0,i.useRef)(t),a=(0,i.useCallback)((()=>{"NOT_TRACKING"===r.state.stage&&r.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"INITIAL"})}),[r]),c=(0,i.useCallback)((()=>{"NOT_TRACKING"===r.state.stage&&r.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"NAVIGATION"})}),[r]),d=(0,i.useCallback)((()=>{if("COUNTING_VISIBLE_ITEMS"===r.state.stage&&(n.current++,1===n.current)){const e=performance.now();l.default.afterNextFlush((()=>{"COUNTING_VISIBLE_ITEMS"===r.state.stage&&r.setState({stage:"SHOULD_TRACK",endTime:e,source:r.state.source})}))}}),[r]),u=(0,i.useCallback)((t=>{if("SHOULD_TRACK"===t.state.stage){var r,i;const l=Ke.Pp({environment:o,collectionContextStore:e,visibleItemsCount:n.current||0}),a=(0,ag.Z)(null===(r=e.collectionViewStore())||void 0===r?void 0:r.id),c=null===(i=o.prefetchCache)||void 0===i?void 0:i.getPrefetchAnalytic(a);if("INITIAL"===t.state.source)qe.default.measureFromAppStart({metricName:"initial_database_items_visible",endTime:t.state.endTime},{environment:o,data:l}),s.current&&(qe.default.measure({metricName:"collections.initial_mount_to_items_visible",startTime:s.current,endTime:t.state.endTime},{environment:o,data:l}),"hit-match"===(null==c?void 0:c.type)&&void 0!==c.finishedTimeMs&&c.finishedTimeMs>s.current&&qe.default.measure({metricName:"collections.initial_mount_waiting_for_api",startTime:s.current,endTime:c.finishedTimeMs},{environment:o,data:l}));else if("NAVIGATION"===t.state.source){const e={...l,wasm_sqlite_initialized:mg.Z.state.metricDataStore.state.wasm_sqlite_initialized,wasm_sqlite_storage:mg.Z.state.metricDataStore.state.wasm_sqlite_storage,...(0,vg.t)()};qe.default.measure("collections.navigation_items_visible",{environment:o,data:e})}else(0,he.P)(t.state.source);t.setState({stage:"COMPLETED"}),n.current=0}}),[e,o]);return(0,i.useEffect)((()=>(r.addListener(u),()=>{r.removeListener(u)})),[u,r]),{handleInitialDatabaseRender:a,handleNavigationDatabaseRender:c,handleItemMount:d}}(t,o);return t.databaseItemsVisibleTracker||(t.databaseItemsVisibleTracker={handleInitialDatabaseRender:r,handleNavigationDatabaseRender:n,handleItemMount:s}),null}var $f=o(153223);const Qf=180,Yf=480,Xf=(0,P.defineMessages)({searchLabel:{defaultMessage:"Search",id:"database.searchButton.tooltip"},searchInputPlaceholder:{defaultMessage:"Type to search...",id:"database.searchInputPlaceholder"},openAutomationsSettingsButtonTooltip:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.tooltip"},openAutomationsSettingsButtonAriaLabel:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.ariaLabel"},disableAutomationsSettingsButtonTooltip:{defaultMessage:"Can't add automations to databases in the trash",id:"database.collectionViewBlock.disableAutomationsSettingsButton.tooltip"},disableAutomationsSettingsButtonAriaLabel:{defaultMessage:"Can't add automations to databases in the trash",id:"database.collectionViewBlock.disableAutomationsSettingsButton.ariaLabel"},openFullscreenPageButtonTooltip:{defaultMessage:"Open as full page",id:"database.collectionViewBlock.openFullscreenPageButton.tooltip"},filterLabel:{defaultMessage:"Filter",id:"collectionViewBlock.action.filter.title"},sortLabel:{defaultMessage:"Sort",id:"collectionViewBlock.action.sort.title"}});class Jf extends io.Z{constructor(){var e;super(...arguments),e=this,this.isCollectionViewBlock=!0,this.collectionContextStore=new Ft.Z(this.environment),this.headerSizeObserver=new fS.E,this.settingsHeaderSizeObserver=new fS.E,this.horizontalScrollerEl=null,this.resizeObserver=void 0,this.timelineViewRef=i.createRef(),this.automationsViewRef=i.createRef(),this.parentNode=void 0,this.renderStartTime=void 0,this.subscriptions=new Map,this.collectionTypeChangeSubscription=void 0,this.collectionRefetcher=new Hg(this.collectionContextStore,this.environment),this.syncStateTimeout=void 0,this.switchViewMetric=void 0,this.storeTypes={collectionContextStore:Ft.Z,mouseStore:no.Z,headerMouseStore:no.Z,verticalScrollerStore:bg.Z,focusStore:c.default.createClass(!1,{name:"focusStore"}),noDateResultStore:c.default.createClass(void 0,{name:"noDateResultStore"}),tasksResultStore:c.default.createClass(void 0,{name:"tasksResultStore"}),customDbResultStore:c.default.createClass(void 0,{name:"customDbResultStore"}),templateButtonPopupStore:ss.Z,filterBarSettingsStore:c.default.createClass({open:!1,stack:[]},{name:"filterBarSettingsStore"}),createFilterButtonPopupStore:ss.Z,createFilterSettingsStore:c.default.createClass({open:!1,stack:[]},{name:"createFilterSettingsStore"}),filterBarCreateFilterSettingsStore:c.default.createClass({open:!1,stack:[]},{name:"filterBarCreateFilterSettingsStore"}),createSortSettingsStore:c.default.createClass({open:!1,stack:[]},{name:"createSortSettingsStore"}),viewSettingsPlacementStore:c.default.createClass(void 0,{name:"viewSettingsPlacementStore"}),saveControlMoreActionsButtonPopupStore:ss.Z},this.handleSprintSettingsContextStoreChange=e=>{W.Wu({environment:this.environment,sprintSettingsContext:e.state})},this.renderCreateFilterPopup=()=>{const{collectionContextStore:e}=this,{createFilterSettingsStore:t}=this.stores;return(0,C.jsx)(Xa.PJ,{context:Xm.HV.TopbarFilterPopup,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.renderCreateSortPopup=()=>{const{collectionContextStore:e}=this,{createSortSettingsStore:t}=this.stores;return(0,C.jsx)(Xa.PJ,{context:Xm.HV.TopbarSortPopup,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.renderViewSettings=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=e.isInPeekRenderer(),r=(0,ae.Ks)(e.props.store)?{paddingLeft:0,paddingRight:0}:e.leftRightPaddingStore.state,i="form_editor"===e.getCurrentViewType(),n=t.placementToOrigin??i?eS.Iw.Right:void 0,s=t.alignmentToOrigin??e.collectionContextStore.isInHomeWidgetStore.state?eS.lU.End:void 0,l=i?24:void 0;if(r)return $e.default.checkGate({gateName:"collection_view_settings_popup_functional"})?(0,C.jsx)(rS,{collectionContextStore:e.collectionContextStore,headerSizeObserver:e.headerSizeObserver,settingsHeaderSizeObserver:e.settingsHeaderSizeObserver,headerHeightStore:e.headerHeightStore,placementStore:e.stores.viewSettingsPlacementStore,marginTop:e.collectionContextStore.isInlineViewStore.state&&e.collectionContextStore.isUnlistedViewStore.state?-10:void 0,placementToOrigin:n,alignmentToOrigin:s,originGap:l,...r}):(0,C.jsx)(lS,{collectionContextStore:e.collectionContextStore,headerSizeObserver:e.headerSizeObserver,settingsHeaderSizeObserver:e.settingsHeaderSizeObserver,headerHeightStore:e.headerHeightStore,placementStore:e.stores.viewSettingsPlacementStore,isInPeekRenderer:o,marginTop:e.collectionContextStore.isInlineViewStore.state&&e.collectionContextStore.isUnlistedViewStore.state?-10:void 0,placementToOrigin:n,alignmentToOrigin:s,originGap:l,...r})},this.renderTemplatesPopup=()=>{const{collectionContextStore:e}=this,{store:t}=this.props,o=e.collectionStore();if(o){if(hg.Z.state.online){const r=e.permissionScopesStore.state;return(0,C.jsx)(Cf.Z,{isOverlay:!0,collectionStore:o,canConfigureCollection:r.canConfigureCollection,onEmptyPageClick:this.handleTemplateEmptyPageClick,onEmptyEnter:this.handleTemplateEmptyPageClick,onTemplateClick:this.handleTemplateClick,onCancelClick:this.handleTemplateCancelClick,locked:t.isNonEditableState()})}return(0,C.jsx)("div",{style:{fontSize:14,color:this.theme.mediumTextColor,width:280,padding:8},children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Please go online to use a template.",id:"collectionViewBlock.actionBar.offlineTemplatePicker.message"})})}},this.renderNoDatePopup=e=>{const{collectionContextStore:t}=this,o=t.collectionViewBlockStore(),r=t.collectionViewStore(),i=this.getNoDateProperty();if(!o||!r||!i)return;const n=this.getCurrentViewType();return!r.isDefined()||"timeline"!==n&&"calendar"!==n?void 0:(0,C.jsx)(jg,{collectionViewBlockStore:o,property:i,onClose:e.close,onAddPage:this.handleNoDateAddPage,collectionViewType:n,collectionContextStore:t})},this.handleRelativeVariableStaleStoreChange=async e=>{if(e.state){const e=this.collectionContextStore,t=e.collectionViewBlockStore(),o=e.collectionViewStore(),r=e.collectionStore();if(!t||!o||!r)return;await le.dj(this.environment,e,{src:"relative_variables_stale",queuedTimestamp:Date.now()})}},this.handleViewAutomationSettingsClick=e=>{(0,ye.ZP)({event:e,context:ye.Af.CollectionAutomationSettingsClick,callback:this.handleViewAutomationSettingsClickInner})},this.handleViewAutomationSettingsClickInner=()=>{const{collectionContextStore:e}=this,t=e.settingsStore,o=t.state.open,r=(0,pg.n)(t);o&&"automationSettings"===(null==r?void 0:r.type)?A.E3({collectionSettingsStore:t}):(A.r$({collectionContextStore:e,collectionSettingsStore:t}),A.wl({collectionSettingsStore:t,item:{source:"collection_thunderbolt_icon",type:"automationSettings"}}))},this.handleViewClick=e=>{let{currentCollectionViewStore:t,newCollectionViewStore:o,openInNew:r}=e;if(t.id!==o.id&&!r){const e=t.getType(),r=o.getType();var i;if(e&&r)this.switchViewMetric={from:e,to:r,metric:qe.default.mark("collections.switch_view_lag"),sizeHintAtStart:null===(i=this.collectionContextStore.remoteResultStore.state)||void 0===i?void 0:i.sizeHint},"form_editor"===e&&this.collectionContextStore.isClientModeEnabledStore.setState(!1)}},this.handleFilterClick=()=>{var e;const{collectionContextStore:t}=this,{createFilterSettingsStore:o}=this.stores,r=null===(e=this.getCurrentCollectionViewStore())||void 0===e?void 0:e.id,i=t.permissionScopesStore.state.canConfigureBlock?t.currentCombinatorFilterStore.state:void 0,n=t.currentPropertyFiltersStore.state,s=t.filtersBarOpenStore.state;r&&!this.environment.device.isPhone&&(le.E7({userId:this.environment.currentUser.id,collectionViewId:r,isOpen:!s}),t.filtersBarOpenStore.setState(s));const l=t.isUnlistedViewStore.state&&t.isInlineViewStore.state;this.isInHomeWidgetStore.state||l?s||n.length>0||i?A.wl({collectionSettingsStore:t.settingsStore,item:{type:"filters"}}):(A.wl({collectionSettingsStore:t.settingsStore,item:{type:"createFilter"}}),B._7(t)):s||n.length>0||i?t.filtersBarOpenStore.setState(!s):(A.wl({collectionSettingsStore:o,item:{type:"createFilter"}}),B._7(t)),F.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_filter"})},this.handleSortClick=()=>{const{collectionContextStore:e}=this,{createSortSettingsStore:t}=this.stores,o=e.permissionScopesStore.state.canConfigureBlock?e.currentCombinatorFilterStore.state:void 0,r=e.currentPropertyFiltersStore.state,i=e.filtersBarOpenStore.state,n=this.hasSortStore.state,s=n||i||r.length>0||o;this.isInHomeWidgetStore.state&&A.wl({collectionSettingsStore:e.settingsStore,item:{type:n?"sort":"createSort"}}),s?this.isInHomeWidgetStore.state||(e.filtersBarOpenStore.setState(!i),n?A.wl({collectionSettingsStore:e.filterBarSortSettingsStore,item:{type:"sort"}}):A.wl({collectionSettingsStore:t,item:{type:"createSort"}})):this.isInHomeWidgetStore.state||A.wl({collectionSettingsStore:t,item:{type:"createSort"}}),F.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_sort"})},this.handleCreateFilterPopupDismiss=()=>{const{createFilterSettingsStore:e}=this.stores;A.E3({collectionSettingsStore:e})},this.handleCreateSortPopupDismiss=()=>{const{createSortSettingsStore:e}=this.stores;A.E3({collectionSettingsStore:e})},this.handleCollectionEmit=(e,t)=>{this.collectionRefetcher.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:this.shouldQueueCollectionEmit(),isCollectionTypeChange:!1})},this.handleCollectionTypeChangeEmit=(e,t)=>{this.collectionRefetcher.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:this.shouldQueueCollectionEmit(),isCollectionTypeChange:!0})},this.handlePageVisibilityChange=()=>{this.shouldRefetch()&&this.collectionRefetcher.maybeProcessQueuedCollectionEmit("page_show")},this.handlePeekViewChange=()=>{this.shouldRefetch()&&this.collectionRefetcher.maybeProcessQueuedCollectionEmit("exit_peek")},this.shouldQueueCollectionEmit=()=>{var e;return!yg.Z.state.isVisible||!(!Qe.default.isCenterPeekOpen()||null!==(e=Qe.default.peekTargetStore.state)&&void 0!==e&&e.uiContains(this.props.store))},this.shouldRefetch=()=>{if(!Qe.default.isCenterPeekOpen()&&yg.Z.state.isVisible)return!0},this.handleHeaderMount=e=>{e&&this.headerSizeObserver.observe(e)},this.handleSettingsHeaderMount=e=>{e&&this.settingsHeaderSizeObserver.observe(e)},this.handleHorizontalScrollerMount=e=>{var t,o;var r;(null==e||null===(t=e.scrollerEl())||void 0===t?void 0:t.classList.contains(dt.PBs))?this.horizontalScrollerEl=e:this.horizontalScrollerEl=(null==e||null===(r=e.context.scrollerContext)||void 0===r?void 0:r.horizontalScroller)||null;const i=this.collectionContextStore.collectionViewStore();this.resetFrozoneStore(i);const n=null===(o=this.horizontalScrollerEl)||void 0===o?void 0:o.scrollerEl();"undefined"!=typeof ResizeObserver&&n&&(this.resizeObserver=new ResizeObserver(this.handleHorizontalScrollerResizeDebounced),this.resizeObserver.observe(n))},this.handleHorizontalScrollerResize=()=>{var e,t;const o=null===(e=this.horizontalScrollerEl)||void 0===e||null===(e=e.scrollerEl())||void 0===e?void 0:e.getBoundingClientRect().width,r=this.collectionContextStore.frozoneStore.state.scrollerWidth,i=null===(t=this.horizontalScrollerEl)||void 0===t||null===(t=t.scrollerEl())||void 0===t?void 0:t.getBoundingClientRect().left,n=this.collectionContextStore.frozoneStore.state.scrollerLeftOffset;if(o===r&&i===n)return;if(this.isInHomeWidgetStore.state)return;const s=this.collectionContextStore.collectionViewStore(),l=this.collectionContextStore.normalizedFormatStore.state;this.collectionContextStore.frozoneStore.setState({...this.collectionContextStore.frozoneStore.state,scrollerWidth:o,scrollerLeftOffset:i,scrollerLeftPadding:this.scrollerLeftPaddingStore.state,frozenIndex:null==s?void 0:s.getTableFrozenColumnIndex(o,l),tryShowHiddenFrozenColumn:!1})},this.handleHorizontalScrollerResizeDebounced=R.Ds(this.handleHorizontalScrollerResize,50),this.handleEditorMouseDown=e=>{const{device:t}=this.environment,{target:o}=e;if(!this.getCurrentCollectionViewStore()||t.isMobile||!(o instanceof HTMLElement))return;const r=this.getCurrentViewType();r&&(0,ye.ZP)({event:e,context:ye.Af.EditorMouseDown,callback:()=>{e.preventDefault(),H.AI({environment:this.environment,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:"board"===r||"table"===r})}})},this.preventRectangularSelection=e=>{(0,ye.ZP)({event:e,context:ye.Af.EditorMouseDown,callback:()=>{e.preventDefault()}})},this.handleEditorClick=(e,t)=>{(0,ye.ZP)({event:e,context:ye.Af.EditorClick,callback:()=>{if(this.isInPeekRenderer()||Z.E5(this.environment),"page"===t&&!mu.X9()){const{clientX:t,clientY:o,target:r}=e;l.default.afterNextFlush((()=>{q.createAndCommit({userAction:"CollectionViewBlock.PageView.click",environment:this.environment,perform:e=>{U.jh(this.environment,{x:t,y:o,target:r instanceof Element?r:void 0},e)}})}))}}})},this.handleScroll=e=>{var t,o;const r=null===(t=this.horizontalScrollerEl)||void 0===t||null===(t=t.scrollerEl())||void 0===t?void 0:t.scrollLeft,i=null===(o=this.leftRightPaddingStore.state)||void 0===o?void 0:o.paddingLeft;if(void 0===r||void 0===i)return;const n=r>i;n!==this.collectionContextStore.frozoneStore.state.isScrolled&&(this.collectionContextStore.frozoneStore.setState({...this.collectionContextStore.frozoneStore.state,isScrolled:n}),this.handleHorizontalScrollerResize())},this.handleFocusIn=e=>{const t=e.target;null!==t&&t instanceof HTMLElement&&(0,a.E)(t)&&this.stores.focusStore.setState(!0)},this.handleFocusOut=()=>{this.stores.focusStore.setState(!1)},this.handleMouseMove=()=>{po.Z.state||this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.handleHeaderMouseMove=()=>{po.Z.state||this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!0})},this.handleHeaderMouseLeave=()=>{this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!1})},this.handleLoadedStoreChange=()=>{if(!this.isLoadedStore.state||!this.componentIsMounted||this.collectionContextStore.wasCreatedThisSessionStore.state)return;const e=this.environment.RouterStore.state;let t;"page"===e.route.name&&(t=e.route.mobileData);const o=()=>{var e,o;const r=Ke.vS(this.collectionContextStore),i=this.collectionContextStore.collectionViewStore(),n=null==i?void 0:i.id,s=(0,ag.Z)(n);return{...r,is_push:(null===(e=t)||void 0===e?void 0:e.isPush)??!1,collectionViewType:this.getCurrentViewType(),initial_route:this.environment.RouterStore.state.initialRoute.name,prefetchCache:null===(o=this.environment.prefetchCache)||void 0===o||null===(o=o.getPrefetchAnalytic(s))||void 0===o?void 0:o.type,wasm_sqlite_initialized:mg.Z.state.metricDataStore.state.wasm_sqlite_initialized,wasm_sqlite_storage:mg.Z.state.metricDataStore.state.wasm_sqlite_storage,is_mobile_background_launch:(0,w.Z)()}},i=()=>({...Ke.vS(this.collectionContextStore),wasm_sqlite_initialized:mg.Z.state.metricDataStore.state.wasm_sqlite_initialized,wasm_sqlite_storage:mg.Z.state.metricDataStore.state.wasm_sqlite_storage,collectionViewType:this.getCurrentViewType(),...(0,vg.t)()});if(this.isFullScreen())if(mg.Z.state.initialRenderCompleted){var n;qe.default.measureAfterNextFlush("navigation_database_render",{environment:this.environment,getData:i}),this.collectionContextStore.didFireLoadEventsStore.state||fg.Z.navigationStartTime&&(qe.default.measureAfterNextFlush({metricName:"navigation_database_render_v2",startTime:fg.Z.navigationStartTime},{environment:this.environment,getData:i}),this.collectionContextStore.didFireLoadEventsStore.setState(!0)),gg.Z.state.isMeasuring&&gg.Z.update((e=>({...e,isMeasuring:!1}))),null===(n=this.collectionContextStore.databaseItemsVisibleTracker)||void 0===n||n.handleNavigationDatabaseRender()}else{var s;D.setInitialRenderCompleted(),r.vF.hackyOffsetParsesCorrectly()||ig.K4(this.environment,"luxon_hacky_offset_parses_correctly_false"),qe.default.measureFromAppStartAfterNextFlush("initial_database_render",{environment:this.environment,getData:o,shouldSendIfStatsigNotInitialized:!0}),this.renderStartTime&&qe.default.measureAfterNextFlush({metricName:"initial_database_render_from_component_mount",startTime:this.renderStartTime},{environment:this.environment,getData:o,shouldSendIfStatsigNotInitialized:!0}),this.renderStartTime=void 0,D.measureSubMetrics(this.environment,"collection");const e=$f.Xm.CollectionViewBlock.getLoadingMetrics();var l,a;if(null!=e&&e.startedAt)qe.default.measure({metricName:"collection_view_block_bundle_load_and_parse",startTime:e.startedAt,endTime:e.resolvedAt},{environment:this.environment,data:{did_prefetch:"hit-match"===(null===(l=this.environment.prefetchCache)||void 0===l||null===(l=l.getPrefetchAnalytic((0,ag.Z)(null===(a=this.collectionContextStore.collectionViewStore())||void 0===a?void 0:a.id)))||void 0===l?void 0:l.type)}});null===(s=this.collectionContextStore.databaseItemsVisibleTracker)||void 0===s||s.handleInitialDatabaseRender()}else{if(this.collectionContextStore.didFireLoadEventsStore.state)return;if(this.collectionContextStore.didFireLoadEventsStore.setState(!0),mg.Z.state.navigatedAfterInitialRenderCompleted)return;var c;qe.default.measureFromAppStartAfterNextFlush("initial_database_render",{environment:this.environment,getData:o,shouldSendIfStatsigNotInitialized:!0}),this.renderStartTime&&qe.default.measureAfterNextFlush({metricName:"initial_database_render_from_component_mount",startTime:this.renderStartTime},{environment:this.environment,getData:o,shouldSendIfStatsigNotInitialized:!0}),this.renderStartTime=void 0,null===(c=this.collectionContextStore.databaseItemsVisibleTracker)||void 0===c||c.handleInitialDatabaseRender()}},this.handleSearchButtonClick=()=>{this.collectionContextStore.searchOpenStore.update((e=>!e)),F.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_search"})},this.handleSearchQueryChange=e=>{le.Ug({searchQuery:e.target.value,collectionContextStore:this.collectionContextStore,isFullScreen:Boolean(this.props.isFullScreen)}),I.ik(this.environment,{view_type:this.getCurrentViewType()})},this.handleSearchFocus=()=>{st.default.reset(),mo.default.reset()},this.handleSearchBlur=()=>{this.collectionContextStore.searchQueryStore.state||this.handleClearSearch()},this.handleSearchKeyDown=e=>{27===e.keyCode&&this.handleClearSearch()},this.handleClearSearch=()=>{this.collectionContextStore.searchQueryStore.setState(""),this.collectionContextStore.searchOpenStore.setState(!1)},this.handleAddItemClick=e=>{if(!this.collectionContextStore.collectionViewBlockStore()||!(0,Nt.M_)(this.environment))return;const t=this.collectionContextStore.isInHomeWidgetStore.state,o=this.isMultiSourceViewStore.state,r=this.getCurrentViewType();q.createAndCommit({userAction:"CollectionViewBlock.handleAddItemClick",environment:this.environment,perform:i=>{var n;le.NZ({store:this.props.store,collectionContextStore:this.collectionContextStore,environment:this.environment,transaction:i,shouldCoerce:!0,showMoveTo:o,peekModeOverride:t?"center_peek":void 0,from:"cvb_add_item",useCrdt:(0,jt.SL)({event:e,source:"table"===r?"collection_table_view":"collection_non_table_view",contextualDefault:null===(n=this.collectionContextStore.defaultPageTemplateStore.state)||void 0===n?void 0:n.useCrdt()})})}}),F.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_new_item"}),this.projManagementTooltipTourAssignToSomeone()},this.handleTemplatesDropdownClick=()=>{F.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_templates_dropdown"})},this.handleTemplateClick=e=>{q.createAndCommit({userAction:"CollectionViewBlock.handleTemplateClick",environment:this.environment,perform:t=>{const o=le.NZ({transaction:t,store:this.props.store,collectionContextStore:this.collectionContextStore,environment:this.environment,shouldCoerce:!1,from:"cvb_template",useCrdt:e.useCrdt});o&&L.ob({title:"template",environment:this.environment,store:o,templateStore:e.templateStore,isKeyboard:e.isKeyboard,isCreateIn:!1,transaction:t,from:"collection_view_block"})}}),this.projManagementTooltipTourAssignToSomeone(),this.stores.templateButtonPopupStore.reset()},this.handleTemplateEmptyPageClick=e=>{q.createAndCommit({userAction:"CollectionViewBlock.handleTemplateEmptyPageClick",environment:this.environment,perform:t=>{le.NZ({transaction:t,store:this.props.store,collectionContextStore:this.collectionContextStore,environment:this.environment,shouldCoerce:!1,from:"cvb_template_empty_page",useCrdt:(0,jt.SL)({event:e,source:"collection_instantiate_template"})})}}),this.stores.templateButtonPopupStore.reset()},this.handleTemplateCancelClick=()=>{this.stores.templateButtonPopupStore.reset()},this.handleSetSourceClick=()=>{const{collectionContextStore:e}=this,t=e.settingsStore;this.isPlaceholderExternalCollectionStore.state?A.NG({collectionSettingsStore:t}):(A.r$({collectionContextStore:e,collectionSettingsStore:t}),F.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_select_data_source"}))},this.handleNoDateAddPage=e=>{const{collectionContextStore:t}=this,o=e.getAssociatedCollectionStore(),r=this.getCurrentCollectionViewStore(),i=this.timelineViewRef.current;if(!r||!o)return;if(!r.isDefined())return;const{performResult:n}=q.createAndCommit({userAction:"CollectionViewBlock.insertedStore",environment:this.environment,perform:r=>"calendar"===this.getCurrentViewType()?il.Fv({environment:this.environment,store:e,collectionStore:o,collectionContextStore:t,startDayOfWeek:ge.AK.state,results:this.getDefaultResults(),transaction:r}):i?i.addBlockToView({store:e,transaction:r}):void 0});n&&G.Z5({environment:this.environment,stores:[n]})},this.handleOpenAsPageClick=()=>{I.Ji(this.environment,{view_type:this.getCurrentViewType()})},this.handleNoDateButtonClick=()=>{F.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_no_date"})},this.initializeSyncStatePolling=async()=>{if(this.isSyncingStore.state){const e=this.getCollectionStore(),t=null==e?void 0:e.getFormat().uri,o=null==e?void 0:e.getFormat().bot_id,r=null==e?void 0:e.id;if(!t||!o||!r)return;await this.pollSyncState({uri:t,botId:o,collectionId:r})}},this.pollSyncState=async e=>{const t=await N.getExternalCollectionSyncState(this.environment,e);if("success"===t.type&&t.data.result){const o=t.data.result,r=this.collectionContextStore.numberChildrenReceivedStore,i=this.collectionContextStore.numberChildrenUnfurledStore;r.setState(o.numberChildrenReceived),i.setState(o.numberChildrenUnfurled),i.state/r.state<1&&(this.syncStateTimeout=setTimeout((async()=>{await this.pollSyncState(e)}),1e4))}},this.resetCollectionSubscriptions=e=>{const t=Array.from(this.subscriptions.keys()),o=R.e5(t,e),r=R.e5(e,t);for(const n of o){var i;null===(i=this.subscriptions.get(n))||void 0===i||i.unsubscribe(),this.subscriptions.delete(n)}for(const n of r){const e=new Lf(this.environment,(0,T.jY)(n),this.handleCollectionEmit);e.subscribe(),this.subscriptions.set(n,e)}},this.subscribeToTypeChanges=()=>{const e=this.collectionContextStore.contextType,t=this.collectionContextStore.databaseType;if("collectionTypedView"!==e||!t||this.collectionTypeChangeSubscription)return;const o=new Lf(this.environment,(0,T.JY)({spaceId:this.props.store.getSpaceId(),databaseType:t}),this.handleCollectionTypeChangeEmit);o.subscribe(),this.collectionTypeChangeSubscription=o},this.isChartEnabledStore=this.createComputedStore((()=>$e.default.checkGate({gateName:"charts_mvp"}))),this.isSyncingStore=this.createComputedStore((()=>{var e;const t=this.getCollectionStore(),o=null==t?void 0:t.isSyncedCollection(),r=!0===(null==t||null===(e=t.getFormat().sync_state)||void 0===e?void 0:e.syncing),i=this.environment.device.isMobile;return Boolean(o&&r&&!i)})),this.canShowPmIntroTooltipStore=this.createComputedStore((()=>{if(this.environment.device.isMobile)return!1;const e=uo.default.state.currentUserSettingsStore,t=uo.default.state.currentSpaceStore;if(!(0,Q.jH)(e,t)&&(!t||t.getCreatedTime()<Q.VL))return!1;if(!this.isTasksDB())return!1;if(this.props.store.pathIsDead())return!1;return!!this.collectionContextStore.permissionScopesStore.state.canEditContent&&(!!(0,Q.Z0)()&&uo.default.state.inAppCalloutStore.getCalloutVisibility("pm_intro_tooltip").canShow)})),this.isMultiSourceViewStore=this.createComputedStore((()=>"collectionTypedView"===this.collectionContextStore.contextType)),this.isMyTasksPageStore=this.createComputedStore((()=>(0,ge.qG)(this.props.store.id))),this.isCustomDbPageStore=this.createComputedStore((()=>(0,ge.X)(this.props.store.id))),this.showMyTasksEmptyStateStore=this.createComputedStore((()=>this.isInHomeWidgetStore.state&&this.isMyTasksPageStore.state&&0===this.collectionContextStore.collectionStoresStore.state.length&&!this.collectionContextStore.isLoadingStore.state)),this.showCustomDbEmptyStateStore=this.createComputedStore((()=>0===this.collectionContextStore.collectionStoresStore.state.length&&this.getViewStores().length<=1&&this.isInHomeWidgetStore.state&&(0,ge.X)(this.props.store.id))),this.isTasksEmptyStore=this.createComputedStore((()=>!!this.isMyTasksPageStore.state&&this.collectionContextStore.isEmptyStore.state)),this.isCustomDBEmptyStore=this.createComputedStore((()=>!!this.isCustomDbPageStore.state&&this.collectionContextStore.isEmptyStore.state)),this.isInHomeWidgetStore=this.createComputedStore((()=>this.collectionContextStore.isInHomeWidgetStore.state)),this.isTasksDB=()=>{const e=this.collectionContextStore.collectionViewBlockStore();return(null==e?void 0:e.getFormat().app_config_uri)===u.NB},this.shouldRestrictHeaderWidthForMarginComments=()=>this.isRootOrDirectChild()&&!(0,ae._5)(this.props.store)&&this.marginCommentsVisibleStore.state,this.shouldRenderOptions=()=>void 0!==this.collectionContextStore.collectionStore()||"collectionTypedView"===this.collectionContextStore.contextType,this.shouldRestrictWidthForMarginCommentsStore=this.createComputedStore((()=>{const e=this.getCurrentViewType();return this.shouldRestrictHeaderWidthForMarginComments()&&e&&(ae.bu.has(e)||"timeline"===e&&this.collectionContextStore.collectionStore()&&!(0,Qi.C1)({environment:this.environment,format:this.collectionContextStore.normalizedFormatStore.state,isFullScreen:this.isFullScreen(),isRootChild:this.isRootOrDirectChild()}))})),this.isPlaceholderExternalCollectionStore=this.createComputedStore((()=>{const e=this.getCollectionStore();return!!e&&(0,h.OY)(e.getValue())})),this.getExternalIntegrationIdStore=this.createComputedStore((()=>{const e=this.getCollectionStore();if(e)return e.getFormat().integration_id})),this.leftRightPaddingStore=this.createComputedStore((()=>{const{store:e,isFullScreen:t,overridePaddingLeft:o,overridePaddingRight:r}=this.props,i=(0,ae.Bs)({environment:this.environment,store:e,isFullScreen:t,sizeObserver:this.headerSizeObserver,viewType:this.getCurrentViewTypeOrUndefined()});if(i&&void 0!==o&&(i.paddingLeft=o),i&&void 0!==r&&(i.paddingRight=r),!$e.default.checkGate({gateName:"collections_fix_calendar_view_width_bug"})){const t=this.shouldRestrictWidthForMarginCommentsStore.state;i&&t&&(i.paddingRight+=(0,rg.gC)(this.environment,(0,ae.en)(e),this.isInFrameWhenSidePeekOpenStore.state))}return this.isChartsNextEnabledStore.state&&i&&this.isRootOrDirectChild()&&this.marginCommentsVisibleStore.state&&(0,ae._5)(this.props.store)&&!this.props.store.isCollectionViewPageWithContent()&&(i.paddingRight+=rg.QB),i})),this.scrollerLeftPaddingStore=this.createComputedStore((()=>{const e=(0,uu.$3)(this.environment)-vm.zL;if(this.isInFrameWhenSidePeekOpenStore.state&&!this.props.isFullScreen&&!(0,ae._5)(this.props.store)&&e>0&&!this.collectionContextStore.isInHomeWidgetStore.state)return e/2})),this.isLoadedStore=this.createComputedStore((()=>this.collectionContextStore.isLoadedStore.state)),this.leftRightMarginStore=this.createComputedStore((()=>{if(this.isChartsNextEnabledStore.state||!this.isRootOrDirectChild()||!this.marginCommentsVisibleStore.state||!(0,ae._5)(this.props.store)||this.props.store.isCollectionViewPageWithContent())return{marginLeft:void 0,marginRight:void 0};const e=rg.QB/2;return{marginLeft:e,marginRight:-e}})),this.isChartsNextEnabledStore=this.createComputedStore((()=>$e.default.checkGate({gateName:"charts_next"}))),this.noDateTotalStore=this.createComputedStore((()=>{if(this.noDateReducerStore.state){const e=this.stores.noDateResultStore.state;return e&&"aggregation"===e.type&&"number"===e.aggregationResult.type&&e.aggregationResult.value?e.aggregationResult.value:0}return 0})),this.noDateReducerStore=this.createComputedStore((()=>{const e=this.getNoDateProperty();if(e){return{type:"aggregation",aggregation:{property:e,aggregator:"empty",enforceMaxAggregationLimit:!0}}}})),this.hasTasksReducerStore=this.createComputedStore((()=>{if(this.isMyTasksPageStore.state){return{type:"results",filter:{operator:"and",filters:[]},limit:1}}})),this.hasCustomDbReducerStore=this.createComputedStore((()=>{if(this.isCustomDbPageStore.state){return{type:"results",filter:{operator:"and",filters:[]},limit:1}}})),this.hasAppliedFilterStore=this.createComputedStore((()=>(0,ot.RL)({collectionContextStore:this.collectionContextStore,applySubitemFilter:!1,filterOutHideSubitemsQuickFilter:!1}).length>0)),this.hasSortStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this;return e.currentSortsStore.state.length>0})),this.showHoverActionsStore=this.createComputedStore((()=>{var e;const{device:t}=this.environment,{mouseStore:o,headerMouseStore:r,focusStore:i,createSortSettingsStore:n,createFilterSettingsStore:s,filterBarCreateFilterSettingsStore:l,saveControlMoreActionsButtonPopupStore:a}=this.stores,{collectionContextStore:c}=this;if("layoutBuilder"===(null===(e=this.props.collectionViewModuleContextType)||void 0===e?void 0:e.type))return!1;const d=this.isFullScreen(),u=i.state,p=c.settingsStore.state.open,h=c.searchOpenStore.state,m=n.state.open,S=s.state.open,g=l.state.open,f=c.filterBarSortSettingsStore.state.open,C=Array.from(c.filterBarItemSettingsStoreMap.values()),v=a.state.open,y=C.some((e=>e.state.open));return Boolean(o.state.mouseEntered||r.state.mouseEntered||u||d||this.shouldShowProjManagementTooltipTour()||t.isMobile||p||y||m||S||g||h||v||f)})),this.showCompactDesktopHeaderStore=this.createComputedStore((()=>{const{device:e}=this.environment,t=this.headerSizeObserver.rect.state;return!e.isMobile&&t.width&&t.width<400})),this.isInFrameWhenSidePeekOpenStore=this.createComputedStore((()=>(0,ae.Ks)(this.props.store))),this.isInPeekStore=this.createComputedStore((()=>(0,ae.en)(this.props.store))),this.shouldRenderCompactViewVerticalScrollerStore=this.createComputedStore((()=>{const e=this.getCurrentViewType();return!("collectionVirtualView"===this.collectionContextStore.contextType)&&this.isInHomeWidgetStore.state&&function(e){switch(e){case"table":case"board":case"gallery":case"list":case"timeline":case"chart":case"page":case"form_editor":return!0;case"calendar":return!1;default:return(0,he.t1)(e)}}(e)})),this.reasonToDisableNewTaskButtonStore=this.createComputedStore((()=>{const e=this.collectionContextStore.collectionStoresStore.state,t=Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())));if(this.isMultiSourceViewStore.state)return e?0===e.length?"noDbs":t?void 0:gf:"loading"})),this.headerHeightStore=this.createComputedStore((()=>{if(this.props.hideHeader||this.showMyTasksEmptyStateStore.state||this.showCustomDbEmptyStateStore.state)return 0;const e=this.props.hideViewTabBar?40:0;return this.collectionContextStore.isInHomeWidgetStore.state?ug.jX-e:Ym-e}))}insertBlocks(e,t){const o=this.getCollectionStore();if(o)for(const r of e)E.mp({environment:this.environment,store:r,collectionStore:o,collectionContextStore:this.collectionContextStore,shouldCoerce:!0,groupsPointer:[],transaction:t});return[]}handleCreated(){G.ZH({debug:{userAction:"CollectionViewBlock.handleCreated"},environment:this.environment}),l.default.afterNextFlush((()=>{const{collectionContextStore:e}=this,t=e.collectionStore(),o=e.collectionViewBlockStore(),r=e.settingsStore;if(!o)return;const i=o.getCollectionViewSourceCollectionStore();if(this.isPlaceholderExternalCollectionStore.state)A.NG({collectionSettingsStore:r});else if(i)le.W1({environment:this.environment,collectionContextStore:e});else if(t){if($e.default.checkGate({gateName:"collection_view_link_paste_improvements"})){const r=null==e?void 0:e.collectionViewStore();r&&function(e){const{collectionStore:t,collectionViewStore:o,collectionViewBlockStore:r,collectionContextStore:i,environment:n}=e,s=null==o?void 0:o.id,l=s?(0,cg.x)(s):void 0,a=(0,ec.gL)({collectionStore:t,sourceCollectionViewBlockStore:r,currentCollectionViewBlockStore:r,currentCollectionViewStore:o,constraints:(0,cg.x)(o.id)}),c=a.find((e=>{var t;return e.id===(null==l||null===(t=l.viewPointer)||void 0===t?void 0:t.id)}));c&&(0,ec.Vz)({viewToDuplicateStore:c,collectionContextStore:i,collectionViewStore:o,environment:n})}({collectionStore:t,collectionViewStore:r,collectionViewBlockStore:o,collectionContextStore:e,environment:this.environment})}else(0,Ja.V)({environment:this.environment,collectionStore:t,collectionContextStore:e,collectionSettingsStore:r});A.r$({collectionContextStore:e,collectionSettingsStore:r})}else A.r$({collectionContextStore:e,collectionSettingsStore:r})}))}handleDefaultCollectionSetting(){var e;const{collectionContextStore:t}=this,o=null===(e=t.collectionStore())||void 0===e?void 0:e.getFormat();if(!o)return;const r=t.settingsStore;"Jira"===o.external_collection_type&&o.synced_collection_external_url&&Sg.Z.state.defaultExternalCollectionSetting&&(A.Qu({collectionSettingsStore:r,source:Sg.Z.state.defaultExternalCollectionSetting}),Sg.Z.setState({...Sg.Z.state,open:!1,defaultExternalCollectionSetting:void 0}))}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.trackRenderTime({isFirstRender:!0}),this.collectionContextStore.isLoadedStore.addListener(this.handleLoadedStoreChange),this.handleLoadedStoreChange(),this.renderStartTime=performance.now()}UNSAFE_willMountOrUpdate(e){super.UNSAFE_willMountOrUpdate(e);const{store:t}=e,o=t.id,{collectionContextStore:r}=this,i=this.collectionContextStore.collectionViewStore(),n=this.collectionContextStore.collectionStore(),s=this.environment.currentUser.id,l=i?i.id:void 0,a=n?n.id:void 0,c=this.getViewStores().map((e=>e.id)),d=this.getDefaultCollectionViewStore(),u=k.Z.get({userId:s,key:Ft.Z.getLocalViewPreferenceKey(o)});let p;const h=t=>!!e.isUnlistedView||c.includes(t);if(e.viewId&&h(e.viewId)?p=e.viewId:i&&h(i.id)?p=i.id:u&&h(u)?p=u:d&&h(d.id)&&(p=d.id),p){const i=Ye.Xr.createChildStore(t,{table:V.np,id:p}),n=i.getCollectionStore(),c=!n||n.isDefined();i.isDefined()&&c&&(p!==u&&k.Z.set({userId:s,key:Ft.Z.getLocalViewPreferenceKey(o),value:p}),(p!==l||n&&n.id!==a)&&le.mc({environment:this.environment,collectionViewBlockStore:t,collectionViewStore:i,collectionStore:n,collectionContextStore:r,isFullScreen:this.isFullScreen(),isRootChild:this.isRootOrDirectChild(),isInPeekRenderer:this.isInPeekRenderer(),collectionViewModuleContextType:e.collectionViewModuleContextType}),void 0===r.frozoneStore.state.frozenIndex&&this.resetFrozoneStore(i))}const m=r.collectionStore();if(m){m.getTemplatePageStores().map((e=>e.getValue()))}this.isSyncingStore.addListener(this.initializeSyncStatePolling),this.ensureStoreListeners()}UNSAFE_willUpdate(){this.trackRenderTime({isFirstRender:!1})}didMount(){var e,t,o,r;super.didMount(),yg.Z.addListener(this.handlePageVisibilityChange),Qe.default.addListener(this.handlePeekViewChange),this.collectionContextStore.relativeVariablesAreStaleStore.addListener(this.handleRelativeVariableStaleStoreChange);const i=this.collectionContextStore.collectionViewStore(),n=this.collectionContextStore.collectionStore();if(i&&n){const e=this.getCurrentViewTypeOrUndefined(),t=i.getChartType(),o=i.getChartPlaceholderType();e&&ig.K4(this.environment,"database_visit",{collection_id:n.id,collection_view_id:i.id,collection_view_block_id:this.props.store.id,type:e,is_full_screen:this.isFullScreen(),is_peek:this.isInPeekRenderer(),peek_mode:Qe.default.state.mode,database_visit_id:this.collectionContextStore.visitSessionId,chart_type:"placeholder"===t?o:t,is_chart_placeholder:"placeholder"===t})}if(i&&"collectionTypedView"===this.collectionContextStore.contextType){const e=this.collectionContextStore.databaseType,t=this.getCurrentViewTypeOrUndefined();e&&t&&ig.lu(this.environment,"type_aggregated_database_visit",`type_aggregated_database_visit-${e}`,60,{collection_view_id:i.id,collection_view_block_id:this.props.store.id,type:t,databaseType:e,is_my_tasks:(0,TS.Ep)("myTasks")===this.props.store.id})}let s;this.collectionContextStore.sprintSettingsContextStore.addListener(this.handleSprintSettingsContextStoreChange),null===(e=(t=this.props).setCollectionContextStore)||void 0===e||e.call(t,this.collectionContextStore),this.handleDefaultCollectionSetting();try{s=this.getCurrentViewType()}catch(l){}null===(o=(r=this.props).onMount)||void 0===o||o.call(r,s),this.isFullScreen()&&(mg.Z.state.initialRenderCompleted?qe.default.measure("navigation_database_render_temporary_mount",{environment:this.environment}):qe.default.measureFromAppStartAfterNextFlush("initial_database_render_temporary_mount",{environment:this.environment,getData:()=>({is_push:!1,initial_route:"page"})}))}didMountOrUpdate(){var e,t;const o=this.getCollectionStore();o?this.resetCollectionSubscriptions([o.id]):this.resetCollectionSubscriptions(this.collectionContextStore.remoteCollectionIdsStore.state);const r=this.collectionContextStore.frozoneStore.state.scrollerWidth,i=null===(e=this.collectionContextStore.collectionViewStore())||void 0===e?void 0:e.getTableFrozenColumnIndex(r,this.collectionContextStore.normalizedFormatStore.state);var s;(void 0===i||this.isInHomeWidgetStore.state||this.collectionContextStore.frozoneStore.setState({...this.collectionContextStore.frozoneStore.state,frozenIndex:i}),this.collectionContextStore.remoteCollectionIdsStore.addListener((e=>this.resetCollectionSubscriptions(e.state))),this.subscribeToTypeChanges(),this.parentNode)||(this.parentNode=null===(s=n.findDOMNode(this))||void 0===s?void 0:s.parentElement,this.parentNode&&((0,ui.lj)(this.parentNode,"focusin",this.handleFocusIn),(0,ui.lj)(this.parentNode,"focusout",this.handleFocusOut),(0,ui.lj)(this.parentNode,"mousemove",this.handleMouseMove),(0,ui.lj)(this.parentNode,"mouseleave",this.handleMouseLeave)));const l=null===(t=this.horizontalScrollerEl)||void 0===t?void 0:t.scrollerEl();l&&(0,ui.lj)(l,"scroll",this.handleScroll)}didUpdate(e){this.trackSwitchViewLag()}willUnmount(){var e,t;super.willUnmount();const{collectionContextStore:o}=this;le.ob({collectionContextStore:o}),this.unsubscribeAll(),this.headerSizeObserver.destroy(),this.settingsHeaderSizeObserver.destroy(),yg.Z.removeListener(this.handlePageVisibilityChange),Qe.default.removeListener(this.handlePeekViewChange),this.collectionContextStore.isLoadedStore.removeListener(this.handleLoadedStoreChange),this.collectionContextStore.relativeVariablesAreStaleStore.removeListener(this.handleRelativeVariableStaleStoreChange),this.parentNode&&((0,ui.ZV)(this.parentNode,"focusin",this.handleFocusIn),(0,ui.ZV)(this.parentNode,"focusout",this.handleFocusOut),(0,ui.ZV)(this.parentNode,"mousemove",this.handleMouseMove),(0,ui.ZV)(this.parentNode,"mouseleave",this.handleMouseLeave));const r=null===(e=this.horizontalScrollerEl)||void 0===e?void 0:e.scrollerEl();r&&(0,ui.ZV)(r,"scroll",this.handleScroll),null===(t=this.resizeObserver)||void 0===t||t.disconnect(),this.isSyncingStore.removeListener(this.initializeSyncStatePolling),clearTimeout(this.syncStateTimeout),this.collectionContextStore.sprintSettingsContextStore.removeListener(this.handleSprintSettingsContextStoreChange)}renderPersisted(){var e;const{collectionContextStore:t}=this,o=this.getCurrentCollectionViewStore(),r=this.getCollectionStore(),i=t.normalizedSchemaStore.state,n=t.normalizedQueryStore.state,s=t.normalizedFormatStore.state,l=t.remoteResultStore.state,a=this.isFullScreen();if(!(o&&i&&n&&s))return;const c=this.getCurrentViewTypeOrUndefined();if(!c)return;if(r&&!r.isDefined())return;const d=null==r?void 0:r.getFormat();if(this.isCollectionViewOfExternalCollectionWithoutExternalObjectId())return(0,C.jsx)(jl.L1,{value:this.collectionContextStore,children:(0,C.jsx)(cc.p,{allowSelectionWithin:!0,style:this.getHeaderWrapStyle(),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleHeaderMouseMove,onMouseLeave:this.handleHeaderMouseLeave,onClick:this.handleEditorClick,ref:this.handleHeaderMount,children:(0,C.jsx)(St.Z,{store:this.props.store,shouldShowHoverMenu:!0,analyticsName:rC(c),shouldShowHalo:!this.isFullScreen()&&!this.isInHomeWidgetStore.state,canSelect:!this.isFullScreen()&&!this.isInHomeWidgetStore.state,children:(0,C.jsx)(yf.Z,{store:this.props.store,style:{width:"auto"},disabled:!1})})})});if(this.showCustomDbEmptyStateStore.state)return(0,C.jsxs)("div",{style:(0,ug.KI)({isPhone:this.environment.device.isPhone,theme:this.theme}),children:[(0,C.jsx)("div",{style:{position:"relative"},children:this.renderViewSettings({placementToOrigin:eS.Iw.Right,alignmentToOrigin:eS.lU.Center})}),(0,C.jsx)(dg.Qi,{feature:"custom_db",onSetup:e=>{A.r$({collectionContextStore:this.collectionContextStore,collectionSettingsStore:this.collectionContextStore.settingsStore,hideSettingsHeader:!0,ref:e})}})]});const u=this.renderView(r,o,c,i,n,s),p=!this.showMyTasksEmptyStateStore.state,h=this.isInPeekStore.state?jr.Z.X:(0,ge.p5)({environment:this.environment,isFullScreen:this.isFullScreen()}),m=p?(0,C.jsx)(Ir.Z,{type:h,className:dt.x9t,onMouseDown:this.handleEditorMouseDown,preventType:this.isInPeekStore.state||this.collectionContextStore.isInHomeWidgetStore.state?jr.Z.None:z.Q7(this.environment),onClick:e=>this.handleEditorClick(e,c),style:this.getScrollerStyle(c,s,this.scrollerLeftPaddingStore.state),ref:this.handleHorizontalScrollerMount,children:u}):u,S=p?(0,C.jsx)(Nr,{isInHomeWidget:this.isInHomeWidgetStore.state,style:{..."list"===c?{paddingBottom:8}:"timeline"===c?{paddingBottom:0}:{paddingBottom:16}},children:m}):m,g=this.getHeaderWrapStyle(),f={flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",...this.leftRightMarginStore.state},v=a?(0,C.jsxs)(C.Fragment,{children:[this.maybeRenderJiraOverlayMessages(d,null==l?void 0:l.sizeHint,g.paddingLeft,g.paddingRight),(0,C.jsx)(cc.p,{allowSelectionWithin:!0,style:{...f,position:"relative"},children:m})]}):(0,C.jsx)(cc.p,{allowSelectionWithin:!0,style:{flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",...this.leftRightMarginStore.state,...this.scrollerLeftPaddingStore.state&&{marginLeft:-this.scrollerLeftPaddingStore.state},maxHeight:this.props.maxHeight?this.props.maxHeight-this.headerHeightStore.state:"inherit",...this.isInHomeWidgetStore.state&&this.collectionContextStore.isEditableHomeCollectionStore.state?(0,ug.KI)({isPhone:this.environment.device.isPhone,theme:this.theme}):{},...this.isChartsNextEnabledStore.state?{width:this.props.fullWidth,position:"relative",left:-((null===(e=this.leftRightPaddingStore.state)||void 0===e?void 0:e.paddingLeft)??0)}:{}},children:(0,C.jsxs)("div",{style:{position:"relative",...this.isInHomeWidgetStore.state?{height:"100%",maxHeight:"inherit"}:{}},children:[this.maybeRenderJiraOverlayMessages(d,null==l?void 0:l.sizeHint,g.paddingLeft,g.paddingRight),this.shouldRenderCompactViewVerticalScrollerStore.state?S:m]})});return(0,C.jsxs)(jl.L1,{value:this.collectionContextStore,children:[this.isFullScreen()?void 0:(0,C.jsx)("div",{style:{position:"relative"},children:this.renderViewSettings()}),(0,C.jsx)(Um,{}),this.renderMultiSelectToolbar(),this.renderHeader(c),v,this.renderBottomBorderForViewSettings(),(0,C.jsx)(qf,{collectionContextStore:this.collectionContextStore,parentMountTime:this.renderStartTime})]})}maybeRenderJiraOverlayMessages(e,t,o,r){var i;return(0,Wm.K6)()&&(0,Wm.KT)()&&"Jira"!==(null==e?void 0:e.external_collection_type)&&null!=e&&null!==(i=e.sync_state)&&void 0!==i&&i.syncing&&!t?(0,C.jsx)(bf,{projectCount:(null==e?void 0:e.projects_to_be_synced)||0,taskCount:(null==e?void 0:e.tasks_to_be_synced)||0,paddingLeft:o,paddingRight:r}):null}renderUnlistedCollectionsActionBar(){const{store:e}=this.props;return(0,C.jsx)(jl.L1,{value:this.collectionContextStore,children:(0,C.jsx)(cc.p,{allowSelectionWithin:!0,style:{...R.CE(this.getHeaderWrapStyle(),["opacity","height","minHeight","pointerEvents","width"]),paddingRight:16},onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleHeaderMouseMove,onMouseLeave:this.handleHeaderMouseLeave,ref:this.handleHeaderMount,children:(0,C.jsx)(St.Z,{store:e,shouldShowCopyLinkButton:e.isNonEditableState(),shouldShowHoverMenu:!0,analyticsName:rC("table"),children:(0,C.jsxs)("div",{style:this.getHeaderStyle(),ref:this.handleSettingsHeaderMount,children:[!this.props.hideViewTabBar&&this.renderViewTabBar(),(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[this.renderLoadingSpinner(),this.renderFilterButton(),this.renderSortButton(),this.renderSearch(),(0,C.jsx)($f.CI,{collectionContextStore:this.collectionContextStore})]})]})})})})}renderHeader(e){var t;const{device:o}=this.environment,{store:r,disableHoverMenu:i}=this.props,n=this.isFullScreen(),s=this.noDateReducerStore.state,l=this.hasTasksReducerStore.state,a=this.hasCustomDbReducerStore.state,c=this.showHoverActionsStore.state,d=this.showCompactDesktopHeaderStore.state,u=this.leftRightPaddingStore.state,p=(null===(t=this.collectionContextStore.collectionViewBlockStore())||void 0===t?void 0:t.isCollectionViewPageWithContent())&&"page"===this.getCurrentViewType(),h=this.shouldShowProjManagementTooltipTour()?(0,C.jsx)(Kg.Z,{store:r,origin:this.renderViewSettingsButton(),isFirstTooltip:!1,phase:"click_view_settings"}):this.renderViewSettingsButton(),m=$e.default.checkGate({gateName:"prevent_edits_trash"});return(0,C.jsxs)(cc.p,{allowSelectionWithin:!0,style:this.getHeaderWrapStyle(),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleHeaderMouseMove,onMouseLeave:this.handleHeaderMouseLeave,ref:this.handleHeaderMount,children:[n?this.renderViewSettings():void 0,u&&(0,C.jsxs)(St.Z,{store:r,shouldShowCopyLinkButton:r.isNonEditableState(),shouldShowHoverMenu:!i&&this.canEdit()&&!n,analyticsName:rC(e),shouldShowHalo:!this.isFullScreen()&&!this.isInHomeWidgetStore.state,children:[o.isPhone?(0,C.jsxs)("div",{style:this.getHeaderStyle(),ref:this.handleSettingsHeaderMount,children:[!this.props.hideViewTabBar&&this.renderViewTabBar(),!this.props.hideHeaderActions&&(0,C.jsx)(pc.Z,{isVisible:!0,animationStyle:{opacity:c?1:0},render:()=>(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[this.renderLoadingSpinner(),this.renderFullScreenButton(),h,this.renderAddItemButton()]})})]}):(0,C.jsxs)("div",{style:this.getHeaderStyle(),ref:this.handleSettingsHeaderMount,children:[!this.props.hideViewTabBar&&this.renderViewTabBar(),!this.props.hideHeaderActions&&(0,C.jsx)(pc.Z,{isVisible:!0,animationStyle:{opacity:c?1:0},render:()=>(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:2},onMouseDown:this.preventRectangularSelection,children:[this.renderLoadingSpinner(),!d&&this.renderLockIndicator(),!d&&this.renderNoDateButton(),"page"!==e&&"form_editor"!==e&&this.renderFilterButton(),"page"!==e&&"form_editor"!==e&&this.renderSortButton(),"chart"!==e&&"form_editor"!==e&&this.renderAutomationSettingsButton(),!d&&"page"!==e&&"chart"!==e&&"form_editor"!==e&&this.renderSearch(),p&&this.renderPageViewSearch(),this.renderFullScreenButton(),h,"form_editor"!==e&&this.renderAddItemButton(),"form_editor"===e&&(0,C.jsx)(ya,{collectionContextStore:this.collectionContextStore})]})})]}),l&&(0,C.jsx)(bt.Z,{id:"tasks_results",collectionContextStore:this.collectionContextStore,reducer:l,resultStore:this.stores.tasksResultStore}),a&&(0,C.jsx)(bt.Z,{id:"custom_db_results",collectionContextStore:this.collectionContextStore,reducer:a,resultStore:this.stores.customDbResultStore}),s&&(0,C.jsx)(bt.Z,{id:"no_date_count",collectionContextStore:this.collectionContextStore,reducer:s,resultStore:this.stores.noDateResultStore})]}),(0,C.jsxs)("div",{style:this.getHeaderPositioningStyle(),children:[this.renderSource(),m?(0,C.jsx)(Gf,{collectionContextStore:this.collectionContextStore}):null,this.renderFilterBar()]})]})}renderLockIndicator(){const{device:e}=this.environment,{store:t}=this.props;if(!this.isFullScreen()&&!e.isPhone&&t.canEditCollection())return(0,C.jsx)(wf.Z,{store:t,isMobile:!1,isInlineCollection:!0,disableTooltip:!0,buttonStyle:{marginLeft:4,marginRight:4}})}renderViewTabBar(){var e;const t=null===(e=this.collectionContextStore.collectionViewBlockStore())||void 0===e?void 0:e.id,o=Boolean(t&&(0,ge.qG)(t)),r=this.props.hideHeader||o;return(0,C.jsx)(QS,{collectionContextStore:this.collectionContextStore,showHoverActionsStore:this.showHoverActionsStore,isPlaceholderExternalCollectionStore:this.isPlaceholderExternalCollectionStore,showOnlyCurrentView:this.props.showOnlyCurrentView??!1,onViewClick:this.handleViewClick,disabled:r})}renderFullScreenButton(){if(this.isFullScreen())return;const e=(0,lo.ZP)({store:this.props.store,fullyQualified:!1,pageVisitSource:d.tY.Expand}),t=We.default.formatMessage(Xf.openFullscreenPageButtonTooltip),o=0===this.collectionContextStore.collectionStoresStore.state.length;return(0,C.jsx)(Jt.Z,{disableTooltip:o,renderTooltip:()=>t,render:r=>(0,C.jsx)(_e.Z,{ariaLabel:t,href:o?void 0:e,onClick:this.handleOpenAsPageClick,icon:y.Z,style:this.getTopbarIconButtonStyle(),iconStyle:{width:16},disabled:o,disabledFeedback:o,...r})})}renderAutomationSettingsButton(){var e;const{collectionContextStore:t,automationsViewRef:o}=this,r=this.getCurrentViewType(),i=t.settingsStore,n=i.state.open,s=(0,pg.n)(i),l=(0,ng.Cf)({tab:s}),a=t.aliveAutomationCountStore.state;if("page"===r||this.isPlaceholderExternalCollectionStore.state||!(0,lg.cB)(t))return;const c=a>0;if(!c||this.headerSizeObserver.rect.state.width<=Yf)return;const d=$e.default.checkGate({gateName:"prevent_edits_trash"}),u=null===(e=uo.default.getState().mainEditorCurrentBlockStore)||void 0===e?void 0:e.pathIsDead(),p=t.collectionStore(),h=null==p?void 0:p.getParentBlockStore(),S=null==h?void 0:h.pathIsDead(),g=d&&(S||u)&&!c;return(0,C.jsx)(Jt.Z,{renderTooltip:()=>g?We.default.formatMessage(Xf.disableAutomationsSettingsButtonTooltip):We.default.formatMessage(Xf.openAutomationsSettingsButtonTooltip),render:e=>(0,C.jsx)(_e.Z,{ariaLabel:g?We.default.formatMessage(Xf.disableAutomationsSettingsButtonAriaLabel):We.default.formatMessage(Xf.openAutomationsSettingsButtonAriaLabel),className:dt.RIA,icon:m.K,style:this.getTopbarIconButtonStyle(),iconStyle:{width:void 0,height:14,fill:c?this.theme.icon.uiBluePrimary:this.theme.mediumIconColor},hovered:n&&l,onClick:this.handleViewAutomationSettingsClick,ref:o,disabled:g,...e})})}renderViewSettingsButton(){return this.isPlaceholderExternalCollectionStore.state?null:(0,C.jsx)($f.kE,{collectionContextStore:this.collectionContextStore,style:this.getTopbarIconButtonStyle()})}renderFilterButton(){const{device:e}=this.environment,{createFilterSettingsStore:t}=this.stores;if(this.shouldRenderOptions()&&!this.isPlaceholderExternalCollectionStore.state)return(0,C.jsx)(Ve.ZP,{popupType:e.isMobile?Te.Z4.SlideUp:Te.Z4.Popup,open:t.state.open,origin:this.renderFilterButtonOrigin(),onDismiss:this.handleCreateFilterPopupDismiss,originGap:4,render:this.renderCreateFilterPopup})}renderFilterButtonOrigin(){const e=this.hasAppliedFilterStore.state,t=We.default.formatMessage(Xf.filterLabel),o=0===this.collectionContextStore.collectionStoresStore.state.length;if(this.settingsHeaderSizeObserver.rect.state.width<=Yf)return;const r=(0,ot.yU)(this.collectionContextStore);return(0,C.jsx)(Jt.Z,{renderTooltip:()=>t,disableTooltip:o,render:i=>(0,C.jsxs)("div",{style:{position:"relative"},children:[(0,C.jsx)(_e.Z,{...i,disabled:o,ariaLabel:t,icon:g.Q,iconStyle:{width:16,height:void 0,fill:e?this.theme.icon.uiBluePrimary:this.theme.mediumIconColor},style:this.getTopbarIconButtonStyle(),onClick:this.handleFilterClick}),r&&(0,C.jsx)("div",{style:{position:"absolute",top:3,right:2,background:"dark"===this.theme.mode?this.theme.accentColors.orange[500]:this.theme.accentColors.orange[300],border:`1px solid ${this.theme.contentBackground}`,width:9,height:9,borderRadius:9}})]})})}renderSortButton(){var e,t;const{device:o}=this.environment,{createSortSettingsStore:r}=this.stores;if(!this.shouldRenderOptions()||this.isPlaceholderExternalCollectionStore.state)return;const i=null===(e=this.getCurrentCollectionViewStore())||void 0===e?void 0:e.getChartConfig();return"chart"!==this.getCurrentViewType()||"placeholder"!==(null==i?void 0:i.type)&&"donut"!==(null==i?void 0:i.type)&&"results-advanced"===(null==i||null===(t=i.chartFormat)||void 0===t?void 0:t.axisSort)?(0,C.jsx)(Ve.ZP,{popupType:o.isMobile?Te.Z4.SlideUp:Te.Z4.Popup,open:r.state.open,origin:this.renderSortButtonOrigin(),onDismiss:this.handleCreateSortPopupDismiss,originGap:4,render:this.renderCreateSortPopup}):void 0}renderSortButtonOrigin(){const e=this.hasSortStore.state;if(this.settingsHeaderSizeObserver.rect.state.width<=Yf)return;const t=(0,ot.Mj)(this.collectionContextStore),o=We.default.formatMessage(Xf.sortLabel),r=0===this.collectionContextStore.collectionStoresStore.state.length;return(0,C.jsx)(Jt.Z,{renderTooltip:()=>o,disableTooltip:r,render:i=>(0,C.jsxs)("div",{style:{position:"relative"},children:[(0,C.jsx)(_e.Z,{...i,disabled:r,ariaLabel:o,icon:b.j,iconStyle:{width:21,height:void 0,fill:e?this.theme.icon.uiBluePrimary:this.theme.mediumIconColor},style:this.getTopbarIconButtonStyle(),onClick:this.handleSortClick}),t&&(0,C.jsx)("div",{style:{position:"absolute",top:3,right:2,background:"dark"===this.theme.mode?this.theme.accentColors.orange[500]:this.theme.accentColors.orange[300],border:`1px solid ${this.theme.contentBackground}`,width:9,height:9,borderRadius:9}})]})})}renderSearch(){const{collectionContextStore:e}=this;if(!this.shouldRenderOptions()||this.isPlaceholderExternalCollectionStore.state)return;const t=e.searchOpenStore.state,o=e.searchQueryStore.state,r=0===this.collectionContextStore.collectionStoresStore.state.length;return this.settingsHeaderSizeObserver.rect.state.width<=Yf?void 0:(0,C.jsx)(Jt.Z,{disableTooltip:Boolean(this.reasonToDisableNewTaskButtonStore.state),renderTooltip:()=>We.default.formatMessage(Xf.searchLabel),render:e=>(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(_e.Z,{...e,icon:S.e,iconStyle:{width:14,height:void 0,fill:this.theme.mediumIconColor},style:this.getTopbarIconButtonStyle(),disabled:r,onClick:this.handleSearchButtonClick,ariaLabel:We.default.formatMessage(Xf.searchLabel)}),(0,C.jsx)(pc.Z,{isVisible:t,animationStyle:{width:150,opacity:1},enterAnimationStyle:{width:0,opacity:0},exitAnimationStyle:{width:0,opacity:0},render:()=>(0,C.jsx)(yp.Z,{capture:t,allowEsc:!0,render:e=>(0,C.jsx)("div",{...e,style:{display:"flex",alignItems:"center",overflow:"hidden"},children:(0,C.jsx)(vf.Z,{style:this.getSearchInputStyle(),format:vf.B.Transparent,value:o,onChange:this.handleSearchQueryChange,placeholder:We.default.formatMessage(Xf.searchInputPlaceholder),focusInitial:t,showClearButton:!0,onFocus:this.handleSearchFocus,onBlur:this.handleSearchBlur,onCancel:this.handleClearSearch,onClick:ye.Wi,onClearButtonClick:this.handleClearSearch,onKeyDown:this.handleSearchKeyDown})})})})]})})}renderPageViewSearch(){var e;const t=this.getCurrentCollectionViewStore();if("page"!==(null==t?void 0:t.getType()))return null;const o=null===(e=this.collectionContextStore.collectionViewBlockStore())||void 0===e?void 0:e.id;return o?(0,C.jsxs)(Et.Z,{style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:j.Z.fontWeight.medium,color:this.theme.mediumTextColor},onClick:()=>{K.Kf({environment:this.environment,analyticsFrom:"wiki-home-collection-view"}),wg.ZP.updateFilters({ancestors:[o]})},children:[(0,S.e)({width:14,fill:this.theme.mediumIconColor,marginRight:6}),(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Search",id:"database.collectionViewBlock.pageView.search"})]}):null}renderAddItemButton(){const{collectionContextStore:e}=this;if("page"===this.getCurrentViewType()||this.isPlaceholderExternalCollectionStore.state||!e.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return null;const t=(0,ae.PI)(e),o=this.settingsHeaderSizeObserver.rect.state.width<=Yf,r=!this.environment.device.isMobile&&(o||this.isInHomeWidgetStore.state),i=this.isMultiSourceViewStore.state,n={fontSize:14,...r?{marginLeft:4,marginTop:4,height:24}:{marginLeft:6,height:28}},s=r?{width:24}:void 0,l=r?{width:15,marginRight:0}:void 0,a=e=>(0,C.jsx)(Tf.Z,{title:r?null:t,icon:r?x.f:void 0,color:"blue",onClick:this.handleAddItemClick,dropdownEvents:e,style:n,mainButtonStyle:s,iconStyle:l,className:dt.sqL,disabled:Boolean(this.reasonToDisableNewTaskButtonStore.state),disableDropdown:i});return(0,C.jsx)(Te.ZP,{popupType:this.environment.device.isMobile?Ve.kQ.SlideUp:Ve.kQ.Popup,render:this.renderTemplatesPopup,originGap:4,onClick:this.handleTemplatesDropdownClick,renderOrigin:e=>this.shouldShowProjManagementTooltipTour()?(0,C.jsx)(Kg.Z,{store:this.props.store,origin:a(e),isFirstTooltip:!0,phase:"create_a_task"}):(0,C.jsx)(Jt.Z,{disableTooltip:Boolean(this.reasonToDisableNewTaskButtonStore.state),renderTooltip:()=>this.reasonToDisableNewTaskButtonStore.state===gf?(0,C.jsx)(P.FormattedMessage,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"collectionViewBlock.addItem.tooltip.noWritableDbs",values:{br:(0,C.jsx)("br",{})}}):r?t:null,render:t=>r||this.reasonToDisableNewTaskButtonStore.state===gf?(0,C.jsx)("div",{...t,style:{marginLeft:4,marginRight:this.isInHomeWidgetStore.state?void 0:4},children:a(e)}):a(e)}),buttonPopupStore:this.stores.templateButtonPopupStore})}renderNoDateButton(){const e=this.noDateTotalStore.state,{collectionContextStore:t}=this,o=t.permissionScopesStore.state,r=t.collectionStore();if(0!==e&&("collectionTypedView"===t.contextType||r&&o.canEditContent))return(0,C.jsx)(Te.ZP,{popupType:this.environment.device.isMobile?Ve.kQ.SlideUp:Ve.kQ.Popup,render:this.renderNoDatePopup,onClick:this.handleNoDateButtonClick,renderOrigin:t=>(0,C.jsx)(Et.Z,{isGray:!0,style:this.getTopbarActionButtonStyle(!1),...t,children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"No date ({noDateTotal})",id:"collectionViewBlock.action.noDateButton.noProperty.label",values:{noDateTotal:e>=p.GW?p.GW-1+"+":e}})})})}renderFilterBar(){const{collectionContextStore:e}=this,t=e.filtersBarOpenStore.state,o=e.shouldShowSourceStore.state?8:12;if("page"!==this.getCurrentViewType()&&!this.isInHomeWidgetStore.state){if(!t){if(!e.completeSprintButtonContextStore.state)return;return(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingBottom:this.environment.device.isPhone?12:8,paddingTop:o},children:[(0,C.jsx)("div",{style:{flex:1}}),(0,C.jsx)(_f.Z,{collectionContextStore:e})]})}return(0,C.jsx)(Im.Z,{collectionContextStore:this.collectionContextStore,showHoverActionsStore:this.showHoverActionsStore,createFilterSettingsStore:this.stores.filterBarCreateFilterSettingsStore,saveControlMoreActionsButtonPopupStore:this.stores.saveControlMoreActionsButtonPopupStore})}}renderSource(){if(!this.isPlaceholderExternalCollectionStore.state)return this.collectionContextStore.shouldShowSourceStore.state?(0,C.jsx)(wm,{store:this.props.store,collectionContextStore:this.collectionContextStore,isFullScreen:this.isFullScreen(),showHoverActionsStore:this.showHoverActionsStore,canEdit:this.canEdit()}):void 0}renderView(e,t,o,r,i,n){const{store:s}=this.props,{collectionContextStore:l}=this,a=!this.canEdit()||"collectionVirtualView"===l.contextType;"rendered"!==uo.default.state.renderPhase&&uo.default.setState({...uo.default.state,renderPhase:"rendered"});const c=this.isFullScreen(),d=this.isInPeekRenderer(),u=this.getBlockPropertyValueOverlayStore(),p=this.isRootOrDirectChild();let h=this.leftRightPaddingStore.state;if(h){if(!e&&this.collectionContextStore.hasSingleCollection())return this.renderNoSourcePlaceholder(o);if(this.isPlaceholderExternalCollectionStore.state)return this.renderNoSourceExternalCollectionPlaceholder(o);if(this.isTasksEmptyStore.state)return(0,C.jsx)(ff,{collectionContextStore:l,onAddTaskClick:this.handleAddItemClick,from:l.isInHomeWidgetStore.state?"home_tile_tasks":"home_tasks"});if(this.isCustomDBEmptyStore.state)return(0,C.jsx)(dg.sg,{collectionContextStore:l,onAddItemClick:this.handleAddItemClick,from:l.isInHomeWidgetStore.state?"home_tile_custom_db":"home_custom_db"});if("table"===o)return(0,C.jsx)(zu,{schema:r,format:n,query:i,store:s,collectionContextStore:l,showHoverActionsStore:this.showHoverActionsStore,isFullScreen:c,isInPeekRenderer:d,...h,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p,viewSettingsPlacementStore:this.stores.viewSettingsPlacementStore},t.id);if("board"===o)return(0,C.jsx)(Zs,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p},t.id);if("page"===o){const e=t.getFormat().page_pointer;if(!e)return;const o=this.createComputedStore((()=>s.id===e.id?s:Ye.G.createChildStore(s,{table:e.table,id:e.id}))),r=(0,ge.ui)(this.environment),i=o.state;if(!i.isCollectionView())return;const n=this.canEdit();return(0,C.jsx)(Ef,{canEdit:n,disabled:this.props.disabled||this.props.store.isNonEditableState(),padding:{paddingBottom:kf.ZP.paddingBottom(this.environment),paddingLeft:r,paddingRight:r},store:i,style:kf.d$})}if("calendar"===o)return(0,C.jsx)(sa,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,maxHeight:this.props.maxHeight?this.props.maxHeight-this.headerHeightStore.state:void 0,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p},t.id);if("list"===o)return this.isInFrameWhenSidePeekOpenStore.state&&!this.collectionContextStore.isInHomeWidgetStore.state&&(h={...h,paddingRight:24}),(0,C.jsx)(Ga,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p},t.id);if("gallery"===o)return(0,C.jsx)(jn,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...h,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,isRootChild:p},t.id);if("timeline"===o)return(0,C.jsx)(im,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isRootChild:p,isInPeekRenderer:d,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:u,showHoverActionsStore:this.showHoverActionsStore,ref:this.timelineViewRef,...h},t.id);if("form_editor"===o)return(0,xa.eC)()?(0,C.jsx)(ro.M3,{collectionContextStore:l,headingWidth:this.headerSizeObserver.rect.state.width,...h},t.id):(0,C.jsx)("div",{style:{...h},children:"Forms not enabled"});if("chart"===o){if(!this.isChartEnabledStore.state){const e=t.getChartType();return(0,C.jsx)("div",{style:{...h},children:"placeholder"!==e&&(0,C.jsx)(zg.f,{chartType:e,showCopy:c})})}return(0,C.jsx)(ro.vO,{collectionContextStore:l,headingWidth:this.headerSizeObserver.rect.state.width,...h},t.id)}}}renderNoSourcePlaceholder(e){const t=this.isFullScreen(),o=this.collectionContextStore.permissionScopesStore.state,r={style:{...this.leftRightPaddingStore.state,paddingBottom:t?void 0:this.getPaddingBottom(e)},icon:v({height:48,fill:this.theme.lightIconColor,margin:"0 auto"})};if(!o.canConfigureBlock)return(0,C.jsx)(Ss,{title:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"No data source",id:"collectionViewBlock.noSourcePlaceholder.title"}),description:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"This block is not connected to any data source.",id:"collectionViewBlock.noSourcePlaceholder.description"}),...r});const i="linked"===this.collectionContextStore.getCollectionViewBlockSourceState()||"chart"===e;return(0,C.jsx)(Ss,{title:e?(0,C.jsx)(P.FormattedMessage,{defaultMessage:"New {viewType}",id:"database.viewSettings.createView.newViewType",values:{viewType:It.Bh[e].toLocaleLowerCase()}}):(0,C.jsx)(P.FormattedMessage,{defaultMessage:"New view",id:"database.viewSettings.createView.newView"}),buttonText:i?(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Link a database",id:"collectionViewBlock.linkDatabase"}):(0,C.jsx)(P.FormattedMessage,{defaultMessage:"Link or create a database",id:"collectionViewBlock.linkOrCreateDatabase"}),buttonOnClick:this.handleSetSourceClick,...r})}renderNoSourceExternalCollectionPlaceholder(e){var t;const o=this.isFullScreen(),r=this.collectionContextStore.permissionScopesStore.state,i=this.collectionContextStore.settingsStore.state.open,n={display:"inline",padding:"1px 2px",borderRadius:4,textDecoration:"underline"},s=this.getExternalIntegrationIdStore.state,l=gl.Z.integrations.state.find((e=>e.id===s)),a=!(this.environment.device.isMobileBrowser&&this.isPlaceholderExternalCollectionStore.state&&!this.isUserAuthenticated());if(l)return(0,C.jsx)("div",{style:{...this.leftRightPaddingStore.state,paddingTop:8,paddingBottom:o?void 0:this.getPaddingBottom(e),height:250,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,C.jsxs)("div",{style:{paddingRight:i?tc.nJ:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,C.jsx)(Xt.Z,{icon:null===(t=this.collectionContextStore.collectionStore())||void 0===t?void 0:t.getIcon(),size:48,disabled:!0,isEmptyPage:!1}),(0,C.jsx)("div",{style:{fontSize:17,fontWeight:j.Z.fontWeight.medium,color:this.theme.lightTextColor,textAlign:"center",marginBottom:-2},children:(0,C.jsx)(P.FormattedMessage,{defaultMessage:"{integrationName}",id:"collectionViewBlock.setExternalSource.title",values:{integrationName:l.name}})}),r.canConfigureBlock&&(0,C.jsx)("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,textAlign:"center",color:this.theme.lightTextColor},children:a&&(0,C.jsx)(P.FormattedMessage,{defaultMessage:"<button>Link to {integrationName}</button> to continue",id:"collectionViewBlock.setExternalSourceButton.title",values:{integrationName:l.name,button:e=>(0,C.jsx)(xe.Z,{style:n,onClick:this.handleSetSourceClick,children:e})}})})]})})}renderLoadingSpinner(){const e=this.collectionContextStore.shouldShowSpinnerStore.state;return(0,C.jsx)(vp.Z,{show:e,...ae.Mq,render:e=>e?(0,C.jsx)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column",marginRight:4},children:(0,C.jsx)(be.Z,{style:{width:14,height:14}})}):void 0},"loading-spinner")}renderBottomBorderForViewSettings(){const{collectionContextStore:e}=this;if(e.settingsStore.state.open&&"sidebar"===this.stores.viewSettingsPlacementStore.state)return(0,C.jsx)("div",{style:{...this.leftRightPaddingStore.state,...this.leftRightMarginStore.state,borderTop:`1px solid ${this.theme.tableDividerColor}`,height:12}})}renderMultiSelectToolbar(){if((0,ae.fk)({environment:this.environment,collectionContextStore:this.collectionContextStore})){var e;const t=(null===(e=this.leftRightPaddingStore.state)||void 0===e?void 0:e.paddingLeft)??0,o=this.leftRightMarginStore.state.marginLeft??0;return(0,C.jsx)(ef,{marginLeft:t+o})}}unsubscribeAll(){for(const e of this.subscriptions.values())e.unsubscribe();this.collectionTypeChangeSubscription&&this.collectionTypeChangeSubscription.unsubscribe()}resetFrozoneStore(e){var t,o;if(this.isInHomeWidgetStore.state)return;const r=null===(t=this.horizontalScrollerEl)||void 0===t?void 0:t.stores.store.state.clientWidth,i=this.collectionContextStore.normalizedFormatStore.state;this.collectionContextStore.frozoneStore.setState({isScrolled:!1,scrollerWidth:r,scrollerLeftOffset:(null===(o=this.horizontalScrollerEl)||void 0===o||null===(o=o.stores.store.state.clientRect)||void 0===o?void 0:o.left)??0,scrollerLeftPadding:this.scrollerLeftPaddingStore.state,frozenIndex:null==e?void 0:e.getTableFrozenColumnIndex(r,i),tryShowHiddenFrozenColumn:!1})}isCollectionViewOfExternalCollectionWithoutExternalObjectId(){var e;const t=null===(e=this.getCollectionStore())||void 0===e?void 0:e.getValue();return Boolean(t&&(0,h.Ev)(t))}isUserAuthenticated(){const e=this.collectionContextStore.collectionStore();if(!e)return!1;const t=e.getFormat().integration_id,o=gl.Z.integrations.state.find((e=>e.id===t));return!(!t||!o)&&(0,sg.NP)(t).length>0}getViewStores(){const{store:e}=this.props;return e.getCollectionViewStores()}getCurrentCollectionViewStore(){return this.collectionContextStore.collectionViewStore()}getDefaultCollectionViewStore(){var e;const t=this.getViewStores();if(null!==(e=t[0])&&void 0!==e&&e.isDefined())return t[0]}getCollectionStore(){return this.collectionContextStore.collectionStore()}getMinWidth(){const{store:e}=this.props,{device:t}=this.environment,o=t.isPhone,r=this.isFullScreen(),i=this.getCurrentViewType(),n=("gallery"===i||("calendar"===i||"list"===i)&&r)&&this.isInFrameWhenSidePeekOpenStore.state,s=(0,uu.ll)(this.environment,this.isInPeekRenderer()),l=Qe.default.state;return this.collectionContextStore.isInHomeWidgetStore.state?void 0:r||this.isRootOrDirectChild()?o?`calc(100% - ${2*(0,ge.ui)(this.environment)}px - ${s}px)`:this.isInPeekRenderer()?`calc(100% - ${2*Qe.PeekModePadding.horizontal[l.mode]}px - ${s}px)`:this.isInFrameWhenSidePeekOpenStore.state?(0,uu.$3)(this.environment)+(n?(0,uu.vJ)(this.environment):0):r?`calc(100% - ${2*(0,ge.CP)(this.environment)}px - ${s}px)`:(0,ae._5)(e)?`calc(100% - ${2*(0,ge.ui)(this.environment)}px - ${s}px)`:vm.zL-2*(0,ge.ui)(this.environment)-s:`calc(100% - ${s}px)`}isInPeekRenderer(){return(0,ae.en)(this.props.store)}getBlockPropertyValueOverlayStore(){return this.isInPeekRenderer()?xg.Z:Cg.Z}resetLeftScrollAfterFlush(){l.default.afterNextFlush((()=>{var e;const t=null===(e=this.horizontalScrollerEl)||void 0===e?void 0:e.scrollerEl();if(t){t.scrollLeft=0;const e=Xo.xH(t);e&&(e.scrollLeft=0)}}))}isFullScreen(){return Boolean(this.props.isFullScreen)}getDefaultResults(){const e=this.collectionContextStore.localResultStore.state,t=this.getCollectionStore();if(t&&e&&"reducer"===e.type){const o=R.sE(e.reducerResults,(e=>"results"===e.type));if(o)return o.blockIds.map((e=>Ye.G.createChildStore(t,{id:e,table:_.iU})))}return[]}getCurrentViewTypeOrUndefined(){var e;const{collectionContextStore:t}=this;return this.props.overrideViewType??(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType())}getCurrentViewType(){const e=this.getCurrentViewTypeOrUndefined();if(!e)throw new Error("View type was not defined.");return e}getNoDateProperty(){const e=this.collectionContextStore.collectionViewStore(),t=this.collectionContextStore.normalizedQueryStore.state;if(!e||!t)return;const o=this.getCurrentViewType();return"timeline"===o&&t.timeline_by?t.timeline_by:"calendar"===o&&t.calendar_by?t.calendar_by:void 0}ensureStoreListeners(){const{collectionContextStore:e}=this,{store:t}=this.props;e.blockIsPrivateStore.state;for(const o of t.getCollectionViewStores())o.getValue()}getScrollerStyle(e,t,o){const{store:r}=this.props,i=this.isFullScreen(),n=this.isRootOrDirectChild(),s=this.leftRightPaddingStore.state,l=this.getPaddingBottom(e),a=this.collectionContextStore.settingsStore.state.open,c=this.collectionContextStore.isInHomeWidgetStore.state&&this.collectionContextStore.isEditableHomeCollectionStore.state;return{flexGrow:1,flexShrink:0,...r.isNonEditableState()&&{cursor:"default"},..."timeline"===e&&this.collectionContextStore.collectionStore()&&!i&&!(0,Qi.fj)({environment:this.environment,isFullScreen:i,isRootChild:n,format:t})&&s&&{marginLeft:s.paddingLeft,marginRight:s.paddingRight,marginBottom:l},...a&&!i&&"sidebar"===this.stores.viewSettingsPlacementStore.state&&{minHeight:tc.j9},...c?{paddingRight:8,paddingLeft:"list"===e?8:16}:{},...this.isInHomeWidgetStore.state&&!this.shouldRenderCompactViewVerticalScrollerStore.state?{maxHeight:"inherit"}:{},...this.isTasksEmptyStore.state||this.isCustomDBEmptyStore.state||!this.shouldRenderCompactViewVerticalScrollerStore.state?{height:"100%"}:{},...this.isInFrameWhenSidePeekOpenStore.state&&"timeline"!==e&&!this.isInHomeWidgetStore.state?{position:"sticky",left:0,paddingLeft:o,width:(0,uu.$3)(this.environment)}:{},..."chart"===e&&this.isInFrameWhenSidePeekOpenStore.state&&!this.isInHomeWidgetStore.state?{paddingLeft:o}:{},..."page"===e?{zIndex:M.y}:{}}}getPaddingBottom(e){return this.props.isFullScreen?"timeline"===e?96:Qf:"timeline"===e||"gallery"===e?0:Lr.Z.state}getHeaderWrapStyle(){const{hideHeader:e,fullWidth:t}=this.props,o=this.leftRightPaddingStore.state,r=(0,uu.$3)(this.environment),i=(0,ae._5)(this.props.store)||this.isFullScreen()?r:Math.min(vm.zL,r),n=this.isInFrameWhenSidePeekOpenStore.state&&!Qe.default.isSidePeekOpeningStore.state;return{minHeight:this.headerHeightStore.state,...this.isChartsNextEnabledStore.state?{paddingLeft:n?0:null==o?void 0:o.paddingLeft,paddingRight:null==o?void 0:o.paddingRight,width:t,position:"relative",left:-((null==o?void 0:o.paddingLeft)??0)}:{paddingLeft:null==o?void 0:o.paddingLeft,paddingRight:n?0:null==o?void 0:o.paddingRight},flexShrink:0,...(this.isFullScreen()||n)&&{position:"sticky",zIndex:86,left:0,width:n&&o?i-(o.paddingLeft/2??0):void 0},...this.props.store.isNonEditableState()&&{cursor:"default"},...this.leftRightMarginStore.state,...e?{opacity:0,height:0,minHeight:void 0,pointerEvents:"none"}:{}}}getHeaderStyle(){const{collectionContextStore:e}=this,t=this.getCurrentViewType(),o=e.viewIsFlushToTopbar(),r=("timeline"===t||"table"===t)&&o||this.collectionContextStore.isInHomeWidgetStore.state;return{display:"flex",alignItems:"center",height:this.headerHeightStore.state,boxShadow:r?void 0:`inset 0 -1px 0 ${this.theme.tableDividerColor}`,...this.getHeaderPositioningStyle()}}getHeaderPositioningStyle(){const e=this.leftRightPaddingStore.state;return{left:null==e?void 0:e.paddingLeft,paddingLeft:this.isInHomeWidgetStore.state?ug.pW:void 0,width:"100%"}}getSearchInputStyle(){return{fontSize:14,lineHeight:1,paddingRight:4,color:this.theme.regularTextColor,marginBottom:1}}getTopbarActionButtonStyle(e){return{display:"flex",alignItems:"center",fontSize:14,height:28,padding:6,color:e?this.theme.blueColor:this.theme.mediumIconColor,fontWeight:j.Z.fontWeight.regular,lineHeight:1,borderRadius:4}}getTopbarIconButtonStyle(){return(0,Wf.C)({theme:this.theme,isInHomeWidget:this.collectionContextStore.isInHomeWidgetStore.state})}shouldShowProjManagementTooltipTour(){return this.canShowPmIntroTooltipStore.state}projManagementTooltipTourAssignToSomeone(){const e=uo.default.state.currentUserSettingsStore,t=uo.default.state.currentSpaceStore;e&&t&&$.uR({environment:this.environment,requiredCurrPhase:"create_a_task",nextPhase:"assign_to_someone",currentUserSettingsStore:e,currentSpaceStore:t})}trackRenderTime(e){let{isFirstRender:t}=e;const o=qe.default.mark("collections.collection_view_block_render");qe.default.measureAfterNextFlush(o,{environment:this.environment,getData:()=>({...Ke.vS(this.collectionContextStore),is_first_render:t})})}trackSwitchViewLag(){if(!this.switchViewMetric)return;const{from:e,to:t,metric:o,sizeHintAtStart:r}=this.switchViewMetric;qe.default.measureAfterNextFlush(o,{environment:this.environment,getData:()=>{const o=Ke.vS(this.collectionContextStore),{view_type:i,row_count_category:n,...s}=o;return{from:e,to:t,did_trigger_fetch:this.collectionContextStore.isLoadingStore.state,row_count_category:Ke.ZO(r),...s}}}),this.switchViewMetric=void 0}}Jf.displayName="CollectionViewBlock",Jf.contextTypes={...yi.wK,...s.w};class eC extends s.Z{componentDidCatch(e){throw O.vd("collections"),e}renderComponent(){const{collectionViewBlockRef:e,...t}=this.props;return(0,C.jsx)(Jf,{...t,ref:e})}}const tC=i.forwardRef(((e,t)=>(0,C.jsx)(eC,{...e,collectionViewBlockRef:t}))),oC=Jf;function rC(e){return"page"===e?"page_view":e}},888077:(e,t,o)=>{o.d(t,{C:()=>i});var r=o(137810);function i(e){const{theme:t,isInHomeWidget:o}=e;return{display:"flex",alignItems:"center",fontSize:14,padding:6,...o?{height:24,width:24,color:t.lightTextColor,fill:t.lightIconColor}:{height:28,width:28,color:t.mediumIconColor,fill:t.mediumIconColor},fontWeight:r.Z.fontWeight.regular,lineHeight:1,borderRadius:4}}},595550:(e,t,o)=>{o.d(t,{G:()=>a});o(667294);var r=o(886628),i=o(724405),n=o(566890),s=o(636596),l=o(785893);function a(e){const{widthPercentage:t}=e,o=(0,n.DK)(),a=(0,r.VK)((()=>null==o?void 0:o.isInHomeWidgetStore.state),[o]),c=(0,i.yK)((e=>({rowContainer:{display:"flex",height:30,alignItems:"center",gap:1,alignSelf:"stretch"},circleShimmer:{width:a?12:16,height:a?12:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:t||"35%",height:10,flexShrink:0,borderRadius:12,marginLeft:2,backgroundColor:e.lightDividerColor},column:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,flex:"1 0 0"}})),[t,a]);return(0,l.jsx)("div",{style:c.rowContainer,children:(0,l.jsxs)("div",{style:c.column,children:[(0,l.jsx)(s.Z,{style:c.circleShimmer}),(0,l.jsx)(s.Z,{style:c.rowShimmer})]})})}},458493:(e,t,o)=>{o.d(t,{Z:()=>k});var r=o(667294),i=o(800480),n=o(886628),s=o(724405),l=o(16184),a=o(745238),c=o(785893);const d=(0,a.IU)("mobileLocked",{viewBox:"0 0 26 26",svg:(0,c.jsx)("path",{d:"M7.88672 23.417H18.1133C19.499 23.417 20.1758 22.7295 20.1758 21.2256V13.3408C20.1758 11.9873 19.6172 11.2891 18.4678 11.1709V8.46387C18.4678 4.41406 15.8145 2.45898 13 2.45898C10.1855 2.45898 7.53223 4.41406 7.53223 8.46387V11.2246C6.47949 11.3857 5.82422 12.0732 5.82422 13.3408V21.2256C5.82422 22.7295 6.50098 23.417 7.88672 23.417ZM9.26172 8.23828C9.26172 5.54199 10.9912 4.11328 13 4.11328C15.0088 4.11328 16.7383 5.54199 16.7383 8.23828V11.1602L9.26172 11.1709V8.23828Z"})}),u=(0,a.IU)("mobileUnlocked",{viewBox:"0 0 32 26",svg:(0,c.jsx)("path",{d:"M7.89355 23.417H18.1094C19.4951 23.417 20.1826 22.7295 20.1826 21.2256V13.3408C20.1826 12.0303 19.6562 11.332 18.582 11.1816V8.23828C18.582 5.54199 20.3115 4.11328 22.3203 4.11328C24.3291 4.11328 26.0586 5.54199 26.0586 8.23828V10.623C26.0586 11.2783 26.4346 11.6006 26.9287 11.6006C27.4014 11.6006 27.7881 11.3105 27.7881 10.623V8.46387C27.7881 4.41406 25.1348 2.45898 22.3203 2.45898C19.5059 2.45898 16.8525 4.41406 16.8525 8.46387V11.1602L8.1084 11.1816C6.72266 11.1816 5.82031 11.8584 5.82031 13.3408V21.2256C5.82031 22.7295 6.50781 23.417 7.89355 23.417Z"})}),p=(0,a.IU)("unlockedFilled",{viewBox:"0 0 16 16",svg:(0,c.jsx)("path",{d:"M2.33301 14.6338H8.94336C9.85938 14.6338 10.3105 14.1826 10.3105 13.1914V8.08496C10.3105 7.2168 9.95508 6.75195 9.24414 6.65625V4.83105C9.24414 3.22461 10.2627 2.35645 11.4863 2.35645C12.71 2.35645 13.7354 3.22461 13.7354 4.83105V6.28711C13.7354 6.76562 14.0156 7.01855 14.3848 7.01855C14.7471 7.01855 15.0273 6.7793 15.0273 6.28711V4.96094C15.0273 2.36328 13.2979 1.1123 11.4863 1.1123C9.6748 1.1123 7.94531 2.36328 7.94531 4.96094V6.64258L2.44922 6.64941C1.5332 6.64941 0.96582 7.10742 0.96582 8.08496V13.1914C0.96582 14.1826 1.41699 14.6338 2.33301 14.6338Z"})});var h=o(519889),m=o(307928),S=o(709291),g=o(436610),f=o(496802),C=o(210228),v=o(592547),y=o(206258),x=o(164921),b=o(526388);const w={width:16,marginRight:4};const k=function(e){let{isMobile:t,store:o,disableTooltip:r,isInlineCollection:i,buttonStyle:s,lockStore:l}=e;const a=(0,n.qz)(l,v.Z);return t?(0,c.jsx)(j,{store:o,lockStore:a}):(0,c.jsx)(R,{store:o,disableTooltip:r,isMobile:t,isInlineCollection:i,buttonStyle:s,lockStore:a})};function T(e,t,o){return{display:"flex",alignItems:"center",whiteSpace:"nowrap",fontSize:e?12:14,borderRadius:4,padding:"0 6px",marginRight:2,height:24,marginTop:e?1:0,marginLeft:e?0:-5,...t&&{marginLeft:e?8:12,marginRight:0},...o}}function _(e,t,o,r,i){return{...T(e,r,i),color:o.lightTextColor,fill:o.lightIconColor}}function V(e,t,o,r,i){return{...T(e,r,i),paddingLeft:5,border:`1px solid ${o.blueColor}`,color:o.blueColor,fill:o.blueColor}}function O(e){let{store:t}=e;const o=(0,s.Fg)(),r=(0,n.VK)((()=>t.getFormat().block_locked_by),[t]),i=(0,S.useIntl)(),l=(0,n.VK)((()=>r&&(0,m.Nz)(i,y.t1.createChildStore(t,{table:h.KJ,id:r}).getModel())),[r,i,t]);return r?(0,c.jsx)("div",{children:(0,c.jsx)(S.FormattedMessage,{defaultMessage:"Locked by {lockedByPerson}{br}to prevent accidental editing.{br}<prompttext>Click to unlock</prompttext>",id:"pageLockIndicator.lockedTooltip",values:{lockedByPerson:(0,c.jsx)("b",{children:l}),br:(0,c.jsx)("br",{}),prompttext:e=>(0,c.jsx)("span",{style:{color:o.mediumInvertedTextColor},children:e})}})}):null}function M(e,t,o){C.createAndCommit({userAction:"PageLockTopbarIndicator.handleLockClick",environment:e,perform:o=>{f.Wq({environment:e,store:t,isLocked:!1,transaction:o})}}),o.setState({...o.state,justUnlocked:!0});const r=t.getType();if(r){var i;let o;t.isCollectionView()&&(o=t.getCollectionViewCollectionStore()),g.UJ(e,{from:"topbar",block_type:r,locked:!1,collection_id:null===(i=o)||void 0===i?void 0:i.id})}}function P(e,t,o){C.createAndCommit({userAction:"PageLockTopbarIndicator.handleUnlockClick",environment:e,perform:o=>{f.Wq({environment:e,store:t,isLocked:!0,transaction:o})}}),o.setState({...o.state,justUnlocked:!1});const r=t.getType();if(r){var i;let o;t.isCollectionView()&&(o=t.getCollectionViewCollectionStore()),g.UJ(e,{from:"topbar",block_type:r,locked:!0,collection_id:null===(i=o)||void 0===i?void 0:i.id})}}function R(e){let{store:t,disableTooltip:o,isMobile:a,isInlineCollection:d,buttonStyle:u,lockStore:h}=e;const m=(0,s.Fg)(),g=(0,i.O7)(),f=(0,r.useCallback)((()=>P(g,t,h)),[g,t,h]),C=(0,r.useCallback)((()=>M(g,t,h)),[g,t,h]),v=(0,n.VK)((()=>t.isLocked()),[t]),y=(0,n.VK)((()=>h.state.justUnlocked),[h]);return v?(0,c.jsx)(b.Z,{renderTooltip:()=>(0,c.jsx)(O,{store:t}),disableTooltip:o,render:e=>(0,c.jsxs)(x.Z,{style:_(a,0,m,d,u),onClick:C,...e,children:[(0,l.Q)(w),(0,c.jsx)("div",{style:{lineHeight:1},children:(0,c.jsx)(S.FormattedMessage,{defaultMessage:"Locked",id:"pageLockIndicator.lockedButton.label"})})]})}):y?(0,c.jsxs)(x.Z,{style:V(a,0,m,d,u),onClick:f,hoveredStyle:{background:m.outlineBlueButtonHoveredBackground},pressedStyle:{background:m.outlineBlueButtonPressedBackground},children:[p(w),(0,c.jsx)("div",{style:{lineHeight:1},children:(0,c.jsx)(S.FormattedMessage,{defaultMessage:"Re-lock",id:"pageLockIndicator.relockButton.label"})})]}):null}function j(e){let{store:t,lockStore:o}=e;const l=(0,s.Fg)(),a=(0,i.O7)(),p=(0,r.useCallback)((()=>P(a,t,o)),[a,t,o]),h=(0,r.useCallback)((()=>M(a,t,o)),[a,t,o]),m=(0,n.VK)((()=>t.isLocked()),[t]),{WindowSizeStore:g}=a,f=(0,n.VK)((()=>g.getSafePaddingLeftCSS(10)),[g]),C=(0,n.VK)((()=>g.getSafePaddingRightCSS(14)),[g]),v=(0,n.VK)((()=>o.state.justUnlocked),[o]);return m?(0,c.jsxs)(x.Z,{onClick:h,mobileFeedback:!0,style:{display:"flex",alignItems:"center",height:"100%",paddingLeft:f,paddingRight:C},children:[d({width:20,marginRight:6}),(0,c.jsx)("div",{children:(0,c.jsx)(S.FormattedMessage,{defaultMessage:"Locked",id:"pageLockIndicator.mobileLockedButton.label"})})]}):v?(0,c.jsxs)(x.Z,{onClick:p,mobileFeedback:!0,style:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:f,paddingRight:C,color:l.blueColor,fill:l.blueColor},children:[u({height:26,width:32,marginRight:6}),(0,c.jsx)("div",{children:(0,c.jsx)(S.FormattedMessage,{defaultMessage:"Re-lock",id:"pageLockIndicator.mobileRelockButton.label"})})]}):null}},167660:(e,t,o)=>{o.d(t,{f:()=>c});o(667294);var r=o(724405),i=o(709291),n=o(497372),s=o(132662),l=o(785893);function a(e){return"line"===e?"line-chart-loading":"donut"===e?"donut-chart-loading":"column-chart-loading"}function c(e){let{chartType:t,showCopy:o}=e;const c=(0,r.yK)((e=>({text:{color:e.accentColors.gray[200],fontSize:14},container:{color:"dark"===e.mode?e.accentColors.gray[500]:e.accentColors.gray[200],display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"100%",height:n.j9,position:"relative",top:-20}})),[]);return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:a(t),style:c.container,children:[(0,l.jsx)(d,{chartType:t}),o&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.Z,{size:8}),(0,l.jsx)("div",{style:c.text,children:(0,l.jsx)(i.FormattedMessage,{defaultMessage:"Preparing your chart",id:"charts.initialLoading"})})]})]})})}function d(e){let{chartType:t}=e;return"line"===t?(0,l.jsx)(p,{}):"column"===t||"bar"===t?(0,l.jsx)(u,{}):"donut"===t?(0,l.jsx)(h,{}):(0,l.jsx)(u,{})}function u(){return(0,l.jsxs)("svg",{width:"72",height:"72",viewBox:"0 0 72 72",fill:"none",children:[(0,l.jsx)("line",{className:"column-loader-1",x1:"11",y1:"35",x2:"11",y2:"53",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round"}),(0,l.jsx)("line",{className:"column-loader-2",x1:"24",y1:"19",x2:"24",y2:"53",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round"}),(0,l.jsx)("line",{className:"column-loader-3",x1:"63",y1:"25",x2:"63",y2:"53",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round"}),(0,l.jsx)("line",{className:"column-loader-4",x1:"37",y1:"29",x2:"37",y2:"53",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round"}),(0,l.jsx)("line",{className:"column-loader-5",x1:"50",y1:"35",x2:"50",y2:"53",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round"})]})}function p(){return(0,l.jsx)("svg",{width:"72",height:"72",viewBox:"0 0 72 72",fill:"none",children:(0,l.jsx)("path",{d:"M4 54L10.7601 43.0148C11.4087 41.9609 12.8491 41.743 13.7804 42.5579L18.1597 46.3898C19.1109 47.2221 20.5861 46.9743 21.2132 45.8769L25.9913 37.5152C26.8134 36.0765 28.9281 36.2042 29.5711 37.7313L34.0639 48.4018C34.7639 50.0644 37.1339 50.0234 37.7761 48.3376L43.794 32.5408C43.9286 32.1875 44.1605 31.8796 44.463 31.6528L50.6123 27.0408C51.4086 26.4436 52.5228 26.5228 53.2265 27.2265L58.0379 32.0379C59.0032 33.0032 60.6305 32.7391 61.241 31.5181L68 18",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"})})}function h(){return(0,l.jsxs)("svg",{width:"72",height:"72",viewBox:"0 0 72 72",fill:"none",children:[(0,l.jsx)("circle",{className:"outer-loader",cx:"36",cy:"36",r:"24",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"}),(0,l.jsx)("circle",{className:"inner-loader",cx:"36",cy:"36",r:"12",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"})]})}},971424:(e,t,o)=>{o.d(t,{EZ:()=>i,FD:()=>n,G5:()=>r,rK:()=>s});const r=220,i=24,n=-7,s=-3},840863:(e,t,o)=>{o.d(t,{$G:()=>n,AN:()=>l,du:()=>i});o(757658);var r=o(730120);function i(e){const t=r.ou.fromMillis(e.startUnixTimestampMS),o=e.endUnixTimestampMS?r.ou.fromMillis(e.endUnixTimestampMS):void 0,i=r.ou.fromMillis(e.startOfWeekUnixTimestampMS),n=r.ou.fromMillis(e.endOfWeekUnixTimestampMS),s=t.startOf("day"),l=r.ou.max(i,s),a=Math.ceil(l.diff(i,"days").get("days"));let c=1;if(o){const e=o.endOf("day"),t=r.ou.min(n,e);c=Math.ceil(t.diff(l,"days").get("days"))}return{start:t,end:o,startOfWeek:i,endOfWeek:n,startColumn:a,columnCount:c}}function n(e){const t=(null==e?void 0:e.attendees)||[];return e.hasParticipants&&t.filter((e=>!e.self&&!e.resource)).every((e=>"declined"===e.responseStatus))}const s={upcomingMinsThreshold:10,startingMinsThreshold:5,startedMinsThreshold:15};function l(e){const t=e.filter((e=>{var t;if(!e.conferencing)return!1;return!function(e){if("declined"===e)return!0;return!1}((null===(t=e.attendees)||void 0===t?void 0:t.find((e=>e.self)))?e.responseStatus??"accepted":"accepted")&&!e.isAllDay}));if(0===t.length)return;const{upcomingMinsThreshold:o,startingMinsThreshold:i,startedMinsThreshold:n}=s,l=[],c=[],d=[],u=[],p=[];for(const s of t){if(s.isAllDay)continue;const e=a(s),t=r.ou.now(),h=e.start.diff(t,"minutes").minutes;h>=0&&h<=o?l.push(s):-h>=i?d.push(s):-h>=n?u.push(s):e.contains(t)?c.push(s):p.push(s)}return[...l,...d,...u,...c,...p][0]}function a(e){const t=r.ou.fromISO(e.start.dateTime,{zone:e.start.timeZone}),o=r.ou.fromISO(e.end.dateTime,{zone:e.end.timeZone});return r.Xp.fromDateTimes(t,o)}},425498:(e,t,o)=>{o.d(t,{m:()=>n,w:()=>s});o(757658);var r=o(954061),i=o(798165);const n=[{frequency:"day",interval:1},{frequency:"week",interval:1},{frequency:"month",interval:1},{frequency:"year",interval:1}];function s(e){const t=i.qA(e)??[],o=[];for(const r of t){if(!("block"===r.table&&!0===r.isTemplate()&&r.getFormat().automation_id&&r.id!==e.id))continue;const t=r.getAutomationStore();if(t){if(!t.isReady())return{automationStoresReady:!1};void 0!==t.getRecurrence()&&t.isDefined()&&o.push(t.getModel())}}return{automationStoresReady:!0,...(0,r.templateAncestorsViolateRecurrenceNesting)(o)}}},235599:(e,t,o)=>{o.d(t,{Z:()=>c});var r=o(667294),i=o(724405),n=o(586432),s=o(619584),l=o(296994),a=o(277907);function c(e){const t=(0,a.XJ)(l.FF.calendarDateIcons),o=function(){const[e,t]=(0,r.useState)(new Date),o=(0,r.useRef)();return(0,r.useEffect)((()=>{const r=()=>{const o=new Date;o.getDate()!==e.getDate()&&t(o)},i=new Date,n=new Date(i);n.setHours(i.getHours()+1),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0);const l=n.getTime()-i.getTime(),a=setTimeout((()=>{r(),o.current=window.setInterval(r,s.U6)}),l);return()=>{clearTimeout(a),clearInterval(o.current)}}),[e]),e}(),c=e.dateNumber??o.getDate(),d=(0,i.yK)((t=>({icon:{width:16,height:16,color:t.mediumIconColor,...e.style}})),[e.style]),u=(0,r.useCallback)((e=>{if(e<1||e>31)return(0,n.s)(d.icon);if("resolved"!==t.status)return(0,n.s)(d.icon);const o=`calendarDate${e<10?`0${e}`:`${e}`}Icon`;return(0,t.value[o])(d.icon)}),[d,t]);return u(c)}},592547:(e,t,o)=>{o.d(t,{Z:()=>n});var r=o(749085);class i extends r.default{getInitialState(){return{justUnlocked:!1}}}const n=i},755061:(e,t,o)=>{o.d(t,{$2:()=>ce,Bg:()=>le,P6:()=>B,Qs:()=>L,W9:()=>ie,Wy:()=>oe,XW:()=>E,_2:()=>J,_u:()=>re,c_:()=>ne,gt:()=>X,iR:()=>U,jQ:()=>ae,kU:()=>ee,oP:()=>Z,pF:()=>se,qJ:()=>N,rn:()=>G,sn:()=>H,tA:()=>$,v4:()=>te,xS:()=>A});o(757658);var r=o(709291),i=o(653965),n=o(401898),s=o(619584),l=o(266897),a=o(53196),c=o(541432),d=o(715070),u=o(435011),p=o(399036),h=o(180951),m=o(640506),S=o(407057),g=o(406695),f=o(238297),C=o(522808),v=o(959753),y=o(186517),x=o(882883),b=o(458129),w=o(798963),k=o(421202),T=o(177420),_=o(606287),V=o(815047),O=o(429369),M=o(519889),P=o(399108),R=o(76233),j=o(307928),I=o(970693),F=o(604308);const N=(0,r.defineMessages)({defaultPluralizedUserNames:{defaultMessage:"Someone",id:"pushNotification.pluralizedUserNames.defaultLabel"},defaultPermissionGroupName:{defaultMessage:"Deleted group",id:"pushNotification.permissionGroupName.defaultLabel"},defaultPageName:{defaultMessage:"a Notion page",id:"pushNotification.pageName.defaultLabel"},untitledPermissionGroupName:{defaultMessage:"Untitled group",id:"pushNotification.permissionGroupName.untitledLabel"},userEditedPermissionGroup:{defaultMessage:"{userName} edited {permissionGroupName}",id:"pushNotification.userEditedTarget.label"},userDeletedPermissionGroup:{defaultMessage:"{userName} deleted {permissionGroupName}",id:"pushNotification.userDeletedTarget.label"},userCreatedPermissionGroup:{defaultMessage:"{userName} created {permissionGroupName}",id:"pushNotification.userCreatedTarget.label"},unknownAuthor:{defaultMessage:"Unknown author",id:"pushNotification.authorPhrase.unknown"},untitledSpaceName:{defaultMessage:"Untitled",id:"pushNotification.untitledSpaceName.label"},untitledTeamName:{defaultMessage:"Untitled",id:"pushNotification.untitledTeamName.label"},untitledCollectionName:{defaultMessage:"Untitled",id:"pushNotification.untitledCollectionName.placeholder"},untitledBlockTitle:{defaultMessage:"Untitled",id:"pushNotification.untitledBlockTitle.placeholder"},twoUserNames:{defaultMessage:"{firstAuthor} and {secondAuthor}",id:"pushNotification.twoUserNames.label"},threePlusUserNames:{defaultMessage:"{othersCount, plural, one {{firstAuthor} and {othersCount} other} other {{firstAuthor} and {othersCount} others}}",id:"pushNotification.threePlusUserNames.label"},editorPermissionLabel:{defaultMessage:"Full access",id:"pushNotifications.editorPermissionLevel.label"},readerPermissionLabel:{defaultMessage:"Read only",id:"pushNotifications.readerPermissionLevel.label"},editOnlyPermissionLabel:{defaultMessage:"Edit only",id:"pushNotifications.editOnlyPermissionLevel.label"},editPermissionLabel:{defaultMessage:"Edit",id:"pushNotifications.editPermissionLevel.label"},commentOnlyPermissionLabel:{defaultMessage:"Comment only",id:"pushNotifications.commentOnlyPermissionLevel.label"},noAccessPermissionLabel:{defaultMessage:"No access",id:"pushNotifications.noAccessPermissionLevel.label"},publicPermissionRoleLabel:{defaultMessage:"Public ({permissionLevel})",id:"pushNotifications.publicPermissions.label"},userNameWithRole:{defaultMessage:"{userName} ({permissionLevel})",id:"pushNotifications.userPermissionsWithRole.label"},botNameWithRole:{defaultMessage:"{botName} ({permissionLevel})",id:"pushNotifications.botPermissionsWithRole.label"},spaceNameWithRole:{defaultMessage:"{spaceName} ({permissionLevel})",id:"pushNotifications.spacePermissionsWithRole.label"},imageInPushNotification:{defaultMessage:"{imageEmoji} Image",id:"pushNotification.imageInPushNotification.placeholder"},topLevelBlockCreated:{defaultMessage:"{userName} created {targetName} in {spaceName}",id:"pushNotification.userCreatedBlockInSpace.message"},topLevelBlockDeleted:{defaultMessage:"{userName} deleted {targetName} in {spaceName}",id:"pushNotification.userDeletedBlockInSpace.message"},collectionRowCreated:{defaultMessage:"{userName} created {targetName} in {collectionName}",id:"pushNotification.userCreatedRowInCollection.message"},collectionRowDeleted:{defaultMessage:"{userName} deleted {targetName} in {collectionName}",id:"pushNotification.userDeletedRowInCollection.message"},emptyBlockEditedProperty:{defaultMessage:"Empty",id:"pushNotification.emptyBlockPropertyValueEdited.placeholderLabel"},propertyNameAndValueEdited:{defaultMessage:"{propertyName} ({propertyValue})",id:"pushNotification.propertyNameWithEditedValue.notificationSubject"},propertyNameAndValueNotificationBody:{defaultMessage:"{propertyName} ({propertyValue})",id:"pushNotification.propertyNameWithEditedValue.notificationBody"},blockDeletedEditBody:{defaultMessage:"[Deleted] {renderedBlock}",id:"pushNotification.deletedBlock.notificationContents"},blockEditedNotification:{defaultMessage:"{userName} edited {blockName}",id:"pushNotification.blockEdited.notificationSubject"},blockPropertyEditedNotification:{defaultMessage:"{userName} edited {blockName}",id:"pushNotification.blockPropertyEdited.notificationSubject"},mobileBlockPropertyEditedNotification:{defaultMessage:"{userName} edited",id:"pushNotification.mobileBlockPropertyEdited.notificationSubject"},userEditedPermissionsFor:{defaultMessage:"{userName} edited permissions for {targetName}",id:"pushNotifications.permissionsEditedForPageOrSpace.notificationSubject"},userMentionedIn:{defaultMessage:"{userName} mentioned you in {targetName}",id:"pushNotifications.userMentionedInPage.notificationSubject"},mobileUserMentionedIn:{defaultMessage:"{userName} mentioned you",id:"pushNotifications.mobileUserMentionedInPage.notificationSubject"},permissionGroupMentionedIn:{defaultMessage:"{userName} mentioned {groupName} in {targetName}",id:"pushNotifications.groupMentionedInPage.notificationSubject"},userDeletedComment:{defaultMessage:"[Deleted]💬 {commentText}",id:"pushNotifications.userDeletedCommentText.notificationContents"},userCommentedSubject:{defaultMessage:"{userName} commented in {targetName}",id:"pushNotifications.userCommentedSubject.notificationSubject"},userSuggestedSubject:{defaultMessage:"{userName} suggested in {targetName}",id:"pushNotifications.userSuggestedSubject.notificationSubject"},mobileUserCommentedSubject:{defaultMessage:"{userName} commented",id:"pushNotifications.mobileUserCommentedSubject.notificationSubject"},mobileUserSuggestedSubject:{defaultMessage:"{userName} commented",id:"pushNotifications.mobileUserSuggestedSubject.notificationSubject"},userAddedToSpace:{defaultMessage:"{userName} added you to {workspaceName}",id:"pushNotifications.userAddedToSpace.notificationSubject"},userInvitedToSpace:{defaultMessage:"{userName} invited you to {workspaceName}",id:"pushNotifications.userInvitedToSpace.notificationSubject"},userInvitedToSpaceByBot:{defaultMessage:"You have been invited to {workspaceName}",id:"pushNotifications.userInvitedToSpaceByBot.notificationSubject"},userEditedCollectionSubject:{defaultMessage:"{userName} edited {collectionName}",id:"pushNotifications.collectionEdited.notificationSubject"},userCreatedCollectionSubject:{defaultMessage:"{userName} created {collectionName}",id:"pushNotifications.collectionCreated.notificationSubject"},collectionDescriptionDeleted:{defaultMessage:"{userName} deleted the description for {collectionName}",id:"pushNotifications.collectionDescriptionDeleted.notificationSubject"},collectionDescriptionCreated:{defaultMessage:"{userName} added a description for {collectionName}",id:"pushNotifications.collectionDescriptionAdded.notificationSubject"},untitledCollectionView:{defaultMessage:"Untitled",id:"pushNotifications.untitledCollection.label"},collectionViewEditedSubject:{defaultMessage:"{userName} edited view {collectionViewName} in {collectionName}",id:"pushNotifications.collectionViewEdited.notificationSubject"},collectionPropertyEditedUnknown:{defaultMessage:"Unknown",id:"pushNotifications.unknownCollectionPropertyName.label"},collectionPropertyEditedSubject:{defaultMessage:"{userName} edited property {propertyType} in {collectionName}",id:"pushNotifications.collectionPropertyEdited.subject"},reminderSubject:{defaultMessage:"Reminder in {pageName}",id:"pushNotifications.reminderChanged.subject"},pageLockedActivity:{defaultMessage:"{userName} locked {pageName}",id:"pushNotifications.pageLocked.subject"},pageUnlockedActivity:{defaultMessage:"{userName} unlocked {pageName}",id:"pushNotifications.pageUnlocked.subject"},emailEditedActivity:{defaultMessage:"{userName} edited their account settings",id:"pushNotifications.emailAccountSettingsEdited.subject"},emptyPropertyBody:{defaultMessage:"Empty",id:"pushNotifications.emptyPropertyValueInCollection.label"},unknownRelationValueChange:{defaultMessage:"Unknown",id:"pushNotifications.unknownRelationPropertyChanged.label"},unknownAuthorInPropertySchemaChange:{defaultMessage:"Unknown author",id:"pushNotifications.unknownAuthorUpdatedProperty.label"},accessRequestedSubject:{defaultMessage:"{userName} requested access to {pageName}",id:"pushNotifications.accessRequested.subject"},editAccessRequestedSubject:{defaultMessage:"{userName} requested edit access to {pageName}",id:"pushNotifications.editAccessRequested.subject"},accessRequestResolvedApprovedSubject:{defaultMessage:"Your request to invite {guestEmail} to {pageName} has been approved",id:"pushNotifications.accessRequestResolved.approved.subject"},accessRequestResolvedRejectedSubject:{defaultMessage:"Your request to invite {guestEmail} to {pageName} has been rejected",id:"pushNotifications.accessRequestResolved.subject"},membershipRequestedSubject:{defaultMessage:"{userName} requested to add a new member to {workspaceName}",id:"pushNotifications.membershipRequested.subject"},guestInviteRequestedSubject:{defaultMessage:"{userName} requested to invite a guest to {workspaceName}",id:"pushNotifications.guestInviteRequested.subject"},blockFormatEditPageIconName:{defaultMessage:"Page Icon",id:"pushNotifications.formatChange.pageIcon.label"},pageIconImagePlaceholder:{defaultMessage:"Image",id:"pushNotifications.formatChange.pageIcon.imagePlaceholder"},pageDeletedActivity:{defaultMessage:"{userName} deleted {pageName}",id:"pushNotifications.pageDeleted.subject"},pageRestoredActivity:{defaultMessage:"{userName} restored {pageName}",id:"pushNotifications.pageRestored.subject"},pagePermanentlyDeletedActivity:{defaultMessage:"{userName} permanently deleted {pageName}",id:"pushNotifications.pagePermanentlyDeleted.subject"},userInvitedToTeam:{defaultMessage:"{userName} invited you to {teamName}",id:"pushNotifications.userInvitedToTeam.notificationSubject"},privateContentTransferred:{defaultMessage:"{author} transferred private content from {fromUserName} to you: {pageName}",id:"pushNotifications.privateContentTransferred.notificationSubject"},verificationExpired:{defaultMessage:"Verification expired for {pageName}",id:"pushNotifications.verificationExpired.notificationSubject"},importSuccessful:{defaultMessage:"Your {importSource} import was successful",id:"pushNotifications.importCompleted.notificationSubject"},importFailed:{defaultMessage:"Your {importSource} import has failed",id:"pushNotifications.importFailed.notificationSubject"},exportCompleted:{defaultMessage:"Your workspace export is ready",id:"pushNotifications.exportCompleted.notificationSubject"},inAppNotificationAutomationActionTriggered:{defaultMessage:"{automationName} sent you a message",id:"pushNotifications.inAppNotificationAutomationActionTriggered.notificationSubject"}});function B(e){const{activity:t,getRecordValue:o}=e,r=t.getEdits();return i.oA((0,s.cf)(i.xH(r.map((e=>e.authors||[])))).map((e=>{const t=o(e);if(t)return(0,l.LU)({table:e.table,value:t})})))}function E(e,t){const o=e.map((e=>e?(0,l.$4)(t,e):t.formatMessage(N.unknownAuthor)));return function(e,t){if(1===t.length)return t[0];if(2===t.length)return e.formatMessage(N.twoUserNames,{firstAuthor:t[0],secondAuthor:t[1]});if(t.length>2){const o=t.length-1;return e.formatMessage(N.threePlusUserNames,{othersCount:o,firstAuthor:t[0]})}return e.formatMessage(N.defaultPluralizedUserNames)}(t,o)}function A(e){var t;if(i.xb(e))return;const o=e[0];var r;return o.table===M.KJ&&null!==(t=o.asActor)&&void 0!==t&&t.profile_photo?null===(r=o.asActor)||void 0===r?void 0:r.profile_photo:void 0}function L(e){if(!i.xb(e))return e[0].id}function D(e){const{blockValue:t,getRecordValue:o,userTimeZone:r,intl:i}=e,n=v.kk.fromBlock(t),s=v.om.fromGetRecordValueFn(o);return n.getRenderTitleWithEmoji({getRecordModel:s,placeholder:i.formatMessage(N.untitledBlockTitle),userTimeZone:r,intl:i})}function Z(e){return z(e).title.replaceAll(/[\r\n]+/g," ")}function H(e){const{activity:t}=e,o=t.navigable_block_id||t.top_level_block_id||t.collection_row_id;return o||(t.collection_id?t.collection_id:void 0)}function z(e){const{activity:t,getRecordValue:o,pageVisitSource:r,userTimeZone:i,intl:n}=e,s=v.om.fromGetRecordValueFn(o),l=t.navigable_block_id||t.top_level_block_id||t.collection_row_id;if(l){const a=o({table:k.iU,id:l,spaceId:t.space_id});if(a){return{url:v.kk.fromBlock(a).getRenderUrl({getRecordModel:s,baseUrl:e.baseURL,pageVisitSource:r}),title:D({intl:n,blockValue:a,getRecordValue:o,userTimeZone:i})}}return{url:e.baseURL||"/",title:n.formatMessage(N.untitledBlockTitle)}}if(t.collection_id)return q(e);if("permission-group-edited"===t.type){const r=s({table:V.bx,id:t.space_id});return{title:ae(n,ne({activity:t,getRecordValue:o})),url:(null==r?void 0:r.getRenderUrl({baseUrl:e.baseURL}))??"/"}}if("user-invited"===t.type){const r=function(e){const{activity:t,getRecordValue:o}=e;if(!t.permission_group_id)return;return le({spaceId:t.space_id,permissionGroupId:t.permission_group_id,getRecordValue:o})}({activity:t,getRecordValue:o}),i=s({table:V.bx,id:t.space_id});if(i&&r)return{title:ae(n,r),url:i.getRenderUrl({baseUrl:e.baseURL})}}else{if("team-membership-edited"===t.type)return K(e);if("access-requested"===t.type){const o=s({id:t.getAccessRequestId(),table:b.J8,spaceId:t.space_id});if(o&&o.isTeamMembershipRequest())return K(e)}}return W(e)}function K(e){const{activity:t,getRecordValue:o,intl:r}=e,i=v.om.fromGetRecordValueFn(o),n=e.baseURL||"/",s=r.formatMessage(N.untitledTeamName);if(!t.team_id)return{url:n,title:s};const l=i({table:O.e0,id:t.team_id}),a=i({table:V.bx,id:t.space_id});return{url:(null==a?void 0:a.getRenderUrl({baseUrl:e.baseURL}))??n,title:(null==l?void 0:l.getRenderTitleWithEmoji({placeholder:r.formatMessage(N.untitledTeamName)}))??s}}function G(e){return W(e).title}function W(e){const{activity:t,getRecordValue:o,intl:r}=e,i=o({table:V.bx,id:t.space_id});if(i){const t=v.kk.fromSpace(i);return{title:t.getRenderTitleWithEmoji({placeholder:r.formatMessage({defaultMessage:"Untitled",id:"pushNotifications.workspaceName.untitled.placeholder"})}),url:t.getRenderUrl({baseUrl:e.baseURL})}}return{url:e.baseURL||"/",title:r.formatMessage(N.untitledSpaceName)}}function U(e){return q(e).title}function q(e){const{activity:t,getRecordValue:o,pageVisitSource:r,userTimeZone:i,intl:n}=e;if(t.collection_id){const s=o({table:_.vF,id:t.collection_id,spaceId:t.space_id});if(s){const t=v.kk.fromCollection(s),o=v.om.fromGetRecordValueFn(e.getRecordValue),l=t.getRenderTitleWithEmoji({getRecordModel:o,placeholder:n.formatMessage(N.untitledCollectionName),userTimeZone:i,intl:n});return{url:t.getRenderUrl({getRecordModel:o,baseUrl:e.baseURL,pageVisitSource:r}),title:l}}return{url:e.baseURL||"/",title:n.formatMessage(N.untitledCollectionName)}}return{url:e.baseURL||"/",title:n.formatMessage(N.untitledCollectionName)}}function $(e){const{activity:t,getRecordValue:o,intl:r}=e;if("in-app-notification-automation-action-triggered"===t.type){const e=v.om.fromGetRecordValueFn(o),i=e({table:w.cv,id:t.getEdits()[0].automation_id,spaceId:t.space_id});return(null==i?void 0:i.getNameWithDefault(e,r))??(0,a.XO)(r)}}function Q(e){if(e.blockValue.properties)return(0,x.X)({intl:e.intl,textValue:e.blockValue.properties.title,getRecordModel:v.om.fromGetRecordValueFn(e.getRecordValue),userTimeZone:e.userTimeZone})}function Y(e,t){const o=(0,y.kD)(t,void 0);return e.formatMessage(o)}function X(e){let{userTimeZone:t,activity:o,getRecordValue:r,pageVisitSource:n,intl:s}=e;const l=o.getEdits();if(l.length){const e=[];l.forEach((t=>{"permission-created"===t.type?e.push(t.permission_data):"permission-deleted"===t.type?e.push({...t.permission_data,role:"none"}):"permission-restriction-created"===t.type||"permission-restriction-deleted"===t.type?(t.permission_data.calculated_changes||[]).forEach((t=>{let[o,r]=t;e.push(r)})):e.push(t.permission_data.after)}));const a=i.oA(e.sort(y._G).map((e=>{if("user_permission"===e.type){const t=r({table:M.KJ,id:e.user_id}),o=(0,j.Nz)(s,t),i=Y(s,e.role);return s.formatMessage(N.userNameWithRole,{userName:o,permissionLevel:i})}if("space_permission"===e.type){const i=G({intl:s,activity:o,getRecordValue:r,userTimeZone:t,pageVisitSource:n}),l=Y(s,e.role);return s.formatMessage(N.spaceNameWithRole,{spaceName:i,permissionLevel:l})}if("public_permission"===e.type){const t=Y(s,e.role);return s.formatMessage(N.publicPermissionRoleLabel,{permissionLevel:t})}if("bot_permission"===e.type){const t=r({table:T.cZ,id:e.bot_id}),o=(0,d.Mh)(t),i=Y(s,e.role);return s.formatMessage(N.botNameWithRole,{botName:o,permissionLevel:i})}})));return s.formatList(a,{type:"conjunction",style:"narrow"})}}function J(e){const{intl:t}=e;switch(e.blockValue.type){case c.Ti.text:case c.Ti.header:case c.Ti.subHeader:case c.Ti.subSubHeader:case c.Ti.factory:case c.Ti.equation:case c.Ti.code:return Q(e);case c.Ti.toggle:return`▸ ${Q(e)}`;case c.Ti.bulletedList:return`• ${Q(e)}`;case c.Ti.numberedList:return`1. ${Q(e)}`;case c.Ti.quote:return`“${Q(e)}”`;case c.Ti.toDo:return(function(e){let{blockValue:t}=e;return h.Ml(t.properties&&t.properties.checked)}(e)?"✓ ":"▢ ")+Q(e);case c.Ti.file:case c.Ti.bookmark:return`🔗 ${Q(e)}`;case c.Ti.embed:case c.Ti.framer:case c.Ti.whimsical:case c.Ti.mixpanel:case c.Ti.miro:case c.Ti.abstract:case c.Ti.sketch:case c.Ti.excalidraw:case c.Ti.replit:case c.Ti.hex:case c.Ti.deepnote:case c.Ti.tweet:case c.Ti.gist:case c.Ti.maps:case c.Ti.invision:case c.Ti.video:case c.Ti.audio:case c.Ti.image:return t.formatMessage(N.imageInPushNotification,{imageEmoji:"🖼"});case c.Ti.drive:return function(e){const{blockValue:t}=e,o=(0,g.v0)(t);return o&&o.title?o.title:D(e)}(e);case c.Ti.page:case c.Ti.collectionView:case c.Ti.collectionViewPage:return D(e);case c.Ti.tableRow:return function(e){var t;const{blockValue:o,getRecordValue:r,userTimeZone:i,intl:n}=e,s=r({table:o.parent_table,id:o.parent_id,spaceId:o.space_id});if(!s||!o)return;const l=o.properties,a=(null===(t=s.format)||void 0===t?void 0:t.table_block_column_order)||[];return a&&l?a.map((e=>(0,x.X)({textValue:l[e],getRecordModel:v.om.fromGetRecordValueFn(r),userTimeZone:i,intl:n}))).join(", "):void 0}(e)}}function ee(e){const{getRecordValue:t,baseURL:o,userTimeZone:r,intl:i}=e,n=t({table:k.iU,id:e.blockId});if(n){if("page"===n.type){const s=(0,f.ky)({block:n,getRecordValue:t});if(s){const o=p.oC(s),r=o[e.property],l=r?r.name:void 0,a=te({property:e.property,schema:o,block:n,getRecordValue:t,userTimeZone:e.userTimeZone,baseURL:e.baseURL,intl:i})||i.formatMessage(N.emptyPropertyBody);return i.formatMessage(N.propertyNameAndValueNotificationBody,{propertyName:l,propertyValue:a})}return J({intl:i,blockValue:n,getRecordValue:t,baseURL:o,userTimeZone:r})}return J({intl:i,blockValue:n,getRecordValue:t,baseURL:o,userTimeZone:r})}}function te(e){const{property:t,schema:o,getRecordValue:r,userTimeZone:i,baseURL:n,intl:a}=e,c=o[t],d=v.kk.fromBlock(e.block);if(!d.getProperties()||!c)return;const g=d.getProperties()[t];if("formula"===c.type){const e=v.om.fromGetRecordValueFn(r),n=(0,u.py)({schema:o,property:t,blockModel:d,getRecordModel:e,intl:a,userTimeZone:i,depth:0,resultCache:new Map});return m.U3(n)?(0,S.ZV)({allowRelativeDates:!0,intl:a,value:n,userTimeZone:i}):"boolean"==typeof n?n?p.bx:p.HC:(0,s.hj)(n)?n.toString():n}if("person"===c.type)return a.formatList(h.DW({textValue:g,propertySchema:c,blockCreatorPointer:d.getCreatedByPointer()}).map((e=>{const t=r(e),o=(0,l.LU)({table:e.table,value:t});return(0,l.$4)(a,o)})),{type:"conjunction",style:"narrow"});if("created_by"===c.type){const e=d.getCreatedByPointer();if(!e)return a.formatMessage(N.unknownAuthorInPropertySchemaChange);const t=r(e),o=t&&(0,l.LU)({table:e.table,value:t});return o?(0,l.$4)(a,o):a.formatMessage(N.unknownAuthorInPropertySchemaChange)}return"created_time"===c.type?(0,S.Yx)(d.getCreatedTime(),"short",a.locale,i):g?oe({propertySchema:c,textValue:g,getRecordValue:r,userTimeZone:i,baseURL:n,intl:a}):void 0}function oe(e){const{propertySchema:t,textValue:o,getRecordValue:r,userTimeZone:i,baseURL:s,intl:a}=e;if("title"===t.type||"text"===t.type)return(0,x.X)({intl:a,textValue:o,getRecordModel:v.om.fromGetRecordValueFn(r),userTimeZone:i});if("select"===t.type){const e=t.options||[];return h.Sj(o,e)}if("multi_select"===t.type){const e=t.options||[];return a.formatList(h.uP(o,e),{type:"conjunction",style:"narrow"})}if("checkbox"===t.type)return h.Ml(o)?p.bx:p.HC;if("date"===t.type){const e=h.Gl(o);if(e)return(0,S.ZV)({allowRelativeDates:!0,intl:a,value:e,date_format:t.date_format,time_format:t.time_format,userTimeZone:i})}else{if("person"===t.type)return a.formatList(h.DW({textValue:o,propertySchema:t,blockCreatorPointer:void 0}).map((e=>{const t=r(e),o=(0,l.LU)({table:e.table,value:t});return(0,l.$4)(a,o)})),{type:"conjunction",style:"narrow"});if("relation"===t.type){const e=h.j$({relationValue:h.rq(o),getRecordModel:v.om.fromGetRecordValueFn(r),propertySchema:t});return a.formatList(e.map(r).map((e=>e?D({intl:a,blockValue:e,getRecordValue:r,baseURL:s,userTimeZone:i}):a.formatMessage(N.unknownRelationValueChange))),{type:"conjunction",style:"narrow"})}if("number"===t.type){const e=h.VY(o);if(void 0!==e)return e.toString()}else if("auto_increment_id"===t.type){const e=h.ah(o);if(void 0!==e)return e.toString()}else{if("file"===t.type)return a.formatList(h.g(o).map((e=>e.name||e.url)),{type:"conjunction",style:"narrow"});if("url"===t.type||"phone_number"===t.type||"email"===t.type)return(0,R.Jcv)(o);if("created_by"===t.type)return;if("created_time"===t.type)return;if("formula"===t.type)return;if("rollup"===t.type)return;if("last_edited_by"===t.type)return;if("last_edited_time"===t.type)return;if("last_visited_time"===t.type)return;if("button"===t.type)return;if("status"===t.type)return h.ZG(o,t);if("location"===t.type)return;if("verification"===t.type){const e=h._w(o),t=e?F.WN(e):{type:"none"};if("none"===t.type)return a.formatMessage(F.X3.none);const n=r(t.actorPointer),s=(0,l.LU)({table:t.actorPointer.table,value:n}),c=(0,l.$4)(a,s);return"verified"===t.type&&t.isIndefinite?a.formatMessage(F.X3.verifiedIndefinitely,{actor:c}):a.formatMessage(F.X3.verifiedUntil,{actor:c,datetime:I.nK({dateTime:t.dateTimeRange.end,intl:a,userTimeZone:i,displayInUserTimezone:!1,alwaysIncludeTimezone:!0})})}(0,n.t1)(t)}}}function re(e){if("page_icon"===e.formatProperty)return e.intl.formatMessage(N.blockFormatEditPageIconName)}function ie(e){const{formatProperty:t,block:o,getRecordValue:r,intl:i}=e;if("page_icon"===t){const e=v.kk.fromBlock(o).getRenderIcon({getRecordModel:v.om.fromGetRecordValueFn(r)});return e?(0,C.Z)(e.icon)?e.icon:i.formatMessage(N.pageIconImagePlaceholder):i.formatMessage(N.emptyBlockEditedProperty)}}function ne(e){const{activity:t,getRecordValue:o}=e;let r=le({spaceId:t.space_id,permissionGroupId:t.permission_group_id,getRecordValue:o});if(!r){const e=t.getEdits(),o=P.hI(e)[0];r="permission-group-changed"===o.type?o.permission_group_data.after:o.permission_group_data}return r}function se(e){const{activity:t,intl:o,userName:r,targetName:i}=e,n=t.getEdits(),s=P.hI(n)[0];return s?"permission-group-created"===s.type?o.formatMessage(N.userCreatedPermissionGroup,{userName:r,permissionGroupName:i}):"permission-group-deleted"===s.type?o.formatMessage(N.userDeletedPermissionGroup,{userName:r,permissionGroupName:i}):o.formatMessage(N.userEditedPermissionGroup,{userName:r,permissionGroupName:i}):o.formatMessage(N.userEditedPermissionGroup,{userName:r,permissionGroupName:i})}function le(e){const{spaceId:t,permissionGroupId:o,getRecordValue:r}=e,i=r({table:V.bx,id:t});return(i&&i.permission_groups||[]).find((e=>e.id===o))}function ae(e,t){if(t){return[(0,C.Z)(t.icon)?t.icon:void 0,t.name||e.formatMessage(N.untitledPermissionGroupName)].filter(Boolean).join(" ")}return e.formatMessage(N.defaultPermissionGroupName)}function ce(e){switch(e){case"block-property-edited":case"commented":case"permission-group-mentioned":case"reminder":case"user-invited":case"in-app-notification-automation-action-triggered":case"user-mentioned":return!0;case"access-requested":case"access-request-resolved":case"email-edited":case"private-content-transferred":case"team-membership-edited":case"verification-expired":case"export-completed":case"import-completed":case"block-edited":case"collection-edited":case"collection-property-edited":case"collection-row-created":case"collection-row-deleted":case"collection-view-edited":case"page-deleted":case"page-locked":case"page-permanently-deleted":case"page-restored":case"page-unlocked":case"permission-group-edited":case"permissions-edited":case"top-level-block-created":case"top-level-block-deleted":return!1;default:(0,n.t1)(e)}}},508769:(e,t,o)=>{o.d(t,{X:()=>i});var r=o(180951);function i(e){const{block:t,property:o,schema:i,getRecordModel:n,userId:s,userTimeZone:l,intl:a}=e;if(!t)return!1;if("title"===o)return!1;const c=i[o];return!(!c||"checkbox"!==c.type)||(!(!c||"button"!==c.type)||(!(!c||"status"!==c.type)||!r.wV({property:o,schema:i,block:t,getRecordModel:n,userId:s,userTimeZone:l,intl:a})))}},908597:(e,t,o)=>{o.d(t,{Z:()=>n});o(667294);var r=o(745238),i=o(785893);const n=(0,r.IU)("arrowUp",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M8 14.5586C8.44434 14.5586 8.74512 14.251 8.74512 13.7998V5.30957L8.69043 3.83984L10.4951 5.84961L12.0469 7.38086C12.1836 7.51074 12.3682 7.59961 12.5801 7.59961C12.9902 7.59961 13.291 7.28516 13.291 6.86816C13.291 6.66992 13.2158 6.49219 13.0586 6.32812L8.55371 1.81641C8.40332 1.66602 8.20508 1.57715 8 1.57715C7.79492 1.57715 7.59668 1.66602 7.44629 1.81641L2.94141 6.32812C2.78418 6.49219 2.70898 6.66992 2.70898 6.86816C2.70898 7.28516 3.0166 7.59961 3.42676 7.59961C3.63184 7.59961 3.82324 7.51074 3.95312 7.38086L5.50488 5.84961L7.30957 3.83301L7.25488 5.30957V13.7998C7.25488 14.251 7.5625 14.5586 8 14.5586Z"})})},586432:(e,t,o)=>{o.d(t,{s:()=>n});o(667294);var r=o(745238),i=o(785893);const n=(0,r.IU)("calendarDate31",{viewBox:"0 0 20 20",svg:(0,i.jsxs)("g",{children:[(0,i.jsx)("path",{d:"M7.565 10.164c0-.753-.429-1.246-1.104-1.246-.649 0-.87.467-.87 1.207v.13c-.077.013-.142.026-.22.026-.468 0-.805-.39-.805-1.052 0-1.012.935-1.908 2.713-1.908 1.584 0 2.596.805 2.596 2.116 0 .987-.843 1.636-1.674 1.804 1.558.17 2.207 1.052 2.207 2.13 0 1.843-1.39 2.803-3.531 2.803h-.052c-1.61 0-2.74-.662-2.74-1.687 0-.584.442-1.052 1.104-1.052.052 0 .104.013.156.013.13 1.052.857 1.48 1.584 1.48.7 0 1.194-.428 1.194-1.077v-.026c0-1.013-.87-1.117-2.181-1.246l-.208-1.22c1.22-.144 1.83-.494 1.83-1.195zm4.95 4.66v-6.05c-1.298.286-1.583-.285-1.44-.856.779-.13 2.804-.597 3.57-.818v7.776l1.415.286c0 .506-.299.805-.831.805-.442 0-1.467-.026-1.96-.026-.766 0-2.168.026-2.168.026a.851.851 0 01-.052-.299c0-.246.104-.493.441-.584l1.026-.26z"}),(0,i.jsx)("path",{d:"M16.664 0H3.334A3.333 3.333 0 000 3.334v13.332A3.333 3.333 0 003.334 20h13.332A3.333 3.333 0 0020 16.666V3.334A3.333 3.333 0 0016.666 0h-.002zm-.525 17.932H3.861a1.797 1.797 0 01-1.797-1.797V5.485h15.872v10.652c0 .993-.804 1.797-1.797 1.797v-.002z"})]})})},2585:(e,t,o)=>{o.d(t,{f:()=>n});o(667294);var r=o(745238),i=o(785893);const n=(0,r.IU)("chevronLeft",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M3.61816 8.06445C3.61816 8.29688 3.70703 8.49512 3.8916 8.67285L9.22363 13.8887C9.36719 14.0391 9.55859 14.1143 9.77734 14.1143C10.2217 14.1143 10.5703 13.7725 10.5703 13.3213C10.5703 13.1025 10.4814 12.9043 10.3311 12.7539L5.52539 8.06445L10.3311 3.375C10.4814 3.21777 10.5703 3.01953 10.5703 2.80078C10.5703 2.35645 10.2217 2.01465 9.77734 2.01465C9.55859 2.01465 9.36719 2.08984 9.22363 2.24023L3.8916 7.45605C3.70703 7.63379 3.625 7.83203 3.61816 8.06445Z"})})},545453:(e,t,o)=>{o.d(t,{p:()=>n});o(667294);var r=o(745238),i=o(785893);const n=(0,r.IU)("collectionHide",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M12.6172 12.9492C12.8047 13.1309 13.0918 13.1426 13.2793 12.9492C13.4727 12.75 13.4609 12.4688 13.2793 12.2871L3.35352 2.37305C3.17773 2.19141 2.87305 2.18555 2.69141 2.37305C2.51562 2.54883 2.51562 2.85352 2.69141 3.0293L12.6172 12.9492ZM8 2.70703C6.98047 2.70703 6.05469 2.88281 5.19336 3.16406L6.13086 4.10156C6.72266 3.93164 7.33789 3.83203 8 3.83203C11.7441 3.83203 14.7207 7.08984 14.7207 7.77539C14.7207 8.23828 13.7715 9.43359 12.2656 10.377L13.1328 11.25C14.9727 10.043 16.0449 8.4668 16.0449 7.77539C16.0449 6.57422 12.8047 2.70703 8 2.70703ZM8 12.8496C9.08398 12.8496 10.0742 12.6621 10.9707 12.3516L10.0391 11.4199C9.40039 11.6074 8.72656 11.7246 8 11.7246C4.25586 11.7246 1.2793 8.5957 1.2793 7.77539C1.2793 7.38281 2.27539 6.11133 3.88086 5.12695L2.99609 4.24219C1.08008 5.46094 -0.0507812 7.07227 -0.0507812 7.77539C-0.0507812 8.97656 3.25977 12.8496 8 12.8496ZM10.9238 8.90625C11.0762 8.56055 11.1641 8.17383 11.1641 7.77539C11.1641 6.01172 9.75781 4.62305 8 4.62305C7.5957 4.62305 7.21484 4.69922 6.86328 4.8457L10.9238 8.90625ZM8 10.9336C8.45703 10.9336 8.88477 10.8281 9.26562 10.6465L5.12305 6.49805C4.93555 6.88477 4.83008 7.3125 4.83008 7.78125C4.83594 9.49805 6.23633 10.9336 8 10.9336Z"})})},309056:(e,t,o)=>{o.d(t,{g:()=>n});o(667294);var r=o(745238),i=o(785893);const n=(0,r.IU)("collectionShow",{viewBox:"0 0 30 30",svg:(0,i.jsx)("path",{d:"M15,4 C8.641,4 0,10.469 0,15 C0,19.531 8.641,26 15,26 C21.359,26 30,19.531 30,15 C30,10.469 21.359,4 15,4 Z M15,24 C9.149,24 2,17.975 2,15 C2,12.025 9.149,6 15,6 C20.851,6 28,12.025 28,15 C28,17.975 20.851,24 15,24 Z M15,8 C11.134,8 8,11.134 8,15 C8,18.866 11.134,22 15,22 C18.866,22 22,18.866 22,15 C22,11.134 18.866,8 15,8 Z M15,20 C12.238,20 10,17.761 10,15 C10,12.239 12.238,10 15,10 C17.762,10 20,12.239 20,15 C20,17.761 17.762,20 15,20 Z"})})},31505:(e,t,o)=>{o.d(t,{Y:()=>n});o(667294);var r=o(745238),i=o(785893);const n=(0,r.IU)("collectionTimelineArrowLeft",{viewBox:"0 0 9 7",svg:(0,i.jsx)("path",{d:"M0 3.5021C0 3.70786 0.0939831 3.93041 0.237195 4.06479L3.11934 6.76065C3.28493 6.91602 3.48633 7 3.67877 7C4.17106 7 4.48881 6.68506 4.48881 6.27774C4.48881 6.03839 4.37245 5.86203 4.22029 5.72345L3.19095 4.77025L2.56887 4.22855L3.47737 4.27055L8.13625 4.27055C8.6554 4.27055 9 3.96401 9 3.5021C9 3.04019 8.6554 2.73365 8.13625 2.73365L3.47737 2.73365L2.56887 2.77564L3.19095 2.23395L4.22029 1.27654C4.37245 1.13377 4.48881 0.961608 4.48881 0.722255C4.48881 0.314937 4.17106 0 3.67877 0C3.48633 0 3.28493 0.0839832 3.11487 0.239352L0.237195 2.93941C0.0939831 3.07378 0 3.29634 0 3.5021Z"})})},239301:(e,t,o)=>{o.d(t,{n:()=>n});o(667294);var r=o(745238),i=o(785893);const n=(0,r.IU)("collectionTimelineArrowRight",{viewBox:"0 0 9 7",svg:(0,i.jsx)("path",{d:"M9 3.4979C9 3.29214 8.90602 3.06959 8.7628 2.93521L5.88066 0.239352C5.71507 0.0839835 5.51368 3.13148e-07 5.32123 2.96324e-07C4.82894 2.53287e-07 4.51119 0.314937 4.51119 0.722256C4.51119 0.961608 4.62755 1.13797 4.77971 1.27654L5.80905 2.22975L6.43113 2.77145L5.52263 2.72945L0.863749 2.72945C0.344604 2.72945 -6.62078e-07 3.03599 -7.02459e-07 3.4979C-7.4284e-07 3.95981 0.344604 4.26635 0.863749 4.26635L5.52263 4.26635L6.43113 4.22436L5.80905 4.76605L4.77971 5.72346C4.62755 5.86623 4.51119 6.03839 4.51119 6.27774C4.51119 6.68506 4.82894 7 5.32123 7C5.51367 7 5.71507 6.91602 5.88513 6.76065L8.7628 4.06059C8.90602 3.92622 9 3.70366 9 3.4979Z"})})},664878:(e,t,o)=>{o.d(t,{h:()=>n});o(667294);var r=o(745238),i=o(785893);const n=(0,r.IU)("dot",{viewBox:"0 0 5 4",svg:(0,i.jsx)("circle",{cx:"2.5",cy:"2",r:"2"})})},97439:(e,t,o)=>{o.d(t,{D:()=>n});o(667294);var r=o(745238),i=o(785893);const n=(0,r.IU)("doubleChevronLeft",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M7.07031 13.8887C7.2207 14.0391 7.40527 14.1211 7.62402 14.1211C8.06836 14.1211 8.41699 13.7725 8.41699 13.3281C8.41699 13.1094 8.32812 12.9043 8.17773 12.7539L3.37207 8.05762L8.17773 3.375C8.32812 3.21777 8.41699 3.0127 8.41699 2.80078C8.41699 2.35645 8.06836 2.00781 7.62402 2.00781C7.40527 2.00781 7.2207 2.08984 7.07031 2.24023L1.73828 7.44922C1.56055 7.62012 1.46484 7.8252 1.46484 8.06445C1.46484 8.29688 1.55371 8.49512 1.73828 8.67969L7.07031 13.8887ZM13.1748 13.8887C13.3252 14.0391 13.5098 14.1211 13.7354 14.1211C14.1797 14.1211 14.5283 13.7725 14.5283 13.3281C14.5283 13.1094 14.4395 12.9043 14.2891 12.7539L9.4834 8.05762L14.2891 3.375C14.4395 3.21777 14.5283 3.0127 14.5283 2.80078C14.5283 2.35645 14.1797 2.00781 13.7354 2.00781C13.5098 2.00781 13.3252 2.08984 13.1748 2.24023L7.84961 7.44922C7.66504 7.62012 7.57617 7.8252 7.56934 8.06445C7.56934 8.29688 7.66504 8.49512 7.84961 8.67969L13.1748 13.8887Z"})})},207525:(e,t,o)=>{o.d(t,{t:()=>n});o(667294);var r=o(745238),i=o(785893);const n=(0,r.IU)("doubleChevronRight",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M2.25781 14.1211C2.47656 14.1211 2.66797 14.0391 2.81836 13.8887L8.14355 8.67969C8.32812 8.49512 8.41699 8.29688 8.41699 8.06445C8.41699 7.8252 8.32812 7.62012 8.14355 7.44922L2.81836 2.24023C2.66797 2.08984 2.4834 2.00781 2.25781 2.00781C1.81348 2.00781 1.46484 2.35645 1.46484 2.80078C1.46484 3.0127 1.55371 3.21777 1.7041 3.375L6.50977 8.05762L1.7041 12.7539C1.55371 12.9043 1.46484 13.1094 1.46484 13.3281C1.46484 13.7725 1.81348 14.1211 2.25781 14.1211ZM8.36914 14.1211C8.58789 14.1211 8.77246 14.0391 8.92285 13.8887L14.2549 8.67969C14.4395 8.49512 14.5283 8.29688 14.5283 8.06445C14.5283 7.8252 14.4326 7.62012 14.2549 7.44922L8.92285 2.24023C8.77246 2.08984 8.58789 2.00781 8.36914 2.00781C7.9248 2.00781 7.56934 2.35645 7.56934 2.80078C7.56934 3.0127 7.66504 3.21777 7.81543 3.375L12.6211 8.05762L7.81543 12.7539C7.66504 12.9043 7.56934 13.1094 7.56934 13.3281C7.56934 13.7725 7.9248 14.1211 8.36914 14.1211Z"})})},780926:(e,t,o)=>{o.d(t,{z:()=>n});o(667294);var r=o(745238),i=o(785893);const n=(0,r.IU)("flag",{viewBox:"0 0 13 14",svg:(0,i.jsx)("path",{d:"M0.825195 13.8457C1.16699 13.8457 1.4541 13.5654 1.4541 13.2168V9.47754C1.63867 9.40918 2.21973 9.19727 3.10156 9.19727C5.59668 9.19727 7.25781 10.4414 9.66406 10.4414C10.7168 10.4414 11.1885 10.3115 11.7217 10.0654C12.207 9.84668 12.4941 9.4502 12.4941 8.82129V1.99219C12.4941 1.55469 12.1523 1.27441 11.6943 1.27441C11.3047 1.27441 10.6895 1.54102 9.58887 1.54102C7.20996 1.54102 5.52148 0.296875 3.0332 0.296875C1.99414 0.296875 1.5293 0.419922 0.975586 0.672852C0.49707 0.891602 0.196289 1.24707 0.196289 1.86914V13.2168C0.196289 13.5586 0.483398 13.8457 0.825195 13.8457ZM9.63672 9.16309C7.41504 9.16309 5.71289 7.92578 3.12207 7.92578C2.45215 7.92578 1.84375 8.00098 1.48145 8.14453V2.0332C1.59766 1.83496 2.11035 1.56836 3.05371 1.56836C5.38477 1.56836 7.09375 2.80566 9.56836 2.80566C10.2383 2.80566 10.792 2.73047 11.2158 2.61426V8.69824C11.0996 8.89648 10.5801 9.16309 9.63672 9.16309Z"})})},310214:(e,t,o)=>{o.d(t,{K:()=>n});o(667294);var r=o(745238),i=o(785893);const n=(0,r.IU)("myTasksLarge",{viewBox:"0 0 48 48",svg:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("path",{d:"M21.6927 39.1705C21.4812 39.604 21.238 40.0164 20.9631 40.4076H39.5198C41.1693 40.4076 42.4117 39.9952 43.247 39.1705C44.0823 38.3457 44.5 37.1192 44.5 35.4909V19.2022C44.5 17.5739 44.0823 16.3473 43.247 15.5226C42.4117 14.6978 41.1693 14.2855 39.5198 14.2855H16.2526C14.5925 14.2855 13.3448 14.6978 12.5095 15.5226C11.6848 16.3367 11.2724 17.5633 11.2724 19.2022V24.4837C11.4839 24.4626 11.6953 24.4467 11.9068 24.4361C12.1183 24.415 12.3298 24.4044 12.5412 24.4044C12.7527 24.4044 12.9642 24.415 13.1757 24.4361C13.3977 24.4467 13.6145 24.4626 13.8259 24.4837V19.3449C13.8259 18.5202 14.0374 17.8964 14.4603 17.4734C14.8833 17.0505 15.4913 16.839 16.2843 16.839H39.4722C40.2547 16.839 40.8627 17.0505 41.2962 17.4734C41.7297 17.8964 41.9465 18.5202 41.9465 19.3449V35.3481C41.9465 36.1729 41.7297 36.7967 41.2962 37.2196C40.8627 37.6426 40.2547 37.8541 39.4722 37.8541H22.2478C22.0998 38.3087 21.9147 38.7475 21.6927 39.1705Z"}),(0,i.jsx)("path",{d:"M15.3644 10.0825C14.9837 10.4631 14.7353 11.0129 14.619 11.7319H41.1693C41.0424 11.0129 40.7887 10.4631 40.408 10.0825C40.0379 9.69123 39.4564 9.49562 38.6634 9.49562H17.1249C16.3319 9.49562 15.745 9.69123 15.3644 10.0825Z"}),(0,i.jsx)("path",{d:"M18.5206 5.816C18.14 6.15435 17.9285 6.66189 17.8862 7.3386H37.9021C37.8492 6.66189 37.6271 6.15435 37.2359 5.816C36.8553 5.46707 36.3002 5.2926 35.5706 5.2926H20.2018C19.4722 5.2926 18.9118 5.46707 18.5206 5.816Z"}),(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.44845 42.0729C10.4212 42.4959 11.4574 42.7074 12.5571 42.7074C13.6462 42.7074 14.6771 42.4959 15.6499 42.0729C16.6227 41.65 17.4791 41.0684 18.2193 40.3283C18.97 39.5881 19.5568 38.7317 19.9798 37.7589C20.4027 36.7861 20.6142 35.7499 20.6142 34.6503C20.6142 33.54 20.4027 32.4985 19.9798 31.5258C19.5674 30.553 18.9911 29.6965 18.251 28.9564C17.5108 28.2162 16.6544 27.6399 15.6816 27.2276C14.7088 26.8046 13.6673 26.5932 12.5571 26.5932C11.4574 26.5932 10.4212 26.8046 9.44845 27.2276C8.47568 27.6399 7.61922 28.2215 6.87906 28.9722C6.13891 29.7124 5.55736 30.5688 5.13442 31.5416C4.71147 32.5038 4.5 33.54 4.5 34.6503C4.5 35.7605 4.71147 36.802 5.13442 37.7748C5.55736 38.7475 6.13891 39.604 6.87906 40.3442C7.61922 41.0843 8.47568 41.6606 9.44845 42.0729ZM13.255 39.4242C13.0858 39.604 12.8532 39.6939 12.5571 39.6939C12.261 39.6939 12.0231 39.604 11.8434 39.4242C11.6742 39.2445 11.5896 39.0119 11.5896 38.7264V35.6177H8.48097C8.19548 35.6177 7.96286 35.5279 7.78311 35.3481C7.60336 35.1789 7.51348 34.9463 7.51348 34.6503C7.51348 34.3542 7.60336 34.1216 7.78311 33.9524C7.96286 33.7726 8.19548 33.6828 8.48097 33.6828H11.5896V30.5741C11.5896 30.2886 11.6742 30.056 11.8434 29.8763C12.0231 29.6965 12.261 29.6066 12.5571 29.6066C12.8532 29.6066 13.0858 29.6965 13.255 29.8763C13.4347 30.056 13.5246 30.2886 13.5246 30.5741V33.6828H16.6332C16.9187 33.6828 17.1513 33.7726 17.3311 33.9524C17.5108 34.1216 17.6007 34.3542 17.6007 34.6503C17.6007 34.9463 17.5108 35.1789 17.3311 35.3481C17.1513 35.5279 16.9187 35.6177 16.6332 35.6177H13.5246V38.7264C13.5246 39.0119 13.4347 39.2445 13.255 39.4242Z"}),(0,i.jsx)("path",{d:"M27.2289 32.3258C27.5208 32.6671 27.893 32.8378 28.3453 32.8378C28.8593 32.8378 29.2478 32.6404 29.511 32.2456L35.204 23.666C35.2986 23.5262 35.3685 23.3885 35.4137 23.2528C35.459 23.113 35.4816 22.9793 35.4816 22.8519C35.4816 22.4982 35.3582 22.2063 35.1115 21.976C34.8689 21.7416 34.5687 21.6244 34.211 21.6244C33.9643 21.6244 33.7546 21.6738 33.5819 21.7725C33.4133 21.867 33.2529 22.0315 33.1008 22.2659L28.3206 29.7723L25.9274 26.9042C25.6684 26.604 25.3435 26.4539 24.9529 26.4539C24.5869 26.4539 24.2847 26.5711 24.0462 26.8055C23.8077 27.0399 23.6885 27.3339 23.6885 27.6875C23.6885 27.8479 23.7131 28 23.7625 28.144C23.8159 28.2838 23.9126 28.4297 24.0524 28.5819L27.2289 32.3258Z"})]})})},204635:(e,t,o)=>{o.d(t,{W:()=>n});o(667294);var r=o(745238),i=o(785893);const n=(0,r.IU)("options",{viewBox:"0 0 17 15",svg:(0,i.jsx)("path",{d:"M11.2871 4.48438C12.1309 4.48438 12.8574 3.95312 13.1621 3.21875H15.7324C16.123 3.21875 16.4512 2.875 16.4512 2.46094C16.4512 2.04688 16.123 1.71094 15.7324 1.71094H13.1621C12.8652 0.96875 12.1387 0.4375 11.2871 0.4375C10.4355 0.4375 9.70898 0.96875 9.41211 1.71094H1.04492C0.630859 1.71094 0.302734 2.04688 0.302734 2.46094C0.302734 2.875 0.630859 3.21875 1.04492 3.21875H9.41211C9.7168 3.95312 10.4434 4.48438 11.2871 4.48438ZM11.2871 3.42188C10.748 3.42188 10.3262 2.99219 10.3262 2.46094C10.3262 1.91406 10.748 1.49219 11.2871 1.49219C11.834 1.49219 12.248 1.91406 12.248 2.46094C12.248 2.99219 11.834 3.42188 11.2871 3.42188ZM1.02148 6.58594C0.630859 6.58594 0.302734 6.92188 0.302734 7.33594C0.302734 7.74219 0.630859 8.08594 1.02148 8.08594H3.67773C3.98242 8.83594 4.70898 9.35938 5.56055 9.35938C6.4043 9.35938 7.13086 8.83594 7.43555 8.08594H15.709C16.123 8.08594 16.4512 7.75 16.4512 7.33594C16.4512 6.92188 16.123 6.58594 15.709 6.58594H7.43555C7.13086 5.84375 6.4043 5.32031 5.56055 5.32031C4.70898 5.32031 3.98242 5.84375 3.67773 6.58594H1.02148ZM5.56055 8.30469C5.02148 8.30469 4.5918 7.875 4.5918 7.33594C4.5918 6.78906 5.02148 6.375 5.56055 6.375C6.09961 6.375 6.52148 6.78906 6.52148 7.33594C6.52148 7.875 6.09961 8.30469 5.56055 8.30469ZM11.2871 14.2344C12.1387 14.2344 12.8652 13.7031 13.1621 12.9609H15.7324C16.123 12.9609 16.4512 12.625 16.4512 12.2109C16.4512 11.7891 16.123 11.4609 15.7324 11.4609H13.1621C12.8652 10.7188 12.1387 10.1875 11.2871 10.1875C10.4434 10.1875 9.70898 10.7188 9.41211 11.4609H1.04492C0.630859 11.4609 0.302734 11.7969 0.302734 12.2109C0.302734 12.6172 0.630859 12.9609 1.04492 12.9609H9.41211C9.70898 13.7031 10.4355 14.2344 11.2871 14.2344ZM11.2871 13.1719C10.748 13.1719 10.3262 12.7422 10.3262 12.2109C10.3262 11.6641 10.748 11.25 11.2871 11.25C11.834 11.25 12.248 11.6641 12.248 12.2109C12.248 12.7422 11.834 13.1719 11.2871 13.1719Z"})})},923903:(e,t,o)=>{o.d(t,{P:()=>n});o(667294);var r=o(745238),i=o(785893);const n=(0,r.IU)("pin",{viewBox:"0 0 13 19",svg:(0,i.jsx)("path",{d:"M1.25 12.875h4.227v3.648c0 1.196.5 2.188.695 2.188.187 0 .687-.992.687-2.188v-3.648h4.227c.703 0 1.148-.438 1.148-1.102 0-1.648-1.32-3.304-3.359-4.109L8.617 4c.992-.648 1.93-1.383 2.328-1.914.211-.266.305-.531.305-.758 0-.476-.367-.828-.914-.828H2.008c-.555 0-.914.352-.914.828 0 .227.093.492.297.758.398.531 1.343 1.266 2.328 1.914L3.46 7.664C1.42 8.47.1 10.125.1 11.774c0 .664.446 1.101 1.149 1.101zm4.922-5.719c-.5 0-.984.047-1.438.14l.235-3.874c.008-.11-.008-.149-.086-.188-1.172-.601-2.078-1.312-2.14-1.468-.063-.102 0-.164.085-.164h6.68c.086 0 .148.062.086.164-.063.156-.969.867-2.14 1.468-.071.04-.095.079-.079.188l.234 3.875a7.177 7.177 0 00-1.437-.14zm-4.61 4.54c-.18 0-.257-.102-.226-.313.172-1.406 1.969-3.086 4.836-3.086 2.86 0 4.656 1.68 4.828 3.086.031.21-.047.312-.227.312h-9.21z"})})},79310:(e,t,o)=>{o.d(t,{A:()=>n});o(667294);var r=o(745238),i=o(785893);const n=(0,r.IU)("pinStrikethrough",{viewBox:"0 0 15 19",svg:(0,i.jsx)("path",{d:"M3.094 1.328c0 .227.094.492.297.758.398.531 1.343 1.266 2.328 1.914l-.055.86 1.149 1.156.156-2.594c.008-.11-.008-.149-.086-.188-1.172-.601-2.078-1.312-2.14-1.468-.063-.102.007-.164.085-.164h6.68c.086 0 .148.062.086.164-.063.156-.961.867-2.14 1.468-.071.04-.087.079-.079.188l.234 3.875a7.12 7.12 0 00-1.437-.14h-.203l1.203 1.226c2.164.219 3.758 1.984 3.758 3.234 0 .04-.008.078-.008.117l.844.97c.257-.157.468-.477.468-.93 0-1.649-1.32-3.313-3.359-4.11L10.617 4c.992-.648 1.93-1.383 2.336-1.914.203-.266.297-.531.297-.758 0-.476-.367-.828-.914-.828H4.008c-.555 0-.914.352-.914.828zM.367 2.656l14.125 14.11a.603.603 0 00.852 0 .597.597 0 000-.852L1.227 1.804a.606.606 0 00-.86 0 .618.618 0 000 .852zm1.735 9.117c0 .665.445 1.102 1.148 1.102h4.234v3.648c0 1.196.493 2.188.688 2.188.195 0 .687-.992.687-2.188V12.97h.446L8.03 11.695H3.562c-.171 0-.257-.101-.226-.312.094-.875.828-1.805 1.984-2.399l-.82-.82c-1.477.867-2.398 2.234-2.398 3.61z"})})},375071:(e,t,o)=>{o.d(t,{f:()=>n});o(667294);var r=o(745238),i=o(785893);const n=(0,r.IU)("plusThick",{viewBox:"0 0 14 14",svg:(0,i.jsx)("path",{d:"M2 7.16357C2 7.59692 2.36011 7.95093 2.78735 7.95093H6.37622V11.5398C6.37622 11.9731 6.73022 12.3271 7.16357 12.3271C7.59692 12.3271 7.95093 11.9731 7.95093 11.5398V7.95093H11.5398C11.9731 7.95093 12.3271 7.59692 12.3271 7.16357C12.3271 6.73022 11.9731 6.37622 11.5398 6.37622H7.95093V2.78735C7.95093 2.36011 7.59692 2 7.16357 2C6.73022 2 6.37622 2.36011 6.37622 2.78735V6.37622H2.78735C2.36011 6.37622 2 6.73022 2 7.16357Z"})})},954061:(e,t,o)=>{o.r(t),o.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>h,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>d,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>c,MAX_RECURRENCE_INTERVAL:()=>l,RRULE_WEEKDAYS_MAP:()=>s,getRecurrenceAfter:()=>p,rruleFromRecurrence:()=>a,templateAncestorsViolateRecurrenceNesting:()=>u});var r=o(730120),i=o(484885);const n={day:i.Ci.DAILY,week:i.Ci.WEEKLY,month:i.Ci.MONTHLY,year:i.Ci.YEARLY},s={MO:i.Ci.MO,TU:i.Ci.TU,WE:i.Ci.WE,TH:i.Ci.TH,FR:i.Ci.FR,SA:i.Ci.SA,SU:i.Ci.SU},l=100;function a(e){const{start_date:t,frequency:o,interval:r,weekdays:l,timezone:a,hour:c,minute:d}=e,u="week"===o&&l?l.map((e=>s[e])):void 0;return new i.Ci({freq:n[o],dtstart:new Date(t),interval:r,byweekday:u,tzid:a,byhour:c??0,byminute:d??0,bysecond:0})}const c=1,d=1;function u(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const o=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),r=e.length,i=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,n=r>c,s=o.length>=d;return{violatesConstraint:n||s,templateNestingExceedsMaxDepth:n,ancestorHasDailyTemplate:s,nestedDepthOfAutomationAncestors:r,immediateAncestorRecurrenceType:i}}function p(e){const{recurrence:t,afterDate:o}=e,i=a({...t}).after(new Date(o));if(!i)return;return r.ou.fromJSDate(i).toUTC().setZone("local",{keepLocalTime:!0}).toJSDate()}const h=100}}]);